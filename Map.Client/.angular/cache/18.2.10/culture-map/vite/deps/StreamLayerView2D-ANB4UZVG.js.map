{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/2d/layers/StreamLayerView2D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport r from \"../../../core/Error.js\";\nimport { handlesGroup as t, makeHandle as s } from \"../../../core/handleUtils.js\";\nimport { watch as n } from \"../../../core/reactiveUtils.js\";\nimport { property as o } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/Logger.js\";\nimport \"../../../core/RandomLCG.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport a from \"../../../rest/support/FeatureSet.js\";\nimport c from \"./FeatureLayerView2D.js\";\nimport { handleNoEngineError as l } from \"./support/handleNoEngineError.js\";\nimport h from \"../../layers/StreamLayerView.js\";\nlet p = class extends h(c) {\n  constructor() {\n    super(...arguments), this.pipelineConnectionStatus = \"disconnected\", this.pipelineErrorString = null;\n  }\n  initialize() {\n    this.addHandles([n(() => this.layer.customParameters, async e => {\n      (await this.getWorker()).streamMessenger.updateCustomParameters(e);\n    }), this.layer.on(\"send-message-to-socket\", async e => {\n      (await this.getWorker()).streamMessenger.sendMessageToSocket(e);\n    }), this.layer.on(\"send-message-to-client\", async e => {\n      (await this.getWorker()).streamMessenger.sendMessageToClient(e), this._isUserPaused && \"type\" in e && \"clear\" === e.type && this.incrementSourceRefreshVersion();\n    }), n(() => this.layer.purgeOptions, () => this._update()), n(() => this.suspended, this._onSuspendedChange.bind(this))], \"constructor\"), this._doResume();\n  }\n  destroy() {\n    this._doPause();\n  }\n  get connectionError() {\n    return this.pipelineErrorString ? new r(\"stream-controller\", this.pipelineErrorString) : null;\n  }\n  on(e, r) {\n    if (Array.isArray(e)) return t(e.map(e => this.on(e, r)));\n    const n = [\"data-received\", \"message-received\"].includes(e);\n    n && this.getWorker().then(r => r.streamMessenger.enableEvent(e, !0));\n    const o = super.on(e, r),\n      i = this;\n    return s(() => {\n      o.remove(), n && (i._workerProxy.closed || i.hasEventListener(e) || i.getWorker().then(r => r.streamMessenger.enableEvent(e, !1)));\n    });\n  }\n  async queryLatestObservations(e, t) {\n    if (!(this.layer.timeInfo?.endField || this.layer.timeInfo?.startField || this.layer.timeInfo?.trackIdField)) throw new r(\"streamlayer-no-timeField\", \"queryLatestObservation can only be used with services that define a TrackIdField\");\n    const s = await this.getWorker();\n    return l(s.features.executeQueryForLatestObservations(this._cleanUpQuery(e), t).then(e => {\n      const r = a.fromJSON(e);\n      return r.features.forEach(e => {\n        e.layer = this.layer, e.sourceLayer = this.layer;\n      }), r;\n    }), new a({\n      features: []\n    }));\n  }\n  detach() {\n    super.detach(), this.pipelineConnectionStatus = \"disconnected\";\n  }\n  get _streamConnectionStatus() {\n    return this.pipelineConnectionStatus;\n  }\n  _doPause() {\n    null != this._refreshInterval && (clearInterval(this._refreshInterval), this._refreshInterval = null);\n  }\n  _doResume() {\n    this._refreshInterval = setInterval(() => this.incrementSourceRefreshVersion(), this.layer.updateInterval);\n  }\n  _doDisconnect() {\n    this.getWorker().then(e => e.streamMessenger.disconnect()), this._doPause();\n  }\n  _doConnect() {\n    this.getWorker().then(e => e.streamMessenger.connect()), this.resume();\n  }\n  _doClear() {\n    this.getWorker().then(e => e.streamMessenger.clear()), null == this._refreshInterval && this.incrementSourceRefreshVersion();\n  }\n  _createClientOptions() {\n    const e = super._createClientOptions(),\n      r = this;\n    return {\n      ...e,\n      get container() {\n        return r.featureContainer;\n      },\n      setProperty: e => {\n        this.set(e.propertyName, e.value);\n      }\n    };\n  }\n};\ne([o()], p.prototype, \"pipelineConnectionStatus\", void 0), e([o()], p.prototype, \"pipelineErrorString\", void 0), e([o({\n  readOnly: !0\n})], p.prototype, \"connectionError\", null), e([o({\n  readOnly: !0\n})], p.prototype, \"_streamConnectionStatus\", null), p = e([i(\"esri.views.2d.layers.StreamLayerView2D\")], p);\nconst u = p;\nexport { u as default };"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,IAAI,IAAI,cAAc,EAAE,EAAC,EAAE;AAAA,EACzB,cAAc;AACZ,UAAM,GAAG,SAAS,GAAG,KAAK,2BAA2B,gBAAgB,KAAK,sBAAsB;AAAA,EAClG;AAAA,EACA,aAAa;AACX,SAAK,WAAW,CAAC,EAAE,MAAM,KAAK,MAAM,kBAAkB,CAAMA,OAAK;AAC/D,OAAC,MAAM,KAAK,UAAU,GAAG,gBAAgB,uBAAuBA,EAAC;AAAA,IACnE,EAAC,GAAG,KAAK,MAAM,GAAG,0BAA0B,CAAMA,OAAK;AACrD,OAAC,MAAM,KAAK,UAAU,GAAG,gBAAgB,oBAAoBA,EAAC;AAAA,IAChE,EAAC,GAAG,KAAK,MAAM,GAAG,0BAA0B,CAAMA,OAAK;AACrD,OAAC,MAAM,KAAK,UAAU,GAAG,gBAAgB,oBAAoBA,EAAC,GAAG,KAAK,iBAAiB,UAAUA,MAAK,YAAYA,GAAE,QAAQ,KAAK,8BAA8B;AAAA,IACjK,EAAC,GAAG,EAAE,MAAM,KAAK,MAAM,cAAc,MAAM,KAAK,QAAQ,CAAC,GAAG,EAAE,MAAM,KAAK,WAAW,KAAK,mBAAmB,KAAK,IAAI,CAAC,CAAC,GAAG,aAAa,GAAG,KAAK,UAAU;AAAA,EAC3J;AAAA,EACA,UAAU;AACR,SAAK,SAAS;AAAA,EAChB;AAAA,EACA,IAAI,kBAAkB;AACpB,WAAO,KAAK,sBAAsB,IAAI,EAAE,qBAAqB,KAAK,mBAAmB,IAAI;AAAA,EAC3F;AAAA,EACA,GAAGA,IAAGC,IAAG;AACP,QAAI,MAAM,QAAQD,EAAC,EAAG,QAAO,EAAEA,GAAE,IAAI,CAAAA,OAAK,KAAK,GAAGA,IAAGC,EAAC,CAAC,CAAC;AACxD,UAAMC,KAAI,CAAC,iBAAiB,kBAAkB,EAAE,SAASF,EAAC;AAC1D,IAAAE,MAAK,KAAK,UAAU,EAAE,KAAK,CAAAD,OAAKA,GAAE,gBAAgB,YAAYD,IAAG,IAAE,CAAC;AACpE,UAAMG,KAAI,MAAM,GAAGH,IAAGC,EAAC,GACrB,IAAI;AACN,WAAO,EAAE,MAAM;AACb,MAAAE,GAAE,OAAO,GAAGD,OAAM,EAAE,aAAa,UAAU,EAAE,iBAAiBF,EAAC,KAAK,EAAE,UAAU,EAAE,KAAK,CAAAC,OAAKA,GAAE,gBAAgB,YAAYD,IAAG,KAAE,CAAC;AAAA,IAClI,CAAC;AAAA,EACH;AAAA,EACM,wBAAwBA,IAAG,GAAG;AAAA;AAClC,UAAI,EAAE,KAAK,MAAM,UAAU,YAAY,KAAK,MAAM,UAAU,cAAc,KAAK,MAAM,UAAU,cAAe,OAAM,IAAI,EAAE,4BAA4B,kFAAkF;AACxO,YAAMI,KAAI,MAAM,KAAK,UAAU;AAC/B,aAAO,EAAEA,GAAE,SAAS,kCAAkC,KAAK,cAAcJ,EAAC,GAAG,CAAC,EAAE,KAAK,CAAAA,OAAK;AACxF,cAAMC,KAAII,GAAE,SAASL,EAAC;AACtB,eAAOC,GAAE,SAAS,QAAQ,CAAAD,OAAK;AAC7B,UAAAA,GAAE,QAAQ,KAAK,OAAOA,GAAE,cAAc,KAAK;AAAA,QAC7C,CAAC,GAAGC;AAAA,MACN,CAAC,GAAG,IAAII,GAAE;AAAA,QACR,UAAU,CAAC;AAAA,MACb,CAAC,CAAC;AAAA,IACJ;AAAA;AAAA,EACA,SAAS;AACP,UAAM,OAAO,GAAG,KAAK,2BAA2B;AAAA,EAClD;AAAA,EACA,IAAI,0BAA0B;AAC5B,WAAO,KAAK;AAAA,EACd;AAAA,EACA,WAAW;AACT,YAAQ,KAAK,qBAAqB,cAAc,KAAK,gBAAgB,GAAG,KAAK,mBAAmB;AAAA,EAClG;AAAA,EACA,YAAY;AACV,SAAK,mBAAmB,YAAY,MAAM,KAAK,8BAA8B,GAAG,KAAK,MAAM,cAAc;AAAA,EAC3G;AAAA,EACA,gBAAgB;AACd,SAAK,UAAU,EAAE,KAAK,CAAAL,OAAKA,GAAE,gBAAgB,WAAW,CAAC,GAAG,KAAK,SAAS;AAAA,EAC5E;AAAA,EACA,aAAa;AACX,SAAK,UAAU,EAAE,KAAK,CAAAA,OAAKA,GAAE,gBAAgB,QAAQ,CAAC,GAAG,KAAK,OAAO;AAAA,EACvE;AAAA,EACA,WAAW;AACT,SAAK,UAAU,EAAE,KAAK,CAAAA,OAAKA,GAAE,gBAAgB,MAAM,CAAC,GAAG,QAAQ,KAAK,oBAAoB,KAAK,8BAA8B;AAAA,EAC7H;AAAA,EACA,uBAAuB;AACrB,UAAMA,KAAI,MAAM,qBAAqB,GACnCC,KAAI;AACN,WAAO,iCACFD,KADE;AAAA,MAEL,IAAI,YAAY;AACd,eAAOC,GAAE;AAAA,MACX;AAAA,MACA,aAAa,CAAAD,OAAK;AAChB,aAAK,IAAIA,GAAE,cAAcA,GAAE,KAAK;AAAA,MAClC;AAAA,IACF;AAAA,EACF;AACF;AACAA,GAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,4BAA4B,MAAM,GAAGA,GAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,uBAAuB,MAAM,GAAGA,GAAE,CAAC,EAAE;AAAA,EACpH,UAAU;AACZ,CAAC,CAAC,GAAG,EAAE,WAAW,mBAAmB,IAAI,GAAGA,GAAE,CAAC,EAAE;AAAA,EAC/C,UAAU;AACZ,CAAC,CAAC,GAAG,EAAE,WAAW,2BAA2B,IAAI,GAAG,IAAIA,GAAE,CAAC,EAAE,wCAAwC,CAAC,GAAG,CAAC;AAC1G,IAAM,IAAI;",
  "names": ["e", "r", "n", "o", "s", "d"]
}
