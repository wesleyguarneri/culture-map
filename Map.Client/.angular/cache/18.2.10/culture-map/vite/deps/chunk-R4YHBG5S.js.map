{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/2d/viewStateUtils.js", "../../../../../../node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nconst t = Math.PI / 180;\nfunction n(n) {\n  return n * t;\n}\nfunction o(t, o) {\n  const a = n(o.rotation),\n    r = Math.abs(Math.cos(a)),\n    s = Math.abs(Math.sin(a)),\n    [u, c] = o.size;\n  return t[0] = Math.round(c * s + u * r), t[1] = Math.round(c * r + u * s), t;\n}\nfunction a(t, n, o, a) {\n  const [r, s] = n,\n    [u, c] = a,\n    h = .5 * o;\n  return t[0] = r - h * u, t[1] = s - h * c, t[2] = r + h * u, t[3] = s + h * c, t;\n}\nexport { a as getBBox, o as getOuterSize };", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport e from \"../../../../core/Accessor.js\";\nimport \"../../../../core/has.js\";\nimport { debounce as i, throwIfAborted as o, throwIfAbortError as r, eachAlways as s } from \"../../../../core/promiseUtils.js\";\nimport { property as a } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/Logger.js\";\nimport \"../../../../core/RandomLCG.js\";\nimport { subclass as n } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { create as p, toExtent as m } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { getInfo as h } from \"../../../../geometry/support/spatialReferenceUtils.js\";\nimport l from \"../../../../layers/support/TileInfo.js\";\nimport { getOuterSize as d, getBBox as c } from \"../../viewStateUtils.js\";\nimport { Bitmap as u } from \"../../engine/Bitmap.js\";\nimport g from \"../../tiling/TileInfoView.js\";\nimport f from \"../../tiling/TileKey.js\";\nconst y = p(),\n  x = [0, 0],\n  S = new f(0, 0, 0, 0),\n  w = {\n    container: null,\n    fetchSource: null,\n    requestUpdate: null,\n    imageMaxWidth: 2048,\n    imageMaxHeight: 2048,\n    imageRotationSupported: !1,\n    imageNormalizationSupported: !1,\n    hidpi: !1\n  };\nlet M = class extends e {\n  constructor(t) {\n    super(t), this._imagePromise = null, this.bitmaps = [], this.hidpi = w.hidpi, this.imageMaxWidth = w.imageMaxWidth, this.imageMaxHeight = w.imageMaxHeight, this.imageRotationSupported = w.imageRotationSupported, this.imageNormalizationSupported = w.imageNormalizationSupported, this.update = i(async (t, e) => {\n      if (o(e), !t.stationary || this.destroyed) return;\n      const i = t.state,\n        s = h(i.spatialReference),\n        a = this.hidpi ? t.pixelRatio : 1,\n        n = i.worldScreenWidth > 0,\n        p = n && this.imageNormalizationSupported && i.worldScreenWidth < i.size[0],\n        m = Math.round((this.imageMaxWidth ?? 0) / a),\n        l = Math.round((this.imageMaxHeight ?? 0) / a);\n      p ? (x[0] = i.worldScreenWidth, x[1] = i.size[1]) : this.imageRotationSupported ? (x[0] = i.size[0], x[1] = i.size[1]) : d(x, i);\n      const c = Math.floor(x[0]) > m || Math.floor(x[1]) > l,\n        u = s && (i.extent.xmin < s.valid[0] || i.extent.xmax > s.valid[1]),\n        g = !this.imageNormalizationSupported && u,\n        f = !c && !g,\n        y = this.imageRotationSupported ? i.rotation : 0,\n        S = this.container.children.slice();\n      if (f) {\n        const t = p ? i.paddedViewState.center : i.center;\n        this._imagePromise = this._singleExport(i, x, t, i.resolution, y, a, e);\n      } else {\n        let t = Math.min(m, l);\n        n && (t = Math.min(i.worldScreenWidth, t), t = Math.round(i.worldScreenWidth / Math.ceil(i.worldScreenWidth / t))), this._imagePromise = this._tiledExport(i, t, a, e);\n      }\n      try {\n        const t = (await this._imagePromise) ?? [];\n        o(e);\n        const i = [];\n        if (this._imagePromise = null, this.destroyed) return;\n        this.bitmaps = t;\n        for (const e of S) t.includes(e) || i.push(e.fadeOut().then(() => {\n          e.remove(), e.destroy();\n        }));\n        for (const e of t) i.push(e.fadeIn());\n        await Promise.all(i);\n      } catch (w) {\n        this._imagePromise = null, r(w);\n      }\n    }, 5e3), this.updateExports = i(async t => {\n      const e = [];\n      for (const i of this.container.children) {\n        if (!i.visible || !i.stage) return;\n        e.push(t(i).then(() => {\n          i.invalidateTexture(), i.requestRender();\n        }));\n      }\n      this._imagePromise = s(e).then(() => this._imagePromise = null), await this._imagePromise;\n    });\n  }\n  destroy() {\n    this.bitmaps.forEach(t => t.destroy()), this.bitmaps = [];\n  }\n  get updating() {\n    return !this.destroyed && null !== this._imagePromise;\n  }\n  async _export(t, e, i, r, s, a) {\n    const n = await this.fetchSource(t, Math.floor(e * s), Math.floor(i * s), {\n      rotation: r,\n      pixelRatio: s,\n      signal: a\n    });\n    o(a);\n    const p = new u(null, !0);\n    return p.x = t.xmin, p.y = t.ymax, p.resolution = t.width / e, p.rotation = r, p.pixelRatio = s, p.opacity = 0, this.container.addChild(p), await p.setSourceAsync(n, a), o(a), p;\n  }\n  async _singleExport(t, e, i, o, r, s, a) {\n    c(y, i, o, e);\n    const n = m(y, t.spatialReference);\n    return [await this._export(n, e[0], e[1], r, s, a)];\n  }\n  _tiledExport(t, e, i, o) {\n    const r = l.create({\n        size: e,\n        spatialReference: t.spatialReference,\n        scales: [t.scale]\n      }),\n      s = new g(r),\n      a = s.getTileCoverage(t);\n    if (!a) return null;\n    const n = [];\n    return a.forEach((r, a, p, h) => {\n      S.set(r, a, p, 0), s.getTileBounds(y, S);\n      const l = m(y, t.spatialReference);\n      n.push(this._export(l, e, e, 0, i, o).then(t => (0 !== h && (S.set(r, a, p, h), s.getTileBounds(y, S), t.x = y[0], t.y = y[3]), t)));\n    }), Promise.all(n);\n  }\n};\nt([a()], M.prototype, \"_imagePromise\", void 0), t([a()], M.prototype, \"bitmaps\", void 0), t([a()], M.prototype, \"container\", void 0), t([a()], M.prototype, \"fetchSource\", void 0), t([a()], M.prototype, \"hidpi\", void 0), t([a()], M.prototype, \"imageMaxWidth\", void 0), t([a()], M.prototype, \"imageMaxHeight\", void 0), t([a()], M.prototype, \"imageRotationSupported\", void 0), t([a()], M.prototype, \"imageNormalizationSupported\", void 0), t([a()], M.prototype, \"requestUpdate\", void 0), t([a()], M.prototype, \"updating\", null), M = t([n(\"esri.views.2d.layers.support.ExportStrategy\")], M);\nconst _ = M;\nexport { _ as default };"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAM,IAAI,KAAK,KAAK;AACpB,SAAS,EAAEA,IAAG;AACZ,SAAOA,KAAI;AACb;AACA,SAAS,EAAEC,IAAGC,IAAG;AACf,QAAMC,KAAI,EAAED,GAAE,QAAQ,GACpB,IAAI,KAAK,IAAI,KAAK,IAAIC,EAAC,CAAC,GACxBC,KAAI,KAAK,IAAI,KAAK,IAAID,EAAC,CAAC,GACxB,CAACE,IAAGC,EAAC,IAAIJ,GAAE;AACb,SAAOD,GAAE,CAAC,IAAI,KAAK,MAAMK,KAAIF,KAAIC,KAAI,CAAC,GAAGJ,GAAE,CAAC,IAAI,KAAK,MAAMK,KAAI,IAAID,KAAID,EAAC,GAAGH;AAC7E;AACA,SAASE,GAAEF,IAAGD,IAAGE,IAAGC,IAAG;AACrB,QAAM,CAAC,GAAGC,EAAC,IAAIJ,IACb,CAACK,IAAGC,EAAC,IAAIH,IACTI,KAAI,MAAKL;AACX,SAAOD,GAAE,CAAC,IAAI,IAAIM,KAAIF,IAAGJ,GAAE,CAAC,IAAIG,KAAIG,KAAID,IAAGL,GAAE,CAAC,IAAI,IAAIM,KAAIF,IAAGJ,GAAE,CAAC,IAAIG,KAAIG,KAAID,IAAGL;AACjF;;;ACDA,IAAMO,KAAI,EAAE;AAAZ,IACE,IAAI,CAAC,GAAG,CAAC;AADX,IAEEC,KAAI,IAAIC,GAAE,GAAG,GAAG,GAAG,CAAC;AAFtB,IAGE,IAAI;AAAA,EACF,WAAW;AAAA,EACX,aAAa;AAAA,EACb,eAAe;AAAA,EACf,eAAe;AAAA,EACf,gBAAgB;AAAA,EAChB,wBAAwB;AAAA,EACxB,6BAA6B;AAAA,EAC7B,OAAO;AACT;AACF,IAAI,IAAI,cAAc,EAAE;AAAA,EACtB,YAAYC,IAAG;AACb,UAAMA,EAAC,GAAG,KAAK,gBAAgB,MAAM,KAAK,UAAU,CAAC,GAAG,KAAK,QAAQ,EAAE,OAAO,KAAK,gBAAgB,EAAE,eAAe,KAAK,iBAAiB,EAAE,gBAAgB,KAAK,yBAAyB,EAAE,wBAAwB,KAAK,8BAA8B,EAAE,6BAA6B,KAAK,SAAS,EAAE,CAAOA,IAAGD,OAAM;AACpT,UAAI,EAAEA,EAAC,GAAG,CAACC,GAAE,cAAc,KAAK,UAAW;AAC3C,YAAM,IAAIA,GAAE,OACVC,KAAIA,GAAE,EAAE,gBAAgB,GACxBC,KAAI,KAAK,QAAQF,GAAE,aAAa,GAChCG,KAAI,EAAE,mBAAmB,GACzB,IAAIA,MAAK,KAAK,+BAA+B,EAAE,mBAAmB,EAAE,KAAK,CAAC,GAC1E,IAAI,KAAK,OAAO,KAAK,iBAAiB,KAAKD,EAAC,GAC5C,IAAI,KAAK,OAAO,KAAK,kBAAkB,KAAKA,EAAC;AAC/C,WAAK,EAAE,CAAC,IAAI,EAAE,kBAAkB,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,KAAK,0BAA0B,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,GAAG,CAAC;AAC/H,YAAME,KAAI,KAAK,MAAM,EAAE,CAAC,CAAC,IAAI,KAAK,KAAK,MAAM,EAAE,CAAC,CAAC,IAAI,GACnDC,KAAIJ,OAAM,EAAE,OAAO,OAAOA,GAAE,MAAM,CAAC,KAAK,EAAE,OAAO,OAAOA,GAAE,MAAM,CAAC,IACjE,IAAI,CAAC,KAAK,+BAA+BI,IACzC,IAAI,CAACD,MAAK,CAAC,GACXP,KAAI,KAAK,yBAAyB,EAAE,WAAW,GAC/CC,KAAI,KAAK,UAAU,SAAS,MAAM;AACpC,UAAI,GAAG;AACL,cAAME,KAAI,IAAI,EAAE,gBAAgB,SAAS,EAAE;AAC3C,aAAK,gBAAgB,KAAK,cAAc,GAAG,GAAGA,IAAG,EAAE,YAAYH,IAAGK,IAAGH,EAAC;AAAA,MACxE,OAAO;AACL,YAAIC,KAAI,KAAK,IAAI,GAAG,CAAC;AACrB,QAAAG,OAAMH,KAAI,KAAK,IAAI,EAAE,kBAAkBA,EAAC,GAAGA,KAAI,KAAK,MAAM,EAAE,mBAAmB,KAAK,KAAK,EAAE,mBAAmBA,EAAC,CAAC,IAAI,KAAK,gBAAgB,KAAK,aAAa,GAAGA,IAAGE,IAAGH,EAAC;AAAA,MACvK;AACA,UAAI;AACF,cAAMC,MAAK,MAAM,KAAK,kBAAkB,CAAC;AACzC,UAAED,EAAC;AACH,cAAMO,KAAI,CAAC;AACX,YAAI,KAAK,gBAAgB,MAAM,KAAK,UAAW;AAC/C,aAAK,UAAUN;AACf,mBAAWD,MAAKD,GAAG,CAAAE,GAAE,SAASD,EAAC,KAAKO,GAAE,KAAKP,GAAE,QAAQ,EAAE,KAAK,MAAM;AAChE,UAAAA,GAAE,OAAO,GAAGA,GAAE,QAAQ;AAAA,QACxB,CAAC,CAAC;AACF,mBAAWA,MAAKC,GAAG,CAAAM,GAAE,KAAKP,GAAE,OAAO,CAAC;AACpC,cAAM,QAAQ,IAAIO,EAAC;AAAA,MACrB,SAASC,IAAG;AACV,aAAK,gBAAgB,MAAM,EAAEA,EAAC;AAAA,MAChC;AAAA,IACF,IAAG,GAAG,GAAG,KAAK,gBAAgB,EAAE,CAAMP,OAAK;AACzC,YAAMD,KAAI,CAAC;AACX,iBAAW,KAAK,KAAK,UAAU,UAAU;AACvC,YAAI,CAAC,EAAE,WAAW,CAAC,EAAE,MAAO;AAC5B,QAAAA,GAAE,KAAKC,GAAE,CAAC,EAAE,KAAK,MAAM;AACrB,YAAE,kBAAkB,GAAG,EAAE,cAAc;AAAA,QACzC,CAAC,CAAC;AAAA,MACJ;AACA,WAAK,gBAAgB,EAAED,EAAC,EAAE,KAAK,MAAM,KAAK,gBAAgB,IAAI,GAAG,MAAM,KAAK;AAAA,IAC9E,EAAC;AAAA,EACH;AAAA,EACA,UAAU;AACR,SAAK,QAAQ,QAAQ,CAAAC,OAAKA,GAAE,QAAQ,CAAC,GAAG,KAAK,UAAU,CAAC;AAAA,EAC1D;AAAA,EACA,IAAI,WAAW;AACb,WAAO,CAAC,KAAK,aAAa,SAAS,KAAK;AAAA,EAC1C;AAAA,EACM,QAAQA,IAAGD,IAAG,GAAG,GAAGE,IAAGC,IAAG;AAAA;AAC9B,YAAMC,KAAI,MAAM,KAAK,YAAYH,IAAG,KAAK,MAAMD,KAAIE,EAAC,GAAG,KAAK,MAAM,IAAIA,EAAC,GAAG;AAAA,QACxE,UAAU;AAAA,QACV,YAAYA;AAAA,QACZ,QAAQC;AAAA,MACV,CAAC;AACD,QAAEA,EAAC;AACH,YAAM,IAAI,IAAI,EAAE,MAAM,IAAE;AACxB,aAAO,EAAE,IAAIF,GAAE,MAAM,EAAE,IAAIA,GAAE,MAAM,EAAE,aAAaA,GAAE,QAAQD,IAAG,EAAE,WAAW,GAAG,EAAE,aAAaE,IAAG,EAAE,UAAU,GAAG,KAAK,UAAU,SAAS,CAAC,GAAG,MAAM,EAAE,eAAeE,IAAGD,EAAC,GAAG,EAAEA,EAAC,GAAG;AAAA,IAClL;AAAA;AAAA,EACM,cAAcF,IAAGD,IAAG,GAAGS,IAAG,GAAGP,IAAGC,IAAG;AAAA;AACvC,MAAAA,GAAEL,IAAG,GAAGW,IAAGT,EAAC;AACZ,YAAMI,KAAI,EAAEN,IAAGG,GAAE,gBAAgB;AACjC,aAAO,CAAC,MAAM,KAAK,QAAQG,IAAGJ,GAAE,CAAC,GAAGA,GAAE,CAAC,GAAG,GAAGE,IAAGC,EAAC,CAAC;AAAA,IACpD;AAAA;AAAA,EACA,aAAaF,IAAGD,IAAG,GAAGS,IAAG;AACvB,UAAM,IAAI,EAAE,OAAO;AAAA,MACf,MAAMT;AAAA,MACN,kBAAkBC,GAAE;AAAA,MACpB,QAAQ,CAACA,GAAE,KAAK;AAAA,IAClB,CAAC,GACDC,KAAI,IAAI,EAAE,CAAC,GACXC,KAAID,GAAE,gBAAgBD,EAAC;AACzB,QAAI,CAACE,GAAG,QAAO;AACf,UAAMC,KAAI,CAAC;AACX,WAAOD,GAAE,QAAQ,CAACO,IAAGP,IAAG,GAAGQ,OAAM;AAC/B,MAAAZ,GAAE,IAAIW,IAAGP,IAAG,GAAG,CAAC,GAAGD,GAAE,cAAcJ,IAAGC,EAAC;AACvC,YAAM,IAAI,EAAED,IAAGG,GAAE,gBAAgB;AACjC,MAAAG,GAAE,KAAK,KAAK,QAAQ,GAAGJ,IAAGA,IAAG,GAAG,GAAGS,EAAC,EAAE,KAAK,CAAAR,QAAM,MAAMU,OAAMZ,GAAE,IAAIW,IAAGP,IAAG,GAAGQ,EAAC,GAAGT,GAAE,cAAcJ,IAAGC,EAAC,GAAGE,GAAE,IAAIH,GAAE,CAAC,GAAGG,GAAE,IAAIH,GAAE,CAAC,IAAIG,GAAE,CAAC;AAAA,IACrI,CAAC,GAAG,QAAQ,IAAIG,EAAC;AAAA,EACnB;AACF;AACA,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,iBAAiB,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,WAAW,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,aAAa,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,eAAe,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,SAAS,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,iBAAiB,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,kBAAkB,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,0BAA0B,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,+BAA+B,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,iBAAiB,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,YAAY,IAAI,GAAG,IAAI,EAAE,CAACD,GAAE,6CAA6C,CAAC,GAAG,CAAC;AACxkB,IAAM,IAAI;",
  "names": ["n", "t", "o", "a", "s", "u", "c", "h", "y", "S", "e", "t", "s", "a", "n", "c", "u", "i", "w", "o", "r", "h"]
}
