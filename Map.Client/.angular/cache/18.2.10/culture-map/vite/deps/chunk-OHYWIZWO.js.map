{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/widgets/support/AnalysisViewModel.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport t from \"../../core/Accessor.js\";\nimport { createTask as s } from \"../../core/asyncUtils.js\";\nimport \"../../core/has.js\";\nimport i from \"../../core/Logger.js\";\nimport { abortMaybe as n, removeMaybe as r } from \"../../core/maybe.js\";\nimport { throwIfAborted as a, isAbortError as o, isAborted as l } from \"../../core/promiseUtils.js\";\nimport { watch as c, syncAndInitial as h, sync as w, whenOnce as p, when as y } from \"../../core/reactiveUtils.js\";\nimport { property as u } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/RandomLCG.js\";\nimport { subclass as d } from \"../../core/accessorSupport/decorators/subclass.js\";\nvar v;\n!function (e) {\n  e[e.PENDING = 0] = \"PENDING\", e[e.WAIT_FOR_VIEW_READY = 1] = \"WAIT_FOR_VIEW_READY\", e[e.RUNNING = 2] = \"RUNNING\";\n}(v || (v = {}));\nlet _ = class extends t {\n  constructor(e = {}) {\n    super(e), this.view = null, this.analysisView = null, this._reconnectViewTask = null, this._forceInteractiveHandle = null, this._parentChangeFromReconnect = !1, this._startUserOperation = null;\n    const t = e?.analysis;\n    null != t ? this.analysis = t : (this._set(\"analysis\", this.constructAnalysis()), this._set(\"isAnalysisOwner\", !0)), null != e?.visible && (this.visible = e.visible);\n  }\n  normalizeCtorArgs(e) {\n    const {\n      analysis: t,\n      ...s\n    } = e;\n    return s;\n  }\n  initialize() {\n    this.addHandles([c(() => ({\n      readyAndNotSupported: null != this.view && this.view.ready && !this.supported\n    }), ({\n      readyAndNotSupported: e\n    }) => {\n      e && i.getLogger(this).errorOnce(this.unsupportedErrorMessage);\n    }, h), c(() => this.analysis?.parent, e => {\n      this._parentChangeFromReconnect || e === this.view || this._set(\"isAnalysisOwner\", !1);\n      const t = !this._parentChangeFromReconnect;\n      this._parentChangeFromReconnect = !1, t && this._scheduleViewReconnect();\n    }, w), c(() => ({\n      view: this.view,\n      ready: null != this.view && this.view.ready,\n      supported: this.supported\n    }), ({\n      view: e\n    }, t) => {\n      const s = t?.view;\n      e !== s && (this._startUserOperation = n(this._startUserOperation), this._disconnectFromView(s)), this._scheduleViewReconnect();\n    }, h)]);\n  }\n  destroy() {\n    this._reconnectViewTask = n(this._reconnectViewTask), this._startUserOperation = n(this._startUserOperation), null != this.analysisView && (this.analysisView.visible = void 0), this._disconnectFromView(this.view), this._set(\"view\", null), null != this.analysis && this.isAnalysisOwner && (this.analysis.destroy(), this._set(\"analysis\", null));\n  }\n  get supported() {\n    return null == this.view || this.view.type === this.supportedViewType;\n  }\n  set visible(e) {\n    this._set(\"visible\", e), null != this.analysisView && (this.analysisView.visible = e);\n  }\n  get active() {\n    return null != this.tool && this.tool.active;\n  }\n  get disabled() {\n    return null == this.view || !this.view.ready || !this.supported;\n  }\n  set analysis(e) {\n    e !== this._get(\"analysis\") && (this._startUserOperation = n(this._startUserOperation), this._disconnectFromView(this.view), this._setExternalAnalysis(e), this._scheduleViewReconnect());\n  }\n  get ready() {\n    return null != this.analysisView && !this.connectingToView;\n  }\n  get connectingToView() {\n    return null != this._reconnectViewTask;\n  }\n  get isAnalysisOwner() {\n    return this._get(\"isAnalysisOwner\");\n  }\n  get tool() {\n    return null != this.analysisView ? this.analysisView.tool : null;\n  }\n  clear() {\n    this._startUserOperation = n(this._startUserOperation), this._resetInteractiveCreationState(), null != this.tool && null != this.view && this.view.activeTool === this.tool && (this.view.activeTool = null);\n  }\n  async start() {\n    if (!this.visible) return void i.getLogger(this).warn(\"Cannot start analysis when not visible\");\n    this.clear();\n    const e = {\n        task: null,\n        abort: null,\n        state: v.PENDING\n      },\n      t = s(async t => {\n        if (e.state = v.WAIT_FOR_VIEW_READY, await p(() => this.ready, t), e.state = v.RUNNING, null == this.analysisView || null == this.view) return;\n        const s = this.analysisView.tool;\n        null != s && (this.view.activeTool = s, y(() => s.created, () => {\n          s.active && null != this.view && (this.view.activeTool = null);\n        }, {\n          initial: !0,\n          once: !0\n        }));\n      });\n    return e.task = t, e.abort = () => t.abort(), this._startUserOperation = e, t.promise;\n  }\n  onConnectToAnalysisView(e) {}\n  onDisconnectFromAnalysisView() {}\n  _scheduleViewReconnect() {\n    this._reconnectViewTask = n(this._reconnectViewTask);\n    const e = s(async t => {\n      try {\n        await this._reconnectView(t);\n      } catch (s) {\n        if (a(t), !o(s)) return void i.getLogger(this).warn(\"Failed to use analysis in view model\", s);\n        throw s;\n      } finally {\n        e === this._reconnectViewTask && (this._reconnectViewTask = null);\n      }\n    });\n    this._reconnectViewTask = e;\n  }\n  async _reconnectView(e) {\n    const {\n        view: t\n      } = this,\n      s = null != t && t.ready && this.supported,\n      n = this.analysis;\n    if (this._startUserOperation = V(this._startUserOperation), this._disconnectFromView(t), s && null != t && null != n) {\n      if (this.isAnalysisOwner) {\n        if (null != n.parent) return void i.getLogger(this).errorOnce(\"expected owned analysis to have null parent when connecting to view\");\n        this._parentChangeFromReconnect = !0, t.analyses.add(n);\n      }\n      this.analysisView = await t.whenAnalysisView(n), l(e) ? this._startUserOperation = V(this._startUserOperation) : (this.analysisView.visible = this.visible, this._forceInteractiveHandle = this.analysisView.forceInteractiveForViewModel(), this.addHandles(this._forceInteractiveHandle), this.onConnectToAnalysisView(this.analysisView));\n    }\n  }\n  _disconnectFromView(e) {\n    null != e && this.isAnalysisOwner && e.analyses.includes(this.analysis) && (this._parentChangeFromReconnect = !0, this.analysis.clear(), e.analyses.remove(this.analysis)), this.onDisconnectFromAnalysisView(), this._forceInteractiveHandle = r(this._forceInteractiveHandle), this.analysisView = null;\n  }\n  _setExternalAnalysis(e) {\n    null == this.analysisView || this.isAnalysisOwner || (this.analysisView.visible = void 0, this._forceInteractiveHandle = r(this._forceInteractiveHandle)), this.analysisView = null, this._set(\"isAnalysisOwner\", !1), this._set(\"analysis\", e), this._parentChangeFromReconnect = !1;\n  }\n  _resetInteractiveCreationState() {\n    this.analysis.clear(), null != this.tool && this.tool.resetCreated();\n  }\n  get testInfo() {}\n};\nfunction V(e) {\n  return null != e && e.state >= v.RUNNING ? (e.abort(), null) : e;\n}\ne([u()], _.prototype, \"supported\", null), e([u()], _.prototype, \"view\", void 0), e([u({\n  type: Boolean,\n  value: !0\n})], _.prototype, \"visible\", null), e([u()], _.prototype, \"active\", null), e([u()], _.prototype, \"disabled\", null), e([u({\n  nonNullable: !0\n})], _.prototype, \"analysis\", null), e([u()], _.prototype, \"analysisView\", void 0), e([u()], _.prototype, \"ready\", null), e([u()], _.prototype, \"connectingToView\", null), e([u({\n  readOnly: !0\n})], _.prototype, \"isAnalysisOwner\", null), e([u()], _.prototype, \"_reconnectViewTask\", void 0), e([u()], _.prototype, \"_forceInteractiveHandle\", void 0), e([u()], _.prototype, \"tool\", null), _ = e([d(\"esri.widgets.support.AnalysisViewModel\")], _);\nexport { _ as AnalysisViewModel };"],
  "mappings": "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",
  "names": ["e", "s", "d", "t", "n"]
}
