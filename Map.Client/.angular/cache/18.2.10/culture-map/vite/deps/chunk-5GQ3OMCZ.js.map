{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/versionManagement/support/versionManagementUtils.js", "../../../../../../node_modules/@arcgis/core/layers/mixins/EditBusLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../request.js\";\nimport { generateLowercaseBracedUUID as r } from \"../../core/uuid.js\";\nconst t = r(),\n  n = new Map(),\n  s = new Map(),\n  a = new Map();\nasync function o(r, t, s) {\n  if (!r || !s) return !1;\n  if (!t) return !0;\n  const a = new URL(r).host;\n  let o = n.get(a);\n  if (!o) {\n    const t = r.replace(/\\/FeatureServer/i, \"/VersionManagementServer\").replace(/\\/\\d*$/, \"\");\n    o = (await e(t, {\n      responseType: \"json\",\n      query: {\n        f: \"json\"\n      }\n    })).data.defaultVersionName;\n  }\n  return o === t;\n}\nasync function i(e, r, n = !1) {\n  if (!e || !r) return !0;\n  const a = e.replace(/\\/FeatureServer/i, \"/VersionManagementServer\").replace(/\\/\\d*$/, \"\"),\n    o = s.get(a)?.entries();\n  if (o) for (const [s, i] of o) if (i.name === r) {\n    const e = !i.stack?.hasForwardEdits();\n    if (!e && n) {\n      const [{\n          deleteForwardEdits: e\n        }, {\n          default: r\n        }] = await Promise.all([import(\"../../rest/versionManagement/gdbVersion/deleteForwardEdits.js\"), import(\"../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters.js\")]),\n        n = await e(a, s, new r({\n          sessionId: t,\n          moment: i.moment\n        }));\n      return n.success && i.stack?.clearForwardEdits(), n.success;\n    }\n    return e;\n  }\n  return !0;\n}\nfunction c(e, r) {\n  if (!e) return !1;\n  const t = e.replace(/\\/FeatureServer/i, \"/VersionManagementServer\").replace(/\\/\\d*$/, \"\"),\n    n = s.get(t)?.entries();\n  if (n) for (const [s, a] of n) if (a.name === r) {\n    return \"edit\" === a.lockType;\n  }\n  return !1;\n}\nexport { t as currentSessionId, n as defaultVersionNameLookup, o as isHistoricVersion, i as isSafeToEditVersion, c as isVersionInEditSession, s as versionCollection, a as versionCollectionCount };", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../chunks/tslib.es6.js\";\nimport e from \"../../core/Evented.js\";\nimport { clone as i } from \"../../core/lang.js\";\nimport { createResolver as s } from \"../../core/promiseUtils.js\";\nimport { property as r } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/Logger.js\";\nimport { subclass as d } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { defaultVersionNameLookup as o, isVersionInEditSession as n } from \"../../versionManagement/support/versionManagementUtils.js\";\nconst a = new e.EventEmitter();\nfunction l(t) {\n  return a.on(\"apply-edits\", new WeakRef(t));\n}\nfunction h(t) {\n  return a.on(\"update-moment\", new WeakRef(t));\n}\nfunction c(t, e, i = null, r = !1) {\n  const d = s();\n  return r = null == e || r, a.emit(\"apply-edits\", {\n    serviceUrl: t,\n    layerId: e,\n    gdbVersion: i,\n    mayReceiveServiceEdits: r,\n    result: d.promise\n  }), d;\n}\nfunction u(t, e, i = null, s) {\n  a.emit(\"update-moment\", {\n    serviceUrl: t,\n    layerId: e,\n    gdbVersion: i,\n    moment: s\n  });\n}\nconst m = Symbol();\nfunction p(t) {\n  return null != t && \"object\" == typeof t && m in t;\n}\nfunction b(t) {\n  return null != t && \"object\" == typeof t && \"gdbVersion\" in t;\n}\nfunction g(t, e, i) {\n  const s = new URL(t).host,\n    r = o.get(s),\n    d = t => !t || t === r;\n  return d(e) && d(i) || e === i;\n}\nconst F = e => {\n  var s;\n  let o = class extends e {\n    constructor(...t) {\n      super(...t), this[s] = !0, this._applyEditsHandler = t => {\n        const {\n            serviceUrl: e,\n            layerId: s,\n            gdbVersion: r,\n            mayReceiveServiceEdits: d,\n            result: o\n          } = t,\n          n = e === this.url,\n          a = null != s && null != this.layerId && s === this.layerId,\n          l = b(this),\n          h = b(this) && g(e, r, this.gdbVersion);\n        if (!n || l && !h || !a && !d) return;\n        const c = o.then(t => {\n          if (this.lastEditsEventDate = new Date(), a && (t.addedFeatures.length || t.updatedFeatures.length || t.deletedFeatures.length || t.addedAttachments.length || t.updatedAttachments.length || t.deletedAttachments.length)) return this.emit(\"edits\", i(t)), t;\n          const s = t.editedFeatures?.find(({\n            layerId: t\n          }) => t === this.layerId);\n          if (s) {\n            const {\n                adds: e,\n                updates: r,\n                deletes: d\n              } = s.editedFeatures,\n              o = {\n                edits: null,\n                addedAttachments: [],\n                deletedAttachments: [],\n                updatedAttachments: [],\n                addedFeatures: e ? e.map(({\n                  attributes: t\n                }) => ({\n                  objectId: this.objectIdField && t[this.objectIdField],\n                  globalId: this.globalIdField && t[this.globalIdField]\n                })) : [],\n                deletedFeatures: d ? d.map(({\n                  attributes: t\n                }) => ({\n                  objectId: this.objectIdField && t[this.objectIdField],\n                  globalId: this.globalIdField && t[this.globalIdField]\n                })) : [],\n                updatedFeatures: r ? r.map(({\n                  current: {\n                    attributes: t\n                  }\n                }) => ({\n                  objectId: this.objectIdField && t[this.objectIdField],\n                  globalId: this.globalIdField && t[this.globalIdField]\n                })) : [],\n                editedFeatures: i(t.editedFeatures),\n                exceededTransferLimit: !1,\n                historicMoment: i(t.historicMoment)\n              };\n            return this.emit(\"edits\", o), o;\n          }\n          const d = {\n            edits: null,\n            addedAttachments: [],\n            deletedAttachments: [],\n            updatedAttachments: [],\n            addedFeatures: [],\n            deletedFeatures: [],\n            updatedFeatures: [],\n            editedFeatures: i(t.editedFeatures),\n            exceededTransferLimit: !1,\n            historicMoment: i(t.historicMoment)\n          };\n          return \"historicMoment\" in this && this._shouldUpdateHistoricMoment(e, r, d.historicMoment) && this.emit(\"edits\", d), d;\n        }).then(t => (\"historicMoment\" in this && this._shouldUpdateHistoricMoment(e, r, t.historicMoment) && (this.historicMoment = t.historicMoment), t));\n        this.emit(\"apply-edits\", {\n          result: c\n        });\n      }, this._updateMomentHandler = t => {\n        const {\n            serviceUrl: e,\n            gdbVersion: i,\n            moment: s\n          } = t,\n          r = e === this.url,\n          d = b(this),\n          o = b(this) && g(e, i, this.gdbVersion),\n          n = b(this) && !g(e, this.gdbVersion, null);\n        r && d && o && n && \"historicMoment\" in this && this.historicMoment !== s && (this.historicMoment = s);\n      }, this.when().then(() => {\n        this.addHandles(l(this._applyEditsHandler)), \"historicMoment\" in this && this.addHandles(h(this._updateMomentHandler));\n      }, () => {});\n    }\n    _shouldUpdateHistoricMoment(t, e, i) {\n      return \"historicMoment\" in this && this.historicMoment !== i && n(t, e);\n    }\n  };\n  return s = m, t([r()], o.prototype, \"lastEditsEventDate\", void 0), o = t([d(\"esri.layers.mixins.EditBusLayer\")], o), o;\n};\nexport { F as EditBusLayer, c as emitApplyEditsEvent, u as emitUpdateMomentEvent, p as isEditBusLayer, b as isLayerWithGDBVersion, l as onApplyEditsEvent, h as onUpdateMomentEvent, g as versionMatches };"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,IAAM,IAAIA,GAAE;AAAZ,IACE,IAAI,oBAAI,IAAI;AADd,IAEE,IAAI,oBAAI,IAAI;AAFd,IAGEC,KAAI,oBAAI,IAAI;AACd,SAAeD,GAAE,GAAGE,IAAGC,IAAG;AAAA;AACxB,QAAI,CAAC,KAAK,CAACA,GAAG,QAAO;AACrB,QAAI,CAACD,GAAG,QAAO;AACf,UAAMD,KAAI,IAAI,IAAI,CAAC,EAAE;AACrB,QAAID,KAAI,EAAE,IAAIC,EAAC;AACf,QAAI,CAACD,IAAG;AACN,YAAME,KAAI,EAAE,QAAQ,oBAAoB,0BAA0B,EAAE,QAAQ,UAAU,EAAE;AACxF,MAAAF,MAAK,MAAM,EAAEE,IAAG;AAAA,QACd,cAAc;AAAA,QACd,OAAO;AAAA,UACL,GAAG;AAAA,QACL;AAAA,MACF,CAAC,GAAG,KAAK;AAAA,IACX;AACA,WAAOF,OAAME;AAAA,EACf;AAAA;AACA,SAAe,EAAEE,IAAG,GAAGC,KAAI,OAAI;AAAA;AAC7B,QAAI,CAACD,MAAK,CAAC,EAAG,QAAO;AACrB,UAAMH,KAAIG,GAAE,QAAQ,oBAAoB,0BAA0B,EAAE,QAAQ,UAAU,EAAE,GACtFJ,KAAI,EAAE,IAAIC,EAAC,GAAG,QAAQ;AACxB,QAAID;AAAG,iBAAW,CAACG,IAAGG,EAAC,KAAKN,GAAG,KAAIM,GAAE,SAAS,GAAG;AAC/C,cAAMF,KAAI,CAACE,GAAE,OAAO,gBAAgB;AACpC,YAAI,CAACF,MAAKC,IAAG;AACX,gBAAM,CAAC;AAAA,YACH,oBAAoBD;AAAA,UACtB,GAAG;AAAA,YACD,SAASG;AAAA,UACX,CAAC,IAAI,MAAM,QAAQ,IAAI,CAAC,OAAO,kCAA+D,GAAG,OAAO,4CAAiF,CAAC,CAAC,GAC3LF,KAAI,MAAMD,GAAEH,IAAGE,IAAG,IAAII,GAAE;AAAA,YACtB,WAAW;AAAA,YACX,QAAQD,GAAE;AAAA,UACZ,CAAC,CAAC;AACJ,iBAAOD,GAAE,WAAWC,GAAE,OAAO,kBAAkB,GAAGD,GAAE;AAAA,QACtD;AACA,eAAOD;AAAA,MACT;AAAA;AACA,WAAO;AAAA,EACT;AAAA;AACA,SAAS,EAAEA,IAAG,GAAG;AACf,MAAI,CAACA,GAAG,QAAO;AACf,QAAMF,KAAIE,GAAE,QAAQ,oBAAoB,0BAA0B,EAAE,QAAQ,UAAU,EAAE,GACtFC,KAAI,EAAE,IAAIH,EAAC,GAAG,QAAQ;AACxB,MAAIG;AAAG,eAAW,CAACF,IAAGF,EAAC,KAAKI,GAAG,KAAIJ,GAAE,SAAS,GAAG;AAC/C,aAAO,WAAWA,GAAE;AAAA,IACtB;AAAA;AACA,SAAO;AACT;;;AC3CA,IAAMO,KAAI,IAAI,EAAE,aAAa;AAC7B,SAAS,EAAEC,IAAG;AACZ,SAAOD,GAAE,GAAG,eAAe,IAAI,QAAQC,EAAC,CAAC;AAC3C;AACA,SAAS,EAAEA,IAAG;AACZ,SAAOD,GAAE,GAAG,iBAAiB,IAAI,QAAQC,EAAC,CAAC;AAC7C;AACA,SAASC,GAAED,IAAGE,IAAGC,KAAI,MAAM,IAAI,OAAI;AACjC,QAAM,IAAI,EAAE;AACZ,SAAO,IAAI,QAAQD,MAAK,GAAGH,GAAE,KAAK,eAAe;AAAA,IAC/C,YAAYC;AAAA,IACZ,SAASE;AAAA,IACT,YAAYC;AAAA,IACZ,wBAAwB;AAAA,IACxB,QAAQ,EAAE;AAAA,EACZ,CAAC,GAAG;AACN;AACA,SAAS,EAAEH,IAAGE,IAAGC,KAAI,MAAMC,IAAG;AAC5B,EAAAL,GAAE,KAAK,iBAAiB;AAAA,IACtB,YAAYC;AAAA,IACZ,SAASE;AAAA,IACT,YAAYC;AAAA,IACZ,QAAQC;AAAA,EACV,CAAC;AACH;AACA,IAAM,IAAI,OAAO;AACjB,SAAS,EAAEJ,IAAG;AACZ,SAAO,QAAQA,MAAK,YAAY,OAAOA,MAAK,KAAKA;AACnD;AACA,SAAS,EAAEA,IAAG;AACZ,SAAO,QAAQA,MAAK,YAAY,OAAOA,MAAK,gBAAgBA;AAC9D;AACA,SAAS,EAAEA,IAAGE,IAAGC,IAAG;AAClB,QAAMC,KAAI,IAAI,IAAIJ,EAAC,EAAE,MACnB,IAAI,EAAE,IAAII,EAAC,GACX,IAAI,CAAAJ,OAAK,CAACA,MAAKA,OAAM;AACvB,SAAO,EAAEE,EAAC,KAAK,EAAEC,EAAC,KAAKD,OAAMC;AAC/B;AACA,IAAM,IAAI,CAAAD,OAAK;AACb,MAAIE;AACJ,MAAIC,KAAI,cAAcH,GAAE;AAAA,IACtB,eAAeF,IAAG;AAChB,YAAM,GAAGA,EAAC,GAAG,KAAKI,EAAC,IAAI,MAAI,KAAK,qBAAqB,CAAAJ,OAAK;AACxD,cAAM;AAAA,UACF,YAAYE;AAAA,UACZ,SAASE;AAAA,UACT,YAAY;AAAA,UACZ,wBAAwB;AAAA,UACxB,QAAQC;AAAA,QACV,IAAIL,IACJM,KAAIJ,OAAM,KAAK,KACfH,KAAI,QAAQK,MAAK,QAAQ,KAAK,WAAWA,OAAM,KAAK,SACpDG,KAAI,EAAE,IAAI,GACVC,KAAI,EAAE,IAAI,KAAK,EAAEN,IAAG,GAAG,KAAK,UAAU;AACxC,YAAI,CAACI,MAAKC,MAAK,CAACC,MAAK,CAACT,MAAK,CAAC,EAAG;AAC/B,cAAME,KAAII,GAAE,KAAK,CAAAL,OAAK;AACpB,cAAI,KAAK,qBAAqB,oBAAI,KAAK,GAAGD,OAAMC,GAAE,cAAc,UAAUA,GAAE,gBAAgB,UAAUA,GAAE,gBAAgB,UAAUA,GAAE,iBAAiB,UAAUA,GAAE,mBAAmB,UAAUA,GAAE,mBAAmB,QAAS,QAAO,KAAK,KAAK,SAAS,EAAEA,EAAC,CAAC,GAAGA;AAC7P,gBAAMI,KAAIJ,GAAE,gBAAgB,KAAK,CAAC;AAAA,YAChC,SAASA;AAAA,UACX,MAAMA,OAAM,KAAK,OAAO;AACxB,cAAII,IAAG;AACL,kBAAM;AAAA,cACF,MAAMF;AAAA,cACN,SAASO;AAAA,cACT,SAASC;AAAA,YACX,IAAIN,GAAE,gBACNC,KAAI;AAAA,cACF,OAAO;AAAA,cACP,kBAAkB,CAAC;AAAA,cACnB,oBAAoB,CAAC;AAAA,cACrB,oBAAoB,CAAC;AAAA,cACrB,eAAeH,KAAIA,GAAE,IAAI,CAAC;AAAA,gBACxB,YAAYF;AAAA,cACd,OAAO;AAAA,gBACL,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,gBACpD,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,cACtD,EAAE,IAAI,CAAC;AAAA,cACP,iBAAiBU,KAAIA,GAAE,IAAI,CAAC;AAAA,gBAC1B,YAAYV;AAAA,cACd,OAAO;AAAA,gBACL,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,gBACpD,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,cACtD,EAAE,IAAI,CAAC;AAAA,cACP,iBAAiBS,KAAIA,GAAE,IAAI,CAAC;AAAA,gBAC1B,SAAS;AAAA,kBACP,YAAYT;AAAA,gBACd;AAAA,cACF,OAAO;AAAA,gBACL,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,gBACpD,UAAU,KAAK,iBAAiBA,GAAE,KAAK,aAAa;AAAA,cACtD,EAAE,IAAI,CAAC;AAAA,cACP,gBAAgB,EAAEA,GAAE,cAAc;AAAA,cAClC,uBAAuB;AAAA,cACvB,gBAAgB,EAAEA,GAAE,cAAc;AAAA,YACpC;AACF,mBAAO,KAAK,KAAK,SAASK,EAAC,GAAGA;AAAA,UAChC;AACA,gBAAMK,KAAI;AAAA,YACR,OAAO;AAAA,YACP,kBAAkB,CAAC;AAAA,YACnB,oBAAoB,CAAC;AAAA,YACrB,oBAAoB,CAAC;AAAA,YACrB,eAAe,CAAC;AAAA,YAChB,iBAAiB,CAAC;AAAA,YAClB,iBAAiB,CAAC;AAAA,YAClB,gBAAgB,EAAEV,GAAE,cAAc;AAAA,YAClC,uBAAuB;AAAA,YACvB,gBAAgB,EAAEA,GAAE,cAAc;AAAA,UACpC;AACA,iBAAO,oBAAoB,QAAQ,KAAK,4BAA4BE,IAAG,GAAGQ,GAAE,cAAc,KAAK,KAAK,KAAK,SAASA,EAAC,GAAGA;AAAA,QACxH,CAAC,EAAE,KAAK,CAAAV,QAAM,oBAAoB,QAAQ,KAAK,4BAA4BE,IAAG,GAAGF,GAAE,cAAc,MAAM,KAAK,iBAAiBA,GAAE,iBAAiBA,GAAE;AAClJ,aAAK,KAAK,eAAe;AAAA,UACvB,QAAQC;AAAA,QACV,CAAC;AAAA,MACH,GAAG,KAAK,uBAAuB,CAAAD,OAAK;AAClC,cAAM;AAAA,UACF,YAAYE;AAAA,UACZ,YAAYC;AAAA,UACZ,QAAQC;AAAA,QACV,IAAIJ,IACJ,IAAIE,OAAM,KAAK,KACf,IAAI,EAAE,IAAI,GACVG,KAAI,EAAE,IAAI,KAAK,EAAEH,IAAGC,IAAG,KAAK,UAAU,GACtCG,KAAI,EAAE,IAAI,KAAK,CAAC,EAAEJ,IAAG,KAAK,YAAY,IAAI;AAC5C,aAAK,KAAKG,MAAKC,MAAK,oBAAoB,QAAQ,KAAK,mBAAmBF,OAAM,KAAK,iBAAiBA;AAAA,MACtG,GAAG,KAAK,KAAK,EAAE,KAAK,MAAM;AACxB,aAAK,WAAW,EAAE,KAAK,kBAAkB,CAAC,GAAG,oBAAoB,QAAQ,KAAK,WAAW,EAAE,KAAK,oBAAoB,CAAC;AAAA,MACvH,GAAG,MAAM;AAAA,MAAC,CAAC;AAAA,IACb;AAAA,IACA,4BAA4BJ,IAAGE,IAAGC,IAAG;AACnC,aAAO,oBAAoB,QAAQ,KAAK,mBAAmBA,MAAK,EAAEH,IAAGE,EAAC;AAAA,IACxE;AAAA,EACF;AACA,SAAOE,KAAI,GAAG,EAAE,CAAC,EAAE,CAAC,GAAGC,GAAE,WAAW,sBAAsB,MAAM,GAAGA,KAAI,EAAE,CAACN,GAAE,iCAAiC,CAAC,GAAGM,EAAC,GAAGA;AACvH;",
  "names": ["o", "a", "t", "s", "e", "n", "i", "r", "a", "t", "c", "e", "i", "s", "o", "n", "l", "h", "r", "d"]
}
