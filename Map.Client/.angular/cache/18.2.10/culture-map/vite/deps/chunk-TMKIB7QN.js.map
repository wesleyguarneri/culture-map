{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/layers/save/utils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport { updateOrigins as t } from \"../../core/accessorSupport/originUtils.js\";\nimport r from \"../../portal/Portal.js\";\nimport o from \"../../portal/PortalItem.js\";\nimport { createForItemWrite as a } from \"../../portal/support/jsonContext.js\";\nimport { addTypeKeyword as i, typeKeyword as n } from \"../../portal/support/portalItemUtils.js\";\nimport { validateSaveAPIKey as s } from \"../../webdoc/support/saveAPIKeyUtils.js\";\nimport { evaluateWriteErrors as p } from \"../../webdoc/support/saveUtils.js\";\nfunction l(t, r, o) {\n  const a = o(t);\n  if (!a.isValid) throw new e(`${r}:invalid-parameters`, a.errorMessage, {\n    layer: t\n  });\n}\nasync function m(e) {\n  const {\n    layer: t,\n    errorNamePrefix: r,\n    validateLayer: o\n  } = e;\n  await t.load(), l(t, r, o);\n}\nfunction c(e, t) {\n  return `Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`;\n}\nfunction u(t) {\n  const {\n    item: r,\n    errorNamePrefix: o,\n    layer: a,\n    validateItem: i\n  } = t;\n  if (s(r), f(t), i) {\n    const t = i(r);\n    if (!t.isValid) throw new e(`${o}:invalid-parameters`, t.errorMessage, {\n      layer: a\n    });\n  }\n}\nfunction f(t) {\n  const {\n      item: r,\n      itemType: o,\n      additionalItemType: a,\n      errorNamePrefix: i,\n      layer: n\n    } = t,\n    s = [o];\n  if (a && s.push(a), !s.includes(r.type)) {\n    const t = s.map(e => `'${e}'`).join(\", \");\n    throw new e(`${i}:portal-item-wrong-type`, `Portal item type should be one of: \"${t}\"`, {\n      item: r,\n      layer: n\n    });\n  }\n}\nfunction d(t) {\n  const {\n      layer: r,\n      errorNamePrefix: o\n    } = t,\n    {\n      portalItem: a\n    } = r;\n  if (!a) throw new e(`${o}:portal-item-not-set`, c(r, \"requires the portalItem property to be set\"));\n  if (!a.loaded) throw new e(`${o}:portal-item-not-loaded`, c(r, \"cannot be saved to a portal item that does not exist or is inaccessible\"));\n  u({\n    ...t,\n    item: a\n  });\n}\nfunction y(e) {\n  const {\n    newItem: t,\n    itemType: a\n  } = e;\n  let i = o.from(t);\n  return i.id && (i = i.clone(), i.id = null), i.type ??= a, i.portal ??= r.getDefault(), u({\n    ...e,\n    item: i\n  }), i;\n}\nfunction w(e) {\n  return a(e, \"portal-item\");\n}\nasync function I(e, t, r) {\n  \"beforeSave\" in e && \"function\" == typeof e.beforeSave && (await e.beforeSave());\n  const o = e.write({}, t);\n  return await Promise.all(t.resources?.pendingOperations ?? []), p(t, {\n    errorName: \"layer-write:unsupported\"\n  }, r), o;\n}\nfunction v(e) {\n  i(e, n.JSAPI), e.typeKeywords && (e.typeKeywords = e.typeKeywords.filter((e, t, r) => r.indexOf(e) === t));\n}\nasync function P(e, t, r) {\n  const o = e.portal;\n  await o.signIn(), await o.user?.addItem({\n    item: e,\n    data: t,\n    folder: r?.folder\n  });\n}\nasync function $(e, r) {\n  const {\n    layer: o,\n    createItemData: a,\n    createJSONContext: i,\n    setItemProperties: n,\n    saveResources: s,\n    supplementalUnsupportedErrors: p\n  } = e;\n  await m(e), d(e);\n  const l = o.portalItem,\n    c = i ? i(l) : w(l),\n    u = await I(o, c, {\n      ...r,\n      supplementalUnsupportedErrors: p\n    }),\n    f = await a({\n      layer: o,\n      layerJSON: u\n    }, l);\n  return await n?.(o, l), v(l), await l.update({\n    data: f\n  }), t(c), await s?.(l, c), l;\n}\nasync function j(e, r) {\n  const {\n    layer: o,\n    createItemData: a,\n    createJSONContext: i,\n    setItemProperties: n,\n    saveResources: s,\n    supplementalUnsupportedErrors: p\n  } = e;\n  await m(e);\n  const l = y(e),\n    c = i ? i(l) : w(l),\n    u = await I(o, c, {\n      ...r,\n      supplementalUnsupportedErrors: p\n    }),\n    f = await a({\n      layer: o,\n      layerJSON: u\n    }, l);\n  return await n(o, l), v(l), await P(l, f, r), o.portalItem = l, t(c), await s?.(l, c), l;\n}\nexport { P as addItem, c as createErrorMessage, w as createJSONContextForWrite, d as ensureItemConfig, l as ensureLayerConfig, I as getLayerJSON, y as getPortalItem, $ as save, j as saveAs, v as setCommonItemProperties };"],
  "mappings": "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",
  "names": ["t", "o", "i", "f", "s", "e", "l", "c", "u"]
}
