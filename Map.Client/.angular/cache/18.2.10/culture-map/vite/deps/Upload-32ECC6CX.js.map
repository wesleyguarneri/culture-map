{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/widgets/Editor/Upload.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport r from \"../../core/Accessor.js\";\nimport { createTask as o } from \"../../core/asyncUtils.js\";\nimport s from \"../../core/Error.js\";\nimport { on as t } from \"../../core/events.js\";\nimport { throwIfAborted as i, createResolver as l } from \"../../core/promiseUtils.js\";\nimport { property as a } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/has.js\";\nimport \"../../core/Logger.js\";\nimport \"../../core/RandomLCG.js\";\nimport { subclass as n } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport p from \"../../geometry/Point.js\";\nimport { uploadProgressWeights as c } from \"../../layers/graphics/sources/support/uploadProgressWeights.js\";\nimport { getSupportedExtensions as u } from \"../../layers/support/infoFor3D.js\";\nimport { makeProgressManager as d, estimatedTransferTime as m } from \"../../support/progressUtils.js\";\nlet h = class extends r {\n  constructor() {\n    super({}), this.files = [], this.progress = 0, this._uploadTask = null, this._layer = null;\n  }\n  destroy() {\n    this.cancel(), this.files = [], this._layer = null, this._uploadTask = null;\n  }\n  get state() {\n    const e = this._uploadTask;\n    return e && 0 !== this.files.length ? e.finished ? e.error ? \"error\" : \"success\" : \"pending\" : \"default\";\n  }\n  get result() {\n    return this._uploadTask?.value ?? null;\n  }\n  get error() {\n    return this._uploadTask?.error ?? null;\n  }\n  uploadTo(e) {\n    this.cancel(), this.files = [], this._layer = e, this._uploadTask = o(async r => {\n      const o = await y(e);\n      i(r), this.progress = 0, this.files = o;\n      const t = d(c.upload, e => {\n        this.progress = e;\n      }, \"Upload.uploadTo\");\n      if (0 === o.length) return null;\n      i(r);\n      const l = await e.extractAndFilterFiles(o);\n      i(r), l.length > 0 && (this.files = l);\n      const a = new p({\n          x: 0,\n          y: 0,\n          z: 0,\n          spatialReference: e.spatialReference\n        }),\n        n = await e.convertMesh(l, {\n          location: a,\n          signal: r,\n          onProgress: t.makeOnProgress(\"createFromFiles\")\n        });\n      if (i(r), !n) throw new s(\"editor:upload\", \"could not upload or convert model\");\n      const u = l.reduce((e, r) => e + r.size, 0),\n        h = t.simulate(\"loadMesh\", m(u));\n      try {\n        await n.load();\n      } finally {\n        h.remove();\n      }\n      return n;\n    });\n  }\n  retry() {\n    this._layer && this.uploadTo(this._layer);\n  }\n  cancel() {\n    this._uploadTask?.abort();\n  }\n};\ne([a()], h.prototype, \"files\", void 0), e([a()], h.prototype, \"progress\", void 0), e([a()], h.prototype, \"state\", null), e([a()], h.prototype, \"result\", null), e([a()], h.prototype, \"error\", null), e([a()], h.prototype, \"_uploadTask\", void 0), e([a()], h.prototype, \"_layer\", void 0), h = e([n(\"esri.widgets.Editor.Upload\")], h);\nlet f = null;\nasync function y(e) {\n  const {\n      resolve: r,\n      promise: o\n    } = l(),\n    s = document.createElement(\"input\");\n  s.type = \"file\", s.multiple = !1, s.accept = [...u(e.infoFor3D), \".zip\"].join(\",\"), s.style.display = \"none\", document.body.appendChild(s);\n  const i = t(s, \"change\", () => r(s.files ? Array.from(s.files) : []));\n  return f ? f(s) : s.click(), o.finally(() => {\n    i.remove(), s.remove();\n  });\n}\nfunction g(e) {\n  f = r => {\n    Promise.resolve().then(() => e).then(e => {\n      if (!f) return;\n      const o = new DataTransfer();\n      e.forEach(e => o.items.add(e)), r.files = o.files, r.dispatchEvent(new Event(\"change\"));\n    });\n  };\n}\nfunction j() {\n  f = null;\n}\nexport { h as Upload, j as clearPromptForFilesStub, g as stubFilePickerToSelect };"],
  "mappings": "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",
  "names": ["h", "e", "o", "y", "s", "a", "r", "i"]
}
