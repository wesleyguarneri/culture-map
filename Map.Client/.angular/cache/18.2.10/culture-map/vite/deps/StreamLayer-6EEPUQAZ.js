import {
  l as l3
} from "./chunk-DSMB46HB.js";
import {
  c as c2
} from "./chunk-USSQX44O.js";
import "./chunk-OTI4DGZ5.js";
import "./chunk-KQDYTHCF.js";
import {
  c
} from "./chunk-JKHDI77M.js";
import "./chunk-3AY5EJVP.js";
import "./chunk-XQCKIDQO.js";
import {
  s as s3
} from "./chunk-BNK4CEA6.js";
import {
  C,
  l as l4
} from "./chunk-6LDLRQX4.js";
import {
  l as l5
} from "./chunk-Z4YAQ5JI.js";
import "./chunk-K2XCQKCC.js";
import "./chunk-AJS4B62I.js";
import {
  p as p2
} from "./chunk-S5EXT7FA.js";
import {
  e as e2
} from "./chunk-73Y7XDLH.js";
import {
  m,
  o as o4,
  u as u2
} from "./chunk-YFOAET4H.js";
import "./chunk-5U4TBXYS.js";
import "./chunk-6WG22V46.js";
import "./chunk-OOGIXDXG.js";
import {
  U as U2
} from "./chunk-JFYQTYD3.js";
import "./chunk-KDJZAYOF.js";
import "./chunk-5453A3C5.js";
import "./chunk-HCFDI7IX.js";
import "./chunk-AQJS6F3O.js";
import "./chunk-WUB6LJVL.js";
import "./chunk-QXSES7JX.js";
import "./chunk-YPU2P4KO.js";
import "./chunk-2SMFPIRI.js";
import "./chunk-2GMKFOCL.js";
import "./chunk-ZR5BOILP.js";
import "./chunk-QCBC3RJX.js";
import "./chunk-63QCTVYB.js";
import "./chunk-U74WRHVJ.js";
import "./chunk-TCPN7AEH.js";
import {
  b as b2
} from "./chunk-TRSGUVSM.js";
import "./chunk-U3MA63JX.js";
import "./chunk-WYKKCLBI.js";
import {
  y as y2
} from "./chunk-PFMGJTQM.js";
import "./chunk-Q7SRMLJZ.js";
import "./chunk-PQ4T66BG.js";
import "./chunk-SWPHGZYB.js";
import "./chunk-DWASPXVI.js";
import "./chunk-TNWXOQKO.js";
import "./chunk-MAO5BVLA.js";
import "./chunk-T2S5VXNP.js";
import "./chunk-4U5GUJRA.js";
import "./chunk-7KRERHHR.js";
import "./chunk-T4AP6CTC.js";
import "./chunk-HD65DNIO.js";
import {
  k as k2
} from "./chunk-4KWLMXIA.js";
import "./chunk-BIUXKPKA.js";
import "./chunk-N6TJI25E.js";
import "./chunk-634JLXD4.js";
import "./chunk-Y3EDGYWG.js";
import "./chunk-UF6JOUSJ.js";
import "./chunk-T5JGQSO3.js";
import {
  i
} from "./chunk-CIW3KHOW.js";
import "./chunk-J55F4AC2.js";
import "./chunk-IQLBZKUD.js";
import "./chunk-7MZZCQ64.js";
import "./chunk-JOJZ6YC5.js";
import "./chunk-L4TOCXR5.js";
import "./chunk-IMVP5ADD.js";
import "./chunk-H7WPOTQH.js";
import {
  t as t2
} from "./chunk-RTWBKPWJ.js";
import {
  A
} from "./chunk-ZZEAVAVX.js";
import {
  j as j2
} from "./chunk-SJX5DIA7.js";
import "./chunk-6A7CWJED.js";
import "./chunk-LFKEQKEA.js";
import "./chunk-DUTZNK67.js";
import "./chunk-IN6BQCWS.js";
import "./chunk-CRNUMTSV.js";
import "./chunk-JM7HAEY6.js";
import {
  f as f4
} from "./chunk-DOK4SACJ.js";
import {
  l
} from "./chunk-OUKUASAF.js";
import "./chunk-V5RMUGJJ.js";
import "./chunk-D2NB6D6N.js";
import {
  t as t3
} from "./chunk-UWJIHV6Q.js";
import {
  b
} from "./chunk-ZUSCOMQM.js";
import {
  j,
  l as l2,
  p,
  s as s2,
  t,
  u,
  y as y3
} from "./chunk-DSEUCBVP.js";
import "./chunk-UPDWQH75.js";
import {
  S
} from "./chunk-RXWBJSJ5.js";
import {
  f as f3
} from "./chunk-M2NS3MSU.js";
import {
  h
} from "./chunk-HMNBB7ED.js";
import "./chunk-3RRMLFFN.js";
import "./chunk-DR5TVNEL.js";
import "./chunk-HT2T6PUB.js";
import "./chunk-K64AAM77.js";
import "./chunk-6EUVKE22.js";
import "./chunk-A3NNJ7XA.js";
import "./chunk-OKJHJ3CY.js";
import "./chunk-XTVPEVHA.js";
import {
  g,
  p as p3
} from "./chunk-DTUSTSEJ.js";
import "./chunk-JCWFGRHQ.js";
import "./chunk-JILEJ6R2.js";
import "./chunk-GAW5JHG4.js";
import {
  o as o3
} from "./chunk-OEKKQXBD.js";
import "./chunk-S3IO7V4Q.js";
import "./chunk-DZALMCYL.js";
import "./chunk-K226GFDN.js";
import "./chunk-4ZZRP4MA.js";
import "./chunk-7ZJ6P7J7.js";
import "./chunk-FPFZQCEQ.js";
import "./chunk-YVULORT6.js";
import "./chunk-PB33BAI3.js";
import "./chunk-CVB43GGP.js";
import "./chunk-EODIWR2E.js";
import "./chunk-LLDOZWVV.js";
import "./chunk-FYAEQPUY.js";
import "./chunk-7XMEZQ34.js";
import "./chunk-BDM2D6IC.js";
import "./chunk-U2ZVAEKG.js";
import "./chunk-EDSMXTFO.js";
import "./chunk-MNLT652N.js";
import "./chunk-OGZAGPIO.js";
import "./chunk-HJJIIYFF.js";
import "./chunk-7RMVJCDW.js";
import "./chunk-T6GCUITX.js";
import "./chunk-TUIGM7TV.js";
import "./chunk-IHVSZYZS.js";
import "./chunk-6CA6K3O7.js";
import {
  w
} from "./chunk-NYQ5CYNR.js";
import "./chunk-O7UDKFOW.js";
import {
  f as f2
} from "./chunk-TKPMIAIW.js";
import {
  o as o2
} from "./chunk-NQOJNTB3.js";
import "./chunk-MFOQYQFG.js";
import "./chunk-NKCPFCP3.js";
import "./chunk-3ZXOUEQG.js";
import "./chunk-AXVPJBVW.js";
import "./chunk-OXEPWRM7.js";
import "./chunk-POILQGXA.js";
import "./chunk-JJS7PR2U.js";
import "./chunk-L5YS4GSA.js";
import "./chunk-PRREDSOB.js";
import "./chunk-V5C6HSAM.js";
import {
  U
} from "./chunk-SYATLP3H.js";
import {
  f
} from "./chunk-V6AMQYXE.js";
import "./chunk-6WHTZNUH.js";
import "./chunk-EITGQLII.js";
import "./chunk-TIVJXVMN.js";
import "./chunk-XNUH25NY.js";
import "./chunk-WGAPNV7F.js";
import "./chunk-BXQGM56A.js";
import {
  e
} from "./chunk-4Z5SGKRM.js";
import "./chunk-ANKOCGE2.js";
import {
  y
} from "./chunk-7CJXZOFG.js";
import "./chunk-IRGZKO7V.js";
import "./chunk-5SELS7VU.js";
import {
  N,
  a3
} from "./chunk-DDYVXG4F.js";
import "./chunk-ANP42J2U.js";
import {
  a as a2,
  k
} from "./chunk-HJY2YILU.js";
import {
  o
} from "./chunk-7DA6A5LD.js";
import "./chunk-2MMLMOWS.js";
import "./chunk-4323ZVPF.js";
import {
  a,
  n2 as n,
  s2 as s
} from "./chunk-WYIDUUN2.js";
import "./chunk-DXLOWWK7.js";
import {
  __async,
  __spreadValues
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/layers/support/PurgeOptions.js
var t4;
var i2 = t4 = class extends f {
  constructor() {
    super(...arguments), this.age = null, this.ageReceived = null, this.displayCount = null, this.maxObservations = 1;
  }
  clone() {
    return new t4({
      age: this.age,
      ageReceived: this.ageReceived,
      displayCount: this.displayCount,
      maxObservations: this.maxObservations
    });
  }
};
e([y({
  type: Number,
  json: {
    write: true
  }
})], i2.prototype, "age", void 0), e([y({
  type: Number,
  json: {
    write: true
  }
})], i2.prototype, "ageReceived", void 0), e([y({
  type: Number,
  json: {
    write: true
  }
})], i2.prototype, "displayCount", void 0), e([y({
  type: Number,
  json: {
    write: true
  }
})], i2.prototype, "maxObservations", void 0), i2 = t4 = e([a3("esri.layers.support.PurgeOptions")], i2);
var p4 = i2;

// ../../../node_modules/@arcgis/core/layers/StreamLayer.js
var Y = s3();
function Z(e3, t5) {
  return new s("layer:unsupported", `Layer (${e3.title}, ${e3.id}) of type '${e3.declaredClass}' ${t5}`, {
    layer: e3
  });
}
var ee = class extends c2(c(l(l5(t3(f4(l3(b(j2(S(e2(i(f3)))))))))))) {
  constructor(...e3) {
    super(...e3), this.copyright = null, this.definitionExpression = null, this.displayField = null, this.elevationInfo = null, this.fields = null, this.fieldsIndex = null, this.geometryDefinition = null, this.geometryType = null, this.labelsVisible = true, this.labelingInfo = null, this.legendEnabled = true, this.maxReconnectionAttempts = 0, this.maxReconnectionInterval = 20, this.maxScale = 0, this.minScale = 0, this.objectIdField = null, this.operationalLayerType = "ArcGISStreamLayer", this.outFields = ["*"], this.popupEnabled = true, this.popupTemplate = null, this.purgeOptions = new p4(), this.refreshInterval = 0, this.screenSizePerspectiveEnabled = true, this.sourceJSON = null, this.spatialReference = f2.WGS84, this.type = "stream", this.url = null, this.updateInterval = 300, this.useViewTime = true, this.webSocketUrl = null, this._debouncedSaveOperations = k((e4, t5, r) => __async(this, null, function* () {
      const {
        save: i3,
        saveAs: o5
      } = yield import("./streamLayerUtils-MJZ7MOA7.js");
      switch (e4) {
        case A.SAVE:
          return i3(this, t5);
        case A.SAVE_AS:
          return o5(this, r, t5);
      }
    }));
  }
  normalizeCtorArgs(e3, t5) {
    return "string" == typeof e3 ? __spreadValues({
      url: e3
    }, t5) : e3;
  }
  load(e3) {
    if (!("WebSocket" in globalThis)) return this.addResolvingPromise(Promise.reject(new s("stream-layer:websocket-unsupported", "WebSocket is not supported in this browser. StreamLayer will not have real-time connection with the stream service."))), Promise.resolve(this);
    const t5 = null != e3 ? e3.signal : null;
    return this.addResolvingPromise(this.loadFromPortal({
      supportedTypes: ["Stream Service", "Feed"]
    }, e3).catch(a2).then(() => this._fetchService(t5))), Promise.resolve(this);
  }
  get defaultPopupTemplate() {
    return this.createPopupTemplate();
  }
  set featureReduction(e3) {
    const t5 = this._normalizeFeatureReduction(e3);
    this._set("featureReduction", t5);
  }
  set renderer(e3) {
    p3(e3, this.fieldsIndex), this._set("renderer", e3);
  }
  readRenderer(e3, t5, i3) {
    t5 = t5.layerDefinition || t5;
    const o5 = t5.drawingInfo?.renderer;
    if (o5) {
      const e4 = o4(o5, t5, i3) || void 0;
      return e4 || n.getLogger(this).error("Failed to create renderer", {
        rendererDefinition: t5.drawingInfo.renderer,
        layer: this,
        context: i3
      }), e4;
    }
    return U2(t5, i3);
  }
  connect(e3) {
    return __async(this, null, function* () {
      const [{
        createConnection: t5
      }] = yield Promise.all([import("./createConnection-UM5KLTPD.js"), this.load()]), r = this.geometryType ? o3.toJSON(this.geometryType) : null, {
        customParameters: i3 = null,
        definitionExpression: o5 = null,
        geometryDefinition: s4 = null,
        maxReconnectionAttempts: n2 = 0,
        maxReconnectionInterval: a4 = 20,
        spatialReference: l6 = this.spatialReference
      } = e3 || this.createConnectionParameters(), d = t5(this.parsedUrl, this.spatialReference, l6, r, o5, s4, n2, a4, i3 ?? void 0), m2 = o([this.on("send-message-to-socket", (e4) => d.sendMessageToSocket(e4)), this.on("send-message-to-client", (e4) => d.sendMessageToClient(e4))]);
      return d.once("destroy", m2.remove), d;
    });
  }
  createConnectionParameters() {
    return {
      spatialReference: this.spatialReference,
      customParameters: this.customParameters,
      definitionExpression: this.definitionExpression,
      geometryDefinition: this.geometryDefinition,
      maxReconnectionAttempts: this.maxReconnectionAttempts,
      maxReconnectionInterval: this.maxReconnectionInterval
    };
  }
  createPopupTemplate(e3) {
    return p2(this, e3);
  }
  createQuery() {
    const e3 = new b2();
    return e3.returnGeometry = true, e3.outFields = ["*"], e3.where = this.definitionExpression || "1=1", e3;
  }
  getFieldDomain(e3, t5) {
    if (!this.fields) return null;
    let r = null;
    return this.fields.some((t6) => (t6.name === e3 && (r = t6.domain), !!r)), r;
  }
  getField(e3) {
    return this.fieldsIndex.get(e3);
  }
  serviceSupportsSpatialReference(e3) {
    return true;
  }
  sendMessageToSocket(e3) {
    this.emit("send-message-to-socket", e3);
  }
  sendMessageToClient(e3) {
    this.emit("send-message-to-client", e3);
  }
  save(e3) {
    return __async(this, null, function* () {
      return this._debouncedSaveOperations(A.SAVE, e3);
    });
  }
  saveAs(e3, t5) {
    return __async(this, null, function* () {
      return this._debouncedSaveOperations(A.SAVE_AS, t5, e3);
    });
  }
  write(e3, t5) {
    const r = t5?.messages;
    return this.webSocketUrl ? (r?.push(Z(this, "using a custom websocket connection cannot be written to web scenes and web maps")), null) : this.parsedUrl ? super.write(e3, t5) : (r?.push(Z(this, "using a client-side only connection without a url cannot be written to web scenes and web maps")), null);
  }
  _fetchService(e3) {
    return __async(this, null, function* () {
      if (!!!this.webSocketUrl && this.parsedUrl) {
        if (!this.sourceJSON) {
          const {
            data: t5
          } = yield U(this.parsedUrl.path, {
            query: __spreadValues(__spreadValues({
              f: "json"
            }, this.customParameters), this.parsedUrl.query),
            responseType: "json",
            signal: e3
          });
          this.sourceJSON = t5;
        }
      } else {
        if (!this.timeInfo?.trackIdField) throw new s("stream-layer:missing-metadata", "The stream layer trackIdField must be specified.");
        if (!this.objectIdField) {
          const e4 = this.fields.find((e5) => "oid" === e5.type)?.name;
          if (!e4) throw new s("stream-layer:missing-metadata", "The stream layer objectIdField must be specified.");
          this.objectIdField = e4;
        }
        if (!this.fields) throw new s("stream-layer:missing-metadata", "The stream layer fields must be specified.");
        if (this.fields.some((e4) => e4.name === this.objectIdField) || this.fields.push(new y2({
          name: this.objectIdField,
          alias: this.objectIdField,
          type: "oid"
        })), !this.geometryType) throw new s("stream-layer:missing-metadata", "The stream layer geometryType must be specified.");
        this.webSocketUrl && (this.url = this.webSocketUrl);
      }
      return this.read(this.sourceJSON, {
        origin: "service",
        portalItem: this.portalItem,
        portal: this.portalItem?.portal,
        url: this.parsedUrl
      }), p3(this.renderer, this.fieldsIndex), g(this.timeInfo, this.fieldsIndex), this.objectIdField || (this.objectIdField = "__esri_stream_id__"), t2(this, {
        origin: "service"
      });
    });
  }
};
e([y({
  type: String
})], ee.prototype, "copyright", void 0), e([y({
  readOnly: true
})], ee.prototype, "defaultPopupTemplate", null), e([y({
  type: String,
  json: {
    name: "layerDefinition.definitionExpression",
    write: {
      enabled: true,
      allowNull: true
    }
  }
})], ee.prototype, "definitionExpression", void 0), e([y({
  type: String
})], ee.prototype, "displayField", void 0), e([y({
  type: h
})], ee.prototype, "elevationInfo", void 0), e([y({
  json: {
    origins: {
      "web-map": {
        read: false,
        write: false
      },
      "portal-item": {
        read: false,
        write: false
      },
      "web-scene": {
        read: false,
        write: false
      }
    }
  }
})], ee.prototype, "featureReduction", null), e([y(Y.fields)], ee.prototype, "fields", void 0), e([y(Y.fieldsIndex)], ee.prototype, "fieldsIndex", void 0), e([y({
  type: w,
  json: {
    name: "layerDefinition.definitionGeometry",
    write: true
  }
})], ee.prototype, "geometryDefinition", void 0), e([y({
  type: o3.apiValues,
  json: {
    read: {
      reader: o3.read
    }
  }
})], ee.prototype, "geometryType", void 0), e([y(l2)], ee.prototype, "labelsVisible", void 0), e([y({
  type: [C],
  json: {
    name: "layerDefinition.drawingInfo.labelingInfo",
    read: {
      reader: l4
    },
    write: true
  }
})], ee.prototype, "labelingInfo", void 0), e([y(y3)], ee.prototype, "legendEnabled", void 0), e([y({
  type: ["show", "hide"],
  json: {
    origins: {
      "portal-item": {
        read: false,
        write: false
      }
    }
  }
})], ee.prototype, "listMode", void 0), e([y({
  type: N
})], ee.prototype, "maxReconnectionAttempts", void 0), e([y({
  type: N
})], ee.prototype, "maxReconnectionInterval", void 0), e([y(j)], ee.prototype, "maxScale", void 0), e([y(u)], ee.prototype, "minScale", void 0), e([y({
  type: String
})], ee.prototype, "objectIdField", void 0), e([y({
  value: "ArcGISStreamLayer",
  type: ["ArcGISStreamLayer"]
})], ee.prototype, "operationalLayerType", void 0), e([y({
  readOnly: true
})], ee.prototype, "outFields", void 0), e([y(s2)], ee.prototype, "popupEnabled", void 0), e([y({
  type: k2,
  json: {
    name: "popupInfo",
    write: true
  }
})], ee.prototype, "popupTemplate", void 0), e([y({
  type: p4
})], ee.prototype, "purgeOptions", void 0), e([y({
  json: {
    read: false,
    write: false
  }
})], ee.prototype, "refreshInterval", void 0), e([y({
  types: m,
  json: {
    origins: {
      service: {
        write: {
          target: "drawingInfo.renderer",
          enabled: false
        }
      },
      "web-scene": {
        name: "layerDefinition.drawingInfo.renderer",
        types: u2,
        write: true
      }
    },
    write: {
      target: "layerDefinition.drawingInfo.renderer"
    }
  }
})], ee.prototype, "renderer", null), e([o2("service", "renderer", ["drawingInfo.renderer", "defaultSymbol"]), o2("renderer", ["layerDefinition.drawingInfo.renderer", "layerDefinition.defaultSymbol"])], ee.prototype, "readRenderer", null), e([y((() => {
  const e3 = a(t);
  return e3.json.origins["portal-item"] = {
    read: false,
    write: false
  }, e3;
})())], ee.prototype, "screenSizePerspectiveEnabled", void 0), e([y()], ee.prototype, "sourceJSON", void 0), e([y({
  type: f2,
  json: {
    origins: {
      service: {
        read: {
          source: "spatialReference"
        }
      }
    }
  }
})], ee.prototype, "spatialReference", void 0), e([y({
  json: {
    read: false
  }
})], ee.prototype, "type", void 0), e([y(p)], ee.prototype, "url", void 0), e([y({
  type: Number
})], ee.prototype, "updateInterval", void 0), e([y({
  json: {
    read: false,
    write: false
  }
})], ee.prototype, "useViewTime", void 0), e([y({
  type: String
})], ee.prototype, "webSocketUrl", void 0), ee = e([a3("esri.layers.StreamLayer")], ee);
var te = ee;
export {
  te as default
};
//# sourceMappingURL=StreamLayer-6EEPUQAZ.js.map
