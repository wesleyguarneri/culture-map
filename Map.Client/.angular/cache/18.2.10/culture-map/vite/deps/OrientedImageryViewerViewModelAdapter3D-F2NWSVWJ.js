import {
  E3 as E,
  L,
  M2 as M,
  N,
  b as b2,
  u
} from "./chunk-EGCRHOVQ.js";
import "./chunk-6PMC7Z2K.js";
import "./chunk-DABQKFI5.js";
import "./chunk-AMEKD7JM.js";
import "./chunk-ANZPTCB4.js";
import "./chunk-6562L2GA.js";
import "./chunk-SBTROJY3.js";
import "./chunk-ZUHJZKEM.js";
import "./chunk-B4EEJXBQ.js";
import "./chunk-TXBBE7ID.js";
import "./chunk-BB54E5CP.js";
import "./chunk-4DJIV2NV.js";
import "./chunk-CX4XTOUC.js";
import "./chunk-SXUHX735.js";
import "./chunk-Q77FSDLB.js";
import "./chunk-Y37SHKPH.js";
import "./chunk-T64NGWGJ.js";
import "./chunk-SRFJDSP2.js";
import "./chunk-RTZ7XMXL.js";
import {
  $
} from "./chunk-EUVN3KSV.js";
import "./chunk-WBOVDU4O.js";
import "./chunk-TQYVLRAH.js";
import "./chunk-6A3XUATG.js";
import "./chunk-WX42XBL6.js";
import "./chunk-YZI2XBXY.js";
import "./chunk-WBUJP5OW.js";
import "./chunk-TVV62TZG.js";
import {
  l
} from "./chunk-ZNDAVKXT.js";
import "./chunk-C2NHN5LF.js";
import "./chunk-OHXCVJMH.js";
import "./chunk-MD2IQSSQ.js";
import "./chunk-L3F4XA4B.js";
import "./chunk-2AV27Q4X.js";
import "./chunk-3HU4B6P4.js";
import "./chunk-5AUX2A3J.js";
import "./chunk-OUP4PSAG.js";
import "./chunk-WU7FVYT7.js";
import "./chunk-6V5NKLIC.js";
import "./chunk-CZQYBYHB.js";
import "./chunk-Q5ZRUB2Y.js";
import "./chunk-2XI572KI.js";
import "./chunk-R4P4UBKU.js";
import "./chunk-62WUYJJN.js";
import "./chunk-AWJPQWYU.js";
import "./chunk-JNWMZ6EJ.js";
import "./chunk-VS26W5Y5.js";
import "./chunk-LM2N2I5R.js";
import "./chunk-ZQ57XGAE.js";
import "./chunk-UXW277HY.js";
import "./chunk-OR5F5ACQ.js";
import "./chunk-E2WAKNLZ.js";
import "./chunk-Z3GMSC63.js";
import "./chunk-F35MWZH7.js";
import "./chunk-ED7UGR2X.js";
import "./chunk-YA5CTHMT.js";
import "./chunk-4QBFFLOC.js";
import "./chunk-O437BSYE.js";
import "./chunk-YZNT6QWD.js";
import "./chunk-C3UDKWXD.js";
import "./chunk-N3IR233K.js";
import "./chunk-DSMB46HB.js";
import "./chunk-Z4YAQ5JI.js";
import "./chunk-K2XCQKCC.js";
import "./chunk-AJS4B62I.js";
import "./chunk-S5EXT7FA.js";
import "./chunk-73Y7XDLH.js";
import "./chunk-OOGIXDXG.js";
import "./chunk-5453A3C5.js";
import "./chunk-AQJS6F3O.js";
import "./chunk-WUB6LJVL.js";
import "./chunk-QXSES7JX.js";
import "./chunk-5YIMTGEC.js";
import "./chunk-YPU2P4KO.js";
import "./chunk-UFVMJL32.js";
import "./chunk-B67FUUE5.js";
import "./chunk-ZE47C44H.js";
import "./chunk-5GIS2C3K.js";
import "./chunk-XCOHDMBF.js";
import "./chunk-ZR5BOILP.js";
import "./chunk-QCBC3RJX.js";
import "./chunk-6XGV55XZ.js";
import "./chunk-HOH445RO.js";
import "./chunk-63QCTVYB.js";
import "./chunk-ZWCV4HKG.js";
import "./chunk-N4KQPPPI.js";
import "./chunk-4OGGMTIH.js";
import "./chunk-NQVBBKAN.js";
import "./chunk-U74WRHVJ.js";
import "./chunk-TCPN7AEH.js";
import "./chunk-DY7FJHTG.js";
import "./chunk-Q4KYZS3X.js";
import "./chunk-KVKFHRJ3.js";
import "./chunk-VWML4J2J.js";
import "./chunk-JYODC3YQ.js";
import "./chunk-BQZBOYBD.js";
import "./chunk-TYQXPPSP.js";
import "./chunk-W2IRSMFY.js";
import "./chunk-TRSGUVSM.js";
import "./chunk-U3MA63JX.js";
import "./chunk-WYKKCLBI.js";
import "./chunk-PFMGJTQM.js";
import "./chunk-Q7SRMLJZ.js";
import "./chunk-PQ4T66BG.js";
import "./chunk-SWPHGZYB.js";
import "./chunk-DWASPXVI.js";
import "./chunk-TNWXOQKO.js";
import "./chunk-MAO5BVLA.js";
import "./chunk-T2S5VXNP.js";
import "./chunk-4U5GUJRA.js";
import "./chunk-7KRERHHR.js";
import "./chunk-T4AP6CTC.js";
import {
  d
} from "./chunk-HD65DNIO.js";
import "./chunk-4KWLMXIA.js";
import "./chunk-BIUXKPKA.js";
import "./chunk-N6TJI25E.js";
import "./chunk-634JLXD4.js";
import "./chunk-Y3EDGYWG.js";
import "./chunk-UF6JOUSJ.js";
import "./chunk-T5JGQSO3.js";
import "./chunk-CIW3KHOW.js";
import "./chunk-J55F4AC2.js";
import "./chunk-IQLBZKUD.js";
import "./chunk-7MZZCQ64.js";
import "./chunk-MIQZ6UDY.js";
import "./chunk-IMVP5ADD.js";
import "./chunk-H7WPOTQH.js";
import "./chunk-ZZEAVAVX.js";
import "./chunk-SJX5DIA7.js";
import "./chunk-6A7CWJED.js";
import "./chunk-LFKEQKEA.js";
import {
  I
} from "./chunk-DUTZNK67.js";
import "./chunk-IN6BQCWS.js";
import "./chunk-MKJUISEU.js";
import "./chunk-CRNUMTSV.js";
import "./chunk-JM7HAEY6.js";
import "./chunk-YI35FRTC.js";
import "./chunk-LJEOBI2I.js";
import "./chunk-2OMCGIU4.js";
import "./chunk-DOK4SACJ.js";
import "./chunk-OUKUASAF.js";
import "./chunk-V5RMUGJJ.js";
import "./chunk-D2NB6D6N.js";
import "./chunk-UWJIHV6Q.js";
import "./chunk-ZUSCOMQM.js";
import "./chunk-DSEUCBVP.js";
import "./chunk-UPDWQH75.js";
import "./chunk-RXWBJSJ5.js";
import "./chunk-M2NS3MSU.js";
import "./chunk-HMNBB7ED.js";
import "./chunk-3RRMLFFN.js";
import "./chunk-DR5TVNEL.js";
import "./chunk-HT2T6PUB.js";
import "./chunk-K64AAM77.js";
import "./chunk-6EUVKE22.js";
import "./chunk-A3NNJ7XA.js";
import "./chunk-OKJHJ3CY.js";
import "./chunk-XTVPEVHA.js";
import "./chunk-DTUSTSEJ.js";
import "./chunk-JCWFGRHQ.js";
import "./chunk-JILEJ6R2.js";
import "./chunk-GAW5JHG4.js";
import "./chunk-OEKKQXBD.js";
import "./chunk-S3IO7V4Q.js";
import "./chunk-DZALMCYL.js";
import "./chunk-K226GFDN.js";
import "./chunk-4ZZRP4MA.js";
import "./chunk-7ZJ6P7J7.js";
import "./chunk-FPFZQCEQ.js";
import "./chunk-YVULORT6.js";
import "./chunk-PB33BAI3.js";
import "./chunk-CVB43GGP.js";
import "./chunk-EODIWR2E.js";
import "./chunk-LLDOZWVV.js";
import "./chunk-FYAEQPUY.js";
import "./chunk-7XMEZQ34.js";
import "./chunk-BDM2D6IC.js";
import "./chunk-U2ZVAEKG.js";
import "./chunk-EDSMXTFO.js";
import "./chunk-MNLT652N.js";
import "./chunk-OGZAGPIO.js";
import "./chunk-HJJIIYFF.js";
import "./chunk-7RMVJCDW.js";
import "./chunk-T6GCUITX.js";
import "./chunk-TUIGM7TV.js";
import "./chunk-IHVSZYZS.js";
import "./chunk-6CA6K3O7.js";
import "./chunk-NYQ5CYNR.js";
import {
  _
} from "./chunk-O7UDKFOW.js";
import "./chunk-TKPMIAIW.js";
import "./chunk-NQOJNTB3.js";
import "./chunk-MFOQYQFG.js";
import "./chunk-NKCPFCP3.js";
import "./chunk-3ZXOUEQG.js";
import "./chunk-AXVPJBVW.js";
import "./chunk-OXEPWRM7.js";
import "./chunk-POILQGXA.js";
import "./chunk-JJS7PR2U.js";
import "./chunk-L5YS4GSA.js";
import "./chunk-PRREDSOB.js";
import "./chunk-V5C6HSAM.js";
import "./chunk-SYATLP3H.js";
import "./chunk-V6AMQYXE.js";
import "./chunk-6WHTZNUH.js";
import "./chunk-EITGQLII.js";
import "./chunk-TIVJXVMN.js";
import "./chunk-XNUH25NY.js";
import "./chunk-WGAPNV7F.js";
import "./chunk-BXQGM56A.js";
import "./chunk-4Z5SGKRM.js";
import "./chunk-ANKOCGE2.js";
import "./chunk-7CJXZOFG.js";
import "./chunk-IRGZKO7V.js";
import "./chunk-5SELS7VU.js";
import {
  b
} from "./chunk-DDYVXG4F.js";
import "./chunk-ANP42J2U.js";
import {
  D,
  s
} from "./chunk-HJY2YILU.js";
import "./chunk-7DA6A5LD.js";
import "./chunk-2MMLMOWS.js";
import "./chunk-4323ZVPF.js";
import "./chunk-WYIDUUN2.js";
import {
  O
} from "./chunk-DXLOWWK7.js";
import {
  __async
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/widgets/OrientedImageryViewer/adapters/OrientedImageryViewerViewModelAdapter3D.js
var w = class {
  constructor(g) {
    this.viewModel = g, this.createFootprints = (r) => __async(this, null, function* () {
      const {
        coverageFrustums: o,
        currentBestFeature: c,
        isAdditionalCoverageVisible: m,
        view: p
      } = this.viewModel, g2 = o.filter(O);
      for (const t of g2) {
        let o2 = t.clone();
        if (!p.spatialReference.equals(o2.spatialReference)) {
          const {
            components: e,
            spatialReference: t2,
            origin: c2,
            vertexAttributes: m2,
            vertexSpace: u2
          } = o2;
          if ("local" === u2.type) {
            const e2 = yield I(c2, p.spatialReference, r);
            s(r), o2.centerAt(e2);
          } else {
            const s2 = m2.position, c3 = Float64Array.from(yield N([...s2], t2.clone(), p.spatialReference.clone(), r));
            s(r), o2 = new $({
              vertexAttributes: new l({
                position: c3
              }),
              components: e,
              spatialReference: p.spatialReference.clone()
            });
          }
        }
        t.imageID === c.attributes.objectId ? this.viewModel.bestFeatureFootprint = new d({
          attributes: {
            imageID: t.imageID
          },
          geometry: o2,
          symbol: u.clone(),
          visible: false
        }) : this.viewModel.additionalFootprints.push(new d({
          attributes: {
            imageID: t.imageID
          },
          geometry: o2,
          symbol: M.clone(),
          visible: m
        }));
      }
    }), this.updateFootprint = (r, n) => __async(this, null, function* () {
      const {
        currentBestFeature: l2,
        imagePointsInView: m,
        activeViewer: f,
        footprintExtent: g2,
        view: w2
      } = this.viewModel, y = b($, this.viewModel.getCurrentBestFeaturePolygon().geometry), h = f?.imageSize;
      if (!(l2 && y && m && h && g2)) return;
      const {
        cameraHeight: v,
        location: b3,
        cameraPitch: F,
        horizontalFieldOfView: R,
        verticalFieldOfView: j,
        cameraRoll: M2,
        imageRotation: V
      } = l2.attributes, I2 = b3.toArray(), {
        vertexAttributes: {
          position: A
        },
        spatialReference: P
      } = y, x = yield d2(A, P, b3.spatialReference), z = yield E(r, {
        feature: l2,
        imageProperties: {
          width: h[0],
          height: h[1]
        },
        options: n,
        footprintExtent: g2
      });
      s(n);
      let C = z.filter(O);
      if (!C.length) return;
      C[0].spatialReference.equals(b3.spatialReference) || (C = yield Promise.all(C.map((e) => __async(this, null, function* () {
        const t = yield I(e, b3.spatialReference, n);
        return s(n), t;
      }))));
      const O2 = yield L(m.slice(0, 4).map(({
        x: e,
        y: t
      }) => [e, t]), C.slice(0, 4).map((e) => e.toArray()), {
        cameraHeight: v,
        cameraLocation: I2,
        cameraPitch: F,
        frustumVertices: x,
        horizontalFieldOfView: R,
        imageHeight: h[1],
        imageWidth: h[0],
        inSRS: {
          wkid: b3.spatialReference.wkid
        },
        outSRS: {
          wkid: w2.spatialReference.wkid
        },
        verticalFieldOfView: j,
        cameraRoll: M2 ?? 0,
        imageRotation: V ?? 0,
        options: n
      });
      this.viewModel.updateCurrentCoveragePolygon(new d({
        attributes: {
          imageID: l2.attributes.objectId
        },
        geometry: O2,
        symbol: u.clone(),
        visible: this.viewModel.currentCoverageVisible
      }));
    }), this.updateFootprintPanorama = (t, i) => __async(this, null, function* () {
      yield D(i);
      const {
        horizontalFieldOfView: o,
        pitch: a,
        verticalFieldOfView: s2,
        yaw: n
      } = t, l2 = this.viewModel.currentBestFeature?.clone();
      if (!l2) return;
      const {
        attributes: c
      } = l2;
      c.orientedImageryType = null, c.cameraHeading = (n + c.cameraHeading) % 360, c.cameraPitch = a, c.horizontalFieldOfView = o, c.verticalFieldOfView = s2, c.cameraRoll = 0;
      const {
        frustum: p
      } = b2(c);
      p && this.viewModel.updateCurrentCoveragePolygon(new d({
        attributes: {
          imageID: c.objectId
        },
        geometry: p,
        symbol: u.clone(),
        visible: this.viewModel.currentCoverageVisible
      }));
    });
  }
  updateGroundElevation(e, t) {
    const {
      geometry: i
    } = this.viewModel.currentBestFeature, r = t.queryElevation(i);
    e.forEach((e2) => {
      const {
        geometry: t2
      } = e2;
      switch (t2?.type) {
        case "mesh": {
          const {
            vertexAttributes: {
              position: e3
            }
          } = t2, i2 = Math.floor(e3.length / 3);
          for (let t3 = 0; t3 < i2; t3 += 1) e3[3 * t3 + 2] += r?.z ?? 0;
          break;
        }
        case "point":
          t2.z = (t2.z ?? 0) + (r?.z ?? 0);
      }
    });
  }
};
function d2(e, t, i, r) {
  return __async(this, null, function* () {
    return Float64Array.from((yield Promise.all(e.reduce((e2, t2, i2) => {
      const r2 = Math.floor(i2 / 3);
      return e2[r2] = e2[r2] ?? [], e2[r2].push(t2), e2;
    }, new Array()).map((e2) => __async(this, null, function* () {
      return (yield I(new _(e2, t), i, r)).toArray();
    })))).flat());
  });
}
export {
  w as default
};
//# sourceMappingURL=OrientedImageryViewerViewModelAdapter3D-F2NWSVWJ.js.map
