import {
  a as a14
} from "./chunk-ZEJV2HHS.js";
import {
  l as l17,
  p as p10
} from "./chunk-7RD4KVUX.js";
import {
  t as t21
} from "./chunk-S2OEQYU7.js";
import {
  i as i10
} from "./chunk-PR6QK2UX.js";
import {
  s as s18
} from "./chunk-HHHY7K7M.js";
import {
  O as O11
} from "./chunk-PRMR227H.js";
import {
  n as n15
} from "./chunk-APWDCJIJ.js";
import {
  t as t23,
  te as te2
} from "./chunk-NEPAFG4J.js";
import {
  n as n14
} from "./chunk-E7VVOB2F.js";
import {
  Q as Q2
} from "./chunk-7YXVUZL6.js";
import {
  E as E9,
  R as R4,
  b as b6,
  c as c18,
  d as d7,
  f as f11,
  f2 as f12,
  g as g5,
  l as l16,
  m as m9,
  o as o15,
  p as p9,
  s as s17,
  u as u16
} from "./chunk-6YVA5E7L.js";
import {
  B as B3,
  F as F4,
  I as I7,
  S as S7,
  U as U3,
  b as b7,
  k as k2
} from "./chunk-4KGPH7OX.js";
import {
  d as d9
} from "./chunk-GFPWBDCO.js";
import {
  b as b8
} from "./chunk-MQUE5HQL.js";
import {
  r as r18
} from "./chunk-TKHURHLF.js";
import {
  it
} from "./chunk-UW23RIEM.js";
import {
  O as O10,
  z as z5
} from "./chunk-R6CAUNOR.js";
import {
  r as r21
} from "./chunk-TMIIQZKR.js";
import {
  d as d8
} from "./chunk-ROVEMBDA.js";
import {
  G as G4,
  e as e28,
  i as i11
} from "./chunk-ZIDRXKSJ.js";
import {
  D as D5,
  n as n16
} from "./chunk-S2GZKKIE.js";
import {
  T as T3,
  a as a15
} from "./chunk-ZQYSUMPX.js";
import {
  M
} from "./chunk-CZLVBJSQ.js";
import {
  E as E8,
  I as I5,
  m as m8
} from "./chunk-GW7WMRYJ.js";
import {
  I as I6,
  f as f10,
  r as r19,
  t as t22
} from "./chunk-LWAFK7Z6.js";
import {
  At,
  G as G5,
  Ot,
  at,
  ft,
  ht,
  ot as ot3,
  rt,
  z as z4
} from "./chunk-O7OCS6XP.js";
import {
  e as e29
} from "./chunk-BFWLPS7M.js";
import {
  h as h11
} from "./chunk-ENI3KAZB.js";
import {
  r as r20
} from "./chunk-BJM7H6OC.js";
import {
  a2 as a13,
  e as e30,
  o as o16,
  u as u17
} from "./chunk-2ONAF54K.js";
import {
  m as m10
} from "./chunk-K74MUOGN.js";
import {
  p as p8
} from "./chunk-ZUHJZKEM.js";
import {
  l as l12
} from "./chunk-B4EEJXBQ.js";
import {
  j as j10,
  s as s15,
  te,
  z as z3
} from "./chunk-JA2C7MTO.js";
import {
  r as r16,
  t as t17,
  u as u15
} from "./chunk-74INNEIP.js";
import {
  r as r13
} from "./chunk-K2LTET4M.js";
import {
  I as I4,
  l as l13
} from "./chunk-WG5JLPNN.js";
import {
  r as r12
} from "./chunk-7XAWCQ7R.js";
import {
  E as E6
} from "./chunk-RASN5P76.js";
import {
  E as E7,
  O as O8,
  b as b5,
  k,
  m as m7,
  p2 as p7,
  x as x5
} from "./chunk-5L3YXBNN.js";
import {
  A as A6,
  E as E5,
  O as O7,
  _ as _8,
  c as c17,
  f as f8,
  l as l15,
  s as s16
} from "./chunk-IFUKJDOU.js";
import {
  e as e27,
  f as f9,
  i as i9,
  o as o13
} from "./chunk-LD5YIQXD.js";
import {
  t as t20
} from "./chunk-J7KF6IEI.js";
import {
  N
} from "./chunk-GOKBAMCG.js";
import {
  n as n13
} from "./chunk-E3P3LIVT.js";
import {
  i as i8
} from "./chunk-PO7V7AQE.js";
import {
  c as c14
} from "./chunk-GTZOXRB5.js";
import {
  r as r14,
  r2 as r15,
  t as t16
} from "./chunk-XGDLE7WK.js";
import {
  t as t15
} from "./chunk-GDEAPZ64.js";
import {
  r as r17
} from "./chunk-FHW2TG7X.js";
import {
  B as B2,
  G as G3,
  O as O9,
  Q,
  W as W2,
  X,
  t as t19
} from "./chunk-YCQXFVJL.js";
import {
  c as c15,
  c2 as c16,
  e as e26,
  u2 as u14
} from "./chunk-YAGNWBGU.js";
import {
  t as t18
} from "./chunk-DE6MQ5XE.js";
import {
  e as e25
} from "./chunk-LQTSBE7P.js";
import {
  O as O6
} from "./chunk-GCFUJXGH.js";
import {
  o as o11
} from "./chunk-VIIVMRRO.js";
import {
  S as S6,
  _ as _7,
  a as a12,
  h as h10,
  l as l14,
  o as o12
} from "./chunk-LKHUGH5W.js";
import {
  a as a11,
  c as c13,
  p as p6
} from "./chunk-WBOVDU4O.js";
import {
  h as h9
} from "./chunk-TVV62TZG.js";
import {
  r as r11
} from "./chunk-5XOZP4XS.js";
import {
  e as e24,
  s as s14,
  t as t14
} from "./chunk-ZVFENZUF.js";
import {
  c as c12,
  m as m6
} from "./chunk-C2NHN5LF.js";
import {
  Y as Y3
} from "./chunk-N3S77FRG.js";
import {
  j2 as j9
} from "./chunk-YYETZJJB.js";
import {
  d as d6,
  h as h8,
  j as j8,
  v as v3
} from "./chunk-MD2IQSSQ.js";
import {
  I as I3
} from "./chunk-Z6Z2SY6R.js";
import {
  c as c9
} from "./chunk-C7VF4AR2.js";
import {
  ee
} from "./chunk-EU7HJNZD.js";
import {
  c as c11,
  i as i7
} from "./chunk-RSQ7FJBQ.js";
import {
  t as t13
} from "./chunk-JCWQ2LOQ.js";
import {
  c as c10,
  e2 as e23
} from "./chunk-P7OSFLIX.js";
import {
  E as E4,
  _ as _6
} from "./chunk-ZDC4PV4Y.js";
import {
  i as i6
} from "./chunk-L3F4XA4B.js";
import {
  e as e20,
  s as s13
} from "./chunk-ENQEWBGS.js";
import {
  t as t9
} from "./chunk-66QAJ2MI.js";
import {
  o as o10,
  t as t11
} from "./chunk-WN3YAMRZ.js";
import {
  H as H2
} from "./chunk-NWICVENM.js";
import {
  A as A5,
  f as f7,
  i as i5,
  l as l11,
  t as t10
} from "./chunk-WU7FVYT7.js";
import {
  m as m5,
  s as s12
} from "./chunk-SYYDVGKY.js";
import {
  D as D3,
  E as E3,
  F as F3,
  L as L4,
  O as O5,
  R as R3,
  f as f6
} from "./chunk-YLE5AYZV.js";
import {
  a as a9,
  p as p5
} from "./chunk-CZQYBYHB.js";
import {
  $,
  B,
  D as D4,
  J as J3,
  U as U2,
  V as V4,
  Y as Y2,
  v as v2
} from "./chunk-2XI572KI.js";
import {
  a as a10,
  e as e22,
  t as t12
} from "./chunk-62WUYJJN.js";
import {
  e as e21
} from "./chunk-AWJPQWYU.js";
import {
  T as T2,
  b as b4,
  c as c8,
  d as d5,
  h as h7,
  i as i4,
  l as l10,
  u as u13,
  x as x4
} from "./chunk-JNWMZ6EJ.js";
import {
  P as P3,
  e as e19,
  j as j7,
  l as l9,
  o as o9,
  q as q4,
  r as r10,
  u as u12,
  v
} from "./chunk-VS26W5Y5.js";
import {
  e as e18,
  t as t8
} from "./chunk-D3XZUGMN.js";
import {
  C,
  I as I2,
  o as o8
} from "./chunk-YFQ32AQX.js";
import {
  ot as ot2
} from "./chunk-C7NRYPDG.js";
import {
  h as h5,
  j as j4
} from "./chunk-JDUU4ZDX.js";
import {
  s as s8,
  y as y4
} from "./chunk-6WG22V46.js";
import {
  a as a8,
  c as c7
} from "./chunk-XCVOKQAA.js";
import {
  A as A3
} from "./chunk-3WQXHRJE.js";
import {
  n as n9
} from "./chunk-L7ZKWTWL.js";
import {
  e as e13
} from "./chunk-O2DTA3XK.js";
import {
  e as e17,
  r as r8
} from "./chunk-WDDCGJTI.js";
import {
  a as a7
} from "./chunk-PA7WZX2U.js";
import {
  g as g3,
  h as h6,
  i as i3,
  n as n11,
  o as o7,
  r as r9
} from "./chunk-WJKYGQOY.js";
import {
  V as V2,
  _ as _5,
  z as z2
} from "./chunk-ZE47C44H.js";
import {
  l as l7
} from "./chunk-5GIS2C3K.js";
import {
  n as n8
} from "./chunk-ZR5BOILP.js";
import {
  s as s11,
  t as t7
} from "./chunk-RDQF44TE.js";
import {
  l as l8
} from "./chunk-KKD7A2GN.js";
import {
  A as A4,
  E as E2,
  F as F2,
  S as S5,
  U,
  V as V3,
  b as b3,
  d as d4,
  j as j6,
  q as q3
} from "./chunk-N4KQPPPI.js";
import {
  g as g4,
  m as m4
} from "./chunk-4OGGMTIH.js";
import {
  e as e16
} from "./chunk-4MMTPKY4.js";
import {
  a as a6,
  e as e15,
  l as l6,
  n as n10,
  r as r7,
  s as s9,
  t as t6
} from "./chunk-DY7FJHTG.js";
import {
  c as c6
} from "./chunk-Q4KYZS3X.js";
import {
  u as u10
} from "./chunk-KVKFHRJ3.js";
import {
  j as j5,
  n as n12,
  s as s10,
  u as u11
} from "./chunk-JYODC3YQ.js";
import {
  e as e12,
  o as o6,
  r as r6
} from "./chunk-BQZBOYBD.js";
import {
  e as e14
} from "./chunk-TYQXPPSP.js";
import {
  d as d3,
  y as y3
} from "./chunk-TNWXOQKO.js";
import {
  R as R2
} from "./chunk-7KRERHHR.js";
import {
  n as n6
} from "./chunk-N6TJI25E.js";
import {
  d2,
  j as j3,
  l2 as l5,
  o as o5,
  p as p4
} from "./chunk-634JLXD4.js";
import {
  c as c5,
  t as t4
} from "./chunk-UF6JOUSJ.js";
import {
  A as A2,
  D as D2,
  E,
  F,
  G as G2,
  O as O4,
  P as P2,
  S as S4,
  T,
  V,
  Y,
  a as a5,
  c as c3,
  f as f4,
  h as h3,
  i,
  l as l4,
  o as o3,
  w as w3,
  y as y2
} from "./chunk-J55F4AC2.js";
import {
  _ as _4,
  n as n7,
  r as r5,
  s as s7,
  t as t5
} from "./chunk-IMVP5ADD.js";
import {
  m as m3,
  s as s6
} from "./chunk-H7WPOTQH.js";
import {
  J as J2
} from "./chunk-DUTZNK67.js";
import {
  I,
  c as c4,
  e as e11,
  f as f5,
  h as h4,
  i as i2,
  n as n5,
  o as o4,
  p as p3,
  q as q2
} from "./chunk-XTVPEVHA.js";
import {
  o as o14
} from "./chunk-JILEJ6R2.js";
import {
  u as u9
} from "./chunk-K226GFDN.js";
import {
  e as e10,
  u as u8,
  x as x3
} from "./chunk-7ZJ6P7J7.js";
import {
  H,
  n as n4
} from "./chunk-OGZAGPIO.js";
import {
  j as j2,
  u as u6
} from "./chunk-T6GCUITX.js";
import {
  g as g2,
  h as h2,
  p
} from "./chunk-TUIGM7TV.js";
import {
  D,
  f as f3,
  p as p2,
  u as u7,
  x as x2
} from "./chunk-IHVSZYZS.js";
import {
  n as n3
} from "./chunk-6CA6K3O7.js";
import {
  w as w2
} from "./chunk-NYQ5CYNR.js";
import {
  b as b2,
  e as e9,
  f as f2,
  h,
  m as m2
} from "./chunk-3ZXOUEQG.js";
import {
  J,
  K,
  O as O3,
  P,
  S as S3,
  _ as _3,
  c as c2,
  e as e8,
  g,
  j,
  o as o2,
  q,
  r as r4,
  s as s5,
  u as u5,
  x,
  z
} from "./chunk-AXVPJBVW.js";
import {
  _ as _2,
  e as e6,
  l as l3,
  n as n2,
  r as r3
} from "./chunk-OXEPWRM7.js";
import {
  e as e7,
  u as u4
} from "./chunk-POILQGXA.js";
import {
  G,
  L as L3,
  O as O2,
  W2 as W,
  s3 as s4
} from "./chunk-JJS7PR2U.js";
import {
  ot
} from "./chunk-SYATLP3H.js";
import {
  _,
  a as a4,
  d
} from "./chunk-XNUH25NY.js";
import {
  o
} from "./chunk-WGAPNV7F.js";
import {
  e as e5
} from "./chunk-4Z5SGKRM.js";
import {
  S as S2,
  e3 as e4
} from "./chunk-ANKOCGE2.js";
import {
  y
} from "./chunk-7CJXZOFG.js";
import {
  u as u3
} from "./chunk-IRGZKO7V.js";
import {
  e as e3
} from "./chunk-5SELS7VU.js";
import {
  a3
} from "./chunk-DDYVXG4F.js";
import {
  L as L2,
  S,
  a as a2,
  b,
  c2 as c,
  m,
  s as s3,
  u as u2,
  w
} from "./chunk-HJY2YILU.js";
import {
  e as e2,
  l as l2,
  r as r2,
  t as t3,
  u
} from "./chunk-2MMLMOWS.js";
import {
  a,
  f,
  l2 as l,
  n2 as n,
  s2
} from "./chunk-WYIDUUN2.js";
import {
  A2 as A,
  L,
  O,
  R,
  e,
  has,
  r,
  s,
  t2 as t,
  t3 as t2
} from "./chunk-DXLOWWK7.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/ElevationQuery.js
var l18 = class {
  constructor(e43, t31) {
    this.spatialReference = e43, this._view = t31;
  }
  getElevation(e43, t31, r39) {
    return this._view.elevationProvider.getElevation(e43, t31, 0, this.spatialReference, r39);
  }
  queryElevation(e43, t31, r39, s33, i20) {
    return __async(this, null, function* () {
      return this._view.elevationProvider.queryElevation(e43, t31, 0, this.spatialReference, i20, r39, s33);
    });
  }
};
var a16 = class {
  constructor(e43, t31, r39, s33) {
    this.spatialReference = t31, this._getElevationQueryProvider = r39, this._queries = new Array(), this._queryOptions = __spreadProps(__spreadValues({}, s33), {
      ignoreInvisibleLayers: true
    }), this._frameTask = e43.registerTask(I2.ELEVATION_QUERY, this);
  }
  destroy({
    completeTasks: e43
  } = {
    completeTasks: false
  }) {
    if (this._frameTask.remove(), this.running) if (e43) this.runTask(C);
    else for (const r39 of this._queries) r39.result.reject(u2());
  }
  queryElevation(i20, o27, n28, l35 = 0) {
    const a30 = L2(), u32 = {
      x: i20,
      y: o27,
      minDemResolution: l35,
      result: a30,
      signal: n28
    };
    return this._queries.push(u32), m(n28, () => {
      L(this._queries, u32), a30.reject(u2());
    }), a30.promise;
  }
  get running() {
    return this._queries.length > 0;
  }
  runTask(e43) {
    const r39 = this._queries;
    this._queries = [];
    const i20 = this._getElevationQueryProvider();
    if (!i20) return r39.forEach((e44) => e44.result.reject()), void e43.madeProgress();
    const o27 = r39.map((e44) => [e44.x, e44.y]), l35 = r39.reduce((e44, t31) => Math.min(e44, t31.minDemResolution), 1 / 0), a30 = new u6({
      points: o27,
      spatialReference: this.spatialReference
    }), u32 = r39.length > 1 && r39.some((e44) => !!e44.signal) ? new AbortController() : null, c33 = null != u32 ? u32.signal : r39[0].signal;
    if (null != u32) {
      let e44 = 0;
      r39.forEach((i21) => m(i21.signal, () => {
        e44++, i21.result.reject(u2()), e44 === r39.length && u32.abort();
      }));
    }
    const h23 = __spreadProps(__spreadValues({}, this._queryOptions), {
      minDemResolution: l35,
      signal: c33
    });
    i20.queryElevation(a30, h23).then((e44) => {
      r39.forEach((r40, s33) => {
        null != r40.signal && r40.signal.aborted ? r40.result.reject(u2()) : r40.result.resolve(e44.geometry.points[s33][2]);
      });
    }).catch((e44) => {
      r39.forEach((t31) => t31.result.reject(e44));
    }), e43.madeProgress();
  }
  get test() {
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/enums.js
var L5;
var A7;
!function(L10) {
  L10[L10.USER = 1] = "USER", L10[L10.SCALE_RANGE = 2] = "SCALE_RANGE", L10[L10.FILTER = 4] = "FILTER", L10[L10.DECONFLICTION = 8] = "DECONFLICTION", L10[L10.ALL_GRAPHIC = 15] = "ALL_GRAPHIC", L10[L10.ALL_LABEL = 255] = "ALL_LABEL";
}(L5 || (L5 = {})), function(L10) {
  L10[L10.GRAPHIC = 1] = "GRAPHIC", L10[L10.LABEL = 16] = "LABEL";
}(A7 || (A7 = {}));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/GeometryWithMapPositions.js
function e31(o27) {
  return null != o27.mapPositions;
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/ElevationAligners.js
function u18(t31, e43, o27, n28, r39) {
  const a30 = t31.stageObject, s33 = a30.geometries;
  let i20 = 0;
  for (const l35 of s33) {
    if (!e31(l35)) continue;
    const {
      update: t32,
      averageGeometrySampledElevation: s34
    } = M2(l35, e43, o27, n28, r39);
    i20 += s34, t32 && a30.geometryVertexAttributeUpdated(l35, e16.POSITION);
  }
  return i20 / s33.length;
}
function p11(e43, n28, a30, i20, m22, f26) {
  const c33 = e43.stageObject, u32 = n28.centerPointInElevationSR;
  let p23 = 0;
  if (c33.usesVerticalDistanceToGround) i20(u32, E10), E9(c33, E10.verticalDistanceToGround), p23 = E10.sampledElevation;
  else {
    i20(u32, E10);
    "absolute-height" !== n28.mode && (p23 = E10.sampledElevation);
  }
  const b18 = n5(g6, f26 ?? c33.transformation), I18 = o2(v4, b18[12], b18[13], b18[14]);
  t18.TESTS_DISABLE_OPTIMIZATIONS ? (T4[0] = u32.x, T4[1] = u32.y, T4[2] = E10.z, u10(u32.spatialReference, T4, b18, m22.spatialReference) && (f26 ? n5(f26, b18) : c33.transformation = b18)) : m22.setAltitudeOfTransformation(E10.z, b18);
  const S19 = d10 / m22.unitInMeters;
  return (Math.abs(b18[12] - I18[0]) >= S19 || Math.abs(b18[13] - I18[1]) >= S19 || Math.abs(b18[14] - I18[2]) >= S19) && (f26 ? n5(f26, b18) : c33.transformation = b18), p23;
}
var g6 = e12();
function b9(t31, e43, n28, a30, s33) {
  const i20 = t31.graphics3DSymbolLayer.lodRenderer;
  if (null == i20) return 0;
  const m22 = e43.centerPointInElevationSR;
  a30(m22, E10);
  const f26 = "absolute-height" !== e43.mode ? E10.sampledElevation : 0, c33 = i20.instanceData, u32 = t31.instanceIndex, p23 = h12;
  c33.getGlobalTransform(u32, p23);
  const g17 = o2(v4, p23[12], p23[13], p23[14]);
  t18.TESTS_DISABLE_OPTIMIZATIONS ? (T4[0] = m22.x, T4[1] = m22.y, T4[2] = E10.z, u10(m22.spatialReference, T4, p23, s33.spatialReference) && c33.setGlobalTransform(u32, p23)) : s33.setAltitudeOfTransformation(E10.z, p23);
  const b18 = d10 / s33.unitInMeters;
  return (t18.TESTS_DISABLE_OPTIMIZATIONS || Math.abs(p23[12] - g17[0]) >= b18 || Math.abs(p23[13] - g17[1]) >= b18 || Math.abs(p23[14] - g17[2]) >= b18) && c33.setGlobalTransform(u32, p23), f26;
}
function I8(t31, e43, o27, n28, r39) {
  const a30 = t31.stageObject, s33 = a30.geometries;
  if (0 === s33.length) return 0;
  let i20 = 0, l35 = null, m22 = 0, u32 = false;
  for (const p23 of s33) {
    if (!e31(p23)) continue;
    const t32 = p23.attributes.get(e16.POSITION);
    if (t32 !== l35) {
      const {
        update: a31,
        averageGeometrySampledElevation: s34
      } = M2(p23, e43, o27, n28, r39);
      m22 = s34, l35 = t32, u32 = a31;
    }
    u32 && a30.geometryVertexAttributeUpdated(p23, e16.POSITION), i20 += m22;
  }
  return i20 / s33.length;
}
var d10 = 0.01;
var T4 = n2();
var S8 = n2();
var O12 = n2();
var h12 = e12();
var v4 = n2();
var E10 = new R4();
function M2(t31, e43, o27, n28, r39) {
  let s33 = false;
  const i20 = t31.transformation, f26 = e43.requiresSampledElevationInfo;
  S8[0] = i20[12], S8[1] = i20[13], S8[2] = i20[14], t31.invalidateBoundingInfo();
  const u32 = t31.getMutableAttribute(e16.POSITION), p23 = u32.data, g17 = u32.size, b18 = p23.length / g17, I18 = new r18(t31.mapPositions, o27);
  let h23 = 0, v15 = 0;
  for (let m22 = 0; m22 < b18; m22++) {
    if (O12[0] = p23[h23], O12[1] = p23[h23 + 1], O12[2] = p23[h23 + 2], n28(I18, E10), f26 && (v15 += E10.sampledElevation), t18.TESTS_DISABLE_OPTIMIZATIONS) p23[h23] = I18.array[I18.offset], p23[h23 + 1] = I18.array[I18.offset + 1], p23[h23 + 2] = E10.z, n4(p23, o27, h23, p23, r39.spatialReference, h23, 1), p23[h23] -= S8[0], p23[h23 + 1] -= S8[1], p23[h23 + 2] -= S8[2], s33 = true;
    else {
      T4[0] = p23[h23] + S8[0], T4[1] = p23[h23 + 1] + S8[1], T4[2] = p23[h23 + 2] + S8[2], r39.setAltitude(T4, E10.z), p23[h23] = T4[0] - S8[0], p23[h23 + 1] = T4[1] - S8[1], p23[h23 + 2] = T4[2] - S8[2];
      const t32 = d10 / r39.unitInMeters;
      (Math.abs(O12[0] - p23[h23]) >= t32 || Math.abs(O12[1] - p23[h23 + 1]) >= t32 || Math.abs(O12[2] - p23[h23 + 2]) >= t32) && (s33 = true);
    }
    h23 += g17, I18.offset += 3;
  }
  return v15 /= b18, {
    update: s33,
    averageGeometrySampledElevation: v15
  };
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphicCreationContext.js
var r22 = class {
  constructor(r39, s33, t31) {
    this.graphic = r39, this.renderingInfo = s33, this.layer = t31;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer.js
var j11 = class {
  constructor(e43, t31, i20) {
    this.baseMaterial = e43, this.edgeMaterials = t31, this.properties = i20;
  }
};
var p12 = class {
  get isElevationSource() {
    return !!this.stageObject.lastValidElevationBB;
  }
  constructor(e43, t31, i20, s33, a30, n28, r39, o27 = null) {
    this.graphics3DSymbolLayer = e43, this.stageObject = t31, this._uniqueGeometries = i20, this._uniqueMaterials = s33, this._sharedResource = a30, this.elevationAligner = n28, this.elevationContext = r39, this._edgeState = o27, this.type = "object3d", this._stageLayer = null, this._visible = false, this._addedToStage = false, this.alignedSampledElevation = 0, this.needsElevationUpdates = false, this.useObjectOriginAsAttachmentOrigin = false;
  }
  initialize(e43) {
    this._stageLayer = e43;
    const t31 = e43.stage;
    t31.addMany(this._uniqueMaterials), t31.addMany(this._uniqueGeometries), t31.add(this.stageObject);
  }
  destroy() {
    if (!this._stageLayer) return;
    const e43 = this._stageLayer.stage;
    e43.removeMany(this._uniqueMaterials), e43.removeMany(this._uniqueGeometries), e43.remove(this.stageObject), this._addedToStage && (this._stageLayer.remove(this.stageObject), this._addedToStage = false), e43.renderer.edgeView?.removeObject(this.stageObject), this.stageObject.dispose(), this._sharedResource?.release(), this._visible = false, this._stageLayer = null;
  }
  layerOpacityChanged(e43, t31) {
    const {
      stageObject: i20,
      _edgeState: s33,
      _stageLayer: a30
    } = this;
    if (null == s33) return;
    const n28 = v5(s33.baseMaterial);
    let r39 = false;
    for (const o27 of s33.edgeMaterials) o27.objectTransparency !== n28 && (o27.objectTransparency = n28, r39 = true);
    r39 && this.resetEdgeObject(t31), a30.stage.renderer.withEdgeView((t32) => {
      t32.updateAllComponentOpacities(i20, [e43]);
    });
  }
  slicePlaneEnabledChanged(e43, t31) {
    const {
      stageObject: i20,
      _edgeState: s33,
      _stageLayer: a30
    } = this;
    null != s33 && a30.stage.renderer.withEdgeView((a31) => {
      a31.updateAllComponentMaterials(i20, s33.edgeMaterials, {
        hasSlicePlane: e43
      }, !t31), s33.properties.hasSlicePlane = e43;
    });
  }
  setVisibility(e43) {
    const {
      _edgeState: t31,
      stageObject: i20,
      _stageLayer: s33
    } = this;
    null != s33 && this.visible !== e43 && (this._visible = e43, i20.visible = e43, e43 && !this._addedToStage && (s33.add(i20), this._addedToStage = true), null != t31 && s33.stage.renderer.withEdgeView((s34) => {
      s34.hasObject(i20) ? s34.updateObjectVisibility(i20, e43) : e43 && this._addOrUpdateEdgeObject(t31, s34, false);
    }));
  }
  get visible() {
    return this._visible;
  }
  alignWithElevation(e43, t31, i20, s33) {
    if (null == this.elevationAligner) return;
    null != i20 && l16(this.elevationContext.featureExpressionInfoContext, i20);
    const a30 = (i21, s34) => c18(i21, e43, this.elevationContext, t31, s34);
    this.alignedSampledElevation = this.elevationAligner(this, this.elevationContext, e43.spatialReference, a30, t31), this.resetEdgeObject(s33);
  }
  alignWithAbsoluteElevation(e43, t31, i20) {
    const s33 = (t32, i21) => {
      i21.sampledElevation = e43, i21.verticalDistanceToGround = 0, i21.z = e43;
    };
    this.alignedSampledElevation = this.elevationAligner(this, this.elevationContext, null, s33, t31), this.resetEdgeObject(i20);
  }
  getCenterObjectSpace(t31 = n2()) {
    return r4(t31, V2(this.stageObject.boundingVolumeObjectSpace.bounds));
  }
  getBoundingBoxObjectSpace(e43 = i()) {
    const t31 = this.stageObject.boundingVolumeObjectSpace;
    return A2(e43, t31.min), G2(e43, t31.max), e43;
  }
  computeAttachmentOrigin(e43) {
    const s33 = this.stageObject.effectiveTransformation;
    if (this.useObjectOriginAsAttachmentOrigin) e43.render.origin[0] += s33[12], e43.render.origin[1] += s33[13], e43.render.origin[2] += s33[14], e43.render.num++;
    else for (const a30 of this.stageObject.geometries) a30.computeAttachmentOrigin(y5) && (O3(y5, y5, s33), u5(e43.render.origin, e43.render.origin, y5), e43.render.num++);
  }
  getProjectedBoundingBox(e43, i20, s33, a30, n28) {
    return __async(this, null, function* () {
      const r39 = this.getBoundingBoxObjectSpace(n28), d21 = E11, h23 = w3(r39) ? 1 : d21.length;
      for (let o27 = 0; o27 < h23; o27++) {
        const e44 = d21[o27];
        _9[0] = r39[e44[0]], _9[1] = r39[e44[1]], _9[2] = r39[e44[2]], O3(_9, _9, this.stageObject.transformation), f13[3 * o27] = _9[0], f13[3 * o27 + 1] = _9[1], f13[3 * o27 + 2] = _9[2];
      }
      if (!e43(f13, 0, h23)) return null;
      P2(r39);
      let u32 = null;
      this.calculateRelativeScreenBounds && (u32 = this.calculateRelativeScreenBounds());
      for (let t31 = 0; t31 < 3 * h23; t31 += 3) {
        for (let e44 = 0; e44 < 3; e44++) r39[e44] = Math.min(r39[e44], f13[t31 + e44]), r39[e44 + 3] = Math.max(r39[e44 + 3], f13[t31 + e44]);
        u32 && s33.push({
          location: f13.slice(t31, t31 + 3),
          screenSpaceBoundingRect: u32
        });
      }
      if (i20?.service && "absolute-height" !== this.elevationContext.mode) {
        E(r39, y5);
        const e44 = "relative-to-scene" === this.elevationContext.mode ? "scene" : "ground";
        let t31 = 0;
        if (i20.useViewElevation) t31 = i20.service.getElevation(y5[0], y5[1], e44) ?? 0;
        else try {
          const s34 = k2(r39, i20.service.spatialReference, i20);
          t31 = (yield i20.service.queryElevation(y5[0], y5[1], a30, s34, e44)) ?? 0;
        } catch (m22) {
        }
        Y(r39, 0, 0, -this.alignedSampledElevation + t31);
      }
      return r39;
    });
  }
  addObjectState(e43, t31) {
    e43 === t14.Highlight && t31.addObject(this.stageObject, this.stageObject.highlight()), e43 === t14.MaskOccludee && t31.addObject(this.stageObject, this.stageObject.maskOccludee());
  }
  removeObjectState(e43) {
    e43.removeObject(this.stageObject);
  }
  resetEdgeObject(e43) {
    const {
      _edgeState: t31,
      stageObject: i20,
      _stageLayer: s33,
      _visible: a30
    } = this;
    null != t31 && s33.stage.renderer.withEdgeView((s34) => {
      a30 ? this._addOrUpdateEdgeObject(t31, s34, e43) : s34.removeObject(i20);
    });
  }
  _addOrUpdateEdgeObject(e43, t31, i20) {
    const s33 = v5(e43.baseMaterial);
    for (const a30 of e43.edgeMaterials) a30.objectTransparency = s33;
    t31.addOrUpdateObject3D(this.stageObject, e43.edgeMaterials, e43.properties, !i20).then(() => this._stageLayer?.sync());
  }
};
function v5(e43) {
  return e43.isVisible() ? e43.parameters.transparent ? A3.TRANSPARENT : A3.OPAQUE : A3.INVISIBLE;
}
var f13 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
var _9 = n2();
var y5 = n2();
var E11 = [[0, 1, 2], [3, 1, 2], [0, 4, 2], [3, 4, 2], [0, 1, 5], [3, 1, 5], [0, 4, 5], [3, 4, 5]];

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectMetadata.js
var t24 = class {
  constructor(t31, e43 = null) {
    this.labelText = e43, this.elevationOffset = t31 ?? 0;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants.js
var o17 = 3;
var t25 = 3;
var c19 = 10;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodResources.js
var s19 = class {
  constructor(e43, t31 = null) {
    this.geometry = e43, this.textures = t31;
  }
};
var r23 = class {
  constructor(e43, s33, r39) {
    this.components = e43, this.minScreenSpaceRadius = s33, this.pivotOffset = r39;
    const n28 = this.geometries;
    this.numVertices = n28.reduce((e44, s34) => e44 + s34.attributes.get(e16.POSITION).indices.length, 0);
  }
  get geometries() {
    return s(this.components.map((e43) => e43.geometry));
  }
};
var n17 = class {
  constructor(e43) {
    this.levels = e43, this.levels.sort((e44, t31) => e44.minScreenSpaceRadius === t31.minScreenSpaceRadius ? e44.numVertices - t31.numVertices : e44.minScreenSpaceRadius - t31.minScreenSpaceRadius);
  }
};
function c20(t31) {
  const s33 = [];
  return t31.levels.forEach((e43) => e43.components.forEach((e44) => s33.push(e44.geometry.material))), s(s33);
}
function o18(t31) {
  const s33 = new Array();
  return t31.levels.forEach((e43) => e43.components.forEach((e44) => {
    null != e44.textures && s33.push(...e44.textures);
  })), s(s33);
}
function i12(t31) {
  const s33 = new Array();
  return t31.levels.forEach((e43) => e43.components.forEach((e44) => s33.push(e44.geometry))), s(s33);
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/primitiveObjectSymbolUtils.js
function d11(e43) {
  switch (e43) {
    case "sphere":
    case "cube":
    case "diamond":
    case "cylinder":
    case "cone":
    case "inverted-cone":
    case "tetrahedron":
      return true;
  }
  return false;
}
function S9(d21, S19) {
  const m22 = (n28, s33, a30 = false) => new n17(n28.map((n29) => {
    const c33 = s33(n29.tesselation);
    return a30 && Ot(c33), new r23([new s19(c33)], n29.minScreenSpaceRadius);
  }));
  switch (d21) {
    case "sphere":
      return m22([{
        tesselation: 0,
        minScreenSpaceRadius: 0
      }, {
        tesselation: 1,
        minScreenSpaceRadius: 8
      }, {
        tesselation: 2,
        minScreenSpaceRadius: 16
      }, {
        tesselation: 3,
        minScreenSpaceRadius: 50
      }, {
        tesselation: 4,
        minScreenSpaceRadius: 250
      }], (e43) => rt(S19, 0.5, e43, true));
    case "cube":
      return m22([{
        tesselation: 0,
        minScreenSpaceRadius: 0
      }], () => G5(S19, 1));
    case "cone":
      return m22(l19, (e43) => at(S19, 1, 0.5, e43, false), true);
    case "inverted-cone":
      return m22(l19, (e43) => at(S19, 1, 0.5, e43, true), true);
    case "cylinder":
      return m22(l19, (e43) => ft(S19, 1, 0.5, e43, [0, 0, 1], [0, 0, 0.5]));
    case "tetrahedron":
      return m22([{
        tesselation: 0,
        minScreenSpaceRadius: 0
      }], () => ot3(S19, 1), true);
    case "diamond":
      return m22([{
        tesselation: 0,
        minScreenSpaceRadius: 0
      }], () => z4(S19, 1), true);
    default:
      return;
  }
}
var l19 = [{
  tesselation: 6,
  minScreenSpaceRadius: 0
}, {
  tesselation: 18,
  minScreenSpaceRadius: 7
}, {
  tesselation: 64,
  minScreenSpaceRadius: 65
}];

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/SymbolComplexity.js
var e32 = class {
  constructor(e43) {
    this.estimated = false, this.verticesPerFeature = e43.verticesPerFeature ?? 0, this.verticesPerCoordinate = e43.verticesPerCoordinate ?? 0, this.drawCallsPerFeature = e43.drawCallsPerFeature ?? 0, this.memory = e43.memory ?? new a17();
  }
};
var t26 = class extends e32 {
  constructor(e43) {
    super(e43), this.estimated = true;
  }
};
var s20 = class extends e32 {
  constructor(e43, t31) {
    super(t31), this.numComplexities = e43;
  }
};
var r24 = class extends t26 {
  constructor(e43, t31) {
    super(t31), this.numComplexities = e43;
  }
};
var a17 = class {
  constructor() {
    this.bytesPerFeature = 0, this.bytesPerFeatureLabel = 0, this.resourceBytes = 0, this.draped = {
      bytesPerFeature: 0,
      bytesPerFeatureLabel: 0
    };
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/defaultSymbolComplexity.js
var l20 = new t26({});
function m11(e43) {
  if ("web-style" === e43.type) return l20;
  return F5(e43.symbolLayers.toArray().map((r39) => p13(e43, r39)));
}
function F5(e43) {
  let r39 = 0, t31 = 0, a30 = 0, s33 = false, u32 = 0;
  const o27 = new a17();
  for (const b18 of e43) null != b18 && (r39 += b18.verticesPerFeature, t31 += b18.verticesPerCoordinate, a30 += b18.drawCallsPerFeature, o27.bytesPerFeature += b18.memory.bytesPerFeature, o27.bytesPerFeatureLabel += b18.memory.bytesPerFeatureLabel, o27.resourceBytes += b18.memory.resourceBytes, o27.draped.bytesPerFeature += b18.memory.bytesPerFeature, o27.draped.bytesPerFeatureLabel += b18.memory.bytesPerFeatureLabel, s33 = s33 || b18.estimated, ++u32);
  return s33 ? new r24(u32, {
    verticesPerFeature: r39,
    verticesPerCoordinate: t31,
    drawCallsPerFeature: a30,
    memory: o27
  }) : new s20(u32, {
    verticesPerFeature: r39,
    verticesPerCoordinate: t31,
    drawCallsPerFeature: a30,
    memory: o27
  });
}
function d12(e43) {
  const r39 = F5(e43);
  return r39.numComplexities > 0 && (r39.verticesPerFeature /= r39.numComplexities, r39.verticesPerCoordinate /= r39.numComplexities, r39.drawCallsPerFeature /= r39.numComplexities, r39.memory.bytesPerFeature /= r39.numComplexities, r39.memory.bytesPerFeatureLabel /= r39.numComplexities, r39.memory.resourceBytes /= r39.numComplexities, r39.memory.draped.bytesPerFeature /= r39.numComplexities, r39.memory.draped.bytesPerFeatureLabel /= r39.numComplexities), r39;
}
var L6 = {};
function p13(u32, b18) {
  const y12 = C2(u32, b18), c33 = c7(b18) ? 2 : 0;
  switch (b18.type) {
    case "extrude":
      return new e32({
        verticesPerFeature: -12,
        verticesPerCoordinate: 12,
        drawCallsPerFeature: c33,
        memory: y12
      });
    case "fill":
      if ("mesh-3d" === u32.type) return new e32({
        drawCallsPerFeature: c33,
        memory: y12
      });
      if (null != b18.outline && b18.outline.size > 0) return new e32({
        verticesPerFeature: -12,
        verticesPerCoordinate: 9,
        memory: y12
      });
    case "water":
      return new e32({
        verticesPerFeature: -6,
        verticesPerCoordinate: 3,
        memory: y12
      });
    case "line":
      return new e32({
        verticesPerFeature: -6,
        verticesPerCoordinate: 6,
        memory: y12
      });
    case "object":
      return b18.resource?.href ? new t26({
        verticesPerFeature: 100,
        memory: y12
      }) : __spreadProps(__spreadValues({}, f14(b18.resource?.primitive ?? d2)), {
        memory: y12
      });
    case "path": {
      let r39 = 0, u33 = 0;
      switch (b18.profile) {
        case "circle":
          r39 = c19;
          break;
        case "quad":
          r39 = 4;
          break;
        default:
          return void n6(b18.profile);
      }
      switch (b18.join) {
        case "round":
          u33 = o17;
          break;
        case "miter":
        case "bevel":
          u33 = 1;
          break;
        default:
          return;
      }
      const o27 = 2 * r39, c34 = r39 * u33 * 2, n28 = c34 + o27;
      let P10 = -2 * c34 - o27;
      switch (b18.cap) {
        case "none":
          break;
        case "butt":
        case "square":
          P10 += 2 * (r39 - 1);
          break;
        case "round":
          P10 += 2 * (r39 * (t25 - 1) * 2 + r39);
          break;
        default:
          return;
      }
      return new e32({
        verticesPerFeature: P10,
        verticesPerCoordinate: n28,
        memory: y12
      });
    }
    case "text":
    case "icon":
      return new e32({
        verticesPerFeature: 6,
        memory: y12
      });
    default:
      return;
  }
}
function C2(r39, t31) {
  const a30 = "point-3d" === r39.type;
  switch (t31.type) {
    case "extrude":
      return t31.edges && t31.edges.size > 0 ? E12.EXTRUDE_EDGES : E12.EXTRUDE;
    case "fill":
      return null != t31.outline && t31.outline.size > 0 ? E12.FILL_OUTLINE : E12.FILL;
    case "water":
      return E12.FILL;
    case "line":
      return "round" === t31.join ? E12.LINE_ROUND : E12.LINE_MITER;
    case "path":
      switch (t31.join) {
        case "round":
          switch (t31.profile) {
            case "circle":
              return E12.PATH_ROUND_CIRCLE;
            case "quad":
              return E12.PATH_ROUND_QUAD;
            default:
              return void n6(t31.profile);
          }
        case "miter":
        case "bevel":
          switch (t31.profile) {
            case "circle":
              return E12.PATH_MITER_CIRCLE;
            case "quad":
              return E12.PATH_MITER_QUAD;
            default:
              return void n6(t31.profile);
          }
        default:
          return;
      }
    case "object":
      return a30 ? E12.OBJECT_POINT : E12.OBJECT_POLYGON;
    case "icon":
    case "text":
      return a30 ? E12.ICON_POINT : E12.ICON_POLYGON;
    default:
      return;
  }
}
function f14(e43) {
  const r39 = L6[e43];
  if (r39) return r39;
  const t31 = w4(S9(e43, new j10({})).levels);
  return L6[e43] = new e32({
    verticesPerFeature: t31
  }), L6[e43];
}
function w4(e43) {
  return e43.reduce((e44, r39, t31) => e44 + r39.numVertices * (1 / 10 ** t31), 0) / e43.reduce((e44, r39, t31) => e44 + 1 / 10 ** t31, 0);
}
var E12 = {
  ICON_POINT: {
    bytesPerFeature: 2379.8272296852992,
    bytesPerFeatureLabel: 852.246235,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 1868.2382921559424,
      bytesPerFeatureLabel: 839.205415
    }
  },
  ICON_POLYGON: {
    bytesPerFeature: 2957.8429876524656,
    bytesPerFeatureLabel: 862.5307816666666,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 2579.7767085451133,
      bytesPerFeatureLabel: 856.9298550000001
    }
  },
  OBJECT_POINT: {
    bytesPerFeature: 603.543820573039,
    bytesPerFeatureLabel: 717.4551849999999,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 603.543820573039,
      bytesPerFeatureLabel: 717.4551849999999
    }
  },
  OBJECT_POLYGON: {
    bytesPerFeature: 1111.1693389308373,
    bytesPerFeatureLabel: 707.4535949999998,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 1111.1693389308373,
      bytesPerFeatureLabel: 707.4535949999998
    }
  },
  LINE_MITER: {
    bytesPerFeature: 3081.208408220661,
    bytesPerFeatureLabel: 858.6749016666668,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 2682.57863388475,
      bytesPerFeatureLabel: 844.6118016666666
    }
  },
  LINE_ROUND: {
    bytesPerFeature: 3209.3236242927915,
    bytesPerFeatureLabel: 858.1810416666667,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 2687.6256038096126,
      bytesPerFeatureLabel: 849.578535
    }
  },
  PATH_MITER_CIRCLE: {
    bytesPerFeature: 38708.74276663992,
    bytesPerFeatureLabel: 858.70415,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 38708.74276663992,
      bytesPerFeatureLabel: 858.70415
    }
  },
  PATH_ROUND_CIRCLE: {
    bytesPerFeature: 42098.00590216518,
    bytesPerFeatureLabel: 868.3632500000001,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 42098.00590216518,
      bytesPerFeatureLabel: 868.3632500000001
    }
  },
  PATH_MITER_QUAD: {
    bytesPerFeature: 25037.823002405767,
    bytesPerFeatureLabel: 835.93355,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 25037.823002405767,
      bytesPerFeatureLabel: 835.93355
    }
  },
  PATH_ROUND_QUAD: {
    bytesPerFeature: 40320.254760224525,
    bytesPerFeatureLabel: 851.66955,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 40320.254760224525,
      bytesPerFeatureLabel: 851.66955
    }
  },
  FILL: {
    bytesPerFeature: 3147.43349219103,
    bytesPerFeatureLabel: 850.7598550000001,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 2673.7898488975106,
      bytesPerFeatureLabel: 846.6459950000002
    }
  },
  FILL_OUTLINE: {
    bytesPerFeature: 4565.099993465867,
    bytesPerFeatureLabel: 855.334515,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 3904.46969705314,
      bytesPerFeatureLabel: 844.7081016666667
    }
  },
  EXTRUDE: {
    bytesPerFeature: 7551.2282834569505,
    bytesPerFeatureLabel: 849.5513283333333,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 7551.2282834569505,
      bytesPerFeatureLabel: 849.5513283333333
    }
  },
  EXTRUDE_EDGES: {
    bytesPerFeature: 2959.8379634500698,
    bytesPerFeatureLabel: 602.0969283333335,
    resourceBytes: 0,
    draped: {
      bytesPerFeature: 2959.8379634500698,
      bytesPerFeatureLabel: 602.0969283333335
    }
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/interfaces.js
var e33;
!function(e43) {
  e43[e43.RecreateSymbol = 0] = "RecreateSymbol", e43[e43.RecreateGraphics = 1] = "RecreateGraphics", e43[e43.FastUpdate = 2] = "FastUpdate";
}(e33 || (e33 = {}));

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Loadable.js
var r25 = class {
  constructor(t31) {
    this.schedule = t31, this._abortController = null, this._loadStatus = l21.LOADING, this._loadError = null, this._loader = null, this.logger = null;
  }
  destroy() {
    this.abortLoad();
  }
  get loadStatus() {
    return this._loadStatus;
  }
  load(t31, r39) {
    return this._loadStatus === l21.LOADED ? (t31 && t31(), this._loader ?? Promise.resolve()) : this._loadStatus === l21.FAILED ? (r39 && r39(this._loadError), this._loader ?? Promise.resolve()) : (null == this._loader && (this._abortController = new AbortController(), this._loader = this.doLoad(this._abortController.signal).then(() => {
      this._abortController = null, this._loadStatus = l21.LOADED;
    }, (t32) => {
      throw this._loadError = t32, this._abortController = null, this._loadStatus = l21.FAILED, !b(t32) && this.logger && t32.message && this.logger.warn(t32.message), t32;
    })), this._loader.then(t31, r39).catch(() => {
    }), this._loader);
  }
  abortLoad() {
    null != this._abortController ? this._abortController = e2(this._abortController) : this._loadStatus === l21.LOADING && (this._loadStatus = l21.FAILED), this._loader = null;
  }
};
var l21;
!function(t31) {
  t31[t31.LOADING = 0] = "LOADING", t31[t31.LOADED = 1] = "LOADED", t31[t31.FAILED = 2] = "FAILED";
}(l21 || (l21 = {}));

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolLayer.js
var u19 = () => n.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
var y6 = class extends r25 {
  constructor(e43, t31, i20, r39) {
    super(i20.schedule), this.symbol = e43, this.symbolLayer = t31, this._context = i20, this.ignoreDrivers = false, this._drivenProperties = {
      color: false,
      opacity: false,
      opacityAlwaysOpaque: true,
      size: false
    }, this._materials = [], this.usedMemory = 0, this.logger = u19(), this._elevationOptions = {
      supportsOffsetAdjustment: false,
      supportsOnTheGround: true
    }, this.skipHighSymbolLodsChanged = true, this._renderPriority = r39.renderPriority, this._renderPriorityStep = r39.renderPriorityStep, this._elevationContext = new o15(), this.complexity = this.computeComplexity(), this.ignoreDrivers = r39.ignoreDrivers, this.ignoreDrivers || (this._drivenProperties = f15(this._context.renderer)), this._updateElevationContext();
  }
  getCachedSize() {
    return null;
  }
  get extentPadding() {
    return 0;
  }
  get materials() {
    return this._materials;
  }
  _drivenPropertiesChanged(e43) {
    if (this.ignoreDrivers) return false;
    const t31 = this._drivenProperties, i20 = f15(e43);
    return i20.color !== t31.color || i20.opacity !== t31.opacity || i20.opacityAlwaysOpaque !== t31.opacityAlwaysOpaque || i20.size !== t31.size;
  }
  get needsDrivenTransparentPass() {
    return this._drivenProperties.opacity && !this._drivenProperties.opacityAlwaysOpaque;
  }
  _logGeometryCreationWarnings(e43, t31, i20, r39) {
    const o27 = e43.projectionSuccess, n28 = "polygons" in e43 ? e43.polygons : null, s33 = `${r39} geometry failed to be created`;
    o27 ? !this._logGeometryValidationWarnings(t31, i20, r39) && n28 && 0 === n28.length && "rings" === i20 && t31.length > 0 && t31[0].length > 2 && u19().warnOncePerTick(`${s33} (filled rings should use clockwise winding - try reversing the order of vertices)`) : u19().warnOncePerTick(`${s33} (failed to project geometry to view spatial reference)`);
  }
  _logGeometryValidationWarnings(e43, t31, i20) {
    const r39 = `${i20} geometry failed to be created`;
    return !e43.length || 1 === e43.length && !e43[0].length ? (u19().warnOncePerTick(`${r39} (no ${t31} were defined)`), true) : (!Array.isArray(e43) || !Array.isArray(e43[0])) && (u19().warnOncePerTick(`${r39} (${t31} should be defined as a 2D array)`), true);
  }
  _validateGeometry(e43, t31 = null, i20 = null) {
    if (null != t31 && !t31.includes(e43.type)) return this.logger.warn("unsupported geometry type for " + i20 + ` symbol: ${e43.type}`), false;
    switch (e43.type) {
      case "point": {
        const t32 = e43;
        if (!isFinite(t32.x) || !isFinite(t32.y)) return u19().warn("point coordinate is not a valid number, graphic skipped"), false;
        break;
      }
      case "polygon":
        g2(e43) && u19().warnOncePerTick("Fixed a non-closed polygon ring.");
    }
    return true;
  }
  _defaultElevationInfoNoZ() {
    return g7;
  }
  _defaultElevationInfoZ() {
    return m12;
  }
  _updateElevationContext() {
    null != this._elevationInfoOverride ? (this._elevationContext.setFromElevationInfo(this._elevationInfoOverride), this._elevationContext.updateFeatureExpressionInfoContext(null)) : this._context.layer.elevationInfo ? (this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo), this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)) : this._elevationContext.reset();
  }
  getDefaultElevationInfo(e43) {
    return e43.hasZ ? this._defaultElevationInfoZ() : this._defaultElevationInfoNoZ();
  }
  getGeometryElevationMode(e43, t31 = this.getDefaultElevationInfo(e43)) {
    return this._elevationContext.mode || t31.mode;
  }
  setElevationInfoOverride(e43) {
    this._elevationInfoOverride = e43, this._updateElevationContext();
  }
  setGraphicElevationContext(e43, t31 = new o15()) {
    const i20 = e43.geometry, r39 = this.getDefaultElevationInfo(i20);
    t31.unit = null != this._elevationContext.unit ? this._elevationContext.unit : r39.unit, t31.mode = this.getGeometryElevationMode(i20, r39), t31.offsetMeters = this._elevationContext.meterUnitOffset ?? r39.offset ?? 0;
    const o27 = !this._elevationOptions.supportsOnTheGround && "on-the-ground" === t31.mode;
    o27 && (t31.mode = "relative-to-ground", t31.offsetMeters = 0);
    const n28 = o27 ? f12 : this._elevationContext.featureExpressionInfoContext;
    return t31.updateFeatureExpressionInfoContext(n28, e43, this._context.layer), t31;
  }
  prepareSymbolLayerPatch(e43) {
  }
  updateGeometry(e43, t31) {
    return false;
  }
  updateTransform(e43, t31, i20, r39) {
    return false;
  }
  onRemoveGraphic(e43) {
  }
  _getLayerOpacity() {
    if (this._context.graphicsCoreOwner && "fullOpacity" in this._context.graphicsCoreOwner) return this._context.graphicsCoreOwner.fullOpacity ?? 0;
    const e43 = this._context.layer.opacity;
    return e43 ?? 1;
  }
  _getCombinedOpacity(e43, t31 = v6) {
    let i20 = 1;
    return this.draped || (i20 *= this._getLayerOpacity()), this._drivenProperties.opacity || (null != e43 ? i20 *= e43.a : t31.hasIntrinsicColor || (i20 = 0)), i20;
  }
  _getCombinedOpacityAndColor(t31, r39 = v6) {
    const o27 = this._getCombinedOpacity(t31, r39);
    if (this._drivenProperties.color) return F4(null, o27);
    const n28 = null != t31 ? u9.toUnitRGB(t31) : _2;
    return F4(n28, o27);
  }
  _getVertexOpacityAndColor(e43, t31 = null) {
    const i20 = this._drivenProperties.color ? e43.color : null, r39 = this._drivenProperties.opacity ? e43.opacity : null, o27 = F4(i20, r39);
    return t31 && (o27[0] *= t31, o27[1] *= t31, o27[2] *= t31, o27[3] *= t31), o27;
  }
  isFastUpdatesEnabled() {
    return null != this._fastUpdates;
  }
  computeComplexity() {
    return p13(this.symbol, this.symbolLayer);
  }
  globalPropertyChanged(e43, t31, i20) {
    switch (e43) {
      case "opacity":
        return this.layerOpacityChanged(t31, i20), true;
      case "elevationInfo": {
        const e44 = this._elevationContext.mode;
        this._updateElevationContext();
        return this.layerElevationInfoChanged(t31, i20, e44) !== b6.RECREATE;
      }
      case "slicePlaneEnabled":
        return this.slicePlaneEnabledChanged(t31, i20);
      case "physicalBasedRenderingEnabled":
        return this.physicalBasedRenderingChanged();
      case "pixelRatio":
        return this.pixelRatioChanged;
      case "skipHighSymbolLods":
        return this.skipHighSymbolLodsChanged;
      default:
        return false;
    }
  }
  get pixelRatioChanged() {
    return true;
  }
  updateGraphics3DGraphicElevationInfo(e43, t31, i20) {
    let r39 = b6.UPDATE;
    return e43.forEach((e44) => {
      const o27 = t31(e44);
      if (null != o27) {
        const t32 = e44.graphic;
        this.setGraphicElevationContext(t32, o27.elevationContext), o27.needsElevationUpdates = i20(o27.elevationContext.mode);
      } else r39 = b6.RECREATE;
    }), r39;
  }
  applyRendererDiff(e43, t31) {
    return e33.RecreateSymbol;
  }
  getFastUpdateAttrValues(e43) {
    if (!this._fastUpdates) return null;
    const t31 = this._fastUpdates.visualVariables, i20 = t31.size ? X(t31.size.field, e43) : 0, o27 = t31.color ? X(t31.color.field, e43) : 0, n28 = t31.opacity ? X(t31.opacity.field, e43) : 0;
    return r5(i20, o27, n28, 0);
  }
  get draped() {
    return this._draped;
  }
  ensureDrapedStatus(e43) {
    return null == this._draped ? (this._draped = e43, true) : (e43 !== this.draped && u19().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."), false);
  }
  test() {
    const e43 = () => ({
      size: this._fastUpdates?.visualVariables.size?.field ?? null,
      color: this._fastUpdates?.visualVariables.color?.field ?? null,
      opacity: this._fastUpdates?.visualVariables.opacity?.field ?? null,
      rotation: this._fastUpdates?.visualVariables.rotation?.field ?? null
    });
    return {
      drivenProperties: this._drivenProperties,
      getVisVarFields: e43
    };
  }
};
function f15(e43) {
  const t31 = {
    color: false,
    opacity: false,
    opacityAlwaysOpaque: true,
    size: false
  };
  return e43 && "visualVariables" in e43 && e43.visualVariables && e43.visualVariables.forEach((e44) => {
    switch (e44.type) {
      case "color":
        if (t31.color = true, e44.stops) for (let i20 = 0; i20 < e44.stops.length; i20++) {
          const r39 = e44.stops[i20].color;
          r39 && (t31.opacity = true, r39.a < 1 && (t31.opacityAlwaysOpaque = false));
        }
        break;
      case "opacity":
        t31.opacity = true, t31.opacityAlwaysOpaque = false;
        break;
      case "size":
        t31.size = true;
    }
  }), t31;
}
var g7 = {
  mode: "on-the-ground",
  offset: 0,
  unit: "meters"
};
var m12 = {
  mode: "absolute-height",
  offset: 0,
  unit: "meters"
};
var v6 = {
  hasIntrinsicColor: false
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/pointUtils.js
function a18(e43, r39, t31, o27, n28) {
  if (u20(e43, r39)) return null;
  t31.localOrigin = d13(e43, r39);
  const i20 = new O10({
    geometries: [t31],
    castShadow: false,
    layerUid: e43.layer.uid,
    graphicUid: n28,
    usesVerticalDistanceToGround: true
  });
  return {
    object: i20,
    sampledElevation: p9(i20, r39, e43.elevationProvider, e43.renderCoordsHelper, o27)
  };
}
function p14(e43, r39, t31, o27) {
  if (u20(r39, t31)) return null;
  return p9(e43, t31, r39.elevationProvider, r39.renderCoordsHelper, o27);
}
function u20(e43, o27) {
  const n28 = e43.clippingExtent;
  return !!n28 && (c6(o27, g8, e43.elevationProvider.spatialReference), !y2(n28, g8));
}
function m13(e43, t31, o27) {
  const n28 = e43.elevationContext, l35 = o27.spatialReference;
  c6(t31, g8, l35), n28.centerPointInElevationSR = e13(g8[0], g8[1], t31.hasZ ? g8[2] : 0, null != l35 ? l35 : null);
}
function f16(e43) {
  switch (e43.type) {
    case "point":
      return e43;
    case "polygon":
    case "extent":
      return b7(e43);
    case "polyline": {
      const r39 = e43.paths[0];
      if (!r39 || 0 === r39.length) return null;
      const t31 = p(r39, h2(r39) / 2);
      return e13(t31[0], t31[1], t31[2], e43.spatialReference);
    }
    case "mesh":
      return e43.origin;
  }
  return null;
}
function d13(e43, t31) {
  return c6(t31, g8, e43.renderCoordsHelper.spatialReference), e43.localOriginFactory.getOrigin(g8);
}
var g8 = n2();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineCalloutTechnique.js
var h13 = class _h extends r14 {
  initializeConfiguration(i20, t31) {
    t31.spherical = i20.viewingMode === l8.Global;
  }
  initializeProgram(e43) {
    return new r15(e43.rctx, _h.shader.get().build(this.configuration), O6);
  }
  setPipelineState(e43) {
    const i20 = e43 ? O5.ALWAYS : O5.LESS;
    return this.configuration.depthHudEnabled ? S6({
      depthTest: {
        func: i20
      },
      depthWrite: o12
    }) : S6({
      blending: l14(R3.ONE, R3.SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: i20
      },
      colorWrite: _7
    });
  }
  initializePipeline() {
    return this.setPipelineState(this.configuration.multipassEnabled);
  }
};
h13.shader = new t16(h11, () => import("./LineCallout.glsl-YQ3KA6JG.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration.js
var s21 = class extends t20 {
  constructor() {
    super(...arguments), this.screenCenterOffsetUnitsEnabled = false, this.spherical = false, this.occlusionTestEnabled = true, this.hasVerticalOffset = false, this.hasScreenSizePerspective = false, this.depthHudEnabled = false, this.depthHudAlignStartEnabled = false, this.hasSlicePlane = false, this.multipassEnabled = false;
  }
};
e5([r17()], s21.prototype, "screenCenterOffsetUnitsEnabled", void 0), e5([r17()], s21.prototype, "spherical", void 0), e5([r17()], s21.prototype, "occlusionTestEnabled", void 0), e5([r17()], s21.prototype, "hasVerticalOffset", void 0), e5([r17()], s21.prototype, "hasScreenSizePerspective", void 0), e5([r17()], s21.prototype, "depthHudEnabled", void 0), e5([r17()], s21.prototype, "depthHudAlignStartEnabled", void 0), e5([r17()], s21.prototype, "hasSlicePlane", void 0), e5([r17()], s21.prototype, "multipassEnabled", void 0), e5([r17({
  constValue: true
})], s21.prototype, "hasSliceInVertexProgram", void 0), e5([r17({
  constValue: false
})], s21.prototype, "draped", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/LineCalloutMaterial.js
var m14 = class _m extends c16 {
  get uniqueMaterialIdentifier() {
    return this._uniqueMaterialIdentifier;
  }
  constructor(e43) {
    super(e43, new g9()), this.produces = /* @__PURE__ */ new Map([[E6.LINE_CALLOUTS, (e44) => e44 === o7.Color], [E6.LINE_CALLOUTS_HUD_DEPTH, (e44) => e44 === o7.Color]]), this._configuration = new s21(), this._uniqueMaterialIdentifier = _m.uniqueMaterialIdentifier(this.parameters);
  }
  passParameters() {
    return this.parameters;
  }
  getConfiguration(e43, t31) {
    const r39 = t31?.slot !== E6.LINE_CALLOUTS;
    return this._configuration.occlusionTestEnabled = this.parameters.occlusionTest, this._configuration.hasVerticalOffset = null != this.parameters.verticalOffset, this._configuration.hasScreenSizePerspective = null != this.parameters.screenSizePerspective, this._configuration.depthHudEnabled = r39, this._configuration.depthHudAlignStartEnabled = !!this.parameters.depthHUDAlignStart, this._configuration.screenCenterOffsetUnitsEnabled = "screen" === this.parameters.centerOffsetUnits, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.multipassEnabled = t31.multipassEnabled, this._configuration;
  }
  intersect() {
  }
  createGLMaterial(e43) {
    return new p15(e43);
  }
  createBufferWriter() {
    return new b10();
  }
  validateParameters(e43) {
    const t31 = _m.uniqueMaterialIdentifier(e43);
    t31 !== this._uniqueMaterialIdentifier && (this._uniqueMaterialIdentifier = t31);
  }
  static uniqueMaterialIdentifier({
    renderOccluded: t31,
    isDecoration: r39,
    horizontalScreenOffset: i20,
    color: s33,
    size: n28,
    occlusionTest: a30,
    shaderPolygonOffset: o27,
    depthHUDAlignStart: l35,
    centerOffsetUnits: c33,
    hasSlicePlane: u32,
    screenSizePerspective: f26,
    verticalOffset: h23,
    borderColor: d21
  }) {
    return f`${t31}:${r39}:${i20}:[${s33}]:${n28}:${a30}:${o27}:${l35}:${c33}:${u32}:${null != f26}:{${h23.screenLength}:${h23.minWorldLength}:${h23.maxWorldLength}}:[${d21}]`;
  }
};
var p15 = class extends t15 {
  beginSlot(e43) {
    return this.ensureTechnique(h13, e43);
  }
};
var g9 = class extends u14 {
  constructor() {
    super(...arguments), this.horizontalScreenOffset = 0, this.color = [0, 0, 0, 1], this.size = 1, this.occlusionTest = false, this.shaderPolygonOffset = 1e-5, this.depthHUDAlignStart = false, this.centerOffsetUnits = "world", this.hasSlicePlane = false;
  }
};
var O13 = H2().vec3f(e16.POSITION).vec3f(e16.NORMAL).vec2f(e16.UV0).vec4f(e16.CENTEROFFSETANDDISTANCE);
var S10 = [t13(0, 0), t13(1, 0), t13(0, 1), t13(1, 0), t13(1, 1), t13(0, 1)];
var b10 = class {
  constructor() {
    this.vertexBufferLayout = O13;
  }
  elementCount(e43) {
    return 6 * e43.attributes.get(e16.POSITION).indices.length;
  }
  write(e43, t31, r39, i20, s33) {
    b5(r39.attributes.get(e16.POSITION), e43, i20.position, s33, 6), O8(r39.attributes.get(e16.NORMAL), t31, i20.normal, s33, 6), p7(r39.attributes.get(e16.CENTEROFFSETANDDISTANCE), i20.centerOffsetAndDistance, s33, 6);
    for (let n28 = 0; n28 < S10.length; ++n28) i20.uv0.setVec(s33 + n28, S10[n28]);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer.js
var E13 = class _E extends y6 {
  constructor(e43, t31) {
    super(e43, null, t31, w5), this._elevationOptions = {
      supportsOffsetAdjustment: true,
      supportsOnTheGround: false
    }, this.ensureDrapedStatus(false);
  }
  doLoad() {
    return __async(this, null, function* () {
      this._materials[0] = new m14(this._materialParameters), this._context.stage.add(this._materials[0]);
    });
  }
  destroy() {
    super.destroy(), this._context.stage.remove(this._materials[0]), this._materials.length = 0;
  }
  _perInstanceMaterialParameters(e43) {
    const t31 = this._materialParameters;
    return t31.horizontalScreenOffset = e43.horizontalScreenOffset ?? 0, t31.centerOffsetUnits = e43.centerOffsetUnits || "world", t31;
  }
  get _materialParameters() {
    const r39 = new g9(), i20 = this.symbol, n28 = i20.callout;
    if (r39.color = null != n28.color ? u9.toUnitRGBA(n28.color) : [0, 0, 0, 0], r39.color[3] *= this._getLayerOpacity(), r39.size = u8(n28.size || 0), i20.verticalOffset) {
      const {
        screenLength: e43,
        minWorldLength: n29,
        maxWorldLength: a31
      } = i20.verticalOffset;
      r39.verticalOffset = {
        screenLength: u8(e43),
        minWorldLength: n29 || 0,
        maxWorldLength: null != a31 ? a31 : 1 / 0
      };
    }
    r39.borderColor = null != n28.border?.color ? u9.toUnitRGBA(n28.border.color) : null;
    const a30 = "object" === i20.symbolLayers.at(0).type, o27 = "label-3d" === i20.type;
    return r39.occlusionTest = !a30, r39.shaderPolygonOffset = a30 ? 0 : void 0, r39.depthHUDAlignStart = o27, r39.hasSlicePlane = this._context.slicePlaneEnabled, r39.screenSizePerspective = this._context.screenSizePerspectiveEnabled ? this._context.sharedResources.screenSizePerspectiveSettings : null, r39;
  }
  _defaultElevationInfoNoZ() {
    return U4;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.renderingInfo, r39 = e43.graphic, i20 = this.setGraphicElevationContext(r39, new o15(), t31.elevationOffset || 0), a30 = t31.symbol, o27 = "on-the-ground" === this._elevationContext.mode && ("cim" === a30.type || !a30.symbolLayers.some((e44) => "object" === e44.type || "text" === e44.type));
    if ("label-3d" !== a30.type && o27) return null;
    if ("point-3d" === a30.type && a30.symbolLayers.every((e44) => "text" === e44.type && !l5(e44))) return null;
    const s33 = b7(r39.geometry);
    return null == s33 ? null : this._createAs3DShape(s33, i20, t31, r39.uid);
  }
  layerOpacityChanged() {
    this._materials[0]?.setParameters(this._materialParameters);
  }
  layerElevationInfoChanged(e43, t31, r39) {
    const i20 = this._elevationContext.mode, n28 = m9(_E.elevationModeChangeTypes, r39, i20);
    return n28 !== b6.UPDATE || e43.forEach((e44) => {
      const r40 = t31(e44);
      null != r40 && this.updateGraphicElevationContext(e44.graphic, r40);
    }), n28;
  }
  slicePlaneEnabledChanged() {
    return this._materials[0]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  setGraphicElevationContext(e43, t31, r39 = 0) {
    return super.setGraphicElevationContext(e43, t31), t31.addOffsetRenderUnits(r39), t31;
  }
  updateGraphicElevationContext(e43, t31) {
    this.setGraphicElevationContext(e43, t31.elevationContext, null != t31.metadata ? t31.metadata.elevationOffset : 0), t31.needsElevationUpdates = d7(t31.elevationContext.mode);
  }
  computeComplexity() {
    return new e32({
      verticesPerFeature: 6
    });
  }
  _getOrCreateMaterial(e43) {
    const t31 = this._perInstanceMaterialParameters(e43), r39 = m14.uniqueMaterialIdentifier(t31);
    if (r39 === this._materials[0]?.uniqueMaterialIdentifier) return {
      material: this._materials[0],
      isUnique: false
    };
    if (null != e43.materialCollection) {
      let i20 = e43.materialCollection.get(r39);
      return null == i20 && (i20 = new m14(t31), e43.materialCollection.add(r39, i20)), {
        material: i20,
        isUnique: false
      };
    }
    return {
      material: new m14(t31),
      isUnique: true
    };
  }
  _createAs3DShape(e43, t31, r39, i20) {
    const n28 = this._context.layer.uid, o27 = this._context.stage.renderView.getObjectAndLayerIdColor({
      graphicUid: i20,
      layerUid: n28
    }), s33 = this._getOrCreateMaterial(r39), c33 = new I4(s33.material, j12(r39), null, e25.Point, o27), m22 = a18(this._context, e43, c33, t31, i20);
    if (null == m22) return null;
    const p23 = new p12(this, m22.object, [c33], s33.isUnique ? [s33.material] : null, null, p11, t31);
    return p23.metadata = new t24(r39.elevationOffset), p23.alignedSampledElevation = m22.sampledElevation, p23.needsElevationUpdates = d7(t31.mode), m13(p23, e43, this._context.elevationProvider), p23;
  }
};
function j12(e43) {
  const {
    translation: t31,
    centerOffset: r39
  } = e43, i20 = new t7(t31 ? [t31[0], t31[1], t31[2]] : [0, 0, 0], P4, 3, true), n28 = new t7(r39 ? [r39[0], r39[1], r39[2], r39[3]] : [0, 0, 0, 1], P4, 4, true);
  return [[e16.POSITION, i20], [e16.NORMAL, new t7([0, 0, 1], P4, 3, true)], [e16.CENTEROFFSETANDDISTANCE, n28]];
}
E13.elevationModeChangeTypes = {
  definedChanged: b6.UPDATE,
  staysOnTheGround: b6.UPDATE,
  onTheGroundChanged: b6.RECREATE
};
var P4 = [0];
var U4 = {
  mode: "relative-to-ground",
  offset: 0
};
var w5 = {
  ignoreDrivers: true,
  renderPriority: 0,
  renderPriorityStep: 1
};
var G6 = class {
  constructor(e43, t31, n28 = n2(), a30 = n7(), o27 = 0, s33 = "world", l35 = 0, c33 = null) {
    this.renderer = e43, this.symbol = t31, this.translation = n28, this.centerOffset = a30, this.horizontalScreenOffset = o27, this.centerOffsetUnits = s33, this.elevationOffset = l35, this.materialCollection = c33;
  }
};
var S11 = class extends r22 {
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory.js
var t27 = () => n.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");
function e34(o27, l35) {
  if (!o5(o27)) return t27().error("Graphics3DCalloutSymbolLayerFactory#make", `symbol of type '${o27.type}' does not support callouts`), null;
  if (!o27.callout) return null;
  const e43 = a19[o27.callout.type];
  return e43 ? new e43(o27, l35) : (t27().error("Graphics3DCalloutSymbolLayerFactory#make", `unknown or unsupported callout type ${o27.callout.type}`), null);
}
var a19 = {
  line: E13
};

// ../../../node_modules/@arcgis/core/renderers/support/renderingInfoUtils.js
function o19(t31, e43) {
  if (!t31 || t31.symbol) return null;
  const o27 = e43?.renderer;
  return t31 && null != o27 && o27.getObservationRenderer ? o27.getObservationRenderer(t31) : o27;
}
function r26(t31, e43) {
  if (null != t31.symbol) return t31.symbol;
  const r39 = o19(t31, e43);
  return null != r39 && "dot-density" !== r39.type ? r39.getSymbol(t31, e43) : null;
}
function i13(t31, i20) {
  const n28 = o19(t31, i20), l35 = r26(t31, i20);
  if (null == l35) return null;
  const a30 = {
    renderer: n28,
    symbol: l35
  };
  if (null == n28 || !("visualVariables" in n28) || !n28.visualVariables) return a30;
  const s33 = R2(n28, t31, i20) ?? [], u32 = ["proportional", "proportional", "proportional"];
  for (const {
    variable: e43,
    value: o27
  } of s33) switch (e43.type) {
    case "color":
      a30.color = o27.toRgba();
      break;
    case "size":
      if ("outline" === e43.target) a30.outlineSize = o27;
      else {
        const t32 = e43.axis, r39 = e43.useSymbolValue ? "symbol-value" : o27;
        switch (t32) {
          case "width":
            u32[0] = r39;
            break;
          case "depth":
            u32[1] = r39;
            break;
          case "height":
            u32[2] = r39;
            break;
          case "width-and-depth":
            u32[0] = u32[1] = r39;
            break;
          default:
            u32[0] = u32[1] = u32[2] = r39;
        }
      }
      break;
    case "opacity":
      a30.opacity = o27;
      break;
    case "rotation":
      switch (e43.axis) {
        case "tilt":
          a30.tilt = o27;
          break;
        case "roll":
          a30.roll = o27;
          break;
        default:
          a30.heading = o27;
      }
  }
  return "proportional" === u32[0] && "proportional" === u32[1] && "proportional" === u32[2] || (a30.size = u32), a30;
}
function n18(t31, e43) {
  return __async(this, null, function* () {
    if (null != t31.symbol) return t31.symbol;
    const r39 = o19(t31, e43);
    return null != r39 ? r39.getSymbolAsync(t31, e43) : null;
  });
}
function l22(r39, i20) {
  return __async(this, null, function* () {
    const l35 = o19(r39, i20), a30 = yield n18(r39, i20);
    if (!a30) return null;
    const s33 = {
      renderer: l35,
      symbol: a30
    };
    if (!l35 || !("visualVariables" in l35) || !l35.visualVariables) return s33;
    const u32 = R2(l35, r39, i20) ?? [], c33 = ["proportional", "proportional", "proportional"];
    for (const {
      variable: e43,
      value: o27
    } of u32) if ("color" === e43.type) s33.color = u9.toUnitRGBA(o27);
    else if ("size" === e43.type) {
      if ("outline" === e43.target) s33.outlineSize = o27;
      else {
        const t31 = e43.axis, r40 = e43.useSymbolValue ? "symbol-value" : o27;
        "width" === t31 ? c33[0] = r40 : "depth" === t31 ? c33[1] = r40 : "height" === t31 ? c33[2] = r40 : c33[0] = c33[1] = "width-and-depth" === t31 ? r40 : c33[2] = r40;
      }
    } else "opacity" === e43.type ? s33.opacity = o27 : "rotation" === e43.type && "tilt" === e43.axis ? s33.tilt = o27 : "rotation" === e43.type && "roll" === e43.axis ? s33.roll = o27 : "rotation" === e43.type && (s33.heading = o27);
    return (isFinite(c33[0]) || isFinite(c33[1]) || isFinite(c33[2])) && (s33.size = c33), s33;
  });
}
function a20(t31, e43 = 0) {
  const o27 = t31[e43];
  return "number" == typeof o27 && isFinite(o27) ? o27 : null;
}
function s22(t31) {
  for (let e43 = 0; e43 < 3; e43++) {
    const o27 = t31[e43];
    if ("number" == typeof o27) return isFinite(o27) ? o27 : 0;
  }
  return 0;
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/constants.js
var r27 = 1.2;
var t28 = _4;
var c21 = 4;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextHelperCanvas.js
function a21(a30, n28, c33) {
  return a30.canvas || (a30.canvas = document.createElement("canvas")), a30.canvas.width = n28, a30.canvas.height = c33, a30.canvas;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/FontMetrics.js
function e35(e43) {
  const {
    size: c33
  } = e43.definition, a30 = e43.fontString(c33);
  let i20 = n19.get(a30);
  if (!i20) {
    const u32 = a21(o20, 0, 0).getContext("2d");
    e43.setFontProperties(u32, c33);
    const x12 = u32.measureText(r28);
    i20 = new s23(x12.actualBoundingBoxAscent, x12.actualBoundingBoxDescent), n19.set(a30, i20);
  }
  return i20;
}
var n19 = /* @__PURE__ */ new Map();
var s23 = class {
  get maxHeight() {
    return this.maxAscent + this.maxDescent;
  }
  constructor(t31, e43) {
    this.maxAscent = t31, this.maxDescent = e43;
  }
};
var o20 = {
  canvas: null
};
var r28 = (() => {
  let t31 = "";
  for (let e43 = 32; e43 < 127; e43++) t31 += String.fromCharCode(e43);
  return t31;
})();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextRenderer.js
var s24 = 1;
var r29 = class {
  constructor(t31, e43, i20, n28) {
    this.text = t31, this._alignment = e43, this._parameters = i20, this._maxSize = n28, this._textWidths = [], this._lineWidths = [], this._renderPixelRatio = null, this._metricsCached = null, this.key = `TextRenderer-${this._parameters.key}-${this._alignment}--${t31}`, this._lines = t31.replaceAll(" ", " ").split(/\r?\n/);
  }
  get displayWidth() {
    return Math.ceil(this._displayWidth + 2 * this._horizontalPadding);
  }
  get displayHeight() {
    let t31 = this._metrics.firstLineAscent;
    for (let e43 = 0; e43 < this._lines.length - 1; e43++) t31 += this._lineSpacing;
    return t31 += this._metrics.lastLineDescent, Math.ceil(t31 + 2 * this._haloSize + 2 * this._verticalPadding);
  }
  get renderedWidth() {
    return this._toRoundedRenderUnit(this.displayWidth);
  }
  get renderedHeight() {
    return this._toRoundedRenderUnit(this.displayHeight);
  }
  get firstRenderedBaselinePosition() {
    return this._toRenderUnit(this._firstLineYOffset + this._metrics.firstLineAscent);
  }
  get _firstLineYOffset() {
    return this._verticalPadding + this._haloSize;
  }
  get _metrics() {
    if (null == this._metricsCached) {
      const t31 = a21(a22, l23, l23).getContext("2d"), e43 = this._parameters.definition.pixelRatio, s33 = this._fontSize * e43;
      this._parameters.setFontProperties(t31, s33);
      let r39 = 2 * this._haloSize;
      const h23 = this._parameters.definition.font;
      "italic" !== h23.style && "oblique" !== h23.style && "bold" !== h23.weight && "bolder" !== h23.weight || (r39 += 0.3 * t31.measureText("A").width), this._textWidths.length = 0, this._lineWidths.length = 0;
      let o27 = 0, d21 = 0, _16 = 0, g17 = 0, m22 = 0;
      this._lines.forEach((i20, n28) => {
        const s34 = t31.measureText(i20), h24 = s34.width / e43, a30 = h24 + r39;
        this._textWidths.push(h24), this._lineWidths.push(a30), o27 = Math.max(o27, a30), g17 = Math.max(g17, s34.actualBoundingBoxAscent / e43), m22 = Math.max(m22, s34.actualBoundingBoxDescent / e43), 0 === n28 && (d21 = s34.actualBoundingBoxAscent / e43), n28 === this._lines.length - 1 && (_16 = s34.actualBoundingBoxDescent / e43);
      });
      const f26 = e35(this._parameters), u32 = Math.max(g17, f26.maxAscent), p23 = Math.max(m22, f26.maxDescent), x12 = d21, R10 = "underline" === this._parameters.definition.font.decoration ? p23 : _16, S19 = o27;
      this._metricsCached = new c22(x12, R10, u32, p23, S19);
    }
    return this._metricsCached;
  }
  get _lineSpacing() {
    return (this._midLineHeight + this._linePadding) * this._parameters.definition.lineSpacingFactor;
  }
  get _midLineHeight() {
    return this._metrics.midLineHeight;
  }
  get _linePadding() {
    return this._midLineHeight * d14;
  }
  get _midLineAscent() {
    return this._metrics.maxLineAscent;
  }
  get _renderedFontSize() {
    return this._toRenderUnit(this._fontSize);
  }
  get _fontSize() {
    return this._parameters.definition.size;
  }
  get _renderedHaloSize() {
    return this._toRenderUnit(this._haloSize);
  }
  get _haloSize() {
    return this._parameters.haloSize;
  }
  get _horizontalPadding() {
    return this._hasBackground ? this._parameters.definition.background.padding[0] : 0;
  }
  get _verticalPadding() {
    return Math.max(this._hasBackground ? this._parameters.definition.background.padding[1] : 0, s24);
  }
  get _hasBackground() {
    return !!this._parameters.backgroundStyle;
  }
  get renderPixelRatio() {
    if (null == this._renderPixelRatio) {
      const t31 = this._parameters.definition.pixelRatio;
      this._renderPixelRatio = Math.min(t31, Math.min(this._maxSize[0] / this.displayWidth, this._maxSize[1] / this.displayHeight));
    }
    return this._renderPixelRatio;
  }
  _getLineXOffset(t31) {
    switch (this._alignment) {
      case o21.Left:
        return this._horizontalPadding;
      case o21.Center:
        return (this.displayWidth - this._lineWidths[t31]) / 2;
      case o21.Right:
        return this.displayWidth - this._horizontalPadding - this._lineWidths[t31];
    }
  }
  render(t31, i20, n28) {
    t31.save();
    const s33 = i20 /= this.renderPixelRatio, r39 = n28 /= this.renderPixelRatio, h23 = this._haloSize, o27 = this._firstLineYOffset + this._metrics.firstLineAscent;
    i20 += h23, n28 += o27;
    const a30 = this._haloSize > 0;
    a30 && this._renderHalo(t31, s33, r39, h23, o27), this._parameters.setFontProperties(t31, this._renderedFontSize);
    for (let e43 = 0; e43 < this._lines.length; ++e43) {
      const s34 = this._lines[e43], r40 = this._getLineXOffset(e43);
      a30 && (t31.globalCompositeOperation = "destination-out", t31.fillStyle = "rgb(0, 0, 0)", this._fillText(t31, s34, i20 + r40, n28), this._renderLineDecoration(t31, i20 + r40, n28, this._textWidths[e43])), t31.globalCompositeOperation = "source-over", t31.fillStyle = this._parameters.textStyle, this._fillText(t31, s34, i20 + this._getLineXOffset(e43), n28), this._renderLineDecoration(t31, i20 + r40, n28, this._textWidths[e43]), n28 += this._lineSpacing;
    }
    if (t18.TEXT_SHOW_BASELINE) {
      t31.strokeStyle = _10, t31.setLineDash([2, 2]), t31.lineWidth = 1;
      let e43 = r39 + o27;
      for (let i21 = 0; i21 < this._lines.length; ++i21) this._drawLine(t31, [s33, e43], [s33 + this.displayWidth, e43]), e43 += this._lineSpacing;
    }
    if (t18.TEXT_SHOW_BORDER && (t31.strokeStyle = _10, t31.setLineDash([]), t31.lineWidth = 1, this._drawBox(t31, [s33, r39], [this.displayWidth, this.displayHeight])), this._hasBackground) {
      const e43 = this._parameters.definition.background.borderRadius * this.renderPixelRatio;
      this._roundedRect(t31, s33, r39, e43), t31.globalCompositeOperation = "destination-over", t31.fillStyle = this._parameters.backgroundStyle, t31.fill();
    }
    t31.restore();
  }
  _renderLineDecoration(t31, e43, i20, n28, s33 = false) {
    if ("none" === this._parameters.definition.font.decoration || 0 === n28) return;
    const r39 = 1, h23 = Math.max(this._parameters.definition.size / 16, r39);
    switch (this._parameters.definition.font.decoration) {
      case "underline":
        i20 += 2 * h23;
        break;
      case "line-through":
        i20 -= 0.33 * this._midLineAscent;
    }
    const o27 = s33 ? this._haloSize : 0;
    t31.strokeStyle = s33 ? this._parameters.haloStyle : this._parameters.textStyle, t31.lineWidth = this._toRenderUnit(h23 + 2 * o27), t31.beginPath(), t31.moveTo(this._toRenderUnit(e43 - o27), this._toRenderUnit(i20)), t31.lineTo(this._toRenderUnit(e43 + n28 + o27), this._toRenderUnit(i20)), t31.stroke();
  }
  _roundedRect(e43, i20, n28, s33) {
    i20 = this._toRenderUnit(i20), n28 = this._toRenderUnit(n28);
    const r39 = this.renderedWidth, h23 = this.renderedHeight;
    0 !== s33 ? (s33 = e9(s33, 0, Math.floor(h23 / 2)), e43.beginPath(), e43.moveTo(i20, n28 + s33), e43.arcTo(i20, n28, i20 + s33, n28, s33), e43.lineTo(i20 + r39 - s33, n28), e43.arcTo(i20 + r39, n28, i20 + r39, n28 + s33, s33), e43.lineTo(i20 + r39, n28 + h23 - s33), e43.arcTo(i20 + r39, n28 + h23, i20 + r39 - s33, n28 + h23, s33), e43.lineTo(i20 + s33, n28 + h23), e43.arcTo(i20, n28 + h23, i20, n28 + h23 - s33, s33), e43.closePath()) : e43.rect(i20, n28, r39, h23);
  }
  _renderHalo(t31, e43, i20, s33, r39) {
    const h23 = this.renderedWidth, o27 = this.renderedHeight, d21 = a21(a22, Math.max(h23, l23), Math.max(o27, l23)), _16 = d21.getContext("2d");
    _16.clearRect(0, 0, h23, o27), this._parameters.setFontProperties(_16, this._renderedFontSize), _16.fillStyle = this._parameters.haloStyle, _16.strokeStyle = this._parameters.haloStyle;
    const c33 = this._renderedHaloSize < 3;
    _16.lineJoin = c33 ? "miter" : "round", c33 ? this._renderHaloEmulated(_16, s33, r39) : this._renderHaloNative(_16, s33, r39);
    let g17 = r39;
    for (let n28 = 0; n28 < this._lines.length; ++n28) {
      const t32 = this._getLineXOffset(n28);
      this._renderLineDecoration(_16, s33 + t32, g17, this._textWidths[n28], true), g17 += this._lineSpacing;
    }
    t31.globalAlpha = this._parameters.definition.halo.color[3], t31.drawImage(d21, 0, 0, h23, o27, this._toRenderUnit(e43), this._toRenderUnit(i20), h23, o27), t31.globalAlpha = 1;
  }
  _renderHaloEmulated(t31, e43, i20) {
    for (let n28 = 0; n28 < this._lines.length; ++n28) {
      const s33 = this._lines[n28], r39 = this._getLineXOffset(n28);
      for (const [n29, o27] of h14) this._fillText(t31, s33, e43 + r39 + this._haloSize * n29, i20 + this._haloSize * o27);
      i20 += this._lineSpacing;
    }
  }
  _renderHaloNative(t31, e43, i20) {
    const n28 = 2 * this._haloSize;
    for (let s33 = 0; s33 < this._lines.length; ++s33) {
      const r39 = this._lines[s33], h23 = this._getLineXOffset(s33), o27 = 5, a30 = 0.1;
      for (let s34 = 0; s34 < o27; s34++) {
        const d21 = 1 - (o27 - 1) * a30 + s34 * a30;
        t31.lineWidth = this._toRenderUnit(d21 * n28), this._strokeText(t31, r39, e43 + h23, i20);
      }
      i20 += this._lineSpacing;
    }
  }
  get _displayWidth() {
    return this._metrics.displayWidth;
  }
  _toRenderUnit(t31) {
    return t31 * this.renderPixelRatio;
  }
  _toRoundedRenderUnit(t31) {
    return Math.round(t31 * this.renderPixelRatio);
  }
  _fillText(t31, e43, i20, n28) {
    t31.fillText(e43, this._toRenderUnit(i20), this._toRenderUnit(n28));
  }
  _strokeText(t31, e43, i20, n28) {
    t31.strokeText(e43, this._toRenderUnit(i20), this._toRenderUnit(n28));
  }
  _drawLine(t31, e43, i20) {
    t31.beginPath(), t31.moveTo(this._toRoundedRenderUnit(e43[0]) + 0.5, this._toRoundedRenderUnit(e43[1]) + 0.5), t31.lineTo(this._toRoundedRenderUnit(i20[0]) + 0.5, this._toRoundedRenderUnit(i20[1]) + 0.5), t31.stroke();
  }
  _drawBox(t31, e43, i20) {
    const n28 = this._toRenderUnit(e43[0]), s33 = this._toRenderUnit(e43[1]), r39 = this._toRenderUnit(i20[0]), h23 = this._toRenderUnit(i20[1]), o27 = Math.floor(n28) + 0.5, a30 = Math.ceil(n28 + r39) - 0.5, d21 = Math.floor(s33) + 0.5, l35 = Math.ceil(s33 + h23) - 0.5;
    t31.beginPath(), t31.moveTo(o27, d21), t31.lineTo(a30, d21), t31.lineTo(a30, l35), t31.lineTo(o27, l35), t31.lineTo(o27, d21), t31.stroke();
  }
};
var h14 = [];
{
  const t31 = 16;
  for (let e43 = 0; e43 < 360; e43 += 360 / t31) h14.push([Math.cos(Math.PI * e43 / 180), Math.sin(Math.PI * e43 / 180)]);
}
var o21;
!function(t31) {
  t31[t31.Left = 0] = "Left", t31[t31.Center = 1] = "Center", t31[t31.Right = 2] = "Right";
}(o21 || (o21 = {}));
var a22 = {
  canvas: null
};
var d14 = 0.2;
var l23 = 512;
var _10 = "rgb(255, 0, 255, 0.5)";
var c22 = class {
  get firstLineHeight() {
    return this.firstLineAscent + this.maxLineDescent;
  }
  get midLineHeight() {
    return this.maxLineAscent + this.maxLineDescent;
  }
  get lastLineHeight() {
    return this.maxLineAscent + this.lastLineDescent;
  }
  constructor(t31, e43, i20, n28, s33) {
    this.firstLineAscent = t31, this.lastLineDescent = e43, this.maxLineAscent = i20, this.maxLineDescent = n28, this.displayWidth = s33;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/placementUtils.js
var i14 = Object.freeze({
  left: 0,
  center: 0.5,
  right: 1
});
var s25 = Object.freeze({
  "bottom-left": r7(0, 0),
  bottom: r7(0.5, 0),
  "bottom-right": r7(1, 0),
  left: r7(0, 0.5),
  center: r7(0.5, 0.5),
  right: r7(1, 0.5),
  "top-left": r7(0, 1),
  top: r7(0.5, 1),
  "top-right": r7(1, 1)
});
function f17(t31) {
  switch (t31) {
    case "left":
      return o21.Left;
    case "right":
      return o21.Right;
    default:
      return o21.Center;
  }
}
function a23(t31) {
  switch (t31) {
    case "bottom-left":
    case "left":
    case "top-left":
      return "left";
    case "bottom":
    case "center":
    case "top":
      return "center";
    case "bottom-right":
    case "right":
    case "top-right":
      return "right";
  }
}
function l24(t31) {
  switch (t31) {
    case "bottom-left":
    case "bottom":
    case "bottom-right":
      return "bottom";
    case "left":
    case "center":
    case "right":
      return "center";
    case "top-left":
    case "top":
    case "top-right":
      return "top";
  }
}
function m15(t31, e43) {
  switch (e43) {
    case "bottom":
      return "left" === t31 ? "bottom-left" : "right" === t31 ? "bottom-right" : "bottom";
    case "center":
      return t31;
    case "top":
      return "left" === t31 ? "top-left" : "right" === t31 ? "top-right" : "top";
  }
}
function u21(t31) {
  return "middle" === t31 ? "center" : t31;
}
function h15(r39, c33) {
  switch (r39) {
    case "top":
      return o9(c33, 0, s24);
    case "bottom":
      return o9(c33, 0, -s24);
    default:
      return r10(c33, a6);
  }
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/LabelParameters.js
var i15 = class {
  constructor(i20, r39 = "center", c33 = false, a30 = n10(), o27 = r5(0, 0, 0, -1), l35 = "world", f26 = n2(), n28 = 0) {
    this.verticalOffset = i20, this.anchor = r39, this.hasLabelVerticalOffset = c33, this.screenOffset = a30, this.centerOffset = o27, this.centerOffsetUnits = l35, this.translation = f26, this.elevationOffset = n28;
  }
};
var r30 = class {
  constructor(e43, s33 = "center", i20 = "center", r39 = null, c33 = n10()) {
    this.placement = e43, this.horizontalPlacement = s33, this.verticalPlacement = i20, this.text = r39, this.displaySize = c33;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextRenderParameters.js
var s26 = class _s {
  constructor(o27) {
    this.definition = o27, this.key = JSON.stringify(o27), this.haloSize = Math.round(o27.halo.size), this.textStyle = a24(o27.color), this.haloStyle = l25(o27.halo.color), this.backgroundStyle = 0 !== o27.background.color[3] ? a24(o27.background.color) : null;
  }
  fontString(o27) {
    const t31 = this.definition.font, e43 = "sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji";
    return `${t31.style} ${t31.weight} ${o27}px ${t31.family}, ${e43}`;
  }
  setFontProperties(o27, t31) {
    o27.font = this.fontString(t31), o27.textAlign = "left", o27.textBaseline = "alphabetic";
  }
  static fromSymbol(l35, a30) {
    return __async(this, null, function* () {
      const f26 = l35?.material?.color, m22 = u9.toUnitRGBA(f26) ?? _4, g17 = null != l35.size ? u8(l35.size) : 12, u32 = l35.lineHeight, d21 = null != l35.background ? u9.toUnitRGBA(l35.background.color) : _4, h23 = {
        family: l35.font?.family ?? "sans-serif",
        decoration: l35.font?.decoration ?? "none",
        weight: l35.font?.weight ?? "normal",
        style: l35.font?.style ?? "normal"
      }, y12 = l35.halo, b18 = null != y12?.color && y12.size > 0 ? {
        size: u8(y12.size),
        color: u9.toUnitRGBA(y12.color)
      } : {
        size: 0,
        color: _4
      }, p23 = new _s({
        color: m22,
        size: g17,
        background: {
          color: d21,
          padding: null != l35.background ? [0.65 * g17, 0.5 * g17] : [0, 0],
          borderRadius: null != l35.background ? g17 * (6 / 16) : 0
        },
        lineSpacingFactor: u32,
        font: h23,
        halo: b18,
        pixelRatio: a30
      });
      if (l35.font) {
        let o27 = false;
        const r39 = p23.fontString(g17);
        try {
          o27 = (yield document.fonts.load(r39)).some((o28) => !i7(o28));
        } catch (S19) {
          n.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${r39}'. Some text symbology may be rendered using the default browser font.`);
        }
        if (!o27 && !c23.has(l35.font.family)) try {
          yield c11(l35.font);
        } catch (S19) {
        }
      }
      return p23;
    });
  }
};
function l25(o27) {
  return `rgb(${o27.slice(0, 3).map((o28) => Math.floor(255 * o28)).toString()})`;
}
function a24(o27) {
  return `rgba(${o27.slice(0, 3).map((o28) => Math.floor(255 * o28)).toString()},${o27[3]})`;
}
var c23 = /* @__PURE__ */ new Set(["Arial", "Times New Roman", "Courier New", "serif", "sans-serif", "monospace", "cursive", "fantasy", "system-ui", "ui-serif", "ui-sans-serif", "ui-monospace", "ui-rounded", "math", "emoji", "fangsong"]);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextTextureAtlas.js
var b11 = 4096;
var v7 = class extends S2 {
  constructor(t31) {
    super(t31), this.type = e25.Texture, this.id = e4(), this.events = new o(), this._glTexture = null, this._atlas = new E14(256, 256), this._needsRepack = false, this._canRepack = true, this._elementsToRender = /* @__PURE__ */ new Map(), this._elements = /* @__PURE__ */ new Map(), this._stageObjects = /* @__PURE__ */ new Map(), this.updating = false;
  }
  initialize() {
    this._canvas = document.createElement("canvas"), this._canvas.setAttribute("id", "textAtlasCanvas"), this._canvas.setAttribute("style", "display:none"), this._ctx = this._canvas.getContext("2d"), this._stage = this.view._stage, this._stage.add(this), this._updateCanvasElementSize(this._atlas), this._reset();
  }
  unload() {
    this._glTexture = r2(this._glTexture), this.updating = false, this.events.emit("unloaded");
  }
  get glTexture() {
    return this._glTexture;
  }
  static get maxSize() {
    return S12 = n14.stableRendering ? R5 : 0, [b11 - R5 - S12, b11 - R5 - S12 - A8];
  }
  load(t31) {
    if (this._glTexture) return this._glTexture;
    const e43 = new e23();
    return e43.wrapMode = D3.CLAMP_TO_EDGE, e43.samplingMode = L4.LINEAR_MIPMAP_LINEAR, e43.hasMipmap = true, e43.preMultiplyAlpha = true, e43.maxAnisotropy = t31.parameters.maxMaxAnisotropy, this._glTexture = new c10(t31, e43, this._canvas), this._frameWorker = this.view.resourceController.scheduler.registerTask(I2.TEXT_TEXTURE_ATLAS, this), this.setDirty(), this._glTexture;
  }
  dispose() {
    this._elements.clear(), this._elementsToRender.clear(), this._frameWorker = l2(this._frameWorker), this._glTexture && (this._stage.remove(this), this._glTexture = r2(this._glTexture)), this._canvas.width = 0, this._canvas.height = 0, this._canvas = null, this._ctx = null;
  }
  _updateCanvasElementSize(t31) {
    this._canvas.setAttribute("width", t31.width.toString()), this._canvas.setAttribute("height", t31.height.toString());
  }
  _resizeAtlas(t31, e43) {
    const {
      width: s33,
      height: i20
    } = this._atlas;
    s33 === t31 && i20 === e43 || (this._atlas.width = t31, this._atlas.height = e43, this._glTexture?.resize(t31, e43), this._glTexture?.updateData(0, 0, 0, s33, i20, this._canvas), this._updateCanvasElementSize(this._atlas), this._elements.forEach((t32) => {
      const e44 = this._stageObjects.get(t32.textRenderer.key);
      e44?.forEach((e45) => y7(e45, t32));
    }), this._reset());
  }
  _reset() {
    this._elementsToRender.clear(), this._atlas.reset(), this._needsRepack = true, this.setDirty();
  }
  _addAtlasElement(t31, e43, s33, i20) {
    const r39 = this._atlas;
    if (r39.width < s33 || r39.height < i20) return false;
    let h23 = r39.cursors.get(i20);
    if (!h23) {
      if (r39.height < r39.nextY + i20) return false;
      h23 = [new k3(r39.nextY)], r39.cursors.set(i20, h23), r39.nextY += i20;
    }
    let n28 = h23.find((t32) => r39.width >= t32.x + s33);
    if (null == n28) {
      if (r39.height < r39.nextY + i20) return false;
      n28 = new k3(r39.nextY), r39.nextY += i20, h23.push(n28);
    }
    return t31.setNewPosition(n28), this._elements.set(e43, t31), this._elementsToRender.set(e43, t31), n28.x += s33, true;
  }
  _ensureStageObjects(t31) {
    const e43 = this._stageObjects.get(t31);
    if (e43) return e43;
    const s33 = /* @__PURE__ */ new Set();
    return this._stageObjects.set(t31, s33), s33;
  }
  _addStageObject(t31, e43) {
    this._ensureStageObjects(t31).add(e43);
  }
  _removeStageObject(t31, e43) {
    const s33 = this._stageObjects.get(t31);
    s33?.delete(e43) && (e43.geometries[0].setAttributeData(e16.SIZE, [0, 0]), e43.geometryVertexAttributeUpdated(e43.geometries[0], e16.SIZE), this._elementsToRender.delete(t31));
  }
  _processAddition(t31) {
    const e43 = t31.textRenderer.key;
    if (this._needsRepack) return void this._elements.set(e43, t31);
    const s33 = this._atlas, i20 = t31.textRenderer.renderedWidth, r39 = t31.textRenderer.renderedHeight, h23 = i20 + R5, n28 = r39 + R5 + A8;
    if (!this._addAtlasElement(t31, e43, h23, n28)) {
      if (this._canRepack) this._reset();
      else if (s33.width < h23) {
        const t32 = Math.min(n13(Math.max(h23, 1.5 * s33.width)), b11);
        this._resizeAtlas(t32, s33.height);
      } else {
        const t32 = s33.nextY + n28, e44 = Math.min(n13(Math.max(t32, 1.5 * s33.height)), b11);
        if (e44 > s33.height) this._resizeAtlas(s33.width, e44);
        else if (s33.width < b11) {
          const t33 = Math.min(n13(1.5 * s33.width), b11);
          this._resizeAtlas(t33, s33.height);
        }
      }
      this._elements.set(e43, t31);
    }
  }
  _renderElement(t31) {
    const e43 = t31.commitNewPosition(), s33 = t31.textRenderer;
    this._ctx.clearRect(e43[0] - R5, e43[1] - R5, s33.renderedWidth + 2 * R5, s33.renderedHeight + 2 * R5), s33.render(this._ctx, e43[0], e43[1]);
    const i20 = this._stageObjects.get(s33.key);
    i20?.forEach((e44) => y7(e44, t31));
  }
  get running() {
    return this.updating;
  }
  runTask(t31) {
    if (null == this._glTexture) return o8;
    for (; this._needsRepack && (this._canRepack || this._atlas.height < b11 && this._atlas.height < b11); ) {
      this._canRepack = this._needsRepack = false;
      const e43 = this._elements;
      this._elements = /* @__PURE__ */ new Map(), e43.forEach((t32) => this._processAddition(t32)), t31.madeProgress();
    }
    if (this._elementsToRender.size > 0) {
      for (const [e43, s33] of this._elementsToRender) {
        if (t31.done) break;
        this._renderElement(s33), this._elementsToRender.delete(e43), t31.madeProgress();
      }
      this._glTexture.setData(this._canvas);
    }
    this.updating = this._elementsToRender.size > 0;
  }
  addTextTexture(t31, e43) {
    const s33 = t31.key;
    this._addStageObject(s33, e43);
    let i20 = this._elements.get(s33);
    null == i20 && (i20 = new O14(this._atlas, t31), this._processAddition(i20), this.setDirty()), j13(e43, i20), y7(e43, i20);
  }
  removeTextTexture(t31, e43) {
    const s33 = t31.key;
    if (!this._elements.get(s33)) return;
    this._removeStageObject(s33, e43);
    const i20 = this._stageObjects.get(s33);
    i20 && 0 !== i20.size || this._elements.delete(s33), 0 === i20?.size && this._stageObjects.delete(s33), this._canRepack = true;
  }
  setDirty() {
    this._glTexture && (this.updating = true);
  }
  get test() {
  }
};
function j13(t31, e43) {
  t31.geometries[0].setAttributeData(e16.SIZE, [e43.textRenderer.displayWidth, e43.textRenderer.displayHeight]), t31.geometryVertexAttributeUpdated(t31.geometries[0], e16.SIZE);
}
function y7(t31, e43) {
  t31.geometries[0].setAttributeData(e16.UV0, e43.uv), t31.geometryVertexAttributeUpdated(t31.geometries[0], e16.UV0, true);
}
e5([y({
  constructOnly: true
})], v7.prototype, "view", void 0), e5([y({
  type: Boolean
})], v7.prototype, "updating", void 0), v7 = e5([a3("esri.views.3d.webgl-engine.lib.TextTextureAtlas")], v7);
var R5 = 2;
var A8 = 2;
var O14 = class {
  constructor(t31, e43) {
    this._atlas = t31, this.textRenderer = e43, this._uv = n7(), this._newPosition = [0, 0];
  }
  get uv() {
    if (null == this._xOffset || null == this._yOffset) return _4;
    const {
      renderedWidth: t31,
      renderedHeight: e43
    } = this.textRenderer;
    return s6(this._uv, this._xOffset / this._atlas.width, (this._yOffset + e43) / this._atlas.height, (this._xOffset + t31) / this._atlas.width, this._yOffset / this._atlas.height);
  }
  setNewPosition(t31) {
    this._newPosition[0] = t31.x, this._newPosition[1] = t31.y;
  }
  commitNewPosition() {
    return this._xOffset = this._newPosition[0], this._yOffset = this._newPosition[1], this._newPosition;
  }
  get xOffset() {
    return this._xOffset;
  }
  get yOffset() {
    return this._yOffset;
  }
};
var E14 = class {
  constructor(t31, e43) {
    this.width = t31, this.height = e43, this.cursors = /* @__PURE__ */ new Map(), this.nextY = 0;
  }
  reset() {
    this.cursors.clear(), this.nextY = S12;
  }
};
var k3 = class {
  constructor(t31) {
    this.y = t31, this.x = S12;
  }
};
var S12 = 0;

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolCreationContext.js
var e36 = class {
  constructor(e43, s33) {
    this.scheduler = e43, this.schedule = s33, this.sharedResources = null, this.streamDataRequester = null, this.elevationProvider = null, this.renderer = null, this.stage = null, this.clippingExtent = null, this.renderCoordsHelper = null, this.overlaySR = null, this.layer = null, this.drapeSourceRenderer = null, this.graphicsCoreOwner = null, this.localOriginFactory = null, this.featureExpressionInfoContext = null, this.screenSizePerspectiveEnabled = true, this.slicePlaneEnabled = false, this.physicalBasedRenderingEnabled = false, this.skipHighSymbolLods = false, this.isAsync = false;
  }
};
var s27 = class {
  constructor() {
    this.renderPriority = 0, this.renderPriorityStep = 1, this.ignoreDrivers = false;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DGraphic.js
var x6 = new e3(Array, (e43) => O4(e43, D2), null, 10, 5);
var v8 = u7();
var A9 = class {
  get labelLayers() {
    return this._labelLayers || R;
  }
  get extent() {
    return this._extent;
  }
  get isElevationSource() {
    return this.layers.some((e43) => e43?.isElevationSource);
  }
  constructor(e43, t31, i20, r39, s33) {
    this.graphic = e43, this.graphics3DSymbol = t31, this.layers = i20, this._visibleFlags = L5.ALL_LABEL, this.deconflictionPriority = 0, ++t31.referenced, this._featureExpressionFeature = s33 ? s17(s33, e43, r39) : null;
  }
  initialize(e43) {
    this._layer = e43, this._forEachSymbolLayerGraphic((t31) => {
      t31.initialize(e43), t31.setVisibility(this.isVisible());
    });
  }
  destroy() {
    this._forEachSymbolLayerGraphic((e43) => e43.destroy()), this._calloutLayer = null, --this.graphics3DSymbol.referenced, this.graphics3DSymbol = null;
  }
  get destroyed() {
    return null == this.layers;
  }
  clearLabelGraphics() {
    this._forEachLabelGraphic((e43) => e43.destroy()), this._labelLayers = null;
  }
  addLabelGraphic(e43, t31) {
    this._labelLayers || (this._labelLayers = new Array()), this._labelLayers.push(e43), e43.initialize(t31), e43.setVisibility(this.isVisible(A7.LABEL));
  }
  setCalloutGraphic(e43) {
    this._calloutLayer = e43, this._layer && (e43.initialize(this._layer), e43.setVisibility(this.isVisible()));
  }
  get calloutLayer() {
    return this._calloutLayer;
  }
  get isDraped() {
    let e43 = false;
    return this._forEachSymbolLayerGraphic((t31) => {
      "draped" === t31.type && (e43 = true);
    }), e43;
  }
  isVisible(e43 = A7.GRAPHIC, t31) {
    const i20 = t31 ? this._visibleFlags | t31 | A7.LABEL * t31 : this._visibleFlags;
    return e43 === A7.GRAPHIC ? (i20 & L5.ALL_GRAPHIC) === L5.ALL_GRAPHIC : (i20 & L5.ALL_LABEL) === L5.ALL_LABEL;
  }
  setVisibilityFlag(e43, t31, i20) {
    const r39 = this.isVisible(e43);
    i20 ? this._visibleFlags |= e43 * t31 : this._visibleFlags &= ~(e43 * t31);
    const s33 = this.isVisible(e43);
    if (r39 === s33) return false;
    if (e43 === A7.LABEL) this._forEachLabelGraphic((e44) => e44.setVisibility(s33));
    else {
      this._forEachSymbolLayerGraphic((e45) => e45.setVisibility(s33));
      const e44 = this.isVisible(A7.LABEL);
      this._forEachLabelGraphic((t32) => t32.setVisibility(e44));
    }
    return true;
  }
  getVisibilityFlag(e43, t31) {
    return !!(this._visibleFlags & e43 * t31);
  }
  computeExtent(e43) {
    if (!this._extent) {
      const t31 = this.graphic.geometry;
      if (null == t31) return false;
      this._extent = u7(), I3(t31, this._extent);
      const i20 = t31.spatialReference;
      if (!G(i20, e43) && !i10(this._extent, i20, this._extent, e43)) return this._extent = null, false;
    }
    return true;
  }
  getAsOptimizedGeometry(e43, t31) {
    return this._optimizedGeometry || (this._optimizedGeometry = this._convertGraphicToOptimizedGeometry(this.graphic, e43, t31)), this._optimizedGeometry;
  }
  _convertGraphicToOptimizedGeometry(e43, t31, i20) {
    let r39 = e43.geometry;
    return "mesh" !== r39.type && "extent" !== r39.type || (r39 = j2.fromExtent("mesh" === r39.type ? r39.extent : r39)), ot2(r39, t31, i20);
  }
  get usedMemory() {
    let e43 = t2(this.graphic.attributes);
    return this._forEachSymbolLayerGraphic((t31) => e43 += t31.graphics3DSymbolLayer.usedMemory), e43;
  }
  computeAttachmentOrigin() {
    const e43 = {
      render: {
        origin: n2(),
        num: 0
      },
      draped: {
        origin: n10(),
        num: 0
      }
    };
    for (const t31 of this.layers) null != t31 && t31.computeAttachmentOrigin(e43);
    return e43.render.num > 1 && g(e43.render.origin, e43.render.origin, 1 / e43.render.num), e43.draped.num > 1 && l9(e43.draped.origin, e43.draped.origin, 1 / e43.draped.num), e43;
  }
  getProjectedBoundingBox(e43, i20, r39, s33, a30) {
    return __async(this, null, function* () {
      return a30 || (a30 = {
        boundingBox: null,
        requiresDrapedElevation: false,
        screenSpaceObjects: []
      }), a30.boundingBox ? P2(a30.boundingBox) : a30.boundingBox = P2(), a30.requiresDrapedElevation = false, yield a4(this.layers, (t31) => __async(this, null, function* () {
        if (null == t31) return;
        const o27 = "draped" === t31.type ? i20 : e43, l35 = x6.acquire(), n28 = yield t31.getProjectedBoundingBox(o27, r39, a30.screenSpaceObjects, s33, l35);
        isFinite(n28[2]) && isFinite(n28[5]) || (a30.requiresDrapedElevation = true), n28 && o3(a30.boundingBox, l35), x6.release(l35);
      })), l4(a30.boundingBox) || x2(S4(a30.boundingBox, v8)) ? a30 : null;
    });
  }
  needsElevationUpdates() {
    for (const e43 of this.layers) if (null != e43 && ("object3d" === e43.type || "lod-instance" === e43.type) && e43.needsElevationUpdates) return true;
    return this._labelLayers?.some((e43) => e43?.needsElevationUpdates ?? false) ?? false;
  }
  alignWithElevation(e43, t31, i20) {
    this._forEachRenderedGraphic((r39) => {
      "object3d" !== r39.type && "lod-instance" !== r39.type || r39.alignWithElevation(e43, t31, this._featureExpressionFeature, i20);
    });
  }
  alignWithAbsoluteElevation(e43, t31, i20) {
    this._forEachRenderedGraphic((r39) => {
      "object3d" === r39.type && r39.alignWithAbsoluteElevation(e43, t31, i20);
    });
  }
  addObjectStateSet(e43, t31) {
    this._forEachSymbolLayerGraphic((i20) => i20.addObjectState(e43, t31));
  }
  removeObjectState(e43) {
    this._forEachSymbolLayerGraphic((t31) => t31.removeObjectState(e43));
  }
  _forEachGraphicList(e43, t31) {
    e43?.forEach((e44) => e44 && t31(e44));
  }
  _forEachSymbolLayerGraphic(e43) {
    this._forEachGraphicList(this.layers, e43), this._calloutLayer && e43(this._calloutLayer);
  }
  _forEachLabelGraphic(e43) {
    this._forEachGraphicList(this._labelLayers, e43);
  }
  _forEachRenderedGraphic(e43) {
    this._forEachSymbolLayerGraphic(e43), this._forEachLabelGraphic(e43);
  }
  get test() {
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/polygonUtils.js
function p16(r39, o27, n28) {
  const a30 = (o27.length > 0 ? o27[0] : r39.length / 3) - 1, s33 = c13(r39, a30, n28);
  if (s33 !== n3.Z) {
    r39 = r39.slice();
    for (let t31 = 0; t31 < r39.length; t31 += 3) r39[t31 + s33] = r39[t31 + 2];
  }
  return i6(r39, o27, 3);
}
function m16(t31) {
  const e43 = [[e16.POSITION, new t7(t31.attributeData.position, t31.indices, 3, true)]], i20 = A5(t31.indices.length);
  return null != t31.attributeData.colorFeature ? e43.push([e16.COLORFEATUREATTRIBUTE, new t7([t31.attributeData.colorFeature], i20, 1, true)]) : t31.attributeData.color && e43.push([e16.COLOR, new t7(t31.attributeData.color, i20, 4, true)]), t31.attributeData.uvMapSpace && e43.push([e16.UVMAPSPACE, new t7(t31.attributeData.uvMapSpace, t31.indices, 4, true)]), t31.attributeData.boundingRect && e43.push([e16.BOUNDINGRECT, new t7(t31.attributeData.boundingRect, t31.indices, 9, true)]), new I4(t31.material, e43, t31.mapPositions, e25.Mesh, t31.attributeData.objectAndLayerIdColor);
}
function l26(t31, e43 = null) {
  const r39 = [[e16.POSITION, new t7(t31.attributeData.position, t31.indices, 3, true)], [e16.UV0, new t7(t31.attributeData.uv0, t31.indices, 2, true)]];
  return new I4(t31.material, r39, t31.mapPositions, e25.Mesh, e43);
}
function b12(t31) {
  switch (t31.type) {
    case "extent":
      if (t31 instanceof w2) return j2.fromExtent(t31);
      break;
    case "polygon":
      return t31;
  }
  return null;
}
var g10 = class {
  constructor(t31, e43, r39) {
    this.renderData = t31, this.layerUid = e43, this.graphicUid = r39, this.outGeometries = new Array();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/renderInfoUtils/polygon.js
function p17(o27, n28, r39, p23) {
  const c33 = a11(o27.rings, !!o27.hasZ && "on-the-ground" !== p23.mode, p6.CCW_IS_HOLE, o27.spatialReference), h23 = t12(c33.position.length), a30 = u16(c33.position, o27.spatialReference, 0, h23, 0, c33.position, 0, c33.position.length / 3, n28, r39, p23), g17 = null != a30;
  return new f18(c33.position, h23, u22(c33.polygons, c33.position, h23), l27(c33.outlines, c33.position, h23), g17, a30);
}
function c24(t31, n28) {
  const e43 = a11(t31.rings, false, p6.CCW_IS_HOLE), p23 = n4(e43.position, t31.spatialReference, 0, e43.position, n28, 0, e43.position.length / 3);
  for (let o27 = 2; o27 < e43.position.length; o27 += 3) e43.position[o27] = te2;
  return {
    position: e43.position,
    polygons: u22(e43.polygons, e43.position),
    outlines: l27(e43.outlines, e43.position),
    projectionSuccess: p23
  };
}
function l27(o27, t31, s33 = null) {
  return o27.filter(({
    count: o28
  }) => o28 > 1).map(({
    index: o28,
    count: i20
  }) => {
    const e43 = 3 * o28, r39 = 3 * i20;
    return null != s33 ? new a25(o28, i20, a10(t31, e43, r39), a10(s33, e43, r39)) : new h16(o28, i20, a10(t31, e43, r39));
  });
}
function u22(o27, t31, s33 = null) {
  const i20 = new Array();
  for (const {
    index: e43,
    count: r39,
    holeIndices: p23,
    pathLengths: c33
  } of o27) {
    if (r39 <= 1) continue;
    const o28 = 3 * e43, l35 = 3 * r39, u32 = p23.map((o29) => o29 - e43), h23 = null != s33 ? new g11(e43, r39, a10(t31, 3 * e43, 3 * r39), a10(s33, o28, l35), u32, c33) : new m17(e43, r39, a10(t31, 3 * e43, 3 * r39), u32, c33);
    i20.push(h23);
  }
  return i20;
}
var h16 = class {
  constructor(o27, t31, n28) {
    this.index = o27, this.count = t31, this.position = n28;
  }
};
var a25 = class extends h16 {
  constructor(o27, t31, n28, s33) {
    super(o27, t31, n28), this.mapPositions = s33;
  }
};
var g11 = class extends a25 {
  constructor(o27, t31, n28, s33, i20, e43) {
    super(o27, t31, n28, s33), this.holeIndices = i20, this.pathLengths = e43;
  }
};
var m17 = class extends h16 {
  constructor(o27, t31, n28, s33, i20) {
    super(o27, t31, n28), this.holeIndices = s33, this.pathLengths = i20;
  }
};
var f18 = class {
  constructor(o27, t31, n28, s33, i20, e43) {
    this.position = o27, this.mapPositions = t31, this.polygons = n28, this.outlines = s33, this.projectionSuccess = i20, this.sampledElevation = e43;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer.js
var tt = ["polygon", "extent"];
var et = class extends y6 {
  constructor(t31, e43, r39, s33) {
    super(t31, e43, r39, s33), this.ensureDrapedStatus(false);
  }
  doLoad() {
    return __async(this, null, function* () {
      if (!this._drivenProperties.size) {
        const e44 = I7(this._getSymbolSize());
        if (e44) throw new s2("graphics3dextrudesymbollayer:invalid-size", e44);
      }
      const e43 = this.symbolLayer?.material?.color, r39 = this._getCombinedOpacityAndColor(e43), s33 = e6(r39), o27 = r39[3], n28 = o27 < 1 || this.needsDrivenTransparentPass, i20 = {
        usePBR: this._context.physicalBasedRenderingEnabled,
        isSchematic: true,
        diffuse: s33,
        ambient: s33,
        opacity: o27,
        transparent: n28,
        cullFace: n28 ? e24.None : e24.Back,
        hasVertexColors: true,
        hasSlicePlane: this._context.slicePlaneEnabled,
        castShadows: this.symbolLayer.castShadows,
        offsetTransparentBackfaces: true,
        normalType: a7.Compressed
      };
      this._materials[wt.Main] = new j10(i20), this._materials[wt.Bottom] = new j10(__spreadProps(__spreadValues({}, i20), {
        cullFace: e24.Back
      })), this._context.stage.addMany(this._materials);
    });
  }
  destroy() {
    super.destroy(), this._context.stage.removeMany(this._materials), this._materials.length = 0;
  }
  createGraphics3DGraphic(t31) {
    const e43 = t31.graphic;
    if (!this._validateGeometry(e43.geometry, tt, this.symbolLayer.type)) return null;
    const r39 = this._getVertexOpacityAndColor(t31.renderingInfo, 255), s33 = this.setGraphicElevationContext(e43);
    return this._createAs3DShape(e43, t31.renderingInfo, r39, s33, e43.uid);
  }
  layerOpacityChanged(t31, e43) {
    const r39 = this.symbolLayer?.material?.color, s33 = this._getCombinedOpacity(r39), o27 = s33 < 1 || this.needsDrivenTransparentPass;
    this._materials[wt.Main]?.setParameters({
      opacity: s33,
      transparent: o27
    }), this._materials[wt.Bottom]?.setParameters({
      opacity: s33,
      transparent: o27
    });
    const n28 = this._getLayerOpacity();
    t31.forEach((t32) => {
      const r40 = e43(t32);
      null != r40 && r40.layerOpacityChanged(n28, this._context.isAsync);
    });
  }
  layerElevationInfoChanged(t31, e43) {
    return this.updateGraphics3DGraphicElevationInfo(t31, e43, g5);
  }
  slicePlaneEnabledChanged(t31, e43) {
    return this._materials[wt.Main]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), this._materials[wt.Bottom]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), t31.forEach((t32) => {
      const r39 = e43(t32);
      null != r39 && r39.slicePlaneEnabledChanged(this._context.slicePlaneEnabled, this._context.isAsync);
    }), true;
  }
  physicalBasedRenderingChanged() {
    const t31 = {
      usePBR: this._context.physicalBasedRenderingEnabled,
      isSchematic: true
    };
    return this._materials[wt.Main]?.setParameters(t31), this._materials[wt.Bottom]?.setParameters(t31), true;
  }
  _getExtrusionSize(t31) {
    let e43;
    return e43 = t31.size && this._drivenProperties.size ? a20(t31.size, 2) ?? 0 : this._getSymbolSize(), e43 /= this._context.renderCoordsHelper.unitInMeters, e43;
  }
  applyRendererDiff(t31, e43) {
    return this._drivenPropertiesChanged(e43) ? e33.RecreateSymbol : e33.RecreateGraphics;
  }
  queryForSnapping(t31, s33, o27, n28) {
    return __async(this, null, function* () {
      const i20 = this._getExtrusionSize(o27) * this._context.renderCoordsHelper.unitInMeters / L3(s33), {
        objectId: a30,
        target: l35
      } = t31, c33 = a(l35);
      switch (c33.z = (c33.z ?? 0) + i20, t31.type) {
        case "edge": {
          const {
            start: r39,
            end: s34
          } = t31, o28 = a(r39), n29 = a(s34);
          return o28.z = (o28.z ?? 0) + i20, n29.z = (n29.z ?? 0) + i20, [e18(a30, c33, 1 / 0, o28, n29)];
        }
        case "vertex":
          return [t8(a30, c33, 1 / 0), e18(a30, l35, 1 / 0, l35, c33)];
        default:
          return [];
      }
    });
  }
  _getSymbolSize() {
    return this.symbolLayer.size ?? 1;
  }
  _createAs3DShape(t31, e43, r39, a30, c33) {
    const m22 = b12(t31.geometry);
    if (null == m22) return null;
    if (0 === m22.rings.length || !m22.rings.some((t32) => t32.length > 0)) return this._logGeometryValidationWarnings(m22.rings, "rings", "ExtrudeSymbol3DLayer"), null;
    const p23 = p17(m22, this._context.elevationProvider, this._context.renderCoordsHelper, a30);
    this._logGeometryCreationWarnings(p23, m22.rings, "rings", "ExtrudeSymbol3DLayer");
    const h23 = b7(m22);
    if (null == h23) return null;
    const g17 = new Array(), d21 = new Array(), u32 = i(), f26 = e12(), M9 = n2(), w11 = this._context.renderCoordsHelper.viewingMode === l8.Global;
    w11 || this._context.renderCoordsHelper.worldUpAtPosition(null, M9), u10(m22.spatialReference, [h23.x, h23.y, 0], f26, this._context.renderCoordsHelper.spatialReference);
    const C7 = e12();
    h4(C7, f26);
    const I18 = e14();
    j5(I18, C7);
    const {
      polygons: L10,
      mapPositions: B7,
      position: D10
    } = p23, T10 = /* @__PURE__ */ new Map(), N6 = this._materials[wt.Main];
    for (const o27 of L10) {
      const t32 = o27.count;
      if (this._context.clippingExtent && (P2(u32), c3(u32, o27.mapPositions), !V(u32, this._context.clippingExtent))) continue;
      const n28 = i6(o27.mapPositions, o27.holeIndices, 3);
      if (0 === n28.length) continue;
      const i20 = n28.length, a31 = 6 * t32, l35 = i5(a31 + i20), m23 = i5(i20), p24 = t12(3 * a31), h24 = t12(3 * a31), y12 = t12(3 * a31), b18 = t12(a31);
      st(D10, B7, n28, o27, p24, y12, h24, b18, l35, m23, this._getExtrusionSize(e43), M9, w11), e21(p24, p24, C7);
      const _16 = this._context.stage.renderView.getObjectAndLayerIdColor({
        graphicUid: c33,
        layerUid: this._context.layer.uid
      }), I19 = new Ct(p24, y12, e20(h24), b18), v15 = rt2(N6, l35, l35.length - m23.length, I19, r39, _16), A14 = t32, L11 = t32, z10 = 2 * o27.count, R10 = new It(A14, L11, z10, i20 / 3);
      ft2(v15, R10, f26), T10.set(v15, R10), g17.push(v15, rt2(this._materials[wt.Bottom], m23, 0, I19, r39, _16)), d21.push(I19.heights);
    }
    if (0 === g17.length) return null;
    const V14 = new O10({
      geometries: g17,
      layerUid: this._context.layer.uid,
      graphicUid: c33,
      isElevationSource: true
    });
    V14.transformation = f26;
    const k11 = a8(this.symbolLayer, {
      opacity: this._getLayerOpacity()
    }), H6 = null != k11 ? {
      baseMaterial: this._materials[wt.Main],
      edgeMaterials: [k11],
      properties: {
        mergeGeometries: true,
        hasSlicePlane: this._context.slicePlaneEnabled
      }
    } : null, W9 = new p12(this, V14, g17, null, null, (t32, e44, r40, s33, o27) => ut(t32, e44, r40, s33, o27, d21, T10), a30, H6);
    return W9.alignedSampledElevation = p23.sampledElevation, W9.needsElevationUpdates = g5(a30.mode), W9;
  }
};
function rt2(t31, e43, r39, s33, o27, n28) {
  const i20 = A5(e43.length), a30 = [[e16.POSITION, new t7(s33.positions, e43, 3, true)], [e16.NORMALCOMPRESSED, new t7(s33.normals, e43, 2, true)], [e16.COLOR, new t7(o27, i20, 4, true)]];
  return new I4(t31, a30, s33.elevation, e25.Mesh, n28, r39);
}
function st(t31, e43, r39, s33, o27, n28, i20, a30, l35, c33, m22, p23, h23) {
  {
    const g17 = r39.length / 3, d21 = 2 * s33.count;
    ot4(t31, e43, s33.index, s33.count, r39, 0, g17, o27, n28, i20, a30, l35, c33, d21, m22, p23, h23);
  }
  {
    let t32 = 0, e44 = 2 * s33.count, r40 = 0;
    const c34 = s33.pathLengths[0];
    at2(o27, n28, a30, i20, t32, c34, s33.count, e44, l35, r40, m22), e44 += 4 * c34, r40 += 2 * c34, t32 += c34;
    for (let p24 = 1; p24 < s33.pathLengths.length; ++p24) {
      const c35 = s33.pathLengths[p24];
      at2(o27, n28, a30, i20, t32, c35, s33.count, e44, l35, r40, m22), e44 += 4 * c35, r40 += 2 * c35, t32 += c35;
    }
  }
}
function ot4(t31, e43, r39, s33, o27, n28, i20, a30, l35, p23, h23, g17, d21, u32, f26, y12, b18) {
  r4(bt, y12);
  {
    const o28 = f26 > 0 ? 1 : -1;
    let n29 = 3 * r39, i21 = 0, c33 = 3 * i21, g18 = s33, d22 = 3 * g18;
    for (let r40 = 0; r40 < s33; ++r40) {
      const r41 = t31[n29], s34 = t31[n29 + 1], u33 = t31[n29 + 2];
      b18 && (bt[0] = r41, bt[1] = s34, bt[2] = u33, z(bt, bt)), a30[c33 + 0] = r41, a30[c33 + 1] = s34, a30[c33 + 2] = u33;
      const y13 = e43[n29 + 0], _16 = e43[n29 + 1], x12 = e43[n29 + 2];
      l35[c33 + 0] = y13, l35[c33 + 1] = _16, l35[c33 + 2] = x12, p23[c33 + 0] = -o28 * bt[0], p23[c33 + 1] = -o28 * bt[1], p23[c33 + 2] = -o28 * bt[2], h23[i21] = 0, a30[d22 + 0] = r41 + f26 * bt[0], a30[d22 + 1] = s34 + f26 * bt[1], a30[d22 + 2] = u33 + f26 * bt[2], l35[d22 + 0] = y13, l35[d22 + 1] = _16, l35[d22 + 2] = x12, h23[g18] = f26, c33 += 3, d22 += 3, n29 += 3, i21 += 1, g18 += 1;
    }
  }
  {
    let t32 = 3 * n28, e44 = 0, r40 = 3 * u32;
    const a31 = f26 < 0 ? St : xt, l36 = f26 < 0 ? xt : St;
    for (let n29 = 0; n29 < i20; ++n29) d21[e44] = o27[t32 + a31[0]], d21[e44 + 1] = o27[t32 + a31[1]], d21[e44 + 2] = o27[t32 + a31[2]], g17[r40] = o27[t32 + l36[0]] + s33, g17[r40 + 1] = o27[t32 + l36[1]] + s33, g17[r40 + 2] = o27[t32 + l36[2]] + s33, e44 += 3, r40 += 3, t32 += 3;
  }
}
function nt(t31, e43, r39, s33, o27, n28, i20) {
  s33[n28] = s33[i20], i20 *= 3, t31[n28 *= 3] = t31[i20], t31[n28 + 1] = t31[i20 + 1], t31[n28 + 2] = t31[i20 + 2], e43[n28] = e43[i20], e43[n28 + 1] = e43[i20 + 1], e43[n28 + 2] = e43[i20 + 2], r39[n28] = o27[0], r39[n28 + 1] = o27[1], r39[n28 + 2] = o27[2];
}
var it2 = n2();
function at2(t31, e43, r39, s33, o27, n28, i20, a30, l35, c33, m22) {
  let p23 = o27, h23 = o27 + 1, g17 = o27 + i20, d21 = o27 + i20 + 1, u32 = a30, f26 = a30 + 1, y12 = a30 + 2 * n28, b18 = a30 + 2 * n28 + 1;
  m22 < 0 && (p23 = o27 + i20 + 1, d21 = o27);
  let _16 = 3 * c33;
  for (let x12 = 0; x12 < n28; ++x12) x12 === n28 - 1 && (h23 = o27, m22 > 0 ? d21 = o27 + i20 : p23 = o27 + i20), gt(t31, p23, h23, g17, it2), nt(t31, e43, s33, r39, it2, u32, p23), nt(t31, e43, s33, r39, it2, f26, h23), nt(t31, e43, s33, r39, it2, y12, g17), nt(t31, e43, s33, r39, it2, b18, d21), l35[_16] = u32, l35[_16 + 1] = y12, l35[_16 + 2] = b18, l35[_16 + 3] = u32, l35[_16 + 4] = b18, l35[_16 + 5] = f26, _16 += 6, p23++, h23++, g17++, d21++, u32 += 2, f26 += 2, y12 += 2, b18 += 2;
}
var lt = n2();
var ct = n2();
var mt = n2();
var pt = n2();
var ht2 = n2();
function gt(t31, e43, r39, s33, o27) {
  e43 *= 3, r39 *= 3, s33 *= 3, o2(lt, t31[e43++], t31[e43++], t31[e43++]), o2(ct, t31[r39++], t31[r39++], t31[r39++]), o2(mt, t31[s33++], t31[s33++], t31[s33++]), e8(pt, ct, lt), e8(ht2, mt, lt), _3(o27, ht2, pt), z(o27, o27);
}
var dt = n2();
function ut(t31, e43, r39, s33, o27, n28, i20) {
  const c33 = t31.stageObject, m22 = c33.geometries, h23 = m22.length, g17 = "absolute-height" !== e43.mode;
  let u32 = 0;
  const f26 = c33.transformation, y12 = e11(e12(), f26);
  for (let a30 = 0; a30 < h23; a30 += 2) {
    const t32 = m22[a30];
    if (!e31(t32)) continue;
    const e44 = t32.getMutableAttribute(e16.POSITION).data, l35 = n28[a30 / 2], h24 = new r18(t32.mapPositions), b18 = e44.length / 3;
    let _16 = false, x12 = 0;
    {
      let t33 = 0;
      for (let n29 = 0; n29 < b18; n29++) {
        dt[0] = e44[t33], dt[1] = e44[t33 + 1], dt[2] = e44[t33 + 2], s33(h24, _t), g17 && (x12 += _t.sampledElevation), t18.TESTS_DISABLE_OPTIMIZATIONS ? (o2(yt, h24.array[h24.offset], h24.array[h24.offset + 1], _t.z + l35[t33 / 3]), null != r39 && o27.toRenderCoords(yt, r39, yt), O3(yt, yt, y12)) : (o2(yt, e44[t33], e44[t33 + 1], e44[t33 + 2]), O3(yt, yt, f26), o27.setAltitude(yt, _t.z + l35[t33 / 3]), O3(yt, yt, y12)), e44[t33] = yt[0], e44[t33 + 1] = yt[1], e44[t33 + 2] = yt[2];
        const n30 = jt / o27.unitInMeters;
        (Math.abs(dt[0] - e44[t33]) >= n30 || Math.abs(dt[1] - e44[t33 + 1]) >= n30 || Math.abs(dt[2] - e44[t33 + 2]) >= n30) && (_16 = true), h24.offset += 3, t33 += 3;
      }
    }
    if (_16) {
      const e45 = i20.get(t32);
      e45 && ft2(t32, e45, f26), c33.geometryVertexAttributeUpdated(m22[a30], e16.NORMALCOMPRESSED), t32.invalidateBoundingInfo(), c33.geometryVertexAttributeUpdated(m22[a30], e16.POSITION), m22[a30 + 1].invalidateBoundingInfo(), c33.geometryVertexAttributeUpdated(m22[a30 + 1], e16.POSITION);
    }
    u32 += x12 / b18;
  }
  return u32 / h23;
}
function ft2(t31, e43, r39) {
  const s33 = t31.getMutableAttribute(e16.POSITION), o27 = t31.getMutableAttribute(e16.NORMALCOMPRESSED).data, {
    topVertexStart: n28,
    topVertexCount: i20,
    topFaceStart: a30,
    topFaceCount: l35
  } = e43, c33 = s33.data, h23 = i20, f26 = t31.attributes.get(e16.POSITION).indices, y12 = a30 + l35, b18 = n28 + i20, _16 = t12(3 * h23);
  for (let m22 = 0; m22 < h23; ++m22) {
    const t32 = 3 * m22;
    _16[t32 + 0] = 0, _16[t32 + 1] = 0, _16[t32 + 2] = 0;
  }
  const x12 = Pt, S19 = Et, j18 = Mt, E20 = Ot2, M9 = bt;
  for (let P10 = a30; P10 < y12; ++P10) {
    const t32 = 3 * P10;
    for (let e44 = 0; e44 < 3; ++e44) {
      const s34 = f26[t32 + e44];
      E20[e44] = s34;
      const o28 = 3 * s34;
      o2(yt, c33[o28 + 0], c33[o28 + 1], c33[o28 + 2]), O3(x12[e44], yt, r39);
    }
    K(S19, x12[1], x12[0]), K(j18, x12[2], x12[0]), _3(M9, S19, j18), z(M9, M9);
    for (let e44 = 0; e44 < 3; ++e44) {
      const t33 = 3 * (E20[e44] - n28);
      _16[t33 + 0] += M9[0], _16[t33 + 1] += M9[1], _16[t33 + 2] += M9[2];
    }
  }
  for (let m22 = n28; m22 < b18; ++m22) {
    const t32 = 3 * (m22 - n28), e44 = _16[t32 + 0], r40 = _16[t32 + 1], s34 = _16[t32 + 2], i21 = Math.sqrt(e44 * e44 + r40 * r40 + s34 * s34);
    s13(o27, m22, e44 / i21, r40 / i21, s34 / i21);
  }
}
var yt = n2();
var bt = n2();
var _t = new R4();
var xt = [0, 2, 1];
var St = [0, 1, 2];
var jt = 0.01;
var Pt = [n2(), n2(), n2()];
var Et = n2();
var Mt = n2();
var Ot2 = [0, 0, 0];
var wt;
!function(t31) {
  t31[t31.Main = 0] = "Main", t31[t31.Bottom = 1] = "Bottom";
}(wt || (wt = {}));
var Ct = class {
  constructor(t31, e43, r39, s33) {
    this.positions = t31, this.elevation = e43, this.normals = r39, this.heights = s33;
  }
};
var It = class {
  constructor(t31, e43, r39, s33) {
    this.topVertexStart = t31, this.topVertexCount = e43, this.topFaceStart = r39, this.topFaceCount = s33;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer.js
var l28 = class {
  constructor(e43, t31, r39, i20) {
    this.graphics3DSymbolLayer = e43, this.renderGeometries = t31, this.boundingBox = r39, this._drapeSourceRenderer = i20, this.type = "draped", this.stage = null, this._visible = false, this._addedToStage = false, this.isElevationSource = false;
  }
  initialize(e43) {
    this.stage = e43.stage;
  }
  setVisibility(e43) {
    if (null != this.stage && this._visible !== e43) {
      if (this._visible = e43, e43 && !this._addedToStage) return this._addedToStage = true, void this._drapeSourceRenderer.addGeometries(this.renderGeometries, E8.ADD);
      if (e43 || this._addedToStage) {
        for (const e44 of this.renderGeometries) e44.visible = this._visible;
        this._drapeSourceRenderer.modifyGeometries(this.renderGeometries, I5.VISIBILITY);
      }
    }
  }
  destroy() {
    this.stage && this._addedToStage && this._drapeSourceRenderer.removeGeometries(this.renderGeometries, E8.REMOVE), this._addedToStage = false, this._visible = false, this.stage = null;
  }
  getCenterObjectSpace(r39 = n2()) {
    return o2(r39, 0, 0, 0);
  }
  getBoundingBoxObjectSpace(e43 = i()) {
    return P2(e43);
  }
  addObjectState(e43, t31) {
    e43 === t14.Highlight && (this.renderGeometries.forEach((e44) => {
      const r39 = e44.geometry.addHighlight();
      t31.addRenderGeometry(e44, r39, this);
    }), this._addedToStage && this._drapeSourceRenderer.modifyGeometries(this.renderGeometries, I5.HIGHLIGHT));
  }
  removeObjectState(e43) {
    this.renderGeometries.forEach((t31) => {
      e43.removeRenderGeometry(t31);
    });
  }
  removeRenderGeometryObjectState(e43, t31) {
    e43.geometry.removeHighlight(t31), this._addedToStage && this._drapeSourceRenderer.modifyGeometries(this.renderGeometries, I5.HIGHLIGHT);
  }
  computeAttachmentOrigin(e43) {
    for (const t31 of this.renderGeometries) t31.geometry.computeAttachmentOrigin(f19) && (e43.draped.origin[0] += f19[0], e43.draped.origin[1] += f19[1], e43.draped.num++);
  }
  getProjectedBoundingBox(e43, t31, r39, d21, n28) {
    return __async(this, null, function* () {
      P2(n28);
      for (let i20 = 0; i20 < this.renderGeometries.length; i20++) {
        const t32 = this.renderGeometries[i20];
        this._getRenderGeometryProjectedBoundingRect(t32, e43, u23, r39), f4(n28, u23);
      }
      if (t31) {
        let e44;
        E(n28, f19);
        const r40 = k2(n28, t31.service.spatialReference, t31);
        try {
          e44 = yield t31.service.queryElevation(f19[0], f19[1], d21, r40, "ground");
        } catch (a30) {
        }
        null != e44 && (n28[2] = Math.min(n28[2], e44), n28[5] = Math.max(n28[5], e44));
      }
      return n28;
    });
  }
  _getRenderGeometryProjectedBoundingRect(e43, t31, r39, i20) {
    if (this.boundingBox) O4(p18, this.boundingBox);
    else {
      const t32 = e43.boundingSphere, r40 = t32[3];
      p18[0] = t32[0] - r40, p18[1] = t32[1] - r40, p18[2] = t32[2] - r40, p18[3] = t32[0] + r40, p18[4] = t32[1] + r40, p18[5] = t32[2] + r40;
    }
    return t31(p18, 0, 2), this.calculateRelativeScreenBounds && i20.push({
      location: E(p18),
      screenSpaceBoundingRect: this.calculateRelativeScreenBounds()
    }), S4(p18, r39);
  }
};
var u23 = u7();
var p18 = i();
var f19 = n2();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DIconSymbolLayer.js
var se = r3(0, 0, 1);
var oe = 16;
var ae = 1.5;
var ne = o16;
var le = [ne / 2, ne / 2, 1 - ne / 2, 1 - ne / 2];
var ce = [e30 * ne, e30 * ne];
var he = class _he extends y6 {
  getCachedSize() {
    return {
      size: this._getIconSize()
    };
  }
  constructor(e43, t31, r39, i20) {
    super(e43, t31, r39, i20), this._cimSymbolMaterials = /* @__PURE__ */ new Map(), this._cimSymbolTextures = /* @__PURE__ */ new Map(), this._cimMaterialParametersInfo = null, this._size = null, this._symbolTextureRatio = 1, this._outlineSize = 0, this._patchTask = null, this._elevationOptions = {
      supportsOffsetAdjustment: true,
      supportsOnTheGround: true
    };
  }
  doLoad(e43) {
    return __async(this, null, function* () {
      this._validateOrThrow();
      const t31 = this._prepareMaterialParameters(), r39 = this._getPrimitive();
      if (null != r39) this._prepareResourcesPrimitive(t31, r39);
      else {
        const r40 = p8(this.symbolLayer), i20 = de(r40);
        null != i20 ? yield this._prepareResourcesCIM(t31, JSON.parse(i20), e43) : yield this._prepareResourcesHref(t31, r40, e43);
      }
    });
  }
  _validateOrThrow() {
    if (this._drivenProperties.size) return;
    const e43 = I7(this._getIconSize());
    if (e43) throw new s2("graphics3diconsymbollayer:invalid-size", e43);
  }
  _getIconSize() {
    const e43 = this.symbolLayer, t31 = Math.round(null != e43.size ? u8(e43.size) : oe);
    return this._drivenProperties.size ? Math.max(t31, 64) : t31;
  }
  _generateTextureCIM(e43) {
    let t31 = this._cimData;
    if (t31 && t31.symbol || this.logger.error("Can't create texture, CIM data is undefined"), t31.primitiveOverrides) {
      t31 = a(t31);
      const r40 = t31.primitiveOverrides;
      y4.evaluateOverrides(r40, e43, this._arcadeInfo.geometryType, null, null), y4.applyOverrides(t31.symbol, r40);
    }
    const r39 = l(JSON.stringify(t31));
    let i20 = this._cimSymbolTextures.get(r39);
    if (i20) return i20;
    const o27 = this._context.sharedResources.cimSymbolRasterizer, a30 = this._context.renderer && "dictionary" === this._context.renderer.type ? this._context.renderer.fieldMap : null;
    a30 && y4.applyDictionaryTextOverrides(t31.symbol, e43, a30, null);
    const n28 = null != this._cimScaleFactorOrFunction ? n8(this._cimScaleFactorOrFunction, e43) : 1;
    1 !== n28 && t31.symbol && l12(t31.symbol, n28, true);
    const l35 = ee.getEnvelope(t31, null, o27.resourceManager);
    if (l35?.width && l35.height) {
      const e44 = l35.x + l35.width / 2, r40 = l35.y + l35.height / 2, s33 = o27.rasterize({
        type: "cim",
        data: t31
      }, l35.width, l35.height, e44, r40, 1, "esriGeometryPoint"), a31 = new p4({
        x: -l35.x / l35.width - 0.5,
        y: (l35.height + l35.y) / l35.height - 0.5
      });
      this._cimMaterialParametersInfo.anchorPosition = pe("relative", a31), i20 = new N(s33, {
        width: s33?.width ?? 1,
        height: s33?.height ?? 1,
        reloadable: true
      });
    } else i20 = new N(new ImageData(1, 1), {
      width: 1,
      height: 1,
      reloadable: true
    });
    return this._cimSymbolTextures.set(r39, i20), this._context.stage.add(i20), i20;
  }
  _prepareMaterialParameters() {
    const e43 = {
      anchorPosition: pe(this.symbolLayer.anchor, this.symbolLayer.anchorPosition)
    }, t31 = this.symbol;
    if (me(t31)) {
      const {
        screenLength: r39,
        minWorldLength: i20,
        maxWorldLength: s33
      } = t31.verticalOffset;
      e43.verticalOffset = {
        screenLength: u8(r39),
        minWorldLength: i20 || 0,
        maxWorldLength: null != s33 ? s33 : 1 / 0
      };
    }
    return this._context.screenSizePerspectiveEnabled && (e43.screenSizePerspective = this._context.sharedResources.screenSizePerspectiveSettings), e43.occlusionTest = !has("enable-feature:non-occluded-hud"), e43.hasSlicePlane = this._context.slicePlaneEnabled, e43;
  }
  _prepareResourcesPrimitive(e43, t31) {
    const r39 = this._getOutlineSize();
    if (ue(t31) && 0 === r39) throw new Error("Nothing to render");
    if (this._outlineSize = r39, e43.color = this._getFillColor(), e43.outlineColor = this._getOutlineColor(), e43.outlineSize = this._outlineSize, null != this._context.sharedResources.textures) {
      const r40 = this._context.sharedResources.textures.fromData(`${t31}-icon`, () => u17(t31));
      this._textureHandle = r40, e43.textureId = r40.texture.id;
    }
    e43.textureIsSignedDistanceField = true, e43.sampleSignedDistanceFieldTexelCenter = a13(t31), e43.distanceFieldBoundingBox = le;
    const i20 = this._getIconSize();
    this._size = [i20, i20], this._symbolTextureRatio = 1 / ne, this._createMaterialAndAddToStage(e43, this._context.stage);
  }
  _prepareResourcesHref(e43, r39, s33) {
    return __async(this, null, function* () {
      this._outlineSize = this._getOutlineSize(), e43.color = this._getFillColor(), e43.outlineColor = this._getOutlineColor(), e43.outlineSize = this._outlineSize, e43.textureIsSignedDistanceField = false;
      const o27 = this._getIconSize(), a30 = o27 * this._context.graphicsCoreOwner.view.state.rasterPixelRatio;
      if (null != this._context.sharedResources.textures) {
        const l35 = yield _(this._context.sharedResources.textures.fromUrl(r39, a30, {
          signal: s33
        }));
        if (false === l35.ok) {
          a2(l35.error);
          throw new s2("graphics3diconsymbollayer:request-failed", `Failed to load (Request for icon resource failed: ${r39})`);
        }
        this._textureHandle = l35.value;
        const c33 = l35.value.texture;
        this._size = _e(c33, o27), e43.textureId = c33.id;
      }
      this._createMaterialAndAddToStage(e43, this._context.stage);
    });
  }
  _prepareResourcesCIM(e43, t31, r39) {
    return __async(this, null, function* () {
      if (this._cimData = t31, !this._context.sharedResources.cimSymbolRasterizer) {
        const e44 = (yield import("./CIMSymbolRasterizer-DZJXCITM.js")).CIMSymbolRasterizer;
        s3(r39), this._context.sharedResources.cimSymbolRasterizer || (this._context.sharedResources.cimSymbolRasterizer = new e44(this._context.renderCoordsHelper.spatialReference));
      }
      const i20 = this._context.sharedResources.cimSymbolRasterizer, s33 = [], o27 = t31, a30 = o27?.symbol;
      ee.fetchResources(a30, i20.resourceManager, s33, r39), ee.fetchFonts(a30, i20.resourceManager, s33);
      const n28 = this._context.layer.fields ? this._context.layer.fields.map((e44) => e44.toJSON()) : [], c33 = this._context.renderCoordsHelper.spatialReference;
      if (this._arcadeInfo = {
        spatialReference: c33,
        fields: n28,
        geometryType: "esriGeometryPoint"
      }, o27?.primitiveOverrides && s33.push(y4.createRenderExpressions(o27.primitiveOverrides, this._arcadeInfo)), s33.length > 0 && (yield Promise.all(s33), s3(r39)), this._context.renderer && "dictionary" === this._context.renderer.type && this._context.renderer.scaleExpression) {
        const e44 = this._context.renderer;
        if (e44.scaleExpression) {
          const t32 = e44.scaleExpression, r40 = yield o14(t32, this._context.layer.spatialReference, n28);
          this._cimScaleFactorOrFunction = (e45, t33, i21) => {
            const s34 = s8(r40, e45, {
              $view: i21
            }, "esriGeometryPoint", t33);
            return null !== s34 ? s34 : 1;
          };
        }
      }
      s3(r39), this._cimMaterialParametersInfo = e43, this._cimMaterialParametersInfo.color = this._getFillColor(), this._cimMaterialParametersInfo.outlineColor = [0, 0, 0, 0], this._cimMaterialParametersInfo.outlineSize = 0, this._cimMaterialParametersInfo.textureIsSignedDistanceField = false;
    });
  }
  _getPrimitive() {
    return this.symbolLayer.resource?.href ? null : this.symbolLayer.resource?.primitive ?? j3;
  }
  _getOutlineSize() {
    let e43 = 0;
    const t31 = this.symbolLayer;
    if (null != t31.outline?.size) return Math.max(u8(t31.outline.size), 0);
    return e43 = ue(this._getPrimitive()) ? ae : 0, Math.max(e43, 0);
  }
  _getOutlineColor() {
    const t31 = this._getLayerOpacity(), r39 = this.symbolLayer, i20 = r39?.outline?.color;
    if (null != i20) {
      const r40 = u9.toUnitRGB(i20), s33 = i20.a * t31;
      return [r40[0], r40[1], r40[2], s33];
    }
    return [0, 0, 0, 0];
  }
  _getFillColor() {
    if (ue(this._getPrimitive())) return t28;
    const e43 = null == this._getPrimitive(), t31 = this.symbolLayer?.material?.color;
    return this._getCombinedOpacityAndColor(t31, {
      hasIntrinsicColor: e43
    });
  }
  _createMaterialAndAddToStage(e43, t31) {
    if (this._cimData) {
      this._fastUpdates = null;
      let r39 = e43.textureId ? this._cimSymbolMaterials.get(e43.textureId) : null;
      return r39 || (r39 = new Q2(e43), this._cimSymbolMaterials.set(e43.textureId ?? 0, r39), t31.add(r39)), r39;
    }
    return this._fastUpdates = O9(this._context.renderer, this._fastVisualVariableConvertOptions()), this._fastUpdates && (e43 = __spreadValues(__spreadValues({}, e43), this._fastUpdates.materialParameters)), this._materials[0] = new Q2(e43), t31.add(this._materials[0]), this._materials[0];
  }
  _setDrapingDependentMaterialParameters() {
    this.draped && (this._forEachMaterial((e43) => {
      e43.setParameters({
        verticalOffset: null,
        screenSizePerspective: null,
        occlusionTest: false,
        hasSlicePlane: false,
        shaderPolygonOffset: 0,
        draped: this.draped
      });
    }), this.layerOpacityChanged());
  }
  destroy() {
    super.destroy(), this._patchTask = e2(this._patchTask), this._forEachMaterial((e43) => this._context.stage.remove(e43)), this._materials.length = 0, this._cimSymbolMaterials.clear(), this._cimSymbolTextures.forEach((e43) => this._context.stage.remove(e43)), this._cimSymbolTextures.clear(), this._textureHandle = t3(this._textureHandle);
  }
  _getScaleFactor(e43, t31) {
    if (this._drivenProperties.size && e43.size) {
      for (let t32 = 0; t32 < 3; t32++) {
        const r39 = e43.size[t32];
        r39 && "symbol-value" !== r39 && "proportional" !== r39 && (e43.size[t32] = u8(r39));
      }
      if ("symbol-value" === e43.size[0]) return 1;
      if (isFinite(+e43.size[0])) return +e43.size[0] / t31;
      if (isFinite(+e43.size[2])) return +e43.size[2] / t31;
    }
    return 1;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry)) return null;
    let r39, i20 = [0, 0];
    if (this._cimData) {
      if (!this._cimData.symbol) return null;
      const e44 = this._generateTextureCIM(t31), s34 = __spreadValues({
        textureId: e44.id
      }, this._cimMaterialParametersInfo);
      r39 = this._createMaterialAndAddToStage(s34, this._context.stage);
      const o28 = window.devicePixelRatio || 1;
      i20 = [e44.parameters.width / o28, e44.parameters.height / o28];
    } else i20 = this._size, r39 = this._materials[0];
    const s33 = f16(t31.geometry);
    if (null == s33) return this.logger.warn(`unsupported geometry type for icon symbol: ${t31.geometry.type}`), null;
    const o27 = e43.renderingInfo, a30 = this._getVertexOpacityAndColor(o27);
    let n28 = 1;
    if (!this._fastUpdates?.visualVariables.size) {
      const e44 = i20[0] > i20[1] ? i20[0] : i20[1];
      n28 = this._getScaleFactor(o27, e44);
    }
    n28 *= this._symbolTextureRatio;
    const l35 = r7(i20[0] * n28, i20[1] * n28), c33 = this.setGraphicElevationContext(t31);
    return this.ensureDrapedStatus("on-the-ground" === c33.mode) && this._setDrapingDependentMaterialParameters(), this.draped ? this._createAsOverlay(t31, s33, r39, a30, l35, e43.layer.uid) : this._createAs3DShape(t31, s33, r39, a30, l35, c33, t31.uid);
  }
  layerOpacityChanged() {
    const e43 = this._getFillColor(), t31 = this._getOutlineColor();
    this._forEachMaterial((r39) => {
      r39.setParameters({
        color: e43
      }), r39.setParameters({
        outlineColor: t31
      });
    });
  }
  updateGeometry(e43, t31) {
    if (this.draped || !this._validateGeometry(t31)) return false;
    const {
      elevationContext: r39,
      stageObject: i20
    } = e43;
    if (r39.mode !== this.getGeometryElevationMode(t31)) return false;
    const s33 = f16(t31);
    if (!s33) return false;
    const o27 = p14(i20, this._context, s33, r39);
    if (null == o27) return false;
    const a30 = d13(this._context, s33);
    return i20.geometries[0].localOrigin === a30 && (e43.alignedSampledElevation = o27, m13(e43, s33, this._context.elevationProvider), true);
  }
  layerElevationInfoChanged(e43, t31, r39) {
    const i20 = this._elevationContext.mode, s33 = m9(_he.elevationModeChangeTypes, r39, i20);
    if (s33 !== b6.UPDATE) return s33;
    const o27 = d7(i20) || "absolute-height" === i20;
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, () => o27);
  }
  slicePlaneEnabledChanged() {
    return this.draped || this._forEachMaterial((e43) => {
      e43.setParameters({
        hasSlicePlane: this._context.slicePlaneEnabled
      });
    }), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  get pixelRatioChanged() {
    return null != this._getPrimitive();
  }
  applyRendererDiff(e43, t31) {
    for (const r39 in e43.diff) {
      if ("visualVariables" !== r39) return e33.RecreateSymbol;
      if (!G3(this._fastUpdates, t31, this._fastVisualVariableConvertOptions())) return e33.RecreateSymbol;
      this._materials[0]?.setParameters(this._fastUpdates.materialParameters);
    }
    return e33.FastUpdate;
  }
  prepareSymbolLayerPatch(e43) {
    if (this._patchTask?.abort(), "partial" !== e43.diff.type) return;
    const t31 = e43.diff.diff;
    this._preparePatchResource(e43, t31);
  }
  _preparePatchResource(e43, s33) {
    if (!s33.resource || "partial" !== s33.resource.type) return;
    const c33 = s33.resource.diff;
    if ("complete" !== c33?.href?.type) return;
    const h23 = c33.href.newValue, {
      textures: m22
    } = this._context.sharedResources;
    if (null == h23 || null == m22 || null != de(h23)) return;
    const u32 = this._getIconSize(), d21 = u32 * this._context.graphicsCoreOwner.view.state.pixelRatio;
    e43.symbolLayerStatePatches.push(() => {
      this._patchTask = e2(this._patchTask), this._patchTask = d((e44) => this._context.schedule((e45, r39) => __async(this, null, function* () {
        const s34 = yield _(m22.fromUrl(h23, d21, {
          signal: r39
        }));
        s3(r39);
        const o27 = !s34.ok;
        if (o27 && a2(s34.error), this._textureHandle = t3(this._textureHandle), this._patchTask = null, o27) {
          this._forEachMaterial((e47) => {
            e47.visible = false, e47.setParameters({
              textureId: null
            });
          });
          const e46 = `Failed to load (Request for icon resource failed: ${h23})`;
          return void this.logger.error(new s2("graphics3diconsymbollayer:request-failed", e46));
        }
        this._textureHandle = s34.value;
        const c34 = s34.value.texture;
        this._size = _e(c34, u32), this._forEachMaterial((e46) => {
          e46.setParameters({
            textureId: c34.id
          }), e46.visible = true;
        });
      }), e44));
    }), delete c33.href;
  }
  _defaultElevationInfoNoZ() {
    return fe;
  }
  _createAs3DShape(e43, t31, r39, i20, s33, o27, a30) {
    const n28 = this.getFastUpdateAttrValues(e43), l35 = this._context.layer.uid, c33 = this._context.stage.renderView.getObjectAndLayerIdColor({
      graphicUid: a30,
      layerUid: l35
    }), h23 = ht(r39, se, null, i20, s33, ye, null, n28, c33), m22 = a18(this._context, t31, h23, o27, a30);
    if (null == m22) return null;
    const u32 = new p12(this, m22.object, [h23], null, null, p11, o27);
    return u32.alignedSampledElevation = m22.sampledElevation, u32.needsElevationUpdates = d7(o27.mode) || "absolute-height" === o27.mode, u32.getScreenSize = this._createScreenSizeGetter(s33, n28), u32.calculateRelativeScreenBounds = (e44) => r39.calculateRelativeScreenBounds(u32.getScreenSize(), 1, e44), m13(u32, t31, this._context.elevationProvider), u32;
  }
  _createAsOverlay(e43, t31, r39, i20, s33, o27) {
    r39.renderPriority = this._renderPriority;
    const a30 = n2();
    c6(t31, a30, this._context.overlaySR), a30[2] = te2;
    const n28 = this._context.clippingExtent;
    if (null != n28 && !y2(n28, a30)) return null;
    const l35 = this.getFastUpdateAttrValues(e43), c33 = this._context.stage.renderView.getObjectAndLayerIdColor({
      graphicUid: e43.uid,
      layerUid: this._context.layer.uid
    }), h23 = ht(r39, se, a30, i20, s33, null, null, l35, c33), m22 = new m8(h23, {
      layerUid: o27,
      graphicUid: e43.uid
    }), u32 = new l28(this, [m22], null, this._context.drapeSourceRenderer);
    return u32.getScreenSize = this._createScreenSizeGetter(s33, l35), u32.calculateRelativeScreenBounds = (e44) => r39.calculateRelativeScreenBounds(u32.getScreenSize(), 1, e44), u32;
  }
  _createScreenSizeGetter(e43, t31) {
    const r39 = this._outlineSize + 2;
    if (this._fastUpdates && t31) {
      const i21 = e43[0] / this._symbolTextureRatio, s34 = e43[1] / this._symbolTextureRatio;
      return (e44 = n10()) => {
        const [o27, a30] = W2(ge, this._fastUpdates.materialParameters, t31);
        return e44[0] = o27 * i21 + r39, e44[1] = a30 * s34 + r39, e44;
      };
    }
    const i20 = e43[0] / this._symbolTextureRatio + r39, s33 = e43[1] / this._symbolTextureRatio + r39;
    return (e44 = n10()) => (e44[0] = i20, e44[1] = s33, e44);
  }
  _fastVisualVariableConvertOptions() {
    const e43 = Math.max(this._size[0], this._size[1]), t31 = r3(e43, e43, e43), r39 = e10(1), i20 = e43 * r39, s33 = r3(i20, i20, i20);
    return new B2({
      size: true,
      color: true,
      rotation: true,
      opacity: false
    }, t31, s33, r39);
  }
  _forEachMaterial(e43) {
    this._materials.forEach(e43), this._cimSymbolMaterials.forEach(e43);
  }
  test() {
    return __spreadProps(__spreadValues({}, super.test()), {
      material: this._materials[0]
    });
  }
};
function me(e43) {
  return e43 && "point-3d" === e43.type && e43.hasVisibleVerticalOffset();
}
function ue(e43) {
  return null != e43 && ("cross" === e43 || "x" === e43);
}
function de(e43) {
  const t31 = ot(e43);
  return "application/json" === t31?.mediaType ? t31.data : void 0;
}
function pe(e43, t31) {
  return "relative" === e43 ? r7((t31.x || 0) + 0.5, 0.5 - (t31.y || 0)) : e43 in s25 ? s25[e43] : s25.center;
}
function _e({
  parameters: e43
}, t31) {
  const r39 = (e43.width ?? 1) / (e43.height ?? 1);
  return r39 > 1 ? [t31, Math.round(t31 / r39)] : [Math.round(t31 * r39), t31];
}
he.PRIMITIVE_SIZE = ce, he.elevationModeChangeTypes = {
  definedChanged: b6.UPDATE,
  staysOnTheGround: b6.NONE,
  onTheGroundChanged: b6.RECREATE
};
var fe = {
  mode: "relative-to-ground",
  offset: 0
};
var ye = r5(0, 0, 0, 1);
var ge = n2();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/lineUtils.js
function n20(n28) {
  switch (n28) {
    case "butt":
      return r20.BUTT;
    case "square":
      return r20.SQUARE;
    case "round":
      return r20.ROUND;
    default:
      return null;
  }
}
function r31(e43) {
  return "diamond" === e43 ? "kite" : e43;
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLineSymbolLayer.js
var W3 = ["polyline", "polygon", "extent"];
var G7 = new B2({
  size: true,
  color: true,
  rotation: false,
  opacity: true
});
var O15 = class _O extends y6 {
  constructor(e43, t31, r39, i20) {
    super(e43, t31, r39, i20);
  }
  doLoad() {
    return __async(this, null, function* () {
      if (this._fastUpdates = O9(this._context.renderer, G7), !this._drivenProperties.size) {
        if ((null != this.symbolLayer.size ? this.symbolLayer.size : e10(1)) < 0) throw new s2("graphics3dlinesymbollayer:invalid-size", "Symbol sizes may not be negative values");
      }
    });
  }
  _getMaterialParameters(e43, t31 = false) {
    const r39 = this._getCombinedOpacityAndColor(t31 && this._markerColor || this._materialColor);
    this._patternHidesLine && !t31 && (r39[3] = 0);
    const i20 = {
      width: this._computeMaterialWidth(this.symbolLayer?.size),
      color: r39,
      hasPolygonOffset: true,
      join: this.symbolLayer.join || "miter",
      cap: n20(this.symbolLayer.cap || "butt"),
      hasSlicePlane: this._context.slicePlaneEnabled,
      isClosed: e43,
      stipplePattern: n15(this.symbolLayer.pattern)
    };
    return this._fastUpdates?.visualVariables ? __spreadValues(__spreadValues({}, i20), this._fastUpdates.materialParameters) : i20;
  }
  get _materialColor() {
    return this.symbolLayer.material?.color;
  }
  get _markerColor() {
    return this.symbolLayer.marker?.color;
  }
  get _lineMaterial() {
    return null == this._materials[F6.Line] && (this._materials[F6.Line] = new z5(this._getMaterialParameters(false)), this._context.stage.add(this._materials[F6.Line])), this._materials[F6.Line];
  }
  get _ringMaterial() {
    return null == this._materials[F6.Ring] && (this._materials[F6.Ring] = new z5(this._getMaterialParameters(true)), this._context.stage.add(this._materials[F6.Ring])), this._materials[F6.Ring];
  }
  get _wireframeLineMaterial() {
    return null == this._materials[F6.LineWireframe] && (this._materials[F6.LineWireframe] = new z5(__spreadProps(__spreadValues({}, this._getMaterialParameters(false)), {
      wireframe: true
    })), this._context.stage.add(this._materials[F6.LineWireframe])), this._materials[F6.LineWireframe];
  }
  get _wireframeRingMaterial() {
    return null == this._materials[F6.RingWireframe] && (this._materials[F6.RingWireframe] = new z5(__spreadProps(__spreadValues({}, this._getMaterialParameters(true)), {
      wireframe: true
    })), this._context.stage.add(this._materials[F6.RingWireframe])), this._materials[F6.RingWireframe];
  }
  get _markerMaterial() {
    return null == this._materials[F6.Marker] && null != this.symbolLayer.marker && (this._materials[F6.Marker] = new O11(__spreadProps(__spreadValues({}, this._getMaterialParameters(false, true)), {
      placement: this.symbolLayer.marker.placement,
      markerPrimitive: r31(this.symbolLayer.marker.style)
    })), this._context.stage.add(this._materials[F6.Marker])), this._materials[F6.Marker];
  }
  destroy() {
    super.destroy(), this._forEachMaterial((e43) => this._context.stage.remove(e43)), this._materials.length = 0;
  }
  _getDrivenSize(e43) {
    return this._drivenProperties.size && e43.size ? u8(s22(e43.size)) : 1;
  }
  _getDrivenColor(e43) {
    const t31 = r5(1, 1, 1, 1);
    return this._drivenProperties.color && e43.color && (t31[0] = e43.color[0], t31[1] = e43.color[1], t31[2] = e43.color[2], e43.color.length > 0 && (t31[3] = e43.color[3])), this._drivenProperties.opacity && e43.opacity && (t31[3] = e43.opacity), t31;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry, W3, this.symbolLayer.type)) return null;
    const r39 = this.setGraphicElevationContext(t31);
    return this.ensureDrapedStatus("on-the-ground" === r39.mode), this.draped ? this._createAsOverlay(e43, this._context.layer.uid) : this._createAs3DShape(e43, r39, t31.uid);
  }
  applyRendererDiff(e43, t31) {
    for (const r39 in e43.diff) {
      if ("visualVariables" !== r39) return e33.RecreateSymbol;
      {
        const e44 = this._fastUpdates;
        if (!G3(e44, t31, G7)) return e33.RecreateSymbol;
        this._forEachMaterial((t32) => t32?.setParameters(e44.materialParameters));
      }
    }
    return e33.FastUpdate;
  }
  prepareSymbolLayerPatch(e43) {
    if ("partial" !== e43.diff.type) return;
    const t31 = e43.diff.diff, r39 = {};
    "complete" === t31.size?.type && (r39.width = this._computeMaterialWidth(t31.size.newValue), delete t31.size), "complete" === t31.cap?.type && (r39.cap = n20(t31.cap.newValue ?? "butt"), delete t31.cap);
    const i20 = this._prepareMarkerPatch(e43, t31);
    this._prepareMaterialPatch(e43, t31, i20), e43.symbolLayerStatePatches.push(() => this._forEachMaterial((e44) => e44?.setParameters(r39)));
  }
  layerOpacityChanged() {
    this._forEachMaterial((e43, t31) => this._updateMaterialLayerOpacity(e43, t31 === F6.Marker));
  }
  _forEachMaterial(e43) {
    this._materials.forEach(e43);
  }
  _updateMaterialLayerOpacity(e43, t31 = false) {
    if (null == e43) return;
    const r39 = e43.parameters.color, a30 = this.symbolLayer?.material?.color, s33 = this._patternHidesLine && !t31 ? 0 : this._getCombinedOpacity(a30), n28 = r5(r39[0], r39[1], r39[2], s33);
    e43.setParameters({
      color: n28
    });
  }
  layerElevationInfoChanged(e43, t31, r39) {
    const i20 = this._elevationContext.mode, a30 = m9(_O.elevationModeChangeTypes, r39, i20);
    if (a30 !== b6.UPDATE) return a30;
    const s33 = d7(i20);
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, () => s33);
  }
  slicePlaneEnabledChanged() {
    const e43 = {
      hasSlicePlane: this._context.slicePlaneEnabled
    };
    return this._forEachMaterial((t31) => t31?.setParameters(e43)), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  _createAs3DShape(e43, t31, r39) {
    const i20 = V5(e43.graphic.geometry), a30 = "polygon" === i20.type ? i20.rings : i20.paths, m22 = new Array(), h23 = i(), c33 = p10(i20, this._context.elevationProvider, this._context.renderCoordsHelper, t31), d21 = "polygon" === i20.type ? "rings" : "paths";
    this._logGeometryCreationWarnings(c33, a30, d21, "LineSymbol3DLayer");
    for (let s33 = 0; s33 < c33.lines.length; s33++) {
      const t32 = c33.lines[s33], a31 = t32.position, p23 = t32.mapPositions;
      if (null != this._context.clippingExtent && (P2(h23), c3(h23, p23), !V(h23, this._context.clippingExtent))) continue;
      const d22 = this._createGeometry("polygon" === i20.type ? this._ringMaterial : this._lineMaterial, e43, a31, p23, i20.type, T5.ELEVATED, r39);
      m22.push(d22), t18.LINE_WIREFRAMES && m22.push(d22.instantiate({
        material: "polygon" === i20.type ? this._wireframeRingMaterial : this._wireframeLineMaterial
      })), null != this._markerMaterial && m22.push(d22.instantiate({
        material: this._markerMaterial
      }));
    }
    if (0 === m22.length) return null;
    const u32 = new O10({
      geometries: m22,
      castShadow: false,
      layerUid: this._context.layer.uid,
      graphicUid: r39
    }), g17 = new p12(this, u32, m22, null, null, I8, t31);
    return g17.alignedSampledElevation = c33.sampledElevation, g17.needsElevationUpdates = d7(t31.mode), g17;
  }
  _createGeometry(e43, t31, r39, i20, a30, s33, n28) {
    const o27 = s33 === T5.DRAPED ? {
      spatialReference: this._context.overlaySR,
      renderCoordsHelper: this._context.renderCoordsHelper
    } : null, l35 = "polygon" === a30, m22 = this._fastUpdates?.visualVariables.color, h23 = this._fastUpdates?.visualVariables.size, p23 = this._fastUpdates?.visualVariables.opacity, c33 = this._context.stage.renderView.getObjectAndLayerIdColor({
      graphicUid: n28,
      layerUid: this._context.layer.uid
    }), d21 = {
      position: r39,
      size: h23 ? null : this._getDrivenSize(t31.renderingInfo),
      color: m22 ? null : this._getDrivenColor(t31.renderingInfo),
      sizeFeature: h23 ? X(h23.field, t31.graphic) : null,
      colorFeature: m22 ? X(m22.field, t31.graphic) : null,
      opacityFeature: p23 ? X(p23.field, t31.graphic) : null
    };
    return b8(e43, {
      overlayInfo: o27,
      removeDuplicateStartEnd: l35,
      mapPositions: i20,
      attributeData: d21
    }, c33);
  }
  _createAsOverlay(e43, t31) {
    const r39 = e43.graphic, i20 = V5(r39.geometry), a30 = "polygon" === i20.type ? i20.rings : i20.paths, h23 = "polygon" === i20.type ? this._ringMaterial : this._lineMaterial;
    h23.renderPriority = this._renderPriority;
    const p23 = t18.LINE_WIREFRAMES ? "polygon" === i20.type ? this._wireframeRingMaterial : this._wireframeLineMaterial : null, c33 = this._markerMaterial;
    null != p23 && (p23.renderPriority = this._renderPriority - 1e-3), null != c33 && (c33.renderPriority = this._renderPriority - 2e-3);
    const d21 = new Array(), y12 = i(), _16 = P2(), g17 = l17(i20, this._context.overlaySR), f26 = "polygon" === i20.type ? "rings" : "paths";
    this._logGeometryCreationWarnings(g17, a30, f26, "LineSymbol3DLayer");
    for (const s33 of g17.lines) {
      if (P2(y12), c3(y12, s33.position), !V(y12, this._context.clippingExtent)) continue;
      o3(_16, y12);
      const a31 = (a32) => {
        const n28 = this._createGeometry(a32, e43, s33.position, void 0, i20.type, T5.DRAPED, r39.uid), o27 = new m8(n28, {
          layerUid: t31,
          graphicUid: r39.uid
        });
        d21.push(o27);
      };
      if (null != c33) {
        a31(c33);
        const e44 = this.symbolLayer.marker.placement;
        "begin" !== e44 && "begin-end" !== e44 || c3(y12, s33.position, 0, 1), "end" !== e44 && "begin-end" !== e44 || c3(y12, s33.position, s33.position.length - 3, 1);
      }
      a31(h23), t18.LINE_WIREFRAMES && a31(p23);
    }
    return new l28(this, d21, _16, this._context.drapeSourceRenderer);
  }
  get _patternHidesLine() {
    const e43 = this.symbolLayer.pattern;
    return null != e43 && "style" === e43.type && "none" === e43.style;
  }
  _computeMaterialWidth(e43) {
    return e43 = e43 ?? e10(1), this._drivenProperties.size ? this._fastUpdates?.visualVariables.size ? u8(1) : 1 : u8(e43);
  }
  _prepareMaterialPatch(e43, t31, r39) {
    const i20 = t31.material;
    if (null == i20) return void (r39.changed && r39.useMaterialColor && I9(this._getCombinedOpacityAndColor(this._materialColor), this._materials[F6.Marker], e43));
    if ("collection" === i20.type) return;
    const s33 = "complete" === i20.type ? i20.newValue?.color : "complete" === i20.diff.color?.type ? i20.diff.color.newValue : null, n28 = this._getCombinedOpacityAndColor(s33);
    r39.useMaterialColor && I9(t5(n28), this._materials[F6.Marker], e43), this._patternHidesLine && (n28[3] = 0), I9(n28, this._materials[F6.Line], e43), delete t31.material;
  }
  _prepareMarkerPatch(e43, t31) {
    const r39 = t31.marker, i20 = this._markerMaterial;
    if (null == r39 || "partial" !== r39.type || null == r39.diff || null != r39.diff.placement || null != r39.diff.style && "complete" !== r39.diff.style.type || null != r39.diff.color && "complete" !== r39.diff.color.type || null == i20) return {
      changed: false,
      useMaterialColor: null == this._markerColor
    };
    const a30 = r39.diff.color, s33 = null != a30, n28 = s33 ? a30.newValue : null, o27 = null == n28 && null == this._markerColor;
    n28 && I9(this._getCombinedOpacityAndColor(n28), i20, e43);
    const l35 = r39.diff.style?.newValue;
    return l35 && e43.symbolLayerStatePatches.push(() => i20.setParameters({
      markerPrimitive: r31(l35)
    })), delete t31.marker, {
      changed: s33,
      useMaterialColor: o27
    };
  }
};
function V5(e43) {
  switch (e43.type) {
    case "extent":
      if (e43 instanceof w2) return j2.fromExtent(e43);
      break;
    case "polygon":
    case "polyline":
      return e43;
  }
  return null;
}
function I9(e43, t31, r39) {
  null != t31 && r39.symbolLayerStatePatches.push(() => t31.setParameters({
    color: e43
  }));
}
var T5;
var F6;
O15.elevationModeChangeTypes = {
  definedChanged: b6.RECREATE,
  staysOnTheGround: b6.NONE,
  onTheGroundChanged: b6.RECREATE
}, function(e43) {
  e43[e43.DRAPED = 0] = "DRAPED", e43[e43.ELEVATED = 1] = "ELEVATED";
}(T5 || (T5 = {})), function(e43) {
  e43[e43.Line = 0] = "Line", e43[e43.Ring = 1] = "Ring", e43[e43.LineWireframe = 2] = "LineWireframe", e43[e43.RingWireframe = 3] = "RingWireframe", e43[e43.Marker = 4] = "Marker";
}(F6 || (F6 = {}));

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/meshAutoFastUpdateConstants.js
var e37 = {
  disableDelayMs: 2e3
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer.js
var p19 = class extends p12 {
  constructor() {
    super(...arguments), this.fastTransformUpdatesAllowed = false, this._originalGeometries = [], this._fastTransformUpdatesEnabled = false, this._autoDisableFastUpdatesTimeoutId = 0;
  }
  get fastTransformUpdatesEnabled() {
    return this._fastTransformUpdatesEnabled;
  }
  destroy() {
    super.destroy(), this._cancelAutoDisableFastUpdates();
  }
  enableFastTransformUpdates(e43, a30) {
    if (!this.fastTransformUpdatesAllowed || this._fastTransformUpdatesEnabled) return;
    this._cancelAutoDisableFastUpdates(), this._fastTransformUpdatesEnabled = true;
    const {
      stageObject: s33
    } = this, r39 = s33.geometries.slice();
    s33.removeAllGeometries();
    const i20 = I(g12, s33.transformation), o27 = a30.getOrigin(i20);
    for (const t31 of r39) {
      const a31 = e43(t31.material), r40 = t31.instantiate({
        material: a31
      });
      r40.localOrigin = o27, s33.addGeometry(r40);
    }
    this._originalGeometries = r39;
  }
  autoDisableFastTransformUpdates(t31) {
    this._cancelAutoDisableFastUpdates(), this._autoDisableFastUpdatesTimeoutId = setTimeout(() => {
      this._autoDisableFastUpdatesTimeoutId = 0, t31();
    }, e37.disableDelayMs);
  }
  updateAutoDisableFastTransformUpdates(t31) {
    this._autoDisableFastUpdatesTimeoutId && this.autoDisableFastTransformUpdates(t31);
  }
  _cancelAutoDisableFastUpdates() {
    clearTimeout(this._autoDisableFastUpdatesTimeoutId), this._autoDisableFastUpdatesTimeoutId = 0;
  }
  disableFastTransformUpdates(t31) {
    if (!this._fastTransformUpdatesEnabled) return;
    this._cancelAutoDisableFastUpdates(), this._fastTransformUpdatesEnabled = false;
    const {
      stageObject: e43
    } = this, a30 = e43.geometries.map((e44) => t31(e44.material));
    e43.removeAllGeometries();
    for (let s33 = 0; s33 < this._originalGeometries.length; s33++) {
      const t32 = this._originalGeometries[s33], r39 = a30[s33];
      r39.setParameters({
        modelTransformation: null
      }), r39 === t32.material ? e43.addGeometry(t32) : e43.addGeometry(t32.instantiate({
        material: r39
      }));
    }
    this._originalGeometries.length = 0;
  }
  updateFastLocalOrigin(e43, a30, s33) {
    if (!this._fastTransformUpdatesEnabled) return;
    const {
      stageObject: r39
    } = this;
    if (0 === r39.geometries.length) return;
    const o27 = r39.geometries[0].localOrigin, n28 = I(g12, e43), m22 = s33.getOrigin(n28);
    if (m22 === o27) return;
    const l35 = a30?.localMatrix ?? o6;
    r39.shaderTransformation = null, r39.transformation = e43, r39.geometries.forEach((t31) => {
      t31.transformation = l35, t31.localOrigin = m22;
    });
  }
  updateTransform(t31, s33, r39) {
    const {
      stageObject: o27
    } = this, n28 = s33?.localMatrix ?? o6;
    if (!this._fastTransformUpdatesEnabled) return o27.shaderTransformation = null, o27.transformation = t31, o27.geometries.forEach((t32) => t32.transformation = n28), void this._updateEdgeTransform(r39);
    const m22 = o27.transformation, l35 = o27.geometries[0].transformation, f26 = t31, d21 = n28, c33 = c4(u24, m22, l35), h23 = c4(T6, f26, d21), p23 = c4(_11, h23, h4(_11, l35));
    o27.shaderTransformation = p23, this._setFastMaterialTransformation({
      matA: c33,
      matB: h23
    }), this._updateEdgeTransform(r39);
  }
  alignWithElevation(t31, a30, r39, i20) {
    if (!this._fastTransformUpdatesEnabled) return void super.alignWithElevation(t31, a30, r39, i20);
    null != r39 && l16(this.elevationContext.featureExpressionInfoContext, r39);
    const o27 = (e43, s33) => c18(e43, t31, this.elevationContext, a30, s33), {
      stageObject: n28
    } = this;
    if (!n28.geometries[0].material.parameters.modelTransformation) return;
    const m22 = n28.transformation, c33 = n28.geometries[0].transformation, h23 = c4(u24, m22, c33), p23 = n28.effectiveTransformation, g17 = n5(b13, p23);
    this.alignedSampledElevation = p11(this, this.elevationContext, t31.spatialReference, o27, a30, g17), n28.shaderTransformation = g17;
    const _16 = n28.geometries[0].transformation, U11 = c4(T6, g17, _16);
    this._setFastMaterialTransformation({
      matA: h23,
      matB: U11
    }), this._updateEdgeTransform(i20);
  }
  _setFastMaterialTransformation({
    matA: t31,
    matB: s33
  }) {
    const {
      stageObject: i20
    } = this;
    if (0 === i20.geometries.length) return;
    const o27 = i20.geometries[0].localOrigin, m22 = q2(F7, g(g12, o27.vec3, -1)), l35 = c4(U5, m22, t31), f26 = c4(E15, m22, s33), d21 = h4(U5, l35), c33 = c4(E15, f26, d21);
    for (const e43 of i20.geometries) e43.material.setParameters({
      modelTransformation: c33
    });
  }
  _updateEdgeTransform(t31) {
    const {
      stageObject: e43,
      _stageLayer: a30
    } = this;
    a30.stage.renderer.withEdgeView((a31) => {
      a31.fastUpdateObject3DEdgesTransform(e43) || this.resetEdgeObject(t31);
    });
  }
};
var g12 = n2();
var u24 = e12();
var T6 = e12();
var b13 = e12();
var _11 = e12();
var U5 = e12();
var E15 = e12();
var F7 = e12();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/MeshFastUpdateProcessor.js
var r32 = class {
  constructor() {
    this._fastTransformOriginalMaterials = /* @__PURE__ */ new Map(), this._fastTransformClonedMaterials = /* @__PURE__ */ new Map(), this._graphicReferenceCount = 0;
  }
  enable(r39, t31, e43) {
    r39.enableFastTransformUpdates((r40) => {
      if (this._graphicReferenceCount <= 1) {
        if (this._fastTransformOriginalMaterials.has(r40)) return r40;
        const a30 = t31.byMaterial(r40);
        return this._fastTransformOriginalMaterials.set(r40, a30), t31.delete(r40), r40;
      }
      const s33 = new j10(r40.parameters);
      return e43.stage.add(s33), this._fastTransformClonedMaterials.set(s33, r40), s33;
    }, e43.localOriginFactory);
  }
  disable(a30, r39, t31) {
    const e43 = /* @__PURE__ */ new Set(), s33 = /* @__PURE__ */ new Set();
    a30.disableFastTransformUpdates((a31) => {
      if (!this._fastTransformClonedMaterials.has(a31)) {
        const t32 = a31, i21 = this._fastTransformOriginalMaterials.get(t32);
        return r39.has(i21.uid) ? (e43.add(t32), r39.byUid(i21.uid).material) : (s33.add(t32), i21.material);
      }
      const i20 = a31, n28 = this._fastTransformClonedMaterials.get(i20);
      return this._fastTransformClonedMaterials.delete(i20), t31.stage.remove(i20), n28;
    });
    for (const i20 of e43) this._fastTransformOriginalMaterials.delete(i20), t31.stage.remove(i20);
    for (const i20 of s33) {
      const a31 = this._fastTransformOriginalMaterials.get(i20);
      this._fastTransformOriginalMaterials.delete(i20), r39.set(a31.uid, a31);
    }
  }
  onAddGraphic() {
    this._graphicReferenceCount++;
  }
  onRemoveGraphic(a30, r39, t31) {
    this._graphicReferenceCount--, this.disable(a30, r39, t31);
  }
  forEachMaterialInfo(a30) {
    this._fastTransformOriginalMaterials.forEach(a30);
  }
  forEachClonedMaterial(a30) {
    this._fastTransformClonedMaterials.forEach(a30);
  }
  destroy(a30) {
    a30.removeMany(Array.from(this._fastTransformClonedMaterials.keys())), a30.removeMany(Array.from(this._fastTransformOriginalMaterials.values(), ({
      material: a31
    }) => a31)), this._fastTransformClonedMaterials.clear(), this._fastTransformOriginalMaterials.clear();
  }
};
var t29 = class {
  constructor() {
    this._byUid = /* @__PURE__ */ new Map(), this._byMaterial = /* @__PURE__ */ new Map();
  }
  get materials() {
    return Array.from(this._byUid.values(), (a30) => a30.material);
  }
  byUid(a30) {
    return this._byUid.get(a30);
  }
  byMaterial(a30) {
    return this._byMaterial.get(a30);
  }
  set(a30, r39) {
    this._byUid.set(a30, r39), this._byMaterial.set(r39.material, r39);
  }
  delete(a30) {
    const r39 = this._byMaterial.get(a30)?.uid;
    r39 && (this._byUid.delete(r39), this._byMaterial.delete(a30));
  }
  has(a30) {
    return this._byUid.has(a30);
  }
  forEachMaterialInfo(a30) {
    this._byUid.forEach(a30);
  }
  clear() {
    this._byUid.clear(), this._byMaterial.clear();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/NativeLineTechnique.js
var S13 = class _S extends r14 {
  initializeProgram(e43) {
    return new r15(e43.rctx, _S.shader.get().build(this.configuration), O6);
  }
  initializePipeline() {
    const t31 = this.configuration, r39 = l14(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA), i20 = (e43, r40 = null, i21 = null) => S6({
      blending: r40,
      depthTest: i9,
      depthWrite: i21,
      colorWrite: _7,
      stencilWrite: t31.hasOccludees ? e27 : null,
      stencilTest: t31.hasOccludees ? e43 ? o13 : f9 : null
    });
    return t31.output === o7.Color ? (this._occludeePipelineState = i20(true, t31.transparent ? r39 : null, o12), i20(false, t31.transparent ? r39 : null, o12)) : i20(false);
  }
  get primitiveType() {
    return E3.LINES;
  }
  getPipeline(e43) {
    return e43 ? this._occludeePipelineState : super.getPipeline();
  }
};
S13.shader = new t16(m10, () => import("./NativeLine.glsl-2MF353SQ.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration.js
var s28 = class extends t20 {
  constructor() {
    super(...arguments), this.output = o7.Color, this.hasSlicePlane = false, this.hasVertexColors = false, this.transparent = false, this.hasOccludees = false;
  }
};
e5([r17({
  count: o7.COUNT
})], s28.prototype, "output", void 0), e5([r17()], s28.prototype, "hasSlicePlane", void 0), e5([r17()], s28.prototype, "hasVertexColors", void 0), e5([r17()], s28.prototype, "transparent", void 0), e5([r17()], s28.prototype, "hasOccludees", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/NativeLineMaterial.js
var V6 = class extends c16 {
  constructor(e43) {
    super(e43, new U6()), this._configuration = new s28(), this.produces = /* @__PURE__ */ new Map([[E6.OPAQUE_MATERIAL, (e44) => e44 === o7.Color || e44 === o7.Highlight || e44 === o7.ObjectAndLayerIdColor]]);
  }
  getConfiguration(e43) {
    return this._configuration.output = e43, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.hasVertexColors = this.parameters.hasVertexColors, this._configuration.transparent = this.parameters.color[3] < 1 || this.parameters.width < 1, this._configuration.hasOccludees = this.parameters.hasOccludees, this._configuration;
  }
  intersect(t31, r39, f26, p23, d21, S19) {
    if (!f26.options.selectionMode || !t31.visible) return;
    if (!m5(r39)) return void n.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");
    const L10 = t31.attributes.get(e16.POSITION).data, x12 = f26.camera, y12 = Z;
    r10(y12, f26.point);
    const N6 = 2;
    o2(z6[0], y12[0] - N6, y12[1] + N6, 0), o2(z6[1], y12[0] + N6, y12[1] + N6, 0), o2(z6[2], y12[0] + N6, y12[1] - N6, 0), o2(z6[3], y12[0] - N6, y12[1] - N6, 0);
    for (let e43 = 0; e43 < 4; e43++) if (!x12.unprojectFromRenderScreen(z6[e43], J4[e43])) return;
    b3(x12.eye, J4[0], J4[1], K2), b3(x12.eye, J4[1], J4[2], Y4), b3(x12.eye, J4[2], J4[3], $2), b3(x12.eye, J4[3], J4[0], ee2);
    let R10 = Number.MAX_VALUE, T10 = 0;
    for (let e43 = 0; e43 < L10.length - 5; e43 += 3) {
      if (q5[0] = L10[e43] + r39[12], q5[1] = L10[e43 + 1] + r39[13], q5[2] = L10[e43 + 2] + r39[14], B4[0] = L10[e43 + 3] + r39[12], B4[1] = L10[e43 + 4] + r39[13], B4[2] = L10[e43 + 5] + r39[14], V3(K2, q5) < 0 && V3(K2, B4) < 0 || V3(Y4, q5) < 0 && V3(Y4, B4) < 0 || V3($2, q5) < 0 && V3($2, B4) < 0 || V3(ee2, q5) < 0 && V3(ee2, B4) < 0) continue;
      if (x12.projectToRenderScreen(q5, X2), x12.projectToRenderScreen(B4, G8), X2[2] < 0 && G8[2] > 0) {
        e8(D6, q5, B4);
        const e44 = x12.frustum, t33 = -V3(e44[j9.NEAR], q5) / P(D6, F2(e44[j9.NEAR]));
        g(D6, D6, t33), u5(q5, q5, D6), x12.projectToRenderScreen(q5, X2);
      } else if (X2[2] > 0 && G8[2] < 0) {
        e8(D6, B4, q5);
        const e44 = x12.frustum, t33 = -V3(e44[j9.NEAR], B4) / P(D6, F2(e44[j9.NEAR]));
        g(D6, D6, t33), u5(B4, B4, D6), x12.projectToRenderScreen(B4, G8);
      } else if (X2[2] < 0 && G8[2] < 0) continue;
      X2[2] = 0, G8[2] = 0;
      const t32 = j8(h8(X2, G8, H3), y12);
      t32 < R10 && (R10 = t32, r4(k4, q5), r4(F8, B4), T10 = e43 / 3);
    }
    const v15 = f26.rayBegin, w11 = f26.rayEnd;
    if (R10 < N6 * N6) {
      let e43 = Number.MAX_VALUE;
      if (d6(h8(k4, F8, H3), h8(v15, w11, Q3), W4)) {
        e8(W4, W4, v15);
        const t32 = s5(W4);
        g(W4, W4, 1 / t32), e43 = t32 / x(v15, w11);
      }
      S19(e43, W4, T10, false);
    }
  }
  intersectDraped(e43, r39, s33, o27, i20, a30) {
    if (!s33.options.selectionMode) return;
    const n28 = e43.attributes.get(e16.POSITION).data, c33 = e43.attributes.get(e16.SIZE), l35 = c33 ? c33.data[0] : 0, m22 = o27[0], u32 = o27[1], f26 = ((l35 + 1) / 2 + 4) * e43.screenToWorldRatio;
    let p23 = Number.MAX_VALUE, h23 = 0;
    for (let d21 = 0; d21 < n28.length - 5; d21 += 3) {
      const e44 = n28[d21], r40 = n28[d21 + 1], s34 = m22 - e44, o28 = u32 - r40, i21 = n28[d21 + 3] - e44, a31 = n28[d21 + 4] - r40, c34 = e9((i21 * s34 + a31 * o28) / (i21 * i21 + a31 * a31), 0, 1), l36 = i21 * c34 - s34, f27 = a31 * c34 - o28, g17 = l36 * l36 + f27 * f27;
      g17 < p23 && (p23 = g17, h23 = d21 / 3);
    }
    p23 < f26 * f26 && i20(a30.dist, a30.normal, h23, false);
  }
  createGLMaterial(e43) {
    return new I10(e43);
  }
  createBufferWriter() {
    const e43 = this.parameters.hasVertexColors ? r19 : t22;
    return new r13(e43);
  }
};
var I10 = class extends t15 {
  _updateOccludeeState(e43) {
    e43.hasOccludees !== this._material.parameters.hasOccludees && this._material.setParameters({
      hasOccludees: e43.hasOccludees
    });
  }
  beginSlot(e43) {
    return this._output === o7.Color && this._updateOccludeeState(e43), this.ensureTechnique(S13, e43);
  }
};
var U6 = class extends u14 {
  constructor() {
    super(...arguments), this.color = s7, this.hasVertexColors = false, this.hasSlicePlane = false, this.width = 1, this.hasOccludees = false;
  }
};
var q5 = n2();
var B4 = n2();
var D6 = n2();
var W4 = n2();
var X2 = x3();
var G8 = x3();
var k4 = n2();
var F8 = n2();
var H3 = v3();
var Q3 = v3();
var Z = n2();
var z6 = [x3(), x3(), x3(), x3()];
var J4 = [n2(), n2(), n2(), n2()];
var K2 = E2();
var Y4 = E2();
var $2 = E2();
var ee2 = E2();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer.js
var Oe = ["mesh"];
var Ne = class extends y6 {
  constructor(e43, t31, r39, o27) {
    super(e43, t31, r39, o27), this._materialInfoCache = new t29(), this._fastUpdateProcessor = new r32(), this._textures = /* @__PURE__ */ new Map(), this.ensureDrapedStatus(false);
  }
  doLoad() {
    return __async(this, null, function* () {
      t18.DRAW_MESH_GEOMETRY_NORMALS && (this._debugVertexNormalMaterial = new V6({
        color: [1, 0, 1, 1]
      }), this._debugTangentNormalMaterial = new V6({
        color: [1, 0.5, 0, 1]
      }), this._debugFaceNormalMaterial = new V6({
        color: [0, 1, 1, 1]
      }));
    });
  }
  destroy() {
    super.destroy(), this._textures.forEach((e43) => e43.unload()), this._context.stage.removeMany(this._materialInfoCache.materials), this._context.stage.removeMany(Array.from(this._textures.values())), this._materialInfoCache.clear(), this._textures.clear(), this._fastUpdateProcessor.destroy(this._context.stage);
  }
  get materials() {
    return this._materialInfoCache.materials;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry, Oe, "fill on mesh-3d")) return null;
    const r39 = this.setGraphicElevationContext(t31), o27 = e43.renderingInfo;
    return this._createAs3DShape(t31, o27, r39, t31.uid);
  }
  onRemoveGraphic(e43) {
    this._fastUpdateProcessor.onRemoveGraphic(e43, this._materialInfoCache, this._context);
  }
  layerOpacityChanged(e43, t31) {
    const r39 = this._getLayerOpacity();
    this._updateMaterialParameters((e44) => {
      e44.material.setParameters({
        layerOpacity: r39
      });
      const t32 = e44.material.parameters;
      this._setMaterialTransparentParameter(t32, e44), e44.material.setParameters({
        transparent: t32.transparent
      });
    }), e43.forEach((e44) => t31(e44)?.layerOpacityChanged(r39, this._context.isAsync));
  }
  layerElevationInfoChanged(e43, t31) {
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, g5);
  }
  slicePlaneEnabledChanged(e43, t31) {
    return this._updateMaterialParameters(({
      material: e44
    }) => {
      e44.setParameters({
        hasSlicePlane: this._context.slicePlaneEnabled
      });
    }), e43.forEach((e44) => t31(e44)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled, this._context.isAsync)), true;
  }
  physicalBasedRenderingChanged() {
    const e43 = this._usePBR();
    return this._updateMaterialParameters(({
      material: t31
    }) => t31.setParameters({
      usePBR: e43
    })), true;
  }
  updateTransform(e43, t31, r39, o27) {
    if (!e43.fastTransformUpdatesAllowed) return false;
    const n28 = e43.fastTransformUpdatesEnabled;
    switch (o27) {
      case a14.EnableFastUpdates:
        if (n28) return true;
        break;
      case a14.DisableFastUpdates:
        if (!n28) return true;
        break;
      default:
        if (!n28) return !!this.updateTransform(e43, t31, r39, a14.EnableFastUpdates) && (e43.autoDisableFastTransformUpdates(() => this.updateTransform(e43, t31, r39, a14.DisableFastUpdates)), true);
    }
    const a30 = this._context.renderCoordsHelper.spatialReference, s33 = nt2, {
      origin: i20,
      transform: l35
    } = r39;
    if (!u10(t31, o2(Ze, i20.x, i20.y, i20.z ?? 0), s33, a30)) return false;
    switch (o27) {
      case a14.EnableFastUpdates:
        this._fastUpdateProcessor.enable(e43, this._materialInfoCache, this._context);
        break;
      case a14.DisableFastUpdates:
        this._fastUpdateProcessor.disable(e43, this._materialInfoCache, this._context);
        break;
      case a14.UpdateFastLocalOrigin:
        e43.updateFastLocalOrigin(s33, l35, this._context.localOriginFactory);
    }
    const {
      elevationContext: c33
    } = e43;
    c33.centerPointInElevationSR = this._getCenterPointInElevationSR(s33);
    const {
      elevationProvider: u32,
      renderCoordsHelper: m22
    } = this._context, f26 = (e44, t32) => c18(e44, u32, c33, m22, t32);
    return e43.alignedSampledElevation = p11(e43, c33, u32.spatialReference, f26, m22, s33), e43.updateTransform(s33, l35, this._context.isAsync), e43.updateAutoDisableFastTransformUpdates(() => this.updateTransform(e43, t31, r39, a14.DisableFastUpdates)), true;
  }
  _requiresSymbolVertexColors() {
    return this._drivenProperties.color || this._drivenProperties.opacity;
  }
  _materialPropertiesDefault(e43, t31) {
    const r39 = this._requiresSymbolVertexColors(), o27 = !!e43.vertexAttributes.color, n28 = !!e43.vertexAttributes.tangent;
    return {
      hasSymbolVertexColors: r39,
      hasVertexColors: o27,
      hasVertexTangents: n28,
      uid: `vc:${o27},vt:${n28},vct${t31},svc:${r39}`
    };
  }
  _materialProperties(e43, t31, r39) {
    const o27 = this._materialPropertiesDefault(e43, r39);
    if (!t31.material) return o27;
    const {
      color: n28,
      colorTexture: a30,
      colorTextureTransform: s33,
      normalTexture: i20,
      normalTextureTransform: l35,
      doubleSided: c33,
      alphaCutoff: u32,
      alphaMode: m22
    } = t31.material, f26 = Ye(n28), p23 = Ye(a30), h23 = Je(s33), g17 = Ye(i20), d21 = Je(l35);
    if (o27.color = n28, o27.colorTexture = a30, o27.normalTexture = i20, o27.uid = `${o27.uid},cmuid:${f26},ctmuid:${p23},cttuid:${h23},ntmuid:${g17},nttuid:${d21},ds:${c33},ac:${u32},am:${m22}`, t31.material instanceof m6) {
      const {
        metallic: e44,
        roughness: r40,
        metallicRoughnessTexture: n29,
        metallicRoughnessTextureTransform: a31,
        emissiveColor: i21,
        emissiveTexture: c34,
        emissiveTextureTransform: u33,
        occlusionTexture: m23,
        occlusionTextureTransform: f27
      } = t31.material, p24 = Ye(n29), h24 = Je(a31), g18 = Ye(i21), d22 = Ye(c34), x12 = Je(u33), _16 = Ye(m23), T10 = Je(f27);
      o27.metallic = e44, o27.roughness = r40, o27.metallicRoughnessTexture = n29, o27.emissiveColor = i21, o27.emissiveTexture = c34, o27.occlusionTexture = m23, o27.colorTextureTransform = $e(s33), o27.normalTextureTransform = $e(l35), o27.emissiveTextureTransform = $e(u33), o27.occlusionTextureTransform = $e(f27), o27.metallicRoughnessTextureTransform = $e(a31), o27.uid = `${o27.uid},mrm:${e44},mrr:${r40},mrt:${p24},mrtt:${h24},emuid:${g18},etmuid:${d22},ett:${x12},otmuid:${_16},ott:${T10}`;
    }
    return o27;
  }
  _getInternalTextureId(e43) {
    const t31 = this._getInternalTexture(e43, s14.Opaque);
    return t31?.id;
  }
  _getInternalTexture(e43, t31) {
    const r39 = We(e43);
    if (!r39) return null;
    const o27 = `${e43.contentHash}/${t31}`;
    let n28 = this._textures.get(o27);
    if (!n28) {
      let a30 = null;
      const s33 = this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy, i20 = {
        wrap: He(e43.wrap),
        noUnpackFlip: true,
        maxAnisotropy: s33,
        mipmap: s33 > 1
      };
      r11(r39) ? (a30 = r39.data, i20.preMultiplyAlpha = false, i20.encoding = r39.encoding) : (a30 = r39, i20.preMultiplyAlpha = t31 !== s14.Opaque, i20.downsampleUncompressed = this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled), n28 = new N(a30, i20), this._textures.set(o27, n28), n28.load(this._context.stage.renderView.renderingContext), this._context.stage.add(n28);
    }
    return n28;
  }
  _setInternalMaterialParameters(t31, r39) {
    if (null != t31.color && ze(t31.color, r39), null != t31.colorTexture) {
      const e43 = this._getInternalTexture(t31.colorTexture, r39.textureAlphaMode);
      e43 ? (r39.textureId = e43.id, r39.textureAlphaPremultiplied = !!e43.parameters.preMultiplyAlpha) : r39.textureId = void 0;
    }
    t31.normalTexture && (r39.normalTextureId = this._getInternalTextureId(t31.normalTexture)), t31.emissiveColor && (r39.emissiveFactor = u9.toUnitRGB(t31.emissiveColor)), t31.emissiveTexture && (r39.emissiveTextureId = this._getInternalTextureId(t31.emissiveTexture)), t31.occlusionTexture && (r39.occlusionTextureId = this._getInternalTextureId(t31.occlusionTexture)), t31.metallicRoughnessTexture && (r39.metallicRoughnessTextureId = this._getInternalTextureId(t31.metallicRoughnessTexture)), r39.colorTextureTransformMatrix = s15(t31.colorTextureTransform), r39.normalTextureTransformMatrix = s15(t31.normalTextureTransform);
    const o27 = null != t31.normalTextureTransform?.scale ? t31.normalTextureTransform?.scale : l6;
    r39.scale = [o27[0], o27[1]], r39.occlusionTextureTransformMatrix = s15(t31.occlusionTextureTransform), r39.emissiveTextureTransformMatrix = s15(t31.emissiveTextureTransform), r39.metallicRoughnessTextureTransformMatrix = s15(t31.metallicRoughnessTextureTransform);
  }
  _setExternalMaterialParameters(t31) {
    const r39 = this._drivenProperties.color;
    let o27 = this.symbolLayer.material?.colorMixMode ?? null;
    if (r39) t31.externalColor = s7;
    else {
      const r40 = this.symbolLayer.material?.color ?? null;
      r40 ? t31.externalColor = u9.toUnitRGBA(r40) : (o27 = null, t31.externalColor = s7);
    }
    o27 && (t31.colorMixMode = o27), t31.castShadows = !!this.symbolLayer.castShadows;
  }
  _getOrCreateMaterial(t31, r39) {
    const o27 = r39.material?.color, n28 = r39.material?.colorTexture, a30 = r39.material?.alphaMode, s33 = "blend" === a30, i20 = !("opaque" === a30) && (qe(t31) || null != o27 && o27.a < 1 || n28?.transparent || s33), l35 = this._materialProperties(t31, r39, i20), c33 = this._materialInfoCache.byUid(l35.uid);
    if (c33) return c33.material;
    const u32 = {
      uid: l35.uid,
      material: null,
      isComponentTransparent: i20,
      alphaMode: r39.material ? r39.material.alphaMode : "opaque"
    }, m22 = u15({
      normalTexture: l35.normalTexture,
      metallicRoughnessTexture: l35.metallicRoughnessTexture,
      metallicFactor: l35.metallic,
      roughnessFactor: l35.roughness,
      emissiveTexture: l35.emissiveTexture,
      emissiveFactor: u9.toUnitRGB(l35.emissiveColor),
      occlusionTexture: l35.occlusionTexture
    }), f26 = {
      usePBR: this._usePBR(),
      isSchematic: m22,
      hasVertexColors: l35.hasVertexColors,
      hasSymbolColors: l35.hasSymbolVertexColors,
      hasVertexTangents: l35.hasVertexTangents,
      ambient: l3,
      diffuse: _2,
      opacity: 1,
      doubleSided: true,
      doubleSidedType: "winding-order",
      cullFace: e24.None,
      layerOpacity: this._getLayerOpacity(),
      hasSlicePlane: this._context.slicePlaneEnabled,
      initTextureTransparent: true
    };
    f26.mrrFactors = m22 ? [...t17] : [l35.metallic, l35.roughness, r16[2]], r39.material && (f26.doubleSided = r39.material.doubleSided, f26.cullFace = r39.material.doubleSided ? e24.None : e24.Back, f26.textureAlphaCutoff = r39.material.alphaCutoff), this._setExternalMaterialParameters(f26), this._setMaterialTransparentParameter(f26, u32), this._setInternalMaterialParameters(l35, f26);
    const p23 = new j10(f26);
    return u32.material = p23, this._materialInfoCache.set(l35.uid, u32), this._context.stage.add(p23), p23;
  }
  _usePBR() {
    return this._context.physicalBasedRenderingEnabled;
  }
  _setMaterialTransparentParameter(e43, t31) {
    e43.transparent = this.needsDrivenTransparentPass || t31.isComponentTransparent || e43.layerOpacity < 1 || e43.opacity < 1 || e43.externalColor && e43.externalColor[3] < 1, "auto" === t31.alphaMode ? e43.textureAlphaMode = e43.transparent ? s14.MaskBlend : s14.Opaque : e43.textureAlphaMode = "opaque" === t31.alphaMode ? s14.Opaque : "mask" === t31.alphaMode ? s14.Mask : s14.Blend;
  }
  _createFaceDebugNormals(e43, t31) {
    const o27 = t31.length, a30 = e43.spatialReference.isGeographic ? 20015077 / 180 : 1, s33 = 0.1 * Math.max(e43.extent.width * a30, e43.extent.height * a30, e43.extent.zmax - e43.extent.zmin), i20 = [], l35 = [], c33 = t31[0].transformation, u32 = j5(e14(), c33);
    for (let r39 = 0; r39 < o27; r39++) {
      const e44 = t31[r39].attributes.get(e16.POSITION);
      if (!e44) continue;
      const o28 = e44.data, n28 = e44.indices;
      for (let t32 = 0; t32 < n28.length; t32 += 3) Le(o28, n28, t32, rt3), Ge(o28, n28, t32, Ze, et2, tt2), u5(Ze, Ze, et2), u5(Ze, Ze, tt2), g(Ze, Ze, 1 / 3), O3(Ze, Ze, c33), i20.push(...Ze), S3(rt3, rt3, u32), z(rt3, rt3), q(Ze, Ze, rt3, s33), i20.push(...Ze), l35.push(l35.length), l35.push(l35.length);
    }
    return i20.length ? new I4(this._debugFaceNormalMaterial, [[e16.POSITION, new t7(i20, l35, 3, true)]], null, e25.Line) : null;
  }
  _createPerVertexDebugVectors(e43, t31, a30, s33, i20) {
    const l35 = t31.length, c33 = e43.spatialReference.isGeographic ? 20015077 / 180 : 1, u32 = 0.1 * i20 * Math.max(e43.extent.width * c33, e43.extent.height * c33, e43.extent.zmax - e43.extent.zmin), m22 = [], f26 = [], h23 = t31[0].transformation, g17 = j5(e14(), h23);
    a30 === e16.TANGENT && n12(g17, h23);
    for (let r39 = 0; r39 < l35; r39++) {
      const e44 = t31[r39], o27 = e44.attributes.get(e16.POSITION), n28 = e44.attributes.get(a30);
      if (!o27 || !n28) continue;
      const s34 = o27.data, i21 = o27.indices, l36 = n28.data, c34 = n28.indices;
      for (let t32 = 0; t32 < i21.length; t32++) {
        const e45 = 3 * i21[t32], r40 = c34[t32] * n28.stride;
        o2(Ze, s34[e45 + 0], s34[e45 + 1], s34[e45 + 2]), O3(Ze, Ze, h23), m22.push(...Ze), o2(et2, l36[r40 + 0], l36[r40 + 1], l36[r40 + 2]), S3(et2, et2, g17), z(et2, et2), q(Ze, Ze, et2, u32), m22.push(...Ze), f26.push(f26.length), f26.push(f26.length);
      }
    }
    return m22.length ? new I4(s33, [[e16.POSITION, new t7(m22, f26, 3, true)]], null, e25.Line) : null;
  }
  _createAs3DShape(e43, t31, r39, o27) {
    const n28 = e43.geometry;
    if ("mesh" !== n28.type) return null;
    const a30 = this._createGeometryInfo(n28, t31, o27);
    if (null == a30) return null;
    const {
      geometries: s33,
      objectTransformation: i20
    } = a30;
    if (t18.DRAW_MESH_GEOMETRY_NORMALS) {
      const e44 = this._createPerVertexDebugVectors(n28, s33, e16.NORMAL, this._debugVertexNormalMaterial, 1), t32 = this._createPerVertexDebugVectors(n28, s33, e16.TANGENT, this._debugTangentNormalMaterial, 0.5), r40 = this._createFaceDebugNormals(n28, s33);
      e44 && s33.push(e44), t32 && s33.push(t32), r40 && s33.push(r40);
    }
    const l35 = new O10({
      geometries: s33,
      layerUid: this._context.layer.uid,
      graphicUid: o27,
      isElevationSource: true
    });
    l35.transformation = i20;
    const c33 = a8(this.symbolLayer, {
      opacity: this._getLayerOpacity()
    }), u32 = c33 ? new j11(s33[0].material, [c33], {
      mergeGeometries: true,
      hasSlicePlane: this._context.slicePlaneEnabled
    }) : null, m22 = new p19(this, l35, s33, null, null, p11, r39, u32);
    this._fastUpdateProcessor.onAddGraphic(), m22.needsElevationUpdates = g5(r39.mode), m22.useObjectOriginAsAttachmentOrigin = true, m22.fastTransformUpdatesAllowed = this._fastTransformUpdatesAllowed(n28), r39.centerPointInElevationSR = this._getCenterPointInElevationSR(l35.transformation);
    const {
      elevationProvider: f26,
      renderCoordsHelper: p23
    } = this._context, h23 = (e44, t32) => c18(e44, f26, r39, p23, t32);
    return m22.alignedSampledElevation = p11(m22, r39, f26.spatialReference, h23, p23), m22;
  }
  _fastTransformUpdatesAllowed(e43) {
    const {
      vertexSpace: t31,
      spatialReference: r39
    } = e43;
    if (!a9(t31)) return false;
    const {
      type: o27
    } = t31, {
      view: n28
    } = this._context.graphicsCoreOwner, {
      viewingMode: a30
    } = n28.state, s33 = n28.spatialReference;
    return a30 === l8.Global && "local" === o27 || a30 === l8.Local && G(s33, r39) && "georeferenced" === o27 && !r39.isGeographic;
  }
  _getCenterPointInElevationSR(e43) {
    const t31 = e13(0, 0, 0, null != this._context.elevationProvider.spatialReference ? this._context.elevationProvider.spatialReference : null);
    return t21([e43[12], e43[13], e43[14]], this._context.renderCoordsHelper.spatialReference, t31), t31;
  }
  _passthroughReprojectionInfo(e43) {
    return e43.reprojection === it3.NONE && !!e43.objectTransformation;
  }
  _createPositionBuffer(e43, t31) {
    const r39 = e43.vertexAttributes.position;
    let o27 = r39, n28 = null;
    if (t31.reprojection === it3.NONE) return {
      position: o27,
      georeferencedPositionBuffer: n28
    };
    const a30 = t31.reprojection === it3.RENDER ? t31.transformBeforeProject : null;
    a30 && (o27 = e21(new Float64Array(o27.length), o27, a30));
    const {
      normal: s33,
      tangent: i20
    } = e43.vertexAttributes;
    this._passthroughReprojectionInfo(t31) || !s33 && !i20 || (n28 = o27);
    const l35 = o27 === r39 || o27 === n28 ? new Float64Array(o27.length) : o27;
    return n4(o27, e43.spatialReference, 0, l35, this._context.renderCoordsHelper.spatialReference, 0, o27.length / 3), {
      position: l35,
      georeferencedPositionBuffer: n28
    };
  }
  _createNormalBuffer(e43, t31, r39, o27) {
    const n28 = e43.vertexAttributes.normal;
    if (null == n28) return null;
    let a30 = n28;
    const s33 = o27.reprojection === it3.RENDER ? o27.transformBeforeProject : null;
    s33 && (a30 = V4(a30, new Float32Array(a30.length), s33));
    const i20 = this._context.graphicsCoreOwner.view.viewingMode;
    if (o27.reprojection === it3.NONE) return a30;
    if ("local" === i20) {
      if (!O2(this._context.renderCoordsHelper.spatialReference)) return a30;
      if (null == r39) return null;
      if (e43.spatialReference.isGeographic) {
        const e44 = a30 === n28 ? new Float32Array(a30.length) : a30;
        return U2(a30, D4.NORMAL, r39, e44);
      }
      if (e43.spatialReference.isWebMercator) {
        const e44 = a30 === n28 ? new Float32Array(a30.length) : a30;
        return $(a30, D4.NORMAL, r39, e44);
      }
      return a30;
    }
    if (null == r39) return null;
    const l35 = a30 === n28 ? new Float32Array(a30.length) : a30;
    return v2(a30, r39, t31, e43.spatialReference, l35);
  }
  _createTangentBuffer(e43, t31, r39, o27) {
    const n28 = e43.vertexAttributes.tangent;
    if (null == n28) return null;
    let a30 = n28;
    const s33 = o27.reprojection === it3.RENDER ? o27.transformBeforeProject : null;
    s33 && (a30 = B(a30, new Float32Array(a30.length), s33));
    const i20 = this._context.graphicsCoreOwner.view.viewingMode;
    if (o27.reprojection === it3.NONE) return a30;
    if ("local" === i20) {
      if (!O2(this._context.renderCoordsHelper.spatialReference)) return a30;
      if (null == r39) return null;
      if (e43.spatialReference.isGeographic) {
        const e44 = a30 === n28 ? new Float32Array(a30.length) : a30;
        return U2(a30, D4.TANGENT, r39, e44);
      }
      if (e43.spatialReference.isWebMercator) {
        const e44 = a30 === n28 ? new Float32Array(a30.length) : a30;
        return $(a30, D4.TANGENT, r39, e44);
      }
      return a30;
    }
    if (null == r39) return null;
    const l35 = a30 === n28 ? new Float32Array(a30.length) : a30;
    return Y2(a30, r39, t31, e43.spatialReference, l35);
  }
  _createSymbolColorBuffer(e43) {
    if (this._requiresSymbolVertexColors()) {
      const t31 = this._getVertexOpacityAndColor(e43), r39 = e17(this.symbolLayer?.material?.colorMixMode), o27 = new Uint8Array(4);
      return r8(t31, r39, o27), o27;
    }
    return null;
  }
  _createBuffers(e43, t31) {
    const r39 = e43.vertexAttributes && e43.vertexAttributes.position;
    if (!r39) return this.logger.warn("Mesh geometry must contain position vertex attributes"), null;
    const o27 = e43.vertexAttributes.normal, n28 = e43.vertexAttributes.uv, a30 = e43.vertexAttributes.tangent;
    if (o27 && o27.length !== r39.length) return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"), null;
    if (a30 && a30.length / 4 != r39.length / 3) return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"), null;
    if (n28 && n28.length / 2 != r39.length / 3) return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"), null;
    const s33 = this._computeReprojectionInfo(e43), {
      position: i20,
      georeferencedPositionBuffer: l35
    } = this._createPositionBuffer(e43, s33), u32 = Ke(e43), m22 = this._createSymbolColorBuffer(t31), f26 = this._createNormalBuffer(e43, i20, l35, s33), p23 = this._createTangentBuffer(e43, i20, l35, s33), h23 = n28, {
      transformation: g17,
      position: d21,
      normal: x12,
      tangent: _16
    } = this._passthroughReprojectionInfo(s33) ? {
      transformation: s33.objectTransformation,
      position: i20,
      normal: f26,
      tangent: p23
    } : this._transformOriginLocal(e43, i20, f26, p23);
    return {
      positionBuffer: d21,
      normalBuffer: x12,
      tangentBuffer: _16,
      uvBuffer: h23,
      colorBuffer: u32,
      symbolColorBuffer: m22,
      objectTransformation: g17,
      geometryTransformation: s33.reprojection === it3.NONE && s33.geometryTransformation ? s33.geometryTransformation : e12()
    };
  }
  _computeReprojectionInfo(e43) {
    const {
      vertexSpace: t31
    } = e43, r39 = "georeferenced" === t31.type ? G(this._context.renderCoordsHelper.spatialReference, e43.spatialReference) ? it3.NONE : it3.RENDER : it3.NONE;
    if (p5(t31)) return {
      reprojection: r39
    };
    const o27 = t31.origin, n28 = e12(), i20 = e43.transform?.localMatrix ?? o6;
    if (r39 === it3.NONE) {
      u10(e43.spatialReference, o27, n28, this._context.renderCoordsHelper.spatialReference);
      return {
        reprojection: r39,
        objectTransformation: n28,
        geometryTransformation: r6(i20)
      };
    }
    const l35 = q2(e12(), o27);
    return c4(l35, l35, i20), {
      reprojection: r39,
      transformBeforeProject: l35
    };
  }
  _transformOriginLocal(e43, t31, r39, o27) {
    const n28 = this._context.renderCoordsHelper.spatialReference, a30 = e43.anchor;
    Xe[0] = a30.x, Xe[1] = a30.y, Xe[2] = a30.z ?? 0;
    const s33 = e12();
    u10(e43.spatialReference, Xe, s33, n28), h4(ot5, s33);
    const {
      position: l35,
      normal: u32,
      tangent: m22
    } = e43.vertexAttributes, f26 = t31 === l35 ? new Float64Array(t31.length) : t31;
    e21(f26, t31, ot5);
    const p23 = r39 ? r39 === u32 ? new Float32Array(r39.length) : r39 : null, h23 = o27 ? o27 === m22 ? new Float32Array(o27.length) : o27 : null;
    return r39 && p23 && V4(r39, p23, ot5), o27 && h23 && B(o27, h23, ot5), {
      transformation: s33,
      position: f26,
      normal: p23,
      tangent: h23
    };
  }
  _validateFaces(e43, t31) {
    const r39 = e43.vertexAttributes.position.length / 3, o27 = t31.faces;
    if (o27) {
      let e44 = -1;
      for (let t32 = 0; t32 < o27.length; t32++) {
        const r40 = o27[t32];
        r40 > e44 && (e44 = r40);
      }
      if (r39 <= e44) return this.logger.warn(`Vertex index ${e44} is out of bounds of the mesh position buffer`), false;
    } else if (r39 % 3 != 0) return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"), false;
    return true;
  }
  _isOutsideClippingArea(e43) {
    if (!this._context.clippingExtent) return false;
    const t31 = e43.vertexAttributes?.position;
    if (!t31) return false;
    const r39 = this._context.elevationProvider.spatialReference, o27 = J3({
      positions: t31,
      transform: e43.transform,
      vertexSpace: e43.vertexSpace,
      inSpatialReference: e43.spatialReference,
      outSpatialReference: r39 ?? e43.spatialReference,
      localMode: this._context.stage.viewingMode === l8.Local
    });
    if (!o27) return false;
    const n28 = o27.length / 3;
    return P2(at3), c3(at3, o27, 0, n28), !V(at3, this._context.clippingExtent);
  }
  _createGeometryInfo(e43, t31, r39) {
    if (!J2(e43.spatialReference, this._context.renderCoordsHelper.spatialReference)) return this.logger.warn("Geometry spatial reference is not compatible with the view"), null;
    if (!this._validateVertexSpace(e43)) return null;
    if (this._isOutsideClippingArea(e43)) return null;
    const o27 = this._createBuffers(e43, t31);
    if (null == o27) return null;
    const {
      positionBuffer: n28,
      uvBuffer: a30,
      colorBuffer: s33,
      symbolColorBuffer: i20,
      normalBuffer: c33,
      tangentBuffer: u32,
      objectTransformation: m22,
      geometryTransformation: f26
    } = o27, p23 = Ve(e43), h23 = new Array();
    let g17 = false;
    const d21 = I(Ze, m22), x12 = this._context.localOriginFactory.getOrigin(d21);
    for (const l35 of p23) {
      if (!this._validateFaces(e43, l35)) return null;
      const t32 = Se(e43, l35);
      if (0 === t32.length) continue;
      const o28 = Ue(n28, c33, l35, t32);
      o28.didFlipNormals && (g17 = true);
      const m23 = [[e16.POSITION, new t7(n28, t32, 3, true)], [e16.NORMAL, new t7(o28.normals, o28.indices, 3, true)]];
      s33 && m23.push([e16.COLOR, new t7(s33, t32, 4, true)]), i20 && m23.push([e16.SYMBOLCOLOR, new t7(i20, A5(t32.length), 4, true)]), a30 && m23.push([e16.UV0, new t7(a30, t32, 2, true)]), u32 && m23.push([e16.TANGENT, new t7(u32, t32, 4, true)]);
      const p24 = this._context.stage.renderView.getObjectAndLayerIdColor({
        graphicUid: r39,
        layerUid: this._context.layer.uid
      }), d22 = this._getOrCreateMaterial(e43, l35), _16 = new I4(d22, m23, null, e25.Mesh, p24);
      _16.transformation = f26, _16.localOrigin = x12, h23.push(_16);
    }
    return g17 && this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."), {
      geometries: h23,
      objectTransformation: m22
    };
  }
  _updateMaterialParameters(e43) {
    this._materialInfoCache.forEachMaterialInfo(e43), this._fastUpdateProcessor.forEachMaterialInfo(e43), this._fastUpdateProcessor.forEachClonedMaterial((e44, t31) => {
      t31.setParameters(e44.parameters);
    });
  }
  _validateVertexSpace(e43) {
    const {
      _context: {
        graphicsCoreOwner: {
          view: {
            state: {
              viewingMode: t31
            }
          }
        }
      }
    } = this, {
      vertexSpace: r39
    } = e43;
    return t31 !== l8.Local || "local" !== r39.type || (this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."), false);
  }
  test() {
    return __spreadProps(__spreadValues({}, super.test()), {
      materials: this._materialInfoCache.materials
    });
  }
};
var Ie = class {
  constructor(e43, t31, r39) {
    this.normals = e43, this.indices = t31, this.didFlipNormals = r39;
  }
};
function Se(e43, t31) {
  return t31.faces ?? l11(e43.vertexAttributes.position.length / 3);
}
function Ue(e43, t31, r39, o27) {
  switch (r39.shading || "flat") {
    default:
    case "source":
      return Fe(e43, t31, r39, o27);
    case "flat":
      return Be(e43, o27);
    case "smooth":
      return De(e43, o27);
  }
}
function Be(e43, t31) {
  const r39 = t11(t31.length), o27 = new Array(3 * t31.length);
  for (let n28 = 0; n28 < t31.length; n28 += 3) {
    const a30 = Le(e43, t31, n28, rt3);
    for (let e44 = 0; e44 < 3; e44++) r39[n28 + e44] = a30[e44], o27[n28 + e44] = n28 / 3;
  }
  return new Ie(r39, o27, false);
}
function Fe(e43, t31, r39, o27) {
  if (null == t31) return Be(e43, o27);
  let n28 = false;
  if (!r39.trustSourceNormals) for (let a30 = 0; a30 < o27.length; a30 += 3) {
    Le(e43, o27, a30, rt3);
    for (let e44 = 0; e44 < 3; e44++) {
      const r40 = 3 * o27[a30 + e44];
      Ze[0] = t31[r40], Ze[1] = t31[r40 + 1], Ze[2] = t31[r40 + 2], P(rt3, Ze) < 0 && (t31[r40] = -t31[r40], t31[r40 + 1] = -t31[r40 + 1], t31[r40 + 2] = -t31[r40 + 2], n28 = true);
    }
  }
  return new Ie(t31, o27, n28);
}
function De(e43, t31) {
  const r39 = {};
  for (let a30 = 0; a30 < t31.length; a30 += 3) {
    const o28 = Le(e43, t31, a30, rt3);
    for (let e44 = 0; e44 < 3; e44++) {
      const n29 = t31[a30 + e44];
      let s33 = r39[n29];
      s33 || (s33 = {
        normal: n2(),
        count: 0
      }, r39[n29] = s33), u5(s33.normal, s33.normal, o28), s33.count++;
    }
  }
  const o27 = t11(3 * t31.length), n28 = new Array(3 * t31.length);
  for (let a30 = 0; a30 < t31.length; a30++) {
    const e44 = r39[t31[a30]];
    1 !== e44.count && (z(e44.normal, e44.normal), e44.count = 1);
    for (let t32 = 0; t32 < 3; t32++) o27[3 * a30 + t32] = e44.normal[t32];
    n28[a30] = a30;
  }
  return new Ie(o27, n28, false);
}
function Ge(e43, t31, r39, o27, n28, a30) {
  const s33 = 3 * t31[r39], i20 = 3 * t31[r39 + 1], l35 = 3 * t31[r39 + 2];
  o27[0] = e43[s33], o27[1] = e43[s33 + 1], o27[2] = e43[s33 + 2], n28[0] = e43[i20], n28[1] = e43[i20 + 1], n28[2] = e43[i20 + 2], a30[0] = e43[l35], a30[1] = e43[l35 + 1], a30[2] = e43[l35 + 2];
}
function Le(e43, t31, r39, o27) {
  return Ge(e43, t31, r39, Ze, et2, tt2), e8(et2, et2, Ze), e8(tt2, tt2, Ze), _3(Ze, et2, tt2), z(o27, Ze), o27;
}
function Ve(e43) {
  return e43.components ?? st2;
}
function $e(e43) {
  if (!e43) return null;
  const {
    scale: r39,
    offset: o27,
    rotation: n28
  } = e43;
  return {
    scale: r39,
    offset: o27,
    rotation: h(n28)
  };
}
function He(e43 = "repeat") {
  if ("string" == typeof e43) {
    const t31 = ke(e43);
    return {
      s: t31,
      t: t31
    };
  }
  return {
    s: ke(e43.horizontal),
    t: ke(e43.vertical)
  };
}
function ke(e43) {
  switch (e43) {
    case "clamp":
      return D3.CLAMP_TO_EDGE;
    case "mirror":
      return D3.MIRRORED_REPEAT;
    default:
      return D3.REPEAT;
  }
}
function qe(e43) {
  const t31 = e43.vertexAttributes.color;
  if (null == t31) return false;
  for (let r39 = 3; r39 < t31.length; r39 += 4) if (255 !== t31[r39]) return true;
  return false;
}
function ze(t31, r39) {
  r39.diffuse = u9.toUnitRGB(t31), r39.opacity = t31.a;
}
function We(e43) {
  return e43.data ?? e43.url;
}
function Ye(t31) {
  return null == t31 ? "-" : t31 instanceof u9 ? t31.toHex() : t31.contentHash;
}
function Je(e43) {
  const {
    offset: t31,
    scale: r39,
    rotation: o27
  } = e43 ?? Qe;
  return `${t31[0]},${t31[1]},${o27},${r39[0]},${r39[1]}`;
}
function Ke(e43) {
  return e43.vertexAttributes.color;
}
var Qe = new c12();
var Xe = n2();
var Ze = n2();
var et2 = n2();
var tt2 = n2();
var rt3 = n2();
var ot5 = e12();
var nt2 = e12();
var at3 = i();
var st2 = [new h9()];
var it3;
!function(e43) {
  e43[e43.NONE = 0] = "NONE", e43[e43.RENDER = 1] = "RENDER";
}(it3 || (it3 = {}));

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer.js
var p20 = class {
  constructor(e43, t31, i20, n28) {
    this.graphics3DSymbolLayer = e43, this.instanceIndex = t31, this.elevationAligner = i20, this.elevationContext = n28, this.type = "lod-instance", this._highlights = /* @__PURE__ */ new Set(), this.alignedSampledElevation = 0, this.isElevationSource = false, this.needsElevationUpdates = false;
  }
  initialize() {
  }
  setVisibility(e43) {
    const t31 = this._lodRenderer.instanceData;
    e43 !== t31.getVisible(this.instanceIndex) && t31.setVisible(this.instanceIndex, e43);
  }
  destroy() {
    null != this.instanceIndex && (this._lodRenderer.instanceData.removeInstance(this.instanceIndex), this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this));
  }
  alignWithElevation(e43, t31, i20) {
    if (this.elevationAligner) {
      l16(this.elevationContext.featureExpressionInfoContext, i20);
      const n28 = (i21, n29) => c18(i21, e43, this.elevationContext, t31, n29), s33 = this.elevationAligner(this, this.elevationContext, e43.spatialReference, n28, t31);
      null != s33 && (this.alignedSampledElevation = s33);
    }
  }
  getCenterObjectSpace(e43 = n2()) {
    return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex, I11), O3(e43, this._lodRenderer.baseBoundingSphere.center, I11);
  }
  getBoundingBoxObjectSpace(e43 = i()) {
    this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex, I11);
    const n28 = this._lodRenderer.baseBoundingBox;
    P2(e43);
    for (let s33 = 0; s33 < 8; ++s33) o2(x7, 1 & s33 ? n28[3] : n28[0], 2 & s33 ? n28[4] : n28[1], 4 & s33 ? n28[5] : n28[2]), O3(x7, x7, I11), h3(e43, x7);
    return e43;
  }
  computeAttachmentOrigin(e43) {
    this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex, I11), e43.render.origin[0] += I11[12], e43.render.origin[1] += I11[13], e43.render.origin[2] += I11[14], e43.render.num++;
  }
  getProjectedBoundingBox(e43, i20, n28, a30, r39) {
    return __async(this, null, function* () {
      const c33 = this.getBoundingBoxObjectSpace(r39), d21 = b14, m22 = w3(c33) ? 1 : d21.length;
      this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex, I11);
      for (let s33 = 0; s33 < m22; s33++) {
        const e44 = d21[s33];
        x7[0] = c33[e44[0]], x7[1] = c33[e44[1]], x7[2] = c33[e44[2]], O3(x7, x7, I11), u25[3 * s33] = x7[0], u25[3 * s33 + 1] = x7[1], u25[3 * s33 + 2] = x7[2];
      }
      if (!e43(u25, 0, m22)) return null;
      P2(c33);
      let f26 = null;
      this.calculateRelativeScreenBounds && (f26 = this.calculateRelativeScreenBounds());
      for (let t31 = 0; t31 < 3 * m22; t31 += 3) {
        for (let e44 = 0; e44 < 3; e44++) c33[e44] = Math.min(c33[e44], u25[t31 + e44]), c33[e44 + 3] = Math.max(c33[e44 + 3], u25[t31 + e44]);
        f26 && n28.push({
          location: u25.slice(t31, t31 + 3),
          screenSpaceBoundingRect: f26
        });
      }
      if (i20 && (E(c33, v9), "absolute-height" !== this.elevationContext.mode)) {
        let e44;
        const t31 = k2(c33, i20.service.spatialReference, i20);
        try {
          e44 = yield i20.service.queryElevation(v9[0], v9[1], a30, t31, "ground");
        } catch (p23) {
        }
        null != e44 && Y(c33, 0, 0, -this.alignedSampledElevation + e44);
      }
      return c33;
    });
  }
  addObjectState(e43, t31) {
    if (e43 === t14.Highlight) {
      const i20 = new r12(e43);
      this._addHighlightId(i20), t31.addExternal((e44) => {
        this._removeHighlightId(e44);
      }, i20);
    }
  }
  removeObjectState(e43) {
    this._highlights.forEach((t31) => e43.remove(t31));
  }
  _addHighlightId(e43) {
    this._highlights.add(e43), this._lodRenderer.instanceData.setHighlight(this.instanceIndex, true);
  }
  _removeHighlightId(e43) {
    this._highlights.delete(e43), this._lodRenderer.instanceData.setHighlight(this.instanceIndex, this._highlights.size > 0);
  }
  get _lodRenderer() {
    return this.graphics3DSymbolLayer.lodRenderer;
  }
};
var u25 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
var x7 = n2();
var v9 = n2();
var b14 = [[0, 1, 2], [3, 1, 2], [0, 4, 2], [3, 4, 2], [0, 1, 5], [3, 1, 5], [0, 4, 5], [3, 4, 5]];
var I11 = e12();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/lodResourceUtils.js
function n21(e43, n28) {
  const r39 = e43.stageResources.geometries.map((t31) => new s19(t31, e43.stageResources.textures)), u32 = null == e43.lodThreshold || 0 === e43.lodThreshold && n28 > 0 ? s29(r39) : e43.lodThreshold;
  return new r23(r39, u32, e43.pivotOffset);
}
function r33(o27) {
  return new n17(o27.map((e43, o28) => n21(e43, o28)));
}
function s29(e43) {
  const o27 = e43.reduce((e44, {
    geometry: o28
  }) => e44 + o28.indexCount / 3, 0);
  return Math.sqrt(o27 * u26 / Math.PI);
}
var u26 = 20;

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/webStyleUtils.js
function r34(r39) {
  return __async(this, null, function* () {
    if (null === r39 || null == r39.styleName && null == r39.styleUrl) return null;
    const o27 = r39.name;
    if (null == o27) throw new s2("symbolstyleutils:style-symbol-reference-name-missing", "Missing name in style symbol reference");
    const u32 = {
      portal: r39.portal
    }, i20 = yield y3(r39, u32).catch(() => null);
    if (null === i20) return null;
    const m22 = j4(o27, i20.data);
    if (m22 && !m22.formatInfos?.some((l35) => "gltf_basisu" === l35.type)) return null;
    const a30 = yield h5(i20, o27, u32, "webRef", (l35, t31) => d3(l35, t31, ["gltf_basisu", "gltf"])).catch(() => null);
    if (null === a30 || "point-3d" !== a30.type) return null;
    const y12 = a30.symbolLayers.items[0];
    return "object" === y12.type ? y12.resource : null;
  });
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject.js
var r35 = class {
  constructor(r39, i20, s33) {
    this._elementSize = i20, this._buffer = c9.createVertex(r39, F3.STATIC_DRAW), this.resize(s33);
  }
  destroy() {
    this._buffer.dispose();
  }
  get elementSize() {
    return this._elementSize;
  }
  get capacity() {
    return this._capacity;
  }
  get array() {
    return this._array;
  }
  get buffer() {
    return this._buffer;
  }
  get usedMemory() {
    return this._array.byteLength + this._buffer.usedMemory;
  }
  copyRange(e43, t31, r39, i20 = 0) {
    const s33 = new Uint8Array(this.array, e43 * this.elementSize, (t31 - e43) * this.elementSize);
    new Uint8Array(r39.array, i20 * this.elementSize).set(s33);
  }
  transferAll() {
    this._buffer.setData(this._array);
  }
  transferRange(e43, t31) {
    const r39 = e43 * this._elementSize, i20 = t31 * this._elementSize;
    this._buffer.setSubData(new Uint8Array(this._array), r39, r39, i20);
  }
  resize(e43) {
    const t31 = e43 * this._elementSize, r39 = new ArrayBuffer(t31);
    this._array && (e43 >= this._capacity ? new Uint8Array(r39).set(new Uint8Array(this._array)) : new Uint8Array(r39).set(new Uint8Array(this._array).subarray(0, e43 * this._elementSize))), this._array = r39, this._buffer.setSize(t31), this._capacity = e43;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData.js
var c25 = class {
  constructor(t31) {
    this.modelOriginHi = t31.getField(e16.INSTANCEMODELORIGINHI, i4), this.modelOriginLo = t31.getField(e16.INSTANCEMODELORIGINLO, i4), this.model = t31.getField(e16.INSTANCEMODEL, l10), this.modelNormal = t31.getField(e16.INSTANCEMODELNORMAL, l10), this.featureAttribute = t31.getField(e16.INSTANCEFEATUREATTRIBUTE, c8), this.color = t31.getField(e16.INSTANCECOLOR, x4), this.objectAndLayerIdColor = t31.getField(e16.INSTANCEOBJECTANDLAYERIDCOLOR, x4);
  }
};
var f20 = class {
  constructor(t31, i20) {
    this._rctx = t31, this._instanceBufferLayout = i20, this._headIndex = 0, this._tailIndex = 0, this._firstIndex = null, this._captureFirstIndex = true, this._updating = false, this._prevHeadIndex = 0, this._resized = false, this._capacity = 1;
  }
  destroy() {
    this._buffer && this._buffer.destroy();
  }
  get buffer() {
    return this._buffer.buffer;
  }
  get view() {
    return this._view;
  }
  get capacity() {
    return this._capacity;
  }
  get size() {
    const t31 = this._headIndex, i20 = this._tailIndex;
    return t31 >= i20 ? t31 - i20 : t31 + this._capacity - i20;
  }
  get isEmpty() {
    return this._headIndex === this._tailIndex;
  }
  get isFull() {
    return this._tailIndex === (this._headIndex + 1) % this._capacity;
  }
  get headIndex() {
    return this._headIndex;
  }
  get tailIndex() {
    return this._tailIndex;
  }
  get firstIndex() {
    return this._firstIndex;
  }
  get usedMemory() {
    return this._buffer?.usedMemory ?? 0;
  }
  reset() {
    this._headIndex = 0, this._tailIndex = 0, this._firstIndex = null;
  }
  startUpdateCycle() {
    this._captureFirstIndex = true;
  }
  beginUpdate() {
    s12(!this._updating, "already updating"), this._updating = true, this._prevHeadIndex = this._headIndex;
  }
  endUpdate() {
    s12(this._updating, "not updating"), this.size < r * this.capacity && this._shrink(), this._resized ? (this._buffer.transferAll(), this._resized = false) : this._transferRange(this._prevHeadIndex, this._headIndex), this._updating = false;
  }
  allocateHead() {
    s12(this._updating, "not updating"), this.isFull && this._grow();
    const t31 = this.headIndex;
    return this._captureFirstIndex && (this._firstIndex = t31, this._captureFirstIndex = false), this._incrementHead(), s12(this._headIndex !== this._tailIndex, "invalid pointers"), t31;
  }
  freeTail() {
    s12(this._updating, "not updating"), s12(this.size > 0, "invalid size");
    const t31 = this._tailIndex === this._firstIndex;
    this._incrementTail(), t31 && (this._firstIndex = this._tailIndex);
  }
  _grow() {
    const t31 = Math.max(u27, Math.floor(this._capacity * t));
    this._resize(t31);
  }
  _shrink() {
    const t31 = Math.max(u27, Math.floor(this._capacity * e));
    this._resize(t31);
  }
  _resize(t31) {
    if (s12(this._updating, "not updating"), t31 === this._capacity) return;
    const i20 = new r35(this._rctx, this._instanceBufferLayout.stride, t31);
    if (this._buffer) {
      this._firstIndex && (this._firstIndex = (this._firstIndex + this._capacity - this._tailIndex) % this._capacity);
      const t32 = this.size, e43 = this._compactInstances(i20);
      s12(e43 === t32, "invalid compaction"), this._buffer.destroy(), this._tailIndex = 0, this._headIndex = e43, this._prevHeadIndex = 0;
    }
    this._resized = true, this._capacity = t31, this._buffer = i20, this._view = new c25(this._instanceBufferLayout.createView(this._buffer.array));
  }
  _compactInstances(t31) {
    const i20 = this._headIndex, e43 = this._tailIndex;
    return e43 < i20 ? (this._buffer.copyRange(e43, i20, t31), i20 - e43) : e43 > i20 ? (this._buffer.copyRange(e43, this._capacity, t31), i20 > 0 && this._buffer.copyRange(0, i20, t31, this._capacity - e43), i20 + (this._capacity - e43)) : 0;
  }
  _incrementHead(t31 = 1) {
    this._headIndex = (this._headIndex + t31) % this._capacity;
  }
  _incrementTail(t31 = 1) {
    this._tailIndex = (this._tailIndex + t31) % this._capacity;
  }
  _transferRange(t31, i20) {
    t31 < i20 ? this._buffer.transferRange(t31, i20) : t31 > i20 && (i20 > 0 && this._buffer.transferRange(0, i20), this._buffer.transferRange(t31, this._capacity));
  }
};
var u27 = 64;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/InstanceData.js
var M3;
function C3(t31) {
  let e43 = H2().mat4f64(e16.LOCALTRANSFORM).mat4f64(e16.GLOBALTRANSFORM).vec4f64(e16.BOUNDINGSPHERE).vec3f64(e16.MODELORIGIN).mat3f(e16.INSTANCEMODEL).mat3f(e16.INSTANCEMODELNORMAL).vec2f(e16.MODELSCALEFACTORS);
  return t31.includes(e16.FEATUREATTRIBUTE) && (e43 = e43.vec4f(e16.FEATUREATTRIBUTE)), t31.includes(e16.COLOR) && (e43 = e43.vec4u8(e16.COLOR)), t31.includes(e16.OBJECTANDLAYERIDCOLOR) && (e43 = e43.vec4u8(e16.OBJECTANDLAYERIDCOLOR)), e43 = e43.u8(e16.STATE).u8(e16.LODLEVEL), e43;
}
!function(t31) {
  t31[t31.ALLOCATED = 1] = "ALLOCATED", t31[t31.DEFAULT_ACTIVE = 2] = "DEFAULT_ACTIVE", t31[t31.VISIBLE = 4] = "VISIBLE", t31[t31.HIGHLIGHT = 8] = "HIGHLIGHT", t31[t31.HIGHLIGHT_ACTIVE = 16] = "HIGHLIGHT_ACTIVE", t31[t31.REMOVE = 32] = "REMOVE", t31[t31.TRANSFORM_CHANGED = 64] = "TRANSFORM_CHANGED", t31[t31.ACTIVE = 18] = "ACTIVE";
}(M3 || (M3 = {}));
var R6 = class {
  constructor(t31) {
    this.localTransform = t31.getField(e16.LOCALTRANSFORM, b4), this.globalTransform = t31.getField(e16.GLOBALTRANSFORM, b4), this.modelOrigin = t31.getField(e16.MODELORIGIN, T2), this.model = t31.getField(e16.INSTANCEMODEL, l10), this.modelNormal = t31.getField(e16.INSTANCEMODELNORMAL, l10), this.modelScaleFactors = t31.getField(e16.MODELSCALEFACTORS, u13), this.boundingSphere = t31.getField(e16.BOUNDINGSPHERE, h7), this.featureAttribute = t31.getField(e16.FEATUREATTRIBUTE, c8), this.color = t31.getField(e16.COLOR, x4), this.objectAndLayerIdColor = t31.getField(e16.OBJECTANDLAYERIDCOLOR, x4), this.state = t31.getField(e16.STATE, d5), this.lodLevel = t31.getField(e16.LODLEVEL, d5);
  }
};
var b15 = class extends S2 {
  constructor(t31, e43) {
    super(t31), this.events = new o(), this._capacity = 0, this._size = 0, this._next = 0, this._layout = C3(e43), this._capacity = u27, this._buffer = this._layout.createBuffer(this._capacity), this._view = new R6(this._buffer);
  }
  get capacity() {
    return this._capacity;
  }
  get size() {
    return this._size;
  }
  get view() {
    return this._view;
  }
  addInstance() {
    this._size + 1 > this._capacity && this._grow();
    const t31 = this._findSlot();
    return this._view.state.set(t31, M3.ALLOCATED), this._size++, this.events.emit("instances-changed"), t31;
  }
  removeInstance(t31) {
    const e43 = this._view.state;
    s12(t31 >= 0 && t31 < this._capacity && !!(e43.get(t31) & M3.ALLOCATED), "invalid instance handle"), this._getStateFlag(t31, M3.ACTIVE) ? this._setStateFlags(t31, M3.REMOVE) : this.freeInstance(t31), this.events.emit("instances-changed");
  }
  freeInstance(t31) {
    const e43 = this._view.state;
    s12(t31 >= 0 && t31 < this._capacity && !!(e43.get(t31) & M3.ALLOCATED), "invalid instance handle"), e43.set(t31, 0), this._size--;
  }
  setLocalTransform(t31, e43, s33 = true) {
    this._view.localTransform.setMat(t31, e43), s33 && this.updateModelTransform(t31);
  }
  getLocalTransform(t31, e43) {
    this._view.localTransform.getMat(t31, e43);
  }
  setGlobalTransform(t31, e43, s33 = true) {
    this._view.globalTransform.setMat(t31, e43), s33 && this.updateModelTransform(t31);
  }
  getGlobalTransform(t31, e43) {
    this._view.globalTransform.getMat(t31, e43);
  }
  updateModelTransform(t31) {
    const e43 = this._view, s33 = y8, i20 = D7;
    e43.localTransform.getMat(t31, N2), e43.globalTransform.getMat(t31, V7);
    const a30 = c4(V7, V7, N2);
    o2(s33, a30[12], a30[13], a30[14]), e43.modelOrigin.setVec(t31, s33), n12(i20, a30), e43.model.setMat(t31, i20);
    const r39 = g4(y8, a30);
    r39.sort(), e43.modelScaleFactors.set(t31, 0, r39[1]), e43.modelScaleFactors.set(t31, 1, r39[2]), s10(i20, i20), u11(i20, i20), e43.modelNormal.setMat(t31, i20), this._setStateFlags(t31, M3.TRANSFORM_CHANGED), this.events.emit("instance-transform-changed", {
      index: t31
    });
  }
  getModelTransform(t31, e43) {
    const s33 = this._view;
    s33.model.getMat(t31, D7), s33.modelOrigin.getVec(t31, y8), e43[0] = D7[0], e43[1] = D7[1], e43[2] = D7[2], e43[3] = 0, e43[4] = D7[3], e43[5] = D7[4], e43[6] = D7[5], e43[7] = 0, e43[8] = D7[6], e43[9] = D7[7], e43[10] = D7[8], e43[11] = 0, e43[12] = y8[0], e43[13] = y8[1], e43[14] = y8[2], e43[15] = 1;
  }
  applyShaderTransformation(t31, e43) {
    null != this.shaderTransformation && this.shaderTransformation.applyTransform(this, t31, e43);
  }
  getCombinedModelTransform(t31, e43) {
    return this.getModelTransform(t31, e43), null != this.shaderTransformation && this.shaderTransformation.applyTransform(this, t31, e43), e43;
  }
  getCombinedLocalTransform(t31, e43) {
    this._view.localTransform.getMat(t31, e43), null != this.shaderTransformation && this.shaderTransformation.applyTransform(this, t31, e43);
  }
  getCombinedMaxScaleFactor(t31) {
    let e43 = this._view.modelScaleFactors.get(t31, 1);
    return null != this.shaderTransformation && (this.shaderTransformation.scaleFactor(y8, this, t31), e43 *= Math.max(y8[0], y8[1], y8[2])), e43;
  }
  getCombinedMedianScaleFactor(t31) {
    let e43 = this._view.modelScaleFactors.get(t31, 0);
    return null != this.shaderTransformation && (this.shaderTransformation.scaleFactor(y8, this, t31), e43 *= w6(y8[0], y8[1], y8[2])), e43;
  }
  getModel(t31, e43) {
    this._view.model.getMat(t31, e43);
  }
  setFeatureAttribute(t31, e43) {
    this._view.featureAttribute.setVec(t31, e43);
  }
  getFeatureAttribute(t31, e43) {
    this._view.featureAttribute.getVec(t31, e43);
  }
  setColor(t31, e43) {
    this._view.color.setVec(t31, e43);
  }
  setObjectAndLayerIdColor(t31, e43) {
    this._view.objectAndLayerIdColor.setVec(t31, e43);
  }
  setVisible(t31, e43) {
    e43 !== this.getVisible(t31) && (this._setStateFlag(t31, M3.VISIBLE, e43), this.events.emit("instance-visibility-changed", {
      index: t31
    }));
  }
  getVisible(t31) {
    return this._getStateFlag(t31, M3.VISIBLE);
  }
  setHighlight(t31, e43) {
    e43 !== this.getHighlight(t31) && (this._setStateFlag(t31, M3.HIGHLIGHT, e43), this.events.emit("instance-highlight-changed"));
  }
  getHighlight(t31) {
    return this._getStateFlag(t31, M3.HIGHLIGHT);
  }
  getState(t31) {
    return this._view.state.get(t31);
  }
  getLodLevel(t31) {
    return this._view.lodLevel.get(t31);
  }
  countFlags(t31) {
    let e43 = 0;
    for (let s33 = 0; s33 < this._capacity; ++s33) {
      this.getState(s33) & t31 && ++e43;
    }
    return e43;
  }
  _setStateFlags(t31, e43) {
    const s33 = this._view.state;
    e43 = s33.get(t31) | e43, s33.set(t31, e43);
  }
  _clearStateFlags(t31, e43) {
    const s33 = this._view.state;
    e43 = s33.get(t31) & ~e43, s33.set(t31, e43);
  }
  _setStateFlag(t31, e43, s33) {
    s33 ? this._setStateFlags(t31, e43) : this._clearStateFlags(t31, e43);
  }
  _getStateFlag(t31, e43) {
    return !!(this._view.state.get(t31) & e43);
  }
  _grow() {
    this._capacity = Math.max(u27, Math.floor(this._capacity * t)), this._buffer = this._layout.createBuffer(this._capacity).copyFrom(this._buffer), this._view = new R6(this._buffer);
  }
  _findSlot() {
    const t31 = this._view.state;
    let e43 = this._next;
    for (; t31.get(e43) & M3.ALLOCATED; ) e43 = e43 + 1 === this._capacity ? 0 : e43 + 1;
    return this._next = e43 + 1 === this._capacity ? 0 : e43 + 1, e43;
  }
};
function w6(t31, e43, s33) {
  return Math.max(Math.min(t31, e43), Math.min(Math.max(t31, e43), s33));
}
e5([y({
  constructOnly: true
})], b15.prototype, "shaderTransformation", void 0), e5([y()], b15.prototype, "_size", void 0), e5([y({
  readOnly: true
})], b15.prototype, "size", null), b15 = e5([a3("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")], b15);
var y8 = n2();
var D7 = e14();
var N2 = e12();
var V7 = e12();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/InstanceOctree.js
var n22 = class extends Y3 {
  constructor(e43, r39) {
    super((t31) => z2(this._instanceData.view.boundingSphere.getVec(t31, this._tmpSphere)), {
      maximumDepth: 25
    }), this._instanceData = e43, this._boundingSphere = r39, this._tmpSphere = _5(), this._tmpMat4 = e12();
  }
  addInstance(t31) {
    const s33 = this._instanceData.view.boundingSphere, i20 = this._instanceData.getCombinedModelTransform(t31, this._tmpMat4);
    O3(V2(this._tmpSphere), this._boundingSphere.center, i20), this._tmpSphere[3] = this._boundingSphere.radius * m4(i20), s33.setVec(t31, this._tmpSphere), this.add([t31]);
  }
  removeInstance(t31) {
    this.remove([t31]);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LevelSelector.js
var e38 = class {
  constructor(e43, i20) {
    this._worldSpaceRadius = e43, this._minScreenSpaceRadii = i20;
  }
  selectLevel(e43, i20, t31) {
    const c33 = t31.computeScreenPixelSizeAt(e43), r39 = this._worldSpaceRadius * i20 / c33;
    let s33 = 0;
    for (let a30 = 1; a30 < this._minScreenSpaceRadii.length; ++a30) r39 >= this._minScreenSpaceRadii[a30] && (s33 = a30);
    return s33;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodComponentData.js
var u28 = class {
  constructor(s33, i20) {
    const o27 = s33.renderContext.rctx, n28 = i20.geometry;
    this._materials = s33.materials, n28.material.setParameters({
      instancedDoublePrecision: true
    });
    const u32 = n28.material.createBufferWriter(), f26 = u32.vertexBufferLayout, d21 = u32.elementCount(n28), c33 = f26.createBuffer(d21);
    u32.write(null, null, n28, c33, 0), this.geometry = n28, this.material = n28.material, this.glMaterials = new t23(n28.material, this._materials), this.vertexBufferLayout = f26, this.vbo = c9.createVertex(o27, F3.STATIC_DRAW, c33.buffer), this.vao = new r21(o27, O6, {
      geometry: t9(f26)
    }, {
      geometry: this.vbo
    }), this.vertexCount = d21;
  }
  destroy() {
    this.glMaterials.dispose(), this.vbo.dispose(), this.vao.dispose();
  }
  get boundingInfo() {
    return this.geometry.boundingInfo;
  }
  get triangleCount() {
    return this.vertexCount / 3;
  }
  intersect(r39, t31, e43, a30, m22, l35, u32, f26) {
    const d21 = this.geometry.id;
    this.material.intersect(this.geometry, r39.transform.transform, r39, e43, a30, (e44, a31, c33, p23, h23) => {
      if (e44 >= 0) {
        if (null != t31 && !t31(r39.rayBegin, r39.rayEnd, e44)) return;
        const p24 = new s18(l35.layerUid, l35.graphicUid(m22), d21, c33, u32, f26);
        if ((null == r39.results.min.drapedLayerOrder || h23 >= r39.results.min.drapedLayerOrder) && (null == r39.results.min.dist || e44 < r39.results.min.dist) && r39.results.min.set(i11.LOD, p24, e44, a31, r39.transform.transform, h23), r39.options.store !== e28.MIN && (null == r39.results.max.drapedLayerOrder || h23 >= r39.results.max.drapedLayerOrder) && (null == r39.results.max.dist || e44 > r39.results.max.dist) && r39.results.max.set(i11.LOD, p24, e44, a31, r39.transform.transform, h23), r39.options.store === e28.ALL) {
          const t32 = G4(r39.results.min.ray);
          t32.set(i11.LOD, p24, e44, a31, r39.transform.transform, h23), r39.results.all.push(t32);
        }
      }
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodLevel.js
var a26 = class _a {
  static create(e43, r39, i20) {
    return __async(this, null, function* () {
      const s33 = yield Promise.allSettled(r39.components.map((o27) => e43.controller.schedule(() => new u28(e43, o27), i20))), c33 = s33.map((o27) => "fulfilled" === o27.status ? o27.value : null).filter(O);
      if (c(i20) || c33.length !== s33.length) {
        c33.forEach((o27) => o27.destroy()), s3(i20);
        for (const o27 of s33) if ("rejected" === o27.status) throw o27.reason;
      }
      return new _a(r39.minScreenSpaceRadius, c33);
    });
  }
  constructor(o27, n28) {
    this.minScreenSpaceRadius = o27, this.components = n28;
  }
  destroy() {
    this.components.forEach((o27) => o27.destroy());
  }
  intersect(o27, n28, t31, e43, r39, i20, s33) {
    this.components.forEach((c33) => c33.intersect(o27, n28, t31, e43, r39, i20, this.boundingSphere, s33));
  }
  get boundingBox() {
    if (null == this._boundingBox) {
      const o27 = P2();
      this.components.forEach((n28) => {
        null != n28.boundingInfo && (h3(o27, n28.boundingInfo.bbMin), h3(o27, n28.boundingInfo.bbMax));
      }), this._boundingBox = o27;
    }
    return this._boundingBox;
  }
  get boundingSphere() {
    if (null == this._boundingSphere) {
      const o27 = this.boundingBox, n28 = n2();
      E(o27, n28), this._boundingSphere = {
        center: n28,
        radius: 0.5 * T(o27)
      };
    }
    return this._boundingSphere;
  }
  get triangleCount() {
    return this.components.reduce((o27, n28) => o27 + n28.triangleCount, 0);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/lodRendering/LodRenderer.js
var V8 = (e43) => {
  const t31 = e43.baseBoundingSphere.radius, r39 = e43.levels.map((e44) => e44.minScreenSpaceRadius);
  return new e38(t31, r39);
};
var B5 = class extends d8 {
  constructor(e43, t31) {
    super(e43), this.type = i11.LOD, this.isGround = false, this._levels = [], this._defaultRenderInstanceData = [new Array()], this._highlightRenderInstanceData = [new Array()], this._allRenderInstanceData = [this._defaultRenderInstanceData[0], this._highlightRenderInstanceData[0]], this._instanceIndex = 0, this._cycleStartIndex = 0, this._slicePlane = false, this._camera = new it(), this._updateCyclesWithStaticCamera = -1, this._needFullCycle = false, this.produces = /* @__PURE__ */ new Map([[E6.OPAQUE_MATERIAL, (e44) => this._produces(e44)], [E6.TRANSPARENT_MATERIAL, (e44) => !!this._hasTransparentLevels() && this._produces(e44)]]), this._instanceData = new b15({
      shaderTransformation: e43.shaderTransformation
    }, e43.optionalFields), this.addHandles(t31.registerTask(I2.LOD_RENDERER, this));
  }
  initialize() {
    this._instanceBufferLayout = q6(this.optionalFields), this._glInstanceBufferLayout = t9(this._instanceBufferLayout, 1), this.addHandles([this._instanceData.events.on("instances-changed", () => this._requestUpdateCycle()), this._instanceData.events.on("instance-transform-changed", ({
      index: e43
    }) => {
      this._requestUpdateCycle(), this.metadata.notifyGraphicGeometryChanged(e43);
    }), this._instanceData.events.on("instance-visibility-changed", ({
      index: e43
    }) => {
      this._requestUpdateCycle(true), this.metadata.notifyGraphicVisibilityChanged(e43);
    }), this._instanceData.events.on("instance-highlight-changed", () => this._requestUpdateCycle(true))]);
  }
  get _enableLevelSelection() {
    return this.symbol.levels.length > 1;
  }
  get levels() {
    return this._levels;
  }
  get baseBoundingBox() {
    return this._levels[this._levels.length - 1].boundingBox;
  }
  get baseBoundingSphere() {
    return this._levels[this._levels.length - 1].boundingSphere;
  }
  get baseMaterial() {
    return this._levels[this._levels.length - 1].components[0].material;
  }
  get slicePlaneEnabled() {
    return this._slicePlane;
  }
  set slicePlaneEnabled(e43) {
    this._slicePlane = e43;
  }
  get layerUid() {
    return this.metadata.layerUid;
  }
  get instanceData() {
    return this._instanceData;
  }
  get usedMemory() {
    return this._allRenderInstanceData.reduce((e43, t31) => t31.reduce((e44, t32) => e44 + t32.usedMemory, e43), 0);
  }
  get renderStats() {
    const e43 = this._instanceData.size, t31 = [];
    return this._levels.forEach((e44, r39) => {
      const a30 = this._allRenderInstanceData[0][r39].size + this._allRenderInstanceData[1][r39].size, s33 = e44.triangleCount;
      t31.push({
        renderedInstances: a30,
        renderedTriangles: a30 * s33,
        trianglesPerInstance: s33
      });
    }), {
      totalInstances: e43,
      renderedInstances: t31.reduce((e44, t32) => e44 + t32.renderedInstances, 0),
      renderedTriangles: t31.reduce((e44, t32) => e44 + t32.renderedTriangles, 0),
      levels: t31
    };
  }
  initializeRenderContext(e43, r39) {
    return __async(this, null, function* () {
      this._context = e43;
      const n28 = e43.renderContext.rctx, i20 = yield Promise.allSettled(this.symbol.levels.map((t31) => (this._defaultRenderInstanceData[0].push(new f20(n28, this._instanceBufferLayout)), this._highlightRenderInstanceData[0].push(new f20(n28, this._instanceBufferLayout)), a26.create(e43, t31, r39)))), o27 = i20.map((e44) => "fulfilled" === e44.status ? e44.value : null).filter(O);
      if (c(r39) || o27.length !== i20.length) {
        o27.forEach((e44) => e44.destroy()), s3(r39);
        for (const e44 of i20) if ("rejected" === e44.status) throw e44.reason;
      }
      this._levels = o27, this._levelSelector = V8(this);
    });
  }
  uninitializeRenderContext() {
    this._invalidateOctree(), this._levels.forEach((e43) => e43.destroy()), this._defaultRenderInstanceData[0].forEach((e43) => e43.destroy()), this._highlightRenderInstanceData[0].forEach((e43) => e43.destroy());
  }
  _hasTransparentLevels() {
    return this._levels.some((e43) => e43.components.some((e44) => {
      const t31 = e44.material.produces.get(E6.TRANSPARENT_MATERIAL);
      return t31?.(o7.Color);
    }));
  }
  hasHighlights() {
    return this._highlightRenderInstanceData[0].some((e43) => e43.size > 0);
  }
  _produces(e43) {
    return e43 !== o7.Highlight && e43 !== o7.ShadowHighlight || this.hasHighlights();
  }
  prepareRender(e43) {
    if (!t18.LOD_INSTANCE_RENDERER_DISABLE_UPDATES) {
      if (this._enableLevelSelection) {
        const t31 = e43.bindParameters.contentCamera.equals(this._camera);
        this._camera.copyFrom(e43.bindParameters.contentCamera), t31 || this._requestUpdateCycle();
      }
      this._needFullCycle && (this.runTask(C), this._needFullCycle = false);
    }
  }
  prepareTechniques(e43) {
    if (!this.baseMaterial.isVisible() || !this.baseMaterial.isVisibleForOutput(e43.output)) return null;
    const t31 = this._getInstanceDatas(e43.output);
    if (!t31) return null;
    const r39 = new Array();
    return t31.forEach((t32) => this.levels.forEach((a30, s33) => {
      a30.components.forEach((a31) => r39.push(this._beginComponent(e43, t32[s33], a31)));
    })), r39;
  }
  renderNode(e43, t31) {
    const r39 = this._getInstanceDatas(e43.output);
    if (!r39 || null == t31) return;
    let a30 = 0;
    e43.rctx.bindVAO(), r39.forEach((r40) => this.levels.forEach((s33, n28) => {
      s33.components.forEach((s34) => this._renderComponent(e43, t31[a30++], r40[n28], s34, n28));
    }));
  }
  _getInstanceDatas(e43) {
    const t31 = e43 !== o7.Highlight && e43 !== o7.ShadowHighlight, r39 = e43 !== o7.ShadowExcludeHighlight;
    return t31 && r39 ? this._allRenderInstanceData : t31 ? this._defaultRenderInstanceData : r39 ? this._highlightRenderInstanceData : null;
  }
  intersect(e43, t31, r39, a30) {
    if (!this.baseMaterial.isVisible() || null == this._octree) return;
    const s33 = n2();
    e8(s33, a30, r39);
    const n28 = (s34) => {
      this._instanceData.getCombinedModelTransform(s34, W5), e43.transform.set(W5), O3(K3, r39, e43.transform.inverse), O3(Y5, a30, e43.transform.inverse);
      const n29 = this._instanceData.getState(s34), i20 = this._instanceData.getLodLevel(s34), o27 = this._levels.length;
      s12(!!(n29 & M3.ACTIVE), "invalid instance state"), s12(i20 >= 0 && i20 < o27, "invaid lod level"), this._levels[i20].intersect(e43, t31, K3, Y5, s34, this.metadata, o27);
    };
    this.baseMaterial.parameters.verticalOffset ? this._octree.forEach(n28) : this._octree.forEachAlongRay(r39, s33, n28);
  }
  notifyShaderTransformationChanged() {
    this._invalidateOctree(), this._requestUpdateCycle();
  }
  get _octree() {
    if (null == this._octreeCached) {
      const e43 = this._instanceData, t31 = e43.view?.state;
      if (!t31) return null;
      this._octreeCached = new n22(e43, this.baseBoundingSphere);
      for (let r39 = 0; r39 < e43.capacity; ++r39) t31.get(r39) & M3.ACTIVE && this._octreeCached.addInstance(r39);
    }
    return this._octreeCached;
  }
  _invalidateOctree() {
    this._octreeCached = u(this._octreeCached);
  }
  queryDepthRange(e43) {
    if (null == this._octree) return {
      near: 1 / 0,
      far: -1 / 0
    };
    const t31 = e43.viewForward, r39 = this._octree.findClosest(t31, Y3.DepthOrder.FRONT_TO_BACK, e43.frustum), a30 = this._octree.findClosest(t31, Y3.DepthOrder.BACK_TO_FRONT, e43.frustum);
    if (null == r39 || null == a30) return {
      near: 1 / 0,
      far: -1 / 0
    };
    const s33 = e43.eye, n28 = this._instanceData.view;
    n28.boundingSphere.getVec(r39, k5), e8(k5, k5, s33);
    const i20 = P(k5, t31) - k5[3];
    n28.boundingSphere.getVec(a30, k5), e8(k5, k5, s33);
    const o27 = P(k5, t31) + k5[3];
    return {
      near: Math.max(e43.near, i20),
      far: Math.min(e43.far, o27)
    };
  }
  _requestUpdateCycle(e43 = false) {
    this._updateCyclesWithStaticCamera = -1, this._cycleStartIndex = this._instanceIndex, e43 && (this._needFullCycle = true, this._context.requestRender());
  }
  _startUpdateCycle() {
    this._updateCyclesWithStaticCamera++, this._allRenderInstanceData.forEach((e43) => e43.forEach((e44) => e44.startUpdateCycle()));
  }
  get running() {
    return this._instanceData.size > 0 && this._updateCyclesWithStaticCamera < 1;
  }
  runTask(e43) {
    const {
      _enableLevelSelection: t31,
      _camera: r39,
      _levelSelector: a30
    } = this;
    this._allRenderInstanceData.forEach((e44) => e44.forEach((e45) => e45.beginUpdate()));
    const s33 = this._instanceData, n28 = s33.view;
    let i20 = s33.size;
    const o27 = s33.capacity;
    let l35 = this._instanceIndex;
    const c33 = Math.ceil(o27 / 500);
    for (let h23 = 0; h23 < i20 && !e43.done; ++h23) {
      l35 === this._cycleStartIndex && this._startUpdateCycle();
      const h24 = n28.state.get(l35);
      let d21 = 0;
      if (!(h24 & M3.ALLOCATED)) {
        l35 = l35 + 1 === o27 ? 0 : l35 + 1, i20++;
        continue;
      }
      const u32 = n28.lodLevel.get(l35);
      if (h24 & M3.DEFAULT_ACTIVE && this._defaultRenderInstanceData[0][u32].freeTail(), h24 & M3.HIGHLIGHT_ACTIVE && this._highlightRenderInstanceData[0][u32].freeTail(), h24 & M3.REMOVE) s33.freeInstance(l35);
      else if (h24 & M3.VISIBLE) {
        let e44 = 0;
        t31 && (n28.modelOrigin.getVec(l35, z7), e44 = a30.selectLevel(z7, s33.getCombinedMedianScaleFactor(l35), r39)), d21 = h24 & ~(M3.ACTIVE | M3.TRANSFORM_CHANGED), e44 >= 0 && (h24 & M3.HIGHLIGHT ? (P5(this._highlightRenderInstanceData[0][e44], n28, l35), d21 |= M3.HIGHLIGHT_ACTIVE) : (P5(this._defaultRenderInstanceData[0][e44], n28, l35), d21 |= M3.DEFAULT_ACTIVE)), n28.state.set(l35, d21), n28.lodLevel.set(l35, e44);
      } else d21 = h24 & ~(M3.ACTIVE | M3.TRANSFORM_CHANGED), n28.state.set(l35, d21);
      if (null != this._octreeCached) {
        const e44 = !!(h24 & M3.ACTIVE), t32 = !!(d21 & M3.ACTIVE);
        !e44 && t32 ? this._octreeCached.addInstance(l35) : e44 && !t32 ? this._octreeCached.removeInstance(l35) : e44 && t32 && h24 & M3.TRANSFORM_CHANGED && (this._octreeCached.removeInstance(l35), this._octreeCached.addInstance(l35));
      }
      l35 = l35 + 1 === o27 ? 0 : l35 + 1, l35 % c33 == 0 && e43.madeProgress();
    }
    this._instanceIndex = l35, this._allRenderInstanceData.forEach((e44) => e44.forEach((e45) => e45.endUpdate())), this._context.requestRender();
  }
  _beginComponent(e43, t31, r39) {
    if (0 === t31.size) return null;
    const a30 = r39.glMaterials.load(e43.rctx, e43.bindParameters.slot, e43.output);
    return null != a30 ? a30.beginSlot(e43.bindParameters) : null;
  }
  _renderComponent(e43, t31, r39, a30, s33) {
    if (!t31) return;
    const {
      bindParameters: n28,
      rctx: i20
    } = e43;
    i20.runAppleAmdDriverHelper();
    const o27 = i20.bindTechnique(t31, n28, a30.material.parameters, Q4);
    i20.bindVAO(a30.vao), t31.ensureAttributeLocations(a30.vao), t18.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL && e43.output === o7.Color && (o27.setUniform4fv("externalColor", J5[Math.min(s33, J5.length - 1)]), o27.setUniform1i("colorMixMode", c15.replace));
    const l35 = r39.capacity, c33 = r39.headIndex, h23 = r39.tailIndex, d21 = r39.firstIndex, u32 = this._glInstanceBufferLayout, m22 = (e44, s34) => {
      E4(i20, O6, r39.buffer, u32, e44), i20.drawArraysInstanced(t31.primitiveType, 0, a30.vertexCount, s34 - e44), _6(i20, O6, r39.buffer, u32);
    };
    a30.material.parameters.transparent && null != d21 ? c33 > h23 ? (s12(d21 >= h23 && d21 <= c33, "invalid firstIndex"), m22(d21, c33), m22(h23, d21)) : c33 < h23 && (d21 <= c33 ? (s12(d21 >= 0 && d21 <= c33, "invalid firstIndex"), m22(d21, c33), m22(h23, l35), m22(0, d21)) : (s12(d21 >= h23 && d21 <= l35, "invalid firstIndex"), m22(d21, l35), m22(0, c33), m22(h23, d21))) : c33 > h23 ? m22(h23, c33) : c33 < h23 && (m22(0, c33), m22(h23, l35)), i20.bindVAO(null);
  }
};
function P5(e43, t31, r39) {
  const a30 = e43.allocateHead();
  G9(t31, r39, e43.view, a30);
}
function G9(e43, t31, r39, a30) {
  l13(e43.modelOrigin, t31, r39.modelOriginHi, r39.modelOriginLo, a30), r39.model.copyFrom(a30, e43.model, t31), r39.modelNormal.copyFrom(a30, e43.modelNormal, t31), e43.color && r39.color && r39.color.copyFrom(a30, e43.color, t31), e43.objectAndLayerIdColor && r39.objectAndLayerIdColor && r39.objectAndLayerIdColor.copyFrom(a30, e43.objectAndLayerIdColor, t31), e43.featureAttribute && r39.featureAttribute && r39.featureAttribute.copyFrom(a30, e43.featureAttribute, t31);
}
function q6(e43) {
  let t31 = H2().vec3f(e16.INSTANCEMODELORIGINHI).vec3f(e16.INSTANCEMODELORIGINLO).mat3f(e16.INSTANCEMODEL).mat3f(e16.INSTANCEMODELNORMAL);
  return null != e43 && e43.includes("featureAttribute") && (t31 = t31.vec4f(e16.INSTANCEFEATUREATTRIBUTE)), null != e43 && e43.includes("color") && (t31 = t31.vec4u8(e16.INSTANCECOLOR)), null != e43 && e43.includes("objectAndLayerIdColor") && (t31 = t31.vec4u8(e16.INSTANCEOBJECTANDLAYERIDCOLOR)), t31;
}
e5([y({
  constructOnly: true
})], B5.prototype, "symbol", void 0), e5([y({
  constructOnly: true
})], B5.prototype, "optionalFields", void 0), e5([y({
  constructOnly: true
})], B5.prototype, "metadata", void 0), e5([y({
  constructOnly: true
})], B5.prototype, "shaderTransformation", void 0), e5([y()], B5.prototype, "_instanceData", void 0), e5([y()], B5.prototype, "_cycleStartIndex", void 0), e5([y({
  readOnly: true
})], B5.prototype, "_enableLevelSelection", null), e5([y()], B5.prototype, "_updateCyclesWithStaticCamera", void 0), e5([y({
  readOnly: true
})], B5.prototype, "running", null), B5 = e5([a3("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")], B5);
var z7 = n2();
var k5 = n7();
var W5 = e12();
var K3 = n2();
var Y5 = n2();
var J5 = [r5(1, 0, 1, 1), r5(0, 0, 1, 1), r5(0, 1, 0, 1), r5(1, 1, 0, 1), r5(1, 0, 0, 1)];
var Q4 = new z3();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectSymbolLayer.js
var me2 = class {
  constructor(e43, t31, s33, r39, i20, a30, o27, n28, l35, c33, h23, d21) {
    this.lodResources = e43, this.lodRenderer = t31, this.stageResources = s33, this.originalMaterialParameters = r39, this.resourceSize = i20, this.isEsriSymbolResource = a30, this.isWosr = o27, this.resourceBoundingBox = n28, this.symbolSize = l35, this.extentPadding = c33, this.physicalBasedRenderingEnabled = h23, this.pivotOffset = d21;
  }
};
var pe2 = class extends y6 {
  getCachedSize() {
    const [e43, t31, s33] = null != this._resources ? this._resources.symbolSize : [1, 1, 1];
    return {
      width: e43,
      depth: t31,
      height: s33
    };
  }
  constructor(e43, t31, s33, r39) {
    super(e43, t31, s33, r39), this._resources = null, this._optionalFields = new Array(), this._instanceIndexToGraphicUid = /* @__PURE__ */ new Map(), this._hasLoadedPBRTextures = false, this._disposeResourceHandles = new Array(), this.skipHighSymbolLodsChanged = false, this.ensureDrapedStatus(false), this._hasLoadedPBRTextures = s33.physicalBasedRenderingEnabled;
  }
  doLoad(e43) {
    return __async(this, null, function* () {
      if (!this._drivenProperties.size) {
        if (I7(this.symbolLayer)) throw new Error();
      }
      if (this._isPrimitive) {
        const t31 = this.symbolLayer.resource, s33 = t31 && d11(t31?.primitive) ? t31.primitive : d2;
        this._resources = yield this._createResourcesForPrimitive(s33, e43);
      } else {
        const t31 = yield r34(this.symbol.styleOrigin), s33 = t31?.href ?? this.symbolLayer.resource?.href;
        this._resources = yield this._createResourcesForUrl(s33, e43);
      }
      this.layerOpacityChanged(), this.slicePlaneEnabledChanged(), this.physicalBasedRenderingChanged(), this.complexity = this.computeComplexity();
    });
  }
  get extentPadding() {
    return null != this._resources ? this._resources.extentPadding : 0;
  }
  get _isPrimitive() {
    return !this.symbolLayer.resource?.href;
  }
  get lodRenderer() {
    return this._resources?.lodRenderer;
  }
  get materials() {
    return this._resources?.stageResources.materials ?? [];
  }
  _setMaterialTransparencyParameters(e43, t31 = this.symbolLayer?.material?.color) {
    const s33 = this._getCombinedOpacity(t31), r39 = s33 < 1 || this.needsDrivenTransparentPass;
    return e43.transparent = r39, e43.opacity = s33, e43.cullFace = r39 ? e24.None : e24.Back, e43;
  }
  _createResourcesForPrimitive(t31, r39) {
    return __async(this, null, function* () {
      const i20 = this.symbolLayer, a30 = i(c5(t31)), o27 = e6(F(a30)), n28 = e6(t4(o27, i20)), l35 = s5(n28), h23 = false, d21 = false, m22 = {
        usePBR: this._context.physicalBasedRenderingEnabled,
        isSchematic: true,
        mrrFactors: [...t17],
        ambient: _2,
        diffuse: _2,
        hasSlicePlane: this._context.slicePlaneEnabled,
        hasSliceHighlight: false,
        castShadows: this.symbolLayer.castShadows,
        offsetTransparentBackfaces: !this.symbolLayer.isPrimitive
      }, p23 = !!m22.usePBR;
      this._setMaterialTransparencyParameters(m22);
      const u32 = this.symbol;
      if ("point-3d" === u32.type && u32.verticalOffset) {
        const {
          screenLength: e43,
          minWorldLength: t32,
          maxWorldLength: r40
        } = u32.verticalOffset;
        m22.verticalOffset = {
          screenLength: u8(e43),
          minWorldLength: t32 || 0,
          maxWorldLength: null != r40 ? r40 : 1 / 0
        }, m22.castShadows = false;
      }
      if (this._context.screenSizePerspectiveEnabled && (m22.screenSizePerspective = this._context.sharedResources.screenSizePerspectiveSettings), this._drivenProperties.color) m22.externalColor = s7;
      else {
        const t32 = null != i20.material ? i20.material.color : null, s33 = null != t32 ? u9.toUnitRGBA(t32) : s7;
        m22.externalColor = s33;
      }
      this._fastUpdates = O9(this._context.renderer, this._fastVisualVariableConvertOptions(a30, n28, o27, null)), m22.isInstanced = true, this._fastUpdates ? (Object.assign(m22, this._fastUpdates.materialParameters), this._optionalFields.push(e16.FEATUREATTRIBUTE)) : this._hasPerInstanceColor() && (m22.hasInstancedColor = true, this._optionalFields.push(e16.COLOR)), has("enable-feature:objectAndLayerId-rendering") && this._optionalFields.push(e16.OBJECTANDLAYERIDCOLOR);
      const _16 = new j10(m22), g17 = S9(t31, _16);
      if (!g17) throw new Error(`Unknown object symbol primitive: ${t31}`);
      const b18 = c20(g17).map((e43) => ({
        opacity: 1,
        transparent: e43.parameters.transparent
      })), R10 = yield this._createStageResources(g17, p23, r39), x12 = yield this._createLodRenderer(g17, r39);
      return new me2(g17, x12, R10, b18, o27, h23, d21, a30, n28, l35, p23, null);
    });
  }
  _createResourcesForUrl(e43, t31) {
    return __async(this, null, function* () {
      const r39 = {
        materialParameters: {
          isInstanced: true,
          hasSlicePlane: this._context.slicePlaneEnabled,
          castShadows: this.symbolLayer.castShadows
        },
        streamDataRequester: this._context.streamDataRequester,
        cache: this._context.sharedResources.objectResourceCache
      };
      this._fastUpdates = O9(this._context.renderer, this._fastVisualVariableConvertOptions(null, null, null, null)), this._fastUpdates ? (Object.assign(r39.materialParameters, this._fastUpdates.materialParameters), this._optionalFields.push(e16.FEATUREATTRIBUTE)) : this._hasPerInstanceColor() && (r39.materialParameters.hasInstancedColor = true, this._optionalFields.push(e16.COLOR)), has("enable-feature:objectAndLayerId-rendering") && this._optionalFields.push(e16.OBJECTANDLAYERIDCOLOR);
      const i20 = this.symbol;
      if ("point-3d" === i20.type && i20.verticalOffset) {
        const {
          screenLength: e44,
          minWorldLength: t32,
          maxWorldLength: a31
        } = i20.verticalOffset;
        r39.materialParameters.verticalOffset = {
          screenLength: u8(e44),
          minWorldLength: t32 || 0,
          maxWorldLength: null != a31 ? a31 : 1 / 0
        }, r39.materialParameters.castShadows = false;
      }
      const a30 = this._context.physicalBasedRenderingEnabled;
      r39.signal = t31, r39.usePBR = a30, r39.skipHighLods = this._context.skipHighSymbolLods;
      const o27 = yield te(e43, r39), n28 = o27.isEsriSymbolResource, l35 = o27.isWosr, h23 = r33(o27.lods), d21 = this._context, m22 = this.symbolLayer.material, p23 = this._getExternalColorParameters(m22), u32 = this.symbolLayer?.material?.color, f26 = this._getCombinedOpacity(u32, {
        hasIntrinsicColor: true
      }), _16 = this.needsDrivenTransparentPass, g17 = c20(h23), b18 = c20(h23).map((e44) => ({
        opacity: e44.parameters.opacity || 1,
        transparent: e44.parameters.transparent
      }));
      g17.forEach((e44) => {
        const t32 = e44.parameters;
        e44.setParameters(p23);
        const s33 = t32.opacity * f26, r40 = s33 < 1 || _16 || t32.transparent;
        e44.setParameters({
          opacity: s33,
          transparent: r40
        }), d21.screenSizePerspectiveEnabled && e44.setParameters({
          screenSizePerspective: d21.sharedResources.screenSizePerspectiveSettings
        });
      });
      const P10 = o27.referenceBoundingBox, R10 = e6(F(P10)), x12 = e6(h23.levels[0].pivotOffset), v15 = e6(t4(R10, this.symbolLayer)), L10 = s5(v15), S19 = this._fastUpdates;
      G3(S19, this._context.renderer, this._fastVisualVariableConvertOptions(P10, v15, R10, x12)) && g17.forEach((e44) => e44.setParameters(S19.materialParameters));
      const j18 = yield this._createStageResources(h23, a30, t31), w11 = yield this._createLodRenderer(h23, t31);
      return new me2(h23, w11, j18, b18, R10, n28, l35, P10, v15, L10, a30, x12);
    });
  }
  _addDisposeResource(e43) {
    this._disposeResourceHandles.push(e43);
  }
  _createStageResources(e43, s33, r39) {
    return __async(this, null, function* () {
      const i20 = this._context.stage, a30 = c20(e43);
      s33 !== this._context.physicalBasedRenderingEnabled && this.physicalBasedRenderingChanged(), i20.addMany(a30), this._addDisposeResource(() => i20.removeMany(a30));
      const o27 = o18(e43);
      i20.addMany(o27), this._addDisposeResource(() => {
        o27.forEach((e44) => e44.unload()), i20.removeMany(o27);
      }), yield Promise.all(o27.map((e44) => this._context.stage.schedule(() => e44.load(i20.renderView.renderingContext), r39))), s3(r39);
      const n28 = i12(e43);
      return i20.addMany(n28), this._addDisposeResource(() => i20.removeMany(n28)), {
        materials: a30,
        textures: o27,
        geometries: n28
      };
    });
  }
  _createLodRenderer(e43, t31) {
    return __async(this, null, function* () {
      const s33 = this._context.stage, r39 = {
        layerUid: this._context.layer.uid,
        graphicUid: (e44) => this._instanceIndexToGraphicUid.get(e44),
        notifyGraphicGeometryChanged: (e44) => this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e44)),
        notifyGraphicVisibilityChanged: (e44) => this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e44))
      }, i20 = this._fastUpdates, a30 = i20 ? {
        applyTransform: (e44, t32, s34) => {
          e44.getFeatureAttribute(t32, be), n5(s34, Q(i20.materialParameters, be, s34));
        },
        scaleFactor: (e44, t32, s34) => {
          t32.getFeatureAttribute(s34, be), W2(e44, i20.materialParameters, be);
        }
      } : null, o27 = new B5({
        symbol: e43,
        optionalFields: this._optionalFields,
        metadata: r39,
        shaderTransformation: a30
      }, this._context.scheduler);
      return o27.slicePlaneEnabled = this._context.slicePlaneEnabled, this._addDisposeResource(() => {
        s33.removeRenderPlugin(o27), o27.destroy();
      }), yield s33.addRenderPlugin(o27, t31), o27;
    });
  }
  _getExternalColorParameters(t31) {
    const s33 = {};
    return this._drivenProperties.color ? s33.externalColor = s7 : null != t31?.color ? s33.externalColor = u9.toUnitRGBA(t31.color) : (s33.externalColor = s7, s33.colorMixMode = "ignore"), s33;
  }
  destroy() {
    super.destroy(), this._cleanupResources();
  }
  _cleanupResources() {
    this._disposeResourceHandles.forEach((e43) => e43()), this._disposeResourceHandles.length = 0, this._resources = null;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry)) return null;
    const s33 = f16(t31.geometry);
    if (null == s33) return this.logger.warn(`unsupported geometry type for icon symbol: ${t31.geometry.type}`), null;
    const r39 = this.setGraphicElevationContext(t31), i20 = e43.renderingInfo;
    return this._createAs3DShape(t31, s33, i20, r39, t31.uid, e43.layer.uid);
  }
  notifyDestroyGraphicLayer(e43) {
    this._instanceIndexToGraphicUid.delete(e43.instanceIndex);
  }
  graphicLayerToGraphicId() {
    return 0;
  }
  layerOpacityChanged() {
    if (null == this._resources) return;
    const e43 = this._drivenProperties.opacity, t31 = !this._isPrimitive, s33 = this._resources.stageResources.materials, r39 = this._resources.originalMaterialParameters;
    for (let i20 = 0; i20 < s33.length; i20++) {
      const a30 = s33[i20], o27 = this.symbolLayer?.material?.color, n28 = r39[i20], l35 = this._getCombinedOpacity(o27, {
        hasIntrinsicColor: t31
      }) * n28.opacity, c33 = l35 < 1 || e43 || n28.transparent;
      a30.setParameters({
        opacity: l35,
        transparent: c33
      }), this._isPrimitive && a30.setParameters({
        cullFace: c33 ? e24.None : e24.Back
      });
    }
  }
  layerElevationInfoChanged(e43, t31) {
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, g5);
  }
  slicePlaneEnabledChanged() {
    if (null == this._resources) return true;
    this._resources.lodRenderer.slicePlaneEnabled = this._context.slicePlaneEnabled;
    for (const e43 of this._resources.stageResources.materials) e43.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    });
    return true;
  }
  physicalBasedRenderingChanged() {
    if (null == this._resources) return true;
    const {
      stageResources: e43,
      isWosr: t31
    } = this._resources;
    for (const s33 of e43.materials) this._isPrimitive ? s33.setParameters({
      usePBR: this._context.physicalBasedRenderingEnabled,
      isSchematic: true
    }) : t31 || s33.setParameters({
      usePBR: this._context.physicalBasedRenderingEnabled,
      isSchematic: false
    });
    return false !== this._hasLoadedPBRTextures || true !== this._context.physicalBasedRenderingEnabled || (this._hasLoadedPBRTextures = true, false);
  }
  applyRendererDiff(e43, t31) {
    if (null == this._resources) return e33.RecreateSymbol;
    const {
      stageResources: {
        materials: s33
      },
      lodRenderer: r39,
      resourceBoundingBox: i20,
      symbolSize: a30,
      resourceSize: o27,
      pivotOffset: n28
    } = this._resources;
    for (const l35 in e43.diff) {
      if ("visualVariables" !== l35) return e33.RecreateSymbol;
      if (!G3(this._fastUpdates, t31, this._fastVisualVariableConvertOptions(i20, a30, o27, n28))) return e33.RecreateSymbol;
      for (const e44 of s33) e44.setParameters(this._fastUpdates.materialParameters);
      r39.notifyShaderTransformationChanged();
    }
    return e33.FastUpdate;
  }
  computeComplexity() {
    if (null == this._resources) return super.computeComplexity();
    const e43 = this._resources.lodResources, t31 = w4(e43.levels), s33 = (e44) => Array.from(e44.attributes.values()).reduce((e45, t32) => e45 + A(t32.data, t32.indices), 0), i20 = i12(e43).reduce((e44, t32) => e44 + s33(t32), 0), a30 = o18(e43).reduce((e44, t32) => e44 + t32.memoryEstimate, 0) + i20, o27 = __spreadProps(__spreadValues({}, C2(this.symbol, this.symbolLayer)), {
      resourceBytes: a30
    });
    return new e32({
      verticesPerFeature: t31,
      memory: o27
    });
  }
  _hasLodRenderer() {
    return null != this._resources;
  }
  _createAs3DShape(e43, t31, s33, r39, i20, a30) {
    if (!this._hasLodRenderer() || null == this._resources) return null;
    const o27 = this.getFastUpdateAttrValues(e43), n28 = this._context.clippingExtent;
    if (c6(t31, fe2, this._context.elevationProvider.spatialReference), null != n28 && !y2(n28, fe2)) return null;
    const l35 = ye2(r39), c33 = this._computeGlobalTransform(t31, r39, ge2, Pe), h23 = this._computeLocalTransform(this._resources, this.symbolLayer, s33, _e2), d21 = this._resources.lodRenderer.instanceData, m22 = d21.addInstance();
    this._instanceIndexToGraphicUid.set(m22, i20), d21.setLocalTransform(m22, h23, false), d21.setGlobalTransform(m22, c33), o27 && d21.setFeatureAttribute(m22, o27), null == this._fastUpdates && this._hasPerInstanceColor() && d21.setColor(m22, F4(s33.color, s33.opacity, 255)), null != this._context.stage.renderView.objectAndLayerIdRenderHelper && d21.setObjectAndLayerIdColor(m22, this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({
      graphicUid: i20,
      layerUid: a30
    }));
    const p23 = new p20(this, m22, b9, r39);
    return l35 && (p23.alignedSampledElevation = Pe.sampledElevation), p23.needsElevationUpdates = g5(r39.mode), m13(p23, t31, this._context.elevationProvider), p23;
  }
  _computeGlobalTransform(e43, t31, s33, r39) {
    return c18(e43, this._context.elevationProvider, t31, this._context.renderCoordsHelper, r39), fe2[0] = e43.x, fe2[1] = e43.y, fe2[2] = r39.z, u10(e43.spatialReference, fe2, s33, this._context.renderCoordsHelper.spatialReference), s33;
  }
  _computeLocalTransform(e43, t31, s33, r39) {
    return o4(r39), this._applyObjectRotation(s33, false, r39), this._applyObjectRotation(t31, true, r39), this._applyObjectScale(e43, s33, r39), this._applyAnchor(e43, t31, r39), r39;
  }
  _applyObjectScale(e43, t31, s33) {
    if (this._fastUpdates?.requiresShaderTransformation) return;
    const r39 = this._drivenProperties.size && t31.size ? t31.size : e43.symbolSize, i20 = B3(r39, e43.symbolSize, e43.resourceSize, this._context.renderCoordsHelper.unitInMeters);
    1 === i20[0] && 1 === i20[1] && 1 === i20[2] || f5(s33, s33, i20);
  }
  prepareSymbolLayerPatch(e43) {
    if ("partial" !== e43.diff.type) return;
    const t31 = e43.diff.diff;
    this._preparePatchTransform(e43, t31), this._preparePatchColor(e43, t31);
  }
  updateGeometry(e43, t31) {
    if (null == this._resources) return true;
    const s33 = t31 && f16(t31);
    if (null == s33) return false;
    const r39 = this.getGeometryElevationMode(t31);
    return e43.elevationContext.mode === r39 && (this._computeGlobalTransform(s33, e43.elevationContext, ge2, Pe), ye2(e43.elevationContext) && (e43.alignedSampledElevation = Pe.sampledElevation), this._resources.lodRenderer.instanceData.setGlobalTransform(e43.instanceIndex, ge2, true), m13(e43, s33, this._context.elevationProvider), true);
  }
  _preparePatchTransform(e43, t31) {
    if (!(t31.heading || t31.tilt || t31.roll || t31.width || t31.height || t31.depth || t31.anchor || t31.anchorPosition)) return;
    if (null == this._resources) return;
    const s33 = (e44, t32, s34) => (null != e44 && "complete" === e44.type ? e44.newValue : t32) ?? s34, r39 = s33(t31.heading, this.symbolLayer.heading, 0), i20 = s33(t31.tilt, this.symbolLayer.tilt, 0), a30 = s33(t31.roll, this.symbolLayer.roll, 0), o27 = s33(t31.width, this.symbolLayer.width, void 0), n28 = s33(t31.height, this.symbolLayer.height, void 0), l35 = s33(t31.depth, this.symbolLayer.depth, void 0), c33 = s33(t31.anchor, this.symbolLayer.anchor, void 0), h23 = s33(t31.anchorPosition, this.symbolLayer.anchorPosition, void 0);
    delete t31.heading, delete t31.tilt, delete t31.roll, delete t31.width, delete t31.height, delete t31.depth, delete t31.anchor, delete t31.anchorPosition;
    const d21 = {
      heading: r39,
      tilt: i20,
      roll: a30,
      anchor: c33,
      anchorPosition: h23
    }, m22 = this._resources;
    this.loadStatus === l21.LOADED && e43.symbolLayerStatePatches.push(() => {
      m22.symbolSize = e6(t4(m22.resourceSize, {
        width: o27,
        height: n28,
        depth: l35,
        isPrimitive: this.symbolLayer.isPrimitive
      }));
    }), e43.graphics3DGraphicPatches.push((e44, t32) => {
      const s34 = this._computeLocalTransform(m22, d21, t32, _e2), r40 = e44.instanceIndex;
      m22.lodRenderer.instanceData.setLocalTransform(r40, s34, true);
    });
  }
  _preparePatchColor(t31, s33) {
    if (!s33.material || "partial" !== s33.material.type) return;
    const r39 = s33.material.diff;
    if (!r39.color || "complete" !== r39.color.type || null == r39.color.newValue || null == r39.color.oldValue) return;
    const i20 = r39.color.newValue, a30 = null != i20 ? u9.toUnitRGBA(i20) : s7;
    delete r39.color;
    const o27 = this._resources;
    null != o27 && t31.graphics3DGraphicPatches.push((e43) => {
      let t32;
      this._hasPerInstanceColor() ? (o27.lodRenderer.instanceData.setColor(e43.instanceIndex, a30), t32 = this._setMaterialTransparencyParameters({}, i20)) : t32 = this._setMaterialTransparencyParameters({
        externalColor: a30
      }, i20);
      for (const s34 of o27.stageResources.materials) s34.setParameters(t32);
    });
  }
  _applyObjectRotation(e43, t31, s33) {
    if (!this._fastUpdates?.requiresShaderTransformation || !t31) return U3(e43.heading, e43.tilt, e43.roll, s33);
  }
  _applyAnchor(e43, t31, s33) {
    if (this._fastUpdates?.requiresShaderTransformation) return;
    const r39 = ue2(e43.resourceBoundingBox, e43.pivotOffset, t31);
    r39 && i2(s33, s33, r39);
  }
  _hasPerInstanceColor() {
    return this._drivenProperties.color || this._drivenProperties.opacity;
  }
  _fastVisualVariableConvertOptions(e43, t31, s33, r39) {
    const i20 = null != e43 ? e6(F(e43)) : _2, a30 = null != e43 ? ue2(e43, r39, this.symbolLayer) : l3, o27 = this._context.renderCoordsHelper.unitInMeters, n28 = B3(null != t31 ? t31 : void 0, t31, s33, o27), l35 = r3(this.symbolLayer.tilt || 0, this.symbolLayer.roll || 0, this.symbolLayer.heading || 0);
    return new B2({
      size: true,
      color: true,
      rotation: true,
      opacity: false
    }, i20, t31 ?? _2, o27, a30, n28, l35);
  }
};
function ue2(e43, t31, s33) {
  const r39 = n2();
  switch (s33.anchor) {
    case "center":
      r4(r39, E(e43)), j(r39, r39);
      break;
    case "top": {
      const t32 = E(e43);
      o2(r39, -t32[0], -t32[1], -e43[5]);
      break;
    }
    case "bottom": {
      const t32 = E(e43);
      o2(r39, -t32[0], -t32[1], -e43[2]);
      break;
    }
    case "relative": {
      const t32 = E(e43), i20 = F(e43), a30 = s33.anchorPosition, o27 = a30 ? r3(a30.x, a30.y, a30.z) : l3;
      c2(r39, i20, o27), u5(r39, r39, t32), j(r39, r39);
      break;
    }
    default:
      null != t31 ? j(r39, t31) : r4(r39, l3);
  }
  return r39;
}
function ye2(e43) {
  return "absolute-height" !== e43.mode;
}
var fe2 = n2();
var _e2 = e12();
var ge2 = e12();
var be = n7();
var Pe = new R4();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Path.js
var r36 = class {
  constructor(t31, i20, s33, o27) {
    this.vertices = t31, this.positionsES = i20, this.offset = o27;
    const r39 = t31.length, n28 = Math.floor(r39 / 2), g17 = this.offset + 3 * n28, v15 = s33[g17], f26 = s33[g17 + 1], c33 = s33[g17 + 2];
    this.origin = r3(v15, f26, c33), this.positions = t11(3 * r39);
    const l35 = this.offset + 3 * r39;
    for (let e43 = this.offset; e43 < l35; e43 += 3) this.positions[e43] = s33[e43] - v15, this.positions[e43 + 1] = s33[e43 + 1] - f26, this.positions[e43 + 2] = s33[e43 + 2] - c33;
    this.updatePathVertexInformation();
  }
  get usedMemory() {
    return A(this.positions);
  }
  updatePathVertexInformation() {
    const t31 = this.vertices.length, e43 = this.vertices[0];
    let h23 = this.offset;
    const r39 = this.positions;
    e43.vRight[0] = r39[h23 + 3] - r39[h23], e43.vRight[1] = r39[h23 + 4] - r39[h23 + 1], e43.vRight[2] = r39[h23 + 5] - r39[h23 + 2], h23 += 3;
    let n28 = s5(e43.vRight);
    e43.vMinSiblingLength = n28, z(e43.vRight, e43.vRight);
    let g17 = e43;
    for (let v15 = 1; v15 < t31; ++v15) {
      const e44 = this.vertices[v15];
      if (e44.vLeft = g17.vRight, v15 < t31 - 1) {
        e44.vRight[0] = r39[h23 + 3] - r39[h23], e44.vRight[1] = r39[h23 + 4] - r39[h23 + 1], e44.vRight[2] = r39[h23 + 5] - r39[h23 + 2];
        const t32 = s5(e44.vRight);
        e44.vMinSiblingLength = Math.min(n28, t32), n28 = t32, z(e44.vRight, e44.vRight);
      } else r4(e44.vRight, e44.vLeft), e44.vMinSiblingLength = n28;
      g17 = e44, h23 += 3;
    }
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathBuilder.js
var h17 = class {
  constructor(t31, r39, h23, o27, p23, n28 = {}) {
    this.path = t31, this.profile = r39, this.extruder = h23, this.startCap = o27, this.endCap = p23, this.options = n28, this._extrusionVertexCount = 0;
    const l35 = this.path.vertices.length - 2;
    this.numExtrusionProfiles = h23.numProfilesPerJoin() * l35 + 2, this.numVerticesTotal = r39.vertices.length * this.numExtrusionProfiles, this.startCap.vertexBufferStart = this.numVerticesTotal;
    const a30 = this.startCap.numVertices;
    this.numVerticesTotal += a30, this.endCap.vertexBufferStart = this.numVerticesTotal;
    const u32 = this.endCap.numVertices;
    this.numVerticesTotal += u32, this.pathVertexData = f7(1 * this.numVerticesTotal), this.profileRightAxes = t11(4 * this.numVerticesTotal), this.profileUpAxes = t11(4 * this.numVerticesTotal), this.profileVertexAndNormals = t11(4 * this.numVerticesTotal), this.positions = o10(t31.positions, t31.offset, 3 * t31.vertices.length), this._rebuildGeometry(), this.buildTopology();
  }
  get usedMemory() {
    return A(this.pathVertexData, this.profileRightAxes, this.profileUpAxes, this.profileVertexAndNormals) + this.path.usedMemory + this.profile.usedMemory;
  }
  emitVertex(t31, e43, i20, s33, r39) {
    const h23 = 4 * this._extrusionVertexCount;
    if (this.profileRightAxes[h23] = e43.right[0], this.profileRightAxes[h23 + 1] = e43.right[1], this.profileRightAxes[h23 + 2] = e43.right[2], this.profileUpAxes[h23] = e43.up[0], this.profileUpAxes[h23 + 1] = e43.up[1], this.profileUpAxes[h23 + 2] = e43.up[2], this.profileVertexAndNormals[h23] = i20[0], this.profileVertexAndNormals[h23 + 1] = i20[1], this.profileVertexAndNormals[h23 + 2] = s33[0], this.profileVertexAndNormals[h23 + 3] = s33[1], this.pathVertexData[this._extrusionVertexCount] = t31, r39) {
      const e44 = this.path.vertices[t31], i21 = e44.maxStretchDistance;
      this.profileRightAxes[h23 + 3] = e44.rotationRight[0] * i21, this.profileUpAxes[h23 + 3] = e44.rotationRight[1] * i21;
    } else this.profileRightAxes[h23 + 3] = 0, this.profileUpAxes[h23 + 3] = 0;
    ++this._extrusionVertexCount;
  }
  emitCapVertex(t31, e43, i20, s33, r39, h23) {
    const o27 = 4 * this._extrusionVertexCount;
    this.profileRightAxes[o27] = e43.right[0], this.profileRightAxes[o27 + 1] = e43.right[1], this.profileRightAxes[o27 + 2] = e43.right[2], this.profileRightAxes[o27 + 3] = r39, this.profileUpAxes[o27] = e43.up[0], this.profileUpAxes[o27 + 1] = e43.up[1], this.profileUpAxes[o27 + 2] = e43.up[2], this.profileUpAxes[o27 + 3] = h23, this.profileVertexAndNormals[o27] = i20[0], this.profileVertexAndNormals[o27 + 1] = i20[1], this.profileVertexAndNormals[o27 + 2] = s33[0], this.profileVertexAndNormals[o27 + 3] = s33[1], this.pathVertexData[this._extrusionVertexCount] = t31, ++this._extrusionVertexCount;
  }
  _rebuildGeometry() {
    this._extrusionVertexCount = 0;
    const {
      positions: t31,
      offset: e43,
      vertices: s33
    } = this.path;
    this.positions = o10(t31, e43, 3 * s33.length);
    let r39 = 0;
    const h23 = (t32, e44, i20, s34, h24) => this.emitCapVertex(r39, t32, e44, i20, s34, h24), o27 = (t32, e44, i20, s34) => this.emitVertex(r39, t32, e44, i20, s34);
    for (this.startCap.rebuildConnectingProfileGeometry(s33[r39], this.profile, h23), r39 = 1; r39 < s33.length - 1; ++r39) this.extruder.extrude(s33[r39], this.profile, o27);
    this.endCap.rebuildConnectingProfileGeometry(s33[r39], this.profile, h23), r39 = 0, this.startCap.rebuildCapGeometry(s33[r39], h23), r39 = s33.length - 1, this.endCap.rebuildCapGeometry(s33[r39], h23);
  }
  buildTopology() {
    const t31 = this.profile.vertices.length, e43 = this.profile.numSegments, i20 = this.numExtrusionProfiles - 1;
    let s33 = 3 * (2 * (e43 * i20));
    this.startCap.indexBufferStart = s33, this.startCap.firstProfileVertexIndex = 0, s33 += this.startCap.numIndices, this.endCap.indexBufferStart = s33, this.endCap.firstProfileVertexIndex = t31 * (this.numExtrusionProfiles - 1);
    const h23 = new Array(), o27 = new Array(), p23 = new Array(), n28 = (t32, e44, i21) => {
      h23.push(t32), h23.push(e44), h23.push(i21), o27.push(t32), o27.push(e44), o27.push(i21), p23.push(this.pathVertexData[t32]), p23.push(this.pathVertexData[e44]), p23.push(this.pathVertexData[i21]);
    };
    for (let r39 = 0; r39 < e43; ++r39) {
      const e44 = this.profile.indices[2 * r39], s34 = this.profile.indices[2 * r39 + 1];
      for (let r40 = 0; r40 < i20; ++r40) {
        const i21 = r40 * t31 + e44, h24 = (r40 + 1) * t31 + s34, o28 = r40 * t31 + s34;
        n28(i21, (r40 + 1) * t31 + e44, h24), n28(i21, h24, o28);
      }
    }
    this.startCap.buildTopology(this.path.vertices[0], n28), this.endCap.buildTopology(this.path.vertices[this.path.vertices.length - 1], n28), this.vertexIndices = t10(h23), this.normalIndices = t10(o27), this.pathVertexIndices = t10(p23);
  }
  onPathChanged() {
    this._rebuildGeometry();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathCapBuilder.js
var o22 = class {
  rebuildConnectingProfileGeometry(e43, t31, s33) {
    for (let i20 = 0; i20 < t31.vertices.length; ++i20) s33(e43.frame, t31.vertices[i20], t31.normals[i20], 0, 0);
  }
};
var l29 = class extends o22 {
  constructor() {
    super(), this.numVertices = 0, this.numIndices = 0;
  }
  rebuildCapGeometry() {
  }
  buildTopology() {
  }
};
var f21 = class extends o22 {
  constructor(e43, t31 = 0, s33 = false) {
    super(), this.profile = e43, this.profilePlaneOffset = t31, this.flip = s33;
  }
  get numVertices() {
    return this.profile.vertices.length;
  }
  get numIndices() {
    return 3 * this.profile.numSegments;
  }
  rebuildConnectingProfileGeometry(e43, t31, s33) {
    const i20 = this.profilePlaneOffset;
    for (let r39 = 0; r39 < t31.vertices.length; ++r39) s33(e43.frame, t31.vertices[r39], t31.normals[r39], i20, 0);
  }
  rebuildCapGeometry(t31, s33) {
    const i20 = this.profile, r39 = this.flip ? 1 : -1, n28 = this.profilePlaneOffset, o27 = m18;
    o9(o27, 0, 0);
    for (let e43 = 0; e43 < i20.vertices.length; ++e43) s33(t31.frame, i20.vertices[e43], o27, n28, r39);
  }
  buildTopology(e43, t31) {
    const s33 = this.profile, i20 = this.vertexBufferStart + s33.indices[0];
    for (let r39 = 1; r39 < s33.numSegments; ++r39) {
      const e44 = s33.indices[2 * r39], n28 = s33.indices[2 * r39 + 1], o27 = this.vertexBufferStart + e44, l35 = this.vertexBufferStart + n28;
      this.flip ? t31(l35, o27, i20) : t31(i20, o27, l35);
    }
  }
};
var h18 = class extends o22 {
  constructor(e43) {
    super(), this.flip = false, this.sign = 0, this.breakNormals = false, this.numSegments = 3, this.profile = e43.profile, this.flip = e43.flip, this.sign = this.flip ? 1 : -1, this.breakNormals = e43.breakNormals, this.numSegments = e43.subdivisions;
  }
  get numVertices() {
    let e43 = this.profile.vertices.length * (this.numSegments - 1) + this.profile.poles.length;
    return this.breakNormals && (e43 += this.profile.vertices.length), e43;
  }
  get numIndices() {
    let e43 = 0;
    const t31 = this.profile;
    e43 += 2 * t31.numSegments * (this.numSegments - 1);
    for (let s33 = 0; s33 < t31.numSegments; ++s33) {
      const i20 = t31.indices[2 * s33], r39 = t31.indices[2 * s33 + 1];
      t31.poleIndices[i20] === t31.poleIndices[r39] ? e43 += 1 : e43 += 2;
    }
    return 3 * e43;
  }
  rebuildCapGeometry(n28, o27) {
    const l35 = this.profile, f26 = n28.frame, h23 = 0.5 * this.sign, p23 = c26, a30 = m18;
    o9(a30, 0, 0);
    for (const e43 of l35.poles) e43.normal ? o27(f26, e43.position, e43.normal, h23, 0) : o27(f26, e43.position, a30, h23, this.sign);
    if (this.breakNormals) for (let e43 = 0; e43 < l35.vertices.length; ++e43) o27(f26, l35.vertices[e43], l35.normals[e43], 0, 0);
    for (let e43 = 0; e43 < this.numSegments - 1; ++e43) {
      const n29 = (1 - (e43 + 1) / this.numSegments) * Math.PI * 0.5, c33 = Math.sin(n29), m22 = Math.cos(n29);
      for (let e44 = 0; e44 < l35.vertices.length; ++e44) {
        const n30 = l35.poles[l35.poleIndices[e44]];
        e19(p23, l35.vertices[e44], n30.position), l9(p23, p23, c33), n30.normal ? (u12(p23, p23, n30.position), o27(f26, p23, n30.normal, h23 * m22, 0)) : (v(a30, p23), l9(a30, a30, c33), u12(p23, p23, n30.position), o27(f26, p23, a30, h23 * m22, this.sign * m22));
      }
    }
  }
  buildTopology(e43, t31) {
    const s33 = this.profile, i20 = this.breakNormals ? this.vertexBufferStart + s33.poles.length : this.firstProfileVertexIndex, r39 = this.breakNormals ? this.vertexBufferStart + s33.poles.length + s33.vertices.length : this.vertexBufferStart + s33.poles.length;
    for (let n28 = 0; n28 < s33.numSegments; ++n28) {
      const e44 = s33.indices[2 * n28], o27 = s33.indices[2 * n28 + 1], l35 = this.vertexBufferStart + s33.poleIndices[e44], f26 = this.vertexBufferStart + s33.poleIndices[o27];
      let h23 = i20 + e44, c33 = i20 + o27;
      for (let i21 = 0; i21 < this.numSegments - 1; ++i21) {
        const n29 = r39 + i21 * s33.vertices.length + e44, l36 = r39 + i21 * s33.vertices.length + o27;
        this.flip ? (t31(n29, c33, h23), t31(c33, n29, l36)) : (t31(h23, c33, n29), t31(l36, n29, c33)), h23 = n29, c33 = l36;
      }
      this.flip ? (t31(l35, c33, h23), l35 !== f26 && t31(l35, f26, c33)) : (t31(h23, c33, l35), l35 !== f26 && t31(c33, f26, l35));
    }
  }
};
var c26 = n10();
var m18 = n10();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathExtruder.js
var c27 = class {
  numProfilesPerJoin() {
    return 1;
  }
  extrude(t31, e43, r39) {
    for (let s33 = 0; s33 < e43.vertices.length; ++s33) r39(t31.frame, e43.vertices[s33], e43.normals[s33], false);
  }
};
var a27 = class {
  constructor(t31, e43) {
    this.cutoffAngle = t31, this.numBendSubdivisions = e43;
  }
  numProfilesPerJoin() {
    return this.numBendSubdivisions + 1;
  }
  extrude(e43, s33, i20) {
    const o27 = h19, {
      rotationAngle: n28,
      rotationRight: c33,
      frame: a30
    } = e43;
    if (Math.abs(n28) >= this.cutoffAngle) {
      const l35 = e43.rotationFrameUp;
      for (let h23 = 0; h23 < this.numBendSubdivisions + 1; ++h23) {
        p3(u29, 0.5 * -n28 + h23 * n28 / this.numBendSubdivisions, l35), m19(o27, a30, u29);
        for (let t31 = 0; t31 < s33.vertices.length; ++t31) {
          if (j7(s33.vertices[t31], c33) * n28 >= 0) i20(o27, s33.vertices[t31], s33.normals[t31], false);
          else {
            i20(a30, e43.applyMiterStretch(f22, s33.vertices[t31]), s33.normals[t31], true);
          }
        }
      }
    } else for (let t31 = 0; t31 < this.numBendSubdivisions + 1; ++t31) for (let o28 = 0; o28 < s33.vertices.length; ++o28) {
      const t32 = j7(s33.vertices[o28], c33) * n28 >= 0;
      i20(a30, e43.applyMiterStretch(f22, s33.vertices[o28]), s33.normals[o28], !t32);
    }
  }
};
var l30 = class {
  constructor() {
    this.up = n2(), this.right = n2();
  }
};
function m19(t31, e43, r39) {
  O3(t31.up, e43.up, r39), O3(t31.right, e43.right, r39);
}
var f22 = n10();
var u29 = e12();
var h19 = new l30();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathGeometry.js
var e39 = class extends I4 {
  constructor(r39, e43, o27, n28, s33, i20) {
    super(r39, e43, null, e25.Mesh, i20), this.path = o27, this.geometrySR = n28, this.stencilWidth = s33;
  }
};
var o23;
function n23(t31) {
  return "path" in t31;
}
!function(t31) {
  t31[t31.World = 0] = "World", t31[t31.Path = 1] = "Path";
}(o23 || (o23 = {}));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathGeometryData.js
var d15 = class {
  constructor(t31) {
    this.builder = t31;
  }
  onPathChanged(t31) {
    this.builder.onPathChanged();
  }
};
var f23 = class extends d15 {
  constructor(t31) {
    super(t31), this.vertexAttributeColor = r5(255, 255, 255, 255), this.size = new Array(), this.vertexAttributePosition = t11(3 * this.builder.numVerticesTotal), this.vertexAttributeNormal = new Int16Array(2 * this.builder.numVerticesTotal);
  }
  bakeVertexColors(t31) {
    this.vertexAttributeColor[0] = 255 * t31[0], this.vertexAttributeColor[1] = 255 * t31[1], this.vertexAttributeColor[2] = 255 * t31[2], this.vertexAttributeColor[3] = 255 * (t31.length > 3 ? t31[3] : 1);
  }
  bake(a30) {
    this.size = a30;
    const {
      numVerticesTotal: l35,
      pathVertexData: c33,
      path: u32,
      positions: b18,
      profileRightAxes: v15,
      profileUpAxes: m22,
      profileVertexAndNormals: x12
    } = this.builder;
    for (let A14 = 0; A14 < l35; ++A14) {
      let l36 = c33[A14];
      const d21 = 0 === l36 || l36 === u32.vertices.length - 1;
      l36 *= 3;
      const f26 = V9;
      let g17 = 0, D10 = 0;
      const N6 = 4 * A14, j18 = o2(R7, v15[N6], v15[N6 + 1], v15[N6 + 2]), E20 = o2(w7, m22[N6], m22[N6 + 1], m22[N6 + 2]), y12 = o9(P6, x12[N6] * a30[0], x12[N6 + 1] * a30[1]);
      if (d21) _3(f26, E20, j18), g17 = v15[N6 + 3] * a30[0], D10 = m22[N6 + 3];
      else {
        const a31 = I12, h23 = C4;
        o9(a31, v15[N6 + 3], m22[N6 + 3]);
        const l37 = q4(a31);
        v(a31, a31);
        const c34 = j7(y12, a31);
        if (Math.abs(c34) > l37) {
          o9(h23, -a31[1], a31[0]);
          const e43 = j7(y12, h23);
          l9(a31, a31, l37 * Math.sign(c34)), l9(h23, h23, e43), u12(y12, a31, h23);
        }
        o2(f26, 0, 0, 0);
      }
      const T10 = o2(O16, j18[0] * y12[0] + E20[0] * y12[1], j18[1] * y12[0] + E20[1] * y12[1], j18[2] * y12[0] + E20[2] * y12[1]), L10 = 3 * A14;
      this.vertexAttributePosition[L10] = b18[l36] + T10[0] + f26[0] * g17, this.vertexAttributePosition[L10 + 1] = b18[l36 + 1] + T10[1] + f26[1] * g17, this.vertexAttributePosition[L10 + 2] = b18[l36 + 2] + T10[2] + f26[2] * g17;
      const M9 = o9(P6, x12[N6 + 2], x12[N6 + 3]);
      s13(this.vertexAttributeNormal, A14, j18[0] * M9[0] + E20[0] * M9[1] + f26[0] * D10, j18[1] * M9[0] + E20[1] * M9[1] + f26[1] * D10, j18[2] * M9[0] + E20[2] * M9[1] + f26[2] * D10);
    }
  }
  createGeometryData() {
    const t31 = this.builder.vertexIndices.length, {
      normalIndices: e43,
      vertexIndices: r39
    } = this.builder;
    return [[e16.POSITION, new t7(this.vertexAttributePosition, r39, 3, true)], [e16.NORMALCOMPRESSED, new t7(this.vertexAttributeNormal, e43, 2, true)], [e16.COLOR, new t7(this.vertexAttributeColor, A5(t31), 4)]];
  }
  onPathChanged(t31) {
    super.onPathChanged(t31), this.bake(this.size);
  }
  intersect(t31, e43, r39, i20) {
    const s33 = this.builder.vertexIndices, o27 = new s11(this.vertexAttributePosition, 3), a30 = s33.length / 3;
    x5(t31, e43, 0, a30, s33, o27, void 0, r39, (t32, e44, r40) => {
      i20(t32, r40, e44, false);
    });
  }
};
var g13 = class extends d15 {
  constructor(t31, e43, r39, i20) {
    super(t31), this.sizeAttributeValue = e43, this.colorAttributeValue = r39, this.opacityAttributeValue = i20, this.vvData = null, this.baked = new f23(t31), this.vvData = t11(4 * this.builder.path.vertices.length);
    for (let s33 = 0; s33 < this.builder.path.vertices.length; ++s33) {
      this.vvData[4 * s33] = e43, this.vvData[4 * s33 + 1] = r39, this.vvData[4 * s33 + 2] = i20;
      const t32 = 0 === s33 || s33 === this.builder.path.vertices.length - 1;
      this.vvData[4 * s33 + 3] = t32 ? 1 : 0;
    }
  }
  createGeometryData() {
    const {
      positions: t31,
      profileRightAxes: e43,
      profileUpAxes: r39,
      profileVertexAndNormals: i20,
      pathVertexIndices: s33,
      vertexIndices: o27
    } = this.builder;
    return [[e16.POSITION, new t7(t31, s33, 3, true)], [e16.PROFILERIGHT, new t7(e43, o27, 4, true)], [e16.PROFILEUP, new t7(r39, o27, 4, true)], [e16.PROFILEVERTEXANDNORMAL, new t7(i20, o27, 4, true)], [e16.FEATUREVALUE, new t7(this.vvData, s33, 4, true)]];
  }
  onPathChanged(t31) {
    super.onPathChanged(t31);
    const e43 = t31.getMutableAttribute(e16.POSITION);
    e43 && (e43.data = this.builder.positions);
  }
};
var P6 = n10();
var I12 = n10();
var C4 = n10();
var O16 = n2();
var V9 = n2();
var R7 = n2();
var w7 = n2();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/pathGeometryUtils.js
function l31(l35, v15) {
  let h23 = null;
  const u32 = l35.vertices.length, j18 = 0.99619469809, R10 = n2(), y12 = n2(), b18 = n2(), x12 = n2(), L10 = n2(), k11 = n2(), q10 = E2();
  let G11 = l35.vertices[0];
  r4(y12, v15), o2(R10, 0, 1, 0), At(G11.vRight, y12, R10, R10, b18, y12, j18), r4(G11.frame.up, y12), r4(G11.frame.right, b18);
  const M9 = l35.positions;
  let U11 = l35.offset;
  h23 = G11;
  for (let m22 = 1; m22 < u32; ++m22) {
    G11 = l35.vertices[m22], u5(L10, G11.vLeft, G11.vRight);
    let a30 = s5(L10);
    a30 > 0 ? (a30 = 1 / Math.sqrt(a30), L10[0] = L10[0] * a30, L10[1] = L10[1] * a30, L10[2] = L10[2] * a30) : (L10[0] = G11.vRight[0], L10[1] = G11.vRight[1], L10[2] = G11.vRight[2]), k11[0] = M9[U11] + h23.frame.up[0], k11[1] = M9[U11 + 1] + h23.frame.up[1], k11[2] = M9[U11 + 2] + h23.frame.up[2], U11 += 3;
    const v16 = o2(n24, M9[U11], M9[U11 + 1], M9[U11 + 2]);
    j6(v16, L10, q10);
    S5(q10, l7(k11, G11.vLeft), x12) ? (x12[0] -= M9[U11], x12[1] -= M9[U11 + 1], x12[2] -= M9[U11 + 2], z(y12, x12), _3(b18, L10, y12), z(b18, b18)) : At(L10, h23.frame.up, h23.frame.right, R10, b18, y12, j18), r4(G11.frame.up, y12), r4(G11.frame.right, b18), h23 = G11;
  }
}
var n24 = n2();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathProfile.js
var o24 = class {
  constructor() {
    this.vertices = new Array(), this.normals = new Array(), this.indices = new Array(), this.poles = new Array(), this.poleIndices = new Array();
  }
  addVertex(t31, e43) {
    return this.vertices.push(t6(t31)), this.normals.push(t6(e43)), this.vertices.length - 1;
  }
  addPole(t31, e43 = null) {
    return this.poles.push({
      position: t6(t31),
      normal: e43 ? t6(e43) : null
    }), this.poles.length - 1;
  }
  addSegment(t31, e43 = null) {
    this.indices.push(t31.v0), this.indices.push(t31.v1), e43 && (this.poleIndices.push(e43.v0), this.poleIndices.push(e43.v1));
  }
  get numSegments() {
    return this.indices.length / 2;
  }
  translate(t31, e43) {
    for (const s33 of this.vertices) s33[0] += t31, s33[1] += e43;
    for (const s33 of this.poles) s33.position[0] += t31, s33.position[1] += e43;
  }
  get usedMemory() {
    return this.vertices.length * A(this.vertices[0]) * 2 + A(this.indices);
  }
};
var n25 = {
  top: [0, -0.5],
  bottom: [0, 0.5]
};
function i16(t31) {
  const s33 = 0.5, i20 = c19, d21 = new o24(), a30 = {
    v0: 0,
    v1: 0
  };
  d21.addPole(r7(0, 0));
  for (let r39 = 0; r39 < i20; ++r39) {
    const t32 = 2 * r39 * Math.PI / i20, o27 = Math.cos(t32), n28 = Math.sin(t32), a31 = r7(o27 * s33, n28 * s33), c34 = r7(o27, n28);
    d21.addVertex(a31, c34);
  }
  for (let e43 = 0; e43 < i20 - 1; ++e43) {
    const t32 = {
      v0: e43,
      v1: e43 + 1
    };
    d21.addSegment(t32, a30);
  }
  const c33 = {
    v0: i20 - 1,
    v1: 0
  };
  if (d21.addSegment(c33, a30), "center" !== t31) {
    const e43 = n25[t31];
    d21.translate(e43[0], e43[1]);
  }
  return d21;
}
var d16 = {
  center: i16("center"),
  top: i16("top"),
  bottom: i16("bottom")
};
var a28 = {
  center: c28("center"),
  top: c28("top"),
  bottom: c28("bottom")
};
function c28(t31) {
  const s33 = 1, r39 = 1, i20 = new o24(), d21 = r7(0.5 * -s33, 0.5 * -r39), a30 = r7(0.5 * s33, 0.5 * -r39), c33 = r7(0.5 * s33, 0.5 * r39), h23 = r7(0.5 * -s33, 0.5 * r39), l35 = r7(0, -1), v15 = r7(1, 0), p23 = r7(0, 1), m22 = r7(-1, 0);
  if (i20.addPole(r7(0, 0.5 * r39), p23), i20.addPole(r7(0, 0.5 * r39)), i20.addPole(r7(0, 0.5 * -r39)), i20.addPole(r7(0, 0.5 * -r39), l35), i20.addVertex(d21, l35), i20.addVertex(a30, l35), i20.addSegment({
    v0: 0,
    v1: 1
  }, {
    v0: 3,
    v1: 3
  }), i20.addVertex(a30, v15), i20.addVertex(c33, v15), i20.addSegment({
    v0: 2,
    v1: 3
  }, {
    v0: 2,
    v1: 1
  }), i20.addVertex(c33, p23), i20.addVertex(h23, p23), i20.addSegment({
    v0: 4,
    v1: 5
  }, {
    v0: 0,
    v1: 0
  }), i20.addVertex(h23, m22), i20.addVertex(d21, m22), i20.addSegment({
    v0: 6,
    v1: 7
  }, {
    v0: 1,
    v1: 2
  }), "center" !== t31) {
    const e43 = n25[t31];
    i20.translate(e43[0], e43[1]);
  }
  return i20;
}

// ../../../node_modules/@arcgis/core/core/libs/gl-matrix-2/math/mat2.js
function n26(t31, n28) {
  return t31[0] = n28[0], t31[1] = n28[1], t31[2] = n28[2], t31[3] = n28[3], t31;
}
function r37(t31) {
  return t31[0] = 1, t31[1] = 0, t31[2] = 0, t31[3] = 1, t31;
}
function a29(t31, n28, r39, a30, u32) {
  return t31[0] = n28, t31[1] = r39, t31[2] = a30, t31[3] = u32, t31;
}
function u30(t31, n28) {
  if (t31 === n28) {
    const r39 = n28[1];
    t31[1] = n28[2], t31[2] = r39;
  } else t31[0] = n28[0], t31[1] = n28[2], t31[2] = n28[1], t31[3] = n28[3];
  return t31;
}
function o25(t31, n28) {
  const r39 = n28[0], a30 = n28[1], u32 = n28[2], o27 = n28[3];
  let e43 = r39 * o27 - u32 * a30;
  return e43 ? (e43 = 1 / e43, t31[0] = o27 * e43, t31[1] = -a30 * e43, t31[2] = -u32 * e43, t31[3] = r39 * e43, t31) : null;
}
function e40(t31, n28) {
  const r39 = n28[0];
  return t31[0] = n28[3], t31[1] = -n28[1], t31[2] = -n28[2], t31[3] = r39, t31;
}
function c29(t31) {
  return t31[0] * t31[3] - t31[2] * t31[1];
}
function s30(t31, n28, r39) {
  const a30 = n28[0], u32 = n28[1], o27 = n28[2], e43 = n28[3], c33 = r39[0], s33 = r39[1], i20 = r39[2], f26 = r39[3];
  return t31[0] = a30 * c33 + o27 * s33, t31[1] = u32 * c33 + e43 * s33, t31[2] = a30 * i20 + o27 * f26, t31[3] = u32 * i20 + e43 * f26, t31;
}
function i17(t31, n28, r39) {
  const a30 = n28[0], u32 = n28[1], o27 = n28[2], e43 = n28[3], c33 = Math.sin(r39), s33 = Math.cos(r39);
  return t31[0] = a30 * s33 + o27 * c33, t31[1] = u32 * s33 + e43 * c33, t31[2] = a30 * -c33 + o27 * s33, t31[3] = u32 * -c33 + e43 * s33, t31;
}
function f24(t31, n28, r39) {
  const a30 = n28[0], u32 = n28[1], o27 = n28[2], e43 = n28[3], c33 = r39[0], s33 = r39[1];
  return t31[0] = a30 * c33, t31[1] = u32 * c33, t31[2] = o27 * s33, t31[3] = e43 * s33, t31;
}
function l32(t31, n28) {
  const r39 = Math.sin(n28), a30 = Math.cos(n28);
  return t31[0] = a30, t31[1] = r39, t31[2] = -r39, t31[3] = a30, t31;
}
function M4(t31, n28) {
  return t31[0] = n28[0], t31[1] = 0, t31[2] = 0, t31[3] = n28[1], t31;
}
function h20(t31) {
  return "mat2(" + t31[0] + ", " + t31[1] + ", " + t31[2] + ", " + t31[3] + ")";
}
function b16(t31) {
  return Math.sqrt(t31[0] ** 2 + t31[1] ** 2 + t31[2] ** 2 + t31[3] ** 2);
}
function m20(t31, n28, r39, a30) {
  return t31[2] = a30[2] / a30[0], r39[0] = a30[0], r39[1] = a30[1], r39[3] = a30[3] - t31[2] * r39[1], [t31, n28, r39];
}
function d17(t31, n28, r39) {
  return t31[0] = n28[0] + r39[0], t31[1] = n28[1] + r39[1], t31[2] = n28[2] + r39[2], t31[3] = n28[3] + r39[3], t31;
}
function p21(t31, n28, r39) {
  return t31[0] = n28[0] - r39[0], t31[1] = n28[1] - r39[1], t31[2] = n28[2] - r39[2], t31[3] = n28[3] - r39[3], t31;
}
function y9(t31, n28) {
  return t31[0] === n28[0] && t31[1] === n28[1] && t31[2] === n28[2] && t31[3] === n28[3];
}
function x8(n28, r39) {
  const a30 = n28[0], u32 = n28[1], o27 = n28[2], e43 = n28[3], c33 = r39[0], s33 = r39[1], i20 = r39[2], f26 = r39[3], l35 = e7();
  return Math.abs(a30 - c33) <= l35 * Math.max(1, Math.abs(a30), Math.abs(c33)) && Math.abs(u32 - s33) <= l35 * Math.max(1, Math.abs(u32), Math.abs(s33)) && Math.abs(o27 - i20) <= l35 * Math.max(1, Math.abs(o27), Math.abs(i20)) && Math.abs(e43 - f26) <= l35 * Math.max(1, Math.abs(e43), Math.abs(f26));
}
function S14(t31, n28, r39) {
  return t31[0] = n28[0] * r39, t31[1] = n28[1] * r39, t31[2] = n28[2] * r39, t31[3] = n28[3] * r39, t31;
}
function j14(t31, n28, r39, a30) {
  return t31[0] = n28[0] + r39[0] * a30, t31[1] = n28[1] + r39[1] * a30, t31[2] = n28[2] + r39[2] * a30, t31[3] = n28[3] + r39[3] * a30, t31;
}
var _12 = s30;
var g14 = p21;
var q7 = Object.freeze(Object.defineProperty({
  __proto__: null,
  LDU: m20,
  add: d17,
  adjoint: e40,
  copy: n26,
  determinant: c29,
  equals: x8,
  exactEquals: y9,
  frob: b16,
  fromRotation: l32,
  fromScaling: M4,
  identity: r37,
  invert: o25,
  mul: _12,
  multiply: s30,
  multiplyScalar: S14,
  multiplyScalarAndAdd: j14,
  rotate: i17,
  scale: f24,
  set: a29,
  str: h20,
  sub: g14,
  subtract: p21,
  transpose: u30
}, Symbol.toStringTag, {
  value: "Module"
}));

// ../../../node_modules/@arcgis/core/core/libs/gl-matrix-2/factories/mat2f64.js
function e41() {
  return [1, 0, 0, 1];
}
function r38(e43) {
  return [e43[0], e43[1], e43[2], e43[3]];
}
function t30(e43, r39, t31, n28) {
  return [e43, r39, t31, n28];
}
function n27(e43, r39) {
  return new Float64Array(e43, r39, 4);
}
var o26 = Object.freeze(Object.defineProperty({
  __proto__: null,
  clone: r38,
  create: e41,
  createView: n27,
  fromValues: t30
}, Symbol.toStringTag, {
  value: "Module"
}));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/PathVertex.js
var R8 = class {
  constructor() {
    this.vLeft = n2(), this.vRight = n2(), this.vMinSiblingLength = 0, this.frame = new l30();
  }
  setFrameFromUpVector(t31) {
    r4(this.frame.up, t31), u5(k6, this.vLeft, this.vRight), z(k6, k6), g(I13, this.frame.up, P(k6, this.frame.up)), e8(D8, k6, I13), z(D8, D8), _3(this.frame.right, D8, this.frame.up);
  }
  get foldingAngle() {
    return Math.PI - this.rotationAngle;
  }
};
var x9 = class extends R8 {
  get rotationFrameUp() {
    return this.frame.up;
  }
  get rotationRight() {
    return s9;
  }
  get rotationAngle() {
    g(w8, this.frame.up, P(this.frame.up, this.vLeft)), e8(w8, this.vLeft, w8), j(w8, w8), z(w8, w8), g(y10, this.frame.up, P(this.frame.up, this.vRight)), e8(y10, this.vRight, y10), z(y10, y10), _3(U7, this.rotationFrameUp, this.vLeft);
    return Math.sign(P(U7, this.vRight)) * (Math.PI - m2(P(w8, y10)));
  }
  get maxStretchDistance() {
    return Math.abs(this.vMinSiblingLength / Math.cos(0.5 * this.foldingAngle));
  }
  applyMiterStretch(t31, r39) {
    const s33 = this.rotationAngle;
    if (Math.abs(s33) <= 0) return r39;
    const a30 = b2(Math.cos(0.5 * s33));
    return o9(t31, (a30 - 1 + 1) * r39[0], r39[1]);
  }
};
var j15 = class extends R8 {
  get rotationFrameUp() {
    const t31 = Math.sign(P(this.frame.right, this.vRight));
    return _3(d18, this.vRight, this.vLeft), g(d18, d18, t31), z(d18, d18);
  }
  get rotationRight() {
    const t31 = this.rotationFrameUp, i20 = P(t31, this.frame.up), r39 = P(t31, this.frame.right);
    return g(F9, this.frame.up, -r39), g(P7, this.frame.right, i20), u5(F9, F9, P7), z(F9, F9), L7(S15, this.frame, F9), S15;
  }
  get rotationAngle() {
    const i20 = Math.sign(P(this.frame.right, this.vRight));
    return j(U7, this.vLeft), -i20 * (Math.PI - m2(P(U7, this.vRight)));
  }
  get maxStretchDistance() {
    return Math.abs(this.vMinSiblingLength * b2(Math.cos(0.5 * this.foldingAngle)));
  }
  applyMiterStretch(t31, s33) {
    const e43 = this.rotationAngle;
    if (0 === Math.abs(e43)) return s33;
    const h23 = b2(Math.cos(0.5 * e43)), o27 = this.rotationRight, n28 = a29(E16, 1 + (h23 - 1) * o27[0] * o27[0], (h23 - 1) * o27[0] * o27[1], (h23 - 1) * o27[0] * o27[1], 1 + (h23 - 1) * o27[1] * o27[1]);
    return P3(t31, s33, n28);
  }
};
function L7(t31, i20, r39) {
  o9(t31, P(r39, i20.right), P(r39, i20.up));
}
function A10(t31) {
  switch (t31) {
    case o23.World:
      return new x9();
    case o23.Path:
      return new j15();
  }
}
var d18 = n2();
var S15 = n10();
var F9 = n2();
var P7 = n2();
var U7 = n2();
var w8 = n2();
var y10 = n2();
var I13 = n2();
var k6 = n2();
var D8 = n2();
var E16 = e41();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/PathTechnique.js
var C5 = /* @__PURE__ */ new Map([[e16.POSITION, 0], [e16.PROFILERIGHT, 1], [e16.PROFILEUP, 2], [e16.PROFILEVERTEXANDNORMAL, 3], [e16.FEATUREVALUE, 4], [e16.OBJECTANDLAYERIDCOLOR, 5]]);
var L8 = class extends n16 {
  constructor() {
    super(...arguments), this.ambient = r3(0.2, 0.2, 0.2), this.diffuse = r3(0.8, 0.8, 0.8), this.specular = r3(0, 0, 0), this.opacity = 1, this.origin = n2(), this.modelTransformation = null;
  }
};
var A11 = class _A extends r14 {
  initializeConfiguration(e43, o27) {
    o27.spherical = e43.viewingMode === l8.Global, o27.doublePrecisionRequiresObfuscation = e43.rctx.driverTest.doublePrecisionRequiresObfuscation.result;
  }
  initializeProgram(e43) {
    return new r15(e43.rctx, _A.shader.get().build(this.configuration), C5);
  }
  initializePipeline() {
    const e43 = this.configuration.transparencyPassType, o27 = this.configuration, t31 = e43 === o11.NONE, r39 = e43 === o11.FrontFace;
    return S6({
      blending: o27.output === o7.Color && o27.transparent ? t31 ? A6 : c17(e43) : null,
      culling: o27.hasSlicePlane && !o27.transparent && o27.doubleSidedMode !== i8.None ? a12 : null,
      depthTest: {
        func: f8(e43)
      },
      depthWrite: t31 || r39 ? o12 : null,
      drawBuffers: o27.output === o7.Depth ? {
        buffers: [f6.NONE]
      } : s16(e43),
      colorWrite: _7,
      stencilWrite: o27.hasOccludees ? e27 : null,
      stencilTest: o27.hasOccludees ? f9 : null,
      polygonOffset: t31 || r39 ? null : O7
    });
  }
};
A11.shader = new t16(D5, () => import("./Path.glsl-HNAFZQCN.js"));
var V10 = class extends t20 {
  constructor() {
    super(...arguments), this.output = o7.Color, this.doubleSidedMode = i8.None, this.transparencyPassType = o11.NONE, this.spherical = false, this.receiveShadows = false, this.receiveAmbientOcclusion = false, this.vvSize = false, this.vvColor = false, this.vvOpacity = false, this.hasSlicePlane = false, this.transparent = false, this.hasOccludees = false, this.multipassEnabled = false, this.cullAboveGround = false, this.doublePrecisionRequiresObfuscation = false, this.objectAndLayerIdColorInstanced = false;
  }
};
e5([r17({
  count: o7.COUNT
})], V10.prototype, "output", void 0), e5([r17({
  count: i8.COUNT
})], V10.prototype, "doubleSidedMode", void 0), e5([r17({
  count: o11.COUNT
})], V10.prototype, "transparencyPassType", void 0), e5([r17()], V10.prototype, "spherical", void 0), e5([r17()], V10.prototype, "receiveShadows", void 0), e5([r17()], V10.prototype, "receiveAmbientOcclusion", void 0), e5([r17()], V10.prototype, "vvSize", void 0), e5([r17()], V10.prototype, "vvColor", void 0), e5([r17()], V10.prototype, "vvOpacity", void 0), e5([r17()], V10.prototype, "hasSlicePlane", void 0), e5([r17()], V10.prototype, "transparent", void 0), e5([r17()], V10.prototype, "hasOccludees", void 0), e5([r17()], V10.prototype, "multipassEnabled", void 0), e5([r17()], V10.prototype, "cullAboveGround", void 0), e5([r17()], V10.prototype, "doublePrecisionRequiresObfuscation", void 0), e5([r17({
  constValue: false
})], V10.prototype, "occlusionPass", void 0), e5([r17({
  constValue: c14.Disabled
})], V10.prototype, "pbrMode", void 0), e5([r17({
  constValue: true
})], V10.prototype, "hasVvInstancing", void 0), e5([r17({
  constValue: false
})], V10.prototype, "useCustomDTRExponentForWater", void 0), e5([r17({
  constValue: false
})], V10.prototype, "useFillLights", void 0), e5([r17({
  constValue: false
})], V10.prototype, "hasColorTexture", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/PathMaterial.js
var g15 = class _g extends c16 {
  constructor(e43) {
    super(e43, new w9()), this.supportsEdges = true, this.produces = /* @__PURE__ */ new Map([[E6.OPAQUE_MATERIAL, (e44) => (this.parameters.castShadows && r9(e44) || n11(e44)) && !this.parameters.transparent], [E6.TRANSPARENT_MATERIAL, (e44) => (this.parameters.castShadows && r9(e44) || n11(e44)) && this.parameters.transparent]]), this._vertexAttributeLocations = C5, this._configuration = new V10(), this._vertexBufferLayout = _g.getVertexBufferLayout();
  }
  getConfiguration(e43, t31) {
    return this._configuration.output = e43, this._configuration.vvSize = !!this.parameters.vvSize, this._configuration.vvColor = !!this.parameters.vvColor, this._configuration.vvOpacity = !!this.parameters.vvOpacity, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.transparent = this.parameters.transparent, this._configuration.hasOccludees = this.parameters.hasOccludees, e43 === o7.Color && (this._configuration.doubleSidedMode = this.parameters.doubleSided && "normal" === this.parameters.doubleSidedType ? i8.View : this.parameters.doubleSided && "winding-order" === this.parameters.doubleSidedType ? i8.WindingOrder : i8.None, this._configuration.receiveShadows = this.parameters.receiveShadows, this._configuration.receiveAmbientOcclusion = null != t31.ssao), this._configuration.transparencyPassType = t31.transparencyPassType, this._configuration.multipassEnabled = t31.multipassEnabled, this._configuration.cullAboveGround = t31.multipassTerrain.cullAboveGround, this._configuration;
  }
  isVisibleForOutput(e43) {
    return e43 !== o7.Shadow && e43 !== o7.ShadowExcludeHighlight && e43 !== o7.ShadowHighlight || this.parameters.castShadows;
  }
  isVisible() {
    return super.isVisible() && this.parameters.opacity > 0;
  }
  intersect(r39, i20, s33, a30, o27, n28) {
    const u32 = r39;
    if (!n23(u32)) return;
    const l35 = u32.path, p23 = [this.parameters.size[0], this.parameters.size[1]];
    if (this.parameters.vvSize) {
      const {
        offset: t31,
        factor: r40,
        minSize: i21,
        maxSize: s34
      } = this.parameters.vvSize, a31 = l35.sizeAttributeValue;
      p23[0] *= e9(t31[0] + a31 * r40[0], i21[0], s34[0]), p23[1] *= e9(t31[2] + a31 * r40[2], i21[2], s34[2]);
    }
    const m22 = new m7(false, s33.options.normalRequired), f26 = Math.max(p23[0], p23[1]), b18 = r39.boundingInfo;
    if (null == b18) return void O17(l35, p23, a30, o27, m22, n28);
    const S19 = a5(b18.bbMin[0] - f26, b18.bbMin[1] - f26, b18.bbMin[2] - f26, b18.bbMax[0] + f26, b18.bbMax[1] + f26, b18.bbMax[2] + f26), v15 = [o27[0] - a30[0], o27[1] - a30[1], o27[2] - a30[2]], g17 = Math.sqrt(v15[0] * v15[0] + v15[1] * v15[1] + v15[2] * v15[2]), _16 = [g17 / v15[0], g17 / v15[1], g17 / v15[2]];
    k(S19, a30, _16, s33.tolerance) && O17(l35, p23, a30, o27, m22, n28);
  }
  createBufferWriter() {
    return new r13(this._vertexBufferLayout);
  }
  createGLMaterial(e43) {
    return new _13(e43);
  }
  static getVertexBufferLayout() {
    const e43 = H2().vec3f(e16.POSITION).vec4f(e16.PROFILERIGHT).vec4f(e16.PROFILEUP).vec4f(e16.PROFILEVERTEXANDNORMAL).vec4f(e16.FEATUREVALUE);
    return has("enable-feature:objectAndLayerId-rendering") && e43.vec4u8(e16.OBJECTANDLAYERIDCOLOR), e43;
  }
};
var _13 = class extends t15 {
  _updateOccludeeState(e43) {
    e43.hasOccludees !== this._material.parameters.hasOccludees && this._material.setParameters({
      hasOccludees: e43.hasOccludees
    });
  }
  _updateShadowState(e43) {
    null != this.technique && e43.shadowMap.enabled === this.technique.configuration.receiveShadows || this._material.setParameters({
      receiveShadows: e43.shadowMap.enabled
    });
  }
  beginSlot(e43) {
    return this._output === o7.Color && (this._updateShadowState(e43), this._updateOccludeeState(e43)), this.ensureTechnique(A11, e43);
  }
};
function O17(e43, t31, r39, i20, s33, a30) {
  e43.baked.size && e43.baked.size[0] === t31[0] && e43.baked.size[1] === t31[1] || e43.baked.bake(t31), e43.baked.intersect(r39, i20, s33, a30);
}
var w9 = class extends L8 {
  constructor() {
    super(...arguments), this.doubleSided = false, this.doubleSidedType = "normal", this.receiveShadows = false, this.castShadows = true, this.hasSlicePlane = false, this.transparent = false, this.hasOccludees = false;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPathSymbolLayer.js
var ee3 = ["polyline"];
var te3 = class extends y6 {
  constructor(e43, t31, i20, r39) {
    super(e43, t31, i20, r39), this._intrinsicSize = r7(1, 1), this._upVectorAlignment = o23.Path, this._stencilWidth = 0.1, this.usedMemory = 0, this.ensureDrapedStatus(false);
  }
  doLoad() {
    return __async(this, null, function* () {
      const t31 = null != this.symbolLayer.width ? this.symbolLayer.width : this.symbolLayer.height, i20 = null != this.symbolLayer.height ? this.symbolLayer.height : t31;
      this._vvConvertOptions = new B2({
        size: true,
        color: true,
        rotation: false,
        opacity: true
      }, [1, 1, 1], [t31, 1, i20], this._context.renderCoordsHelper.unitInMeters), this._fastUpdates = this._context.renderer?.visualVariables?.length > 0 ? O9(this._context.renderer, this._vvConvertOptions) : null;
      const r39 = this.symbolLayer.anchor || "center";
      this._upVectorAlignment = "heading" === this.symbolLayer.profileRotation ? o23.World : o23.Path;
      const o27 = this.symbolLayer.profile || "circle";
      switch (o27) {
        default:
        case "circle":
          this._profile = d16[r39];
          break;
        case "quad":
          this._profile = a28[r39];
      }
      switch (this.symbolLayer.join) {
        case "round":
          this._extruder = new a27(0, o17);
          break;
        case "bevel":
          this._extruder = new a27(0, 1);
          break;
        case "miter":
          this._extruder = new a27(0.8 * Math.PI, 1);
          break;
        default:
          this._extruder = new c27();
      }
      const l35 = this.symbolLayer.cap || "butt";
      switch (l35) {
        case "none":
          this._startCap = new l29(), this._endCap = new l29();
          break;
        case "butt":
        default:
          this._startCap = new f21(this._profile, 0), this._endCap = new f21(this._profile, 0, true);
          break;
        case "square":
          this._startCap = new f21(this._profile, -0.5), this._endCap = new f21(this._profile, 0.5, true);
          break;
        case "round": {
          const e43 = "quad" === o27;
          this._startCap = new h18({
            profile: this._profile,
            flip: false,
            breakNormals: e43,
            subdivisions: t25
          }), this._endCap = new h18({
            profile: this._profile,
            flip: true,
            breakNormals: e43,
            subdivisions: t25
          });
          break;
        }
      }
      const c33 = this.symbolLayer?.material?.color, p23 = this._getCombinedOpacityAndColor(c33), m22 = e6(p23), f26 = p23[3], d21 = f26 < 1 || this.needsDrivenTransparentPass, u32 = {
        diffuse: m22,
        ambient: m22,
        opacity: f26,
        transparent: d21,
        hasVertexColors: false,
        hasSlicePlane: this._context.slicePlaneEnabled,
        castShadows: this.symbolLayer.castShadows,
        cullFace: d21 || "none" === l35 ? e24.None : e24.Back,
        offsetTransparentBackfaces: true
      };
      if (!this._drivenProperties.size && (o9(this._intrinsicSize, t31, i20), !S7(this._intrinsicSize[0]) || !S7(this._intrinsicSize[1]))) throw new s2("graphics3dpathsymbollayer:invalid-size", "Symbol sizes may not be negative values");
      if (this._fastUpdates?.visualVariables.size || l9(this._intrinsicSize, this._intrinsicSize, 1 / this._context.renderCoordsHelper.unitInMeters), this._fastUpdates) {
        const e43 = __spreadProps(__spreadValues(__spreadValues({}, u32), this._fastUpdates.materialParameters), {
          size: e15(this._intrinsicSize)
        });
        this._materials[0] = new g15(e43);
      } else u32.hasVertexColors = this._drivenProperties.color || this._drivenProperties.opacity, u32.normalType = a7.Compressed, this._materials[0] = new j10(u32);
      this._materials[0].setParameters({
        usePBR: this._context.physicalBasedRenderingEnabled,
        isSchematic: true
      }), this._context.stage.add(this._materials[0]);
    });
  }
  destroy() {
    super.destroy(), this._context.stage.remove(this._materials[0]), this._materials[0] = null, this._materials.length = 0;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry, ee3, this.symbolLayer.type)) return null;
    const i20 = this.setGraphicElevationContext(t31), r39 = e43.renderingInfo;
    return this._createAs3DShape(t31, r39, i20, t31.uid);
  }
  layerOpacityChanged() {
    const e43 = this.symbolLayer?.material?.color, t31 = this._getCombinedOpacity(e43), i20 = t31 < 1 || this.needsDrivenTransparentPass;
    this._materials[0]?.setParameters({
      opacity: t31,
      transparent: i20
    });
  }
  layerElevationInfoChanged(e43, t31) {
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, g5);
  }
  slicePlaneEnabledChanged() {
    return this._materials[0]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), true;
  }
  physicalBasedRenderingChanged() {
    return this._materials[0]?.setParameters({
      usePBR: this._context.physicalBasedRenderingEnabled,
      isSchematic: true
    }), true;
  }
  applyRendererDiff(e43, t31) {
    for (const i20 in e43.diff) {
      if ("visualVariables" !== i20) return e33.RecreateSymbol;
      if (!G3(this._fastUpdates, t31, this._vvConvertOptions)) return e33.RecreateSymbol;
      this._materials[0]?.setParameters(this._fastUpdates.materialParameters);
    }
    return e33.FastUpdate;
  }
  _getVertexData(e43) {
    let t31 = 0;
    const i20 = e43.paths, r39 = [], s33 = e43.spatialReference, a30 = this._context.elevationProvider.spatialReference, o27 = this._context.renderCoordsHelper.spatialReference;
    for (const c33 of i20) t31 += c33.length;
    const n28 = t12(3 * t31);
    let l35, h23 = 0;
    for (const c33 of i20) {
      r39.push({
        offset: h23,
        numVertices: c33.length
      });
      for (const t32 of c33) n28[h23++] = t32[0], n28[h23++] = t32[1], n28[h23++] = e43.hasZ ? t32[2] : 0;
    }
    return null == a30 || s33.equals(a30) || n4(n28, s33, 0, n28, a30, 0, t31) ? (null == a30 || a30.equals(o27) ? l35 = e22(n28) : (l35 = t12(3 * t31), n4(n28, a30, 0, l35, o27, 0, t31)), {
      pathVertexDataInfos: r39,
      vertexDataES: n28,
      vertexDataRS: l35
    }) : null;
  }
  _createAs3DShape(e43, s33, a30, o27) {
    this.usedMemory = 0;
    const n28 = e43.geometry, h23 = this._getVertexData(n28);
    if (null == h23) return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"), null;
    if (0 === h23.pathVertexDataInfos.length) return 0 !== n28.paths.length && n28.paths.some((e44) => e44.length > 0) || this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"), null;
    const c33 = new Array(), p23 = n28.spatialReference, b18 = i(), y12 = this._context.renderCoordsHelper, v15 = new r18(h23.vertexDataES);
    for (const m22 of h23.pathVertexDataInfos) {
      const n29 = m22.numVertices;
      if (n29 < 2) continue;
      const g17 = m22.offset;
      if (null != this._context.clippingExtent && (P2(b18), c3(b18, h23.vertexDataES, g17, n29), !V(b18, this._context.clippingExtent))) continue;
      const w11 = new Array(), x13 = g17 + 3 * n29;
      for (let e44 = g17; e44 < x13; e44 += 3) {
        v15.offset = e44;
        const t31 = f11(v15, this._context.elevationProvider, a30, y12);
        o2(oe2, h23.vertexDataRS[e44], h23.vertexDataRS[e44 + 1], h23.vertexDataRS[e44 + 2]), y12.setAltitude(oe2, t31), h23.vertexDataRS[e44] = oe2[0], h23.vertexDataRS[e44 + 1] = oe2[1], h23.vertexDataRS[e44 + 2] = oe2[2], w11.push(A10(this._upVectorAlignment));
      }
      const P11 = new r36(w11, h23.vertexDataES, h23.vertexDataRS, g17);
      ie(P11, this._upVectorAlignment, this._context.renderCoordsHelper);
      const j18 = new h17(P11, this._profile, this._extruder, this._startCap, this._endCap);
      let S19 = null;
      if (this._fastUpdates) {
        const t31 = this._fastUpdates.visualVariables, i20 = X(t31.size?.field, e43) ?? 0, r39 = X(t31.color?.field, e43) ?? 0, s34 = X(t31.opacity?.field, e43) ?? 0;
        S19 = new g13(j18, i20, r39, s34);
      } else {
        const e44 = [this._intrinsicSize[0], this._intrinsicSize[1]];
        if (this._drivenProperties.size) {
          const t32 = s33.size;
          e44[0] *= re(t32[0], "symbol-value" === t32[2] ? this.symbolLayer.height || 0 : t32[2], this.symbolLayer.width || 0), e44[1] *= re(t32[2], "symbol-value" === t32[0] ? this.symbolLayer.width || 0 : t32[0], this.symbolLayer.height || 0);
        }
        let t31;
        this._drivenProperties.color && (t31 = s33.color), this._drivenProperties.opacity && null != s33.opacity && (t31 = t31 ? [t31[0], t31[1], t31[2], s33.opacity] : [1, 1, 1, s33.opacity]);
        const i20 = new f23(j18);
        i20.bake(e44), t31 && i20.bakeVertexColors(t31), S19 = i20;
      }
      const D10 = S19.createGeometryData(), C7 = this._context.stage.renderView.getObjectAndLayerIdColor({
        graphicUid: o27,
        layerUid: this._context.layer.uid
      }), L10 = new e39(this._materials[0], D10, S19, p23, this._stencilWidth, C7);
      L10.transformation = i2(e12(), o6, j18.path.origin), c33.push(L10), this.usedMemory += j18.usedMemory;
    }
    if (0 === c33.length) return null;
    const x12 = new O10({
      geometries: c33,
      layerUid: this._context.layer.uid,
      graphicUid: o27
    }), P10 = new p12(this, x12, c33, null, null, (e44, t31, i20, r39, s34) => ae2(e44, t31, r39, s34, this._upVectorAlignment), a30);
    return P10.alignedSampledElevation = 0, P10.needsElevationUpdates = g5(a30.mode), P10;
  }
};
function ie(e43, t31, i20) {
  const {
    origin: r39,
    positions: s33
  } = e43;
  let a30 = e43.offset;
  switch (t31) {
    default:
    case o23.World:
      for (const t32 of e43.vertices) oe2[0] = s33[a30++] + r39[0], oe2[1] = s33[a30++] + r39[1], oe2[2] = s33[a30++] + r39[2], i20.worldUpAtPosition(oe2, oe2), t32.setFrameFromUpVector(oe2);
      break;
    case o23.Path:
      oe2[0] = s33[a30] + r39[0], oe2[1] = s33[a30 + 1] + r39[1], oe2[2] = s33[a30 + 2] + r39[2], i20.worldUpAtPosition(oe2, oe2), l31(e43, oe2);
  }
}
function re(e43, t31, i20) {
  switch (e43) {
    case "symbol-value":
      return i20;
    case "proportional":
      return t31;
    default:
      return e43;
  }
}
function se2(e43, t31, i20, r39) {
  let s33 = 0;
  const {
    origin: a30,
    vertices: o27,
    positions: n28,
    positionsES: h23
  } = e43, c33 = e43.offset + 3 * o27.length;
  for (let p23 = e43.offset; p23 < c33; p23 += 3) o2(oe2, h23[p23], h23[p23 + 1], h23[p23 + 2]), i20(oe2, ne2), s33 += ne2.sampledElevation, oe2[0] = n28[p23] + a30[0], oe2[1] = n28[p23 + 1] + a30[1], oe2[2] = n28[p23 + 2] + a30[2], r39.setAltitude(oe2, ne2.z), n28[p23] = oe2[0] - a30[0], n28[p23 + 1] = oe2[1] - a30[1], n28[p23 + 2] = oe2[2] - a30[2];
  return e43.updatePathVertexInformation(), s33 / o27.length;
}
function ae2(e43, t31, i20, r39, s33) {
  const a30 = e43.stageObject, o27 = a30.geometries;
  let n28 = 0;
  for (const l35 of o27) {
    if (!n23(l35)) continue;
    const e44 = l35.path, o28 = e44.builder.path;
    n28 += se2(o28, t31, i20, r39), s33 !== o23.World && ie(o28, s33, r39), e44.onPathChanged(l35), l35.invalidateBoundingInfo(), a30.geometryVertexAttributeUpdated(l35, e16.POSITION);
  }
  return n28 / o27.length;
}
var oe2 = n2();
var ne2 = new R4();

// ../../../node_modules/@arcgis/core/views/3d/layers/support/uvUtils.js
function T7(t31, r39, e43, s33, i20 = 1) {
  if (e43.isGeographic && s33 === l8.Global) {
    const t32 = t12(r39.length), o27 = r39.length, s34 = s4(e43);
    for (let e44 = 0; e44 < o27; e44 += 3) H(r39, e44, t32, e44, s34);
    r39 = t32;
  }
  o9(y11, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);
  for (let o27 = 0; o27 < r39.length; o27 += 3) y11[0] = Math.min(y11[0], r39[o27]), y11[1] = Math.min(y11[1], r39[o27 + 1]);
  const m22 = y11[0] % i20, a30 = y11[1] % i20, n28 = y11[0] - m22, c33 = y11[1] - a30;
  for (let o27 = 0; o27 < r39.length; o27 += 3) {
    const e44 = o27 / 3 * 4;
    t31[e44] = (r39[o27] - n28) / i20, t31[e44 + 1] = (r39[o27 + 1] - c33) / i20, t31[e44 + 2] = n28 / i20, t31[e44 + 3] = c33 / i20;
  }
}
function M5(t31, r39, n28, c33, l35 = 1) {
  o2(F10, 1, 0, 0), o2(Y6, 0, 1, 0), o2(_14, 0, 0, 1), D9(x10, n28), d4(V11, n28) && O18(V11, F10, Y6, _14, c33, x10), o9(y11, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY), o9(P8, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY);
  for (let o27 = 0; o27 < n28.length; o27 += 3) {
    o2(E17, n28[o27], n28[o27 + 1], n28[o27 + 2]);
    const t32 = P(F10, E17), r40 = P(Y6, E17);
    y11[0] = Math.min(y11[0], t32), y11[1] = Math.min(y11[1], r40), P8[0] = Math.max(P8[0], t32), P8[1] = Math.max(P8[1], r40);
  }
  const f26 = P(_14, x10);
  q8(v10, y11[0], y11[1], f26, F10, Y6, _14), q8(A12, P8[0], y11[1], f26, F10, Y6, _14), q8(G10, y11[0], P8[1], f26, F10, Y6, _14), e8(A12, A12, v10), g(A12, A12, 0.5), e8(G10, G10, v10), g(G10, G10, 0.5), u5(v10, v10, A12), u5(v10, v10, G10);
  const I18 = y11[0] % l35, p23 = y11[1] % l35, N6 = y11[0] - I18, g17 = y11[1] - p23;
  for (let o27 = 0; o27 < n28.length; o27 += 3) {
    o2(E17, n28[o27], n28[o27 + 1], n28[o27 + 2]);
    const i20 = o27 / 3, m22 = 4 * i20;
    t31[m22] = (P(F10, E17) - N6) / l35, t31[m22 + 1] = (P(Y6, E17) - g17) / l35, t31[m22 + 2] = N6 / l35, t31[m22 + 3] = g17 / l35;
    const a30 = 9 * i20;
    for (let t32 = 0; t32 < 3; t32++) r39[a30 + t32] = v10[t32], r39[a30 + t32 + 3] = A12[t32], r39[a30 + t32 + 6] = G10[t32];
  }
}
var x10 = n2();
var E17 = n2();
var V11 = E2();
var F10 = n2();
var Y6 = n2();
var _14 = n2();
var y11 = n10();
var P8 = n10();
var v10 = n2();
var A12 = n2();
var G10 = n2();
function O18(t31, o27, r39, i20, a30, I18) {
  null != a30 ? (a30.basisMatrixAtPosition(I18, S16), o2(d19, S16[0], S16[1], S16[2]), o2(k7, S16[4], S16[5], S16[6]), o2(w10, S16[8], S16[9], S16[10])) : (o2(d19, 1, 0, 0), o2(k7, 0, 1, 0), o2(w10, 0, 0, 1));
  const p23 = F2(t31);
  P(p23, w10) < 0 && g(p23, p23, -1), r4(i20, p23);
  const N6 = P(p23, k7), g17 = P(p23, d19);
  Math.abs(N6) > Math.abs(g17) ? (q(o27, d19, p23, -g17), z(o27, o27), _3(r39, o27, p23), z(r39, r39), g(r39, r39, -1)) : (q(r39, k7, p23, -N6), z(r39, r39), _3(o27, r39, p23), z(o27, o27));
}
var S16 = e12();
var d19 = n2();
var k7 = n2();
var w10 = n2();
function D9(t31, o27) {
  o2(U8, 0, 0, 0);
  for (let r39 = 0; r39 < o27.length - 3; r39 += 3) U8[0] += o27[r39], U8[1] += o27[r39 + 1], U8[2] += o27[r39 + 2];
  g(t31, U8, 1 / (o27.length / 3 - 1));
}
var U8 = n2();
function q8(t31, o27, r39, s33, i20, m22, a30) {
  o2(t31, o27 * i20[0] + r39 * m22[0] + s33 * a30[0], o27 * i20[1] + r39 * m22[1] + s33 * a30[1], o27 * i20[2] + r39 * m22[2] + s33 * a30[2]);
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/PatternTechnique.js
var N3 = class _N extends r14 {
  initializeProgram(e43) {
    return new r15(e43.rctx, _N.shader.get().build(this.configuration), has("enable-feature:objectAndLayerId-rendering") ? R9 : I14);
  }
  _setPipelineState(e43, o27) {
    const r39 = this.configuration, i20 = e43 === o11.NONE, s33 = e43 === o11.FrontFace;
    return S6({
      blending: r39.output === o7.Color ? i20 ? A6 : c17(e43) : null,
      culling: h10(r39.cullFace),
      depthTest: r39.draped ? null : {
        func: f8(e43)
      },
      depthWrite: r39.draped ? null : i20 ? o12 : l15(e43),
      drawBuffers: r39.output === o7.Depth ? {
        buffers: [f6.NONE]
      } : s16(e43),
      colorWrite: _7,
      stencilWrite: r39.hasOccludees ? e27 : null,
      stencilTest: r39.hasOccludees ? o27 ? o13 : f9 : null,
      polygonOffset: i20 || s33 ? r39.polygonOffset ? E18 : null : _8(r39.enableOffset)
    });
  }
  initializePipeline() {
    return this._occludeePipelineState = this._setPipelineState(this.configuration.transparencyPassType, true), this._setPipelineState(this.configuration.transparencyPassType, false);
  }
  getPipeline(e43) {
    return e43 ? this._occludeePipelineState : super.getPipeline();
  }
};
N3.shader = new t16(T3, () => import("./Pattern.glsl-V5JFR5IN.js"));
var E18 = {
  factor: 1,
  units: 1
};
var A13 = class extends t20 {
  constructor() {
    super(...arguments), this.output = o7.Color, this.cullFace = e24.None, this.transparencyPassType = o11.NONE, this.hasSlicePlane = false, this.hasVertexColors = false, this.polygonOffset = false, this.hasOccludees = false, this.enableOffset = true, this.multipassEnabled = false, this.cullAboveGround = false, this.vvColor = false, this.objectAndLayerIdColorInstanced = false;
  }
};
e5([r17({
  count: o7.COUNT
})], A13.prototype, "output", void 0), e5([r17({
  count: e24.COUNT
})], A13.prototype, "cullFace", void 0), e5([r17({
  count: a15.COUNT
})], A13.prototype, "style", void 0), e5([r17({
  count: o11.COUNT
})], A13.prototype, "transparencyPassType", void 0), e5([r17()], A13.prototype, "hasSlicePlane", void 0), e5([r17()], A13.prototype, "hasVertexColors", void 0), e5([r17()], A13.prototype, "polygonOffset", void 0), e5([r17()], A13.prototype, "hasOccludees", void 0), e5([r17()], A13.prototype, "patternSpacing", void 0), e5([r17()], A13.prototype, "lineWidth", void 0), e5([r17()], A13.prototype, "enableOffset", void 0), e5([r17()], A13.prototype, "draped", void 0), e5([r17()], A13.prototype, "multipassEnabled", void 0), e5([r17()], A13.prototype, "cullAboveGround", void 0), e5([r17()], A13.prototype, "vvColor", void 0), e5([r17({
  constValue: true
})], A13.prototype, "writeDepth", void 0), e5([r17({
  constValue: false
})], A13.prototype, "occlusionPass", void 0), e5([r17({
  constValue: false
})], A13.prototype, "hasVvInstancing", void 0), e5([r17({
  constValue: false
})], A13.prototype, "vvSize", void 0), e5([r17({
  constValue: false
})], A13.prototype, "vvOpacity", void 0);
var I14 = /* @__PURE__ */ new Map([[e16.POSITION, 0], [e16.COLOR, 3], [e16.UVMAPSPACE, 4], [e16.COLORFEATUREATTRIBUTE, 5], [e16.BOUNDINGRECT, 6]]);
var R9 = /* @__PURE__ */ new Map([[e16.POSITION, 0], [e16.COLOR, 3], [e16.UVMAPSPACE, 4], [e16.COLORFEATUREATTRIBUTE, 5], [e16.BOUNDINGRECT, 6], [e16.OBJECTANDLAYERIDCOLOR, 9]]);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/PatternMaterial.js
var v11 = class extends e29 {
  constructor(e43) {
    super(e43, new C6()), this.supportsEdges = true, this.produces = /* @__PURE__ */ new Map([[E6.OPAQUE_MATERIAL, (e44) => h6(e44)], [E6.TRANSPARENT_MATERIAL, (e44) => i3(e44)], [E6.TRANSPARENT_NO_SSAO_DEPTH, (e44) => g3(e44) && this.parameters.writeLinearDepth], [E6.DRAPED_MATERIAL, (e44) => this.parameters.draped && e44 === o7.Color || h6(e44)]]), this._vertexAttributeLocations = has("enable-feature:objectAndLayerId-rendering") ? R9 : I14, this._configuration = new A13();
  }
  getConfiguration(e43, t31) {
    return this._configuration.output = e43, this._configuration.cullFace = this.parameters.cullFace, this._configuration.hasVertexColors = this.parameters.hasVertexColors && !this.parameters.vvColor, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.polygonOffset = this.parameters.polygonOffset, this._configuration.style = this.parameters.style, this._configuration.patternSpacing = this.parameters.patternSpacing, this._configuration.lineWidth = this.parameters.lineWidth, this._configuration.draped = this.parameters.draped, this._configuration.transparencyPassType = t31.transparencyPassType, this._configuration.enableOffset = t31.camera.relativeElevation < E5, this._configuration.multipassEnabled = t31.multipassEnabled, this._configuration.cullAboveGround = t31.multipassTerrain.cullAboveGround, this._configuration.vvColor = !!this.parameters.vvColor, this._configuration;
  }
  createGLMaterial(e43) {
    return new E19(e43);
  }
  createBufferWriter() {
    const e43 = H2().vec3f(e16.POSITION).vec4f(e16.UVMAPSPACE);
    return this.parameters.draped || e43.mat3f(e16.BOUNDINGRECT), this.parameters.vvColor ? e43.f32(e16.COLORFEATUREATTRIBUTE) : e43.vec4u8(e16.COLOR), has("enable-feature:objectAndLayerId-rendering") && e43.vec4u8(e16.OBJECTANDLAYERIDCOLOR), new S17(e43);
  }
};
var E19 = class extends t15 {
  _updateParameters(e43) {
    return this.ensureTechnique(N3, e43);
  }
  _updateOccludeeState(e43) {
    e43.hasOccludees !== this._material.parameters.hasOccludees && this._material.setParameters({
      hasOccludees: e43.hasOccludees
    });
  }
  beginSlot(e43) {
    return this._output === o7.Color && this._updateOccludeeState(e43), this._updateParameters(e43);
  }
};
var S17 = class extends r13 {
  write(e43, s33, i20, a30, o27) {
    E7(i20, this.vertexBufferLayout, e43, s33, a30, o27);
    for (const n28 of this.vertexBufferLayout.fields.keys()) {
      const s34 = i20.attributes.get(n28), c33 = s34?.indices;
      if (s34 && c33) switch (n28) {
        case e16.UVMAPSPACE: {
          s12(4 === s34.size);
          const e44 = a30.getField(n28, c8);
          e44 && p7(s34, e44, o27);
          break;
        }
        case e16.BOUNDINGRECT: {
          s12(9 === s34.size);
          const r39 = a30.getField(n28, l10);
          r39 && j16(s34, e43, r39, o27);
          break;
        }
      }
    }
  }
};
function j16(e43, t31, r39, s33) {
  const {
    data: i20,
    indices: a30
  } = e43, o27 = t31, n28 = r39.typedBuffer, c33 = r39.typedBufferStride, l35 = a30.length;
  s33 *= c33;
  for (let u32 = 0; u32 < l35; ++u32) {
    const e44 = 9 * a30[u32], t32 = i20[e44], r40 = i20[e44 + 1], l36 = i20[e44 + 2];
    n28[s33] = o27[0] * t32 + o27[4] * r40 + o27[8] * l36 + o27[12], n28[s33 + 1] = o27[1] * t32 + o27[5] * r40 + o27[9] * l36 + o27[13], n28[s33 + 2] = o27[2] * t32 + o27[6] * r40 + o27[10] * l36 + o27[14];
    for (let a31 = 3; a31 < 9; ++a31) n28[s33 + a31] = i20[e44 + a31];
    s33 += c33;
  }
}
var C6 = class extends t19 {
  constructor() {
    super(...arguments), this.color = r5(1, 1, 1, 1), this.writeLinearDepth = false, this.hasVertexColors = false, this.polygonOffset = false, this.hasSlicePlane = false, this.cullFace = e24.None, this.hasOccludees = false, this.style = a15.Cross, this.patternSpacing = 10, this.lineWidth = 1, this.draped = true;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/support/patternUtils.js
function s31(e43, r39) {
  const a30 = e43?.pattern ?? null;
  return null == a30 ? new d9(r39) : "none" === a30.style || "solid" === a30.style ? ("none" === a30.style && (r39.color = r5(0, 0, 0, 0), r39.forceTransparentMode = true), new d9(r39)) : (r39.style = l33(a30.style), new v11(r39));
}
function l33(t31) {
  switch (t31) {
    case "horizontal":
      return a15.Horizontal;
    case "vertical":
      return a15.Vertical;
    case "cross":
      return a15.Cross;
    case "forward-diagonal":
      return a15.ForwardDiagonal;
    case "backward-diagonal":
      return a15.BackwardDiagonal;
    case "diagonal-cross":
      return a15.DiagonalCross;
    default:
      return;
  }
}
function c30(t31) {
  return t31.material instanceof v11 && !t31.material.parameters.draped;
}
function u31(t31, e43) {
  if (c30(t31)) {
    const n28 = t31.attributes.get(e16.POSITION).data, o27 = t31.getMutableAttribute(e16.UVMAPSPACE).data, i20 = t31.getMutableAttribute(e16.BOUNDINGRECT).data;
    M5(o27, i20, n28, e43);
  }
}
function m21(t31, r39, a30, n28, o27) {
  const i20 = u18(t31, r39, a30, n28, o27), s33 = t31.stageObject.geometries;
  for (const e43 of s33) u31(e43, o27);
  return i20;
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer.js
var z8 = ["polyline", "polygon", "extent"];
var H4 = new B2({
  size: false,
  color: true,
  rotation: false,
  opacity: false
});
var N4 = class _N extends y6 {
  constructor(e43, t31, i20, r39) {
    super(e43, t31, i20, r39), this._needsUV = false;
  }
  doLoad() {
    return __async(this, null, function* () {
      this._fastUpdates = O9(this._context.renderer, H4);
    });
  }
  _createMaterials() {
    if (this._materials.length > 0) return;
    const e43 = this.symbolLayer?.material?.color, i20 = this._getCombinedOpacityAndColor(e43);
    this._materials[J6.Fill] = s31(this.symbolLayer, __spreadValues({
      color: i20,
      forceTransparentMode: this.needsDrivenTransparentPass,
      polygonOffset: false,
      hasVertexColors: true,
      writeLinearDepth: true,
      draped: this.draped,
      hasSlicePlane: this._context.slicePlaneEnabled
    }, this._fastUpdates?.materialParameters)), this._needsUV = this._materials[J6.Fill] instanceof v11;
    const r39 = this.symbolLayer.outline;
    if (K4(r39)) {
      const e44 = n15(r39.pattern);
      this._materials[J6.Outline] = new z5({
        width: u8(r39.size),
        color: this._getOutlineColor(),
        hasPolygonOffset: true,
        hasSlicePlane: this._context.slicePlaneEnabled,
        isClosed: true,
        stipplePattern: e44,
        cap: n20(r39.patternCap || "butt")
      });
    }
    this._context.stage.addMany(this._materials);
  }
  destroy() {
    super.destroy(), this._context.stage.removeMany(this._materials), this._materials.length = 0;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry, z8, this.symbolLayer.type)) return null;
    const i20 = this._getVertexOpacityAndColor(e43.renderingInfo, 255), r39 = this.setGraphicElevationContext(t31);
    return this.ensureDrapedStatus("on-the-ground" === r39.mode), this._createMaterials(), this.draped ? this._createAsOverlay(t31, i20) : this._createAs3DShape(t31, i20, r39);
  }
  applyRendererDiff(e43, t31) {
    for (const i20 in e43.diff) {
      if ("visualVariables" !== i20) return e33.RecreateSymbol;
      if (!G3(this._fastUpdates, t31, H4)) return e33.RecreateSymbol;
      this._materials[J6.Fill]?.setParameters(this._fastUpdates.materialParameters);
    }
    return e33.FastUpdate;
  }
  layerOpacityChanged() {
    if (null != this._materials[J6.Fill]) {
      const e43 = this._materials[J6.Fill].parameters.color, t31 = this.symbolLayer?.material?.color, i20 = this._getCombinedOpacity(t31);
      this._materials[J6.Fill].setParameters({
        color: [e43[0], e43[1], e43[2], i20],
        forceTransparentMode: this.needsDrivenTransparentPass
      });
    }
    if (null != this._materials[J6.Outline]) {
      const e43 = this._materials[J6.Outline].parameters.color;
      this._materials[J6.Outline].setParameters({
        color: [e43[0], e43[1], e43[2], this._getOutlineOpacity()]
      });
    }
  }
  layerElevationInfoChanged(e43, t31, i20) {
    const r39 = this._elevationContext.mode, o27 = m9(_N.elevationModeChangeTypes, i20, r39);
    if (o27 !== b6.UPDATE) return o27;
    const s33 = d7(r39);
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, () => s33);
  }
  slicePlaneEnabledChanged() {
    if (this._materials[J6.Fill]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), this._materials[J6.Outline]) {
      const e43 = {
        hasSlicePlane: this._context.slicePlaneEnabled
      };
      this._materials[J6.Outline].setParameters(e43);
    }
    return true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  _createAs3DShape(e43, t31, i20) {
    const r39 = b12(e43.geometry);
    if (!r39) return null;
    const o27 = p17(r39, this._context.elevationProvider, this._context.renderCoordsHelper, i20), s33 = new k8(o27, t31, this._context.layer.uid, e43.uid), n28 = s33.renderData.position.length / 3;
    if (this._needsUV && (s33.uvMapSpace = t11(4 * n28, true), s33.boundingRect = t12(9 * n28, true), M5(s33.uvMapSpace, s33.boundingRect, s33.renderData.position, this._context.renderCoordsHelper)), s33.objectAndLayerIdColor = this._context.stage.renderView?.getObjectAndLayerIdColor(s33), this._createAs3DShapeFill(e43, s33), this._materials[J6.Outline] && this._createAs3DShapeOutline(s33), this._logGeometryCreationWarnings(s33.renderData, r39.rings, "rings", "FillSymbol3DLayer"), 0 === s33.outGeometries.length) return null;
    const a30 = new O10({
      geometries: s33.outGeometries,
      castShadow: false,
      layerUid: this._context.layer.uid,
      graphicUid: e43.uid
    }), c33 = new p12(this, a30, s33.outGeometries, null, null, m21, i20);
    return c33.alignedSampledElevation = s33.renderData.sampledElevation, c33.needsElevationUpdates = d7(i20.mode), c33;
  }
  _createAs3DShapeFill(e43, t31) {
    const i20 = t31.renderData.polygons;
    for (const {
      position: r39,
      mapPositions: a30,
      holeIndices: l35,
      index: p23,
      count: u32
    } of i20) {
      if (null != this._context.clippingExtent && (P2(W6), c3(W6, a30), !V(W6, this._context.clippingExtent))) continue;
      const i21 = p16(a30, l35, this._context.elevationProvider.spatialReference);
      if (0 === i21.length) continue;
      const d21 = this._fastUpdates?.visualVariables.color, m22 = m16({
        material: this._materials[J6.Fill],
        indices: i21,
        mapPositions: a30,
        attributeData: {
          position: r39,
          color: d21 ? null : t31.color,
          colorFeature: d21 ? X(d21.field, e43) : null,
          uvMapSpace: this._needsUV ? o10(t31.uvMapSpace, 4 * p23, 4 * u32) : null,
          boundingRect: this._needsUV ? a10(t31.boundingRect, 9 * p23, 9 * u32) : null,
          objectAndLayerIdColor: t31.objectAndLayerIdColor
        }
      });
      t31.outGeometries.push(m22);
    }
  }
  _createAs3DShapeOutline(e43) {
    if (null == this._materials[J6.Outline]) return;
    const t31 = e43.renderData.outlines;
    for (const {
      mapPositions: i20,
      position: r39
    } of t31) {
      if (null != this._context.clippingExtent && (P2(W6), c3(W6, i20), !V(W6, this._context.clippingExtent))) continue;
      const t32 = b8(this._materials[J6.Outline], {
        overlayInfo: null,
        removeDuplicateStartEnd: true,
        mapPositions: i20,
        attributeData: {
          position: r39
        }
      }, e43.objectAndLayerIdColor);
      e43.outGeometries.push(t32);
    }
  }
  _createAsOverlay(e43, t31) {
    const i20 = b12(e43.geometry);
    if (null == i20) return null;
    this._materials[J6.Fill].renderPriority = this._renderPriority + this._renderPriorityStep / 2, null != this._materials[J6.Outline] && (this._materials[J6.Outline].renderPriority = this._renderPriority);
    const r39 = c24(i20, this._context.overlaySR), s33 = new q9(r39, t31, this._context.layer.uid, e43.uid), n28 = s33.renderData.position.length / 3;
    return this._needsUV && (s33.uvMapSpace = t11(4 * n28, true), T7(s33.uvMapSpace, s33.renderData.position, this._context.overlaySR, this._context.graphicsCoreOwner.view.state.viewingMode)), s33.outBoundingBox = P2(), s33.objectAndLayerIdColor = this._context.stage.renderView?.getObjectAndLayerIdColor(s33), this._createAsOverlayFill(e43, s33), this._materials[J6.Outline] && this._createAsOverlayOutline(s33), this._logGeometryCreationWarnings(s33.renderData, i20.rings, "rings", "FillSymbol3DLayer"), 0 === s33.outGeometries.length ? null : new l28(this, s33.outGeometries, s33.outBoundingBox, this._context.drapeSourceRenderer);
  }
  _createAsOverlayFill(e43, t31) {
    const r39 = t31.renderData.polygons;
    for (const {
      position: l35,
      holeIndices: c33,
      index: p23,
      count: u32
    } of r39) {
      const r40 = P2(W6);
      if (c3(r40, l35), !V(r40, this._context.clippingExtent)) continue;
      const d21 = i6(l35, c33, 3);
      if (0 === d21.length) continue;
      o3(t31.outBoundingBox, r40);
      const m22 = this._fastUpdates?.visualVariables.color, y12 = m16({
        material: this._materials[J6.Fill],
        indices: d21,
        attributeData: {
          position: l35,
          color: m22 ? null : t31.color,
          colorFeature: m22 ? X(m22.field, e43) : null,
          uvMapSpace: this._needsUV ? o10(t31.uvMapSpace, 4 * p23, 4 * u32) : null,
          objectAndLayerIdColor: t31.objectAndLayerIdColor
        }
      });
      t31.outGeometries.push(new m8(y12, t31));
    }
  }
  _createAsOverlayOutline(e43) {
    if (null == this._materials[J6.Outline]) return;
    const t31 = e43.renderData.outlines;
    for (let i20 = 0; i20 < t31.length; ++i20) {
      const {
        position: r39
      } = t31[i20];
      if (P2(W6), c3(W6, r39), !V(W6, this._context.clippingExtent)) continue;
      o3(e43.outBoundingBox, W6);
      const l35 = b8(this._materials[J6.Outline], {
        overlayInfo: {
          spatialReference: this._context.overlaySR,
          renderCoordsHelper: this._context.renderCoordsHelper
        },
        removeDuplicateStartEnd: true,
        attributeData: {
          position: r39
        }
      }, e43.objectAndLayerIdColor);
      e43.outGeometries.push(new m8(l35, e43));
    }
  }
  _getOutlineOpacity() {
    const e43 = this.symbolLayer?.outline?.color;
    return (this.draped ? 1 : this._getLayerOpacity()) * (null != e43 ? e43.a : 0);
  }
  _getOutlineColor() {
    const t31 = this.symbolLayer?.outline?.color, i20 = this._getOutlineOpacity();
    return F4(null != t31 ? u9.toUnitRGB(t31) : null, i20);
  }
  test() {
    return __spreadProps(__spreadValues({}, super.test()), {
      createAsOverlay: (e43, t31) => this._createAsOverlay(e43, t31),
      createAs3DShape: (e43, t31, i20) => this._createAs3DShape(e43, t31, i20)
    });
  }
};
N4.elevationModeChangeTypes = {
  definedChanged: b6.RECREATE,
  staysOnTheGround: b6.NONE,
  onTheGroundChanged: b6.RECREATE
};
var W6 = i();
var k8 = class extends g10 {
  constructor(e43, t31, i20, r39) {
    super(e43, i20, r39), this.color = t31;
  }
};
var q9 = class extends g10 {
  constructor(e43, t31, i20, r39) {
    super(e43, i20, r39), this.color = t31;
  }
};
var J6;
function K4(e43) {
  return null != e43?.size && e43.size > 0 && null != e43.color && (null == e43.pattern || "style" !== e43.pattern.type || "none" !== e43.pattern.style);
}
!function(e43) {
  e43[e43.Fill = 0] = "Fill", e43[e43.Outline = 1] = "Outline";
}(J6 || (J6 = {}));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextTextureFactory.js
var i18 = class {
  constructor(e43, n28, s33) {
    this._renderer = new r29(e43, n28, s33, v7.maxSize);
  }
  get key() {
    return this._renderer.key;
  }
  get baselineAnchorY() {
    return 1 - this._renderer.firstRenderedBaselinePosition / this._renderer.renderedHeight;
  }
  get displayWidth() {
    return this._renderer.displayWidth;
  }
  get displayHeight() {
    return this._renderer.displayHeight;
  }
  create() {
    const r39 = a21(d20, this._renderer.renderedWidth, this._renderer.renderedHeight), t31 = r39.getContext("2d");
    return t31.save(), this._renderer.render(t31, 0, 0), t31.restore(), new N(r39, {
      wrap: {
        s: D3.CLAMP_TO_EDGE,
        t: D3.CLAMP_TO_EDGE
      },
      noUnpackFlip: false,
      mipmap: true,
      preMultiplyAlpha: true
    });
  }
};
var d20 = {
  canvas: null
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DTextSymbolLayer.js
var T8 = r3(0, 0, 1);
var H5 = class extends y6 {
  constructor(e43, t31, r39, n28) {
    super(e43, t31, r39, n28), this._elevationOptions = {
      supportsOffsetAdjustment: true,
      supportsOnTheGround: false
    }, this.ensureDrapedStatus(false);
  }
  doLoad() {
    return __async(this, null, function* () {
      if (!this._drivenProperties.size) {
        const t31 = I7(this.symbolLayer.size);
        if (t31) throw new s2("graphics3dtextsymbollayer:invalid-size", t31);
      }
      yield this._createTextRenderParameters();
    });
  }
  _createTextRenderParameters() {
    return __async(this, null, function* () {
      const e43 = this._context.graphicsCoreOwner.view.state.rasterPixelRatio;
      this._textRenderParameters = yield s26.fromSymbol(this.symbolLayer, e43);
    });
  }
  destroy() {
    super.destroy();
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic, r39 = f16(t31.geometry);
    if (null == r39) return this.logger.warn(`unsupported geometry type for text symbol: ${t31.geometry.type}`), null;
    const n28 = this.symbolLayer.text;
    if (null == n28 || "" === n28) return null;
    const s33 = o5(this.symbol) && this.symbol.hasVisibleVerticalOffset() ? this.symbol.verticalOffset : null;
    if (null != s33 && !l5(this.symbolLayer)) return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`), null;
    const {
      verticalAlignment: i20
    } = this.symbolLayer, o27 = new i15(s33);
    h15(i20, o27.screenOffset);
    const l35 = new r30(o27, this.symbolLayer.horizontalAlignment, u21(i20));
    return this._createAs3DShape(t31, r39, n28, l35);
  }
  createLabel(e43, t31, r39, n28, s33) {
    const i20 = e43.graphic, o27 = f16(i20.geometry);
    if (null == o27) return this.logger.warn(`unsupported geometry type for label: ${i20.geometry.type}`), null;
    const l35 = t31.text;
    return !l35 || /^\s+$/.test(l35) ? null : this._createAs3DShape(i20, o27, l35, t31, r39, n28, s33);
  }
  setGraphicElevationContext(e43, t31, r39 = 0) {
    return super.setGraphicElevationContext(e43, t31), t31.addOffsetRenderUnits(r39), t31;
  }
  layerOpacityChanged() {
    return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"), false;
  }
  layerElevationInfoChanged(e43, t31) {
    return W7(e43, t31, (e44, t32) => {
      this.updateGraphicElevationContext(t32, e44);
    }), b6.UPDATE;
  }
  slicePlaneEnabledChanged(e43, t31) {
    return W7(e43, t31, (e44) => {
      for (const t32 of e44.stageObject.geometries) t32.material.setParameters({
        hasSlicePlane: this._context.slicePlaneEnabled
      });
    }), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  get pixelRatioChanged() {
    return false;
  }
  updateGraphicElevationContext(e43, t31) {
    const r39 = t31.elevationContext;
    this.setGraphicElevationContext(e43, r39, null != t31.metadata ? t31.metadata.elevationOffset : 0), t31.needsElevationUpdates = d7(r39.mode) || "absolute-height" === r39.mode;
  }
  updateGeometry(e43, t31) {
    if (this.draped || !this._validateGeometry(t31)) return false;
    const {
      elevationContext: r39,
      stageObject: n28
    } = e43;
    if (r39.mode !== this.getGeometryElevationMode(t31)) return false;
    const s33 = f16(t31);
    if (!s33) return false;
    const i20 = p14(n28, this._context, s33, r39);
    if (null == i20) return false;
    const o27 = d13(this._context, s33);
    return n28.geometries[0].localOrigin === o27 && (e43.alignedSampledElevation = i20, m13(e43, s33, this._context.elevationProvider), true);
  }
  _defaultElevationInfoNoZ() {
    return M6;
  }
  _createAs3DShape(e43, l35, a30, c33, f26 = null, g17 = null, y12 = () => c33.placement.elevationOffset) {
    const x12 = this.setGraphicElevationContext(e43, new o15(), c33.placement.elevationOffset), v15 = "polyline" === e43.geometry?.type, b18 = e43.uid;
    let O20 = null, j18 = null;
    if (null == g17) {
      const e44 = f17(c33.horizontalPlacement);
      O20 = new i18(a30, e44, this._textRenderParameters);
      let n28 = null;
      if (null != this._context.sharedResources.textures) {
        j18 = this._context.sharedResources.textures.fromData(O20.key, () => O20.create()), j18.texture.events.on("unloaded", () => n28 = t3(n28));
        const e45 = this._context.stage.renderView.textures.acquire(j18.texture.id);
        if (null == e45 || S(e45)) return j18.release(), null;
        n28 = e45;
      }
    }
    const w11 = I15(O20, c33), S19 = {
      occlusionTest: !has("enable-feature:non-occluded-hud"),
      screenOffset: c33.placement.screenOffset,
      anchorPosition: w11,
      polygonOffset: true,
      color: [1, 1, 1, 1],
      centerOffsetUnits: c33.placement.centerOffsetUnits,
      drawInSecondSlot: true
    };
    if (v15 && (S19.shaderPolygonOffset = 1e-4), g17 ? S19.textureId = g17.id : j18 && (S19.textureId = j18.texture.id), null != c33.placement.verticalOffset) {
      const {
        screenLength: e44,
        minWorldLength: t31,
        maxWorldLength: r39
      } = c33.placement.verticalOffset;
      S19.verticalOffset = {
        screenLength: u8(e44),
        minWorldLength: t31 || 0,
        maxWorldLength: null != r39 ? r39 : 1 / 0
      };
    }
    const _16 = {
      screenOffset: S19.screenOffset,
      anchorPosition: w11,
      centerOffsetUnits: S19.centerOffsetUnits,
      verticalOffset: S19.verticalOffset,
      shaderPolygonOffset: S19.shaderPolygonOffset
    };
    if (this._context.screenSizePerspectiveEnabled) {
      const {
        screenSizePerspectiveSettings: e44,
        screenSizePerspectiveSettingsLabels: t31
      } = this._context.sharedResources, r39 = e35(this._textRenderParameters);
      S19.screenSizePerspective = t31.overrideFontHeight(r39.maxHeight), S19.screenSizePerspectiveAlignment = e44, _16.fontHeight = r39.maxHeight;
    }
    S19.hasSlicePlane = this._context.slicePlaneEnabled;
    const E20 = (e44, t31, r39) => {
      let n28 = e44.get(r39);
      return null == n28 && (n28 = new Q2(t31), e44.add(r39, n28)), n28;
    }, L10 = f26 ? E20(f26, S19, JSON.stringify(_16)) : new Q2(S19), D10 = c33.placement.translation, H6 = O20 ? r7(O20.displayWidth, O20.displayHeight) : a6, W9 = c33.placement.centerOffset, M9 = T8, V14 = n10(), $3 = ht(L10, M9, D10, null, H6, W9, V14, null), F13 = a18(this._context, l35, $3, x12, b18);
    if (null == F13) return null;
    const k11 = (t31, r39, n28, s33, i20, o27) => {
      const l36 = y12() || c33.placement.elevationOffset, a31 = this.setGraphicElevationContext(e43, r39, l36);
      return p11(t31, a31, n28, s33, i20, o27);
    }, N6 = new p12(this, F13.object, [$3], null == f26 ? [L10] : null, j18, k11, x12);
    N6.alignedSampledElevation = F13.sampledElevation, N6.needsElevationUpdates = d7(x12.mode) || "absolute-height" === x12.mode, N6.getScreenSize = (e44 = n10()) => (e44[0] = O20 ? O20.displayWidth : c33.displaySize[0], e44[1] = O20 ? O20.displayHeight : c33.displaySize[1], e44);
    const q10 = new t24(c33.placement.elevationOffset, a30);
    return N6.metadata = q10, m13(N6, l35, this._context.elevationProvider), N6;
  }
};
function W7(e43, t31, r39) {
  e43 && e43.forEach((e44) => {
    const n28 = t31(e44);
    null != n28 && r39(n28, e44.graphic);
  });
}
function I15(e43, t31) {
  if ("baseline" === t31.verticalPlacement) {
    const r40 = i14[t31.horizontalPlacement], n28 = null != e43 ? e43.baselineAnchorY : 0;
    return r7(r40, n28);
  }
  const r39 = m15(t31.horizontalPlacement, t31.verticalPlacement);
  return s25[r39];
}
var M6 = {
  mode: "relative-to-ground",
  offset: 0
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/WaterTechnique.js
var T9 = class _T extends r14 {
  initializeConfiguration(e43, o27) {
    o27.spherical = e43.viewingMode === l8.Global, o27.doublePrecisionRequiresObfuscation = e43.rctx.driverTest.doublePrecisionRequiresObfuscation.result;
  }
  initializeProgram(e43) {
    return new r15(e43.rctx, _T.shader.get().build(this.configuration), O6);
  }
  _setPipelineState(e43) {
    const t31 = this.configuration, r39 = e43 === o11.NONE, i20 = e43 === o11.FrontFace;
    return S6({
      blending: t31.output !== o7.Normal && t31.output !== o7.Highlight && t31.output !== o7.ObjectAndLayerIdColor && t31.transparent ? r39 ? A6 : c17(e43) : null,
      depthTest: t31.draped ? null : {
        func: f8(e43)
      },
      depthWrite: t31.draped ? null : r39 ? t31.writeDepth ? o12 : null : l15(e43),
      drawBuffers: s16(e43),
      colorWrite: _7,
      polygonOffset: r39 || i20 ? null : _8(t31.enableOffset)
    });
  }
  initializePipeline() {
    return this._setPipelineState(this.configuration.transparencyPassType);
  }
};
T9.shader = new t16(M, () => import("./WaterSurface.glsl-R45T2Z44.js"));
var O19 = class extends t20 {
  constructor() {
    super(...arguments), this.output = o7.Color, this.transparencyPassType = o11.NONE, this.spherical = false, this.receiveShadows = false, this.hasSlicePlane = false, this.transparent = false, this.enableOffset = true, this.writeDepth = false, this.hasScreenSpaceReflections = false, this.doublePrecisionRequiresObfuscation = false, this.hasCloudsReflections = false, this.objectAndLayerIdColorInstanced = false, this.draped = false, this.multipassEnabled = false, this.cullAboveGround = false;
  }
};
e5([r17({
  count: o7.COUNT
})], O19.prototype, "output", void 0), e5([r17({
  count: o11.COUNT
})], O19.prototype, "transparencyPassType", void 0), e5([r17()], O19.prototype, "spherical", void 0), e5([r17()], O19.prototype, "receiveShadows", void 0), e5([r17()], O19.prototype, "hasSlicePlane", void 0), e5([r17()], O19.prototype, "transparent", void 0), e5([r17()], O19.prototype, "enableOffset", void 0), e5([r17()], O19.prototype, "writeDepth", void 0), e5([r17()], O19.prototype, "hasScreenSpaceReflections", void 0), e5([r17()], O19.prototype, "doublePrecisionRequiresObfuscation", void 0), e5([r17()], O19.prototype, "hasCloudsReflections", void 0), e5([r17()], O19.prototype, "objectAndLayerIdColorInstanced", void 0), e5([r17()], O19.prototype, "draped", void 0), e5([r17()], O19.prototype, "multipassEnabled", void 0), e5([r17()], O19.prototype, "cullAboveGround", void 0), e5([r17({
  constValue: false
})], O19.prototype, "occlusionPass", void 0), e5([r17({
  constValue: c14.Water
})], O19.prototype, "pbrMode", void 0), e5([r17({
  constValue: true
})], O19.prototype, "useCustomDTRExponentForWater", void 0), e5([r17({
  constValue: true
})], O19.prototype, "highStepCount", void 0), e5([r17({
  constValue: false
})], O19.prototype, "useFillLights", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/WaterGLMaterial.js
var s32 = class extends t15 {
  _updateShadowState(e43) {
    e43.shadowMap.enabled !== this._material.parameters.receiveShadows && this._material.setParameters({
      receiveShadows: e43.shadowMap.enabled
    });
  }
  _updateSSRState(e43) {
    const t31 = null != e43.ssr.lastFrameColor;
    t31 !== this._material.parameters.hasScreenSpaceReflections && this._material.setParameters({
      hasScreenSpaceReflections: t31
    });
  }
  _updateCloudsReflectionState(e43) {
    const t31 = null != e43.cloudsFade.data;
    t31 !== this._material.parameters.hasCloudsReflections && this._material.setParameters({
      hasCloudsReflections: t31
    });
  }
  ensureResources(e43) {
    return this._techniques.constructionContext.waterTextures.ensureResources(e43);
  }
  beginSlot(t31) {
    return this._output === o7.Color && (this._updateShadowState(t31), this._updateSSRState(t31), this._updateCloudsReflectionState(t31)), this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters), this.ensureTechnique(T9, t31);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/WaterMaterial.js
var _15 = class extends e29 {
  constructor(e43) {
    super(e43, new S18()), this._configuration = new O19(), this._animation = new e26(), this.produces = /* @__PURE__ */ new Map([[E6.OPAQUE_MATERIAL, (e44) => i3(e44) && !this.parameters.transparent || h6(e44)], [E6.TRANSPARENT_MATERIAL, (e44) => i3(e44) && this.parameters.transparent || h6(e44)], [E6.DRAPED_MATERIAL, (e44) => this.parameters.draped && e44 === o7.Color || h6(e44)], [E6.DRAPED_WATER, (e44) => e44 === o7.Normal]]);
  }
  getConfiguration(e43, t31) {
    return this._configuration.output = e43, this._configuration.writeDepth = true, this._configuration.receiveShadows = this.parameters.receiveShadows, this._configuration.hasSlicePlane = this.parameters.hasSlicePlane, this._configuration.transparent = this.parameters.transparent, this._configuration.hasScreenSpaceReflections = this.parameters.hasScreenSpaceReflections, this._configuration.hasCloudsReflections = this.parameters.hasCloudsReflections, this._configuration.draped = this.parameters.draped, this._configuration.transparencyPassType = t31.transparencyPassType, this._configuration.enableOffset = t31.camera.relativeElevation < E5, this._configuration.multipassEnabled = t31.multipassEnabled, this._configuration.cullAboveGround = t31.multipassTerrain.cullAboveGround, this._configuration;
  }
  update(t31) {
    const r39 = Math.min(t31.camera.relativeElevation, t31.camera.distance);
    this._animation.enabled = Math.sqrt(this.parameters.waveTextureRepeat / this.parameters.waveStrength) * r39 < v12;
    const a30 = this._animation.advance(t31);
    return this.setParameters({
      timeElapsed: u3(this._animation.time) * this.parameters.animationSpeed
    }, false), this._animation.enabled && a30;
  }
  createGLMaterial(e43) {
    return new s32(e43);
  }
  createBufferWriter() {
    return new r13(has("enable-feature:objectAndLayerId-rendering") ? I6 : f10);
  }
  get test() {
  }
};
var S18 = class extends u14 {
  constructor() {
    super(...arguments), this.waveStrength = 0.06, this.waveTextureRepeat = 32, this.waveDirection = r7(1, 0), this.waveVelocity = 0.05, this.flowStrength = 0.015, this.flowOffset = -0.5, this.animationSpeed = 0.35, this.timeElapsed = 0, this.color = r5(0, 0, 0, 0), this.transparent = true, this.hasSlicePlane = false, this.draped = false, this.receiveShadows = true, this.hasScreenSpaceReflections = false, this.hasCloudsReflections = false, this.origin = n2(), this.modelTransformation = null;
  }
};
var v12 = 35e3;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/waterMaterialUtils.js
var e42 = {
  "calm-small": {
    waveStrength: 5e-3,
    perturbationStrength: 0.02,
    textureRepeat: 12,
    waveVelocity: 0.01
  },
  "rippled-small": {
    waveStrength: 0.02,
    perturbationStrength: 0.09,
    textureRepeat: 32,
    waveVelocity: 0.07
  },
  "slight-small": {
    waveStrength: 0.05,
    perturbationStrength: 0.07,
    textureRepeat: 28,
    waveVelocity: 0.1
  },
  "moderate-small": {
    waveStrength: 0.075,
    perturbationStrength: 0.07,
    textureRepeat: 24,
    waveVelocity: 0.1
  },
  "calm-medium": {
    waveStrength: 3125e-6,
    perturbationStrength: 0.01,
    textureRepeat: 8,
    waveVelocity: 0.02
  },
  "rippled-medium": {
    waveStrength: 0.035,
    perturbationStrength: 0.015,
    textureRepeat: 12,
    waveVelocity: 0.07
  },
  "slight-medium": {
    waveStrength: 0.06,
    perturbationStrength: 0.015,
    textureRepeat: 8,
    waveVelocity: 0.12
  },
  "moderate-medium": {
    waveStrength: 0.09,
    perturbationStrength: 0.03,
    textureRepeat: 4,
    waveVelocity: 0.12
  },
  "calm-large": {
    waveStrength: 0.01,
    perturbationStrength: 0,
    textureRepeat: 4,
    waveVelocity: 0.05
  },
  "rippled-large": {
    waveStrength: 0.025,
    perturbationStrength: 0.01,
    textureRepeat: 8,
    waveVelocity: 0.11
  },
  "slight-large": {
    waveStrength: 0.06,
    perturbationStrength: 0.02,
    textureRepeat: 3,
    waveVelocity: 0.13
  },
  "moderate-large": {
    waveStrength: 0.14,
    perturbationStrength: 0.03,
    textureRepeat: 2,
    waveVelocity: 0.15
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DWaterSymbolLayer.js
var I16 = ["polyline", "polygon", "extent"];
var B6 = class _B extends y6 {
  constructor(e43, t31, r39, o27) {
    super(e43, t31, r39, o27);
  }
  doLoad() {
    return __async(this, null, function* () {
    });
  }
  destroy() {
    super.destroy(), this._context.stage.remove(this._materials[0]), this._materials.length = 0;
  }
  createGraphics3DGraphic(e43) {
    const t31 = e43.graphic;
    if (!this._validateGeometry(t31.geometry, I16, this.symbolLayer.type)) return null;
    const r39 = this.setGraphicElevationContext(t31);
    return this.ensureDrapedStatus("on-the-ground" === r39.mode), this.ensureMaterial(), this.draped ? this._createAsOverlay(t31) : this._createAs3DShape(t31, r39, t31.uid);
  }
  ensureMaterial() {
    if (this._materials[0]) return;
    const t31 = new S18(), r39 = this.symbolLayer.color;
    null != r39 && (t31.color = u9.toUnitRGBA(r39));
    const o27 = this._getCombinedOpacity(r39, {
      hasIntrinsicColor: true
    });
    t31.color = [t31.color[0], t31.color[1], t31.color[2], o27], t31.transparent = o27 < 1 || this.needsDrivenTransparentPass, t31.waveDirection = null != this.symbolLayer.waveDirection ? _B.headingVectorFromAngle(this.symbolLayer.waveDirection) : r7(0, 0);
    const n28 = this.symbolLayer.waveStrength + "-" + this.symbolLayer.waterbodySize, s33 = e42[n28];
    t31.waveStrength = s33.waveStrength, t31.waveTextureRepeat = s33.textureRepeat, t31.waveVelocity = s33.waveVelocity, t31.flowStrength = s33.perturbationStrength, t31.hasSlicePlane = this._context.slicePlaneEnabled, t31.draped = this.draped, this._materials[0] = new _15(t31), this._context.stage.add(this._materials[0]);
  }
  layerOpacityChanged() {
    if (null == this._materials[0]) return;
    const e43 = this._materials[0].parameters.color, t31 = this._getCombinedOpacity(this.symbolLayer.color, {
      hasIntrinsicColor: true
    }), r39 = t31 < 1 || this.needsDrivenTransparentPass;
    this._materials[0].setParameters({
      color: [e43[0], e43[1], e43[2], t31],
      transparent: r39
    });
  }
  layerElevationInfoChanged(e43, t31, r39) {
    const o27 = this._elevationContext.mode, i20 = m9(_B.elevationModeChangeTypes, r39, o27);
    if (i20 !== b6.UPDATE) return i20;
    const n28 = d7(o27);
    return this.updateGraphics3DGraphicElevationInfo(e43, t31, () => n28);
  }
  slicePlaneEnabledChanged() {
    return this._materials[0]?.setParameters({
      hasSlicePlane: this._context.slicePlaneEnabled
    }), true;
  }
  physicalBasedRenderingChanged() {
    return true;
  }
  _createAs3DShape(e43, t31, r39) {
    const o27 = b12(e43.geometry);
    if (null == o27) return null;
    const i20 = p17(o27, this._context.elevationProvider, this._context.renderCoordsHelper, t31), n28 = i20.position.length / 3, s33 = t12(2 * n28);
    U9(s33, i20.mapPositions, n28, this._context.elevationProvider.spatialReference);
    const a30 = new k9(i20, s33, this._context.layer.uid, e43.uid);
    if (a30.objectAndLayerIdColor = this._context.stage.renderView?.getObjectAndLayerIdColor(a30), this._create3DShapeGeometries(a30), this._logGeometryCreationWarnings(a30.renderData, o27.rings, "rings", "WaterSymbol3DLayer"), 0 === a30.outGeometries.length) return null;
    const l35 = new O10({
      geometries: a30.outGeometries,
      castShadow: false,
      layerUid: this._context.layer.uid,
      graphicUid: r39
    }), c33 = new p12(this, l35, a30.outGeometries, null, null, u18, t31);
    return c33.alignedSampledElevation = a30.renderData.sampledElevation, c33.needsElevationUpdates = d7(t31.mode), c33;
  }
  _create3DShapeGeometries(e43) {
    const t31 = e43.renderData.polygons, o27 = e43.uvCoords;
    for (const {
      count: i20,
      index: n28,
      position: s33,
      mapPositions: a30,
      holeIndices: l35
    } of t31) {
      if (null != this._context.clippingExtent && (P2(V12), c3(V12, a30), !V(V12, this._context.clippingExtent))) continue;
      const t32 = i6(a30, l35, 3);
      if (0 === t32.length) continue;
      const p23 = a10(o27, 2 * n28, 2 * i20), u32 = l26({
        material: this._materials[0],
        indices: t32,
        mapPositions: a30,
        attributeData: {
          position: s33,
          uv0: p23
        }
      }, e43.objectAndLayerIdColor);
      e43.outGeometries.push(u32);
    }
  }
  _createAsOverlay(e43) {
    const t31 = b12(e43.geometry);
    if (null == t31) return null;
    this._materials[0].renderPriority = this._renderPriority;
    const r39 = c24(t31, this._context.overlaySR), o27 = r39.position.length / 3, i20 = t12(2 * o27);
    U9(i20, r39.position, o27, this._context.overlaySR);
    const n28 = new F11(r39, i20, this._context.layer.uid, e43.uid);
    return n28.objectAndLayerIdColor = this._context.stage.renderView?.getObjectAndLayerIdColor(n28), n28.outBoundingBox = P2(), this._createAsOverlayWater(n28), this._logGeometryCreationWarnings(n28.renderData, t31.rings, "rings", "WaterSymbol3DLayer"), 0 === n28.outGeometries.length ? null : new l28(this, n28.outGeometries, n28.outBoundingBox, this._context.drapeSourceRenderer);
  }
  _createAsOverlayWater(e43) {
    const t31 = e43.uvCoords, o27 = e43.renderData.polygons;
    for (const {
      position: i20,
      holeIndices: n28,
      index: s33,
      count: a30
    } of o27) {
      if (P2(V12), c3(V12, i20), !V(V12, this._context.clippingExtent)) continue;
      o3(e43.outBoundingBox, V12);
      const o28 = i6(i20, n28, 3);
      if (0 === o28.length) continue;
      const l35 = a10(t31, 2 * s33, 2 * a30), u32 = l26({
        material: this._materials[0],
        indices: o28,
        attributeData: {
          position: i20,
          uv0: l35
        }
      }, e43.objectAndLayerIdColor);
      e43.outGeometries.push(new m8(u32, e43));
    }
  }
  static headingVectorFromAngle(e43) {
    const t31 = n10(), r39 = u4(e43);
    return t31[0] = Math.sin(r39), t31[1] = Math.cos(r39), t31;
  }
  test() {
    return __spreadProps(__spreadValues({}, super.test()), {
      create3DShape: (e43) => this._createAs3DShape(e43.graphic, e43.elevationContext, e43.graphicUid),
      ensureMaterial: () => this.ensureMaterial()
    });
  }
};
function U9(e43, r39, i20, n28) {
  const a30 = W(n28);
  D(W8);
  for (let t31 = 0; t31 < i20; t31++) o9(z9, r39[3 * t31], r39[3 * t31 + 1]), f3(W8, z9);
  m3(W8, W8, a30);
  const l35 = W8[0] % B6.unitSizeOfTexture, c33 = W8[1] % B6.unitSizeOfTexture;
  M7[0] = W8[0] - l35, M7[1] = W8[1] - c33;
  for (let t31 = 0; t31 < i20; t31++) e43[2 * t31] = (r39[3 * t31] * a30 - M7[0]) / B6.unitSizeOfTexture, e43[2 * t31 + 1] = (r39[3 * t31 + 1] * a30 - M7[1]) / B6.unitSizeOfTexture;
}
B6.unitSizeOfTexture = 100, B6.elevationModeChangeTypes = {
  definedChanged: b6.RECREATE,
  staysOnTheGround: b6.NONE,
  onTheGroundChanged: b6.RECREATE
};
var M7 = n10();
var W8 = u7();
var z9 = n10();
var V12 = i();
var k9 = class extends g10 {
  constructor(e43, t31, r39, o27) {
    super(e43, r39, o27), this.uvCoords = t31;
  }
};
var F11 = class extends g10 {
  constructor(e43, t31, r39, o27) {
    super(e43, r39, o27), this.uvCoords = t31;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbolLayerFactory.js
function c31(o27, e43, t31, i20) {
  const m22 = h21[o27.type]?.[e43.type] || l34[e43.type];
  return m22 ? new m22(o27, e43, t31, i20) : (n.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make", `unknown symbol type ${e43.type}`), null);
}
var l34 = {
  icon: he,
  object: pe2,
  line: O15,
  path: te3,
  fill: N4,
  extrude: et,
  text: H5,
  water: B6
};
var h21 = {
  "mesh-3d": {
    fill: Ne
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DSymbol.js
var c32 = class extends r25 {
  set symbol(t31) {
    this._symbol = t31, t31.symbolLayers.forEach((e43, r39) => {
      const s33 = this.symbolLayers[r39];
      null != s33 && (s33.symbol = t31, s33.symbolLayer = e43);
    });
  }
  get symbol() {
    return this._symbol;
  }
  constructor(t31, e43, r39) {
    super(e43.schedule), this._symbol = t31, this._context = e43, this._backgroundLayers = r39, this._destroyed = false, this.symbolLayers = new Array(), this.referenced = 0, this._extentPadding = 0;
  }
  doLoad(t31) {
    return __async(this, null, function* () {
      let o27 = this._symbol.symbolLayers;
      this._extentPadding = 0, this._backgroundLayers && (o27 = this._backgroundLayers.concat(o27));
      const a30 = o27.length;
      for (; this.symbolLayers.length < o27.length; ) this.symbolLayers.push(null);
      this.symbolLayers.length = o27.length;
      const i20 = [];
      for (let e43 = 0; e43 < a30; e43++) {
        const s33 = o27.at(e43);
        if (false === s33.enabled) continue;
        p22.renderPriority = 1 - (1 + e43) / a30, p22.renderPriorityStep = 1 / a30, p22.ignoreDrivers = s33.ignoreDrivers;
        const n28 = c31(this.symbol, s33, this._context, p22), y12 = w(t31, () => {
          this.symbolLayers[e43] = null, n28.destroy();
        });
        y12 && i20.push(y12), this.symbolLayers[e43] = n28;
      }
      if (yield a4(this.symbolLayers, (t32, e43) => __async(this, null, function* () {
        if (null != t32) try {
          yield t32.load(), this._extentPadding += Math.max(this._extentPadding, t32.extentPadding);
        } catch {
          this.symbolLayers[e43] = null;
        }
      })), i20.forEach((t32) => t32.remove()), s3(t31), this.symbolLayers.length && !this.symbolLayers.some((t32) => !!t32)) throw new Error();
    });
  }
  getSymbolLayerSize(t31) {
    const e43 = this.symbolLayers[t31];
    return null != e43 ? e43.getCachedSize() : null;
  }
  get extentPadding() {
    return this._extentPadding;
  }
  get symbologySnappingSupported() {
    return this.symbolLayers.some((t31) => t31?.queryForSnapping);
  }
  createGraphics3DGraphic(t31, e43) {
    const r39 = t31.graphic, s33 = this.symbolLayers.map((e44) => e44?.createGraphics3DGraphic(t31) ?? null), o27 = this._context.arcade || this._context.featureExpressionInfoContext?.arcade?.modules || null;
    return new A9(r39, e43 || this, s33, t31.layer, o27);
  }
  get complexity() {
    return F5(this.symbolLayers.map((t31) => null != t31 ? t31.complexity : null));
  }
  globalPropertyChanged(t31, e43) {
    const r39 = this.symbolLayers.length;
    for (let s33 = 0; s33 < r39; s33++) {
      const r40 = this.symbolLayers[s33], o27 = (t32) => {
        const e44 = t32.layers[s33];
        return e44 instanceof p12 ? e44 : null;
      };
      if (null != r40 && !r40.globalPropertyChanged(t31, e43, o27)) return false;
    }
    return true;
  }
  applyRendererDiff(t31, e43) {
    return this.loadStatus !== l21.LOADED ? e33.RecreateSymbol : this.symbolLayers.reduce((r39, s33) => r39 !== e33.RecreateSymbol && null != s33 ? Math.min(r39, s33.applyRendererDiff(t31, e43)) : r39, e33.FastUpdate);
  }
  prepareSymbolPatch(t31) {
    if (this.loadStatus === l21.FAILED) return;
    if ("partial" !== t31.diff.type) return;
    const e43 = t31.diff.diff;
    if (!e43.symbolLayers || "partial" !== e43.symbolLayers.type) return;
    const r39 = e43.symbolLayers.diff;
    this.symbolLayers.forEach((e44, s33) => {
      if (null == e44) return;
      const o27 = r39[s33];
      if (o27) {
        const r40 = {
          diff: o27,
          graphics3DGraphicPatches: [],
          symbolLayerStatePatches: []
        };
        e44.prepareSymbolLayerPatch(r40), t31.symbolStatePatches.push(...r40.symbolLayerStatePatches), r40.graphics3DGraphicPatches.length && t31.graphics3DGraphicPatches.push((t32, e45) => {
          const o28 = t32.layers[s33];
          null != o28 && r40.graphics3DGraphicPatches.forEach((t33) => t33(o28, e45));
        });
      }
    });
  }
  updateGeometry(t31, e43) {
    return this._updateGeometryOrTransform(t31, (t32, r39) => t32.updateGeometry(r39, e43));
  }
  updateTransform(t31, e43, r39, s33) {
    return this._updateGeometryOrTransform(t31, (t32, o27) => t32.updateTransform(o27, e43, r39, s33));
  }
  _updateGeometryOrTransform(t31, e43) {
    for (let r39 = 0; r39 < this.symbolLayers.length; r39++) {
      const s33 = this.symbolLayers[r39];
      if (null == s33) continue;
      const o27 = t31.layers[r39];
      if (!o27 || !e43(s33, o27)) return false;
    }
    return true;
  }
  onRemoveGraphic(t31) {
    for (let e43 = 0; e43 < this.symbolLayers.length; e43++) {
      const r39 = this.symbolLayers[e43];
      if (null == r39) continue;
      const s33 = t31.layers[e43];
      null != s33 && r39.onRemoveGraphic(s33);
    }
  }
  getFastUpdateStatus() {
    let t31 = 0, e43 = 0, r39 = 0;
    return this.symbolLayers.forEach((s33) => {
      null != s33 && (s33.loadStatus === l21.LOADING ? t31++ : s33.isFastUpdatesEnabled() ? r39++ : e43++);
    }), {
      loading: t31,
      slow: e43,
      fast: r39
    };
  }
  queryForSnapping(e43, r39, o27, a30) {
    return __async(this, null, function* () {
      const i20 = this.symbolLayers.filter(O).filter((t31) => null != t31.queryForSnapping).map((t31) => t31.queryForSnapping(e43, r39, o27, a30)), n28 = yield Promise.all(i20);
      return s3(a30), n28.flat();
    });
  }
  destroy() {
    if (!this.destroyed) {
      super.destroy();
      for (const t31 of this.symbolLayers) null != t31 && t31.destroy();
      this.symbolLayers.length = 0, this._destroyed = true;
    }
  }
  get destroyed() {
    return this._destroyed;
  }
};
var p22 = new s27();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DWebStyleSymbol.js
var i19 = class extends r25 {
  constructor(t31, r39, s33) {
    super(r39), this.symbol = t31, this._convert = s33, this.symbologySnappingSupported = false, this.graphics3DSymbol = null, this.referenced = 0;
  }
  getSymbolLayerSize(t31) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.getSymbolLayerSize(t31) : null;
  }
  get symbolLayers() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.symbolLayers : [];
  }
  get extentPadding() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.extentPadding : 0;
  }
  doLoad(t31) {
    return __async(this, null, function* () {
      const r39 = yield this.symbol.fetchSymbol({
        signal: t31
      });
      r39.id = this.symbol.id, this.graphics3DSymbol = this._convert(r39), null != this.graphics3DSymbol && (yield this.graphics3DSymbol.load());
    });
  }
  createGraphics3DGraphic(t31) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.createGraphics3DGraphic(t31, this) : null;
  }
  get complexity() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.complexity : l20;
  }
  globalPropertyChanged(t31, r39) {
    return null != this.graphics3DSymbol && this.graphics3DSymbol.globalPropertyChanged(t31, r39);
  }
  applyRendererDiff(t31, s33) {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.applyRendererDiff(t31, s33) : e33.RecreateSymbol;
  }
  prepareSymbolPatch(t31) {
    null != this.graphics3DSymbol && this.graphics3DSymbol.prepareSymbolPatch(t31);
  }
  updateGeometry(t31, r39) {
    return null != this.graphics3DSymbol && this.graphics3DSymbol.updateGeometry(t31, r39);
  }
  updateTransform(t31, r39, s33, i20) {
    return this.graphics3DSymbol?.updateTransform(t31, r39, s33, i20) ?? false;
  }
  onRemoveGraphic() {
  }
  getFastUpdateStatus() {
    return null != this.graphics3DSymbol ? this.graphics3DSymbol.getFastUpdateStatus() : {
      loading: 1,
      fast: 0,
      slow: 0
    };
  }
  destroy() {
    null != this.graphics3DSymbol && this.graphics3DSymbol.destroy(), this.graphics3DSymbol = void 0, super.destroy();
  }
  get destroyed() {
    return void 0 === this.graphics3DSymbol;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/intersectionUtils.js
function g16(r39, n28, t31, i20) {
  return h22(r39, n28, t31, v13(i20, n28, t31, true));
}
function j17(r39, c33, o27, u32) {
  const f26 = P(o27, e8(r39, u32, c33));
  return u5(r39, c33, g(r39, o27, f26));
}
var b17 = {
  dir: n2(),
  len: 0,
  clip: n10()
};
function v13(r39, n28, i20, f26) {
  const l35 = b17;
  return r39 ? (i20 && f26 && (l35.len = x(n28, i20)), r4(l35.dir, r39)) : f26 ? (l35.len = x(n28, i20), e8(l35.dir, i20, n28), g(l35.dir, l35.dir, 1 / l35.len)) : (e8(l35.dir, i20, n28), z(l35.dir, l35.dir)), l35;
}
function x11(r39, t31, i20) {
  const e43 = P(F2(r39), i20.dir), c33 = -V3(r39, t31);
  if (c33 < 0 && e43 >= 0) return false;
  if (e43 > -1e-6 && e43 < 1e-6) return c33 > 0;
  if ((c33 < 0 || e43 < 0) && !(c33 < 0 && e43 < 0)) return true;
  const o27 = c33 / e43;
  return e43 > 0 ? o27 < i20.clip[1] && (i20.clip[1] = o27) : o27 > i20.clip[0] && (i20.clip[0] = o27), i20.clip[0] <= i20.clip[1];
}
function h22(r39, n28, t31, i20) {
  i20.clip[0] = 0, i20.clip[1] = t31 ? i20.len : Number.MAX_VALUE;
  for (let e43 = 0; e43 < r39.length; e43++) if (!x11(r39[e43], n28, i20)) return false;
  return true;
}

// ../../../node_modules/@arcgis/core/views/3d/support/FrustumExtentIntersection.js
var M8 = 0.5 * Math.PI;
var F12 = M8 / Math.PI * 180;
var N5 = class {
  constructor(t31) {
    this._renderCoordsHelper = t31.renderCoordsHelper, this._extent = new Array(4), this._planes = new Array(6), this._maxSpan = 0, this._center = {
      origin: n2(),
      direction: n2()
    };
    for (let e43 = 0; e43 < 4; e43++) this._extent[e43] = {
      origin: n2(),
      direction: n2(),
      cap: {
        next: null,
        direction: n2()
      }
    }, this._planes[e43] = E2();
    this._planes[j9.NEAR] = E2(), this._planes[j9.FAR] = E2(), this._planesWithoutFar = this._planes.slice(0, 5);
  }
  update(t31, e43, i20, r39 = true) {
    const a30 = this._extent;
    this._toRenderBoundingExtent(t31, e43, i20), u5(this._center.origin, a30[0].origin, a30[2].origin), g(this._center.origin, this._center.origin, 0.5), this._renderCoordsHelper.worldUpAtPosition(this._center.origin, this._center.direction), r39 || g(this._center.direction, this._center.direction, -1);
    for (let n28 = 0; n28 < 4; n28++) {
      const t32 = a30[n28];
      this._renderCoordsHelper.worldUpAtPosition(t32.origin, t32.direction);
      const e44 = a30[3 === n28 ? 0 : n28 + 1];
      t32.cap.next = e44.origin, J(t32.cap.direction, t32.origin, e44.origin), U(t32.direction, t32.cap.direction, t32.origin, this._planes[n28]), r39 || g(t32.direction, t32.direction, -1);
    }
    U(a30[0].cap.direction, a30[1].cap.direction, a30[0].origin, this._planes[j9.NEAR]), r39 ? q3(this._planes[j9.NEAR], this._planes[j9.FAR]) : (A4(this._planes[j9.FAR], this._planes[j9.NEAR]), q3(this._planes[j9.NEAR], this._planes[j9.NEAR])), this._maxSpan = Math.max(Math.abs(t31[0] - t31[2]), Math.abs(t31[1] - t31[3])), this._maxSpanSpatialReference = e43, this._minGlobalAltitude = 0.9 * s4(this._maxSpanSpatialReference).radius;
  }
  isVisibleInFrustum(t31, e43, i20 = false) {
    if (null == t31) return false;
    if (this._renderCoordsHelper.viewingMode === l8.Global) {
      const i21 = this._maxSpanSpatialReference.isGeographic ? F12 : M8 * e43;
      if (this._maxSpan > i21) return true;
      if (null != t31.altitude && t31.altitude >= this._minGlobalAltitude) return this._isVisibleInFrustumGlobal(t31);
    }
    if (0 === this._maxSpan) {
      const e44 = this._extent[0];
      return !(i20 || !t31.intersectsRay(l7(e44.origin, e44.direction)));
    }
    for (let n28 = 0; n28 < this._extent.length; n28++) {
      const e44 = this._extent[n28];
      if (!i20 && t31.intersectsRay(l7(e44.origin, e44.direction))) return true;
      if (t31.intersectsLineSegment(h8(e44.origin, e44.cap.next, k10), e44.cap.direction)) return true;
    }
    const r39 = i20 ? this._planes : this._planesWithoutFar;
    for (let n28 = 0; n28 < t31.lines.length; n28++) {
      const e44 = t31.lines[n28];
      if (g16(r39, e44.origin, e44.endpoint, e44.direction)) return true;
    }
    return false;
  }
  _toRenderBoundingExtentGlobal(t31, r39, n28) {
    const o27 = 5;
    p2(t31, V13), V13[2] = n28, u10(r39, V13, v14, this._renderCoordsHelper.spatialReference), h4(I17, v14), P2(L9);
    for (const {
      x0: i20,
      x1: s33,
      y0: c33,
      y1: l35
    } of U10) for (let p23 = 0; p23 < o27; p23++) {
      const h23 = p23 / (o27 - 1);
      V13[0] = f2(t31[i20], t31[s33], h23), V13[1] = f2(t31[c33], t31[l35], h23), V13[2] = n28, n9(V13, r39, V13, this._renderCoordsHelper.spatialReference), O3(V13, V13, I17), h3(L9, V13);
    }
    o2(this._extent[0].origin, L9[0], L9[1], L9[2]), o2(this._extent[1].origin, L9[3], L9[1], L9[2]), o2(this._extent[2].origin, L9[3], L9[4], L9[2]), o2(this._extent[3].origin, L9[0], L9[4], L9[2]);
    for (let e43 = 0; e43 < 4; ++e43) O3(this._extent[e43].origin, this._extent[e43].origin, v14);
  }
  _toRenderBoundingExtentLocal(t31, e43, i20) {
    i10(t31, e43, P9, this._renderCoordsHelper.spatialReference), o2(this._extent[0].origin, P9[0], P9[1], i20), o2(this._extent[1].origin, P9[2], P9[1], i20), o2(this._extent[2].origin, P9[2], P9[3], i20), o2(this._extent[3].origin, P9[0], P9[3], i20);
  }
  _toRenderBoundingExtent(e43, i20, r39) {
    switch (this._renderCoordsHelper.viewingMode) {
      case l8.Global:
        this._toRenderBoundingExtentGlobal(e43, i20, r39);
        break;
      case l8.Local:
        this._toRenderBoundingExtentLocal(e43, i20, r39);
        break;
      default:
        n6(this._renderCoordsHelper.viewingMode);
    }
  }
  _isVisibleInFrustumGlobal(t31) {
    if (V3(t31.planes[j9.NEAR], this._center.origin) < 0 && P(this._center.direction, t31.direction) < 0) return true;
    for (let e43 = 0; e43 < 4; e43++) {
      const i20 = this._extent[e43];
      if (V3(t31.planes[j9.NEAR], i20.origin) < 0 && P(i20.direction, t31.direction) < 0) return true;
    }
    return false;
  }
};
var U10 = [{
  x0: 0,
  y0: 1,
  x1: 2,
  y1: 1
}, {
  x0: 0,
  y0: 3,
  x1: 2,
  y1: 3
}, {
  x0: 0,
  y0: 1,
  x1: 0,
  y1: 3
}, {
  x0: 2,
  y0: 1,
  x1: 2,
  y1: 3
}];
var V13 = n2();
var v14 = e12();
var I17 = e12();
var L9 = i();
var P9 = u7();
var k10 = v3();

export {
  m11 as m,
  d12 as d,
  l18 as l,
  a16 as a,
  L5 as L,
  A7 as A,
  r22 as r,
  e36 as e,
  e33 as e2,
  l21 as l2,
  G6 as G,
  S11 as S,
  e34 as e3,
  i13 as i,
  l22 as l3,
  r27 as r2,
  c21 as c,
  s24 as s,
  r29 as r3,
  f17 as f,
  a23 as a2,
  l24 as l4,
  i15 as i2,
  r30 as r4,
  s26 as s2,
  v7 as v,
  c32 as c2,
  i19 as i3,
  j17 as j,
  N5 as N
};
//# sourceMappingURL=chunk-PPMYY5TL.js.map
