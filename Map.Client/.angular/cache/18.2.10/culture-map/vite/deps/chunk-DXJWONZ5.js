import {
  I as I11,
  O as O14,
  S as S11,
  z as z8
} from "./chunk-JF6YDQ2P.js";
import {
  t as t44
} from "./chunk-NZE6NI7O.js";
import {
  t as t43
} from "./chunk-R5TKJUPW.js";
import {
  a as a27,
  b as b7,
  i as i22,
  p as p18
} from "./chunk-MFO6JQK6.js";
import {
  r as r36
} from "./chunk-ZPAFBEE7.js";
import {
  x as x8
} from "./chunk-UAJWZMIJ.js";
import {
  f as f23
} from "./chunk-2TI7BB35.js";
import {
  s as s37
} from "./chunk-7VHQSCRN.js";
import {
  c as c23,
  l as l22
} from "./chunk-OEHDMT4P.js";
import {
  i as i26,
  t as t45
} from "./chunk-HW3L4VAK.js";
import {
  c as c24,
  s as s38
} from "./chunk-7E55V6Q7.js";
import {
  f as f24,
  p as p20
} from "./chunk-TPDHAOY6.js";
import {
  r as r37
} from "./chunk-JSBFNTSJ.js";
import {
  g as g12,
  h as h14
} from "./chunk-GICNYLA4.js";
import {
  g as g11,
  l as l21
} from "./chunk-V2F5C2UG.js";
import {
  d as d15
} from "./chunk-VNEQYYJH.js";
import {
  c as c22,
  d as d16
} from "./chunk-QCXSVD3K.js";
import {
  c as c21,
  n as n36,
  o as o38
} from "./chunk-ZELUSWEM.js";
import {
  D as D3
} from "./chunk-2TNHWHKB.js";
import {
  f as f22,
  w as w11
} from "./chunk-LGOPK4HF.js";
import {
  b as b8,
  e as e39,
  i as i23,
  s as s34,
  w as w10
} from "./chunk-YM3C5QII.js";
import {
  s as s35,
  s2 as s36,
  t as t41,
  v as v9
} from "./chunk-ITLE6RXP.js";
import {
  t as t40
} from "./chunk-XLUW354K.js";
import {
  b as b9,
  u as u19
} from "./chunk-ROAOM6N7.js";
import {
  h as h13,
  i as i24,
  p as p19,
  r as r35
} from "./chunk-CMQ4UJKJ.js";
import {
  A as A13,
  i as i25,
  t as t42
} from "./chunk-Z2YTTAW2.js";
import {
  f as f21
} from "./chunk-ZHNWVDWM.js";
import {
  dt,
  ht,
  lt as lt2
} from "./chunk-O6QYO3QA.js";
import {
  _ as _15,
  o as o37,
  q as q7
} from "./chunk-IIAGO3R6.js";
import {
  $,
  Ae,
  K as K4,
  N as N5,
  Pe,
  Q as Q3,
  Re,
  Z as Z2,
  _ as _11,
  ce,
  f as f14,
  g as g8,
  re,
  u as u11,
  u2 as u12,
  we
} from "./chunk-7VSW2U7Y.js";
import {
  c as c14
} from "./chunk-IVKE5IFG.js";
import {
  r as r28
} from "./chunk-T32ZZS7S.js";
import {
  C as C8
} from "./chunk-3J75CTGF.js";
import {
  F as F4,
  e as e38,
  n as n35,
  o as o36
} from "./chunk-4BJTCQKW.js";
import {
  a as a28,
  d as d14
} from "./chunk-XAGLWTE6.js";
import {
  f as f20
} from "./chunk-7W32T7KY.js";
import {
  e as e35,
  t as t38,
  z as z7
} from "./chunk-YFC23HKN.js";
import {
  O as O13,
  a as a26,
  e as e36,
  e2 as e37,
  o as o34,
  o2 as o35,
  t as t39
} from "./chunk-KBAXMVAM.js";
import {
  I as I10,
  L as L9,
  U as U8
} from "./chunk-ZP6PYGBR.js";
import {
  c as c20,
  o as o32,
  s as s33
} from "./chunk-AQH46KWJ.js";
import {
  o as o33
} from "./chunk-ILQLJ2ZA.js";
import {
  q as q4,
  v as v8,
  w as w8,
  z as z5
} from "./chunk-Z4AXZULQ.js";
import {
  I as I9,
  R as R5,
  S as S10,
  W as W4,
  _ as _14
} from "./chunk-WLZIKLQT.js";
import {
  e as e34
} from "./chunk-ISTWMT33.js";
import {
  s as s32,
  t as t37
} from "./chunk-VDJL72FK.js";
import {
  m as m23
} from "./chunk-SBMU7RBF.js";
import {
  f as f19,
  g as g10,
  p as p17
} from "./chunk-GN4ES4ZM.js";
import {
  V as V5
} from "./chunk-WB2PLZ2R.js";
import {
  d as d12
} from "./chunk-PA5PVFOE.js";
import {
  A as A11,
  E as E19,
  I as I7
} from "./chunk-XVYR2JNI.js";
import {
  o as o31
} from "./chunk-6HNAQ6T3.js";
import {
  O as O12,
  a as a25,
  d as d13,
  h as h12,
  i as i21,
  l as l20,
  m as m21,
  m2 as m22,
  n as n34,
  o as o29,
  o2 as o30,
  q as q6,
  r as r34,
  u as u18
} from "./chunk-5A6MLLPH.js";
import {
  A as A12,
  L as L8,
  N as N6,
  a as a23,
  j as j8
} from "./chunk-PPMYY5TL.js";
import {
  u as u14
} from "./chunk-ONNA6736.js";
import {
  e as e33
} from "./chunk-UAMCUBIO.js";
import {
  i as i16
} from "./chunk-PR6QK2UX.js";
import {
  $ as $3,
  G as G8,
  S as S9,
  c as c19,
  l as l19,
  m as m19,
  m2 as m20,
  n as n33,
  r as r31,
  r2 as r33,
  s as s30,
  s2 as s31,
  se
} from "./chunk-NEPAFG4J.js";
import {
  _ as _13,
  t as t32
} from "./chunk-E7VVOB2F.js";
import {
  G as G7,
  P as P7
} from "./chunk-DOYOAB3G.js";
import {
  c as c17,
  f as f17,
  h as h11,
  l as l17,
  n as n29,
  o as o27,
  o2 as o28
} from "./chunk-DDIAZD6H.js";
import {
  Q as Q5,
  t as t36
} from "./chunk-7YXVUZL6.js";
import {
  a as a21
} from "./chunk-TKHURHLF.js";
import {
  it,
  n as n28,
  r as r30,
  s as s29,
  t as t33
} from "./chunk-UW23RIEM.js";
import {
  n as n32
} from "./chunk-R6CAUNOR.js";
import {
  r as r32
} from "./chunk-TMIIQZKR.js";
import {
  a as a24,
  c as c18,
  i as i20,
  l as l18,
  n as n31,
  t as t34,
  u as u16
} from "./chunk-ROVEMBDA.js";
import {
  E as E15,
  G as G6,
  T as T5,
  c as c13,
  e as e30,
  i as i17,
  o2 as o25
} from "./chunk-ZIDRXKSJ.js";
import {
  G as G5,
  W as W3,
  Z,
  ls,
  ps,
  us
} from "./chunk-DBK2ELNZ.js";
import {
  O as O11
} from "./chunk-VI6HLZLR.js";
import {
  p as p16
} from "./chunk-MYKOM3G6.js";
import {
  I as I8,
  n as n30,
  u as u15
} from "./chunk-6FZS4YUQ.js";
import {
  E as E18,
  I as I6,
  m as m18
} from "./chunk-GW7WMRYJ.js";
import {
  lt
} from "./chunk-O7OCS6XP.js";
import {
  C as C7
} from "./chunk-67LE7VNQ.js";
import {
  t as t35,
  u as u17
} from "./chunk-BJM7H6OC.js";
import {
  A as A10,
  E as E17,
  H as H7,
  O as O10
} from "./chunk-557LD7Q2.js";
import {
  c as c16
} from "./chunk-X5UPCJEP.js";
import {
  f as f18
} from "./chunk-2ONAF54K.js";
import {
  H as H4,
  H2 as H5,
  N as N4,
  a as a17,
  a2 as a18,
  e as e29,
  f as f13,
  i as i14,
  i2 as i15,
  l as l15,
  m as m15,
  o as o20,
  o2 as o24,
  p as p13,
  r2 as r25,
  r3 as r26,
  r4 as r27,
  s as s26,
  s2 as s27,
  t as t23,
  t2 as t27,
  t3 as t28,
  t5 as t29,
  u2 as u10,
  y as y7
} from "./chunk-INYEUJYL.js";
import {
  o as o22,
  r as r21
} from "./chunk-FLWLBYXO.js";
import {
  $ as $2,
  A as A9,
  B as B5,
  C as C6,
  E as E16,
  H as H6,
  J as J4,
  K as K5,
  L as L7,
  O as O9,
  P as P6,
  Q as Q4,
  S as S8,
  T as T6,
  U as U7,
  V as V4,
  X as X5,
  Y as Y4,
  Z as Z3,
  _ as _12,
  a as a22,
  b as b6,
  c as c15,
  d as d11,
  e as e32,
  f as f16,
  g as g9,
  h as h10,
  i as i18,
  i2 as i19,
  j as j7,
  k as k5,
  l as l16,
  m as m16,
  m2 as m17,
  n as n26,
  n2 as n27,
  nn,
  o as o26,
  p as p14,
  p2 as p15,
  q as q5,
  r as r29,
  s as s28,
  t as t31,
  tn,
  u as u13,
  v as v7,
  w as w9,
  x as x7,
  y as y9,
  z as z6
} from "./chunk-XVR4FEAF.js";
import {
  f as f15
} from "./chunk-NLEBYD5G.js";
import {
  t as t30
} from "./chunk-MOCGEINB.js";
import {
  e as e31
} from "./chunk-NSSWLGUQ.js";
import {
  e as e28,
  l as l14,
  r as r24,
  t as t26
} from "./chunk-K4UHA6L6.js";
import {
  r as r23,
  s as s25,
  u as u9
} from "./chunk-VDYOVDYI.js";
import {
  n as n23
} from "./chunk-IJVQCMOT.js";
import {
  s as s22,
  s2 as s24
} from "./chunk-RVQEQAAL.js";
import {
  M as M5,
  a as a19,
  n as n24,
  r as r22,
  w as w7
} from "./chunk-47UZMDGX.js";
import {
  n as n25,
  y as y8
} from "./chunk-VXS54B3Z.js";
import {
  a as a20,
  c as c12,
  s as s23,
  t as t24,
  t2 as t25
} from "./chunk-3FOAT37X.js";
import {
  _ as _10,
  d as d10,
  t2 as t22
} from "./chunk-2ERGO64O.js";
import {
  o as o21
} from "./chunk-RP2GKJCD.js";
import {
  m as m14
} from "./chunk-XTCHBO6P.js";
import {
  d as d9
} from "./chunk-NE4OJEWH.js";
import {
  E as E14
} from "./chunk-7DQI4OOA.js";
import {
  e as e27
} from "./chunk-T3454WZK.js";
import {
  o as o23
} from "./chunk-6YA72G7G.js";
import {
  e as e26
} from "./chunk-D3AKDIJC.js";
import {
  n as n22,
  p as p12
} from "./chunk-IM5W3NWZ.js";
import {
  s as s21
} from "./chunk-IIVUY2T7.js";
import {
  t as t21
} from "./chunk-R27BBJA3.js";
import {
  o as o19
} from "./chunk-ATQ5GYTB.js";
import {
  l as l13
} from "./chunk-5APMY2AQ.js";
import {
  A as A8
} from "./chunk-JA2C7MTO.js";
import {
  I as I5,
  L as L6,
  w as w6
} from "./chunk-7HBD4CJ3.js";
import {
  o as o15
} from "./chunk-WG5JLPNN.js";
import {
  S as S6
} from "./chunk-25PMMPR7.js";
import {
  E as E12
} from "./chunk-RASN5P76.js";
import {
  B as B4,
  g as g7,
  k as k4,
  m as m13,
  w as w5,
  x as x6,
  y as y5
} from "./chunk-5L3YXBNN.js";
import {
  A as A7
} from "./chunk-IFUKJDOU.js";
import {
  t as t17
} from "./chunk-LD5YIQXD.js";
import {
  t as t20
} from "./chunk-J7KF6IEI.js";
import {
  N as N3
} from "./chunk-GOKBAMCG.js";
import {
  n as n20
} from "./chunk-E3P3LIVT.js";
import {
  t as t15
} from "./chunk-HUX6Y26H.js";
import {
  t as t14
} from "./chunk-LN4EMOLP.js";
import {
  c as c10,
  y as y6
} from "./chunk-EKCE56CG.js";
import {
  c as c11,
  i as i13,
  r as r20
} from "./chunk-4TJAOUC3.js";
import {
  E as E13,
  R as R4
} from "./chunk-CILAEMQM.js";
import {
  h as h9
} from "./chunk-WRHEXEG3.js";
import {
  o as o18
} from "./chunk-TEOUFCJA.js";
import {
  c as c9
} from "./chunk-GTZOXRB5.js";
import {
  d as d7
} from "./chunk-PPMHRAOP.js";
import {
  r as r17,
  r2 as r18,
  t as t16
} from "./chunk-XGDLE7WK.js";
import {
  r as r19,
  t as t18
} from "./chunk-FHW2TG7X.js";
import {
  d as d8,
  e as e25,
  f as f12,
  h as h8,
  i as i12,
  n as n21
} from "./chunk-YAGNWBGU.js";
import {
  t as t19
} from "./chunk-DE6MQ5XE.js";
import {
  e as e24
} from "./chunk-LQTSBE7P.js";
import {
  O as O8
} from "./chunk-GCFUJXGH.js";
import {
  o as o16
} from "./chunk-VIIVMRRO.js";
import {
  S as S7,
  _ as _9,
  l as l12,
  o as o17,
  r as r16,
  s as s20
} from "./chunk-LKHUGH5W.js";
import {
  n as n19,
  s as s19
} from "./chunk-SLCHZ6DD.js";
import {
  p as p11,
  t as t13
} from "./chunk-CX4XTOUC.js";
import {
  l2 as l11,
  n2 as n18
} from "./chunk-L64P7DHA.js";
import {
  t as t12
} from "./chunk-EYYHTDAX.js";
import {
  N as N2,
  O as O7,
  a as a16,
  i as i11
} from "./chunk-ZVFENZUF.js";
import {
  s as s18
} from "./chunk-OHXCVJMH.js";
import {
  Y as Y3
} from "./chunk-N3S77FRG.js";
import {
  H as H3,
  N,
  b as b5,
  g as g6,
  j2 as j6,
  s as s17
} from "./chunk-YYETZJJB.js";
import {
  e as e23
} from "./chunk-VHERB2HE.js";
import {
  a as a15,
  i as i10
} from "./chunk-MPUFKSB2.js";
import {
  A as A6,
  E as E11,
  i as i9,
  s as s16
} from "./chunk-EXODD7PD.js";
import {
  c as c7
} from "./chunk-C7VF4AR2.js";
import {
  e as e20
} from "./chunk-3NGDRCQI.js";
import {
  c as c8,
  e as e21,
  e2 as e22
} from "./chunk-P7OSFLIX.js";
import {
  E as E10,
  _ as _8,
  i as i8,
  n as n17
} from "./chunk-ZDC4PV4Y.js";
import {
  o as o14,
  r as r15
} from "./chunk-DLRYNII2.js";
import {
  E as E8,
  m as m11
} from "./chunk-OCHDIAAK.js";
import {
  f as f11,
  s as s15
} from "./chunk-ENQEWBGS.js";
import {
  t as t8
} from "./chunk-66QAJ2MI.js";
import {
  t as t10
} from "./chunk-WN3YAMRZ.js";
import {
  H as H2
} from "./chunk-NWICVENM.js";
import {
  l as l10,
  t as t9
} from "./chunk-WU7FVYT7.js";
import {
  a as a14,
  s as s14
} from "./chunk-SYYDVGKY.js";
import {
  B as B3,
  C as C5,
  D as D2,
  E as E7,
  F as F3,
  G as G4,
  I as I4,
  L as L5,
  M as M4,
  O as O6,
  P as P5,
  R as R3,
  T as T4,
  U as U6,
  X as X4,
  _ as _7,
  f as f10,
  t as t7
} from "./chunk-YLE5AYZV.js";
import {
  t as t11
} from "./chunk-62WUYJJN.js";
import {
  r as r14
} from "./chunk-AWJPQWYU.js";
import {
  i as i7,
  x as x5
} from "./chunk-JNWMZ6EJ.js";
import {
  T as T3,
  e as e19,
  m as m10,
  o as o13,
  r as r13
} from "./chunk-VS26W5Y5.js";
import {
  E as E9
} from "./chunk-LM2N2I5R.js";
import {
  h as h7
} from "./chunk-PVO5NM6Q.js";
import {
  C as C4,
  F as F2,
  I as I3,
  g as g5,
  o as o12
} from "./chunk-YFQ32AQX.js";
import {
  I as I2
} from "./chunk-POQ3T5EH.js";
import {
  r as r12
} from "./chunk-DM4WHMQY.js";
import {
  R as R2
} from "./chunk-6MR4UDDL.js";
import {
  v as v6
} from "./chunk-N3IR233K.js";
import {
  m as m12
} from "./chunk-5YIMTGEC.js";
import {
  A as A5
} from "./chunk-3WQXHRJE.js";
import {
  C as C3
} from "./chunk-URWREU3E.js";
import {
  n as n12
} from "./chunk-L7ZKWTWL.js";
import {
  r as r9
} from "./chunk-3UOXF3CT.js";
import {
  n as n14,
  r as r10
} from "./chunk-WDDCGJTI.js";
import {
  a as a12
} from "./chunk-PA7WZX2U.js";
import {
  o as o9
} from "./chunk-WJKYGQOY.js";
import {
  n as n15
} from "./chunk-SZWWBMQN.js";
import {
  J as J3,
  L as L3,
  T as T2,
  V as V2,
  W as W2,
  X as X3,
  _ as _5,
  at,
  k as k2
} from "./chunk-ZE47C44H.js";
import {
  l as l8,
  m as m7
} from "./chunk-5GIS2C3K.js";
import {
  L as L4
} from "./chunk-7B5YPLFX.js";
import {
  s as s13
} from "./chunk-RDQF44TE.js";
import {
  a as a13,
  l as l9,
  o as o11
} from "./chunk-KKD7A2GN.js";
import {
  O as O4
} from "./chunk-ZWCV4HKG.js";
import {
  E as E6,
  F,
  O as O5,
  Q as Q2,
  S as S5,
  V as V3,
  _ as _6,
  b as b4,
  c as c6,
  f as f7,
  f2 as f8,
  j as j5,
  m as m8,
  q as q3,
  r as r8
} from "./chunk-N4KQPPPI.js";
import {
  k as k3,
  m as m9,
  p as p10,
  q as q2,
  v as v5
} from "./chunk-4OGGMTIH.js";
import {
  e as e17
} from "./chunk-NQVBBKAN.js";
import {
  E as E5
} from "./chunk-TCPN7AEH.js";
import {
  e as e18
} from "./chunk-4MMTPKY4.js";
import {
  a as a11,
  n as n13,
  r as r7
} from "./chunk-DY7FJHTG.js";
import {
  c as c5
} from "./chunk-Q4KYZS3X.js";
import {
  a as a10
} from "./chunk-VWML4J2J.js";
import {
  M as M3,
  f as f9,
  h as h6,
  i as i6,
  n as n16,
  o as o10,
  p as p9,
  r as r11,
  s as s12,
  u as u8
} from "./chunk-JYODC3YQ.js";
import {
  e as e15,
  o as o8,
  t as t6
} from "./chunk-BQZBOYBD.js";
import {
  e as e16
} from "./chunk-TYQXPPSP.js";
import {
  d as d6
} from "./chunk-HD65DNIO.js";
import {
  n as n10
} from "./chunk-N6TJI25E.js";
import {
  j2 as j4,
  w as w4,
  z as z3
} from "./chunk-634JLXD4.js";
import {
  l as l4
} from "./chunk-CIW3KHOW.js";
import {
  O as O3,
  P as P4,
  a as a8,
  i as i3,
  k
} from "./chunk-J55F4AC2.js";
import {
  _ as _4,
  n as n11,
  r as r6,
  t as t5
} from "./chunk-IMVP5ADD.js";
import {
  E as E4,
  _ as _3,
  a as a9,
  m as m6,
  o as o7,
  s as s11,
  z as z4
} from "./chunk-H7WPOTQH.js";
import {
  l as l7
} from "./chunk-L3T5PF4P.js";
import {
  B,
  J as J2,
  K as K3,
  Q,
  U as U5
} from "./chunk-DUTZNK67.js";
import {
  d as d4,
  h as h4,
  j as j3,
  m as m5,
  p as p6,
  v as v4,
  y as y4
} from "./chunk-JM7HAEY6.js";
import {
  B as B2,
  C as C2,
  X as X2,
  Y as Y2,
  b as b3,
  c as c4,
  e as e14,
  h as h5,
  i as i5,
  n as n9,
  o as o6,
  p as p8,
  x as x4
} from "./chunk-XTVPEVHA.js";
import {
  u as u7
} from "./chunk-K226GFDN.js";
import {
  c as c3,
  d as d5,
  i as i4,
  p as p7,
  s as s10,
  x as x3
} from "./chunk-7ZJ6P7J7.js";
import {
  e as e7
} from "./chunk-WYMXVOAT.js";
import {
  Cn,
  En,
  G as G3,
  f as f6,
  n as n8
} from "./chunk-OGZAGPIO.js";
import {
  D,
  E as E3,
  I,
  K as K2,
  M as M2,
  R,
  U as U4,
  a as a7,
  c as c2,
  d as d3,
  e as e13,
  f as f5,
  g as g4,
  m as m4,
  o as o5,
  p as p5,
  s as s9,
  u as u6,
  w as w3,
  x as x2,
  z as z2
} from "./chunk-IHVSZYZS.js";
import {
  e as e8,
  w as w2
} from "./chunk-NYQ5CYNR.js";
import {
  _,
  f as f3
} from "./chunk-O7UDKFOW.js";
import {
  f as f2
} from "./chunk-TKPMIAIW.js";
import {
  s as s4
} from "./chunk-NKCPFCP3.js";
import {
  M,
  a as a6,
  e as e12,
  f as f4,
  h as h3,
  l as l6,
  m as m3,
  p as p4
} from "./chunk-3ZXOUEQG.js";
import {
  A as A4,
  E as E2,
  G as G2,
  H,
  J,
  K,
  O as O2,
  P as P3,
  S as S4,
  U as U3,
  X,
  Y,
  _ as _2,
  e as e11,
  g as g3,
  j as j2,
  o as o4,
  p as p3,
  q,
  r as r5,
  s as s8,
  u as u5,
  v as v3,
  x,
  z
} from "./chunk-AXVPJBVW.js";
import {
  a as a5,
  e as e9,
  l as l5,
  m as m2,
  n as n7,
  r as r4,
  s as s7,
  t as t4,
  y as y3
} from "./chunk-OXEPWRM7.js";
import {
  e as e10,
  u as u4
} from "./chunk-POILQGXA.js";
import {
  G,
  L as L2,
  O,
  P2,
  W2 as W,
  f2 as f,
  p as p2,
  s3 as s6
} from "./chunk-JJS7PR2U.js";
import {
  s as s5
} from "./chunk-L5YS4GSA.js";
import {
  i as i2,
  n as n6
} from "./chunk-PRREDSOB.js";
import {
  Pt,
  U as U2
} from "./chunk-SYATLP3H.js";
import {
  A as A3,
  C,
  P,
  d as d2,
  p,
  v as v2,
  w
} from "./chunk-6WHTZNUH.js";
import {
  E,
  V
} from "./chunk-EITGQLII.js";
import {
  d
} from "./chunk-XNUH25NY.js";
import {
  o as o3
} from "./chunk-WGAPNV7F.js";
import {
  e as e6
} from "./chunk-4Z5SGKRM.js";
import {
  A as A2,
  S as S3,
  U,
  e as e4,
  e3 as e5,
  j,
  n4,
  r,
  s2,
  v
} from "./chunk-ANKOCGE2.js";
import {
  y as y2
} from "./chunk-7CJXZOFG.js";
import {
  n as n3,
  r as r3,
  u as u3
} from "./chunk-IRGZKO7V.js";
import {
  e as e3
} from "./chunk-5SELS7VU.js";
import {
  T,
  a3 as a4,
  b as b2,
  g2,
  n as n5,
  t as t3
} from "./chunk-DDYVXG4F.js";
import {
  A,
  L,
  S as S2,
  a as a3,
  b,
  c2 as c,
  h as h2,
  m,
  o2,
  s as s3,
  u as u2
} from "./chunk-HJY2YILU.js";
import {
  e as e2,
  l as l2,
  o
} from "./chunk-7DA6A5LD.js";
import {
  e,
  i,
  l,
  n as n2,
  r as r2,
  t as t2,
  u
} from "./chunk-2MMLMOWS.js";
import {
  l as l3
} from "./chunk-4323ZVPF.js";
import {
  a as a2,
  n2 as n,
  s2 as s
} from "./chunk-WYIDUUN2.js";
import {
  S,
  a,
  g,
  h,
  has,
  t2 as t,
  y2 as y
} from "./chunk-DXLOWWK7.js";
import {
  __async,
  __spreadProps,
  __spreadValues,
  __yieldStar
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/core/accessorSupport/overrideDefaultsFrom.js
function n37(s67, i49) {
  const e71 = t3(s67), c44 = t3(i49), f46 = e71.store, a59 = c44.store, m45 = c44.metadata;
  for (const r57 in m45) {
    const i50 = m45[r57], e72 = f46.originOf(r57), c45 = a59.originOf(r57);
    if (!i50.readOnly && c45 !== e4.DEFAULTS) if (e72 === e4.DEFAULTS) s67.set(r57, a59.get(r57));
    else {
      const t71 = f46.get(r57), s68 = a59.get(r57);
      t71 && s68 && s68 instanceof S3 && t71 instanceof S3 && t71 instanceof s68.constructor && n37(t71, s68);
    }
  }
}

// ../../../node_modules/@arcgis/core/views/support/GroundViewElevationSampler.js
var m24 = class extends o3.EventedAccessor {
  constructor(e71) {
    super(e71), this.demResolution = {
      min: -1,
      max: -1
    }, this.noDataValue = l16;
  }
  initialize() {
    this.view.basemapTerrain.on("elevation-change", () => this.emit("changed", {}));
  }
  get extent() {
    const e71 = this.view.basemapTerrain;
    if (null == e71?.extent || null == e71.spatialReference) return null;
    const t71 = c2(e71.extent, e71.spatialReference);
    return t71.zmin = e71.visibleElevationBounds.min, t71.zmax = e71.visibleElevationBounds.max, t71;
  }
  get spatialReference() {
    return this.view.basemapTerrain?.spatialReference ?? f2.WGS84;
  }
  elevationAt(e71, t71) {
    if (null == this.extent || !e8(this.extent, e71, t71)) {
      const r57 = null != this.extent ? `${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}` : null;
      return n.getLogger(this).warn("#elevationAt()", `Point used to sample elevation (${e71}, ${t71}) is outside of the sampler extent (${r57})`), this.noDataValue;
    }
    return this.view.elevationProvider?.getElevation(e71, t71, 0, this.spatialReference, "ground") ?? this.noDataValue;
  }
  queryElevation(e71) {
    return p11(e71.clone(), this);
  }
};
e6([y2({
  readOnly: true
})], m24.prototype, "demResolution", void 0), e6([y2({
  readOnly: true
})], m24.prototype, "extent", null), e6([y2({
  readOnly: true
})], m24.prototype, "noDataValue", void 0), e6([y2()], m24.prototype, "spatialReference", null), e6([y2({
  constructOnly: true
})], m24.prototype, "view", void 0), m24 = e6([a4("esri.views.support.GroundViewElevationSampler")], m24);
var u20 = m24;

// ../../../node_modules/@arcgis/core/views/GroundView.js
var d17 = class extends S3 {
  constructor(e71) {
    super(e71), this.view = null, this.layerViews = new V();
  }
  initialize() {
    this.addHandles(p(() => this.view?.map?.ground, (e71) => e71.load())), this.addHandles(this.layerViews.on("after-changes", () => this._layerViewsAfterChangesHandler()));
  }
  destroy() {
    this._set("view", null);
    for (const e71 of this.layerViews) e71.destroy();
    this.layerViews.length = 0;
  }
  get elevationSampler() {
    return this.view ? "2d" === this.view.type ? null : this.view.ready && this.view.basemapTerrain && this.view.basemapTerrain.ready ? new u20({
      view: this.view
    }) : null : null;
  }
  get extent() {
    const e71 = this.view;
    return e71 && "2d" !== e71.type && e71.ready ? Re(e71, e71.state.camera, e71.pointsOfInterest.centerOnSurfaceFrequent.renderLocation) : null;
  }
  get updating() {
    return !this.suspended && this.layerViews.some((e71) => e71.updating);
  }
  get suspended() {
    return !this.view || this.view.suspended;
  }
  _layerViewsAfterChangesHandler() {
    this.removeHandles("updating"), this.addHandles(this.layerViews.map((e71) => d2(() => e71.updating, () => this._updateUpdating(), C)).toArray(), "updating"), this._updateUpdating();
  }
  _updateUpdating() {
    this.notifyChange("updating");
  }
};
e6([y2({
  readOnly: true
})], d17.prototype, "elevationSampler", null), e6([y2({
  readOnly: true
})], d17.prototype, "extent", null), e6([y2({
  type: Boolean,
  readOnly: true
})], d17.prototype, "updating", null), e6([y2({
  constructOnly: true
})], d17.prototype, "view", void 0), e6([y2({
  type: V,
  readOnly: true
})], d17.prototype, "layerViews", void 0), e6([y2({
  readOnly: true
})], d17.prototype, "suspended", null), d17 = e6([a4("esri.views.GroundView")], d17);
var u21 = d17;

// ../../../node_modules/@arcgis/core/views/3d/layerViewModuleImportUtils.js
var r38 = () => import("./TileLayerView3D-O27TWJAR.js");
var a29 = () => import("./ElevationLayerView3D-Z2V2KA4J.js");
var i27 = {
  "base-dynamic": () => import("./BaseDynamicLayerView3D-5EVUL5RL.js"),
  "base-elevation": a29,
  "base-tile": r38,
  "bing-maps": r38,
  "building-scene": () => import("./BuildingSceneLayerView3D-W6TDFK36.js"),
  catalog: () => import("./CatalogLayerView3D-ZXRWRJNN.js"),
  "catalog-dynamic-group": () => import("./CatalogDynamicGroupLayerView3D-FJVMQ5AQ.js"),
  "catalog-footprint": () => import("./CatalogFootprintLayerView3D-R6UQ5MRU.js"),
  csv: () => import("./CSVLayerView3D-ERQWDM3W.js"),
  dimension: () => import("./DimensionLayerView3D-KVTFWRBG.js"),
  elevation: a29,
  feature: () => import("./FeatureLayerView3D-LMESPDJ6.js"),
  geojson: () => import("./GeoJSONLayerView3D-UIPH44ME.js"),
  graphics: () => import("./GraphicsLayerView3D-VJ5YLKWR.js"),
  group: () => import("./GroupLayerView-I7ISPCKW.js"),
  imagery: () => import("./ImageryLayerView3D-AUAYLT7P.js"),
  "integrated-mesh": () => import("./IntegratedMeshLayerView3D-52DN4HZR.js"),
  "integrated-mesh-3dtiles": () => import("./IntegratedMesh3DTilesLayerView3D-72AILDIJ.js"),
  "line-of-sight": () => import("./LineOfSightLayerView3D-TKTSQQKM.js"),
  "map-image": () => import("./MapImageLayerView3D-CSVAJLQQ.js"),
  media: () => import("./MediaLayerView3D-T4UU3SWN.js"),
  "ogc-feature": () => import("./OGCFeatureLayerView3D-WDDMXNDF.js"),
  "open-street-map": r38,
  "oriented-imagery": () => import("./FeatureLayerView3D-LMESPDJ6.js"),
  "point-cloud": () => import("./PointCloudLayerView3D-WFH3HRTV.js"),
  voxel: () => import("./VoxelLayerView3D-22WPH2VI.js"),
  route: () => import("./RouteLayerView3D-E3I7H5IE.js"),
  scene: (e71) => null == e71.profile || "mesh-pyramids" === e71.profile ? import("./SceneLayerView3D-CZ5O62SE.js") : import("./SceneLayerGraphicsView3D-GWVIA5GU.js"),
  stream: () => import("./StreamLayerView3D-WPXSXZ5K.js"),
  tile: r38,
  "imagery-tile": () => import("./ImageryTileLayerView3D-GTVYUHFN.js"),
  "vector-tile": () => import("./VectorTileLayerView3D-5OSWBYSX.js"),
  wcs: () => import("./ImageryTileLayerView3D-GTVYUHFN.js"),
  "web-tile": r38,
  wfs: () => import("./WFSLayerView3D-NEERLEPE.js"),
  wms: () => import("./WMSLayerView3D-HPCIKCHT.js"),
  wmts: () => import("./WMTSLayerView3D-NH5FLYCE.js"),
  "geo-rss": null,
  kml: null,
  "knowledge-graph": null,
  "link-chart": null,
  "knowledge-graph-sublayer": null,
  "map-notes": null,
  "subtype-group": null,
  unknown: null,
  unsupported: null,
  video: null
};
function s39(r57) {
  const a59 = r57.declaredClass ? r57.declaredClass.slice(r57.declaredClass.lastIndexOf(".") + 1) : "Unknown", i49 = a59.replaceAll(/([a-z])([A-Z])/g, "$1-$2").toLowerCase();
  return new s(`${i49}:view-not-supported`, `${a59} is not supported in 3D`);
}
var l23 = {
  hasLayerViewModule: (e71) => null != i27[e71.type],
  importLayerView: (e71) => {
    const r57 = i27[e71.type];
    if (null == r57) throw s39(e71);
    return r57(e71);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/analysis/AnalysisViewManager3D.js
var _16 = "analyses-owner-handles";
var p21;
var V6;
!function(e71) {
  e71[e71.PENDING = 0] = "PENDING", e71[e71.CREATED = 1] = "CREATED";
}(p21 || (p21 = {})), function(e71) {
  e71[e71.ADDED = 0] = "ADDED", e71[e71.REMOVED = 1] = "REMOVED";
}(V6 || (V6 = {}));
var A14 = class extends S3 {
  constructor(e71) {
    super(e71), this._allAnalysisViews = new V(), this._creatingViewCount = 0, this._items = /* @__PURE__ */ new Map(), this._scheduledUpdateHandle = null, this._attachedToViewResolver = v10(), this._analysisModules = {
      "area-measurement": {
        module: null
      },
      dimension: {
        module: null
      },
      "direct-line-measurement": {
        module: null
      },
      "line-of-sight": {
        module: null
      },
      slice: {
        module: null
      },
      viewshed: {
        module: null
      }
    };
  }
  destroy() {
    this._disconnectOwners(), this._attachedToViewResolver.reject(u2("AnalysisViewManager was destroyed"));
  }
  attach() {
    this._connectOwners(), this._attachedToViewResolver.resolve();
  }
  detach() {
    this._disconnectOwners(), this._attachedToViewResolver.reject(u2()), this._attachedToViewResolver = v10();
  }
  get updating() {
    return !this.view.ready || 0 !== this._creatingViewCount || this._allAnalysisViews.some((e71) => e71.updating);
  }
  get testInfo() {
  }
  whenAnalysisView(e71) {
    return __async(this, null, function* () {
      yield this._attachedToViewResolver.promise;
      const s67 = this._items.get(e71);
      if (null == s67 || s67.state.list === V6.REMOVED) {
        throw new s("AnalysisViewManager:no-analysisview-for-analysis", "The analysis has not been added to view.analyses", {
          analysis: e71
        });
      }
      return s67.createAnalysisViewTask.promise;
    });
  }
  _connectOwners() {
    this.addHandles(this._connectAnalysesCollection(this.view.analyses), _16);
  }
  _disconnectOwners() {
    this.removeHandles(_16), this._update(), this._creatingViewCount = 0;
  }
  _connectAnalysesCollection(e71) {
    for (const i49 of e71) this._addAnalysis(i49);
    const s67 = e71.on("after-add", (e72) => this._addAnalysis(e72.item)), t71 = e71.on("after-remove", (e72) => this._removeAnalysis(e72.item));
    return e2(() => {
      s67.remove(), t71.remove();
      for (const s68 of e71) this._removeAnalysis(s68);
    });
  }
  _addAnalysis(e71) {
    const s67 = this._items.get(e71);
    if (null == s67) {
      const s68 = {
        state: {
          view: p21.PENDING,
          list: V6.ADDED
        },
        analysis: e71,
        view: null,
        createAnalysisViewTask: null
      };
      this._items.set(e71, s68), s68.createAnalysisViewTask = d((e72) => this._createAnalysisViewPromise(s68, e72));
    } else s67.state.list = V6.ADDED;
  }
  _removeAnalysis(e71) {
    const s67 = this._items.get(e71);
    null != s67 ? (s67.state.list = V6.REMOVED, this._scheduleUpdate()) : n.getLogger(this).error("Trying to remove analysis which was not added");
  }
  _scheduleUpdate() {
    null == this._scheduledUpdateHandle && (this._scheduledUpdateHandle = v(() => this._update()));
  }
  _update() {
    this._scheduledUpdateHandle = l(this._scheduledUpdateHandle), this._items.forEach((e71) => {
      if (e71.state.list === V6.REMOVED) switch (this._items.delete(e71.analysis), e71.state.view) {
        case p21.PENDING:
          e71.createAnalysisViewTask = e(e71.createAnalysisViewTask);
          break;
        case p21.CREATED:
          null != e71.view && (this._allAnalysisViews.remove(e71.view), e71.view = u(e71.view), e71.createAnalysisViewTask = null);
      }
    });
  }
  _createAnalysisViewPromise(e71, s67) {
    return __async(this, null, function* () {
      const t71 = e71.analysis, i49 = t71.type, a59 = this._analysisModules[i49];
      if (this._creatingViewCount += 1, null == a59.module) try {
        a59.module = yield this._loadAnalysisModule(i49);
      } catch (o60) {
        throw this._creatingViewCount -= 1, o60;
      }
      if (c(s67)) throw this._creatingViewCount -= 1, u2("AnalysisView creation aborted");
      const n63 = new a59.module.default({
        analysis: t71,
        view: this.view
      });
      try {
        yield n63.when();
      } catch (o60) {
        throw this._creatingViewCount -= 1, o60;
      }
      if (c(s67)) throw this._creatingViewCount -= 1, n63.destroy(), u2("AnalysisView creation aborted");
      return e71.view = n63, e71.state.view = p21.CREATED, this._allAnalysisViews.add(n63), this._creatingViewCount -= 1, n63;
    });
  }
  _loadAnalysisModule(e71) {
    switch (e71) {
      case "area-measurement":
        return import("./AreaMeasurementAnalysisView3D-QMORVJJB.js");
      case "dimension":
        return import("./DimensionAnalysisView3D-UCHIFQTQ.js");
      case "direct-line-measurement":
        return import("./DirectLineMeasurementAnalysisView3D-BMETURTQ.js");
      case "line-of-sight":
        return import("./LineOfSightAnalysisView3D-WWMEFRCJ.js");
      case "slice":
        return import("./SliceAnalysisView3D-ZVBEIXI6.js");
      case "viewshed":
        return import("./ViewshedAnalysisView3D-W775DUTV.js");
    }
  }
};
function v10() {
  const e71 = L();
  return e71.promise.catch(() => {
  }), e71;
}
e6([y2()], A14.prototype, "updating", null), e6([y2({
  constructOnly: true
})], A14.prototype, "view", void 0), e6([y2()], A14.prototype, "_allAnalysisViews", void 0), e6([y2()], A14.prototype, "_creatingViewCount", void 0), A14 = e6([a4("esri.views.3d.analysis.AnalysisViewManager3D")], A14);
var f25 = A14;

// ../../../node_modules/@arcgis/core/views/3d/state/Constraints.js
var c25 = class extends S3 {
  constructor(t71) {
    super(t71), this.collision = new f26(), this.distance = 1 / 0, this.minimumPoiDistance = 4, this.tilt = null;
  }
  get altitude() {
    return this.mode === l9.Local ? null : this._get("altitude") || null;
  }
  set altitude(t71) {
    this.mode !== l9.Local ? this._set("altitude", t71) : n.getLogger(this).warn("Altitude constraint is ignored in local scenes");
  }
  clampAltitude(t71) {
    return this.altitude ? e12(t71, this.altitude.min, this.altitude.max) : t71;
  }
  clampTilt(t71, e71) {
    if (!this.tilt) return e71;
    const i49 = this.tilt(t71);
    return e12(e71, i49.min, i49.max);
  }
  clampDistance(t71) {
    return Math.min(t71, this.distance);
  }
  createDefaultTilt() {
    return this.mode === l9.Local ? this._createDefaultTiltLocal() : this._createDefaultTiltGlobal();
  }
  createConstantMaxTilt(t71) {
    return (e71, i49 = h15) => (i49.min = d18.min, i49.max = t71, i49);
  }
  _createDefaultTiltLocal() {
    const t71 = this.collision.enabled ? k3([[4e3, d18.max], [1e4, h3(88)], [6e6, h3(88)]]) : () => d18.max;
    return (e71, i49 = h15) => (i49.min = d18.min, i49.max = t71(e71), i49);
  }
  _createDefaultTiltGlobal() {
    const t71 = this.collision.enabled ? k3([[4e3, d18.max], [5e4, h3(88)], [6e6, h3(88)], [2e7, d18.min]]) : k3([[3e5, d18.max], [3e6, h3(88)], [6e6, h3(88)], [2e7, d18.min]]);
    return (e71, i49 = h15) => (i49.min = d18.min, i49.max = t71(e71), i49);
  }
};
function p22(t71) {
  return {
    min: -2e5,
    max: 4 * t71.radius
  };
}
e6([y2()], c25.prototype, "altitude", null), e6([y2({
  readOnly: true
})], c25.prototype, "collision", void 0), e6([y2()], c25.prototype, "distance", void 0), e6([y2({
  readOnly: true
})], c25.prototype, "minimumPoiDistance", void 0), e6([y2()], c25.prototype, "tilt", void 0), e6([y2({
  constructOnly: true
})], c25.prototype, "mode", void 0), c25 = e6([a4("esri.views.3d.state.Constraints")], c25);
var u22 = p22(s5);
var d18 = {
  min: h3(0.5),
  max: h3(179.5)
};
var h15 = {
  min: 0,
  max: 0
};
var f26 = class extends S3 {
  constructor() {
    super(...arguments), this.enabled = true, this.elevationMargin = 5;
  }
};
e6([y2({
  type: Boolean
})], f26.prototype, "enabled", void 0), e6([y2({
  type: Number
})], f26.prototype, "elevationMargin", void 0), f26 = e6([a4("esri.views.3d.state.Constraints.CollisionConstraint")], f26);

// ../../../node_modules/@arcgis/core/views/3d/constraints/AltitudeConstraint.js
var i28 = class extends l4 {
  constructor() {
    super(...arguments), this.min = u22.min, this.max = u22.max;
  }
};
e6([y2({
  type: Number
})], i28.prototype, "min", void 0), e6([y2({
  type: Number
})], i28.prototype, "max", void 0), i28 = e6([a4("esri.views.3d.constraints.AltitudeConstraint")], i28);

// ../../../node_modules/@arcgis/core/views/3d/constraints/ClipDistanceConstraint.js
var o39 = class extends l4 {
  constructor() {
    super(...arguments), this.mode = "auto";
  }
  get near() {
    return this._get("near");
  }
  set near(t71) {
    this._set("near", t71), t71 >= this._get("far") && (this.far = t71 + 1e-9), this.mode = "manual";
  }
  castNear(t71) {
    return Math.max(1e-8, t71);
  }
  get far() {
    return this._get("far");
  }
  set far(t71) {
    this._set("far", t71), t71 <= this._get("near") && (this.near = t71 - 1e-9), this.mode = "manual";
  }
  castFar(t71) {
    return Math.max(1e-8, t71);
  }
  autoUpdate(t71, r57) {
    "auto" === this.mode && (this._get("near") !== t71 && this._set("near", t71), this._get("far") !== r57 && this._set("far", r57));
  }
};
e6([y2({
  type: Number,
  value: 1e-8
})], o39.prototype, "near", null), e6([s4("near")], o39.prototype, "castNear", null), e6([y2({
  type: Number,
  value: 1e-8
})], o39.prototype, "far", null), e6([s4("far")], o39.prototype, "castFar", null), e6([y2({
  type: ["auto", "manual"]
})], o39.prototype, "mode", void 0), o39 = e6([a4("esri.views.3d.constraints.ClipDistanceConstraint")], o39);

// ../../../node_modules/@arcgis/core/views/3d/constraints/TiltConstraint.js
var p23 = {
  min: M(d18.min),
  max: M(d18.max)
};
var c26 = class extends l4 {
  constructor(t71) {
    super(t71), this.mode = "auto";
  }
  get max() {
    return this._get("max");
  }
  set max(t71) {
    this._set("max", t71), this.mode = "manual";
  }
  castMax(t71) {
    return e12(t71, p23.min, p23.max);
  }
  autoUpdate(t71) {
    "auto" === this.mode && this._get("max") !== t71 && this._set("max", t71);
  }
};
e6([y2({
  type: ["auto", "manual"]
})], c26.prototype, "mode", void 0), e6([y2({
  type: Number,
  value: p23.max
})], c26.prototype, "max", null), e6([s4("max")], c26.prototype, "castMax", null), c26 = e6([a4("esri.views.3d.constraints.TiltConstraint")], c26);

// ../../../node_modules/@arcgis/core/views/3d/constraints/Constraints.js
var c27 = class extends l4 {
  constructor() {
    super(...arguments), this.tilt = new c26(), this.altitude = new i28(), this.clipDistance = new o39();
  }
};
e6([y2({
  type: c26
})], c27.prototype, "tilt", void 0), e6([y2({
  type: i28
})], c27.prototype, "altitude", void 0), e6([y2({
  type: o39
})], c27.prototype, "clipDistance", void 0), c27 = e6([a4("esri.views.3d.constraints.Constraints")], c27);

// ../../../node_modules/@arcgis/core/views/3d/environment/SunLighting.js
var s40;
var a30 = s40 = class extends o3.EventedMixin(p18) {
  constructor(e71) {
    super(e71), this.cameraTrackingEnabled = true, this.positionTimezoneInfo = {
      hours: 0,
      minutes: 0,
      seconds: 0,
      autoUpdated: true
    };
    const t71 = (/* @__PURE__ */ new Date()).getFullYear(), o60 = /* @__PURE__ */ new Date("March 15, " + t71 + " 12:00:00 UTC");
    this._set("defaultDate", o60), this._set("date", o60);
  }
  get defaultDate() {
    return new Date(this._get("defaultDate").getTime());
  }
  static fromWebsceneLighting(e71) {
    return new s40(e71.cloneConstructProperties());
  }
  set defaultDate(e71) {
    const t71 = this._get("date") === this._get("defaultDate");
    e71 = new Date(e71.getTime()), this._set("defaultDate", e71), t71 && this._set("date", e71);
  }
  set date(e71) {
    null != e71 && (this.positionTimezoneInfo.autoUpdated = false, this._set("date", new Date(e71.getTime())));
  }
  autoUpdate(e71, t71) {
    const o60 = s40.calculateTimezoneOffset(this.positionTimezoneInfo);
    this.positionTimezoneInfo.hours = t71.hours, this.positionTimezoneInfo.minutes = t71.minutes, this.positionTimezoneInfo.seconds = t71.seconds;
    let i49 = null;
    null != e71 && (this.positionTimezoneInfo.autoUpdated = true, isNaN(e71.getTime()) ? (i49 = this.defaultDate.getTime(), this._set("date", this.defaultDate)) : (i49 = this.date && this.date.getTime(), this._set("date", new Date(e71.getTime()))));
    const n63 = s40.calculateTimezoneOffset(this.positionTimezoneInfo);
    if (o60 !== n63 && (r39.target = this, r39.timezoneOffset = n63, this.emit("timezone-will-change", r39), r39.target = null), null != e71) return isNaN(e71.getTime()) || i49 !== e71.getTime();
  }
  clone() {
    const e71 = this._get("date") === this._get("defaultDate"), t71 = new s40(__spreadProps(__spreadValues({}, this.cloneConstructProperties()), {
      defaultDate: this.defaultDate,
      cameraTrackingEnabled: this.cameraTrackingEnabled
    }));
    return e71 && t71._set("date", t71._get("defaultDate")), t71.positionTimezoneInfo.autoUpdated = this.positionTimezoneInfo.autoUpdated, t71.positionTimezoneInfo.hours = this.positionTimezoneInfo.hours, t71.positionTimezoneInfo.minutes = this.positionTimezoneInfo.minutes, t71.positionTimezoneInfo.seconds = this.positionTimezoneInfo.seconds, t71;
  }
  cloneWithWebsceneLighting(e71) {
    const t71 = this.clone();
    return null != e71.date && (t71.date = e71.date), t71.directShadowsEnabled = e71.directShadowsEnabled, t71.displayUTCOffset = e71.displayUTCOffset, t71;
  }
  cloneNonPersistentConstructProperties() {
    return {
      cameraTrackingEnabled: this.cameraTrackingEnabled
    };
  }
};
e6([y2({
  type: Boolean
})], a30.prototype, "cameraTrackingEnabled", void 0), e6([y2({
  type: Date
})], a30.prototype, "defaultDate", null), e6([y2({
  type: Date
})], a30.prototype, "date", null), a30 = s40 = e6([a4("esri.views.3d.environment.SunLighting")], a30), function(e71) {
  function t71({
    hours: e72,
    minutes: t72,
    seconds: o60
  }) {
    return Math.round(e72 + t72 / 60 + o60 / 3600);
  }
  e71.calculateTimezoneOffset = t71;
}(a30 || (a30 = {}));
var r39 = {
  target: null,
  timezoneOffset: 0
};
var d19 = a30;

// ../../../node_modules/@arcgis/core/views/3d/environment/VirtualLighting.js
var s41;
var c28 = s41 = class extends o3.EventedMixin(i22) {
  constructor(e71) {
    super(e71), this.cameraTrackingEnabled = true;
  }
  clone() {
    return new s41(__spreadProps(__spreadValues({}, this.cloneConstructProperties()), {
      cameraTrackingEnabled: this.cameraTrackingEnabled
    }));
  }
  static fromWebsceneLighting(e71) {
    return new s41(e71.cloneConstructProperties());
  }
  cloneWithWebsceneLighting(e71) {
    const r57 = this.clone();
    return r57.directShadowsEnabled = e71.directShadowsEnabled, r57;
  }
  cloneNonPersistentConstructProperties() {
    return {
      cameraTrackingEnabled: this.cameraTrackingEnabled
    };
  }
};
e6([y2({
  type: Boolean
})], c28.prototype, "cameraTrackingEnabled", void 0), c28 = s41 = e6([a4("esri.views.3d.environment.VirtualLighting")], c28);
var a31 = c28;

// ../../../node_modules/@arcgis/core/views/3d/environment/lightingUtils.js
var i29 = {
  key: "type",
  defaultKeyValue: "sun",
  base: null,
  typeMap: {
    sun: d19,
    virtual: a31
  }
};

// ../../../node_modules/@arcgis/core/views/3d/environment/SceneViewAtmosphere.js
var t46;
var i30 = t46 = class extends S3 {
  set quality(o60) {
    ["low", "high"].includes(o60) && this._set("quality", o60);
  }
  clone() {
    return new t46({
      quality: this.quality
    });
  }
};
e6([y2({
  type: ["low", "high"],
  value: "low"
})], i30.prototype, "quality", null), i30 = t46 = e6([a4("esri.views.3d.environment.SceneViewAtmosphere")], i30);

// ../../../node_modules/@arcgis/core/views/3d/environment/SceneViewEnvironment.js
var b10;
var d20 = b10 = class extends b7 {
  constructor(t71) {
    super(t71), this.atmosphere = new i30(), this.lighting = this.castLighting(), this.cachedCameraTrackingEnabled = null;
  }
  destroy() {
    this.atmosphere.destroy();
  }
  static fromWebsceneEnvironment(t71) {
    const i49 = t71.cloneConstructProperties();
    return new b10(__spreadProps(__spreadValues({}, i49), {
      lighting: i49.lighting ? "virtual" === i49.lighting.type ? a31.fromWebsceneLighting(i49.lighting) : d19.fromWebsceneLighting(i49.lighting) : void 0
    }));
  }
  castLighting(t71) {
    return this._convertLightingWithDestroy(t71);
  }
  applyLighting(t71) {
    this.lighting = this._convertLightingWithDestroy(t71);
  }
  _convertLightingWithDestroy(t71) {
    const i49 = this._convertLighting(t71);
    return i49 !== t71 && this.addHandles(l2(i49)), i49;
  }
  _convertLighting(t71) {
    return t71 ? t71 instanceof d19 || t71 instanceof a31 ? t71 : t71 instanceof p18 ? this.lighting && "virtual" !== this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t71) : new d19(__spreadValues(__spreadValues({}, t71.cloneConstructProperties()), this.lighting?.cloneNonPersistentConstructProperties())) : t71 instanceof i22 ? this.lighting && "virtual" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t71) : new a31(__spreadValues(__spreadValues({}, t71.cloneConstructProperties()), this.lighting?.cloneNonPersistentConstructProperties())) : T(i29, t71) : new d19();
  }
  clone() {
    return new b10({
      lighting: this.lighting.clone(),
      atmosphere: this.atmosphere.clone(),
      weather: this.weather.clone(),
      atmosphereEnabled: this.atmosphereEnabled,
      starsEnabled: this.starsEnabled,
      background: a2(this.background)
    });
  }
  cloneWithWebsceneEnvironment(t71) {
    return new b10(__spreadProps(__spreadValues({
      atmosphere: this.atmosphere.clone(),
      weather: this.weather.clone(),
      atmosphereEnabled: this.atmosphereEnabled,
      starsEnabled: this.starsEnabled,
      background: a2(this.background)
    }, t71.cloneConstructProperties()), {
      lighting: this._getLighting(t71)
    }));
  }
  _getLighting(t71) {
    switch (t71.lighting.type) {
      case "sun":
        return this.lighting && "sun" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t71.lighting) : d19.fromWebsceneLighting(t71.lighting);
      case "virtual":
        return this.lighting && "virtual" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t71.lighting) : a31.fromWebsceneLighting(t71.lighting);
      default:
        return n10(t71.lighting), d19.fromWebsceneLighting(t71.lighting);
    }
  }
};
e6([y2({
  type: i30,
  json: {
    read: false
  },
  nonNullable: true
})], d20.prototype, "atmosphere", void 0), e6([y2({
  nonNullable: true
})], d20.prototype, "lighting", void 0), e6([s4("lighting")], d20.prototype, "castLighting", null), d20 = b10 = e6([a4("esri.views.3d.environment.SceneViewEnvironment")], d20);
var f27 = d20;

// ../../../node_modules/@arcgis/core/views/3d/environment/AtmosphereType.js
var a32;
!function(a59) {
  a59[a59.Realistic = 0] = "Realistic", a59[a59.Local = 1] = "Local", a59[a59.Mars = 2] = "Mars", a59[a59.None = 3] = "None";
}(a32 || (a32 = {}));

// ../../../node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphereTechnique.js
var u23 = class extends n15 {
  constructor() {
    super(...arguments), this.heightParameters = n11(), this.radii = n13(), this.innerFadeDistance = 0, this.altitudeFade = 0, this.hazeStrength = 1, this.renderScale = n13(), this.backgroundColor = n7();
  }
};
var p24 = class _p extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _p.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return this.configuration.reduced ? S7({
      blending: s20(R3.ONE, R3.ZERO),
      depthTest: {
        func: O6.ALWAYS
      },
      colorWrite: _9
    }) : this.configuration.haze ? S7({
      blending: l12(R3.ONE, R3.ZERO, R3.ONE_MINUS_SRC_COLOR, R3.ONE),
      colorWrite: _9
    }) : S7({
      blending: s20(R3.SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
p24.shader = new t16(F4, () => import("./ChapmanAtmosphere.glsl-SNEYMDYA.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration.js
var o40 = class extends t18 {
  constructor() {
    super(...arguments), this.haze = false;
  }
};
e6([r19()], o40.prototype, "haze", void 0);
var t47 = class extends o40 {
  constructor() {
    super(...arguments), this.reduced = false;
  }
};
e6([r19()], t47.prototype, "reduced", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique.js
var p25 = class _p extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _p.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return this.configuration.haze ? S7({
      blending: l12(R3.ONE, R3.ZERO, R3.ONE_MINUS_SRC_COLOR, R3.ONE),
      depthTest: {
        func: O6.ALWAYS
      },
      colorWrite: _9
    }) : S7({
      blending: s20(R3.SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: O6.ALWAYS
      },
      colorWrite: _9
    });
  }
};
p25.shader = new t16(d14, () => import("./AtmosphereCompositing.glsl-VEZRAB56.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphere.js
var B6 = class {
  constructor(s67, i49) {
    this._view = s67, this._context = i49, this.type = a32.Realistic, this._handles = new r(), this._compositingPassParameters = new a28(), this._passParameters = new u23(), this._rootTileElevationMin = NaN, this._lowerBoundEarthRadius = s5.radius, this._fadeHaze = 0, this._updateRadius(s5.radius);
    const r57 = this._context.renderContext.rctx;
    this._updateRootTileElevationBounds(), this._handles.add([d2(() => this._view?.basemapTerrain?.rootTileElevationBounds, () => this._view?.basemapTerrain ? this._updateRootTileElevationBounds() : null), d2(() => this._view?.basemapTerrain?.visibleElevationBounds, () => this._view?.basemapTerrain ? this._updateVisibleElevationBounds() : null), d2(() => this._view?.environment.background, (t71) => {
      const s68 = t71 instanceof a27 ? E5(t71.color) : _4;
      o4(this._passParameters.backgroundColor, s68[0] * s68[3], s68[1] * s68[3], s68[2] * s68[3]);
    }, A3)]);
    const n63 = new t47();
    n63.haze = false, this._atmosphereTechnique = this._context.techniques.acquire(p24, n63), this._compositingTechnique = this._context.techniques.acquire(p25, n63), n63.haze = true, this._atmosphereHazeTechnique = this._context.techniques.acquire(p24, n63), this._compositingHazeTechnique = this._context.techniques.acquire(p25, n63), n63.reduced = true, n63.haze = false, this._atmosphereReducedTechnique = this._context.techniques.acquire(p24, n63), n63.haze = true, this._atmosphereHazeReducedTechnique = this._context.techniques.acquire(p24, n63), this._vao = i21(r57, m22);
  }
  destroy() {
    this._handles.destroy(), this._compositingTechnique.release(), this._compositingHazeTechnique.release(), this._atmosphereTechnique.release(), this._atmosphereHazeTechnique.release(), this._atmosphereReducedTechnique.release(), this._atmosphereHazeReducedTechnique.release(), this._vao.dispose();
  }
  render(e71, t71) {
    this._render(e71, t71 ? this._atmosphereTechnique : this._atmosphereReducedTechnique, t71, false);
  }
  renderHaze(e71, t71, s67) {
    this._fadeHaze = t71, this._render(e71, s67 ? this._atmosphereHazeTechnique : this._atmosphereHazeReducedTechnique, s67, true);
  }
  _render(e71, t71, s67, r57) {
    const a59 = e71.bindParameters.mainDepth;
    if (!a59) return;
    this._update(e71.bindParameters.camera), this._passParameters.depthTexture = a59;
    const o60 = e71.rctx.bindTechnique(t71, e71.bindParameters, this._passParameters), n63 = e71.offscreenRenderingHelper;
    if (s67) n63.renderDepthDetached(() => this._renderCommon(o60, e71));
    else {
      const t72 = e71.rctx.getViewport(), s68 = s8(e71.bindParameters.camera.eye) - s5.radius;
      let h32;
      if (s68 < n35) {
        const e72 = Math.min(1, Math.max(0, s68 / n35));
        h32 = r57 ? f4(0.4, 0.5, e72) : f4(0.2, 0.3, e72);
      } else {
        const e72 = Math.min(1, Math.max(0, (s68 - n35) / (15 * n35)));
        h32 = r57 ? f4(0.5, 1, e72) : f4(0.3, 0.6, e72);
      }
      const c44 = n20(Math.round(h32 * e71.bindParameters.camera.fullViewport[2])), u46 = n20(Math.round(h32 * e71.bindParameters.camera.fullViewport[3]));
      e71.rctx.setViewport(0, 0, c44, u46);
      const d38 = n63.renderToCachedFBO(null, r57 ? "chapman haze" : "chapman", () => this._renderCommon(o60, e71), [0, 0, 0, 1], R4.RGBA, null, c44, u46);
      e71.rctx.setViewport(t72.x, t72.y, t72.width, t72.height), this._compositingPassParameters.color = d38.getTexture(), this._compositingPassParameters.depth = a59;
      const l47 = r57 ? this._compositingHazeTechnique : this._compositingTechnique;
      e71.rctx.bindTechnique(l47, e71.bindParameters, this._compositingPassParameters), n63.renderDepthDetached(() => e71.rctx.screen.draw()), d38.release();
    }
  }
  _renderCommon(e71, t71) {
    null != this._vao && (t71.rctx.bindVAO(this._vao), e71.assertCompatibleVertexAttributeLocations(this._vao), t71.rctx.drawArrays(E7.TRIANGLE_STRIP, 0, 4));
  }
  _updateRootTileElevationBounds() {
    const e71 = this._view.basemapTerrain.rootTileElevationBounds.min;
    e71 !== this._rootTileElevationMin && (this._rootTileElevationMin = e71, this._lowerBoundEarthRadius = s5.radius, this._updateVisibleElevationBounds());
  }
  _updateVisibleElevationBounds() {
    const e71 = H8(s5.radius + this._view.basemapTerrain.visibleElevationBounds.min);
    e71 < this._lowerBoundEarthRadius && this._updateRadius(e71);
  }
  _updateRadius(e71) {
    this._lowerBoundEarthRadius = e71, o13(this._passParameters.radii, e71, e71 + n35), this._passParameters.innerFadeDistance = 2 * Math.sqrt((2 * e71 - o36) * o36);
  }
  _update(e71) {
    if (!e71) return;
    const t71 = v3(e71.eye), a59 = Math.sqrt(t71), o60 = t71 - this._passParameters.radii[1] * this._passParameters.radii[1], n63 = e12((a59 - this._passParameters.radii[0]) / n35, 0, 1);
    s11(this._passParameters.heightParameters, a59, t71, o60, n63), this._passParameters.altitudeFade = e38(a59 - this._lowerBoundEarthRadius), this._passParameters.hazeStrength = f4(f4(0.6, 1, p4(9500, 10500, a59 - s5.radius)), 1, this._fadeHaze);
  }
};
function H8(e71) {
  return e71 * Math.cos(Math.PI / 16 / 16);
}

// ../../../node_modules/@arcgis/core/views/3d/environment/CloudsCompositionTechnique.js
var u24 = class _u extends r17 {
  constructor(e71) {
    super(e71, new t18(), () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _u.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.ONE, R3.ZERO, R3.SRC_ALPHA, R3.ONE),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
u24.shader = new t16(f20, () => import("./CloudsComposition.glsl-AI2LGOYP.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/CloudsComposition.js
var m25 = class extends S3 {
  constructor(o60) {
    super(o60), this._technique = new u24(o60), this._vao = i21(o60.rctx);
  }
  destroy() {
    this._technique = t2(this._technique), this._vao = r2(this._vao);
  }
  render(o60) {
    if (!this._technique.compiled) return void this.requestRender();
    const e71 = o60.bindParameters.cloudsFade;
    if (null == this._vao || null == e71.data) return;
    const t71 = o60.rctx.bindTechnique(this._technique, o60.bindParameters, u25);
    o60.rctx.bindVAO(this._vao), t71.assertCompatibleVertexAttributeLocations(this._vao), o60.rctx.drawArrays(E7.TRIANGLE_STRIP, 0, 4);
  }
};
e6([y2({
  constructOnly: true
})], m25.prototype, "rctx", void 0), e6([y2({
  constructOnly: true
})], m25.prototype, "viewingMode", void 0), e6([y2({
  constructOnly: true
})], m25.prototype, "planetRadius", void 0), e6([y2({
  constructOnly: true
})], m25.prototype, "requestRender", void 0), m25 = e6([a4("esri.views.3d.environment.CloudsComposition")], m25);
var u25 = new n15();

// ../../../node_modules/@arcgis/core/views/3d/environment/CloudsTechnique.js
var d21 = class _d extends r17 {
  constructor(e71, r57) {
    super(e71, r57, () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _d.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: s20(R3.CONSTANT_COLOR, R3.ONE_MINUS_CONSTANT_COLOR, T4.ADD, this.configuration.writeTextureChannels === u15.RG ? [1, 1, 0, 0] : [0, 0, 1, 1]),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
d21.shader = new t16(b8, () => import("./Clouds.glsl-WGEWQKWV.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/NoiseTextureAtlasTechnique.js
var d22 = class _d extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _d.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: this.configuration.mode === t41.Full ? s20(R3.ONE, R3.ZERO) : l12(R3.ZERO, R3.ONE, R3.ONE, R3.ZERO),
      depthTest: {
        func: O6.ALWAYS
      },
      colorWrite: _9
    });
  }
};
d22.shader = new t16(v9, () => import("./NoiseTextureAtlas.glsl-LFHKCGKP.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/NoiseTextureAtlas.js
var d23 = class extends S3 {
  constructor(e71) {
    super(e71), this._needsRender = true, this._passParameters = new s36(), this._fbo = new E11(e71.context.renderContext.rctx, new e22(t40)), this._vao = i21(e71.context.renderContext.rctx);
  }
  get _techniques() {
    return this.context.techniques;
  }
  get textureAtlas() {
    return null != this._texture ? null != this._weatherMapTechnique && this._weatherMapTechnique.compiled && this._needsRender && (this._texture = this._render(t41.WeatherMap)) : null != this._fullTechnique && this._fullTechnique.compiled && (this._texture = this._render(t41.Full)), this._texture;
  }
  _setDirty() {
    this._needsRender = true;
  }
  updateWeatherMap(e71) {
    this._passParameters.weatherTile[0] === e71[0] && this._passParameters.weatherTile[1] === e71[1] || (r13(this._passParameters.weatherTile, e71), this._setDirty());
  }
  destroy() {
    this._fullTechniqueCached = t2(this._fullTechniqueCached), this._weatherMapTechniqueCached = t2(this._weatherMapTechniqueCached), this._fbo = r2(this._fbo), this._vao = r2(this._vao);
  }
  get _fullTechnique() {
    if (null == this._fullTechniqueCached) {
      const e71 = new s35();
      e71.mode = t41.Full, this._fullTechniqueCached = this._techniques.acquire(d22, e71);
    }
    return this._fullTechniqueCached;
  }
  get _weatherMapTechnique() {
    if (null == this._weatherMapTechniqueCached) {
      const e71 = new s35();
      e71.mode = t41.WeatherMap, this._weatherMapTechniqueCached = this._techniques.acquire(d22, e71);
    }
    return this._weatherMapTechniqueCached;
  }
  _render(e71) {
    if (null == this._vao || null == this._fbo) return null;
    const t71 = e71 === t41.Full ? this._fullTechnique : this._weatherMapTechnique, r57 = this.context.renderContext.rctx, s67 = r57.getViewport();
    r57.setViewport(0, 0, t40, t40), r57.bindFramebuffer(this._fbo);
    const i49 = r57.bindTechnique(t71, null, this._passParameters);
    return r57.bindVAO(this._vao), i49.assertCompatibleVertexAttributeLocations(this._vao), r57.gl.drawArrays(r57.gl.TRIANGLE_STRIP, 0, 4), r57.setViewport(s67.x, s67.y, s67.width, s67.height), this._needsRender = false, this._fbo.colorTexture;
  }
};
e6([y2({
  constructOnly: true
})], d23.prototype, "context", void 0), e6([y2({
  readOnly: true
})], d23.prototype, "_techniques", null), d23 = e6([a4("esri.views.3d.environment.NoiseTextureAtlas")], d23);

// ../../../node_modules/@arcgis/core/views/3d/environment/CloudsGenerator.js
var A15 = class extends S3 {
  constructor(e71) {
    super(e71), this._techniques = new Array(), this._techniqueConfiguration = new i23(), this._bindParameters = new m19(null, null), this._passParameters = new w10(), this._weatherTile = n13(), this._weatherTileCount = 128, this._faceIndex = 0, this._tileIndex = 0, this.coverage = f4(e39.default.coverage[0], e39.default.coverage[1], 0.5), this.density = f4(e39.default.density[0], e39.default.density[1], 0.5), this.absorption = f4(e39.default.absorption[0], e39.default.absorption[1], 0.5), this.cloudSize = f4(e39.default.cloudSize[0], e39.default.cloudSize[1], 0.5), this.detailSize = f4(e39.default.detailSize[0], e39.default.detailSize[1], 0.5), this.smoothness = f4(e39.default.smoothness[0], e39.default.smoothness[1], 0.5), this.cloudHeight = f4(e39.default.cloudHeight[0], e39.default.cloudHeight[1], 0.5), this.raymarchingSteps = e39.default.raymarchingSteps, this._viewMatrix = e15(), this._dirty = false, this.running = false, this._vao = i21(e71.context.renderContext.rctx);
  }
  _getTechnique(e71) {
    const t71 = 1 - this.context.renderContext.bindParameters.cloudsFade.readChannels, i49 = t71 === u15.RG ? 2 * e71 : 2 * e71 + 1, s67 = this._techniques[i49];
    return s67 || (this._techniqueConfiguration.writeTextureChannels = t71, this._techniqueConfiguration.steps = e71, this._techniques[i49] = new d21({
      rctx: this.context.renderContext.rctx,
      viewingMode: this.view.state.viewingMode
    }, this._techniqueConfiguration), this._techniques[i49]);
  }
  updateWeatherTile() {
    const e71 = this.view.camera.position.latitude, t71 = this.view.camera.position.longitude;
    if (null == e71 || null == t71) return;
    o13(this._weatherTile, (e71 + 90) / 180, (t71 + 180) / 360);
    const i49 = Math.floor(this._weatherTileCount * Math.abs(2 * this._weatherTile[0] - 1));
    this._weatherTile[0] = Math.floor(2 * this._weatherTileCount * this._weatherTile[0]), this._weatherTile[1] = Math.floor(4 * (this._weatherTileCount - i49) * this._weatherTile[1]);
    let s67 = 0, r57 = 0;
    if (null != this.view.environment && "virtual" !== this.view.environment.lighting.type && null != this.view.environment.lighting.date) {
      const e72 = new Date(this.view.environment.lighting.date);
      e72.setUTCHours(this.view.environment.lighting.date.getUTCHours() + (this.view.environment.lighting.displayUTCOffset ?? 0)), s67 = 31 * e72.getUTCMonth() + e72.getUTCDate(), r57 = e72.getUTCFullYear();
    }
    this._weatherTile[0] = (this._weatherTile[0] + s67) % (2 * this._weatherTileCount), this._weatherTile[1] = (this._weatherTile[1] + r57 % 100) % (4 * this._weatherTileCount), T3(this._passParameters.weatherTile, this._weatherTile) || this.setDirty();
  }
  initialize() {
    const e71 = s6(this.view.spatialReference);
    this._passParameters.cloudRadius = 0.5 * e71.radius, this.setDirty(), this.updateWeatherTile(), this.addHandles([this.view.resourceController.scheduler.registerTask(I3.CLOUDS_GENERATOR, this), d2(() => [this.coverage, this.density, this.absorption, this.cloudSize, this.detailSize, this.smoothness, this.cloudHeight, this.raymarchingSteps], () => this.setDirty(), P)]);
  }
  destroy() {
    this._techniques.forEach((e71) => t2(e71)), this._frameBufferCube = r2(this._frameBufferCube), this._techniques.length = 0, this._vao.dispose(), this._passParameters.noiseTexture = u(this._passParameters.noiseTexture);
  }
  get _tilesPerFace() {
    switch (this._techniqueConfiguration.steps) {
      case s34.SIXTEEN:
        return 1;
      case s34.HUNDRED:
        return 4;
      case s34.COUNT:
      case s34.TWOHUNDRED:
        return 8;
    }
  }
  get usedMemory() {
    return (this._frameBufferCube?.usedMemory ?? 0) + (this._passParameters.noiseTexture?.textureAtlas?.usedMemory ?? 0);
  }
  _ensureNoiseTexture() {
    return this._passParameters.noiseTexture ??= new d23({
      context: this.context
    }), this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile), null != this._passParameters.noiseTexture.textureAtlas;
  }
  _ensureFrameBufferCube(e71) {
    if (null == this._frameBufferCube) {
      const t71 = new e22(e71);
      t71.target = M4.TEXTURE_CUBE_MAP, t71.wrapMode = D2.CLAMP_TO_EDGE, this._frameBufferCube = new E11(this.context.renderContext.rctx, t71);
    }
    return this._frameBufferCube;
  }
  get cubeMap() {
    return this._frameBufferCube;
  }
  destroyFrameBufferCube() {
    this._frameBufferCube = r2(this._frameBufferCube);
  }
  applyPreset(e71, t71) {
    const s67 = e71.median, r57 = (e72) => {
      const r58 = f4(e72[0], e72[1], s67);
      return t71 < 0.5 ? f4(e72[0], r58, 2 * t71) : f4(r58, e72[1], 2 * (t71 - 0.5));
    };
    this.coverage = r57(e71.coverage), this.density = r57(e71.density), this.absorption = r57(e71.absorption), this.cloudSize = r57(e71.cloudSize), this.detailSize = r57(e71.detailSize), this.smoothness = r57(e71.smoothness), this.cloudHeight = r57(e71.cloudHeight), this.raymarchingSteps = e71.raymarchingSteps;
  }
  setDirty() {
    this._dirty = this.running = true;
  }
  runTask(e71) {
    0 === this._faceIndex && 0 === this._tileIndex && (this._passParameters.raymarchingSteps = this.raymarchingSteps, this.updateWeatherTile(), r13(this._passParameters.weatherTile, this._weatherTile));
    const t71 = this._getTechnique(this._passParameters.raymarchingSteps);
    if (!t71.compiled) return o12;
    if (this.context.renderContext.bindParameters.cloudsFade.fadeMode === O11.CROSS_FADE || !this._ensureNoiseTexture()) return o12;
    0 === this._faceIndex && 0 === this._tileIndex && (this.context.renderContext.bindParameters.cloudsFade.renderingStage = n30.RENDERING, this._passParameters.absorption = this.absorption, this._passParameters.density = this.density, this._passParameters.cloudSize = this.cloudSize, this._passParameters.detailSize = this.detailSize, this._passParameters.smoothness = this.smoothness, this._passParameters.cloudHeight = this.cloudHeight, this._passParameters.coverage = this.coverage, this._dirty = false);
    const i49 = B7[this._faceIndex], s67 = H9[this._faceIndex];
    Y2(this._viewMatrix, O15, i49, s67), n16(this._passParameters.viewMatrix, this._viewMatrix);
    const r57 = this.context.renderContext.rctx, o60 = r57.bindTechnique(t71, this._bindParameters, this._passParameters);
    r57.bindVAO(this._vao), o60.assertCompatibleVertexAttributeLocations(this._vao);
    const a59 = r57.getViewport(), n63 = t71.configuration.cubeMapSize, h32 = n63 / this._tilesPerFace, u46 = this._tileIndex * h32;
    r57.setViewport(0, u46, n63, h32);
    const c44 = this._ensureFrameBufferCube(n63);
    r57.bindFramebuffer(c44);
    const m45 = M4.TEXTURE_CUBE_MAP_POSITIVE_X + this._faceIndex;
    return c44.setColorTextureTarget(m45), r57.gl.drawArrays(r57.gl.TRIANGLE_STRIP, 0, 4), r57.gl.flush(), r57.setViewport(a59.x, a59.y, a59.width, a59.height), this.requestRender(), ++this._tileIndex, 4 === this._faceIndex && this._tileIndex === this._tilesPerFace ? (this.running = this._dirty, this._faceIndex = 0, this._tileIndex = 0, this.running || (this.context.renderContext.bindParameters.cloudsFade.renderingStage = n30.FADING)) : this._tileIndex === this._tilesPerFace && (++this._faceIndex, this._tileIndex = 0), e71.madeProgress(), o12;
  }
};
e6([y2({
  constructOnly: true
})], A15.prototype, "context", void 0), e6([y2({
  constructOnly: true
})], A15.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], A15.prototype, "requestRender", void 0), e6([y2()], A15.prototype, "coverage", void 0), e6([y2()], A15.prototype, "density", void 0), e6([y2()], A15.prototype, "absorption", void 0), e6([y2()], A15.prototype, "cloudSize", void 0), e6([y2()], A15.prototype, "detailSize", void 0), e6([y2()], A15.prototype, "smoothness", void 0), e6([y2()], A15.prototype, "cloudHeight", void 0), e6([y2()], A15.prototype, "raymarchingSteps", void 0), e6([y2()], A15.prototype, "running", void 0), A15 = e6([a4("esri.views.3d.environment.CloudsGenerator")], A15);
var B7 = [r15(1, 0, 0), r15(-1, 0, 0), r15(0, 1, 0), r15(0, -1, 0), r15(0, 0, 1)];
var H9 = [r15(0, 1, 0), r15(0, 1, 0), r15(0, 0, -1), r15(0, 0, 1), r15(0, 1, 0)];
var O15 = o14();

// ../../../node_modules/@arcgis/core/views/3d/environment/FogTechnique.js
var m26 = class _m extends r17 {
  constructor(e71) {
    super(e71, new t18(), () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _m.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.SRC_ALPHA, R3.ZERO, R3.ONE_MINUS_SRC_ALPHA, R3.ONE),
      colorWrite: _9
    });
  }
};
m26.shader = new t16(b9, () => import("./Fog.glsl-BS7WIXSD.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/Fog.js
var b11 = 0.95;
var v11 = 1;
var x9 = class extends S3 {
  constructor(t71) {
    super(t71), this._passParameters = new u19();
    const e71 = t71.context.renderContext.rctx;
    this._vao = i21(e71, m22), this._technique = new m26(t71);
    const s67 = s6(t71.view.spatialReference);
    this._planetRadius = s67.radius, this._atmosphereRadius = s67.radius + n35;
  }
  destroy() {
    this._technique.release(), this._vao.dispose();
  }
  set strength(t71) {
    this._passParameters.fogStrength = t71;
  }
  get strength() {
    return this._passParameters.fogStrength;
  }
  render(t71, e71) {
    if (this._update(t71, e71), this._passParameters.fogAmount <= 0) return;
    const s67 = this._technique;
    if (!s67.compiled) return void this.context.requestRender();
    const r57 = t71.offscreenRenderingHelper;
    r57.renderDepthDetached(() => {
      this._passParameters.depthTexture = r57.depthTexture;
      const e72 = t71.rctx.bindTechnique(s67, t71.bindParameters, this._passParameters);
      this._renderFog(e72, t71);
    });
  }
  _renderFog(t71, e71) {
    const s67 = e71.rctx;
    s67.bindVAO(this._vao), t71.assertCompatibleVertexAttributeLocations(this._vao), s67.drawArrays(E7.TRIANGLE_STRIP, 0, 4);
  }
  _update(t71, e71) {
    const r57 = t71.bindParameters.camera;
    z(P8, r57.eye);
    const o60 = Math.max(0, P3(P8, t71.bindParameters.lighting.mainLight.direction)), p49 = e71.color;
    g3(w12, p49, 0.1), A4(this._passParameters.fogColor, w12, p49, o60);
    const h32 = s8(r57.eye), u46 = h32 * h32;
    this._passParameters.atmosphereC = u46 - this._atmosphereRadius * this._atmosphereRadius, this._passParameters.fogAmount = (1 - p4(b11 * p16, v11 * p16, Math.abs(h32 - this._planetRadius))) * e71.amount, this._passParameters.fogStrength = e71.strength;
  }
};
e6([y2({
  constructOnly: true
})], x9.prototype, "context", void 0), e6([y2({
  constructOnly: true
})], x9.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], x9.prototype, "rctx", void 0), e6([y2({
  constructOnly: true
})], x9.prototype, "viewingMode", void 0), x9 = e6([a4("esri.views.3d.environment.Fog")], x9);
var y10 = class {
  constructor() {
    this.color = n7(), this.strength = 0, this.amount = 0;
  }
};
var P8 = n7();
var w12 = n7();

// ../../../node_modules/@arcgis/core/views/3d/environment/SimpleAtmosphereTechnique.js
var h16 = class _h extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _h.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return this.configuration.geometry === r35.Cylinder ? S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      culling: r16,
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    }) : S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
h16.shader = new t16(h13, () => import("./SimpleAtmosphere.glsl-B2BHPY35.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/resources/SimpleAtmosphereTexture.js
var e40 = new Uint8ClampedArray([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 12, 0, 0, 0, 12, 0, 0, 0, 12, 0, 0, 0, 12, 0, 0, 0, 13, 0, 0, 0, 13, 0, 0, 0, 13, 0, 0, 0, 13, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 15, 0, 0, 0, 15, 0, 0, 0, 15, 0, 0, 0, 15, 0, 0, 0, 15, 16, 0, 0, 16, 16, 0, 0, 16, 16, 0, 0, 16, 16, 0, 0, 16, 15, 0, 0, 17, 15, 0, 0, 17, 15, 0, 0, 17, 15, 0, 0, 17, 14, 0, 0, 18, 14, 0, 0, 18, 14, 0, 0, 18, 13, 0, 0, 19, 13, 0, 0, 19, 13, 0, 0, 19, 13, 0, 0, 19, 13, 0, 0, 20, 13, 0, 0, 20, 13, 0, 0, 20, 13, 0, 0, 20, 12, 0, 0, 21, 12, 0, 0, 21, 12, 0, 0, 21, 12, 0, 0, 21, 12, 0, 0, 22, 12, 0, 0, 22, 12, 0, 0, 22, 12, 0, 0, 22, 11, 0, 0, 23, 11, 0, 0, 23, 11, 0, 0, 23, 11, 0, 0, 24, 11, 0, 0, 24, 11, 0, 0, 24, 11, 0, 0, 24, 10, 0, 0, 25, 10, 0, 0, 25, 10, 0, 0, 25, 10, 0, 0, 26, 10, 0, 0, 26, 10, 0, 0, 26, 10, 0, 0, 26, 9, 0, 0, 27, 9, 0, 0, 27, 9, 0, 0, 27, 18, 0, 0, 28, 18, 0, 0, 28, 18, 0, 0, 28, 18, 0, 0, 28, 18, 0, 0, 29, 18, 0, 0, 29, 18, 0, 0, 29, 17, 0, 0, 30, 17, 0, 0, 30, 17, 0, 0, 30, 17, 0, 0, 30, 16, 0, 0, 31, 16, 0, 0, 31, 16, 0, 0, 31, 16, 0, 0, 32, 16, 0, 0, 32, 16, 0, 0, 32, 15, 0, 0, 33, 15, 0, 0, 33, 15, 0, 0, 33, 15, 0, 0, 34, 15, 8, 0, 34, 15, 8, 0, 34, 15, 8, 0, 34, 15, 7, 0, 35, 15, 7, 0, 35, 15, 7, 0, 35, 21, 7, 0, 36, 21, 7, 0, 36, 21, 7, 0, 36, 21, 7, 0, 37, 21, 7, 0, 37, 21, 7, 0, 37, 20, 7, 0, 38, 20, 7, 0, 38, 20, 7, 0, 38, 20, 7, 0, 39, 20, 7, 0, 39, 20, 7, 0, 39, 20, 7, 0, 39, 19, 6, 0, 40, 19, 6, 0, 40, 19, 6, 0, 40, 19, 6, 0, 41, 19, 6, 0, 41, 19, 6, 0, 41, 18, 6, 0, 42, 18, 6, 0, 42, 18, 6, 0, 42, 24, 6, 0, 43, 24, 6, 0, 43, 24, 6, 0, 43, 23, 6, 0, 44, 23, 6, 0, 44, 23, 6, 0, 44, 23, 6, 0, 45, 23, 6, 0, 45, 23, 6, 0, 45, 22, 6, 0, 46, 22, 6, 0, 46, 22, 6, 0, 46, 22, 5, 0, 47, 22, 5, 0, 47, 22, 5, 0, 47, 21, 5, 0, 48, 21, 5, 0, 48, 21, 5, 0, 48, 21, 5, 0, 49, 21, 5, 0, 49, 26, 5, 0, 49, 25, 5, 0, 50, 25, 5, 0, 50, 25, 5, 0, 50, 25, 5, 0, 51, 25, 5, 0, 51, 25, 5, 0, 51, 25, 5, 0, 52, 25, 5, 0, 52, 25, 5, 0, 52, 24, 5, 0, 53, 24, 5, 0, 53, 24, 5, 0, 53, 24, 9, 0, 54, 28, 9, 0, 54, 28, 9, 0, 54, 28, 9, 0, 55, 28, 9, 0, 55, 27, 9, 0, 56, 27, 9, 0, 56, 27, 9, 0, 56, 27, 9, 4, 57, 27, 9, 4, 57, 27, 9, 4, 57, 26, 9, 4, 58, 26, 9, 4, 58, 26, 9, 4, 58, 26, 9, 4, 59, 26, 9, 4, 59, 26, 9, 4, 59, 26, 8, 4, 60, 30, 8, 4, 60, 30, 8, 4, 60, 29, 8, 4, 61, 29, 8, 4, 61, 29, 8, 4, 62, 29, 8, 4, 62, 29, 8, 4, 62, 28, 8, 4, 63, 28, 8, 4, 63, 28, 8, 4, 63, 28, 12, 4, 64, 28, 12, 4, 64, 28, 12, 4, 64, 27, 12, 4, 65, 27, 12, 8, 65, 27, 12, 8, 65, 31, 12, 8, 66, 31, 12, 8, 66, 30, 11, 8, 67, 30, 11, 8, 67, 30, 11, 8, 67, 30, 11, 8, 68, 30, 11, 8, 68, 30, 11, 8, 68, 30, 15, 7, 69, 30, 15, 7, 69, 30, 15, 7, 69, 33, 15, 11, 70, 33, 15, 11, 70, 32, 14, 11, 71, 32, 14, 11, 71, 32, 14, 11, 71, 32, 18, 14, 72, 32, 18, 14, 72, 32, 18, 14, 72, 31, 17, 14, 73, 35, 17, 14, 73, 34, 17, 17, 74, 34, 21, 17, 74, 34, 21, 17, 74, 34, 20, 17, 75, 34, 20, 20, 75, 34, 20, 20, 75, 34, 23, 20, 76, 34, 23, 20, 76, 36, 23, 23, 77, 36, 23, 23, 77, 36, 23, 23, 77, 36, 23, 23, 78, 36, 26, 26, 78, 36, 26, 26, 78, 36, 26, 26, 79, 36, 26, 29, 79, 38, 26, 29, 80, 38, 29, 29, 80, 38, 29, 29, 80, 38, 28, 31, 81, 38, 28, 31, 81, 38, 31, 31, 81, 37, 31, 34, 82, 37, 31, 34, 82, 37, 31, 37, 83, 40, 34, 37, 83, 40, 34, 37, 83, 39, 33, 39, 84, 39, 33, 39, 84, 39, 36, 42, 84, 39, 36, 42, 85, 39, 36, 42, 85, 39, 36, 42, 85, 39, 39, 44, 86, 39, 39, 44, 86, 41, 38, 47, 87, 41, 41, 47, 87, 41, 41, 50, 87, 41, 41, 49, 88, 41, 41, 52, 88, 40, 43, 52, 89, 43, 43, 52, 89, 43, 43, 54, 89, 42, 45, 54, 90, 42, 45, 57, 90, 42, 45, 57, 90, 42, 45, 59, 91, 42, 48, 59, 91, 44, 47, 61, 92, 44, 47, 61, 92, 44, 50, 61, 92, 44, 49, 63, 93, 44, 49, 63, 93, 44, 52, 66, 93, 43, 52, 65, 94, 46, 54, 68, 94, 46, 54, 70, 95, 46, 54, 70, 95, 46, 54, 70, 95, 45, 56, 72, 96, 45, 56, 72, 96, 45, 58, 74, 97, 47, 58, 76, 97, 47, 58, 76, 97, 47, 60, 78, 98, 47, 60, 78, 98, 47, 60, 81, 98, 49, 62, 80, 99, 49, 62, 82, 99, 48, 61, 84, 100, 48, 64, 84, 100, 48, 64, 84, 100, 50, 63, 86, 101, 50, 66, 86, 101, 50, 66, 88, 101, 50, 65, 90, 102, 52, 67, 89, 103, 51, 69, 91, 104, 51, 68, 92, 105, 52, 69, 93, 107, 52, 71, 94, 108, 54, 70, 96, 109, 53, 71, 96, 111, 52, 73, 98, 112, 54, 72, 98, 114, 53, 73, 100, 115, 54, 72, 100, 117, 54, 73, 102, 118, 55, 74, 104, 120, 55, 76, 105, 121, 56, 77, 106, 123, 56, 76, 107, 124, 57, 79, 107, 126, 58, 78, 110, 128, 57, 79, 111, 129, 56, 80, 113, 131, 58, 79, 112, 132, 57, 82, 114, 134, 58, 81, 116, 136, 60, 82, 117, 137, 59, 83, 117, 139, 60, 83, 119, 141, 59, 84, 120, 142, 60, 85, 122, 144, 59, 86, 122, 146, 60, 86, 126, 148, 62, 87, 127, 149, 61, 88, 127, 151, 62, 88, 128, 153, 63, 89, 130, 155, 62, 90, 131, 156, 63, 90, 132, 158, 64, 91, 134, 160, 65, 91, 135, 162, 64, 92, 136, 163, 63, 93, 138, 165, 66, 95, 139, 167, 65, 95, 140, 169, 66, 95, 142, 171, 67, 96, 142, 172, 66, 97, 144, 174, 67, 99, 145, 176, 67, 97, 148, 178, 67, 99, 147, 180, 68, 100, 149, 181, 68, 100, 150, 183, 69, 101, 152, 185, 70, 102, 153, 187, 71, 103, 155, 188, 70, 103, 156, 190, 70, 104, 157, 192, 71, 105, 158, 194, 71, 106, 160, 195, 72, 106, 161, 197, 72, 108, 161, 199, 73, 108, 163, 200, 73, 109, 164, 202, 74, 109, 165, 204, 74, 110, 167, 206, 75, 111, 168, 207, 74, 112, 170, 209, 75, 112, 170, 210, 76, 113, 171, 212, 76, 114, 173, 214, 77, 115, 174, 215, 78, 115, 175, 217, 78, 116, 175, 218, 78, 117, 177, 220, 78, 118, 178, 221, 79, 118, 180, 223, 80, 120, 180, 224, 81, 120, 181, 226, 81, 120, 182, 227, 82, 121, 184, 229, 82, 122, 185, 230, 84, 123, 186, 232, 83, 123, 187, 233, 84, 124, 189, 234, 84, 125, 188, 235, 85, 126, 189, 237, 86, 126, 190, 238, 86, 127, 191, 239, 87, 127, 192, 240, 87, 129, 193, 242, 88, 129, 194, 243, 89, 130, 195, 244, 90, 131, 196, 245, 90, 132, 197, 246, 91, 132, 197, 247, 92, 133, 198, 248, 92, 134, 199, 249, 93, 135, 200, 250, 94, 136, 201, 251, 95, 137, 202, 252, 96, 138, 203, 253, 97, 140, 204, 254, 98, 141, 205, 254, 99, 142, 206, 255, 101, 143, 207, 255, 102, 144, 208, 255, 103, 146, 209, 255, 104, 147, 209, 255, 106, 148, 210, 255, 107, 149, 211, 255, 108, 151, 212, 255, 110, 152, 213, 255, 111, 153, 213, 255, 112, 154, 214, 255, 114, 156, 215, 255, 115, 157, 215, 255, 117, 158, 216, 255, 118, 160, 217, 255, 120, 161, 217, 255, 121, 162, 218, 255, 123, 164, 218, 255, 124, 165, 219, 255, 125, 166, 219, 255, 127, 167, 220, 255, 129, 169, 220, 255, 130, 170, 221, 255, 132, 171, 221, 255, 133, 173, 222, 255, 134, 174, 222, 255, 136, 175, 223, 255, 139, 178, 224, 255, 142, 180, 224, 255, 144, 182, 225, 255, 147, 185, 226, 255, 150, 187, 226, 255, 153, 189, 227, 255, 155, 191, 228, 255, 158, 194, 228, 255, 160, 196, 229, 255, 163, 198, 229, 255, 165, 200, 230, 255, 168, 202, 231, 255, 170, 203, 231, 255, 172, 205, 232, 255, 174, 207, 232, 255, 176, 209, 233, 255, 178, 210, 234, 255, 180, 212, 234, 255, 182, 214, 235, 255, 184, 215, 236, 255, 186, 217, 237, 255, 188, 219, 238, 255, 190, 220, 238, 255, 192, 221, 239, 255, 193, 222, 240, 255, 194, 224, 240, 255, 196, 225, 241, 255, 197, 226, 241, 255, 198, 226, 242, 255, 199, 227, 242, 255, 200, 228, 242, 255, 201, 228, 243, 255, 202, 229, 243, 255, 203, 230, 243, 255, 204, 230, 244, 255, 205, 231, 244, 255, 207, 232, 244, 255, 208, 233, 245, 255, 209, 233, 245, 255, 211, 234, 246, 255, 213, 235, 246, 255, 217, 238, 247, 255, 222, 240, 248, 255, 226, 242, 249, 255, 231, 245, 250, 255, 236, 247, 251, 255, 241, 249, 252, 255, 245, 251, 253, 255, 249, 252, 254, 255, 255, 255, 255, 255]);

// ../../../node_modules/@arcgis/core/views/3d/environment/LocalAtmosphere.js
var A16 = class {
  constructor(e71, t71) {
    this.type = a32.Local, this._configuration = new i24(), this._passParameters = new p19(), this._configuration.geometry = r35.Cylinder, this._technique = t71.techniques.acquire(h16, this._configuration);
    const r57 = t71.renderContext.rctx;
    this._vao = y11(r57), this._vaoCount = i8(this._vao, "geometry");
    const p49 = new e22();
    p49.wrapMode = D2.CLAMP_TO_EDGE, p49.flipped = true, p49.width = 1, p49.height = 512, this._passParameters.texture = new c8(r57, p49, e40);
  }
  destroy() {
    this._passParameters.texture = r2(this._passParameters.texture), this._vao.dispose(), this._technique.release();
  }
  render(e71) {
    const t71 = e71.rctx, r57 = t71.bindTechnique(this._technique, e71.bindParameters, this._passParameters);
    T7(v12, e71.bindParameters.camera.viewMatrix), r57.setUniformMatrix4fv("view", v12), t71.bindVAO(this._vao), r57.assertCompatibleVertexAttributeLocations(this._vao), t71.drawArrays(E7.TRIANGLES, 0, this._vaoCount);
  }
  renderHaze() {
    return false;
  }
};
function y11(e71) {
  const t71 = lt(1, 2, false), {
    data: r57,
    indices: i49
  } = t71[0][1], o60 = P9.createBuffer(i49.length), s67 = o60.position;
  for (let m45 = 0; m45 < i49.length; ++m45) {
    const e72 = 3 * i49[m45 % 3 == 0 ? m45 + 2 : m45 % 3 == 2 ? m45 - 2 : m45];
    s67.set(m45, 0, r57[e72]), s67.set(m45, 1, r57[e72 + 1]), s67.set(m45, 2, r57[e72 + 2]);
  }
  return new r32(e71, O8, {
    geometry: t8(P9)
  }, {
    geometry: c7.createVertex(e71, F3.STATIC_DRAW, o60.buffer)
  });
}
function T7(e71, r57) {
  n9(e71, r57), e71[12] = 0, e71[13] = 0, e71[14] = 0, e71[15] = 1;
}
var v12 = e15();
var P9 = H2().vec3f(e18.POSITION);

// ../../../node_modules/@arcgis/core/views/3d/environment/resources/MarsAtmosphereTexture.js
var e41 = new Uint8ClampedArray([0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 6, 0, 0, 0, 6, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 7, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 8, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 9, 0, 0, 0, 10, 0, 0, 0, 10, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 11, 0, 0, 0, 12, 0, 0, 0, 12, 0, 0, 0, 12, 0, 0, 0, 13, 0, 0, 0, 13, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 14, 0, 0, 0, 15, 0, 0, 0, 15, 0, 0, 0, 16, 0, 0, 0, 16, 0, 0, 0, 16, 0, 0, 0, 17, 0, 0, 0, 17, 0, 0, 0, 18, 0, 0, 0, 18, 0, 0, 0, 19, 0, 0, 0, 19, 0, 0, 0, 19, 0, 0, 0, 20, 0, 0, 0, 20, 0, 0, 0, 21, 0, 0, 0, 21, 0, 0, 0, 22, 0, 0, 0, 22, 11, 0, 0, 23, 11, 0, 0, 23, 11, 0, 0, 23, 11, 0, 0, 23, 11, 0, 0, 24, 11, 0, 0, 24, 11, 0, 0, 24, 10, 0, 0, 25, 10, 0, 0, 25, 10, 0, 0, 26, 10, 0, 0, 26, 9, 0, 0, 27, 9, 0, 0, 27, 9, 0, 0, 28, 9, 0, 0, 28, 9, 0, 0, 29, 9, 0, 0, 29, 8, 0, 0, 30, 8, 0, 0, 30, 8, 0, 0, 31, 8, 0, 0, 31, 8, 0, 0, 32, 8, 0, 0, 32, 8, 0, 0, 32, 8, 0, 0, 32, 8, 0, 0, 33, 8, 0, 0, 33, 8, 0, 0, 34, 7, 0, 0, 35, 7, 0, 0, 35, 7, 0, 0, 36, 7, 0, 0, 36, 7, 7, 0, 37, 7, 7, 0, 37, 7, 7, 0, 38, 7, 7, 0, 38, 13, 7, 0, 39, 13, 7, 0, 39, 13, 6, 0, 40, 13, 6, 0, 40, 12, 6, 0, 41, 12, 6, 0, 41, 12, 6, 0, 41, 12, 6, 0, 42, 12, 6, 0, 42, 12, 6, 0, 43, 12, 6, 0, 43, 12, 6, 0, 44, 12, 6, 0, 44, 11, 6, 0, 45, 11, 6, 6, 45, 11, 6, 6, 46, 11, 5, 5, 47, 11, 5, 5, 47, 11, 5, 5, 48, 11, 5, 5, 48, 10, 5, 5, 49, 10, 5, 5, 49, 10, 5, 5, 50, 15, 5, 5, 51, 15, 5, 5, 51, 15, 5, 5, 51, 15, 5, 5, 51, 15, 5, 5, 52, 15, 5, 5, 52, 14, 5, 5, 53, 14, 5, 5, 54, 14, 5, 5, 54, 14, 5, 5, 55, 14, 5, 5, 55, 14, 5, 5, 56, 13, 4, 4, 57, 13, 4, 4, 57, 13, 4, 4, 58, 13, 4, 4, 58, 13, 4, 4, 59, 13, 4, 4, 59, 17, 4, 4, 60, 17, 4, 4, 60, 17, 4, 4, 60, 17, 4, 4, 61, 17, 4, 4, 61, 16, 4, 4, 62, 16, 4, 4, 63, 16, 4, 4, 63, 16, 8, 4, 64, 16, 8, 4, 64, 16, 8, 4, 65, 15, 8, 4, 66, 15, 8, 4, 66, 15, 8, 4, 67, 19, 8, 4, 68, 19, 8, 4, 68, 18, 7, 4, 69, 18, 7, 4, 69, 18, 7, 4, 69, 18, 7, 4, 70, 18, 7, 4, 70, 18, 7, 4, 71, 18, 7, 4, 71, 18, 7, 4, 72, 17, 7, 3, 73, 17, 7, 3, 73, 21, 7, 3, 74, 21, 7, 3, 74, 20, 7, 3, 75, 20, 7, 3, 76, 20, 7, 3, 76, 20, 7, 3, 77, 20, 7, 3, 77, 20, 7, 3, 78, 20, 7, 3, 78, 20, 7, 7, 78, 19, 6, 6, 79, 19, 10, 6, 80, 19, 10, 6, 80, 22, 9, 6, 81, 22, 9, 6, 81, 22, 9, 6, 82, 22, 9, 6, 83, 22, 9, 6, 83, 21, 9, 6, 84, 21, 9, 6, 84, 21, 9, 6, 85, 21, 9, 6, 86, 21, 9, 6, 86, 23, 9, 6, 87, 23, 9, 6, 87, 23, 9, 6, 87, 23, 9, 6, 88, 23, 9, 6, 88, 23, 9, 6, 89, 23, 8, 6, 90, 23, 8, 6, 90, 22, 8, 6, 91, 22, 8, 6, 91, 25, 8, 6, 92, 25, 8, 5, 93, 25, 8, 5, 93, 24, 8, 5, 94, 24, 8, 5, 94, 24, 11, 5, 95, 24, 11, 5, 96, 24, 11, 5, 96, 26, 11, 5, 97, 26, 11, 5, 97, 26, 11, 5, 97, 26, 10, 5, 98, 26, 10, 5, 98, 26, 10, 5, 99, 25, 10, 5, 100, 25, 10, 5, 100, 25, 10, 5, 101, 25, 10, 5, 101, 25, 10, 5, 102, 27, 10, 5, 103, 27, 10, 5, 103, 27, 10, 5, 104, 27, 10, 5, 104, 27, 12, 5, 105, 26, 12, 5, 106, 26, 12, 5, 106, 29, 12, 5, 106, 29, 12, 5, 106, 29, 12, 7, 107, 28, 12, 7, 108, 28, 12, 7, 108, 28, 12, 7, 109, 28, 12, 7, 109, 30, 12, 7, 110, 30, 11, 7, 111, 30, 11, 7, 111, 30, 11, 7, 112, 30, 11, 7, 112, 29, 11, 7, 113, 29, 11, 7, 114, 29, 11, 7, 114, 31, 11, 7, 115, 31, 11, 7, 115, 31, 11, 7, 115, 31, 11, 7, 116, 31, 11, 7, 116, 33, 13, 7, 117, 33, 13, 9, 117, 32, 13, 9, 118, 32, 13, 9, 118, 32, 13, 9, 119, 34, 15, 8, 120, 34, 15, 8, 120, 34, 15, 8, 121, 36, 15, 8, 121, 36, 15, 8, 122, 36, 15, 8, 122, 35, 15, 8, 123, 37, 14, 8, 124, 37, 14, 8, 124, 37, 14, 8, 124, 37, 14, 8, 124, 39, 14, 8, 125, 39, 16, 8, 125, 38, 16, 8, 126, 38, 16, 8, 127, 38, 16, 8, 127, 40, 16, 10, 128, 40, 16, 10, 128, 40, 16, 10, 129, 42, 18, 10, 129, 41, 18, 10, 130, 41, 18, 10, 130, 43, 18, 10, 131, 43, 18, 10, 131, 42, 17, 10, 132, 42, 17, 12, 132, 42, 17, 12, 133, 44, 17, 12, 133, 44, 17, 12, 133, 46, 17, 11, 134, 46, 17, 11, 134, 45, 19, 11, 135, 45, 19, 11, 135, 47, 19, 11, 136, 47, 19, 11, 136, 47, 19, 11, 137, 47, 19, 11, 137, 48, 20, 11, 138, 48, 20, 11, 138, 50, 20, 13, 139, 50, 20, 13, 139, 49, 20, 13, 140, 49, 22, 13, 140, 51, 22, 13, 141, 51, 22, 13, 141, 50, 22, 13, 142, 52, 22, 13, 142, 52, 21, 12, 143, 53, 21, 12, 143, 53, 21, 12, 143, 53, 21, 12, 143, 53, 21, 14, 144, 53, 23, 14, 144, 55, 23, 14, 145, 55, 23, 14, 145, 56, 23, 14, 146, 56, 23, 14, 146, 57, 24, 14, 147, 57, 24, 14, 147, 59, 24, 16, 148, 59, 24, 16, 148, 58, 24, 15, 149, 58, 26, 15, 149, 58, 26, 15, 149, 60, 26, 15, 150, 60, 26, 15, 150, 61, 25, 15, 151, 61, 25, 15, 151, 62, 25, 17, 152, 62, 25, 17, 152, 64, 25, 17, 152, 64, 27, 17, 152, 63, 27, 17, 153, 63, 27, 17, 153, 65, 27, 17, 153, 66, 28, 17, 154, 66, 28, 17, 154, 67, 28, 16, 155, 67, 28, 16, 155, 67, 30, 16, 155, 69, 29, 18, 156, 69, 29, 18, 156, 68, 29, 18, 157, 70, 29, 18, 157, 70, 29, 18, 157, 71, 31, 18, 158, 71, 31, 18, 158, 72, 30, 19, 159, 72, 30, 19, 159, 74, 30, 19, 159, 73, 30, 19, 160, 73, 32, 19, 160, 74, 32, 19, 161, 74, 32, 21, 161, 76, 32, 21, 161, 78, 33, 21, 161, 78, 33, 21, 161, 79, 35, 20, 162, 78, 34, 20, 163, 79, 34, 22, 164, 81, 36, 22, 164, 82, 36, 22, 165, 81, 35, 22, 166, 82, 37, 21, 167, 84, 37, 21, 167, 85, 36, 21, 168, 86, 38, 23, 169, 88, 38, 23, 169, 88, 38, 23, 170, 88, 39, 23, 170, 89, 39, 24, 171, 91, 40, 24, 171, 92, 40, 24, 172, 93, 40, 24, 173, 94, 41, 25, 173, 95, 41, 25, 174, 96, 42, 25, 175, 98, 42, 25, 175, 99, 43, 26, 176, 99, 43, 26, 177, 101, 45, 26, 177, 102, 44, 26, 178, 103, 46, 27, 179, 104, 46, 27, 179, 105, 46, 27, 179, 106, 45, 28, 180, 108, 47, 28, 180, 108, 46, 28, 181, 109, 48, 28, 182, 111, 48, 29, 182, 111, 49, 29, 183, 114, 49, 29, 184, 114, 50, 30, 184, 114, 50, 30, 185, 116, 51, 30, 185, 117, 51, 30, 186, 119, 52, 31, 187, 119, 53, 31, 187, 121, 53, 31, 188, 122, 54, 33, 188, 123, 54, 32, 189, 124, 55, 32, 189, 125, 55, 32, 189, 126, 56, 34, 190, 128, 56, 34, 190, 128, 57, 33, 191, 130, 57, 33, 191, 131, 58, 35, 192, 131, 58, 35, 192, 133, 59, 34, 193, 134, 60, 35, 194, 135, 60, 35, 194, 136, 61, 37, 195, 139, 61, 37, 195, 139, 62, 36, 196, 141, 62, 36, 196, 141, 63, 38, 197, 142, 63, 38, 197, 143, 64, 39, 198, 144, 64, 39, 198, 146, 66, 39, 198, 146, 67, 39, 198, 147, 67, 38, 199, 147, 68, 40, 199, 149, 68, 40, 200, 150, 69, 40, 200, 152, 70, 41, 201, 154, 71, 41, 201, 154, 71, 42, 202, 155, 72, 42, 202, 156, 73, 41, 203, 157, 73, 43, 203, 158, 74, 42, 204, 160, 75, 44, 204, 161, 76, 44, 204, 162, 77, 44, 205, 164, 77, 45, 205, 165, 78, 45, 206, 166, 79, 45, 206, 168, 80, 46, 207, 169, 81, 46, 207, 170, 83, 47, 207, 171, 83, 47, 207, 172, 83, 47, 207, 174, 85, 48, 208, 175, 85, 48, 208, 177, 85, 48, 209, 178, 87, 49, 209, 180, 87, 49, 210, 181, 87, 49, 210, 182, 89, 50, 210, 182, 89, 50, 211, 185, 91, 50, 211, 186, 91, 51, 212, 186, 93, 51, 212, 189, 94, 52, 212, 190, 95, 51, 213, 192, 96, 51, 213, 193, 96, 53, 213, 194, 97, 52, 214, 195, 98, 54, 214, 197, 98, 55, 215, 198, 100, 55, 215, 199, 101, 55, 215, 200, 102, 55, 216, 202, 103, 55, 216, 203, 104, 55, 216, 204, 105, 57, 216, 205, 106, 57, 216, 207, 107, 58, 216, 208, 108, 58, 217, 209, 109, 59, 217, 210, 110, 60, 217, 211, 111, 60, 218, 212, 112, 61, 218, 213, 113, 61, 218, 214, 114, 62, 219, 217, 115, 63, 219, 217, 116, 64, 219, 218, 118, 64, 220, 219, 119, 65, 220, 220, 121, 66, 220, 222, 121, 67, 221, 222, 122, 67, 221, 222, 123, 68, 221, 223, 124, 69, 222, 224, 125, 70, 222, 225, 127, 71, 222, 226, 128, 72, 223, 228, 129, 73, 223, 228, 130, 74, 223, 229, 132, 75, 223, 230, 135, 79, 224, 231, 138, 81, 224, 233, 141, 84, 224, 233, 144, 87, 225, 235, 147, 91, 225, 236, 150, 94, 225, 237, 154, 97, 225, 238, 158, 102, 225, 239, 161, 107, 225, 239, 165, 110, 225, 240, 168, 114, 226, 241, 172, 118, 226, 241, 176, 122, 226, 241, 181, 126, 226, 242, 183, 130, 227, 243, 186, 135, 227, 243, 190, 139, 227, 244, 194, 143, 227, 244, 197, 147, 228, 244, 200, 150, 228, 245, 204, 154, 228, 245, 207, 157, 228, 245, 210, 161, 229, 246, 212, 164, 229, 246, 215, 167, 229, 246, 217, 169, 229, 246, 220, 172, 230, 247, 221, 174, 230]);

// ../../../node_modules/@arcgis/core/views/3d/environment/MarsAtmosphere.js
var E20 = 128;
var G9 = -o36;
var H10 = 0;
var N7 = 50;
var k6 = () => 1 - 511 / 512;
var B8 = k3([[50, 0.1015625], [500, 0.21875], [5e3, 1 - 250 / 512], [5e4, 0.4140625]]);
var z9 = class {
  constructor(e71, t71) {
    this.view = e71, this.type = a32.Mars, this._passParameters = new p19(), this._vaoCount = 0, this._texV1 = 1;
    const s67 = s6(e71.spatialReference);
    this._planetRadius = s67.radius, this._outerRimWidth = s67.outerAtmosphereRimWidth, this._innerRimFactor = (this._planetRadius + G9) / this._planetRadius, this._middleRimFactor = (this._planetRadius + H10) / this._planetRadius, this._outerRimFactor = (this._planetRadius + this._outerRimWidth) / this._planetRadius, this._texV0 = H10 / this._outerRimWidth, this._texVScale = this._texV1 - this._texV0, this._techniques = t71.techniques;
    const a59 = t71.renderContext.rctx;
    this._cameraChangeHandle = d2(() => this.view.state?.camera, () => t71.requestRender(), A3), this._vao = this._createRibbon(a59), this._vaoCount = i8(this._vao, "geometry"), this._fadeVao = i21(a59), this._fadeVaoCount = i8(this._fadeVao, "geometry");
    const o60 = new e22();
    o60.wrapMode = D2.CLAMP_TO_EDGE, o60.flipped = true, o60.width = 1, o60.height = 512, this._passParameters.texture = new c8(a59, o60, e41);
    const n63 = new i24();
    n63.geometry = r35.Cone, this._coneTechnique = this._techniques.acquire(h16, n63), n63.geometry = r35.Underground, this._undergroundTechnique = this._techniques.acquire(h16, n63);
  }
  destroy() {
    this._coneTechnique.release(), this._undergroundTechnique.release(), this._cameraChangeHandle.remove(), this._passParameters.texture = r2(this._passParameters.texture), this._fadeVao.dispose(), this._vao.dispose();
  }
  render(e71) {
    const t71 = e71.bindParameters.camera;
    this._update(t71);
    const s67 = e71.rctx;
    this._passParameters.undergroundFadeAlpha < 1 && (s67.bindTechnique(this._coneTechnique, e71.bindParameters, this._passParameters), s67.bindVAO(this._vao), s67.drawArrays(E7.TRIANGLES, 0, this._vaoCount)), this._passParameters.undergroundFadeAlpha > 0 && (s67.bindTechnique(this._undergroundTechnique, e71.bindParameters, this._passParameters), s67.bindVAO(this._fadeVao), s67.drawArrays(E7.TRIANGLE_STRIP, 0, this._fadeVaoCount));
  }
  renderHaze() {
  }
  _update(s67) {
    const r57 = n7(), i49 = this._planetRadius, a59 = s8(s67.eye), o60 = a59 - i49;
    if (o60 < 0) {
      const e71 = Math.min(-o60 / 5e3, 1);
      this._passParameters.undergroundFadeAlpha = e71;
    } else this._passParameters.undergroundFadeAlpha = 0;
    const c44 = Math.max(N7, o60), p49 = i49 + G9;
    this._passParameters.innerScale = Y5(i49 + c44, i49, p49) - 1, this._passParameters.altitudeFade = e38(o60), g3(r57, s67.eye, (i49 + N7) / a59), J5(r57, s67.center, s67.up, i49, this._passParameters.silhouette);
    const u46 = this._computeScreenRimWidth(s67, r57, s67.up, this._passParameters.silhouette), l47 = k6(), d38 = B8(o60);
    let f46 = this._texV0 + l47 * this._texVScale, g28 = this._texV0 + u46 * d38 * this._texVScale;
    if (o60 > N7) {
      J5(s67.eye, s67.center, s67.up, i49, this._passParameters.silhouette);
      const r58 = this._computeScreenRimWidth(s67, s67.eye, s67.up, this._passParameters.silhouette), a60 = e12((r58 - 1.5) / (u46 - 1.5), 0, 1);
      f46 = this._texV0 + a60 * l47 * this._texVScale, g28 = this._texV0 + f4(this._texV1, u46 * d38, a60) * this._texVScale;
    }
    o13(this._passParameters.texV, f46, g28);
  }
  _createRibbon(e71) {
    const t71 = t10(3 + 3 * E20 * 3), s67 = new Uint32Array(3 * E20 * 5);
    t71[0] = 0, t71[1] = 0, t71[2] = -1;
    for (let a59 = 0; a59 < E20; a59++) {
      const e72 = 9 * a59 + 3;
      t71[e72] = a59, t71[e72 + 1] = this._innerRimFactor, t71[e72 + 2] = -1, t71[e72 + 3] = a59, t71[e72 + 4] = this._middleRimFactor, t71[e72 + 5] = 0, t71[e72 + 6] = a59, t71[e72 + 7] = this._outerRimFactor, t71[e72 + 8] = 1;
      const r58 = 3 * a59 + 1, i50 = a59 === E20 - 1 ? 1 : r58 + 3, o60 = 15 * a59;
      s67[o60] = r58, s67[o60 + 1] = r58 + 1, s67[o60 + 2] = i50 + 1, s67[o60 + 3] = i50 + 1, s67[o60 + 4] = i50, s67[o60 + 5] = r58, s67[o60 + 6] = r58 + 1, s67[o60 + 7] = r58 + 2, s67[o60 + 8] = i50 + 2, s67[o60 + 9] = i50 + 2, s67[o60 + 10] = i50 + 1, s67[o60 + 11] = r58 + 1, s67[o60 + 12] = r58, s67[o60 + 13] = i50, s67[o60 + 14] = 0;
    }
    const r57 = Z4.createBuffer(s67.length), i49 = r57.position;
    for (let a59 = 0; a59 < s67.length; ++a59) {
      const e72 = 3 * s67[a59];
      i49.set(a59, 0, t71[e72]), i49.set(a59, 1, t71[e72 + 1]), i49.set(a59, 2, t71[e72 + 2]);
    }
    return new r32(e71, O8, {
      geometry: t8(Z4)
    }, {
      geometry: c7.createVertex(e71, F3.STATIC_DRAW, r57.buffer)
    });
  }
  _computeScreenRimWidth(e71, t71, s67, r57) {
    return u5(Q6, r57.center, r57.v2), g3(X6, Q6, this._outerRimFactor), X2(K6, t71, Q6, s67), a14(Q6, K6, e71.projectionMatrix, e71.viewport, Q6), a14(X6, K6, e71.projectionMatrix, e71.viewport, X6), x(Q6, X6) / e71.height;
  }
};
function J5(e71, t71, s67, r57, i49) {
  const a59 = s8(e71), o60 = r57 * Math.sqrt(a59 * a59 - r57 * r57) / a59, n63 = Math.sqrt(r57 * r57 - o60 * o60), c44 = i49.v1, p49 = i49.v2;
  return g3(i49.center, e71, n63 / a59), _2(c44, e71, t71), v3(c44) < 1 && _2(c44, e71, s67), g3(c44, c44, o60 / s8(c44)), _2(p49, c44, e71), g3(p49, p49, o60 / s8(p49)), o60;
}
var K6 = e15();
var Q6 = n7();
var X6 = n7();
function Y5(e71, t71, s67) {
  return e71 * e71 / (Math.sqrt(e71 * e71 - t71 * t71) * Math.sqrt(e71 * e71 - s67 * s67) + t71 * s67);
}
var Z4 = H2().vec3f(e18.POSITION);

// ../../../node_modules/@arcgis/core/views/3d/environment/PrecipitationTechnique.js
var g13 = class extends n15 {
  constructor() {
    super(...arguments), this.time = 0, this.radius = 1, this.width = 500, this.opacity = 1;
  }
};
var d24 = class _d extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _d.shader.get().build(this.configuration), h17);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.ONE, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
d24.shader = new t16(A13, () => import("./Precipitation.glsl-GUVV6Q6L.js"));
var h17 = /* @__PURE__ */ new Map([[e18.POSITION, 0], [e18.INSTANCEFEATUREATTRIBUTE, 1]]);

// ../../../node_modules/@arcgis/core/views/3d/environment/Precipitation.js
var g14 = class extends S3 {
  constructor(e71) {
    super(e71), this._numParticles = 25e4, this._rainSpeed = 0.1, this._snowSpeed = 0.01, this._passParameters = new g13(), this._animation = new e25(), this._passParameters.time = 0, this._passParameters.radius = s6(e71.view.spatialReference).radius, this._techniques = e71.context.techniques;
  }
  destroy() {
    this._numParticles = 0, this._snowTechniqueCached = t2(this._snowTechniqueCached), this._rainTechniqueCached = t2(this._rainTechniqueCached), this._vao = r2(this._vao), this._instanceIdBuffer = r2(this._instanceIdBuffer);
  }
  get _rainTechnique() {
    if (null == this._rainTechniqueCached) {
      const e71 = new i25();
      e71.type = t42.Rain, this._rainTechniqueCached = this._techniques.acquire(d24, e71);
    }
    return this._rainTechniqueCached;
  }
  get _snowTechnique() {
    if (null == this._snowTechniqueCached) {
      const e71 = new i25();
      e71.type = t42.Snow, this._snowTechniqueCached = this._techniques.acquire(d24, e71);
    }
    return this._snowTechniqueCached;
  }
  update(e71) {
    return this._animation.advance(e71);
  }
  render(e71, t71, s67) {
    const r57 = "rainy" === s67 ? this._rainTechnique : this._snowTechnique;
    if (!r57.compiled) return void this.context.requestRender();
    const o60 = e71.rctx;
    if (this._ensureResources(o60), null == r57 || null == this._vao || null == this._instanceIdBuffer) return;
    if (null != e71.bindParameters.cloudsFade.data && (this._passParameters.opacity = e71.bindParameters.cloudsFade.opacity), this._passParameters.opacity <= 0) return;
    const a59 = 0.35;
    t71 = t71 < 0.5 ? f4(0, a59, 2 * t71) : f4(a59, 1, 2 * (t71 - 0.5)), this._passParameters.time = ("rainy" === s67 ? this._rainSpeed : this._snowSpeed) * u3(this._animation.time) % 1e5;
    const c44 = o60.bindTechnique(r57, e71.bindParameters, this._passParameters);
    o60.bindVAO(this._vao), c44.assertCompatibleVertexAttributeLocations(this._vao), E10(o60, h17, this._instanceIdBuffer, A17, 0), o60.drawArraysInstanced(E7.TRIANGLES, 0, 3, this._numParticles * t71), _8(o60, h17, this._instanceIdBuffer, A17);
  }
  _ensureResources(e71) {
    null == this._vao && (this._vao = P10(e71)), null == this._instanceIdBuffer && (this._instanceIdBuffer = this._createInstanceIndices(e71));
  }
  _createInstanceIndices(e71) {
    const t71 = [];
    for (let i49 = 0; i49 < this._numParticles; i49++) t71.push(i49);
    return c7.createVertex(e71, F3.STATIC_DRAW, new Float32Array(t71));
  }
};
function P10(e71) {
  const t71 = new Float32Array([-1, 0, 1, 1, 0, -1, 1, 0, 1]);
  return new r32(e71, h17, {
    geometry: t8(v13)
  }, {
    geometry: c7.createVertex(e71, F3.STATIC_DRAW, t71)
  });
}
e6([y2({
  constructOnly: true
})], g14.prototype, "context", void 0), e6([y2({
  constructOnly: true
})], g14.prototype, "view", void 0), g14 = e6([a4("esri.views.3d.environment.Precipitation")], g14);
var v13 = H2().vec3f(e18.POSITION);
var A17 = t8(H2().f32(e18.INSTANCEFEATUREATTRIBUTE), 1);

// ../../../node_modules/@arcgis/core/views/3d/environment/StarsTechnique.js
var u26 = class extends n15 {
  constructor() {
    super(...arguments), this.modelMatrix = e15();
  }
};
var h18 = class _h extends r17 {
  constructor(e71) {
    super(e71, new t18(), () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _h.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: {
        func: O6.LEQUAL
      },
      colorWrite: _9
    });
  }
};
h18.shader = new t16(f21, () => import("./Stars.glsl-OCUFG5DN.js"));

// ../../../node_modules/@arcgis/core/views/3d/environment/Stars.js
var x10 = class extends S3 {
  get updating() {
    return this._updatingTracking.updating || this.loading;
  }
  get loading() {
    return null != this._loadDataTask && !this._loadDataTask.finished;
  }
  constructor(t71) {
    super(t71), this._loadDataTask = null, this._numPoints = 0, this._passParameters = new u26(), this._updatingTracking = new h7();
  }
  initialize() {
    this._loadDataTask = this._createLoadDataTask();
  }
  destroy() {
    this._loadDataTask = e(this._loadDataTask), this._updatingTracking.destroy(), this._numPoints = 0, this._technique = t2(this._technique), this._vao = r2(this._vao), F5 = null;
  }
  render(t71) {
    const {
      rctx: e71
    } = t71;
    if (this._ensureResources(e71), null == this._technique || null == this._vao) return;
    if (!this._technique.compiled) return void this.requestRender();
    const s67 = e71.bindTechnique(this._technique, t71.bindParameters, this._passParameters);
    e71.bindVAO(this._vao), s67.assertCompatibleVertexAttributeLocations(this._vao), e71.drawArrays(E7.POINTS, 0, this._numPoints);
  }
  _ensureResources(t71) {
    if (null != this._technique || null == F5) return;
    this._technique = new h18({
      rctx: t71,
      viewingMode: this.view.state.viewingMode
    }), this._numPoints = F5.byteLength / V7;
    const e71 = new Float32Array(F5, 0, 2 * this._numPoints), s67 = new Uint8Array(F5, 2 * this._numPoints * 4, this._numPoints);
    this._vao = A18(t71, e71, s67, this._numPoints), this._updatingTracking.add(() => "virtual" !== this.view.environment.lighting.type ? this.view.environment.lighting.date : null, (t72) => this._update(t72), P);
  }
  _update(t71) {
    if (!t71) return;
    const e71 = (t71.getHours() / 12 + t71.getMinutes() / 60 * (2 / 24) + t71.getSeconds() / 60 * (2 / 1440) - 0.9972222) % 2, s67 = 2 * I12(t71), r57 = n9(this._passParameters.modelMatrix, U9);
    x4(r57, r57, -s67 * Math.PI), c4(r57, S12, r57), x4(r57, r57, -e71 * Math.PI), this.requestRender();
  }
  _createLoadDataTask() {
    if (null != F5) return null;
    const t71 = d((t72) => __async(this, null, function* () {
      const {
        data: s67
      } = yield i2("esri/views/3d/environment/resources/stars.wsv", {
        responseType: "array-buffer",
        signal: t72
      });
      L10(s67), F5 = s67;
    }));
    return t71.promise.catch((t72) => {
      b(t72) || n.getLogger(this).error(t72);
    }).then(() => {
      this.destroyed || (this.requestRender(), this.notifyChange("updating"));
    }), t71;
  }
};
function A18(t71, e71, s67, r57) {
  const i49 = C9.createBuffer(r57), o60 = i49.position, a59 = i49.color, n63 = i49.size;
  for (let f46 = 0; f46 < r57; f46++) {
    const t72 = e71[2 * f46], r58 = e71[2 * f46 + 1];
    o60.set(f46, 0, -Math.cos(t72) * Math.sin(r58)), o60.set(f46, 1, -Math.sin(t72) * Math.sin(r58)), o60.set(f46, 2, -Math.cos(r58));
    const i50 = O16(s67[f46]), c44 = M6(R6[i50[1]]);
    a59.set(f46, 0, 255 * c44[0]), a59.set(f46, 1, 255 * c44[1]), a59.set(f46, 2, 255 * c44[2]), a59.set(f46, 3, 255), n63.set(f46, i50[0]);
  }
  return new r32(t71, O8, {
    geometry: t8(C9)
  }, {
    geometry: c7.createVertex(t71, F3.STATIC_DRAW, i49.buffer)
  });
}
function I12(t71) {
  const e71 = t71, s67 = new Date(t71.getFullYear(), 0, 1, 11, 58, 56);
  return (+e71 - +s67) / (+new Date(t71.getFullYear() + 1, 0, 1, 11, 58, 55) - +s67);
}
function L10(t71) {
  if (!t71) throw new s("stars:no-data-received", "Failed to create stars because star catalogue is missing");
  const e71 = t71.byteLength / V7;
  if (e71 % 1 != 0 || e71 > 5e4 || e71 < 5e3) throw new s("stars:invalid-data", "Failed to create stars because star catalogue data is invalid");
}
function M6(t71) {
  return [parseInt(t71.substring(0, 2), 16), parseInt(t71.substring(2, 4), 16), parseInt(t71.substring(4, 6), 16)];
}
function O16(t71) {
  return t71 >= 192 ? [2.9, t71 - 192] : t71 >= 160 ? [2.5, t71 - 160] : t71 >= 128 ? [2, t71 - 128] : t71 >= 96 ? [1.5, t71 - 96] : t71 >= 64 ? [1, t71 - 64] : t71 >= 32 ? [0.7, t71 - 32] : [0.4, t71];
}
e6([y2({
  constructOnly: true
})], x10.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], x10.prototype, "requestRender", void 0), e6([y2({
  readOnly: true
})], x10.prototype, "updating", null), e6([y2()], x10.prototype, "_loadDataTask", void 0), e6([y2()], x10.prototype, "_updatingTracking", void 0), x10 = e6([a4("esri.views.3d.environment.Stars")], x10);
var R6 = ["9bb2ff", "9eb5ff", "aabfff", "bbccff", "ccd8ff ", "dae2ff", "e4e9ff", "eeefff", "f8f6ff", "fff9fb", "fff5ef", "fff1e5", "ffeddb", "ffe9d2", "ffe6ca", "ffe3c3", "ffe0bb", "ffddb4", "ffdaad", "ffd6a5", "ffd29c", "ffcc8f", "ffc178", "ffa94b", "ff7b00"];
var S12 = t6(1, 0, 0, 0, 0, 0.9174771405229186, 0.39778850739794974, 0, 0, -0.39778850739794974, 0.9174771405229186, 0, 0, 0, 0, 1);
var U9 = t6(1, 0, 0, 0, 0, 0.9174771405229186, -0.39778850739794974, 0, 0, 0.39778850739794974, 0.9174771405229186, 0, 0, 0, 0, 1);
var V7 = 9;
var C9 = H2().vec3f(e18.POSITION).vec4u8(e18.COLOR).f32(e18.SIZE);
var F5 = null;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Update.js
var e42;
!function(e71) {
  e71[e71.Immediate = 0] = "Immediate", e71[e71.Faded = 1] = "Faded";
}(e42 || (e42 = {}));

// ../../../node_modules/@arcgis/core/views/3d/environment/EnvironmentRenderer.js
var U10 = class extends u16 {
  constructor(e71) {
    super(e71), this.produces = /* @__PURE__ */ new Map([[E12.OPAQUE_ENVIRONMENT, () => !(null === this._atmosphere && null === this._stars)], [E12.TRANSPARENT_ENVIRONMENT, () => !(null === this._atmosphere)]]), this._context = null, this._atmosphere = null, this._oldWeatherParameters = new I13(), this._newWeatherParameters = new I13(), this._fadedWeatherParameters = new I13(), this._weatherParameters = this._newWeatherParameters;
  }
  initialize() {
    this.view._stage.addRenderPlugin(this);
  }
  destroy() {
    this.removeHandles(), this.uninitializeRenderContext(), null != this.view?._stage && this.view._stage.removeRenderPlugin(this), this._set("view", null);
  }
  get atmosphere() {
    return this._atmosphere;
  }
  get _atmosphereType() {
    return null != this.atmosphere ? this.atmosphere.type : a32.None;
  }
  consumes() {
    return this._atmosphereType === a32.Realistic ? n31 : t34;
  }
  updateAnimation(e71) {
    return null != this._precipitation && this._precipitation.update(e71);
  }
  get updating() {
    return null != this._stars && this._stars.updating || null != this._clouds && this._clouds.running;
  }
  get weatherVisible() {
    return s8(this.view.state.camera.eye) - s6(this.view.spatialReference).radius <= p16;
  }
  get usedMemory() {
    return this._clouds?.usedMemory ?? 0;
  }
  get _stars() {
    const e71 = this.view, t71 = e71.environment?.starsEnabled ?? false, r57 = this._get("_stars");
    return t71 && null != this._context ? null != r57 ? r57 : new x10({
      view: e71,
      requestRender: () => this._setNeedsRender()
    }) : (u(r57), null);
  }
  get _precipitation() {
    const e71 = this._get("_precipitation");
    if (!this._precipitationEnabled || null == this._context) return u(e71), null;
    const t71 = this.view, r57 = this._context;
    return null != e71 && e71.context === r57 ? e71 : (u(e71), new g14({
      context: r57,
      view: t71
    }));
  }
  get _clouds() {
    const e71 = this._get("_clouds");
    if (!this.weatherEnabled || null == this._context) return u(e71), null;
    if (null != e71) return e71;
    const t71 = this.view, r57 = this._context;
    return u(e71), new A15({
      context: r57,
      view: t71,
      requestRender: () => this._setNeedsRender()
    });
  }
  get _cloudsComposition() {
    const e71 = this._get("_cloudsComposition");
    if (!this.weatherEnabled || null == this._context) return u(e71), null;
    const t71 = this.view.state.viewingMode, r57 = this._context.renderContext.rctx, i49 = s6(this.view.spatialReference).radius;
    return null != e71 && e71.viewingMode === t71 && e71.planetRadius === i49 ? e71 : (u(e71), new m25({
      rctx: r57,
      viewingMode: t71,
      planetRadius: i49,
      requestRender: () => this._setNeedsRender()
    }));
  }
  get _fog() {
    const e71 = this._get("_fog");
    if (!this.weatherEnabled || null == this._context) return u(e71), null;
    if (null != e71) return e71;
    const t71 = this.view, r57 = this._context, i49 = this._context.renderContext.rctx, a59 = this.view.state.viewingMode;
    return new x9({
      context: r57,
      view: t71,
      rctx: i49,
      viewingMode: a59
    });
  }
  get weatherEnabled() {
    return !!this.view?.environmentManager?.weatherEnabled;
  }
  get _precipitationEnabled() {
    return this.weatherEnabled && ("rainy" === this.view.environment.weather.type || "snowy" === this.view.environment.weather.type);
  }
  initializeRenderContext(e71 = null) {
    this._context = e71;
    const t71 = () => this._setNeedsRender();
    this.addHandles([d2(() => ({
      viewingMode: this.view.state.viewingMode,
      enabled: this.view.environment.atmosphereEnabled
    }), (e72) => this._updateAtmosphere(e72), A3), d2(() => this._stars, t71), d2(() => this._precipitation, t71), d2(() => this._clouds, () => this._updateWeather(), P), d2(() => this._fog, () => this._updateFogHaze(), P), d2(() => this.view.state.mode, () => this._setNeedsRender(), C), d2(() => this._weatherUpdateParameters, () => {
      this._updateWeather(), this._updateFogHaze();
    }, A3)]);
  }
  uninitializeRenderContext() {
    this._context = null, this._atmosphere = u(this._atmosphere), this._set("_stars", u(this._stars)), this._set("_precipitation", u(this._precipitation)), this._set("_clouds", u(this._clouds)), this._set("_cloudsComposition", u(this._cloudsComposition)), this._set("_fog", u(this._fog));
  }
  prepareRender(e71) {
    e71.bindParameters.cloudsFade.data = I8(this._clouds) ? this._clouds : null, "local" !== this.view.viewingMode && null != e71.bindParameters.cloudsFade.data?.cubeMap && (this._updateWeatherFading(e71.bindParameters, e71.time), e71.bindParameters.cloudsFade.renderingStage === n30.FINISHED && null != this._clouds && 0 === this._clouds.coverage && false === this._clouds.running && (this._clouds.destroyFrameBufferCube(), e71.bindParameters.cloudsFade.data = null));
  }
  renderNode(e71) {
    switch (e71.bindParameters.slot) {
      case E12.OPAQUE_ENVIRONMENT:
        this._stars?.render(e71), null != this.atmosphere && (this.atmosphere.render(e71, this.view?._stage?.renderer?.fullResolutionAtmosphere), this._cloudsComposition && null != e71.bindParameters.cloudsFade.data && (this.weatherVisible && null != this._clouds && this._clouds.updateWeatherTile(), this._cloudsComposition.render(e71)), e71.bindParameters.cloudsFade.isFading && this._context && null != e71.bindParameters.cloudsFade.data?.cubeMap && this._context.requestRender());
        break;
      case E12.TRANSPARENT_ENVIRONMENT:
        if (null != this.atmosphere && (this.atmosphere.renderHaze(e71, this._weatherParameters.hazeAmount, this.view?._stage?.renderer?.fullResolutionAtmosphere), this._weatherParameters.fog.amount > 0 && null != this._fog && this._fog.render(e71, this._weatherParameters.fog), this._precipitation)) {
          const t71 = this.view.environment.weather;
          "rainy" !== t71.type && "snowy" !== t71.type || this._precipitation.render(e71, t71.precipitation, t71.type);
        }
    }
  }
  updateLightSources(e71, t71, s67, r57) {
    if (null != this._context) {
      const i49 = this._context.renderContext;
      i49.bindParameters.oldLighting.copyFrom(i49.bindParameters.lighting), i49.bindParameters.newLighting.noonFactor = t71, i49.bindParameters.newLighting.globalFactor = s67, i49.bindParameters.newLighting.set(e71);
      r57 === e42.Faded || i49.bindParameters.weatherFading ? i49.bindParameters.fadeLighting(0) : i49.bindParameters.fadeLighting(1), this._context.requestRender();
    }
  }
  get _weatherUpdateParameters() {
    const e71 = this.weatherEnabled ? this.view.environment.weather : null;
    return null == e71 ? null : "rainy" === e71.type || "snowy" === e71.type ? {
      type: e71.type,
      weatherAdjustment: e71.cloudCover,
      effect: e71.precipitation
    } : {
      type: e71.type,
      weatherAdjustment: "foggy" === e71.type ? e71.fogStrength : e71.cloudCover
    };
  }
  _updateWeatherFading(e71, t71) {
    e71.cloudsFade.updateFading(e71.camera, this.view.state.mode, t71, this.view.qualitySettings.fadeDuration), e71.cloudsFade.updateParallax(e71.camera), e71.weatherFading && (V8(e71), this._updateFogAtmoshpere(e71));
  }
  _updateFogAtmoshpere(e71) {
    e71.cloudsFade.fadeMode !== O11.CROSS_FADE && e71.cloudsFade.fadeMode !== O11.FADE_IN ? this._fadeWeather(0) : this._fadeWeather(e71.cloudsFade.fadeFactor);
  }
  _fadeWeather(e71) {
    const {
      _newWeatherParameters: t71,
      _oldWeatherParameters: s67
    } = this;
    e71 >= 1 ? this._weatherParameters = t71 : (this._fadedWeatherParameters.lerp(s67, t71, e71), this._weatherParameters = this._fadedWeatherParameters);
  }
  _updateWeather() {
    const e71 = this._weatherUpdateParameters;
    null != e71 && null != this._clouds && (this._clouds.applyPreset(e39[e71.type], e71.weatherAdjustment), this._setNeedsRender());
  }
  _setNeedsRender() {
    null != this._context && this._context.requestRender();
  }
  _updateFogHaze() {
    const e71 = this._weatherUpdateParameters;
    if (null == this._fog || null == e71 || null == this._context) return;
    const s67 = this._context.renderContext.bindParameters;
    switch (this._oldWeatherParameters.copyFrom(this._weatherParameters), e71.type) {
      case "foggy":
        this._newWeatherParameters.fog.strength = f4(3e-5, 5e-3, e71.weatherAdjustment ** 3), r5(this._newWeatherParameters.fog.color, D4), this._newWeatherParameters.fog.amount = 1, this._newWeatherParameters.hazeAmount = 1, this._setNeedsRender();
        break;
      case "rainy":
        this._newWeatherParameters.fog.strength = f4(4e-6, 2e-4, (e71.effect ?? 0) ** 3), r5(this._newWeatherParameters.fog.color, q8), this._newWeatherParameters.fog.amount = 1, this._newWeatherParameters.hazeAmount = 0, this._setNeedsRender();
        break;
      case "snowy":
        this._newWeatherParameters.fog.strength = f4(4e-6, 2e-4, (e71.effect ?? 0) ** 3), r5(this._newWeatherParameters.fog.color, D4), this._newWeatherParameters.fog.amount = 1, this._newWeatherParameters.hazeAmount = 1, this._setNeedsRender();
        break;
      default:
        this._newWeatherParameters.fog.strength = 0, this._newWeatherParameters.fog.amount = 0, this._newWeatherParameters.hazeAmount = 1, this._setNeedsRender();
    }
    s67.weatherFading ? this._fadeWeather(0) : this._fadeWeather(1);
  }
  _updateAtmosphere(e71) {
    const t71 = this._selectAtmosphereType(e71);
    if (t71 !== a32.None && this._context) {
      if (!this._atmosphere || this._atmosphere.type !== t71) {
        this._atmosphere = u(this._atmosphere);
        const e72 = this._getAtmosphereClass(t71);
        e72 && (this._atmosphere = new e72(this.view, this._context));
      }
    } else this._atmosphere = u(this._atmosphere);
    this._setNeedsRender();
  }
  _getAtmosphereClass(e71) {
    switch (e71) {
      case a32.Realistic:
        return B6;
      case a32.Local:
        return A16;
      case a32.Mars:
        return z9;
      default:
      case a32.None:
        return null;
    }
  }
  _selectAtmosphereType(e71) {
    const {
      enabled: t71,
      viewingMode: s67
    } = e71;
    return !t71 || p2(this.view.spatialReference) ? a32.None : s67 === l9.Local ? a32.Local : null != this._context && P2(this.view.spatialReference) ? a32.Realistic : f(this.view.spatialReference) ? a32.Mars : a32.None;
  }
  get test() {
  }
};
e6([y2({
  constructOnly: true
})], U10.prototype, "view", void 0), e6([y2({
  readOnly: true
})], U10.prototype, "atmosphere", null), e6([y2({
  readOnly: true
})], U10.prototype, "_atmosphereType", null), e6([y2({
  type: Boolean,
  readOnly: true
})], U10.prototype, "updating", null), e6([y2({
  readOnly: true
})], U10.prototype, "weatherVisible", null), e6([y2()], U10.prototype, "_context", void 0), e6([y2()], U10.prototype, "_atmosphere", void 0), e6([y2({
  readOnly: true
})], U10.prototype, "_stars", null), e6([y2({
  readOnly: true
})], U10.prototype, "_precipitation", null), e6([y2({
  readOnly: true
})], U10.prototype, "_clouds", null), e6([y2({
  readOnly: true
})], U10.prototype, "_cloudsComposition", null), e6([y2({
  readOnly: true
})], U10.prototype, "_fog", null), e6([y2({
  readOnly: true
})], U10.prototype, "weatherEnabled", null), e6([y2({
  readOnly: true
})], U10.prototype, "_precipitationEnabled", null), e6([y2({
  readOnly: true
})], U10.prototype, "_weatherUpdateParameters", null), U10 = e6([a4("esri.views.3d.environment.EnvironmentRenderer")], U10);
var I13 = class {
  constructor() {
    this.fog = new y10(), this.hazeAmount = 1;
  }
  copyFrom(e71) {
    this.fog.amount = e71.fog.amount, this.hazeAmount = e71.hazeAmount, this.fog.strength = e71.fog.strength, r5(this.fog.color, e71.fog.color);
  }
  lerp(e71, s67, r57) {
    this.fog.amount = f4(e71.fog.amount, s67.fog.amount, r57), this.hazeAmount = f4(e71.hazeAmount, s67.hazeAmount, r57), this.fog.strength = f4(e71.fog.strength, s67.fog.strength, r57), A4(this.fog.color, e71.fog.color, s67.fog.color, r57);
  }
};
function V8(e71) {
  e71.cloudsFade.fadeMode !== O11.CROSS_FADE && e71.cloudsFade.fadeMode !== O11.FADE_IN ? e71.fadeLighting(0) : e71.fadeLighting(e71.cloudsFade.fadeFactor);
}
var q8 = r4(0.5, 0.5, 0.5);
var D4 = r4(1.5, 1.5, 1.5);

// ../../../node_modules/@arcgis/core/views/3d/environment/SceneViewEnvironmentManager.js
var L11 = class extends o3.EventedAccessor {
  constructor() {
    super(), this._referencePointUpdateDelay = 200, this._referencePointUpdateInterval = 3e3, this._referencePointUpdateDistThreshold = 1e6, this._referencePosUpdateQuery = null, this._referencePosMapCoordsRequested = null, this._viewHandlesKey = "viewHandles", this._preserveAbsoluteDateTime = false, this._trackingEnabled = false, this._referencePosResetPreserveAbsoluteTime = false, this._referencePosUpdateTimer = null, this._referencePosMapCoords = null, this._mainLight = new c11(), this._ambientLight = new i13(), this._moonLight = new r20(), this.disableQueries = false, this._disableWeather = false, this._renderer = null, this._referencePositionGeographic = null, this._resetReferencePosition();
  }
  destroy() {
    this.disconnectView();
  }
  get _view() {
    return this._renderer?.view;
  }
  get updating() {
    return !((this.disableQueries || !this._referencePosUpdateQuery && !this._referencePosMapCoordsRequested) && !this._renderer?.updating);
  }
  get weatherEnabled() {
    return this._view?.environment.atmosphereEnabled && !this._disableWeather && this._view?.state?.viewingMode === l9.Global && P2(this._view.spatialReference);
  }
  get weatherVisible() {
    return this.weatherEnabled && this._renderer?.weatherVisible;
  }
  get referencePositionGeographic() {
    return this._referencePositionGeographic;
  }
  connectView(e71) {
    if (this._renderer) return;
    this._renderer = new U10({
      view: e71
    });
    const t71 = () => this._updateRenderParameters(), i49 = () => this._cameraHandler();
    this.addHandles([d2(() => e71.environment.lighting, (e72) => this._updateLightingHandler(e72), C), d2(() => "virtual" !== e71.environment.lighting.type ? e71.environment.lighting.date : null, (e72) => this._lightingDateHandler(e72), C), d2(() => e71.stationary, () => this._interactingStationaryHandler()), d2(() => e71.environment.lighting.directShadowsEnabled, t71, C), d2(() => e71.qualitySettings.ambientOcclusion, t71, C), d2(() => e71.qualitySettings.reflections, t71, C), d2(() => e71.spatialReference, () => this._resetReferencePosition(true), C), d2(() => e71.environment.weather.type, () => this._updateLighting(null, e42.Faded), C), d2(() => this.weatherEnabled, () => this._updateLighting(null, e42.Faded), C), d2(() => e71.viewingMode, () => this._resetReferencePosition(true), A3), d2(() => "virtual" !== e71.environment.lighting.type && e71.environment.lighting.cameraTrackingEnabled, (e72) => this._updateCameraTracking(e72), A3), d2(() => e71.state.camera, i49, A3), d2(() => this.disableQueries, i49)], this._viewHandlesKey), this._updateRenderParameters(), this._updateLighting(), this._cameraHandler(), this.notifyChange("updating");
  }
  disconnectView() {
    this.removeHandles(this._viewHandlesKey), this._resetReferencePosition(), this._renderer = u(this._renderer);
  }
  _updateLightingHandler(e71) {
    this._updateCameraTracking("virtual" !== e71.type && e71.cameraTrackingEnabled), this._lightingDateHandler("virtual" !== e71.type ? e71.date : null), this._updateRenderParameters();
  }
  _updateCameraTracking(e71) {
    if (this._trackingEnabled = e71, e71) this._cameraHandler();
    else {
      const e72 = this._view.environment.lighting;
      "virtual" !== e72?.type && (e72.positionTimezoneInfo.autoUpdated = false);
    }
  }
  _lightingDateHandler(e71) {
    const t71 = this._view.environment.lighting;
    if ("virtual" !== t71?.type) {
      if (e71) {
        if (!t71.positionTimezoneInfo.autoUpdated) {
          this._preserveAbsoluteDateTime = true;
          const i49 = this._view.spatialReference;
          if (!J2(i49, f2.WGS84)) {
            const e72 = this._view.camera.position;
            if (!this._referencePosMapCoords || !this._referencePosMapCoords.equals(e72)) return void this._requestReferencePositionUpdate(e72);
          }
          if (this._preupdateTracking(e71), null != this._referencePositionGeographic) {
            const e72 = c14(this._referencePositionGeographic, k7);
            null != e72 && (t71.autoUpdate(null, e72), this._trackingEnabled && (t71.positionTimezoneInfo.autoUpdated = true));
          }
        }
        this._updateLighting(e71);
      }
    } else this._updateLighting();
  }
  _preupdateTracking(e71) {
    !this._trackingEnabled && "virtual" !== this._view.environment.lighting.type && this._view.environment.lighting.cameraTrackingEnabled && this._cameraHandler(e71);
  }
  _cameraHandler(e71 = null) {
    const t71 = this._view;
    if (!t71.ready) return;
    const i49 = t71.stateManager.camera;
    i49 && (this._cameraHandlerClientSide(i49, e71) || this._cameraHandlerServerSide(i49));
  }
  _cameraHandlerClientSide(e71, t71) {
    const i49 = P2(this._view.spatialReference);
    if (i49 && !J2(this._view.spatialReference, f2.WGS84)) return "virtual" === this._view.environment.lighting.type && this._updateLighting(), false;
    const r57 = e71.position;
    return this._referencePositionGeographic ??= n7(), i49 ? c5(r57, this._referencePositionGeographic, f2.WGS84) : o4(this._referencePositionGeographic, r57.longitude ?? 0, r57.latitude ?? 0, r57.z ?? 0), this.notifyChange("referencePositionGeographic"), this._autoUpdateTimezone(this._referencePositionGeographic, t71) || this._updateLighting(t71), true;
  }
  _cameraHandlerServerSide(e71) {
    const t71 = e71.position;
    (!this._referencePosMapCoords || this._referencePosMapCoordsRequested || this._exceedsReferencePosDistThreshold(t71)) && this._requestReferencePositionUpdate(t71, true), this._view.mapCoordsHelper && this._referencePositionGeographic && (this._referencePositionGeographic[2] = (t71.z ?? 0) * this._view.mapCoordsHelper.unitInMeters, this._referencePosChanged());
  }
  _interactingStationaryHandler() {
    this._view.stationary && this._executePendingReferencePositionUpdate();
  }
  _updateLighting(e71, t71 = e42.Immediate) {
    const i49 = this._view;
    e71 = e71 || ("virtual" === i49.environment.lighting.type ? null : i49.environment.lighting.date);
    const r57 = this._referencePositionGeographic, n63 = r57 ? q9 : E21, s67 = this.weatherVisible ? i49.environment.weather.type : "disabled";
    null != r57 ? S11(e71, r57, i49.state.viewingMode, s67, i49.state.camera, n63) : "virtual" === i49.environment.lighting.type && O14(i49.state.camera, i49.state.viewingMode, n63.direct.directionToLightSource);
    const o60 = this._mainLight, a59 = n63.direct;
    g3(o60.intensity, a59.color, a59.intensity * Math.PI), r5(o60.direction, a59.directionToLightSource), o60.specularStrength = n63.specularStrength, o60.environmentStrength = n63.environmentStrength;
    const h32 = this._ambientLight;
    g3(h32.intensity, n63.ambient.color, n63.ambient.intensity);
    const c44 = this._moonLight;
    A4(c44.intensity, D5, V9, n63.globalFactor);
    const d38 = (1 - 0.5 * n63.globalFactor) * (1 - 0.4 * n63.noonFactor * (1 - n63.globalFactor));
    g3(c44.intensity, c44.intensity, d38), r5(c44.direction, a59.directionToLightSource), this._renderer.updateLightSources([o60, h32, c44], n63.noonFactor, n63.globalFactor, t71), this._updateRenderParameters();
  }
  _autoUpdateTimezone(e71, t71 = null) {
    if ("virtual" === this._view.environment.lighting.type || !this._view.environment.lighting.cameraTrackingEnabled || null == e71) return false;
    const i49 = Q7;
    i49.setTime((t71 || this._view.environment.lighting.date).getTime());
    const r57 = c14(e71, k7);
    if (null == r57) return false;
    let n63 = this._view.environment.lighting.positionTimezoneInfo;
    if (n63.autoUpdated) {
      if (n63.hours === r57.hours && n63.minutes === r57.minutes && n63.seconds === r57.seconds) return false;
    } else n63 = r57;
    const s67 = i49.getUTCHours() - (r57.hours - n63.hours), o60 = i49.getUTCMinutes() - (r57.minutes - n63.minutes), a59 = i49.getUTCSeconds() - (r57.seconds - n63.seconds);
    return i49.setUTCHours(s67), i49.setUTCMinutes(o60), i49.setUTCSeconds(a59), !t71 && this._view.environment.lighting.autoUpdate(i49, r57);
  }
  _updateRenderParameters() {
    const e71 = this._view._stage;
    if (!e71) return;
    const t71 = null == this._referencePositionGeographic || z8(this._referencePositionGeographic[2], this._view.state.viewingMode);
    e71.renderer.setParameters({
      shadowMap: this._view.environment.lighting.directShadowsEnabled && t71,
      environment: this._view.environment,
      weatherVisible: this._view.environmentManager.weatherVisible,
      qualitySettings: this._view.qualitySettings
    });
  }
  _resetReferencePosition(e71 = false) {
    this._cancelReferencePosUpdates(), this._referencePosMapCoords = null, this._referencePosMapCoordsRequested = null, this._referencePosResetPreserveAbsoluteTime = null, this._referencePositionGeographic = null, this.notifyChange("updating"), e71 && this._cameraHandler();
  }
  _requestReferencePositionUpdate(e71, t71 = false) {
    if (!this.disableQueries && (this._referencePosMapCoordsRequested ? this._referencePosMapCoordsRequested.copy(e71) : this._referencePosMapCoordsRequested = e71.clone(), this._referencePosResetPreserveAbsoluteTime = !!t71, !this._referencePosUpdateQuery && !this._referencePosUpdateTimer && this._view.stationary)) {
      const e72 = this._referencePosUpdateQuery = A(this._referencePointUpdateDelay).then(() => {
        if (this._referencePosUpdateQuery === e72) {
          const t73 = () => this._referencePosUpdateQuery !== e72;
          return this._doReferencePositionUpdateQuery(t73);
        }
      }).catch((e73) => {
        "mapcoordshelper:missing-geometry-service" === e73.name && (this.disableQueries = true);
      }).then(() => {
        this._referencePosUpdateQuery === e72 && (this._referencePosUpdateQuery = null, this._referencePosUpdateTimer || this._executePendingReferencePositionUpdate(), this.notifyChange("updating"));
      }), t72 = this._referencePosUpdateTimer = A(this._referencePointUpdateInterval).then(() => {
        this._referencePosUpdateTimer === t72 && (this._referencePosUpdateTimer = null, this._referencePosUpdateQuery || this._executePendingReferencePositionUpdate());
      });
      this.notifyChange("updating");
    }
  }
  _doReferencePositionUpdateQuery(e71) {
    return __async(this, null, function* () {
      this._referencePosResetPreserveAbsoluteTime && (this._preserveAbsoluteDateTime = false), this._referencePosMapCoords ? this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested) : this._referencePosMapCoords = this._referencePosMapCoordsRequested.clone(), this._referencePosResetPreserveAbsoluteTime = null, this._referencePosMapCoordsRequested = null;
      const t71 = yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);
      if (!e71() && !isNaN(t71[0]) && !isNaN(t71[1])) {
        const e72 = (this._referencePosMapCoords.z ?? 0) * this._view.mapCoordsHelper.unitInMeters;
        this._referencePositionGeographic ? o4(this._referencePositionGeographic, t71[0], t71[1], e72) : this._referencePositionGeographic = r4(t71[0], t71[1], e72), this._referencePosChanged();
      }
    });
  }
  _executePendingReferencePositionUpdate() {
    const e71 = this._referencePosMapCoordsRequested;
    e71 && this._requestReferencePositionUpdate(e71, this._referencePosResetPreserveAbsoluteTime);
  }
  _referencePosChanged() {
    this._preserveAbsoluteDateTime ? this._updateLighting() : this._autoUpdateTimezone(this._referencePositionGeographic) || this._updateLighting(), this.notifyChange("referencePositionGeographic");
  }
  _exceedsReferencePosDistThreshold(e71) {
    const t71 = this._referencePosMapCoords;
    if (null == t71) return true;
    const i49 = m23(t71, e71);
    if (null == i49) return true;
    return s21(i49, "meters").value > this._referencePointUpdateDistThreshold;
  }
  _cancelReferencePosUpdates() {
    const e71 = !!this._referencePosUpdateQuery;
    return this._referencePosUpdateQuery = null, this._referencePosUpdateTimer = null, e71;
  }
  get test() {
  }
};
e6([y2({
  type: Boolean,
  readOnly: true
})], L11.prototype, "updating", null), e6([y2()], L11.prototype, "disableQueries", void 0), e6([y2()], L11.prototype, "_disableWeather", void 0), e6([y2()], L11.prototype, "weatherEnabled", null), e6([y2()], L11.prototype, "weatherVisible", null), e6([y2()], L11.prototype, "referencePositionGeographic", null), e6([y2()], L11.prototype, "_renderer", void 0), e6([y2()], L11.prototype, "_referencePositionGeographic", void 0), L11 = e6([a4("esri.views.3d.environment.SceneViewEnvironmentManager")], L11);
var q9 = new I11();
var E21 = new I11();
var Q7 = /* @__PURE__ */ new Date();
var k7 = {
  hours: 0,
  minutes: 0,
  seconds: 0
};
var D5 = r4(0.22, 0.22, 0.33);
var V9 = r4(0.22, 0.22, 0.22);

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/ConstraintTypes.js
var L12;
!function(L25) {
  L25[L25.NONE = 0] = "NONE", L25[L25.TILT = 1] = "TILT", L25[L25.ALTITUDE = 2] = "ALTITUDE", L25[L25.DISTANCE = 4] = "DISTANCE", L25[L25.COLLISION = 8] = "COLLISION", L25[L25.ALL = 15] = "ALL", L25[L25.ALL_EXCEPT_COLLISION = 7] = "ALL_EXCEPT_COLLISION";
}(L12 || (L12 = {}));

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/InteractionType.js
var O17;
!function(O34) {
  O34[O34.NONE = 0] = "NONE", O34[O34.ZOOM = 1] = "ZOOM", O34[O34.TUMBLE = 2] = "TUMBLE", O34[O34.LOOK_AROUND = 3] = "LOOK_AROUND", O34[O34.PAN = 4] = "PAN", O34[O34.ASCEND = 5] = "ASCEND";
}(O17 || (O17 = {}));

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/TiltMode.js
var O18;
!function(O34) {
  O34[O34.TUMBLE = 0] = "TUMBLE", O34[O34.LOOK_AROUND = 1] = "LOOK_AROUND";
}(O18 || (O18 = {}));

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/ConstraintOptions.js
var r40 = class {
  constructor(r57 = L12.ALL, n63 = O17.NONE, e71 = 0, s67 = null, a59 = null, c44 = O18.TUMBLE) {
    this.selection = r57, this.interactionType = n63, this.interactionFactor = e71, this.interactionStartCamera = s67, this.interactionDirection = a59, this.tiltMode = c44;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/common.js
function o41(m45, n63) {
  return !!(m45 & n63);
}
function r41(m45, n63, a59, t71, i49, o60) {
  0 !== m45 && (a59 ? (o60.min = Math.min(o60.min, n63), o60.max = Math.max(o60.max, n63)) : null != t71 ? (o60.min -= Math.max(0, (n63 - o60.min) * (1 - t71)), o60.max += Math.max(0, (n63 - o60.max) * (1 - t71))) : i49 && (o60.min -= Math.max(0, n63 - o60.min - i49), o60.max += Math.max(0, n63 - o60.max - i49)));
}
var s42 = new r40(L12.NONE);
function x11(t71, i49, o60, r57) {
  return i49 = i49 || t71.viewForward, r5(r57, i49), g3(r57, r57, Math.sign(P3(i49, o60))), r57;
}

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/altitude.js
function l24(t71, r57, n63 = s42) {
  const a59 = p26(t71, r57, n63);
  if (0 === a59) return false;
  const c44 = t71.renderCoordsHelper, m45 = c44.getAltitude(r57.eye) + a59, u46 = x11(r57, n63.interactionDirection, j9(t71, r57, Math.sign(a59), C10), g15), l47 = r5(M7, r57.viewForward), d38 = c44.intersectInfiniteManifold(l8(r57.eye, u46), m45, A19);
  return r57.eye = null != d38 ? d38 : c44.setAltitude(A19, m45, r57.eye), r57.center = j8(A19, r57.eye, l47, r57.center), true;
}
function p26(e71, r57, n63 = s42) {
  if (!d25(e71, n63) || !e71.state.constraints.altitude) return 0;
  const o60 = x12(e71.state.constraints.altitude, T8);
  y12(e71, n63, o60);
  const i49 = e71.renderCoordsHelper.getAltitude(r57.eye), a59 = e12(i49, o60.min, o60.max) - i49;
  return Math.abs(a59) <= 1e-6 ? 0 : a59;
}
function d25(t71, e71) {
  const r57 = t71.state.constraints.altitude;
  return !(!t71.state.isGlobal || !r57) && (e71.interactionType !== O17.TUMBLE || !o41(e71.selection, L12.TILT));
}
function y12(t71, e71, r57) {
  const n63 = e71.interactionType;
  if (n63 === O17.NONE) return;
  const {
    min: o60,
    max: i49
  } = r57, {
    interactionStartCamera: s67,
    interactionFactor: a59
  } = e71;
  if (!s67) return;
  const m45 = n63 === O17.TUMBLE || n63 === O17.ZOOM, f46 = p26(t71, s67), l47 = 0 === f46 ? 0 : t71.renderCoordsHelper.getAltitude(s67.eye);
  r57.min = o60, r57.max = i49;
  r41(f46, l47, m45, a59, 0.05 * l47, r57);
}
function j9(t71, e71, n63, o60) {
  return t71.renderCoordsHelper.worldUpAtPosition(e71.eye, o60), g3(o60, o60, n63), o60;
}
function x12(t71, e71) {
  return e71.min = t71.min, e71.max = t71.max, e71;
}
var T8 = {
  min: 0,
  max: 0
};
var g15 = n7();
var C10 = n7();
var M7 = n7();
var A19 = n7();

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/distance.js
function d26(e71, r57, n63 = s42) {
  if (!e71.state.isLocal) return 0;
  const t71 = e71.state.constraints.distance;
  if (!e71.pointsOfInterest.surfaceOrigin.renderLocation || t71 === 1 / 0) return 0;
  x13.min = 0, x13.max = t71, l25(e71, n63, x13);
  const o60 = O19(e71, r57), i49 = x13.max - o60;
  return i49 >= -1e-6 ? 0 : i49;
}
function y13(t71, o60, i49 = s42) {
  const u46 = d26(t71, o60, i49);
  if (0 === u46) return false;
  const p49 = t71.pointsOfInterest.surfaceOrigin;
  if (!p49.renderLocation) return false;
  const y27 = O19(t71, o60) + u46, l47 = r5(L13, o60.eye), x26 = x11(o60, i49.interactionDirection, g16(o60, p49.renderLocation, h19), I14);
  if (!X3(k2(p49.renderLocation, y27), l8(o60.eye, x26), k8)) return false;
  o60.eye = k8;
  const C25 = e11(j10, o60.eye, l47);
  o60.center = u5(k8, o60.center, C25);
  const N18 = t71.renderCoordsHelper.getAltitude(o60.center), v28 = t71.renderCoordsHelper.intersectInfiniteManifold(o60.ray, N18, k8);
  return null != v28 && (o60.center = v28), true;
}
function l25(e71, r57, n63) {
  const t71 = r57.interactionType;
  if (t71 === O17.NONE) return;
  const {
    min: o60,
    max: i49
  } = n63, {
    interactionStartCamera: c44,
    interactionFactor: s67
  } = r57;
  if (!c44) return;
  const a59 = t71 === O17.ZOOM || t71 === O17.PAN, f46 = d26(e71, c44), m45 = 0 === f46 ? 0 : O19(e71, c44);
  n63.min = o60, n63.max = i49;
  r41(f46, m45, a59, s67, 0.05 * m45, n63);
}
function O19(e71, r57) {
  const n63 = e71.pointsOfInterest.surfaceOrigin;
  return n63.renderLocation ? x(r57.eye, n63.renderLocation) : 0;
}
function g16(e71, r57, n63) {
  return J(n63, e71.eye, r57);
}
var x13 = {
  min: 0,
  max: 0
};
var L13 = n7();
var j10 = n7();
var I14 = n7();
var h19 = n7();
var k8 = n7();

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/surfaceCollision.js
function s43(n63, s67, _30 = i31.EYE) {
  const a59 = n63.state.constraints;
  if (!a59.collision.enabled) return false;
  const f46 = f14(n63, s67.eye), N18 = n63.renderCoordsHelper.getAltitude(s67.eye), A32 = f46 + a59.collision.elevationMargin;
  if (N18 >= A32) return false;
  const C25 = s8(s67.eye);
  if (e11(c29, s67.center, s67.eye), s67.eye = n63.renderCoordsHelper.setAltitude(l26, A32, s67.eye), _30 === i31.EYE_AND_CENTER) s67.center = u5(c29, s67.eye, c29);
  else if (_30 === i31.EYE_AND_CENTER_SCALE) {
    const e71 = (C25 - N18 + A32) / C25;
    s67.center = g3(c29, s67.center, e71);
  }
  return true;
}
var i31;
!function(e71) {
  e71[e71.EYE = 0] = "EYE", e71[e71.EYE_AND_CENTER = 1] = "EYE_AND_CENTER", e71[e71.EYE_AND_CENTER_SCALE = 2] = "EYE_AND_CENTER_SCALE";
}(i31 || (i31 = {}));
var c29 = n7();
var l26 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/utils/viewUtils.js
function c30(i49, c44, f46) {
  i49.worldUpAtPosition(c44, m27), e11(e43, f46, c44);
  const n63 = s8(e43);
  return 0 === n63 ? 0 : m3(P3(e43, m27) / n63);
}
var m27 = n7();
var e43 = n7();

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils/tilt.js
function w13(t71, r57, n63, i49 = true) {
  V10.eyeCenterDistance = 0, V10.requiresTwoSteps = false;
  const a59 = U11(t71, r57, n63, s42, V10);
  if (0 === a59) return false;
  switch (p8(_17, -a59, r57.viewRight), n63.tiltMode) {
    case O18.LOOK_AROUND:
      O2(K7, r57.viewForward, _17), g3(K7, K7, V10.eyeCenterDistance), r57.center = u5(z10, r57.eye, K7);
      break;
    case O18.TUMBLE:
      e11(K7, r57.center, r57.eye), O2(K7, K7, _17), r57.eye = e11(z10, r57.center, K7);
      break;
    default:
      n10(n63.tiltMode);
  }
  return r57.up = O2(z10, r57.up, _17), !V10.requiresTwoSteps || !i49 || w13(t71, r57, n63, false);
}
function U11(e71, t71, r57, n63 = s42, i49) {
  if (!e71.state.constraints.tilt) return 0;
  const s67 = t71.distance, a59 = e71.state.constraints.tilt(s67, J6);
  return k9(e71, r57, a59), n63.interactionType === O17.TUMBLE && o41(n63.selection, L12.ALTITUDE) && B9(e71, n63.interactionStartCamera, a59), r57.tiltMode === O18.LOOK_AROUND || n63.tiltMode === O18.LOOK_AROUND ? L14(e71, t71, a59, i49) : P11(e71, t71, a59);
}
function P11(e71, r57, n63) {
  const i49 = c30(e71.renderCoordsHelper, r57.center, r57.eye), s67 = i49 - e12(i49, n63.min, n63.max);
  return v14(s67) ? s67 : 0;
}
function L14(e71, t71, r57, n63) {
  switch (n63 && (n63.requiresTwoSteps = false), e71.viewingMode) {
    case "global":
      return q10(e71, t71, r57, n63);
    case "local":
      return g17(e71, t71, r57, n63);
  }
}
function g17(e71, r57, n63, i49) {
  const s67 = c30(e71.renderCoordsHelper, r57.center, r57.eye), a59 = e12(s67, n63.min, n63.max), o60 = s67 - a59;
  if (!v14(o60)) return 0;
  if (i49) {
    const t71 = e71.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, n64 = e71.renderCoordsHelper.getAltitude(r57.eye) - t71, s68 = Math.cos(a59);
    Math.abs(s68) > 1e-4 ? i49.eyeCenterDistance = n64 / s68 : i49.eyeCenterDistance = r57.distance;
  }
  return o60;
}
function q10(e71, r57, n63, i49) {
  const s67 = b12(e71, r57, Q8), a59 = e12(s67.tiltAtCenter, n63.min, n63.max);
  if (!v14(s67.tiltAtCenter - a59)) return 0;
  let o60, c44;
  return s67.centerIsOnSurface ? (o60 = H11(s67), c44 = F6(s67, o60)) : (o60 = s67.constraints.clampTilt(s67.eyeCenterDistance, s67.tiltAtCenter), i49 && o60 < Math.PI / 2 && (i49.requiresTwoSteps = true, o60 = Math.PI / 2 - 1e-5), c44 = N8(s67, o60)), i49 && (i49.eyeCenterDistance = E22(s67, o60)), c44;
}
function b12(e71, t71, n63) {
  const i49 = e71.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, s67 = i49 + s6(e71.spatialReference).radius, a59 = e71.renderCoordsHelper.intersectManifold(t71.ray, i49, z10);
  return n63.eyeCenterDistance = t71.distance, n63.centerIsOnSurface = false, null != a59 ? (n63.eyeCenterDistance = x(t71.eye, a59), n63.tiltAtCenter = c30(e71.renderCoordsHelper, a59, t71.eye), n63.centerIsOnSurface = true) : e71.state.isLocal ? n63.tiltAtCenter = c30(e71.renderCoordsHelper, t71.center, t71.eye) : (J3(L3(at, s67), t71.ray, z10), n63.eyeCenterDistance = x(t71.eye, z10), n63.tiltAtCenter = m3(-P3(t71.viewForward, z(z10, z10)))), n63.radius = s67, n63.eyeRadius = s8(t71.eye), n63.constraints = e71.state.constraints, n63;
}
function v14(e71) {
  return Math.abs(e71) > 1e-9;
}
function H11(e71) {
  const {
    constraints: t71,
    eyeCenterDistance: r57,
    tiltAtCenter: n63
  } = e71;
  let i49 = n63, s67 = t71.clampTilt(r57, n63);
  const a59 = E22(e71, s67);
  if (t71.clampTilt(a59, n63) === s67) return s67;
  let o60 = 0;
  for (; o60 < 10 && v14(s67 - i49); ) {
    const r58 = (i49 + s67) / 2, n64 = E22(e71, r58);
    v14(t71.clampTilt(n64, r58) - r58) ? i49 = r58 : s67 = r58, o60++;
  }
  return s67;
}
function E22(e71, r57) {
  if (!e71.centerIsOnSurface) return e71.eyeCenterDistance;
  const i49 = Math.PI - e12(r57, 0, Math.PI), s67 = l6(e71.radius / e71.eyeRadius * Math.sin(i49)), a59 = Math.PI - i49 - s67, o60 = Math.sin(a59) / Math.sin(i49);
  if (e71.eyeRadius < e71.radius && o60 > 1) {
    const t71 = Math.PI - s67, r58 = Math.PI - i49 - t71;
    return Math.sin(r58) / Math.sin(i49) * e71.eyeRadius;
  }
  return o60 * e71.eyeRadius;
}
function F6(e71, t71) {
  const r57 = l6(e71.radius / e71.eyeRadius * Math.sin(e71.tiltAtCenter)), i49 = l6(e71.radius / e71.eyeRadius * Math.sin(t71));
  return e71.eyeRadius > e71.radius ? r57 - i49 : i49 - r57;
}
function N8(e71, t71) {
  return e71.tiltAtCenter - Math.PI / 2 - (t71 - Math.PI / 2);
}
function k9(e71, t71, r57) {
  if (t71.interactionType === O17.NONE) return;
  const {
    interactionStartCamera: n63,
    interactionFactor: i49
  } = t71;
  if (!n63) return;
  const {
    min: s67,
    max: a59
  } = r57, o60 = U11(e71, n63, s42, t71), c44 = 0 === o60 ? 0 : c30(e71.renderCoordsHelper, n63.center, n63.eye);
  r57.min = s67, r57.max = a59, t71.interactionType === O17.TUMBLE ? (o41(t71.selection, L12.ALTITUDE) && B9(e71, n63, r57), r41(o60, c44, true, i49, G10, r57)) : r41(o60, c44, false, i49, G10, r57);
}
function B9(e71, t71, n63) {
  const i49 = e71.state.constraints;
  if (e71.state.isLocal || !i49.altitude || !t71) return;
  const s67 = v3(t71.center), a59 = Math.sqrt(s67), o60 = t71.distance, c44 = s6(e71.spatialReference).radius, u46 = i49.altitude.min + c44, l47 = i49.altitude.max + c44, m45 = (u46 * u46 - o60 * o60 - s67) / (-2 * a59 * o60), f46 = (l47 * l47 - o60 * o60 - s67) / (-2 * a59 * o60);
  n63.min = Math.max(n63.min, Math.min(Math.PI - m3(f46), n63.max)), n63.max = Math.min(n63.max, Math.PI - m3(m45));
}
var K7 = n7();
var _17 = e15();
var z10 = n7();
var G10 = h3(5);
var J6 = {
  min: 0,
  max: 0
};
var Q8 = {
  constraints: null,
  radius: 0,
  eyeRadius: 0,
  centerIsOnSurface: true,
  eyeCenterDistance: 0,
  tiltAtCenter: 0
};
var V10 = {
  eyeCenterDistance: 0,
  requiresTwoSteps: false
};

// ../../../node_modules/@arcgis/core/views/3d/camera/constraintUtils.js
function E23(t71, o60, n63 = C11, s67 = o60) {
  s67 !== o60 && s67.copyFrom(o60), s67.computeUp(t71.state.viewingMode);
  let e71 = false;
  for (let i49 = 0; i49 < N9; i49++) {
    let o61 = 0;
    for (const i50 of U12) if (o41(n63.selection, i50.type)) {
      const r57 = Math.abs(i50.error(t71, s67, n63));
      i50.apply(t71, s67, n63) && (e71 = true, o61 += r57);
    }
    if (0 === o61) break;
  }
  const a59 = o41(n63.selection, L12.COLLISION), p49 = u27(n63.interactionType, t71);
  return a59 && s43(t71, s67, p49) && (e71 = true), e71 && s67.computeUp(t71.state.viewingMode), e71;
}
function u27(t71, o60) {
  switch (t71) {
    case O17.PAN:
      return i31.EYE_AND_CENTER;
    case O17.ASCEND:
      return o60.state.isGlobal ? i31.EYE_AND_CENTER_SCALE : i31.EYE_AND_CENTER;
    default:
      return i31.EYE;
  }
}
function y14(t71) {
  const o60 = Math.min(1, t71 / 150);
  return a18(o60);
}
function T9(t71, o60, r57) {
  return U11(t71, o60, r57) * o60.distance;
}
var U12 = [{
  type: L12.TILT,
  error: T9,
  apply: w13
}, {
  type: L12.ALTITUDE,
  error: p26,
  apply: l24
}, {
  type: L12.DISTANCE,
  error: d26,
  apply: y13
}];
var C11 = new r40();
var N9 = 5;

// ../../../node_modules/@arcgis/core/views/3d/animation/pointToPoint/Camera.js
var P12 = class {
  get pitch() {
    return this._pitch;
  }
  get yaw() {
    return this._yaw;
  }
  get distance() {
    return this._distance;
  }
  get fov() {
    return this._fov;
  }
  get size() {
    return this._size;
  }
  constructor(t71) {
    this.viewingMode = t71, this.center = n7(), this._pitch = 0, this._yaw = 0, this._distance = 0, this.direction = t4(V11), this._fov = 55, this._size = 1;
  }
  pixelsPerPanAtZoom(t71) {
    return this._size / 2 / (this._zoomToPanScale * t71);
  }
  zoomAtPixelsPerPan(t71) {
    return this._size / 2 / (this._zoomToPanScale * t71);
  }
  pixelsPerRotateAtZoom() {
    const t71 = Math.max(Math.cos(Math.abs(this._pitch)), 0.5);
    return this._size / 2 / t71;
  }
  compareTo(t71, i49) {
    if (this.viewingMode === l9.Global) {
      const e72 = (s8(this.center) + s8(t71.center)) / 2;
      i49.pan = v5(this.center, t71.center) * e72;
    } else i49.pan = x(this.center, t71.center);
    let e71 = Math.abs(t71._yaw - this._yaw);
    e71 >= Math.PI && (e71 = 2 * Math.PI - e71);
    const a59 = Math.abs(t71._pitch - this._pitch);
    i49.rotate = Math.max(e71, a59), i49.fov = t71.fov - this.fov, i49.sourceZoom = this._distance, i49.targetZoom = t71._distance;
  }
  interpolate(i49, e71, s67) {
    this.viewingMode === l9.Global ? q2(i49.center, e71.center, s67.pan, this.center) : A4(this.center, i49.center, e71.center, s67.pan), this._distance = isFinite(e71.distance) ? f4(i49.distance, e71.distance + s67.zoomOffset, s67.zoom) : i49.distance, this._pitch = f4(i49.pitch, e71.pitch, s67.rotate);
    let o60 = i49._yaw;
    const h32 = e71._yaw;
    Math.abs(h32 - o60) >= Math.PI && (o60 += 2 * (o60 < h32 ? 1 : -1) * Math.PI), this._yaw = f4(o60, h32, s67.rotate), this._fov = f4(i49.fov, e71.fov, s67.fov);
  }
  copyFrom(t71) {
    r5(this.center, t71.center), this._pitch = t71.pitch, this._yaw = t71.yaw, this._distance = t71.distance, r5(this.direction, t71.direction), this._size = t71.size, this._fov = t71.fov, this._zoomToPanScale = Math.atan(0.5 * this._fov), this.viewingMode = t71.viewingMode;
  }
  copyFromRenderCamera(t71) {
    const i49 = this._lookAtOrientation(t71.center, S13);
    r5(this.center, t71.center), e11(j11, t71.center, t71.eye), S4(j11, j11, i49), S4(T10, t71.up, i49), this._distance = s8(j11), 0 !== this._distance && (j11[0] /= this._distance, j11[1] /= this._distance, j11[2] /= this._distance), this._pitch = this._eyeUpToPitch(j11), this._yaw = z11(j11, T10), this._size = Math.sqrt(t71.width * t71.width + t71.height * t71.height), this._fov = t71.fov, this._zoomToPanScale = Math.atan(0.5 * this._fov);
  }
  copyToRenderCamera(t71) {
    const e71 = this._lookAtOrientation(this.center, S13);
    u8(e71, e71), this._axisAngleVec3(O20, this._pitch - Math.PI / 2, V11, j11), this._axisAngleVec3(k10, this._yaw, j11, j11), this._axisAngleVec3(O20, this._pitch - Math.PI / 2, k10, T10), this._axisAngleVec3(k10, this._yaw, T10, T10), g3(j11, j11, this._distance), S4(j11, j11, e71), S4(T10, T10, e71), t71.center = this.center, t71.eye = e11(j11, this.center, j11), t71.up = T10, t71.fov = this._fov;
  }
  _axisAngleVec3(t71, i49, e71, s67) {
    const o60 = Math.cos(i49), a59 = Math.sin(i49);
    return g3(A20, e71, o60), _2(x14, t71, e71), g3(x14, x14, a59), g3(b13, t71, (1 - o60) * P3(t71, e71)), u5(s67, u5(s67, A20, x14), b13);
  }
  _lookAtOrientation(t71, i49 = e16()) {
    return this._upAtLookAt(t71, b13), _2(A20, this.direction, b13), z(A20, A20), 0 === A20[0] && 0 === A20[1] && 0 === A20[2] && r5(A20, O20), _2(x14, b13, A20), z(x14, x14), i49[0] = A20[0], i49[1] = x14[0], i49[2] = b13[0], i49[3] = A20[1], i49[4] = x14[1], i49[5] = b13[1], i49[6] = A20[2], i49[7] = x14[2], i49[8] = b13[2], i49;
  }
  _upAtLookAt(t71, i49) {
    return this.viewingMode === l9.Local ? r5(i49, k10) : z(i49, t71);
  }
  _eyeUpToPitch(t71) {
    return Math.PI - v5(k10, t71);
  }
};
function z11(t71, i49) {
  const e71 = I15;
  return Math.abs(i49[2]) < 0.5 ? (r5(e71, i49), t71[2] > 0 && g3(e71, e71, -1)) : r5(e71, t71), _2(x14, e71, k10), z(x14, x14), v5(O20, x14, k10);
}
var A20 = n7();
var x14 = n7();
var b13 = n7();
var j11 = n7();
var T10 = n7();
var I15 = n7();
var k10 = y3;
var V11 = m2;
var O20 = s7;
var S13 = e16();

// ../../../node_modules/@arcgis/core/views/3d/animation/pointToPoint/Animation.js
var c31 = class {
  get finished() {
    return this.currentTime >= this._animation.time;
  }
  get time() {
    return this._animation.time;
  }
  constructor(i49) {
    this.currentTime = n3(0), this._animation = new p13(() => new P12(i49)), this._current = new P12(i49);
  }
  update(i49, m45, s67) {
    const {
      source: a59,
      target: o60
    } = this._animation.definition, c44 = e11(h20, m45.center, i49.center), u46 = s8(c44);
    u46 >= 1e-5 ? (c44[0] /= u46, c44[1] /= u46, c44[2] /= u46) : (c44[0] = 0, c44[1] = 1, c44[0] = 0), r5(a59.direction, c44), r5(o60.direction, c44), a59.copyFromRenderCamera(i49), o60.copyFromRenderCamera(m45), this._current.copyFrom(a59), this._animation.update(a59, o60, s67), this.currentTime = n3(0), i49.almostEquals(m45) && (this.currentTime = this._animation.time);
  }
  cameraAt(t71, i49) {
    return this._animation.cameraAt(t71, this._current), i49 = i49 || new it(), this._current.copyToRenderCamera(i49), i49;
  }
  step(e71, r57) {
    return this.finished || (this.currentTime = n3(this.currentTime + r3(e71)), this.currentTime >= this.time && (this.currentTime = this.time)), this.cameraAt(this.currentTime / this.time, r57);
  }
};
var h20 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/CameraController.js
var s44;
!function(t71) {
  t71[t71.Ready = 0] = "Ready", t71[t71.Rejected = 1] = "Rejected", t71[t71.Running = 2] = "Running", t71[t71.Stopped = 3] = "Stopped", t71[t71.Finished = 4] = "Finished";
}(s44 || (s44 = {}));
var n38 = class extends S3 {
  constructor(t71) {
    super(t71), this.state = s44.Ready;
  }
  get active() {
    return this.state === s44.Running;
  }
  get isInteractive() {
    return false;
  }
  get canStop() {
    return false;
  }
  stopController() {
    return !!this.canStop && (this.state = s44.Stopped, true);
  }
  finishController() {
    this.state = s44.Finished;
  }
  get steppingFinished() {
    return false;
  }
};
e6([y2({
  constructOnly: true
})], n38.prototype, "view", void 0), e6([y2({
  readOnly: true
})], n38.prototype, "active", null), e6([y2()], n38.prototype, "state", void 0), e6([y2({
  readOnly: true
})], n38.prototype, "isInteractive", null), n38 = e6([a4("esri.views.3d.state.controllers.CameraController")], n38);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/AnimationController.js
var a33 = class extends n38 {
  constructor() {
    super(...arguments), this._asyncResult = null;
  }
  get canStop() {
    return true;
  }
  set asyncResult(t71) {
    this._asyncResult && (this._asyncResult.reject(u2()), this._asyncResult = null), this.state === s44.Finished || this.state === s44.Stopped ? (n2(t71), this.state === s44.Finished ? t71.resolve() : t71.reject(u2())) : this._asyncResult = t71;
  }
  get asyncResult() {
    return this._asyncResult;
  }
  onControllerStart() {
    this.state = s44.Running, null != this.viewAnimation && this.viewAnimation.when(() => this.updateStateFromViewAnimation(), () => this.updateStateFromViewAnimation());
  }
  updateStateFromViewAnimation() {
    null == this.viewAnimation || this.state !== s44.Ready && this.state !== s44.Running || (this.viewAnimation.state === a17.State.FINISHED ? this.finish() : this.viewAnimation.state === a17.State.STOPPED && (this.state = s44.Stopped));
  }
  onControllerEnd() {
    null == this.viewAnimation || this.viewAnimation.done || (this.state === s44.Finished ? this.viewAnimation.finish() : this.state === s44.Stopped && this.viewAnimation.stop()), this._asyncResult && (this.state === s44.Finished ? this._asyncResult.resolve() : this._asyncResult.reject(u2()));
  }
  finish() {
    this.finishController();
  }
};
a33 = e6([a4("esri.views.3d.state.controllers.AnimationController")], a33);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/PointToPointAnimationController.js
var h21 = class extends a33 {
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  constructor(i49) {
    super(i49), this.mode = "interaction", this._hasTarget = false;
  }
  initialize() {
    this.animation = new c31(this.view.state.viewingMode), this.viewAnimation = "interaction" === this.mode ? null : new a17();
  }
  get isInteractive() {
    return "interaction" === this.mode;
  }
  begin(i49, t71) {
    this._hasTarget = true;
    const e71 = this.animationSettings(t71);
    p27.copyFrom(this.view.state.camera);
    const n63 = T5(this.view.state.viewingMode);
    this.intersectionHelper.intersectRay(p27.ray, n63, l27) && (p27.center = l27), this.animation.update(p27, i49, e71), this.animation.finished && this.finish();
  }
  finish() {
    this.animation.currentTime = this.animation.time, super.finish();
  }
  get steppingFinished() {
    return this._hasTarget && this.animation.finished;
  }
  stepController(i49, t71) {
    this._hasTarget && this.animation.step(i49, t71);
  }
  onControllerEnd(i49) {
    this._hasTarget && (this.animation.cameraAt(this.animation.currentTime / this.animation.time, i49), this.animation.currentTime = this.animation.time), super.onControllerEnd(i49);
  }
  animationSettings(i49 = {}) {
    return __spreadProps(__spreadValues({
      apex: {
        maximumDistance: this.view.state.constraints.clampAltitude(1 / 0) / 6,
        ascensionFactor: void 0,
        descensionFactor: void 0
      }
    }, i49), {
      easing: "string" == typeof i49.easing ? H5[i49.easing] : i49.easing
    });
  }
};
e6([y2({
  constructOnly: true
})], h21.prototype, "mode", void 0), e6([y2({
  readOnly: true
})], h21.prototype, "isInteractive", null), h21 = e6([a4("esri.views.3d.state.controllers.PointToPointAnimationController")], h21);
var p27 = new it();
var l27 = n7();

// ../../../node_modules/@arcgis/core/geometry/support/axisAngle.js
function s45(t71 = k11) {
  return [t71[0], t71[1], t71[2], t71[3]];
}
function m28(t71, r57) {
  return g18(t71[0], t71[1], t71[2], r57, r8.get());
}
function g18(t71, r57, n63, o60, u46 = s45()) {
  return u46[0] = t71, u46[1] = r57, u46[2] = n63, u46[3] = o60, u46;
}
function l28(t71, r57, n63) {
  return _2(v16(n63), t71, r57), z(v16(n63), v16(n63)), n63[3] = f8(t71, r57), n63;
}
function v16(t71) {
  return t71;
}
var k11 = [0, 0, 1, 0];
var q11 = e17();
var S14 = e17();

// ../../../node_modules/@arcgis/core/views/3d/support/geometryUtils/sphere.js
function s46(r57, s67, p49, e71) {
  const n63 = p17(s67, p49, m29);
  return X3(r57, n63, e71);
}
var m29 = m7();

// ../../../node_modules/@arcgis/core/views/3d/state/utils/navigationUtils.js
var N10;
!function(t71) {
  t71[t71.Ellipsoid = 0] = "Ellipsoid", t71[t71.Silhouette = 1] = "Silhouette";
}(N10 || (N10 = {}));
var Q9 = 30;
var X7 = [1, 3e8];
var Y6 = 80;
var Z5 = 8;
var $4 = 200;
var _18 = 1508e5;
var tt = 5;
var et = 50;
var nt = 5;
var ot = 10;
var rt = 90;
var at2 = {
  exclude: /* @__PURE__ */ new Set([w6])
};
function it2(t71, e71, n63) {
  return n63[0] = e71[0] / (t71.fullWidth / t71.pixelRatio), n63[1] = e71[1] / (t71.fullHeight / t71.pixelRatio), n63;
}
function st(t71) {
  for (; t71 > Math.PI; ) t71 -= 2 * Math.PI;
  for (; t71 < -Math.PI; ) t71 += 2 * Math.PI;
  return t71;
}
function ct(t71, e71, n63) {
  const o60 = p8(f7.get(), n63[3], v16(n63));
  null == o60 || B2(o60, o8) || (e11(oe, t71.eye, e71), O2(oe, oe, o60), t71.eye = u5(oe, oe, e71), e11(oe, t71.center, e71), O2(oe, oe, o60), t71.center = u5(oe, oe, e71), t71.up = O2(oe, t71.up, o60));
}
function lt3(t71, e71, n63, o60) {
  return S5(t71, g10(e71, n63, ce2), o60);
}
function mt(t71, e71, n63, o60) {
  return S5(t71, p17(e71, n63, ce2), o60);
}
function ut(t71, e71, n63, o60) {
  const r57 = c6.get();
  let a59 = 1 - n63;
  e11(r57, e71, t71.eye);
  const i49 = s8(r57);
  let s67 = i49 * (1 - a59);
  a59 >= 0 && s67 < o60 && (s67 = o60, a59 = -(s67 - i49) / i49), Math.abs(i49 - s67) < 1e-6 || (g3(r57, r57, a59), t71.eye = u5(oe, t71.eye, r57), t71.center = A4(oe, t71.center, e71, a59));
}
function ft(t71, e71, n63) {
  e71.getScreenCenter(pt), s46(t71, e71, pt, oe) && (e71.center = oe);
  const o60 = e71.distance, r57 = o60 * n63;
  if (Math.abs(o60 - r57) < 1e-6) return;
  const a59 = g3(c6.get(), e71.viewForward, r57);
  e71.eye = e11(oe, e71.center, a59);
}
var pt = i4();
function ht2(t71, e71) {
  o4(e71, 0, 0, 0);
  for (const n63 of t71) u5(e71, e71, n63);
  g3(e71, e71, 1 / t71.length);
}
function Mt(t71, e71, n63, o60) {
  return Math.sin(t71 / s8(e71)) * (n63 + o60.radius);
}
function gt(t71, e71, n63, o60) {
  return Mt(Math.PI / 2, e71, n63, o60) + (t71 - Math.PI / 2);
}
var yt;
!function(t71) {
  t71[t71.Vertical = 0] = "Vertical", t71[t71.Horizontal = 1] = "Horizontal";
}(yt || (yt = {}));
var bt = {
  Elevation: 3e4,
  Angle: h3(16)
};
var dt2 = {
  Pole: 0.95,
  Angle: h3(18),
  Tilt: 45
};
var xt = h3(80);
function jt(t71, e71, n63, o60, r57, a59) {
  const i49 = n7(), s67 = _5();
  let c44 = true, l47 = true;
  return t71.intersectScreen(n63, i49, a59) ? s67[3] = s8(i49) : (l47 = false, e71.aboveGround && r57 !== N10.Ellipsoid ? s67[3] = Math.max(s8(e71.center), 0.9 * o60.radius) : s67[3] = s8(e71.eye) - e71.relativeElevation, r57 === N10.Silhouette ? wt(s67, e71, n63, i49) : c44 = s46(s67, e71, n63, i49)), {
    sphere: s67,
    scenePickPoint: c44 ? i49 : null,
    hasGeometryIntersection: l47
  };
}
function vt(t71, e71, n63, o60) {
  const r57 = t71.relativeElevation;
  if (r57 > bt.Elevation && "global" === o60) return yt.Horizontal;
  p17(t71, e71, le);
  const a59 = Math.sign(r57), i49 = n63.worldUpAtPosition(t71.eye, oe);
  return -a59 * P3(i49, le.direction) < Math.sin(bt.Angle) * s8(le.direction) ? yt.Vertical : yt.Horizontal;
}
function zt(t71, e71, n63) {
  e11(Pt2, n63, e71), t71.eye = e11(oe, t71.eye, Pt2), t71.center = e11(oe, t71.center, Pt2);
}
var Pt2 = n7();
function wt(t71, e71, n63, o60) {
  const r57 = p17(e71, n63, ce2);
  return null != r57 && (J3(t71, r57, It), X3(t71, r57, o60) ? !(p3(It, r57.origin) < p3(o60, r57.origin)) || (r5(o60, It), false) : (e11(St, e71.eye, e71.center), z(St, St), _6(St, -P3(z(St, St), It), At), S5(At, r57, o60), false));
}
var It = n7();
var St = n7();
var At = E6();
function Et(a59, i49, s67, c44, l47, m45) {
  let u46 = 0;
  if (_2(ie, a59, i49), e11(re2, a59, i49), s8(a59) <= l47 || !c44.aboveGround) {
    _2(s67, re2, c44.eye);
    const f46 = P3(a59, i49) / (s8(a59) * s8(i49));
    if (f46 < 0.9999) u46 = m3(f46);
    else {
      const t71 = s8(_2(n7(), a59, i49)) / (s8(a59) * s8(i49));
      u46 = l6(t71);
    }
    const p49 = Math.cos(e12(s19.normalize(h3(m45)), 0, xt));
    u46 = -u46 - Math.max(0, s8(i49) - l47) / (p49 * l47);
  } else e11(kt, c44.eye, c44.center), _2(s67, re2, kt), u46 = -s8(re2) / l47;
  return z(s67, s67), g3(s67, s67, s8(ie)), u46;
}
var kt = n7();
function Ut(r57, a59, i49, s67) {
  let c44, l47;
  const m45 = Math.cos(e12(s19.normalize(h3(s67)), 0, xt));
  return c44 = a59 > i49 ? -(a59 - i49) / (m45 * i49) : a59 < -i49 ? Math.PI - (a59 + i49) / (m45 * i49) : m3(a59 / i49), l47 = r57 > i49 ? -(r57 - i49) / (m45 * i49) : r57 < -i49 ? Math.PI - (r57 + i49) / (m45 * i49) : m3(r57 / i49), (l47 - c44) * i49;
}
function Ht(t71, e71, n63, o60, r57, a59, i49, s67, c44, l47) {
  const m45 = Ut(t71[2], e71[2], a59[3], s67), u46 = c44 ? Ut(t71[0], e71[0], a59[3], 180) : e71[0] - t71[0], p49 = Math.sin(i49) * u46 - Math.cos(i49) * m45, h32 = Math.cos(i49) * u46 + Math.sin(i49) * m45;
  z(oe, r57);
  const M18 = c44 ? p49 / Math.sqrt(Math.abs(a59[3] ** 2 - P3(n63, oe) ** 2)) : p49 / a59[3], g28 = h32 / Math.sqrt(Math.abs(a59[3] ** 2 - P3(n63, o60) ** 2));
  o13(l47, M18, g28);
}
function Gt(t71, e71, n63, o60, r57, a59, i49, s67, c44, l47) {
  _2(ie, t71, e71), w8(a59.up, a59.eye, Lt, Nt, Qt), w8([0, 0, 1], a59.eye, Dt, Jt, Kt), r5(n63, Jt), r5(o60, Dt), z(n63, n63), g3(n63, n63, s8(ie)), q4(t71, z(Nt, Nt), z(Qt, Qt), z(Lt, Lt), Xt), q4(e71, Nt, Qt, Lt, Yt), Ht(Xt, Yt, t71, Dt, Jt, i49, s67, c44, l47, r57);
}
function Rt(t71, e71, n63, o60, r57, a59, s67) {
  p8(_t, r57, o60), p8(te, s67, a59), c4(ee, _t, te), e11(e71, t71, n63), O2(e71, e71, ee), u5(e71, e71, n63);
}
function qt(t71, e71, n63, o60, r57, a59) {
  p8(_t, o60, n63), p8(te, a59, r57), c4(ee, _t, te), e11(oe, t71.eye, e71), O2(oe, oe, ee), t71.eye = u5(oe, oe, e71), e11(oe, t71.center, e71), O2(oe, oe, ee), t71.center = u5(oe, oe, e71), e11(oe, t71.up, e71), O2(oe, oe, ee), t71.up = u5(oe, oe, e71);
}
function Ct(t71, e71, n63, o60, r57, a59) {
  return (Math.abs(o60) > Math.PI - dt2.Angle || Math.abs(o60) < dt2.Angle) && (Math.abs(t71[2]) < n63 * dt2.Pole || Math.abs(e71) > n63) && a59.aboveGround && r57 < dt2.Tilt;
}
function Ft(t71, e71, n63, o60, r57, a59) {
  if (a59) l28(n63, o60, $t), ct(e71, V2(t71), $t);
  else {
    const a60 = Et(n63, o60, se2, e71, t71[3], r57);
    ct(e71, V2(t71), m28(se2, a60));
  }
}
function Vt(t71, e71, n63, o60, r57, a59, i49) {
  const s67 = i49 ? 20 : 1, c44 = 1e-12;
  let l47, m45;
  r5(ne, o60), ae.copyFrom(e71);
  for (let u46 = 0; u46 < s67 && p3(n63, ne) > c44 && (l47 = p3(n63, ne), Gt(n63, ne, Jt, Dt, Zt, ae, t71, r57, a59, i49), qt(ae, V2(t71), Dt, Zt[1], Jt, Zt[0]), Rt(ne, ne, V2(t71), Dt, Zt[1], Jt, Zt[0]), m45 = p3(n63, ne), m45 < l47 || 0 === u46); u46++) e71.copyFrom(ae);
}
function Tt(n63, o60, r57, a59, i49, s67, c44) {
  Ct(r57, P3(o60.up, r57), n63[3], -s19.normalize(h3(i49)), s67, o60) ? Vt(n63, o60, r57, a59, -s19.normalize(h3(i49)), s67, c44) : Ft(n63, o60, r57, a59, s67, c44);
}
function Ot(t71, e71, n63, o60, r57, a59) {
  const {
    eye: i49
  } = t71;
  w8([0, 0, 1], i49, Dt, Jt, Kt);
  const s67 = e71.translation[0] * n63.pan, c44 = "zoom" === r57.mode ? 0 : e71.translation[1] * n63.pan, m45 = Math.max(Math.sqrt(Math.abs(1 - P3(t71.center, Dt) ** 2 / s8(t71.center) ** 2)), 0.5), u46 = (Math.sin(a59) * c44 + Math.cos(a59) * s67) / m45, f46 = -Math.cos(a59) * c44 + Math.sin(a59) * s67;
  switch (b3(o60.pan.matrix, o60.pan.matrix, u46, Dt), o60.pan.enabled = true, r57.mode) {
    case "pan":
      b3(o60.pan.matrix, o60.pan.matrix, f46, Jt), o60.pan.enabled = true;
      break;
    case "zoom":
      o60.zoom = -e71.translation[1] * n63.zoom;
  }
}
function Wt(t71, e71, n63, o60, r57) {
  const {
    eye: a59,
    viewRight: i49
  } = t71, s67 = _2(c6.get(), i49, a59), c44 = e71.translation[0] * n63.pan;
  switch (0 !== c44 && (b3(o60.pan.matrix, o60.pan.matrix, -c44, s67), o60.pan.enabled = true), r57.mode) {
    case "pan": {
      const t72 = e71.translation[1] * n63.pan;
      0 !== t72 && (b3(o60.pan.matrix, o60.pan.matrix, t72, i49), o60.pan.enabled = true);
      break;
    }
    case "zoom":
      o60.zoom = -e71.translation[1] * n63.zoom;
  }
}
function Bt(n63, o60, r57, a59, i49, s67, c44, l47, m45) {
  Ct(n63.center, P3(n63.up, n63.center), s8(n63.center), -s19.normalize(h3(s67)), c44, o60) ? Ot(o60, r57, a59, l47, m45, -s19.normalize(h3(i49))) : Wt(o60, r57, a59, l47, m45);
}
var Dt = n7();
var Jt = n7();
var Kt = n7();
var Lt = n7();
var Nt = n7();
var Qt = n7();
var Xt = n7();
var Yt = n7();
var Zt = n13();
var $t = s45();
var _t = e15();
var te = e15();
var ee = e15();
var ne = n7();
var oe = n7();
var re2 = n7();
var ae = new it();
var ie = n7();
var se2 = n7();
var ce2 = {
  origin: n7(),
  direction: n7()
};
var le = {
  origin: n7(),
  direction: n7()
};

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/ZoomStepControllerGlobal.js
var V12 = 0.6;
var H12 = 4;
var x16 = 60;
var A21 = class extends h21 {
  constructor() {
    super(...arguments), this._zoomLocation = n7(), this._tmpCamera = new it(), this._tmpViewDir = n7(), this._tmpRayDir = {
      origin: n7(),
      direction: n7()
    }, this._targetOnSphere = n7(), this._tmpCenter = n7(), this._beginCamera = new it(), this._constraintOptions = new r40(L12.ALL_EXCEPT_COLLISION, O17.ZOOM, null, this._beginCamera), this._sphere = _5();
  }
  initialize() {
    this._intersector = T5(this.view.state.viewingMode);
  }
  zoomStep(t71, i49) {
    if (!this.active) return;
    const e71 = this.view.state;
    this.animation.finished ? this._beginCamera.copyFrom(e71.camera) : this.animation.cameraAt(1, this._beginCamera);
    let r57 = false, o60 = false;
    this.intersectionHelper.intersectScreen(i49, this._zoomLocation, 0 === this.view.map.ground.opacity ? at2 : {}) && (r57 = t71 > 0, o60 = true), this._tmpCamera.copyFrom(e71.camera), r57 ? this.intersectionHelper.intersectRay(this._tmpCamera.ray, this._intersector, this._tmpCenter) && (this._tmpCamera.center = this._tmpCenter) : this.intersectionHelper.intersectRay(this._tmpCamera.ray, this._intersector, this._zoomLocation) ? this._tmpCamera.center = this._zoomLocation : r5(this._zoomLocation, this._tmpCamera.center), this._updateCamera(this._tmpCamera, t71, this._zoomLocation, i49, o60), this.begin(this._tmpCamera);
  }
  animationSettings() {
    return {
      duration: n3(600),
      easing: f13
    };
  }
  _updateCamera(t71, e71, r57, s67, _30) {
    const l47 = vt(t71, s67, this.view.renderCoordsHelper, this.view.viewingMode), f46 = Math.abs(this.view.camera.position.z);
    z(I17, t71.eye), g3(I17, I17, -1), p17(t71, s67, this._tmpRayDir), z(this._tmpRayDir.direction, this._tmpRayDir.direction);
    const g28 = e12(Math.min(Z5, 1 / Math.abs(P3(I17, this._tmpRayDir.direction))) * f46, $4, _18);
    if (l47 === yt.Horizontal) {
      let i49 = V12 ** e71;
      this._sphere[3] = s8(r57), e11(this._tmpViewDir, t71.center, t71.eye);
      const o60 = Math.min(s8(this._tmpViewDir), g28);
      let n63 = o60 * i49;
      if (i49 <= 1 && n63 < H12 && (n63 = H12, i49 = n63 / o60), Math.abs(o60 - n63) < 1e-6) return;
      const _31 = s8(t71.center);
      if (this._sphere[3] !== _31) {
        const e72 = this._sphere[3] + i49 * (_31 - this._sphere[3]);
        t71.center = g3(F7, t71.center, e72 / _31);
      }
      g3(this._tmpViewDir, this._tmpViewDir, -i49), t71.eye = u5(F7, t71.center, this._tmpViewDir), E23(this.view, t71, this._constraintOptions), p3(r57, t71.center) > 1e-12 && s46(this._sphere, t71, s67, this._targetOnSphere) && Tt(this._sphere, t71, r57, this._targetOnSphere, this.view.camera.heading, this.view.camera.tilt, true);
    } else {
      let i49 = V12 ** Math.abs(e71);
      const o60 = e71 > 0 ? 1 : -1;
      e11(this._tmpViewDir, r57, t71.eye);
      const n63 = s8(this._tmpViewDir), p49 = this.view._stage.renderView.getMinimalDepthForArea(null, s67[0], s67[1], this.view.state.camera, x16);
      let l48 = null != p49 ? p49 : g28;
      l48 = _30 && e71 > 0 ? Math.min(l48, n63) : l48, g3(this._tmpRayDir.direction, this._tmpRayDir.direction, l48), u5(r57, this._tmpRayDir.origin, this._tmpRayDir.direction);
      let y27 = l48 * i49;
      const f47 = Math.max(H12, 1.01 * t71.nearFar[0]);
      if (e71 > 0 && y27 < f47 && (y27 = f47, i49 = y27 / l48), Math.abs(l48 - y27) < 1e-6) return;
      g3(this._tmpRayDir.direction, this._tmpRayDir.direction, o60 * (1 - i49)), t71.eye = u5(F7, t71.eye, this._tmpRayDir.direction), t71.center = u5(F7, t71.center, this._tmpRayDir.direction);
    }
    s43(this.view, t71);
  }
};
A21 = e6([a4("esri.views.3d.state.controllers.ZoomStepControllerGlobal")], A21);
var F7 = n7();
var I17 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/ZoomStepControllerLocal.js
var M8 = 0.6;
var D6 = 4;
var F8 = 60;
var U13 = class extends h21 {
  constructor() {
    super(...arguments), this._zoomLocation = n7(), this._tmpCamera = new it(), this._tmpRayDir = n7(), this._tmpCenter = n7(), this._beginCamera = new it(), this._constraintOptions = new r40(L12.ALL, O17.ZOOM, null, this._beginCamera);
  }
  zoomStep(t71, e71) {
    if (!this.active) return;
    const s67 = this.view.state;
    this.animation.finished ? this._beginCamera.copyFrom(s67.camera) : this.animation.cameraAt(1, this._beginCamera), this._tmpCamera.copyFrom(s67.camera);
    const p49 = T5(this.view.state.viewingMode);
    let l47 = false;
    t71 > 0 ? (l47 = this.intersectionHelper.intersectScreenFreePointFallback(e71, this._zoomLocation, 0 === this.view.map.ground.opacity ? at2 : {}), this.intersectionHelper.intersectRay(this._tmpCamera.ray, p49, this._tmpCenter) && (this._tmpCamera.center = this._tmpCenter)) : this.intersectionHelper.intersectRay(this._tmpCamera.ray, p49, this._zoomLocation) ? this._tmpCamera.center = this._zoomLocation : r5(this._zoomLocation, this._tmpCamera.center);
    const C25 = M8 ** t71;
    let f46 = this.view._stage.renderView.getMinimalDepthForArea(o33(this.view), e71[0], e71[1], this.view.state.camera, F8);
    e11(S15, this._tmpCamera.eye, this._zoomLocation), z(S15, S15);
    const j21 = e12(Math.min(Z5, 1 / Math.abs(P3(O21, S15))) * Math.abs(this.view.camera.position.z), $4, _18);
    if (f46 = null != f46 ? f46 : j21, f46) {
      const t72 = n7();
      e11(t72, this._zoomLocation, this._tmpCamera.eye), (f46 < s8(t72) || !l47) && (z(t72, t72), u5(this._zoomLocation, this._tmpCamera.eye, g3(t72, t72, f46)));
    }
    this._updateCamera(this._tmpCamera, C25, this._zoomLocation), this.begin(this._tmpCamera);
  }
  animationSettings() {
    return {
      duration: n3(600),
      easing: f13
    };
  }
  _updateCamera(t71, i49, e71) {
    e11(this._tmpRayDir, e71, t71.eye);
    const s67 = s8(this._tmpRayDir);
    let o60 = s67 * i49;
    const a59 = i49 <= 1, m45 = Math.max(D6, 1.01 * t71.nearFar[0]);
    0 !== o60 && (a59 && o60 < m45 && (o60 = m45, i49 = o60 / s67), Math.abs(s67 - o60) < 1e-6 || (g3(this._tmpRayDir, this._tmpRayDir, i49), t71.eye = e11(x17, e71, this._tmpRayDir), t71.center = A4(x17, t71.center, e71, 1 - i49), E23(this.view, t71, this._constraintOptions)));
  }
};
U13 = e6([a4("esri.views.3d.state.controllers.ZoomStepControllerLocal")], U13);
var x17 = n7();
var O21 = r4(0, 0, 1);
var S15 = n7();

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/DoubleClickZoom.js
var s47 = class extends t22 {
  constructor(o60, t71) {
    super(true), this._view = o60, this.registerIncoming("double-click", t71, (o61) => this._handleDoubleClick(o61));
  }
  _handleDoubleClick(i49) {
    const s67 = i49.data;
    if (t27(s67, "primary")) {
      const r57 = this._view.state.isGlobal ? new A21({
        view: this._view,
        mode: "animation"
      }) : new U13({
        view: this._view,
        mode: "animation"
      });
      this._view.state.switchCameraController(r57), r57.zoomStep(Math.log(0.5) / Math.log(0.6), i4(s67.x, s67.y)), i49.stopPropagation();
    }
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/NearFarHeuristic.js
function c32(t71, e71, i49) {
  return t71 === l9.Global ? new M9(i49) : new u28(e71, i49);
}
var u28 = class {
  constructor(t71, e71) {
    this._elevationProvider = t71, this._referenceEllipsoid = s6(e71), this._unitInMeters = W(e71, this._referenceEllipsoid.metersPerDegree);
  }
  compute(i49, a59, m45, o60, l47) {
    l47 || (l47 = {
      near: 0,
      far: 0
    });
    let x26 = i49[2] * this._unitInMeters;
    const c44 = x26, u46 = x26 - o60, M18 = this._elevationProvider?.visibleElevationBounds;
    M18 && (x26 = u46 >= 0 ? c44 - this._unitInMeters * M18.min : this._unitInMeters * M18.max - c44);
    const _30 = {
      x: (m45 = null != m45 ? m45 : new w2({
        xmin: 0,
        ymin: 0,
        zmin: 0,
        xmax: 0,
        ymax: 0,
        zmax: 0
      })).xmax - m45.xmin,
      y: m45.ymax - m45.ymin,
      z: 4 * Math.max(m45.xmax - m45.xmin, m45.ymax - m45.ymin)
    }, I25 = Math.max(_30.x, _30.y, _30.z);
    e11(E24, a59, i49), v17[0] = E24[0] > 0 ? m45.xmax : m45.xmin, v17[1] = E24[1] > 0 ? m45.ymax : m45.ymin, v17[2] = E24[2] > 0 ? I25 / 2 : -I25 / 2, e11(v17, v17, i49), z(E24, E24);
    const j21 = 1.1 * P3(v17, E24) * this._unitInMeters, g28 = Math.sqrt(x26 * (x26 + 2 * this._referenceEllipsoid.radius)), b25 = Math.max(m45.xmax - m45.xmin, m45.ymax - m45.ymin), w24 = b25 * d27 * this._unitInMeters, z19 = b25 * y15 * this._unitInMeters, U23 = e12((x26 - z19) / (w24 - z19), 0, 1) ** 3, P19 = Math.min(f4(g28, j21, U23), g28) * Math.max(Math.log(Math.abs(u46)), 1);
    return f28(Math.min(P19, Math.max(34064e4, I25)) / this._unitInMeters, p28, this._unitInMeters, l47);
  }
};
var M9 = class {
  constructor(t71) {
    this._referenceEllipsoid = s6(t71);
  }
  compute(i49, r57, s67, n63, m45) {
    m45 || (m45 = {
      near: 0,
      far: 0
    });
    const o60 = s8(i49), h32 = o60 - this._referenceEllipsoid.radius, l47 = this._referenceEllipsoid.radius + Math.min(0, n63), c44 = Math.abs(h32 - n63), u46 = Math.max(c44, Math.abs(h32)), M18 = Math.sqrt(u46 * (u46 + 2 * l47)), p49 = o60 + this._referenceEllipsoid.radius;
    return f28(1.2 * f4(M18, p49, e38(u46)), e12(2e4 - (Math.log(u46) - 7.983) / 9.011 * 19900, 100, 2e4), 1, m45);
  }
};
function f28(t71, e71, i49, r57) {
  const s67 = _19 / i49;
  return t71 / e71 > s67 ? (r57.far = t71, r57.near = r57.far / e71) : (r57.near = s67, r57.far = r57.near * e71), r57;
}
var p28 = 2e4;
var _19 = 2;
var d27 = 1e-3;
var y15 = 1e-4;
var v17 = n7();
var E24 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/SurfaceCollisionConstraint.js
var n39 = class extends S3 {
  constructor(e71) {
    super(e71);
  }
  initialize() {
    this.addHandles(this.view.basemapTerrain.on("elevation-change", (e71) => this._handleElevationChangeEvent(e71)));
  }
  _handleElevationChangeEvent(e71) {
    if (this.view.state.cameraController) return;
    const t71 = this.view.state.camera;
    null != e71.spatialReference && u11(this.view, t71, e71.extent, e71.spatialReference) && this._applyToCurrentCamera();
  }
  _applyToCurrentCamera() {
    this.view.state.updateCamera((e71) => s43(this.view, e71, i31.EYE_AND_CENTER));
  }
};
e6([y2({
  constructOnly: true
})], n39.prototype, "view", void 0), n39 = e6([a4("esri.views.3d.state.SurfaceCollisionConstraint")], n39);

// ../../../node_modules/@arcgis/core/views/3d/state/ConstraintsManager.js
var _20 = class extends S3 {
  constructor(t71) {
    super(t71), this.nearFarHeuristic = c32(t71.view.state.viewingMode, t71.view.basemapTerrain, t71.view.renderCoordsHelper.spatialReference);
  }
  initialize() {
    this.addHandles([d2(() => [this.view.constraints?.clipDistance?.near, this.view.constraints?.clipDistance?.far], () => this._clipDistanceNearFarChanged()), d2(() => this.view.constraints?.clipDistance?.mode, () => this._updateNearFar()), this.view.state.events.on("before-camera-change", (t71) => this._updateCameraNearFar(t71)), d2(() => this.view.renderDataExtent, () => this._updateNearFar(), C), d2(() => [this.view.constraints?.altitude?.min, this.view.constraints?.altitude?.max], () => this._updateAltitude(), C), d2(() => this.view.constraints?.tilt?.max, () => this._updateTiltMax(), C), d2(() => this.view.constraints?.tilt?.mode, () => this._updateTilt(), C), d2(() => this.view.state?.camera, () => this._updateTiltAutoMax(), C), d2(() => [this.view.map?.ground?.navigationConstraint?.type, this.view.state?.constraints?.collision?.enabled], () => this._updateCollision(), C)]), this.view.state.isLocal && this.addHandles(d2(() => this.view.renderDataExtent, (t71) => this._updateLocalSurfaceDistance(t71), P)), this._updateNearFar(), this.view.state.viewingMode !== l9.Local && this._updateAltitude(), this._updateTilt(), this._updateCollision(), this._set("surfaceCollisionConstraint", new n39({
      view: this.view
    }));
  }
  destroy() {
    this.surfaceCollisionConstraint && (this.surfaceCollisionConstraint.destroy(), this._set("surfaceCollisionConstraint", null));
  }
  _clipDistanceNearFarChanged() {
    const t71 = this.view.constraints?.clipDistance;
    t71 && "auto" !== t71.mode && this.view.state.updateCamera((i49) => C12(i49, t71));
  }
  _updateNearFar() {
    this.view.state.updateCamera((t71) => this._updateCameraNearFar(t71));
  }
  _updateCameraNearFar(t71) {
    const i49 = this.view.constraints && this.view.constraints.clipDistance;
    "manual" === (i49 ? i49.mode : "auto") ? C12(t71, i49) : this._updateCameraNearFarAuto(t71, i49);
  }
  _updateCameraNearFarAuto(t71, i49) {
    this.nearFarHeuristic.compute(t71.eye, t71.center, this.view.renderDataExtent, f14(this.view, t71.eye), t71), i49 && i49.autoUpdate(t71.near, t71.far);
  }
  _updateCollision() {
    const t71 = this.view.map?.ground?.navigationConstraint?.type, i49 = !t71 || "stay-above" === t71, a59 = this.view.state.constraints.collision;
    if (i49 !== a59.enabled) {
      a59.enabled = i49, i49 && this._reapplyConstraints(L12.COLLISION);
      const t72 = this.view.constraints && this.view.constraints.tilt;
      t72 && "auto" !== t72.mode || this._updateTiltAuto();
    }
  }
  _updateAltitude() {
    const t71 = this.view.constraints && this.view.constraints.altitude;
    t71 && this.view.state.viewingMode !== l9.Local ? this.view.state.constraints.altitude = {
      min: t71.min,
      max: t71.max
    } : this.view.state.constraints.altitude = null, this._reapplyConstraints();
  }
  _updateTiltMax() {
    const t71 = this.view.constraints && this.view.constraints.tilt;
    t71 && "auto" !== t71.mode && (this._updateTiltManual(t71), this._reapplyConstraints());
  }
  _updateTilt() {
    const t71 = this.view.constraints && this.view.constraints.tilt;
    "manual" === (t71 ? t71.mode : "auto") ? this._updateTiltManual(t71) : this._updateTiltAuto(), this._reapplyConstraints();
  }
  _updateTiltManual(t71) {
    const i49 = this.view.state.constraints;
    i49.tilt = i49.createConstantMaxTilt(h3(t71.max));
  }
  _updateTiltAuto() {
    const t71 = this.view.state.constraints;
    t71.tilt = t71.createDefaultTilt(), this._updateTiltAutoMax();
  }
  _updateTiltAutoMax() {
    const t71 = this.view.constraints && this.view.constraints.tilt;
    if (!t71 || "auto" !== t71.mode) return;
    const i49 = this.view.state.constraints;
    if (i49.tilt) {
      const a59 = i49.tilt(this.view.state.camera.distance).max;
      t71.autoUpdate(M(a59));
    }
  }
  _updateLocalSurfaceDistance(t71) {
    if (null == t71) return;
    let i49 = Math.max(t71.width, t71.height);
    if (i49 <= 0) return;
    null != t71.zmax && null != t71.zmin && (i49 = Math.max(i49, t71.zmax - t71.zmin));
    const a59 = this.view.state, s67 = 3 * i49 / Math.atan(a59.camera.fov / 2);
    s67 !== a59.constraints.distance && (a59.constraints.distance = s67);
  }
  _reapplyConstraints(t71 = L12.ALL) {
    this.view.state.updateCamera((i49) => E23(this.view, i49, new r40(t71, O17.NONE, null)));
  }
};
function C12(t71, i49) {
  i49 && (t71.near = i49.near, t71.far = i49.far);
}
e6([y2({
  constructOnly: true
})], _20.prototype, "view", void 0), e6([y2({
  readOnly: true
})], _20.prototype, "surfaceCollisionConstraint", void 0), _20 = e6([a4("esri.views.3d.state.ConstraintsManager")], _20);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/SurfaceCollisionCorrectionController.js
var l29 = class extends n38 {
  set desiredCamera(e71) {
    this._set("desiredCamera", e71.clone());
  }
  constructor(e71) {
    super(e71);
  }
  get canStop() {
    return true;
  }
  get constraintEnabled() {
    return this.view.state.constraints.collision.enabled;
  }
  onControllerStart() {
    this.state = s44.Running, this.addHandles(this.view.basemapTerrain.on("elevation-change", (e71) => this._handleElevationChangeEvent(e71))), this._applyCorrection();
  }
  onControllerEnd() {
    this.removeAllHandles();
  }
  stepController() {
  }
  _handleElevationChangeEvent(e71) {
    (null == e71.spatialReference || u11(this.view, this.desiredCamera, e71.extent, e71.spatialReference)) && this._applyCorrection();
  }
  _applyCorrection() {
    this.view.state.updateCamera((e71) => {
      e71.copyViewFrom(this.desiredCamera), s43(this.view, e71, i31.EYE_AND_CENTER) || this.constraintEnabled || (this.state = s44.Stopped);
    });
  }
};
e6([y2({
  constructOnly: true
})], l29.prototype, "desiredCamera", null), l29 = e6([a4("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")], l29);

// ../../../node_modules/@arcgis/core/views/3d/state/GoToOperation.js
var f29 = class {
  constructor(t71, i49, e71) {
    this._target = t71, this._options = i49, this.view = e71, this.state = "pending", this._animationController = null, this.promise = new Promise((t72, i50) => {
      this._resolveCallback = t72, this._rejectCallback = i50;
      const e72 = new AbortController();
      null != this._options.signal && m(this._options.signal, () => {
        this.abort();
      }), this._abortController = e72, this._waitForReady();
    });
  }
  _resolve(t71) {
    if ("finished" !== this.state) return this.state = "finished", this._resolveCallback(t71);
  }
  _reject(t71) {
    if ("finished" !== this.state) return this.state = "finished", this._rejectCallback(t71);
  }
  abort(t71 = false) {
    if (this._abortController.abort(), "wait-for-animation-finish" === this.state) !t71 && null != this._animationController && this.view.state.cameraController === this._animationController && this._animationController.active && this._animationController.stopController();
    this._reject(u2());
  }
  _waitForReady() {
    return __async(this, null, function* () {
      if (this.state = "wait-for-ready", !this.view.ready) try {
        yield w(() => this.view.ready, this._abortController.signal);
      } catch (t71) {
        return this._reject(t71);
      }
      this._createViewPoint();
    });
  }
  _createViewPoint() {
    return __async(this, null, function* () {
      if ("finished" !== this.state) {
        this.state = "wait-for-viewpoint", this._animationController = this._options.animate ? this._getAnimationController() : null;
        try {
          const t71 = yield dt(this.view, this._target, this._abortController.signal);
          if ("finished" === this.state) return;
          const i49 = t71 ? this._getCameraFromViewpoint(t71) : null;
          if (null == i49) return;
          if (this._options.animate) {
            if (null == this._animationController) return;
            this._startAnimation(i49, this._animationController);
          } else this.view.stateManager.setStateCamera(i49.camera, {
            applyConstraints: !i49.isFullySpecified,
            positionAndOrientationOnly: true,
            doNotCancelGoToOperation: true
          }), this._resolve();
        } catch (t71) {
          this._reject(t71);
        }
      }
    });
  }
  _getCameraFromViewpoint(a59) {
    const n63 = !!(this._target instanceof m14 && this._target.camera || this._target instanceof d9), o60 = a59.camera;
    if (null == o60) return null;
    if (!this.view.stateManager.isCompatible(o60)) {
      const t71 = o60.position, i49 = t71 && t71.spatialReference, a60 = i49 ? i49.wkid : "none", n64 = this.view.spatialReference?.wkid;
      return this._reject(new s("GotoAnimation:incompatible-spatialreference", `Resulting camera has an incompatible spatial reference (camera: ${a60}, view: ${n64})`, {
        camera: o60
      })), null;
    }
    const r57 = Z2(this.view, o60);
    return null == r57 ? (this._reject(new s("GotoAnimation:invalid-camera", "Resulting camera is invalid")), null) : {
      viewpoint: a59,
      camera: r57,
      isFullySpecified: n63
    };
  }
  _startAnimation(t71, i49) {
    this.state = "wait-for-animation-finish";
    const a59 = i49.viewAnimation;
    if (null == a59) return void this._reject(new s("GotoAnimation:missing-animation", "Unreachable code in view.stateManager"));
    if (a59.update(t71.viewpoint, "running"), !i49.active || null == i49.viewAnimation || i49.viewAnimation.target !== t71.viewpoint || this.view.state.cameraController !== i49) return this.abort();
    let n63;
    t71.isFullySpecified ? (n63 = new l29({
      view: this.view,
      desiredCamera: t71.camera
    }), s43(this.view, t71.camera, i31.EYE_AND_CENTER)) : E23(this.view, t71.camera), i49.begin(t71.camera, this._options);
    const o60 = () => {
      const e71 = this.view.state.cameraController;
      n63 && (e71 && e71.active ? e71 instanceof h21 && null != e71.viewAnimation && e71.viewAnimation.target === t71.viewpoint && (this.view.state.cameraController = n63) : null != i49.viewAnimation && i49.viewAnimation.target === t71.viewpoint && i49.state === s44.Finished && (this.view.state.cameraController = n63));
    }, w24 = (t72) => {
      if (null != this.view.state) switch (i49.state) {
        case s44.Finished:
          switch (this.state) {
            case "pending":
            case "wait-for-ready":
            case "wait-for-viewpoint":
            case "wait-for-animation-finish":
              this._resolve();
          }
          break;
        case s44.Ready:
        case s44.Rejected:
        case s44.Running:
        case s44.Stopped:
          switch (this.state) {
            case "pending":
            case "wait-for-ready":
            case "wait-for-viewpoint":
            case "wait-for-animation-finish":
              this._reject(t72);
          }
      }
    };
    a59.when(o60, (t72) => w24(t72)), i49.asyncResult = {
      resolve: () => w24(),
      reject: (t72) => w24(t72)
    };
  }
  _getAnimationController() {
    let t71 = null, i49 = null;
    const a59 = this.view.state.cameraController;
    return a59 instanceof h21 && (a59.updateStateFromViewAnimation(), a59.active && (t71 = a59, i49 = t71.viewAnimation)), null != t71 || (t71 = new h21({
      view: this.view,
      mode: "animation"
    }), i49 = t71.viewAnimation, this.view.state.switchCameraController(t71)) ? t71 : (null != i49 && i49.stop(), this._reject(new s("GotoAnimation:goto-cannot-interrupt", "Cannot start an animation while interacting")), null);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/ViewStateManager.js
var Q10 = class extends S3 {
  constructor(e71) {
    super(e71), this.ready = false, this._windowDevicePixelRatio = 1, this._devicePixelRatioOverride = null, this._idleTimeout = se3, this.test = {
      viewStateManager: this,
      contentCameraResetState: /* @__PURE__ */ new Map(),
      setDevicePixelRatio: (e72) => this._devicePixelRatioOverride = e72,
      renderState: null,
      get maximumPixelRatio() {
        return this.viewStateManager.view.qualitySettings.maximumPixelRatio;
      },
      get updatingIgnoreRenderState() {
        return null != this.renderState;
      },
      get idleTimeoutEnabled() {
        return this.viewStateManager._idleTimeout > 0;
      },
      set idleTimeoutEnabled(e72) {
        this.viewStateManager._idleTimeout = e72 ? se3 : 0;
      }
    }, this._propertiesPool = new o21({
      frustum: c20
    }, this), this._cameraSetByUser = false, this._gotoOperation = null, this._cameraChangeTime = 0, this._tmpCanvasSize = new X8();
  }
  initialize() {
    this._cameraChangeTime = performance.now(), this.addHandles([v2(() => this.view.state.events, "before-camera-change", (e71) => e71 && this._updateElevation(e71)), d2(() => this.view.state?.camera, (e71, t71) => this._cameraChangedHandler(e71, t71), C)]), p(() => this.view.state?.camera, (e71) => this._updateElevation(e71), {
      once: true,
      sync: true
    }), this.addHandles([A2({
      prepare: () => this._prepareFrame()
    }), d2(() => this.view.state.cameraController, () => {
      this._cameraSetByUser = true, this.removeHandles(re3);
    }), v2(() => this.view.state.events, "camera-projection-changed", () => this.notifyChange("scale"))]);
  }
  destroy() {
    this.exit(), this._propertiesPool = u(this._propertiesPool);
  }
  get camera() {
    const e71 = this._get("camera");
    if (!this.ready) return e71;
    const t71 = Q3(this.view, this.view.state.camera, ee2);
    return t71 && e71 && t71.equals(e71) ? e71 : t71.clone();
  }
  set camera(e71) {
    this._updatePropertyBeforeReady("camera", e71) || (this.view.elevationProvider?.enableCache(true), this.setStateCamera(Z2(this.view, e71), {
      applyConstraints: false
    }) || n.getLogger(this).error("#camera=", "Invalid camera", e71), this.view.elevationProvider?.enableCache(false));
  }
  get contentCamera() {
    const e71 = this._get("contentCamera");
    if (!this.ready) return e71;
    const t71 = Q3(this.view, this.view.state.contentCamera, ee2);
    return t71 && e71 && t71.equals(e71) ? e71 : t71.clone();
  }
  set contentCamera(e71) {
    if (this._updatePropertyBeforeReady("contentCamera", e71)) return;
    const t71 = Z2(this.view, e71);
    null != t71 ? (this._updateElevation(t71), this.view.state.contentCamera = t71) : this.view.state.contentCamera = null;
  }
  installContentCameraReset(e71) {
    if (this.removeHandles(ae2), this.test.contentCameraResetState.clear(), !this.view.state.fixedContentCamera) return false;
    const t71 = this.zoom, i49 = this.view.state.camera.distance ** 2, r57 = e9(this.view.state.camera.center), a59 = e71.sticky ? this.contentCamera.clone() : null;
    return this.addHandles([d2(() => this.contentCamera, () => {
      e71.sticky || (this.removeHandles(ae2), this.test.contentCameraResetState.clear());
    }), d2(() => this.zoom, (e72) => {
      void 0 !== e72 && void 0 !== t71 && (this.test.contentCameraResetState.set("view.zoom", Math.abs(e72 - t71) / 2), Math.abs(e72 - t71) > 2 ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a59));
    }), d2(() => this.view.state.camera, (e72) => {
      const t72 = p3(r57, e72.center);
      this.test.contentCameraResetState.set("camera.center", t72 / i49), t72 > i49 ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a59);
    })], ae2), true;
  }
  get center() {
    return this.ready ? this.view.pointsOfInterest.centerOnContent.location : this._get("center");
  }
  set center(e71) {
    this._updatePropertyBeforeReady("center", e71) || (e71 ? this.isCompatible(e71) ? this.setStateCamera(this._centerToCamera(e71), {
      applyConstraints: true
    }) ? this.view.pointsOfInterest.centerOnContent.runTask() : n.getLogger(this).error("#center=", "Invalid center", e71) : n.getLogger(this).error("#center=", "Center has an incompatible spatial reference (center: " + (e71.spatialReference ? e71.spatialReference.wkid : "none") + ", view: " + this.view.spatialReference?.wkid + ")", e71) : n.getLogger(this).error("#center=", "Center may not be null or undefined"));
  }
  get extent() {
    if (!this.ready) return this._get("extent");
    const e71 = this.view, t71 = Re(e71, e71.state.camera, e71.pointsOfInterest.centerOnContent.renderLocation);
    return null != t71 ? t71 : this._get("extent");
  }
  set extent(e71) {
    this._updatePropertyBeforeReady("extent", e71) || (e71 ? this.isCompatible(e71) ? this.setStateCamera(this._extentToCamera(e71), {
      applyConstraints: true
    }) || n.getLogger(this).error("#extent=", "Invalid extent", e71) : n.getLogger(this).error("#extent=", "Extent has an incompatible spatial reference (extent: " + (e71.spatialReference ? e71.spatialReference.wkid : "none") + ", view: " + this.view.spatialReference?.wkid + ")", e71) : n.getLogger(this).error("#extent=", "Extent may not be null or undefined"));
  }
  get frustum() {
    const e71 = this._propertiesPool.get("frustum");
    return e71.renderCoordsHelper = this.view.renderCoordsHelper, e71.update(this.view.state.camera), e71;
  }
  get constraintsManager() {
    return this._constraintsManager;
  }
  get _initialViewpoint() {
    const e71 = this.view.map;
    return e71 && "initialViewProperties" in e71 ? e71.initialViewProperties?.viewpoint : void 0;
  }
  get hasInitialView() {
    return !!this._initialViewpoint;
  }
  get scale() {
    if (this.ready) {
      const e71 = this.view.pointsOfInterest.centerOnContent;
      return _11(this.view, e71.distance, e71.location.latitude);
    }
    return this._get("scale");
  }
  set scale(e71) {
    this._updatePropertyBeforeReady("scale", e71) || this.setStateCamera(this._scaleToCamera(e71), {
      applyConstraints: true
    }) || n.getLogger(this).error("#scale=", "Invalid scale", e71);
  }
  get terrainScale() {
    if (!this.ready) return this._get("scale");
    const e71 = this.view, t71 = e71.basemapTerrain.tilingScheme, i49 = e71.pointsOfInterest.cameraOnSurface.scale;
    if (!t71 || !i49) return this._get("scale");
    const r57 = e71.state.contentCamera;
    let a59 = re(e71, r57.eye, r57.viewForward, r57.up).tilt;
    a59 > 90 && (a59 = 180 - a59);
    const s67 = 2 * (a59 / 90) ** 2, n63 = t71.levelAtScale(i49) - s67;
    return n63 < 0 ? this._get("scale") : t71.scaleAtLevel(n63);
  }
  get padding() {
    if (!this.ready) return this._get("padding");
    const e71 = this.view.state.camera, t71 = e71.padding, i49 = e71.pixelRatio, r57 = this._get("padding"), a59 = Math.round(t71[t33.TOP] / i49), s67 = Math.round(t71[t33.RIGHT] / i49), n63 = Math.round(t71[t33.BOTTOM] / i49), o60 = Math.round(t71[t33.LEFT] / i49);
    return null != r57 && r57.top === a59 && r57.right === s67 && r57.bottom === n63 && r57.left === o60 ? r57 : {
      top: a59,
      right: s67,
      bottom: n63,
      left: o60
    };
  }
  set padding(e71) {
    this._updatePropertyBeforeReady("padding", e71) || (this._paddingToArray(e71, this.view.state.camera.pixelRatio, ie2), this.view.state.updateCamera((e72) => e72.padding = ie2));
  }
  _paddingToArray(e71, t71, i49) {
    e71 ? s11(i49, e71.top || 0, e71.right || 0, e71.bottom || 0, e71.left || 0) : s11(i49, 0, 0, 0, 0);
    for (let r57 = 0; r57 < 4; r57++) i49[r57] = Math.round(i49[r57] * t71);
  }
  get screenCenter() {
    const e71 = this.padding;
    return c3((this.view.width - (e71.left + e71.right)) / 2 + e71.left, (this.view.height - (e71.top + e71.bottom)) / 2 + e71.top);
  }
  get viewpoint() {
    return this.ready ? ht(this.view, this.camera) : this._get("viewpoint");
  }
  set viewpoint(e71) {
    if (!this._updatePropertyBeforeReady("viewpoint", e71)) if (e71) {
      if (this.isCompatible(e71)) this.setStateCamera(this._viewpointToCamera(e71), {
        applyConstraints: !e71.camera
      }) || n.getLogger(this).error("#viewpoint=", "Invalid viewpoint", e71);
      else {
        const t71 = null != e71.camera ? e71.camera.position : e71.targetGeometry, i49 = null != t71 && t71.spatialReference;
        n.getLogger(this).error("#viewpoint=", "Viewpoint has an incompatible spatial reference (viewpoint: " + (i49 ? i49.wkid : "none") + ", view: " + this.view.spatialReference?.wkid + ")", e71);
      }
    } else n.getLogger(this).error("#viewpoint=", "Viewpoint may not be null or undefined");
  }
  get zoom() {
    return this.ready ? Pe(this.view, this.scale) : this._get("zoom");
  }
  set zoom(e71) {
    this._updatePropertyBeforeReady("zoom", e71) || void 0 === e71 || this.setStateCamera(this._zoomToCamera(e71), {
      applyConstraints: true
    }) || n.getLogger(this).error("#zoom=", "Invalid zoom", e71);
  }
  _computeCanvasSize() {
    if (this._devicePixelRatioOverride) return this.view.state.contentPixelRatio = this._devicePixelRatioOverride, this._tmpCanvasSize.width = Math.round(this.view.surface.clientWidth * this._devicePixelRatioOverride), this._tmpCanvasSize.height = Math.round(this.view.surface.clientHeight * this._devicePixelRatioOverride), this._tmpCanvasSize.pixelRatio = this._devicePixelRatioOverride, this._tmpCanvasSize;
    const e71 = Math.min(this._windowDevicePixelRatio, this.view.qualitySettings.maximumPixelRatio), t71 = (this._usePhysicalPixelRendering ? this._windowDevicePixelRatio : e71) * this.view.resolutionScale;
    this._tmpCanvasSize.width = Math.round(this.view.surface.clientWidth * t71), this._tmpCanvasSize.height = Math.round(this.view.surface.clientHeight * t71);
    const i49 = this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;
    return i49 && A6(this._tmpCanvasSize, i49), this._tmpCanvasSize.pixelRatio = this._tmpCanvasSize.width > 0 ? this._tmpCanvasSize.width / this.view.surface.clientWidth * 0.5 + this._tmpCanvasSize.height / this.view.surface.clientHeight * 0.5 : t71, this.view.state && (this.view.state.contentPixelRatio = Math.min(this._windowDevicePixelRatio, this.view.qualitySettings.maximumPixelRatio)), this._tmpCanvasSize;
  }
  get _rasterPixelRatio() {
    return null != this._devicePixelRatioOverride ? this._devicePixelRatioOverride : this._usePhysicalPixelRenderingAny ? this._windowDevicePixelRatio : Math.min(this._windowDevicePixelRatio, this.view.qualitySettings.maximumPixelRatio);
  }
  get _usePhysicalPixelRendering() {
    return this.view?._stage?.renderer.isFeatureEnabled(o32.PhysicalPixelRendering) ?? false;
  }
  get _usePhysicalPixelRenderingAny() {
    const e71 = this.view?._stage?.renderer;
    return e71 && (e71.isFeatureEnabled(o32.PhysicalPixelRendering, I2.IDLE) || e71.isFeatureEnabled(o32.PhysicalPixelRendering, I2.INTERACTING) || e71.isFeatureEnabled(o32.PhysicalPixelRendering, I2.ANIMATING));
  }
  preinit(e71) {
    return !(this._isOverridden("center") && !B(this.center.spatialReference, e71)) && !(this._isOverridden("camera") && !B(this.camera.position.spatialReference, e71)) && !(this._isOverridden("extent") && !B(this.extent.spatialReference, e71)) && !!(!this._isOverridden("viewpoint") || B(this.viewpoint.targetGeometry?.spatialReference, e71) && B(this.viewpoint.camera?.position?.spatialReference, e71));
  }
  init() {
    this._constraintsManager = new _20({
      view: this.view
    }), this._prepareFrame();
    const e71 = this._getInitialProperties();
    this._cameraSetByUser = false, this._set("ready", true);
    for (const t71 of e71) this.set(t71.name, t71.value);
    if (!this._cameraSetByUser) {
      const e72 = this._initialViewpoint || this.view.initialExtent;
      e72 && this.isCompatible(e72) ? this._setInitialView(e72) : this.view.state.viewingMode === l9.Local && this.addHandles(p(() => this.view.basemapTerrain.ready, () => {
        this.removeHandles(re3), this._setInitialView(this.view.dataExtent);
      }, {
        once: true,
        initial: true
      }), re3);
    }
  }
  exit() {
    this._cancelGoToOperation(), this.ready && (this._override("padding", this.padding), this._set("ready", false), this._clearOverride("hasInitialView"), this._cameraSetByUser = false, this.removeHandles(re3), this._constraintsManager = u(this._constraintsManager));
  }
  goTo(e71, t71) {
    return __async(this, null, function* () {
      return t71 = __spreadValues({
        animate: true
      }, t71), null != this._gotoOperation && this._gotoOperation.abort(t71.animate), this._gotoOperation = new f29(e71, t71, this.view), this.view.resourceController.scheduler.stopFrame(), this._gotoOperation.promise;
    });
  }
  debugSetCameraOnContent() {
    this.setStateCamera(g8(this.view), {
      applyConstraints: false
    });
  }
  step(e71) {
    const t71 = this.view.state, i49 = t71?.cameraController;
    i49 && (t71.updateCamera((t72) => i49.stepController(e71, t72)), i49.steppingFinished && i49.finishController());
  }
  _cancelGoToOperation() {
    null != this._gotoOperation && (this._gotoOperation.abort(), this._gotoOperation = null);
  }
  _getInitialProperties() {
    const e71 = /* @__PURE__ */ new Set(), t71 = [];
    for (const {
      propertyName: i49,
      overrides: r57
    } of Z6) {
      const a59 = e71.has(i49), s67 = this._isOverridden(i49);
      !a59 && s67 && t71.push({
        name: i49,
        value: this._get(i49)
      }), this._clearOverride(i49), (a59 || s67) && r57.forEach((t72) => e71.add(t72));
    }
    return t71;
  }
  _setInitialView(e71) {
    if (null == e71 || this._cameraSetByUser) return;
    if (e71 instanceof d9) return void this.setStateCamera(Z2(this.view, e71), {
      applyConstraints: false
    });
    if (e71 instanceof m14) {
      if (e71.targetGeometry instanceof w2) {
        const t72 = we(this.view, e71.targetGeometry, 0, 0.5, K4.LOCKED);
        return void (null != t72 && this.setStateCamera(Z2(this.view, t72), {
          applyConstraints: true
        }));
      }
      const t71 = {
        applyConstraints: !e71.camera
      }, i49 = this._viewpointToCamera(e71);
      return void this.setStateCamera(i49, t71);
    }
    const r57 = we(this.view, e71, 0, 0.5, K4.LOCKED);
    null != r57 && this.setStateCamera(Z2(this.view, r57), {
      applyConstraints: true
    });
  }
  _updatePropertyBeforeReady(e71, t71) {
    return !this.ready && (this._override(e71, t71), t71 && Y7.has(e71) && this._override("hasInitialView", true), true);
  }
  isCompatible(e71) {
    return null != e71 && (e71 instanceof m14 ? e71.camera ? this.isCompatible(e71.camera) : this.isCompatible(e71.targetGeometry) : e71 instanceof d9 ? this.isCompatible(e71.position) : e71.spatialReference && !U5(e71.spatialReference, this.view.spatialReference));
  }
  _getPreservingHeadingTilt(e71 = $5) {
    return this._cameraSetByUser ? (e71.heading = this.camera.heading, e71.tilt = this.camera.tilt) : (e71.heading = 0, e71.tilt = 0.5), e71;
  }
  _centerPointAtDistanceToCamera(e71, t71, i49 = te2) {
    const {
      heading: r57,
      tilt: a59
    } = this._getPreservingHeadingTilt(), s67 = ce(this.view, r57, a59, e71, t71, K4.ADJUST);
    return null == s67 ? null : (i49.copyFrom(this.view.state.camera), i49.eye = s67.eye, i49.center = s67.center, i49.up = s67.up, i49);
  }
  _centerToCamera(e71) {
    const t71 = this.view.pointsOfInterest.centerOnContent;
    t71.runTask();
    const i49 = t71.distance;
    return this._centerPointAtDistanceToCamera(e71, i49);
  }
  _extentToCamera(e71) {
    const {
      heading: t71,
      tilt: i49
    } = this._getPreservingHeadingTilt(), r57 = we(this.view, e71, t71, i49, K4.ADJUST, ee2);
    return r57 ? Z2(this.view, r57) : null;
  }
  _scaleToCamera(e71) {
    if (null == e71) return null;
    const t71 = this.view.pointsOfInterest.centerOnContent;
    t71.runTask();
    const i49 = t71.renderLocation, r57 = t71.location.latitude, a59 = $(this.view, e71, r57);
    return this._centerPointAtDistanceToCamera(i49, a59);
  }
  _zoomToCamera(e71) {
    return this._scaleToCamera(Ae(this.view, e71));
  }
  _viewpointToCamera(e71) {
    return Z2(this.view, lt2(this.view, e71));
  }
  setStateCamera(e71, t71) {
    return !(null == e71 || !this.view.state.stopActiveCameraController()) && (this._cameraSetByUser = true, t71.doNotCancelGoToOperation || this._cancelGoToOperation(), this.view.state.updateCamera((i49) => {
      t71.positionAndOrientationOnly ? (i49.eye = e71.eye, i49.center = e71.center, i49.up = e71.up, i49.fov = e71.fov) : i49.copyFrom(e71), t71.applyConstraints && E23(this.view, i49);
    }), t71.applyConstraints || (this.view.state.cameraController = new l29({
      view: this.view,
      desiredCamera: e71
    })), true);
  }
  _prepareFrame() {
    const {
      surface: e71,
      canvas: t71
    } = this.view;
    if (!e71 || !t71) return;
    this._windowDevicePixelRatio = window.devicePixelRatio;
    const i49 = this._computeCanvasSize();
    if (0 !== i49.width && 0 !== i49.height && (t71.width === i49.width && t71.height === i49.height || (t71.width = i49.width, t71.height = i49.height), this.view.state)) {
      const e72 = this.view.state.camera;
      e72.fullWidth === i49.width && e72.fullHeight === i49.height && e72.pixelRatio === i49.pixelRatio || (te2.copyFrom(e72), te2.pixelRatio !== i49.pixelRatio && (this._paddingToArray(this.padding, i49.pixelRatio, ie2), te2.padding = ie2), te2.fullWidth = i49.width, te2.fullHeight = i49.height, te2.pixelRatio = i49.pixelRatio, this.view.state.camera = te2), this._updateViewState();
    }
  }
  _updateElevation(e71) {
    const t71 = this.view.basemapTerrain?.spatialReference, i49 = this.view.renderCoordsHelper?.getAltitude(e71.eye) ?? 0, r57 = t71 ? f14(this.view, e71.eye) : 0;
    e71.relativeElevation = i49 - r57;
  }
  _updateViewState() {
    null != this.test.renderState ? this.view.state.mode = this.test.renderState : this.view.animation ? this.view.state.mode = I2.ANIMATING : this.view.interacting ? this.view.state.mode = I2.INTERACTING : (this.view.state.mode === I2.ANIMATING && (this._cameraChangeTime = 0), performance.now() - this._cameraChangeTime < this._idleTimeout ? this.view.state.mode = I2.INTERACTING : this.view.state.mode = I2.IDLE), this.view.state.rasterPixelRatio = this._rasterPixelRatio;
  }
  _cameraChangedHandler(e71, t71) {
    e71 && t71 && e71.almostEquals(t71) || (this._cameraChangeTime = performance.now(), this._updateViewState());
  }
};
e6([y2({
  type: d9,
  dependsOn: ["view.state.camera", "ready"]
})], Q10.prototype, "camera", null), e6([y2({
  type: d9,
  dependsOn: ["view.state.contentCamera", "ready"]
})], Q10.prototype, "contentCamera", null), e6([y2({
  type: _
})], Q10.prototype, "center", null), e6([y2({
  type: w2
})], Q10.prototype, "extent", null), e6([y2({
  readOnly: true
})], Q10.prototype, "frustum", null), e6([y2()], Q10.prototype, "_constraintsManager", void 0), e6([y2({
  readOnly: true
})], Q10.prototype, "constraintsManager", null), e6([y2()], Q10.prototype, "_initialViewpoint", null), e6([y2({
  readOnly: true
})], Q10.prototype, "hasInitialView", null), e6([y2({
  readOnly: true,
  type: Boolean
})], Q10.prototype, "ready", void 0), e6([y2({
  type: Number
})], Q10.prototype, "scale", null), e6([y2({
  type: Number
})], Q10.prototype, "terrainScale", null), e6([y2()], Q10.prototype, "padding", null), e6([y2({
  readOnly: true
})], Q10.prototype, "screenCenter", null), e6([y2({
  constructOnly: true
})], Q10.prototype, "view", void 0), e6([y2({
  type: m14
})], Q10.prototype, "viewpoint", null), e6([y2({
  type: Number
})], Q10.prototype, "zoom", null), e6([y2({
  readOnly: true
})], Q10.prototype, "_rasterPixelRatio", null), e6([y2({
  readOnly: true
})], Q10.prototype, "_usePhysicalPixelRendering", null), e6([y2({
  readOnly: true
})], Q10.prototype, "_usePhysicalPixelRenderingAny", null), e6([y2()], Q10.prototype, "_windowDevicePixelRatio", void 0), e6([y2()], Q10.prototype, "_devicePixelRatioOverride", void 0), Q10 = e6([a4("esri.views.3d.state.ViewStateManager")], Q10);
var X8 = class {
  constructor() {
    this.width = 0, this.height = 0, this.pixelRatio = 1;
  }
};
var Y7 = /* @__PURE__ */ new Set(["camera", "viewpoint", "extent", "scale", "center", "zoom"]);
var Z6 = [{
  propertyName: "camera",
  overrides: ["viewpoint"]
}, {
  propertyName: "viewpoint",
  overrides: ["extent"]
}, {
  propertyName: "extent",
  overrides: ["center", "scale"]
}, {
  propertyName: "center",
  overrides: []
}, {
  propertyName: "scale",
  overrides: ["zoom"]
}, {
  propertyName: "zoom",
  overrides: []
}, {
  propertyName: "padding",
  overrides: []
}];
var $5 = {
  heading: 0,
  tilt: 0
};
var ee2 = new d9();
var te2 = new it();
var ie2 = n11();
var re3 = "pending-initial-view";
var ae2 = "content-camera-reset";
var se3 = 300;
var ne2 = 100;

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/InteractiveController.js
var n40 = class extends n38 {
  constructor() {
    super(...arguments), this.startCamera = new it(), this.currentCamera = new it(), this._lastInteraction = 0;
  }
  get isInteractive() {
    return performance.now() - this._lastInteraction < ne2;
  }
  stepController(r57, t71) {
    t71.copyViewFrom(this.currentCamera), this.currentCamera.copyFrom(t71);
  }
  onControllerStart(r57) {
    this.state = s44.Running, this.startCamera.copyFrom(r57), this.currentCamera.copyFrom(r57);
  }
  onControllerEnd(r57) {
    r57.copyViewFrom(this.currentCamera);
  }
  commitCamera() {
    this._lastInteraction = performance.now(), setTimeout(() => this.notifyChange("isInteractive"), ne2), this.view.state.updateCamera((r57) => this.stepController(0, r57)), this.steppingFinished && this.finishController();
  }
};
e6([y2({
  readOnly: true
})], n40.prototype, "isInteractive", null), e6([y2()], n40.prototype, "_lastInteraction", void 0), n40 = e6([a4("esri.views.3d.state.controllers.InteractiveController")], n40);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/RotateController.js
var V13;
!function(t71) {
  t71[t71.CENTER = 0] = "CENTER", t71[t71.EYE = 1] = "EYE";
}(V13 || (V13 = {}));
var H13 = class extends n40 {
  get _intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  constructor(t71) {
    super(t71), this.pivot = V13.CENTER, this._rotScale = 0, this._lastPoint = n13(), this._tmpWorldUp = n7(), this._tmpViewDir = n7(), this._tmpRotCurPoint = n13(), this._tmpTransf = e15(), this._tmpAxis = n7(), this._tmpPivotPoint = n7(), this._pivotPos = n7(), this._constraintOptions = new r40(L12.ALL, O17.TUMBLE, 0, this.startCamera);
  }
  initialize() {
    this._rotScale = this.pivot === V13.CENTER ? 3 : 1.5;
  }
  begin(t71) {
    if (this.active) {
      switch (this.pivot) {
        case V13.EYE:
          r5(this._pivotPos, this.startCamera.eye), this._constraintOptions.interactionType = O17.LOOK_AROUND, this._constraintOptions.tiltMode = O18.LOOK_AROUND, this._constraintOptions.selection = L12.NONE;
          break;
        case V13.CENTER: {
          const i49 = this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray, this._pivotPos, 0 === this.view.map.ground.opacity ? at2 : {});
          i49 || r5(this._pivotPos, this.startCamera.center), this._constrainPivotPoint(t71, i49), this.startCamera.center = this._pivotPos, this._constraintOptions.interactionType = O17.TUMBLE, this._constraintOptions.tiltMode = O18.TUMBLE, this._constraintOptions.selection = L12.ALL & ~L12.DISTANCE;
          break;
        }
      }
      it2(this.startCamera, t71, this._lastPoint);
    }
  }
  _constrainPivotPoint(t71, i49) {
    const s67 = this.startCamera, o60 = n7();
    e11(o60, this._pivotPos, s67.eye);
    const e71 = s8(o60), a59 = Math.abs(this.view.camera.position.z);
    this.view.renderCoordsHelper.worldUpAtPosition(s67.eye, k12);
    let n63 = Math.max(Math.min(nt, 1 / Math.abs(P3(k12, s67.viewForward))) * a59, ot);
    i49 && (n63 = Math.min(e71, n63));
    const h32 = i4(s67.width / s67.pixelRatio * 0.5, s67.height / s67.pixelRatio * 0.5), p49 = vt(this.startCamera, h32, this.view.renderCoordsHelper, this.view.viewingMode);
    let m45 = this.view._stage.renderView.getMinimalDepthForArea(o33(this.view), s67.fullWidth / s67.pixelRatio * 0.5, s67.fullHeight / s67.pixelRatio * 0.5, s67, 2.5 * rt, rt), u46 = this.view._stage.renderView.getMinimalDepthForArea(o33(this.view), t71[0], t71[1], s67, rt);
    null == m45 && null == u46 || (m45 = m45 ?? u46 ?? 0, u46 = null == u46 || p49 === yt.Horizontal ? m45 : u46, n63 = m45 > u46 ? u46 : m45, n63 = i49 ? Math.min(n63, e71) : n63), z(o60, o60), r5(this._pivotPos, u5(this._tmpPivotPoint, s67.eye, g3(this._tmpPivotPoint, o60, n63)));
  }
  update(t71) {
    if (this.active) {
      switch (this.pivot) {
        case V13.EYE:
          this.currentCamera.center = this._applyRotation(this.currentCamera, t71, this.currentCamera.center, this._pivotPos);
          break;
        case V13.CENTER:
          this.currentCamera.center = this._pivotPos, this.currentCamera.eye = this._applyRotation(this.currentCamera, t71, this.currentCamera.eye, this._pivotPos);
      }
      E23(this.view, this.currentCamera, this._constraintOptions), this.commitCamera();
    }
  }
  end() {
    this.active && this.finishController();
  }
  _applyRotation(t71, r57, o60, e71) {
    this.view.renderCoordsHelper.worldUpAtPosition(e71, this._tmpWorldUp), it2(t71, r57, this._tmpRotCurPoint);
    let h32 = (this._lastPoint[1] - this._tmpRotCurPoint[1]) * this._rotScale, m45 = (this._tmpRotCurPoint[0] - this._lastPoint[0]) * this._rotScale;
    e11(this._tmpViewDir, o60, e71);
    const c44 = s8(this._tmpViewDir), f46 = m3(P3(this._tmpViewDir, this._tmpWorldUp) / c44);
    if (this.pivot === V13.EYE) {
      h32 *= -0.5;
      const t72 = 0.5 * Math.PI - f46, i49 = 0.5 * Math.PI * 0.99;
      h32 = t72 - Math.max(-i49, Math.min(i49, t72 + h32));
    }
    return h32 = e12(h32 + f46, d18.min, d18.max) - f46, _2(this._tmpAxis, t71.up, this._tmpViewDir), this.pivot === V13.CENTER && (m45 = -m45), p8(this._tmpTransf, m45, this._tmpWorldUp), b3(this._tmpTransf, this._tmpTransf, h32, this._tmpAxis), O2(this._tmpViewDir, this._tmpViewDir, this._tmpTransf), t71.up = O2(S16, t71.up, this._tmpTransf), u5(S16, e71, this._tmpViewDir), r13(this._lastPoint, this._tmpRotCurPoint), S16;
  }
};
e6([y2()], H13.prototype, "pivot", void 0), H13 = e6([a4("esri.views.3d.state.controllers.RotateController")], H13);
var S16 = n7();
var k12 = n7();

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/DragRotate.js
var a34 = class extends t22 {
  constructor(t71, r57, e71, o60) {
    super(true), this._view = t71, this.pointerAction = r57, this._pivot = e71, this.registerIncoming("drag", o60, (t72) => this._handleDrag(t72));
  }
  _handleDrag(e71) {
    const a59 = e71.data;
    if (a59.pointers.size > 1) return;
    if (!r25(e71.data, this.pointerAction)) return;
    const i49 = i4(a59.center.x, a59.center.y);
    switch (a59.action) {
      case "start":
        this._cameraController && (this._cameraController.end(), this._cameraController = null), this._cameraController = new H13({
          view: this._view,
          pivot: this._pivot
        }), this._view.state.switchCameraController(this._cameraController), this._cameraController.begin(i49);
        break;
      case "update":
        this._cameraController && this._cameraController.update(i49);
        break;
      case "end":
        this._cameraController && (this._cameraController.end(), this._cameraController = null);
    }
    e71.stopPropagation();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/ZoomControllerGlobal.js
var B10 = class extends n40 {
  constructor() {
    super(...arguments), this._pickPoint = n7(), this._tmpP0 = n13(), this._panAxisAngle = s45(), this._tmpRayDir = n7(), this._tmpRayDirPick = n7(), this._targetOnSphere = n7(), this._navMode = yt.Horizontal, this._tmpRay = {
      origin: n7(),
      direction: n7()
    }, this.dragBeginPoint = i4(), this._normalizedAnchorPoint = n13(), this._constraintOptions = new r40(L12.ALL_EXCEPT_COLLISION, O17.ZOOM, 0, this.startCamera), this._sphere = _5(), this._hasPickPoint = false;
  }
  get _intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t71) {
    if (!this.active) return;
    r13(this.dragBeginPoint, t71), it2(this.startCamera, t71, this._normalizedAnchorPoint);
    const r57 = s6(this.view.spatialReference), e71 = jt(this._intersectionHelper, this.startCamera, t71, r57, N10.Ellipsoid, 0 === this.view.map.ground.opacity ? at2 : {});
    if (this._navMode = vt(this.startCamera, t71, this.view.renderCoordsHelper, this.view.viewingMode), this._navMode === yt.Horizontal) this._hasPickPoint = !!e71.scenePickPoint, this._pickPoint = e71.scenePickPoint ?? this._pickPoint, this._sphere = e71.sphere;
    else {
      let r58;
      p17(this.startCamera, t71, this._tmpRay), z(this._tmpRay.direction, this._tmpRay.direction), null != e71.scenePickPoint && (e11(this._tmpRayDirPick, this.startCamera.eye, e71.scenePickPoint), r58 = s8(this._tmpRayDirPick));
      const s67 = Math.abs(this.view.camera.position.z);
      this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye, T11);
      let a59 = e12(Math.min(Q9, 1 / Math.abs(P3(T11, this._tmpRay.direction))) * s67, X7[0], X7[1]);
      const n63 = this.view._stage.renderView.getMinimalDepthForArea(null, t71[0], t71[1], this.view.state.camera, Y6);
      a59 = null != n63 ? n63 : a59, a59 = null != r58 ? Math.min(a59, r58) : a59, this._hasPickPoint = true, g3(this._tmpRay.direction, this._tmpRay.direction, a59), u5(this._pickPoint, this._tmpRay.origin, this._tmpRay.direction);
    }
  }
  update(t71) {
    if (this.active) {
      if (this.currentCamera.eye = this.startCamera.eye, this.currentCamera.center = this.startCamera.center, this.currentCamera.up = this.startCamera.up, this._navMode === yt.Horizontal) {
        e11(this._tmpRayDir, this.currentCamera.center, this.currentCamera.eye);
        const i49 = s8(this._tmpRayDir);
        it2(this.currentCamera, t71, this._tmpP0);
        const r57 = 12 * (this._normalizedAnchorPoint[1] - this._tmpP0[1]);
        let e71 = i49 * 2 ** r57;
        const s67 = this.view.state.constraints.minimumPoiDistance;
        if (r57 < 0 && e71 < s67 && (e71 = s67), Math.abs(i49 - e71) < 1e-6) return;
        if (this._hasPickPoint && e71 < i49) {
          const t72 = 1 - (1 - e71 / i49) * (1 - this._sphere[3] / s8(this.currentCamera.center));
          this.currentCamera.center = g3(E25, this.currentCamera.center, t72);
        }
        g3(this._tmpRayDir, this._tmpRayDir, -e71 / i49), this.currentCamera.eye = u5(E25, this.currentCamera.center, this._tmpRayDir), this._constraintOptions.interactionFactor = y14(m10(this.dragBeginPoint, t71)), E23(this.view, this.currentCamera, this._constraintOptions), this._hasPickPoint && (wt(this._sphere, this.currentCamera, this.dragBeginPoint, this._targetOnSphere), l28(this._pickPoint, this._targetOnSphere, this._panAxisAngle), ct(this.currentCamera, V2(this._sphere), this._panAxisAngle));
      } else {
        const i49 = s8(this._tmpRay.direction);
        it2(this.currentCamera, t71, this._tmpP0);
        const r57 = 12 * (this._normalizedAnchorPoint[1] - this._tmpP0[1]);
        let e71 = i49 * 2 ** r57;
        const s67 = this.view.state.constraints.minimumPoiDistance;
        if (r57 < 0 && e71 < s67 && (e71 = s67), Math.abs(i49 - e71) < 1e-6) return;
        g3(this._tmpRayDir, this._tmpRay.direction, 1 - e71 / i49), this.currentCamera.eye = u5(E25, this.currentCamera.eye, this._tmpRayDir), this.currentCamera.center = u5(E25, this.currentCamera.center, this._tmpRayDir);
      }
      s43(this.view, this.currentCamera), this.commitCamera();
    }
  }
  end() {
    this.active && this.finishController();
  }
};
B10 = e6([a4("esri.views.3d.state.controllers.ZoomControllerGlobal")], B10);
var E25 = n7();
var T11 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/ZoomControllerLocal.js
var z12 = class extends n40 {
  constructor() {
    super(...arguments), this._tmpP = n7(), this._tmpDir = n7(), this._tmpN = n7(), this._tmpP0 = n13(), this._tmpPoi = n7(), this._tmpRayDir = n7(), this.dragBeginPoint = i4(), this._normalizedAnchorPoint = n13(), this._constraintOptions = new r40(L12.ALL, O17.ZOOM, 0, this.startCamera, n7()), this._plane = E6();
  }
  get _intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t71) {
    if (!this.active) return;
    r13(this.dragBeginPoint, t71), it2(this.startCamera, t71, this._normalizedAnchorPoint);
    const s67 = this._intersectionHelper.intersectScreenFreePointFallback(t71, this._tmpP, 0 === this.view.map.ground.opacity ? at2 : {});
    e11(this._tmpDir, this._tmpP, this.startCamera.eye);
    const r57 = s8(this._tmpDir);
    z(this._tmpDir, this._tmpDir);
    const a59 = Math.abs(this.view.camera.position.z);
    let o60 = e12(Math.min(Q9, 1 / Math.abs(P3(k13, this._tmpDir))) * a59, X7[0], X7[1]);
    const C25 = this.view._stage.renderView.getMinimalDepthForArea(o33(this.view), t71[0], t71[1], this.view.state.camera, Y6);
    o60 = null != C25 ? C25 : o60, o60 = s67 ? Math.min(o60, r57) : o60, g3(this._tmpDir, this._tmpDir, o60), u5(this._tmpP, this.startCamera.eye, this._tmpDir), e11(this._tmpN, this.startCamera.eye, this.startCamera.center), z(this._tmpN, this._tmpN), this._tmpN[1] < 0 && j2(this._tmpN, this._tmpN), j5(this._tmpP, this._tmpN, this._plane);
  }
  update(t71) {
    if (!this.active) return;
    lt3(this._plane, this.currentCamera, this.dragBeginPoint, this._tmpPoi) || r5(this._tmpPoi, this.currentCamera.center), it2(this.currentCamera, t71, this._tmpP0);
    let i49 = 4 * (this._tmpP0[1] - this._normalizedAnchorPoint[1]);
    r13(this._normalizedAnchorPoint, this._tmpP0), e11(this._tmpRayDir, this._tmpPoi, this.currentCamera.eye);
    const s67 = s8(this._tmpRayDir);
    let r57 = s67 * (1 - i49);
    this._constraintOptions.interactionDirection && (r5(this._constraintOptions.interactionDirection, this._tmpRayDir), g3(this._constraintOptions.interactionDirection, this._constraintOptions.interactionDirection, Math.sign(i49) / s67));
    const o60 = this.view.state.constraints.minimumPoiDistance;
    i49 >= 0 && r57 < o60 && (r57 = o60, i49 = -(r57 - s67) / s67), Math.abs(s67 - r57) < 1e-6 || (g3(this._tmpRayDir, this._tmpRayDir, i49), this.currentCamera.eye = u5(L15, this.currentCamera.eye, this._tmpRayDir), A4(L15, this.currentCamera.center, this._tmpPoi, i49), this._tmpPoi[2] > this.startCamera.center[2] ? L15[2] = Math.max(this.startCamera.center[2], L15[2]) : L15[2] = Math.min(this.startCamera.center[2], L15[2]), this.currentCamera.center = L15, this._constraintOptions.interactionFactor = y14(m10(this.dragBeginPoint, t71)), E23(this.view, this.currentCamera, this._constraintOptions), this.commitCamera());
  }
  end() {
    this.active && this.finishController();
  }
};
z12 = e6([a4("esri.views.3d.state.controllers.ZoomControllerLocal")], z12);
var L15 = n7();
var k13 = r4(0, 0, 1);

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/DragZoom.js
var s48 = class extends t22 {
  constructor(r57, t71, e71) {
    super(true), this._view = r57, this.pointerAction = t71, this.registerIncoming("drag", e71, (r58) => this._handleDrag(r58));
  }
  _handleDrag(o60) {
    const s67 = o60.data;
    if (s67.pointers.size > 1) return;
    if (!r25(o60.data, this.pointerAction)) return;
    const i49 = i4(s67.center.x, s67.center.y);
    switch (s67.action) {
      case "start":
        this._cameraController && (this._cameraController.end(), this._cameraController = null), this._view.state.isGlobal ? this._cameraController = new B10({
          view: this._view
        }) : this._cameraController = new z12({
          view: this._view
        }), this._view.state.switchCameraController(this._cameraController), this._cameraController.begin(i49);
        break;
      case "update":
        this._cameraController && this._cameraController.update(i49);
        break;
      case "end":
        this._cameraController && (this._cameraController.end(), this._cameraController = null);
    }
    o60.stopPropagation();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/GamepadKeyboardController.js
var J7 = class extends n40 {
  constructor(t71) {
    super(t71), this._filteredSurfaceElevation = 0, this._transformation = {
      translation: [0, 0, 0],
      heading: 0,
      tilt: 0,
      zoom: 0
    }, this._keysButtonState = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], this._tmpCamera = new it(), this._headingStart = 0, this._constraintOptions = new r40(L12.ALL, O17.NONE, 0, new it(), null, O18.LOOK_AROUND);
  }
  handleEventGamepad(t71) {
    const e71 = i14(t71, this.view.navigation.gamepad, this._transformation);
    ("end" === t71.action || s26(e71)) && this.finishController();
  }
  activateDirection(t71) {
    this._keysButtonState[t71] = 1, o24(this._keysButtonState, this._transformation);
  }
  deactivateDirection(t71) {
    this._keysButtonState[t71] = 0;
    const e71 = o24(this._keysButtonState, this._transformation);
    s26(e71) && this.finishController();
  }
  onControllerStart(t71) {
    this._filteredSurfaceElevation = this.view.pointsOfInterest.cameraOnSurface.location.z, this._headingStart = this.view.camera.heading, super.onControllerStart(t71);
  }
  _updateFilteredSurfaceElevation(t71) {
    const e71 = this.view.pointsOfInterest.cameraOnSurface.location.z, i49 = 1;
    this._filteredSurfaceElevation += i49 * (e71 - this._filteredSurfaceElevation) * t71;
  }
  stepController(t71, e71) {
    this._updateStartHeading(), this._updateFilteredSurfaceElevation(t71), this.currentCamera.copyViewFrom(e71), this._updateCameraCenter(), this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera), this._calculateControlTransformation(t71, this.currentCamera, at3), this._applyDisabledMovementTypes(at3), this._applyPan(at3.pan), this._applyRotate(at3.rotate), this._applyZoom(at3.zoom), this._applyAscend(at3.ascend), this._constraintOptions.interactionType = O17.NONE, this._constraintOptions.selection = L12.COLLISION, E23(this.view, this.currentCamera, this._constraintOptions), super.stepController(t71, e71);
  }
  _updateStartHeading() {
    0 !== this._transformation.heading && (this._headingStart = this.view.camera.heading);
  }
  _applyRotate(t71) {
    if (!t71.enabled) return;
    const e71 = this.currentCamera;
    e11(rt2, e71.center, e71.eye), O2(rt2, rt2, t71.matrix), e71.center = u5(rt2, rt2, e71.eye), e71.up = O2(rt2, e71.up, t71.matrix), this._constraintOptions.interactionType = O17.LOOK_AROUND, this._constraintOptions.selection = L12.ALL_EXCEPT_COLLISION, E23(this.view, e71, this._constraintOptions);
  }
  _applyPan(t71, e71 = this.currentCamera) {
    if (!t71.enabled) return;
    e71.eye = O2(rt2, e71.eye, t71.matrix), e71.center = O2(rt2, e71.center, t71.matrix);
    this.view.state.isGlobal && (e71.up = O2(rt2, e71.up, t71.matrix)), this._constraintOptions.interactionType = O17.PAN, this._constraintOptions.selection = L12.ALL, E23(this.view, e71, this._constraintOptions);
  }
  _applyZoom(t71) {
    if (!t71) return;
    const e71 = this.currentCamera.viewForward;
    this.currentCamera.eye = u5(rt2, this.currentCamera.eye, g3(c6.get(), e71, t71)), r5(ot2, e71), j2(ot2, ot2), this._constraintOptions.interactionDirection = ot2, this._constraintOptions.interactionType = O17.ZOOM, this._constraintOptions.selection = L12.ALL_EXCEPT_COLLISION, E23(this.view, this.currentCamera, this._constraintOptions), this._constraintOptions.interactionDirection = null;
  }
  _applyAscend(t71) {
    if (!t71) return;
    const e71 = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, c6.get());
    this._constraintOptions.interactionDirection = r5(ot2, e71);
    if (this.view.state.isGlobal) {
      const e72 = s8(this.currentCamera.eye), i49 = (e72 + t71) / e72;
      this.currentCamera.eye = g3(rt2, this.currentCamera.eye, i49), this.currentCamera.center = g3(rt2, this.currentCamera.center, i49);
    } else {
      const i49 = g3(c6.get(), e71, t71);
      this.currentCamera.eye = u5(rt2, this.currentCamera.eye, i49), this.currentCamera.center = u5(rt2, this.currentCamera.center, i49);
    }
    this._updateCameraCenter(), this._constraintOptions.interactionType = O17.ASCEND, this._constraintOptions.selection = L12.COLLISION, E23(this.view, this.currentCamera, this._constraintOptions) && this._updateCameraCenter(), this._constraintOptions.selection = L12.ALL_EXCEPT_COLLISION, E23(this.view, this.currentCamera, this._constraintOptions), this._constraintOptions.interactionDirection = null;
  }
  _calculateControlTransformation(t71, e71, i49) {
    nt2(i49);
    const a59 = this._computeVelocities(t71);
    this.view.state.isLocal ? this._calculateControlTransformationLocal(a59, e71, i49) : this._calculateControlTransformationGlobal(a59, e71, i49);
  }
  _updateCameraCenter() {
    const t71 = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, e71 = this.view.renderCoordsHelper, i49 = this.currentCamera.ray;
    this.currentCamera.center = e71.intersectManifoldClosestSilhouette(i49, t71, rt2);
  }
  _calculateControlTransformationLocal(t71, a59, r57) {
    const {
      viewRight: o60,
      viewForward: s67
    } = a59, m45 = this._transformation, l47 = this.view.navigation.gamepad, p49 = o4(c6.get(), s67[0], s67[1], 0);
    z(p49, p49);
    const h32 = m45.translation[0] * t71.pan;
    if (0 !== h32) {
      const t72 = g3(c6.get(), o60, h32);
      i5(r57.pan.matrix, r57.pan.matrix, t72), r57.pan.enabled = true;
    }
    switch (l47.mode) {
      case "pan": {
        const e71 = -m45.translation[1] * t71.pan;
        if (0 !== e71) {
          const t72 = g3(c6.get(), p49, e71);
          i5(r57.pan.matrix, r57.pan.matrix, t72), r57.pan.enabled = true;
        }
        r57.zoom = m45.zoom * t71.zoom;
        break;
      }
      case "zoom":
        r57.zoom = (-m45.translation[1] + m45.zoom) * t71.zoom;
        break;
      default:
        n10(l47.mode);
    }
    const d38 = m45.translation[2] * t71.ascend;
    r57.ascend = d38;
    const _30 = -m45.heading * t71.rotate;
    0 !== _30 && (b3(r57.rotate.matrix, r57.rotate.matrix, _30, this.view.renderCoordsHelper.worldUpAtPosition(a59.eye, c6.get())), r57.rotate.enabled = true);
    const f46 = m45.tilt * t71.rotate, v28 = c30(this.view.renderCoordsHelper, a59.center, a59.eye), y27 = e12(v28 + f46, d18.min, d18.max) - v28;
    y27 && (b3(r57.rotate.matrix, r57.rotate.matrix, y27, o60), r57.rotate.enabled = true);
  }
  _calculateControlTransformationGlobal(t71, e71, i49) {
    const {
      eye: a59,
      viewRight: r57
    } = e71, o60 = this._transformation, s67 = this.view.navigation.gamepad, n63 = _2(c6.get(), r57, a59);
    z(n63, n63), j2(n63, n63), Bt(this.startCamera, e71, o60, t71, this.view.camera.heading, this._headingStart, this.view.camera.tilt, i49, s67), this._tmpCamera.copyFrom(this.currentCamera), this._applyPan(at3.pan, this._tmpCamera);
    const m45 = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, l47 = o60.translation[2] * t71.ascend;
    i49.ascend = l47;
    const p49 = -o60.heading * t71.rotate;
    0 !== p49 && (b3(i49.rotate.matrix, i49.rotate.matrix, p49, this._tmpCamera.eye), i49.rotate.enabled = true);
    const h32 = o60.tilt * t71.rotate, d38 = this._clampTiltDeltaGlobalToValidRange(h32, e71.ray, m45);
    0 !== d38 && (b3(i49.rotate.matrix, i49.rotate.matrix, d38, this._tmpCamera.viewRight), i49.rotate.enabled = true), i49.zoom += o60.zoom * t71.zoom;
  }
  _clampTiltDeltaGlobalToValidRange(t71, e71, a59) {
    const r57 = s6(this.view.spatialReference), o60 = Mt(d18.min, e71.origin, a59, r57);
    let s67 = 0, n63 = 0;
    const c44 = c6.get();
    if (this.view.renderCoordsHelper.intersectManifold(e71, a59, c44)) {
      const t72 = c30(this.view.renderCoordsHelper, c44, e71.origin);
      s67 = Mt(t72, e71.origin, a59, r57), n63 = Mt(d18.max, e71.origin, a59, r57);
    } else {
      J3(L3(at, a59 + r57.radius), e71, c44);
      const t72 = Math.PI + f8(e71.direction, c44);
      s67 = gt(t72, e71.origin, a59, r57), n63 = gt(d18.max, e71.origin, a59, r57);
    }
    return e12(s67 + t71, o60, n63) - s67;
  }
  _getPointAbsoluteSurfaceElevation(t71, e71, i49) {
    const {
      renderCoordsHelper: a59
    } = this.view, r57 = a59.getAltitude(t71), o60 = e71 + Math.abs(r57 - e71);
    return a59.setAltitude(i49, o60, t71), o60;
  }
  _clampedDistanceToSurface(t71, e71) {
    const {
      renderCoordsHelper: i49
    } = this.view, {
      camera: a59
    } = this.view.state, {
      direction: r57
    } = N5(this.view, e71, 0, W5, st2), o60 = i49.intersectManifoldClosestSilhouette(l8(e71, r57), t71, c6.get()), s67 = x(e71, o60), n63 = i49.intersectManifoldClosestSilhouette(l8(e71, J(c6.get(), e71, a59.center)), t71, c6.get()), c44 = x(e71, n63);
    return Math.min(s67, c44);
  }
  _computeHeadingRotateRadius(t71) {
    const {
      renderCoordsHelper: e71,
      state: i49
    } = this.view, {
      camera: r57,
      isGlobal: o60
    } = i49, s67 = e71.intersectManifoldClosestSilhouette(r57.ray, this._filteredSurfaceElevation, c6.get());
    if (o60) {
      const e72 = e11(c6.get(), t71, s67), i50 = s8(e72);
      g3(e72, e72, 1 / i50);
      const r58 = z(c6.get(), t71), o61 = m3(P3(r58, e72));
      return i50 * Math.sin(Math.min(Y8, o61));
    }
    {
      const i50 = r5(c6.get(), t71);
      return e71.setAltitude(i50, this._filteredSurfaceElevation), x(s67, i50);
    }
  }
  _minimumAscendVelocity() {
    return this.view.state.constraints.collision.enabled ? 0 : tt2;
  }
  _computeVelocities(t71) {
    const e71 = this._filteredSurfaceElevation, a59 = e71 + s6(this.view.spatialReference).radius, {
      camera: r57,
      isGlobal: o60
    } = this.view.state, s67 = c6.get(), n63 = this._getPointAbsoluteSurfaceElevation(r57.eye, e71, s67), c44 = this._clampedDistanceToSurface(e71, s67), m45 = r57.width / 2, l47 = $6 * r57.width, p49 = $6 * r57.width, h32 = c44 * Math.tan(0.5 * r57.fovX) / m45, d38 = h32 / a59, u46 = h32 / this._computeHeadingRotateRadius(s67), _30 = n63 - e71;
    return {
      pan: (o60 ? d38 : h32) * l47 * t71,
      ascend: Math.max(this._minimumAscendVelocity() * t71, 2 ** (l47 * t71 / m45) * _30 - _30),
      zoom: 2 ** (l47 * t71 / m45) * c44 - c44,
      rotate: e12(u46 * p49, et2, it3) * t71
    };
  }
  _applyDisabledMovementTypes(t71) {
    null == this.disableMovements || void 0 !== this.disableMovements.mode && this.view.state.viewingMode !== this.disableMovements.mode || (t71.zoom = this.disableMovements.zoom ? 0 : t71.zoom, t71.ascend = this.disableMovements.ascend ? 0 : t71.ascend, t71.pan.enabled = !this.disableMovements.pan, this.disableMovements.pan && o6(t71.pan.matrix), t71.rotate.enabled = !this.disableMovements.rotate, this.disableMovements.rotate && o6(t71.rotate.matrix));
  }
  static activatesFor(t71, e71) {
    const i49 = i14(e71, t71.navigation.gamepad, Q11);
    return !("end" === e71.action || s26(i49));
  }
};
e6([y2({
  constructOnly: true
})], J7.prototype, "gamepadDevice", void 0), e6([y2({
  constructOnly: true
})], J7.prototype, "disableMovements", void 0), J7 = e6([a4("esri.views.3d.state.controllers.GamepadKeyboardController")], J7);
var Q11 = {
  translation: [0, 0, 0],
  heading: 0,
  tilt: 0,
  zoom: 0
};
var W5 = 80;
var Y8 = h3(W5);
var $6 = 0.75;
var tt2 = 5;
var et2 = h3(30);
var it3 = h3(80);
var at3 = {
  zoom: 0,
  ascend: 0,
  pan: {
    enabled: false,
    matrix: e15()
  },
  rotate: {
    enabled: false,
    matrix: e15()
  }
};
var rt2 = n7();
var ot2 = n7();
var st2 = u12();
function nt2(t71) {
  t71.zoom = 0, t71.ascend = 0, t71.pan.enabled = false, o6(t71.pan.matrix), t71.rotate.enabled = false, o6(t71.rotate.matrix);
}

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/GamepadNavigation.js
var n41 = class extends t22 {
  constructor(e71) {
    super(true), this._view = e71, this._watchHandles = new r(), this._handle = this.registerIncoming("gamepad", (a59) => this._handleEventGamepad(a59)), this._handle.pause();
  }
  onInstall(a59) {
    super.onInstall(a59), this._watchHandles.add([d2(() => this._view.navigation.gamepad.enabled, (a60) => {
      a60 ? this._handle.resume() : (this._handle.pause(), this._cameraControllerGamepad && (this._cameraControllerGamepad.finishController(), this._cameraControllerGamepad = null));
    }, P), d2(() => this._view.navigation.gamepad.device, (a60) => {
      this._cameraControllerGamepad && a60 && this._cameraControllerGamepad.gamepadDevice !== a60 && (this._cameraControllerGamepad.finishController(), this._cameraControllerGamepad = null);
    })]);
  }
  onUninstall() {
    this._watchHandles.removeAll(), super.onUninstall();
  }
  _handleEventGamepad(a59) {
    const e71 = this._view.navigation.gamepad.device;
    if (e71 && a59.data.device !== e71) return;
    const t71 = this._cameraControllerGamepad?.active;
    if (t71 || J7.activatesFor(this._view, a59.data)) {
      if (!t71) {
        const e72 = new J7({
          view: this._view,
          gamepadDevice: a59.data.device
        });
        this._view.state.switchCameraController(e72) && (this._cameraControllerGamepad = e72);
      }
      this._cameraControllerGamepad && this._cameraControllerGamepad.active && this._cameraControllerGamepad.gamepadDevice === a59.data.device && this._cameraControllerGamepad.handleEventGamepad(a59.data);
    }
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/KeyboardNavigation.js
var r42;
!function(e71) {
  e71[e71.LEFT = 0] = "LEFT", e71[e71.RIGHT = 1] = "RIGHT", e71[e71.FORWARD = 2] = "FORWARD", e71[e71.BACKWARD = 3] = "BACKWARD", e71[e71.UP = 4] = "UP", e71[e71.DOWN = 5] = "DOWN", e71[e71.HEADINGLEFT = 6] = "HEADINGLEFT", e71[e71.HEADINGRIGHT = 7] = "HEADINGRIGHT", e71[e71.TILTUP = 8] = "TILTUP", e71[e71.TILTDOWN = 9] = "TILTDOWN", e71[e71.ZOOMIN = 10] = "ZOOMIN", e71[e71.ZOOMOUT = 11] = "ZOOMOUT";
}(r42 || (r42 = {}));
var i32 = class extends t22 {
  constructor(t71, a59) {
    super(true), this._view = t71, this._disableMovements = {
      pan: true,
      zoom: false,
      ascend: true,
      rotate: false,
      mode: l9.Local
    }, this._keyToNumber = {
      [a59.left]: r42.LEFT,
      [a59.right]: r42.RIGHT,
      [a59.forward]: r42.FORWARD,
      [a59.backward]: r42.BACKWARD,
      [a59.up]: r42.UP,
      [a59.down]: r42.DOWN,
      [a59.headingLeft]: r42.HEADINGLEFT,
      [a59.headingRight]: r42.HEADINGRIGHT,
      [a59.tiltUp]: r42.TILTUP,
      [a59.tiltDown]: r42.TILTDOWN,
      [a59.zoomIn]: r42.ZOOMIN,
      [a59.zoomOut]: r42.ZOOMOUT
    }, this.registerIncoming("key-down", null, (e71) => this._handleKeyDown(e71)), this.registerIncoming("key-up", null, (e71) => this._handleKeyUp(e71)), this.registerIncoming("blur", null, () => this._handleStop()), this._visibilityHandle = i15((e71) => e71 ? null : this._handleStop());
  }
  onUninstall() {
    this._visibilityHandle?.remove(), this._handleStop();
  }
  _handleKeyDown(e71) {
    if (e71.data.native.ctrlKey || e71.data.native.metaKey) return;
    const a59 = this._keyToNumber[e71.data.key];
    null != a59 && (this._cameraControllerKeyboard && this._cameraControllerKeyboard.active || (this._cameraControllerKeyboard = new J7({
      view: this._view,
      disableMovements: this._disableMovements
    }), this._view.state.switchCameraController(this._cameraControllerKeyboard)), this._cameraControllerKeyboard.active && (this._cameraControllerKeyboard.activateDirection(a59), e71.stopPropagation()));
  }
  _handleStop() {
    this._cameraControllerKeyboard?.active && (this._cameraControllerKeyboard.finishController(), this._cameraControllerKeyboard = null);
  }
  _handleKeyUp(e71) {
    if (e71.data.native.ctrlKey || e71.data.native.metaKey) return;
    const t71 = this._keyToNumber[e71.data.key];
    null != t71 && this._cameraControllerKeyboard?.active && (this._cameraControllerKeyboard.deactivateDirection(t71), e71.stopPropagation());
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/MouseWheelZoom.js
var i33 = class extends t22 {
  constructor(e71, t71) {
    super(true), this._view = e71, this.registerIncoming("mouse-wheel", t71, (e72) => this._handleMouseWheel(e72));
  }
  _handleMouseWheel(r57) {
    if (!this._view.navigation.mouseWheelZoomEnabled) return;
    const i49 = r57.data;
    this._cameraController && this._cameraController.active || (this._cameraController = this._view.state.isGlobal ? new A21({
      view: this._view,
      mode: "interaction"
    }) : new U13({
      view: this._view,
      mode: "interaction"
    }), this._view.state.switchCameraController(this._cameraController)), this._cameraController.zoomStep(-1 / 60 * i49.deltaY, i4(i49.x, i49.y)), r57.preventDefault(), r57.stopPropagation();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/util.js
var t48 = class {
  constructor(t71) {
    this._gain = t71;
  }
  reset(t71) {
    this._value = t71;
  }
  set gain(t71) {
    this._gain = t71;
  }
  get value() {
    return void 0 === this._value ? 0 : this._value;
  }
  update(t71) {
    void 0 === this._value ? this._value = t71 : this._value = this._gain * t71 + (1 - this._gain) * this._value;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/MomentumController.js
var p29 = class extends a33 {
  constructor() {
    super(...arguments), this._beginCamera = new it(), this._elapsedTimeSec = 0, this.constraintOptions = new r40(L12.ALL, O17.PAN, 0, this._beginCamera);
  }
  initialize() {
    this.constraintOptions.interactionType = this.interactionType, this.viewAnimation = new a17();
  }
  get steppingFinished() {
    return this.momentum.isFinished(this._elapsedTimeSec);
  }
  onControllerStart(t71) {
    this._beginCamera.copyFrom(t71), super.onControllerStart(t71);
  }
  stepController(t71, e71) {
    e71.copyViewFrom(this._beginCamera), this._elapsedTimeSec += t71, this.momentumStep(this._elapsedTimeSec, e71), E23(this.view, e71, this.constraintOptions);
  }
};
p29 = e6([a4("esri.views.3d.state.controllers.momentum.MomentumController")], p29);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/PanPlanarMomentumController.js
var c33 = class extends p29 {
  constructor(t71) {
    super(t71), this.interactionType = O17.PAN, this._tmpPan = n7();
  }
  momentumStep(t71, o60) {
    const r57 = this.momentum.value(t71);
    g3(this._tmpPan, this.momentum.direction, r57), o60.eye = e11(a35, o60.eye, this._tmpPan), o60.center = e11(a35, o60.center, this._tmpPan), this.constraintOptions.interactionDirection = this._tmpPan;
  }
};
e6([y2({
  constructOnly: true
})], c33.prototype, "momentum", void 0), c33 = e6([a4("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")], c33);
var a35 = n7();

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/PanSphericalMomentumController.js
var p30 = n7();
var u29 = n7();
var l30 = class extends p29 {
  constructor(o60) {
    super(o60), this.interactionType = O17.PAN;
  }
  momentumStep(o60, t71) {
    const s67 = this.momentum.value1(o60), i49 = this.momentum.value2(o60);
    r5(u29, t71.eye), z(u29, u29), _2(this.momentum.axis2, u29, this.momentum.axis1), qt(t71, p30, this.momentum.axis1, s67, this.momentum.axis2, i49);
  }
};
e6([y2({
  constructOnly: true
})], l30.prototype, "momentum", void 0), l30 = e6([a4("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")], l30);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/RotationMomentumController.js
var c34 = class extends p29 {
  set center(t71) {
    this._set("center", t4(t71));
  }
  set axis(t71) {
    this._set("axis", t4(t71));
  }
  constructor(t71) {
    super(t71), this.interactionType = O17.TUMBLE;
  }
  momentumStep(t71, o60) {
    const r57 = this.momentum.value(t71);
    ct(o60, this.center, m28(this.axis, r57));
  }
};
e6([y2({
  constructOnly: true
})], c34.prototype, "momentum", void 0), e6([y2({
  constructOnly: true
})], c34.prototype, "center", null), e6([y2({
  constructOnly: true
})], c34.prototype, "axis", null), c34 = e6([a4("esri.views.3d.state.controllers.momentum.RotationMomentumController")], c34);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/ZoomPlanarMomentumController.js
var p31 = class extends p29 {
  set zoomCenter(t71) {
    this._set("zoomCenter", t4(t71));
  }
  constructor(t71) {
    super(t71), this.interactionType = O17.ZOOM, this.constraintOptions.interactionDirection = n7();
  }
  momentumStep(t71, o60) {
    const {
      interactionDirection: r57
    } = this.constraintOptions;
    if (!r57) return;
    r5(r57, o60.eye);
    const i49 = this.momentum.valueDelta(0, t71);
    ut(o60, this.zoomCenter, i49, this.view.state.constraints.minimumPoiDistance), J(r57, o60.eye, r57);
  }
};
e6([y2({
  constructOnly: true
})], p31.prototype, "momentum", void 0), e6([y2({
  constructOnly: true
})], p31.prototype, "zoomCenter", null), p31 = e6([a4("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")], p31);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/momentum/ZoomSphericalMomentumController.js
var C13 = class extends p29 {
  set screenCenter(t71) {
    this._set("screenCenter", i4(t71[0], t71[1]));
  }
  set sceneCenter(t71) {
    this._set("sceneCenter", t4(t71));
  }
  constructor(t71) {
    super(t71), this.interactionType = O17.ZOOM, this.radius = 0, this._tmpSceneCenter = n7(), this._tmpZoomAxisAngle = s45(), this._sphere = _5();
  }
  initialize() {
    this._sphere[3] = this.radius;
  }
  momentumStep(t71, e71) {
    const s67 = this.momentum.valueDelta(0, t71);
    ft(this._sphere, e71, s67), this.constraintOptions.interactionType = O17.ZOOM, E23(this.view, e71, this.constraintOptions), wt(this._sphere, e71, this.screenCenter, this._tmpSceneCenter), l28(this.sceneCenter, this._tmpSceneCenter, this._tmpZoomAxisAngle), ct(e71, V2(this._sphere), this._tmpZoomAxisAngle), this.constraintOptions.interactionType = O17.PAN;
  }
};
e6([y2({
  constructOnly: true
})], C13.prototype, "momentum", void 0), e6([y2({
  constructOnly: true
})], C13.prototype, "screenCenter", null), e6([y2({
  constructOnly: true
})], C13.prototype, "sceneCenter", null), e6([y2({
  constructOnly: true
})], C13.prototype, "radius", void 0), C13 = e6([a4("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")], C13);

// ../../../node_modules/@arcgis/core/views/navigation/FilteredValue.js
var e44 = class {
  constructor(e71) {
    this._gain = e71;
  }
  update(e71) {
    void 0 !== this.filteredValue ? this.filteredValue = (1 - this._gain) * this.filteredValue + this._gain * e71 : this.filteredValue = e71;
  }
  reset() {
    this.filteredValue = void 0;
  }
  get hasFilteredValue() {
    return void 0 !== this.filteredValue;
  }
};

// ../../../node_modules/@arcgis/core/views/navigation/PanSphericalMomentumEstimator.js
var m30 = 1e-5;
var u30 = class extends t25 {
  constructor(t71, e71, i49, s67, a59, l47 = 0, n63) {
    super(t71, e71, i49), this._angularVelocity1 = s67, this.axis1 = a59, this.angularVelocity2 = l47, this.axis2 = n63;
  }
  value1(t71) {
    return super.valueFromInitialVelocity(this._angularVelocity1, t71);
  }
  value2(t71) {
    return super.valueFromInitialVelocity(this.angularVelocity2, t71);
  }
};
var o42 = class {
  constructor(e71 = 300, i49 = 12, s67 = 0.84) {
    this._minimumInitialVelocity = e71, this._stopVelocity = i49, this._friction = s67, this.enabled = true, this._tmpAxis1 = n7(), this._tmpAxis2 = n7(), this._tmpAngles = n13(), this._time = new t24(0.3), this._screen = [new t24(0.4), new t24(0.4)], this._angle1 = new e44(0.6), this._angle2 = new e44(0.6), this._axis1 = n7(), this._axis2 = n7(), this._lastScene = n7();
  }
  addMomentumDirectRotation(t71, a59, n63, r57, h32, _30) {
    if (this.enabled) {
      if (this._time.hasLastValue()) {
        if (this._time.computeDelta(n63) < 0.01) return;
        let t72 = Et(this._lastScene, a59, this._tmpAxis2, r57, h32, _30);
        this._angle2.update(0), v3(this._tmpAxis2) < m30 ? t72 = 0 : z(this._axis1, this._tmpAxis2), this._angle1.update(t72), r5(this._lastScene, a59);
      }
      this._screen[0].update(t71[0]), this._screen[1].update(t71[1]), this._time.update(n63);
    }
  }
  addMomentumPreserveHeading(t71, a59, l47, r57, h32, _30, u46) {
    if (this.enabled) {
      if (this._time.hasLastValue()) {
        if (this._time.computeDelta(l47) < 0.01) return;
        Gt(this._lastScene, a59, this._tmpAxis2, this._tmpAxis1, this._tmpAngles, r57, h32, _30, u46, false), v3(this._tmpAxis2) < m30 ? (this._angle1.update(0), this._angle2.update(0)) : (this._angle1.update(this._tmpAngles[1]), this._angle2.update(this._tmpAngles[0]), z(this._axis1, this._tmpAxis1), z(this._axis2, this._tmpAxis2)), r5(this._lastScene, a59);
      }
      this._screen[0].update(t71[0]), this._screen[1].update(t71[1]), this._time.update(l47);
    }
  }
  reset() {
    this._screen[0].reset(), this._screen[1].reset(), this._angle1.reset(), this._angle2.reset(), this._time.reset();
  }
  evaluateMomentum() {
    if (!this.enabled || !this._screen[0].hasFilteredDelta()) return null;
    const t71 = this._screen[0].filteredDelta, e71 = this._screen[1].filteredDelta, i49 = null == t71 || null == e71 ? null : Math.sqrt(t71 * t71 + e71 * e71), s67 = this._time.filteredDelta, a59 = null == i49 || null == s67 ? 0 : i49 / s67;
    return Math.abs(a59) < this._minimumInitialVelocity ? null : this.createMomentum(a59, this._stopVelocity, this._friction);
  }
  createMomentum(t71, e71, i49) {
    const s67 = this._time.filteredDelta, a59 = this._angle1.filteredValue, l47 = this._angle2.filteredValue, n63 = null == s67 || null == l47 ? 0 : l47 / s67;
    return new u30(t71, e71, i49, null == s67 || null == a59 ? 0 : a59 / s67, this._axis1, n63, this._axis2);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/PinchAndPanControllerGlobal.js
var rt3 = class extends n40 {
  constructor() {
    super(...arguments), this._smoothRotation = new t48(0.05), this._rotationAxis = n7(), this._beginAngle = 0, this._beginHeading = 0, this._panningPlane = E6(), this._beginRadius = 0, this._smoothScaling = new t48(0.05), this._zoomCenterScreen = i4(), this._zoomMomentumEstimator = new s23(), this._rotationMomentumEstimator = new a20(), this._panSphericalMomentumEstimator = new o42(), this._panPlanarMomentumEstimator = new c12(), this._adjustedSphere = _5(), this._tmp3d = n7(), this._tmpScreenPointArray = i4(), this._beginScreenPoint = i4(), this._beginScenePoint = n7(), this._screenPickPoint = i4(), this._scenePickPoint = n7(), this._navMode = yt.Horizontal, this._sphere = _5(), this._pointerCount = 0, this._tmpInteractionDirection = n7(), this._beginCamera = new it(), this._constraintOptions = new r40(L12.ALL, O17.NONE, 0, this._beginCamera);
  }
  get _intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t71) {
    if (!this.active) return;
    this._zoomMomentumEstimator.enabled = this._rotationMomentumEstimator.enabled = this._panPlanarMomentumEstimator.enabled = this._panSphericalMomentumEstimator.enabled = this.view.navigation.momentumEnabled, this._beginHeading = -s19.normalize(h3(this.view.camera.heading)), this._beginRadius = t71.radius, this._pointerCount = t71.pointers.size, this._beginAngle = t71.angle, this._smoothRotation.reset(), d5(t71.center, this._screenPickPoint), r13(this._beginScreenPoint, this._screenPickPoint);
    const n63 = s6(this.view.spatialReference), o60 = jt(this._intersectionHelper, this.startCamera, this._screenPickPoint, n63, N10.Silhouette, 0 === this.view.map.ground.opacity ? at2 : {});
    null != o60.scenePickPoint && (this._scenePickPoint = o60.scenePickPoint, this._sphere = o60.sphere, r5(this._beginScenePoint, this._scenePickPoint), this._navMode = vt(this.startCamera, this._screenPickPoint, this.view.renderCoordsHelper, this.view.viewingMode), this._navMode === yt.Vertical && this._preparePlanarPanMode(t71, o60.hasGeometryIntersection), this._beginCamera.copyFrom(this.startCamera));
  }
  update(t71) {
    if (!this.active) return;
    this.currentCamera.copyFrom(this.startCamera);
    const i49 = t71.pointers.size > 1;
    this._navMode === yt.Horizontal ? (i49 && this._zoomSpherical(t71), this._panningSpherical(t71), i49 && this._rotateSpherical(t71)) : (i49 && this._zoomPlanar(t71), this._panningPlanar(t71), i49 && this._rotatePlanar(t71)), this.commitCamera();
  }
  end(t71) {
    t71.pointers.size === this._pointerCount && this.update(t71), this.finishController();
    const i49 = this._zoomMomentumEstimator.evaluateMomentum();
    if (i49) return this._navMode === yt.Horizontal ? new C13({
      view: this.view,
      momentum: i49,
      screenCenter: this._zoomCenterScreen,
      sceneCenter: this._beginScenePoint,
      radius: this._sphere[3]
    }) : new p31({
      view: this.view,
      momentum: i49,
      zoomCenter: this._beginScenePoint
    });
    const e71 = this._rotationMomentumEstimator.evaluateMomentum();
    if (e71) return new c34({
      view: this.view,
      momentum: e71,
      center: V2(this._sphere),
      axis: this._rotationAxis
    });
    if (this._navMode === yt.Horizontal) {
      const t72 = this._panSphericalMomentumEstimator.evaluateMomentum();
      if (t72) return new l30({
        view: this.view,
        momentum: t72
      });
    } else {
      const t72 = this._panPlanarMomentumEstimator.evaluateMomentum();
      if (t72) return new c33({
        view: this.view,
        momentum: t72
      });
    }
    return null;
  }
  _preparePlanarPanMode(t71, i49) {
    const e71 = j2(this._tmp3d, this.startCamera.viewForward);
    j5(this._scenePickPoint, e71, this._panningPlane);
    const r57 = i4(this._screenPickPoint[0], 0), a59 = n7(), m45 = s8(this.startCamera.eye);
    this._adjustedSphere[3] = m45 < this._sphere[3] ? m45 - 100 : this._sphere[3], wt(this._adjustedSphere, this.startCamera, r57, a59);
    const v28 = x3();
    this.startCamera.projectToRenderScreen(a59, v28);
    const C25 = n7(), M18 = n7(), b25 = n7();
    e11(C25, this._scenePickPoint, this.currentCamera.eye);
    const f46 = s8(C25);
    z(C25, C25);
    const j21 = tt * Math.max(Math.abs(this.view.camera.position.z), et), E37 = this.view._stage.renderView.getMinimalDepthForArea(null, this._screenPickPoint[0], this._screenPickPoint[1], this.view.state.camera, Y6);
    let O34 = null != E37 ? E37 : j21;
    O34 = i49 ? Math.min(O34, f46) : O34, r5(b25, u5(M18, this.currentCamera.eye, g3(M18, C25, O34))), this._panningPlane[3] = -P3(F(this._panningPlane), b25), this.startCamera.center = u5(M18, this.startCamera.eye, g3(M18, this.startCamera.viewForward, O34));
    const y27 = d5(t71.center, this._tmpScreenPointArray);
    mt(this._panningPlane, this.startCamera, y27, this._beginScenePoint);
  }
  _zoomSpherical(t71) {
    const i49 = this._beginRadius / t71.radius, e71 = 1875e-6 * Math.min(Math.max(t71.radius, 40), 120);
    this._smoothScaling.gain = e71, this._smoothScaling.update(i49), ft(this._sphere, this.currentCamera, this._smoothScaling.value), d5(t71.center, this._zoomCenterScreen), this._zoomMomentumEstimator.add(this._smoothScaling.value, 1e-3 * t71.timestamp), this._constraintOptions.interactionType = O17.ZOOM, this._constraintOptions.interactionFactor = y14(t71.radius - this._beginRadius), E23(this.view, this.currentCamera, this._constraintOptions);
  }
  _panningSpherical(t71) {
    const i49 = d5(t71.center, this._tmpScreenPointArray);
    wt(this._sphere, this.currentCamera, i49, this._tmp3d), Ct(this._beginScenePoint, P3(this.currentCamera.up, this._beginScenePoint), this._sphere[3], this._beginHeading, this.view.camera.tilt, this.startCamera) ? (Vt(this._sphere, this.currentCamera, this._beginScenePoint, this._tmp3d, this._beginHeading, this.view.camera.tilt, false), this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i49, this._tmp3d, 1e-3 * t71.timestamp, this.startCamera, this._sphere, this._beginHeading, this.view.camera.tilt)) : (Ft(this._sphere, this.currentCamera, this._beginScenePoint, this._tmp3d, this.view.camera.tilt, false), this._panSphericalMomentumEstimator.addMomentumDirectRotation(i49, this._tmp3d, 1e-3 * t71.timestamp, this.startCamera, this._sphere[3], this.view.camera.tilt)), this._constraintOptions.interactionType = O17.PAN, this._constraintOptions.interactionFactor = y14(m10(this._screenPickPoint, i49)), E23(this.view, this.currentCamera, this._constraintOptions);
  }
  _rotateSpherical(t71) {
    z(this._rotationAxis, this._scenePickPoint), this.currentCamera.aboveGround || j2(this._rotationAxis, this._rotationAxis);
    const i49 = this._smoothRotation.value, e71 = i49 + st(t71.angle - i49), n63 = 125e-5 * Math.min(Math.max(t71.radius, 40), 120);
    this._smoothRotation.gain = n63, this._smoothRotation.update(e71);
    const s67 = this._smoothRotation.value - this._beginAngle;
    this._rotationMomentumEstimator.add(s67, 1e-3 * t71.timestamp), ct(this.currentCamera, V2(this._sphere), m28(this._rotationAxis, s67)), this._constraintOptions.interactionType = O17.TUMBLE, this._constraintOptions.interactionFactor = y14(t71.radius * e71), E23(this.view, this.currentCamera, this._constraintOptions);
  }
  _panningPlanar(t71) {
    const i49 = d5(t71.center, this._tmpScreenPointArray);
    mt(this._panningPlane, this.currentCamera, i49, this._tmp3d) && (zt(this.currentCamera, this._beginScenePoint, this._tmp3d), this._panPlanarMomentumEstimator.add(i49, this._tmp3d, 1e-3 * t71.timestamp), this._constraintOptions.interactionType = O17.PAN, this._constraintOptions.interactionFactor = y14(m10(this._beginScreenPoint, i49)), this._constraintOptions.interactionDirection = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, this._tmpInteractionDirection), E23(this.view, this.currentCamera, this._constraintOptions), this._constraintOptions.interactionDirection = null);
  }
  _zoomPlanar(t71) {
    const i49 = this._beginRadius / t71.radius, e71 = 1875e-6 * Math.min(Math.max(t71.radius, 40), 120);
    this._smoothScaling.gain = e71, this._smoothScaling.update(i49), this._zoomMomentumEstimator.add(this._smoothScaling.value, 1e-3 * t71.timestamp), ut(this.currentCamera, this._beginScenePoint, this._smoothScaling.value, this.view.state.constraints.minimumPoiDistance), this._constraintOptions.interactionType = O17.ZOOM, this._constraintOptions.interactionFactor = y14(t71.radius - this._beginRadius), E23(this.view, this.currentCamera, this._constraintOptions);
  }
  _rotatePlanar(t71) {
    r5(this._rotationAxis, this._beginScenePoint), this.currentCamera.aboveGround || j2(this._rotationAxis, this._rotationAxis);
    const i49 = this._smoothRotation.value;
    let e71 = t71.angle - i49;
    e71 = st(e71);
    const n63 = i49 + e71, s67 = 125e-5 * Math.min(Math.max(t71.radius, 40), 120);
    this._smoothRotation.gain = s67, this._smoothRotation.update(n63);
    const o60 = this._smoothRotation.value - this._beginAngle;
    this._rotationMomentumEstimator.add(o60, 1e-3 * t71.timestamp), ct(this.currentCamera, V2(this._sphere), m28(this._rotationAxis, o60)), this._constraintOptions.interactionType = O17.TUMBLE, this._constraintOptions.interactionFactor = y14(t71.radius * o60), E23(this.view, this.currentCamera, this._constraintOptions);
  }
};
rt3 = e6([a4("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")], rt3);

// ../../../node_modules/@arcgis/core/views/3d/state/controllers/PinchAndPanControllerLocal.js
var J8 = r4(0, 0, 1);
var K8 = class extends n40 {
  constructor() {
    super(...arguments), this._rotationValueSmooth = new t48(0.05), this._scalingValueSmooth = new t48(0.05), this._planeHorizontal = E6(), this._planeVertical = E6(), this._rotationMomentumEstimator = new a20(), this._panMomentumEstimator = new c12(300, 12, 0.9), this._zoomMomentumEstimator = new s23(), this._beginRadius = 0, this._beginCenter = n7(), this._beginAngle = 0, this._tmpPoints = [], this._navMode = yt.Horizontal, this._beginCenterScreen = i4(), this._tmpCentroid3d = n7(), this._tmpCentroid2d = i4(), this._tmp2d = i4(), this._pointerCount = 0, this._beginCamera = new it(), this._constraintOptions = new r40(L12.ALL, O17.NONE, 0, this._beginCamera);
  }
  begin(t71) {
    if (!this.active) return;
    const i49 = this.view.navigation.momentumEnabled;
    this._zoomMomentumEstimator.enabled = i49, this._rotationMomentumEstimator.enabled = i49, this._panMomentumEstimator.enabled = i49, this._beginRadius = t71.radius, this._pointerCount = t71.pointers.size, this._beginAngle = t71.angle, this._rotationValueSmooth.reset(), this._scalingValueSmooth.reset(), d5(t71.center, this._beginCenterScreen), _6(J8, 0, this._planeHorizontal);
    const n63 = n7(), s67 = this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen, n63, 0 === this.view.map.ground.opacity ? at2 : {}), u46 = n7();
    j2(u46, this.startCamera.viewForward);
    const d38 = n7();
    r5(d38, J8);
    const C25 = P3(u46, d38);
    this._navMode = vt(this.startCamera, this._beginCenterScreen, this.view.renderCoordsHelper, this.view.viewingMode);
    const w24 = Math.min(tt, 1 / Math.abs(P3(d38, this.startCamera.viewForward))) * Math.max(Math.abs(this.view.camera.position.z), et);
    O5(this._planeHorizontal, this._planeHorizontal, n63), this.startCamera.aboveGround || q3(this._planeHorizontal, this._planeHorizontal);
    const f46 = n7(), j21 = n7(), P19 = n7();
    e11(f46, n63, this.currentCamera.eye);
    const V19 = s8(f46);
    if (z(f46, f46), this._navMode === yt.Vertical) {
      g3(d38, d38, C25), e11(F(this._planeVertical), u46, d38), z(F(this._planeVertical), F(this._planeVertical)), O5(this._planeVertical, this._planeVertical, n63);
      const i50 = this.view._stage.renderView.getMinimalDepthForArea(o33(this.view), this._beginCenterScreen[0], this._beginCenterScreen[1], this.view.state.camera, Y6);
      let e71 = null != i50 ? i50 : w24;
      e71 = s67 ? Math.min(e71, V19) : e71, r5(P19, u5(j21, this.currentCamera.eye, g3(j21, f46, e71))), this._planeVertical[3] = -P3(F(this._planeVertical), P19), this._computePlanePoints(t71.pointers, this._planeVertical, this.startCamera, this._tmpPoints), ht2(this._tmpPoints, this._beginCenter);
    } else {
      const i50 = s67 ? V19 : w24;
      r5(P19, u5(j21, this.currentCamera.eye, g3(j21, f46, i50))), this._planeHorizontal[3] = -P3(F(this._planeHorizontal), P19), this._computePlanePoints(t71.pointers, this._planeHorizontal, this.startCamera, this._tmpPoints), ht2(this._tmpPoints, this._beginCenter);
    }
    this._beginCamera.copyFrom(this.startCamera);
  }
  update(t71) {
    if (!this.active) return;
    this.currentCamera.copyFrom(this.startCamera);
    const i49 = t71.pointers.size > 1, n63 = this._navMode === yt.Horizontal ? this._planeHorizontal : this._planeVertical, o60 = this._beginCenter;
    if (i49) {
      const i50 = this._beginRadius / t71.radius, e71 = 1875e-6 * Math.min(Math.max(t71.radius, 40), 120);
      this._scalingValueSmooth.gain = e71, this._scalingValueSmooth.update(i50), ut(this.currentCamera, o60, this._scalingValueSmooth.value, this.view.state.constraints.minimumPoiDistance), this._zoomMomentumEstimator.add(this._scalingValueSmooth.value, 1e-3 * t71.timestamp), this._constraintOptions.interactionType = O17.ZOOM, this._constraintOptions.interactionFactor = y14(Math.abs(t71.radius - this._beginRadius)), E23(this.view, this.currentCamera, this._constraintOptions);
    }
    if (this._computePlanePoints(t71.pointers, n63, this.currentCamera, this._tmpPoints), ht2(this._tmpPoints, this._tmpCentroid3d), d5(t71.center, this._tmpCentroid2d), zt(this.currentCamera, o60, this._tmpCentroid3d), this._panMomentumEstimator.add(this._tmpCentroid2d, this._tmpCentroid3d, 1e-3 * t71.timestamp), this._constraintOptions.interactionType = O17.PAN, this._constraintOptions.interactionFactor = y14(m10(this._beginCenterScreen, this._tmpCentroid2d)), E23(this.view, this.currentCamera, this._constraintOptions), i49) {
      const i50 = o60, e71 = this._rotationValueSmooth.value, n64 = e71 + st(t71.angle - e71), s67 = 125e-5 * Math.min(Math.max(t71.radius, 40), 120);
      this._rotationValueSmooth.gain = s67, this._rotationValueSmooth.update(n64);
      const r57 = this._rotationValueSmooth.value - this._beginAngle;
      this._rotationMomentumEstimator.add(r57, 1e-3 * t71.timestamp);
      const a59 = F(this._planeHorizontal);
      ct(this.currentCamera, i50, m28(a59, r57)), this._constraintOptions.interactionType = O17.TUMBLE, this._constraintOptions.interactionFactor = y14(Math.abs(t71.radius * r57)), E23(this.view, this.currentCamera, this._constraintOptions);
    }
    this.commitCamera();
  }
  end(t71) {
    t71.pointers.size === this._pointerCount && this.update(t71), this.finishController();
    const i49 = this._zoomMomentumEstimator.evaluateMomentum();
    if (i49) return new p31({
      view: this.view,
      momentum: i49,
      zoomCenter: this._beginCenter
    });
    const e71 = this._rotationMomentumEstimator.evaluateMomentum();
    if (e71) return new c34({
      view: this.view,
      momentum: e71,
      center: this._beginCenter,
      axis: F(this._planeHorizontal)
    });
    const n63 = this._panMomentumEstimator.evaluateMomentum();
    return n63 ? new c33({
      view: this.view,
      momentum: n63
    }) : null;
  }
  _computePlanePoints(t71, i49, e71, n63) {
    n63.length = t71.size;
    const s67 = this._tmp2d;
    let o60 = 0;
    return t71.forEach((t72) => {
      s67[0] = t72.x, s67[1] = t72.y, void 0 === n63[o60] && (n63[o60] = n7()), mt(i49, e71, s67, n63[o60]), o60 += 1;
    }), n63;
  }
  get _intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
};
K8 = e6([a4("esri.views.3d.state.controllers.PinchAndPanControllerLocal")], K8);

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/PinchAndPanNavigation.js
var i34 = class extends t22 {
  constructor(t71, e71, s67) {
    super(true), this._view = t71, this.pointerAction = e71, this._lastEndTimestamp = 0, this._lastTimestamp = 0, this.registerIncoming("drag", s67, (t72) => this._handleDrag(t72));
  }
  _handleDrag(t71) {
    if ("mouse" === t71.data.pointerType && !r25(t71.data, this.pointerAction)) return;
    const e71 = t71.timestamp - this._lastEndTimestamp, s67 = 40, i49 = this._momentum && this._momentum.active && e71 < s67;
    switch (t71.data.action) {
      case "start":
      case "update":
        if (i49) break;
        this._controller && this._controller.active ? t71.data.timestamp - this._lastTimestamp > 2 && (this._controller.update(t71.data), this._lastTimestamp = t71.timestamp) : this._startController(t71);
        break;
      case "end":
      case "removed":
        this._endController(t71, true);
        break;
      case "added":
        this._endController(t71, false), this._startController(t71);
    }
    t71.stopPropagation();
  }
  _endController(t71, e71) {
    if (this._controller?.active) {
      this._lastEndTimestamp = t71.timestamp;
      const s67 = this._controller.end(t71.data);
      e71 && s67 && (this._momentum = s67, this._view.state.switchCameraController(this._momentum));
    }
    this._controller = null;
  }
  _startController(t71) {
    this._controller = this._createController(), this._view.state.switchCameraController(this._controller), this._controller.begin(t71.data), this._lastTimestamp = t71.timestamp;
  }
  _createController() {
    return this._view.state.isGlobal ? new rt3({
      view: this._view
    }) : new K8({
      view: this._view
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/PointerDownCancelAnimation.js
var e45 = class extends t22 {
  constructor(t71, e71) {
    super(true), this.view = t71, this.registerIncoming("pointer-down", e71, () => this.view.state.stopActiveCameraController());
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/SingleKey.js
var e46 = class extends t22 {
  constructor(t71, e71) {
    super(true), this.key = t71, this.registerIncoming("key-down", e71, (t72) => this._handleKeyDown(t72));
  }
  _handleKeyDown(t71) {
    t71.data.key === this.key && (this.activate(), t71.stopPropagation());
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/SingleKeyResetHeading.js
var t49 = class extends e46 {
  constructor(e71, t71, i49) {
    super(t71, i49), this.view = e71;
  }
  activate() {
    this.view.goTo({
      heading: 0
    }).catch(() => {
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/SingleKeyResetTilt.js
var e47 = class extends e46 {
  constructor(t71, e71, i49) {
    super(e71, i49), this.view = t71;
  }
  activate() {
    this.view.goTo({
      tilt: 0
    }).catch(() => {
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/handlers/TwoFingerTilt.js
var o43 = class extends t22 {
  constructor(e71, t71 = false) {
    super(true), this._view = e71, this._invert = t71, this.registerIncoming("vertical-two-finger-drag", (e72) => this._handleTwoFinger(e72));
  }
  _handleTwoFinger(a59) {
    const o60 = this._invert ? -1 : 1, i49 = i4(0, a59.data.delta * o60);
    switch (a59.data.action) {
      case "begin":
        this._cameraController?.end(), this._cameraController = new H13({
          view: this._view,
          pivot: V13.CENTER
        }), this._view.state.switchCameraController(this._cameraController), this._cameraController.begin(i49);
        break;
      case "update":
        this._cameraController?.update(i49);
        break;
      case "end":
        this._cameraController?.end(), this._cameraController = null;
    }
  }
};

// ../../../node_modules/@arcgis/core/views/input/recognizers/VerticalTwoFingerDrag.js
var a36 = class extends t22 {
  constructor(e71 = 20, a59 = 40) {
    super(false), this._threshold = e71, this._maxDelta = a59, this._state = "ready", this._emittedArtificalEnd2 = false, this._vertical = this.registerOutgoing("vertical-two-finger-drag"), this._artificalDrag = this.registerOutgoing("drag"), this._dragEventSeparator = new t28({
      start: (t71, e72) => this._observeStart(t71, e72),
      update: (t71, e72, a60) => this._observeUpdate(t71, e72, a60),
      end: (t71, e72) => this._observeEnd(e72)
    }), this.registerIncoming("drag", (t71) => this._dragEventSeparator.handle(t71));
  }
  get failed() {
    return "failed" === this._state;
  }
  _observeStart(t71, e71) {
    1 === t71 && this._emittedArtificalEnd2 && (this._emittedArtificalEnd2 = false, this._artificalDrag.emit({
      action: "start",
      button: e71.data.button,
      buttons: e71.data.buttons,
      pointerType: e71.data.pointerType,
      timestamp: e71.data.timestamp,
      pointers: e71.data.pointers,
      pointer: e71.data.pointer,
      angle: e71.data.angle,
      radius: e71.data.radius,
      center: e71.data.center
    }), e71.stopPropagation()), this._state = 2 === t71 ? "ready" : "failed";
  }
  _observeUpdate(t71, e71, a59) {
    if ("failed" !== this._state && 2 === t71) return "active" === this._state ? (this._vertical.emit({
      delta: e71.data.center.y - this._thresholdReachedCenter.y,
      action: "update"
    }), void e71.stopPropagation()) : void (this._checkMovementWithinLimits(e71.data, a59.data) ? this._checkVerticalThresholdReached(e71.data, a59.data) && (this._state = "active", this._emittedArtificalEnd2 = true, this._thresholdReachedCenter = e71.data.center, this._artificalDrag.emit({
      action: "end",
      button: e71.data.button,
      buttons: e71.data.buttons,
      pointerType: e71.data.pointerType,
      timestamp: e71.data.timestamp,
      pointers: e71.data.pointers,
      pointer: e71.data.pointer,
      angle: e71.data.angle,
      radius: e71.data.radius,
      center: e71.data.center
    }), this._vertical.emit({
      delta: e71.data.center.y - this._thresholdReachedCenter.y,
      action: "begin"
    }), e71.stopPropagation()) : this._state = "failed");
  }
  _observeEnd(t71) {
    "active" === this._state && (this._vertical.emit({
      delta: t71.data.center.y - this._thresholdReachedCenter.y,
      action: "end"
    }), this._state = "ready", t71.stopPropagation());
  }
  _checkMovementWithinLimits(t71, e71) {
    let a59 = -1 / 0, i49 = 1 / 0, r57 = -1 / 0, s67 = 1 / 0;
    for (const {
      x: m45,
      y: g28
    } of e71.pointers.values()) a59 = Math.max(a59, m45), i49 = Math.min(i49, m45), r57 = Math.max(r57, g28), s67 = Math.min(s67, g28);
    let n63 = -1 / 0, h32 = 1 / 0, d38 = -1 / 0, o60 = 1 / 0;
    for (const {
      x: m45,
      y: g28
    } of t71.pointers.values()) n63 = Math.max(n63, m45), h32 = Math.min(h32, m45), d38 = Math.max(d38, g28), o60 = Math.min(o60, g28);
    const c44 = a59 - i49, l47 = r57 - s67, p49 = n63 - h32, _30 = d38 - o60;
    return Math.abs(t71.center.x - e71.center.x) < this._threshold && Math.abs(p49 - c44) <= this._maxDelta && Math.abs(_30 - l47) <= this._maxDelta;
  }
  _checkVerticalThresholdReached(t71, e71) {
    let a59 = Math.abs(t71.center.y - e71.center.y);
    return t71.pointers.forEach((t72, i49) => {
      const r57 = e71.pointers.get(i49);
      a59 = Math.min(a59, Math.abs(t72.y - r57.y));
    }), a59 >= this._threshold;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/input/SceneInputManager.js
var b14 = class extends S3 {
  destroy() {
    this.disconnect();
  }
  get primaryDragAction() {
    return this._get("primaryDragAction");
  }
  set primaryDragAction(t71) {
    "pan" !== t71 && "rotate" !== t71 || t71 === this._get("primaryDragAction") || (this._set("primaryDragAction", t71), this._updateMode());
  }
  get mode() {
    return this._get("mode");
  }
  set mode(t71) {
    "default" !== t71 && "pro" !== t71 || t71 === this._get("mode") || (this._set("mode", t71), this._updateMode());
  }
  get updating() {
    return !!this._inputManager?.updating;
  }
  get latestPointerType() {
    return this._inputManager?.latestPointerType;
  }
  get latestPointerLocation() {
    return this._inputManager?.latestPointerLocation;
  }
  get multiTouchActive() {
    return this._inputManager?.multiTouchActive ?? false;
  }
  disconnect() {
    this.view.viewEvents.disconnect(), this._inputManager = u(this._inputManager);
  }
  connect() {
    const t71 = this.view;
    this._source = new l15(this.view.surface, t71.input);
    const e71 = [new m15(), new r26(), new r27(), new s27(this.view.navigation), new a36()], r57 = new d10({
      eventSource: this._source,
      recognizers: e71
    });
    this._inputManager = r57, r57.installHandlers("prevent-context-menu", [new e29()], _10.INTERNAL), this._modeDragPan = new i34(t71, "primary"), this._modeDragRotate = new a34(t71, "secondary", V13.CENTER), this._modeDragZoom = new s48(t71, "tertiary");
    const i49 = {
      lookAround: "b",
      pan: {
        left: "ArrowLeft",
        right: "ArrowRight",
        forward: "ArrowUp",
        backward: "ArrowDown",
        up: "u",
        down: "j",
        headingLeft: "a",
        headingRight: "d",
        tiltUp: "w",
        tiltDown: "s",
        zoomIn: "+",
        zoomOut: "-"
      },
      resetHeading: "n",
      resetTilt: "p"
    };
    r57.installHandlers("navigation", [new e45(t71), new s47(t71), new n41(t71), new i32(t71, i49.pan), new i33(t71), new e47(t71, i49.resetTilt), new t49(t71, i49.resetHeading), new a34(t71, "primary", V13.EYE, [i49.lookAround]), new a34(t71, "secondary", V13.CENTER, [i49.lookAround]), new i34(t71, "tertiary", [i49.lookAround]), this._modeDragRotate, this._modeDragZoom, this._modeDragPan, new o43(t71)], _10.INTERNAL), this.view.viewEvents.connect(r57), this._updateMode(), this.addHandles(d2(() => this.view.navigation?.browserTouchPanEnabled, (t72) => {
      this._source.browserTouchPanningEnabled = !t72;
    }, P));
  }
  isModifierKeyDown(t71) {
    return this._inputManager?.isModifierKeyDown(t71) ?? false;
  }
  _updateMode() {
    const t71 = this.mode, e71 = this.primaryDragAction, r57 = z13.get(t71)?.get(e71);
    r57 && (this._modeDragPan && (this._modeDragPan.pointerAction = r57.pan), this._modeDragRotate && (this._modeDragRotate.pointerAction = r57.rotate), this._modeDragZoom && (this._modeDragZoom.pointerAction = r57.zoom));
  }
  get test() {
  }
};
e6([y2()], b14.prototype, "view", void 0), e6([y2({
  value: "pan"
})], b14.prototype, "primaryDragAction", null), e6([y2({
  value: "default"
})], b14.prototype, "mode", null), e6([y2({
  readOnly: true
})], b14.prototype, "updating", null), e6([y2()], b14.prototype, "latestPointerType", null), e6([y2()], b14.prototype, "latestPointerLocation", null), e6([y2()], b14.prototype, "multiTouchActive", null), e6([y2()], b14.prototype, "_inputManager", void 0), b14 = e6([a4("esri.views.3d.input.SceneInputManager")], b14);
var z13 = /* @__PURE__ */ new Map();
var E26 = /* @__PURE__ */ new Map();
var k14 = /* @__PURE__ */ new Map();
E26.set("pan", {
  pan: "primary",
  rotate: "secondary",
  zoom: "tertiary"
}), E26.set("rotate", {
  pan: "secondary",
  rotate: "primary",
  zoom: "tertiary"
}), k14.set("pan", {
  pan: "primary",
  rotate: "tertiary",
  zoom: "secondary"
}), k14.set("rotate", {
  pan: "tertiary",
  rotate: "primary",
  zoom: "secondary"
}), z13.set("default", E26), z13.set("pro", k14);
var C14 = b14;

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/deconflictorDebug.js
var e48;
var n42;
var i35 = false;
var l31 = false;
var o44 = false;
var s49 = false;
var a37 = null;
function c35(t71, e71) {
  if (!l31 || !n42) return;
  u31();
  const i49 = n42;
  let o60 = 0;
  for (let n63 = 0; n63 < t71.accBinsNumX; n63++) for (let e72 = 0; e72 < t71.accBinsNumY; e72++) {
    const l47 = t71.accBins[n63][t71.accBinsNumY - 1 - e72];
    o60 += l47.length;
    const s67 = n63 * t71.accBinsSizeX, a59 = (n63 + 1) * t71.accBinsSizeX, c44 = e72 * t71.accBinsSizeY, r57 = (e72 + 1) * t71.accBinsSizeY;
    i49.fillText(l47.length.toFixed(), s67 + 5, c44 + 15), h22(s67, a59, c44, r57, "blue");
  }
  i49.fillText("total totalShownLabels: " + o60, 70, 40), i49.fillText("total visible labels: " + e71.size, 70, 50), i49.fillText("total numTests: " + t71.accNumTests, 70, 30);
}
function r43(n63) {
  o44 = t19.DECONFLICTOR_SHOW_VISIBLE, s49 = t19.DECONFLICTOR_SHOW_INVISIBLE, i35 = o44 || s49, l31 = t19.DECONFLICTOR_SHOW_GRID, a37 = null, i35 || l31 ? a37 = () => p32(n63) : e48 && (e48.parentElement.removeChild(e48), e48 = null);
}
function u31() {
  a37 && (a37(), a37 = null);
}
function p32(t71) {
  null == e48 && (e48 = document.createElement("canvas"), e48.setAttribute("id", "debugCanvas2d"), t71.surface.parentElement.style.position = "relative", t71.surface.parentElement.appendChild(e48));
  const {
    state: i49
  } = t71, {
    camera: l47,
    pixelRatio: o60
  } = i49, {
    width: s67,
    height: a59
  } = l47, c44 = s67 * o60, r57 = a59 * o60;
  e48.setAttribute("width", `${c44}px`), e48.setAttribute("height", `${r57}px`), e48.setAttribute("style", `position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s67}px;height:${a59}px`), n42 = e48.getContext("2d"), n42.clearRect(0, 0, s67, a59), n42.font = "12px Arial";
}
function h22(t71, i49, l47, o60, s67) {
  u31();
  const a59 = e48.height, c44 = n42;
  c44.beginPath(), c44.lineWidth = 1, c44.strokeStyle = s67, c44.moveTo(t71, a59 - l47), c44.lineTo(i49, a59 - l47), c44.stroke(), c44.lineTo(i49, a59 - o60), c44.stroke(), c44.lineTo(i49, a59 - l47), c44.stroke(), c44.lineTo(t71, a59 - l47), c44.stroke(), c44.lineTo(t71, a59 - l47), c44.stroke(), c44.closePath();
}
function f30(t71, e71) {
  i35 && (e71 && o44 || !e71 && s49) && h22(t71.aabr[0], t71.aabr[2], t71.aabr[1], t71.aabr[3], e71 ? "green" : "red");
}

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/Deconflictor.js
var U14 = n7();
var k15 = n11();
var H14 = n11();
var q12 = n7();
var J9 = e15();
var K9 = _5();
var Q12 = m7();
var Z7 = n7();
var $7 = u6();
var ii = class {
  constructor() {
    this.aabr = u6(), this.distance = 0, this.culled = false, this.visible = false;
  }
};
var ti = class {
  constructor(i49, t71) {
    this.graphics3DGraphic = i49, this.slicePlaneEnabled = t71, this.info = {};
  }
};
var si;
!function(i49) {
  i49[i49.Idle = 0] = "Idle", i49[i49.Process = 1] = "Process", i49[i49.Sort = 2] = "Sort", i49[i49.Deconflict = 3] = "Deconflict", i49[i49.NumStates = 4] = "NumStates";
}(si || (si = {}));
var ei = class {
  constructor() {
    this.camera = new it(), this.slicePlane = W3(), this.slicePlaneEnabled = false;
  }
  copyFrom(i49) {
    this.camera.copyFrom(i49.camera), Z(i49.slicePlane, this.slicePlane), this.slicePlaneEnabled = i49.slicePlaneEnabled;
  }
};
var ri = class extends S3 {
  get dirty() {
    return this._dirty;
  }
  get state() {
    return this._state;
  }
  constructor(i49) {
    super(i49), this._dirty = false, this._viewState = new ei(), this._state = si.Idle, this._active = /* @__PURE__ */ new Map(), this._visible = /* @__PURE__ */ new Map(), this._iterators = new li(), this._accBinsNumX = 15, this._accBinsNumY = 20, this._accBinsSizeX = 0, this._accBinsSizeY = 0, this._accBins = null, this.accNumTests = 0;
  }
  destroy() {
    this._active.clear(), this._visible.clear(), this._iterators = null;
  }
  setDirty() {
    !this._dirty && this._active.size > 0 && (this._dirty = true, this.notifyChange("updating"));
  }
  get updating() {
    return this._state !== si.Idle || this._dirty;
  }
  get updatingProgress() {
    if (!this.updating) return 1;
    const i49 = this._state / si.NumStates;
    return this._dirty ? 0.5 * i49 : i49;
  }
  get running() {
    return this.view.ready && null != this.view.state && this.updating;
  }
  runTask(i49) {
    switch (this._state) {
      case si.Idle:
        this._startUpdate(), i49.madeProgress();
      case si.Process:
        if (this._state = si.Process, !this._processActiveGraphics(i49)) return;
      case si.Sort:
        if (this._state = si.Sort, !this._sortVisibleGraphics(i49)) return;
      case si.Deconflict:
        if (this._state = si.Deconflict, !this._deconflictVisibleGraphics(i49)) return;
      default:
        c35(this, this._visible), this._state = si.Idle, this.notifyChange("updating");
    }
  }
  modifyGraphics(i49, t71) {
    t71 ? i49.forEach((i50) => this.addToActiveGraphics(i50)) : i49.forEach((i50) => this.removeFromActiveGraphics(i50)), this.setDirty();
  }
  layerSupportsDeconfliction(i49) {
    if (null == i49 || "object3d" !== i49.type) return false;
    const t71 = i49.stageObject;
    if (1 !== (t71?.geometries.length ?? 0)) return false;
    const s67 = t71?.geometries[0], e71 = s67?.material;
    return e71 instanceof Q5;
  }
  _startUpdate() {
    r43(this.view), this._dirty = false, this._viewState.copyFrom(this.viewState);
    const {
      fullWidth: i49,
      fullHeight: t71
    } = this._viewState.camera;
    this._initBins(i49, t71), this._resetIterators();
  }
  addToActiveGraphics(i49) {
    i49.info[this.visibilityGroup] = new ii(), this._active.set(i49.graphics3DGraphic.graphic.uid, i49), this.setDirty();
  }
  removeFromActiveGraphics(i49) {
    this._visible.delete(i49.graphics3DGraphic.graphic.uid), ai(i49, this.visibilityGroup), delete i49.info[this.visibilityGroup], this._active.delete(i49.graphics3DGraphic.graphic.uid), this.setDirty();
  }
  _processActiveGraphics(i49) {
    const t71 = this._ensureActiveGraphicsIterator(), s67 = e14(J9, this._viewState.camera.projectionMatrix), e71 = "global" === this.view.viewingMode && 1 === this.view.map.ground.opacity && this._viewState.camera.relativeElevation > 0 ? K9 : null;
    let r57 = 0;
    for (null != e71 && (O2(V2(e71), l5, this._viewState.camera.viewMatrix), e71[3] = s6(this.view.spatialReference).radius, r57 = W2(e71, l5)); !i49.done; ) {
      i49.madeProgress();
      const a59 = t71.next();
      if (true === a59.done) return this._resetActiveGraphicsIterator(), true;
      const o60 = a59.value, c44 = o60?.info[this.visibilityGroup];
      c44 && (this._collectGraphics3DGraphics(o60, s67, e71, r57), c44.culled ? this._visible.delete(o60.graphics3DGraphic.graphic.uid) : this._visible.set(o60.graphics3DGraphic.graphic.uid, o60));
    }
    return false;
  }
  _sortVisibleGraphics(i49) {
    const t71 = this._ensureSortGraphicsIterator();
    for (; !i49.done; ) {
      const s67 = t71.next();
      if (i49.madeProgress(), true === s67.done) return this._resetSortGraphicsIterator(), true;
    }
    return false;
  }
  _deconflictVisibleGraphics(i49) {
    const t71 = this._ensureVisibleGraphicsIterator(), s67 = this.visibilityGroup === A12.LABEL;
    for (; !i49.done; ) {
      i49.madeProgress();
      const e71 = t71.next();
      if (true === e71.done) return this._resetVisibleGraphicsIterator(), true;
      const r57 = e71.value, a59 = r57.info[this.visibilityGroup];
      if (!a59 || a59.culled) {
        this._setGraphicVisibility(r57, false);
        continue;
      }
      const o60 = r57.graphics3DGraphic, c44 = !s67 || o60.isVisible();
      a59.visible = c44 && !this._isConflicted(r57), a59.visible && this._addToBins(r57), this._setGraphicVisibility(r57, a59.visible), f30(a59, a59.visible);
    }
    return false;
  }
  _resetIterators() {
    this._iterators.active = null, this._iterators.visible = null, this._iterators.sort = null;
  }
  _ensureActiveGraphicsIterator() {
    return this._iterators.active || (this._iterators.active = oi(this._active)), this._iterators.active;
  }
  _resetActiveGraphicsIterator() {
    this._iterators.active = null;
  }
  _ensureVisibleGraphicsIterator() {
    return this._iterators.visible || (this._iterators.visible = oi(this._visible)), this._iterators.visible;
  }
  _resetVisibleGraphicsIterator() {
    this._iterators.visible = null;
  }
  _ensureSortGraphicsIterator() {
    return this._iterators.sort || (this._iterators.sort = ci(this._visible, this._iterators.sortArray, this.visibilityGroup)), this._iterators.sort;
  }
  _resetSortGraphicsIterator() {
    this._iterators.sort = null;
  }
  _collectGraphics3DGraphics(i49, t71, s67, e71) {
    const r57 = i49.graphics3DGraphic;
    if (r57.destroyed) return;
    const a59 = i49.info[this.visibilityGroup];
    if (!r57.isVisible(A12.GRAPHIC, L8.DECONFLICTION)) return void (a59.culled = true);
    const o60 = this.getGraphicsLayers(r57);
    D(a59.aabr);
    let c44 = null;
    for (const n63 of o60) {
      if (!this.layerSupportsDeconfliction(n63)) continue;
      const r58 = n63.stageObject.geometries[0].material;
      if (null == c44 && (c44 = di, this._getProjectionInfo(n63, t71, c44), c44.isOutsideScreen || this._isCulledBySlice(i49, U14) || null != s67 && ui(c44, s67, e71))) return void (a59.culled = true);
      this._expandBoundingRect(a59, n63, r58, c44);
    }
    null == c44 ? a59.culled = true : (a59.distance = c44.distance, a59.culled = false);
  }
  _getProjectionInfo(i49, t71, s67) {
    const e71 = this._viewState.camera, r57 = i49.stageObject, a59 = r57.geometries[0], o60 = a59.material, c44 = V2(r57.boundingVolumeWorldSpace.bounds);
    O2(U14, c44, e71.viewMatrix);
    const n63 = a59.attributes, u46 = n63.get(e18.NORMAL).data, d38 = n63.get(e18.CENTEROFFSETANDDISTANCE).data;
    o60.applyShaderOffsetsView(U14, u46, r57.transformation, d38, e71, s67.scaleInfo, U14), s11(k15, U14[0], U14[1], U14[2], 1), z4(H14, k15, e71.projectionMatrix), g3(s67.positionNDC, H14, 1 / H14[3]), o60.applyShaderOffsetsNDC(s67.positionNDC, d38, e71, s67.positionNDC, q12), s67.distanceWithoutPolygonOffset = e71.depthNDCToWorld(q12[2]), s67.distance = q12[2] === s67.positionNDC[2] ? s67.distanceWithoutPolygonOffset : e71.depthNDCToWorld(s67.positionNDC[2]), s11(H14, s67.positionNDC[0], s67.positionNDC[1], s67.positionNDC[2], 1), z4(k15, H14, t71), m6(k15, k15, 1 / k15[3]), o4(s67.positionView, U14[0], U14[1], U14[2]);
  }
  _isCulledBySlice(i49, t71) {
    return i49.slicePlaneEnabled && this._viewState.slicePlaneEnabled && us(this._viewState.slicePlane, t71);
  }
  _expandBoundingRect(i49, t71, e71, {
    positionNDC: r57,
    scaleInfo: a59
  }) {
    const o60 = this._viewState.camera, c44 = t71.getScreenSize(hi);
    f12(c44, a59.factor, c44), c44[0] *= o60.pixelRatio, c44[1] *= o60.pixelRatio;
    const n63 = z2(e71.calculateRelativeScreenBounds(c44, a59.factorAlignment.scale, $7), f4(0, o60.fullWidth, 0.5 + 0.5 * r57[0]), f4(0, o60.fullHeight, 0.5 + 0.5 * r57[1])), l47 = this.marginFactor;
    if (0 !== l47) {
      const i50 = l47 * Math.min(M2(n63), s9(n63));
      n63[0] -= i50, n63[1] -= i50, n63[2] += i50, n63[3] += i50;
    }
    m4(i49.aabr, n63, i49.aabr);
  }
  _isConflicted(i49) {
    const t71 = i49.graphics3DGraphic.graphic.uid, s67 = i49.info[this.visibilityGroup];
    let e71 = true;
    for (let r57 = Math.floor(s67.aabr[0] / this._accBinsSizeX); r57 <= Math.floor(s67.aabr[2] / this._accBinsSizeX); r57++) if (!(r57 < 0 || r57 >= this._accBinsNumX)) for (let i50 = Math.floor(s67.aabr[1] / this._accBinsSizeY); i50 <= Math.floor(s67.aabr[3] / this._accBinsSizeY); i50++) {
      if (i50 < 0 || i50 >= this._accBinsNumY) continue;
      e71 = false;
      const a59 = this._accBins[r57][i50];
      for (let i51 = 0; i51 < a59.length; i51++) {
        const e72 = a59.data[i51], r58 = e72.info[this.visibilityGroup];
        if (r58 && r58.visible && e72.graphics3DGraphic.graphic.uid !== t71 && (this.accNumTests++, E3(r58.aabr, s67.aabr))) return true;
      }
    }
    return e71;
  }
  _initBins(i49, t71) {
    if (null == this._accBins) {
      this._accBins = [];
      for (let i50 = 0; i50 < this._accBinsNumX; i50++) {
        this._accBins.push([]);
        const i51 = this._accBins[this._accBins.length - 1];
        for (let t72 = 0; t72 < this._accBinsNumY; t72++) i51.push(new l3());
      }
    } else for (let s67 = 0; s67 < this._accBinsNumX; s67++) for (let i50 = 0; i50 < this._accBinsNumY; i50++) this._accBins[s67][i50].clear();
    this._accBinsSizeX = i49 / this._accBinsNumX, this._accBinsSizeY = t71 / this._accBinsNumY, this.accNumTests = 0;
  }
  _addToBins(i49) {
    const t71 = i49.info[this.visibilityGroup], s67 = Math.floor(t71.aabr[0] / this._accBinsSizeX), e71 = Math.floor(t71.aabr[2] / this._accBinsSizeX), r57 = Math.floor(t71.aabr[1] / this._accBinsSizeY), a59 = Math.floor(t71.aabr[3] / this._accBinsSizeY);
    for (let o60 = s67; o60 <= e71; o60++) if (!(o60 < 0 || o60 >= this._accBinsNumX)) for (let t72 = r57; t72 <= a59; t72++) t72 < 0 || t72 >= this._accBinsNumY || this._accBins[o60][t72].push(i49);
  }
  _setGraphicVisibility(i49, t71) {
    const s67 = i49.graphics3DGraphic;
    s67.destroyed || (s67.setVisibilityFlag(this.visibilityGroup, L8.DECONFLICTION, t71), this.visibilityGroup === A12.LABEL && this.view.labeler.setLabelGraphicVisibility(s67, t71));
  }
};
function ai(i49, t71) {
  const s67 = i49.graphics3DGraphic;
  s67.destroyed || s67.setVisibilityFlag(t71, L8.DECONFLICTION, true);
}
function* oi(i49) {
  if (Map.prototype.entries) {
    const t71 = i49.entries();
    for (let i50 = t71.next(); !i50.done; i50 = t71.next()) yield i50.value[1];
  } else yield* __yieldStar(i49.values());
}
function* ci(i49, t71, s67) {
  t71.clear(), i49.forEach((i50, e72) => {
    const r57 = t71.pushNew();
    r57.id = e72, r57.visible = i50.graphics3DGraphic.getVisibilityFlag(s67, L8.DECONFLICTION);
    const a59 = i50.info?.[s67];
    r57.prio = i50.graphics3DGraphic.deconflictionPriority, r57.distance = a59 ? a59.distance : Number.MAX_VALUE;
  }), yield;
  const e71 = t71.iterableSort((i50, t72) => i50.prio !== t72.prio ? t72.prio - i50.prio : i50.distance !== t72.distance ? i50.distance - t72.distance : i50.visible !== t72.visible ? i50.visible ? -1 : 1 : i50.id - t72.id);
  for (let r57 = e71.next(); !r57.done; r57 = e71.next()) yield;
  t71.forAll((t72) => {
    const s68 = i49.get(t72.id);
    s68 && (i49.delete(t72.id), i49.set(t72.id, s68));
  }), t71.clear();
}
e6([y2({
  constructOnly: true
})], ri.prototype, "view", void 0), e6([y2({
  type: Boolean,
  readOnly: true
})], ri.prototype, "updating", null), ri = e6([a4("esri.views.3d.layers.graphics.Deconflictor")], ri);
var ni = class {
  constructor() {
    this.id = 0, this.visible = false, this.prio = 0, this.distance = 0;
  }
};
var li = class {
  constructor(i49 = null, t71 = null, s67 = null) {
    this.active = i49, this.visible = t71, this.sort = s67, this.sortArray = new l3({
      allocator: (i50) => i50 || new ni()
    });
  }
};
var hi = n13();
var pi = class {
  constructor() {
    this.positionView = n7(), this.positionNDC = n7(), this.distance = 0, this.distanceWithoutPolygonOffset = 0, this.scaleInfo = new t36();
  }
  get isOutsideScreen() {
    const i49 = this.positionNDC;
    return i49[0] < -1 || i49[1] < -1 || i49[2] < -1 || i49[0] >= 1 || i49[1] >= 1;
  }
};
function ui(i49, t71, s67) {
  return r5(Q12.direction, i49.positionView), o4(Q12.origin, 0, 0, 0), !!X3(t71, Q12, Z7) && i49.distanceWithoutPolygonOffset > s67;
}
var di = new pi();

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/LabelDeconflictor.js
var c36 = 2e3;
var p33 = class extends ri {
  constructor(r57) {
    super(r57), this.visibilityGroup = A12.LABEL, this.marginFactor = 0.05, this._lastDeconfliction = 0;
  }
  get viewState() {
    return this.parent.viewState;
  }
  runTask(r57) {
    if (this.parent.running) return o12;
    const t71 = performance.now();
    if (r57.state !== I2.IDLE && t71 - this._lastDeconfliction < c36) return o12;
    super.runTask(r57), this.state === si.Idle && (this._lastDeconfliction = t71);
  }
  enabledChanged(r57, t71) {
    this.modifyGraphics(t71, r57.labelsEnabled);
  }
  getGraphicsLayers(r57) {
    return r57.labelLayers;
  }
};
e6([y2({
  constructOnly: true
})], p33.prototype, "parent", void 0), p33 = e6([a4("esri.views.3d.layers.graphics.LabelDeconflictor")], p33);

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/GraphicsDeconflictor.js
var u32 = class extends ri {
  constructor() {
    super(...arguments), this._contexts = /* @__PURE__ */ new Map(), this.visibilityGroup = A12.GRAPHIC, this._marginFactor = -0.1, this.test = {
      overrideMarginFactor: (e71) => {
        this._marginFactor = e71, this.setDirty();
      }
    };
  }
  get labels() {
    return this._labels;
  }
  get viewState() {
    return this._viewState;
  }
  initialize() {
    this.addHandles([d2(() => this.view?.state?.camera, () => {
      this._updateViewState(), this.setDirty();
    }), d2(() => this.view?.map?.ground?.opacity, (e71, t71) => {
      1 !== e71 && 1 !== t71 || this.setDirty();
    }), d2(() => this.view?.slicePlane, () => {
      this._updateSlicePlane(), this._slicePlaneChanged();
    }, P)]), this._frameTask = this.view.resourceController.scheduler.registerTask(I3.GRAPHICS_DECONFLICTOR, this), this._labels = new p33({
      view: this.view,
      parent: this
    });
  }
  destroy() {
    this._labels = u(this._labels), this._frameTask = l(this._frameTask);
  }
  get marginFactor() {
    return this._marginFactor;
  }
  setDirty() {
    this._contexts.size > 0 && (super.setDirty(), this._labels.setDirty());
  }
  runTask(e71) {
    super.runTask(e71), this.running || this._labels.setDirty();
  }
  _updateViewState() {
    this.view?.state && (this._viewState.camera.copyFrom(this.view.state.camera), this._updateSlicePlane());
  }
  _updateSlicePlane() {
    const e71 = this.view ? this.view.slicePlane : null;
    null != e71 && ls(e71, this._viewState.camera.viewMatrix, this._viewState.slicePlane), this._viewState.slicePlaneEnabled = null != e71;
  }
  _slicePlaneChanged() {
    n5(this._contexts, (e71, t71) => t71.symbolCreationContext.slicePlaneEnabled) && this.setDirty();
  }
  addGraphicsOwner(e71) {
    const t71 = this._getGraphicsContext(e71);
    return {
      addGraphic: (i49) => this._addGraphic(e71, t71, i49),
      removeGraphic: (e72) => this._removeGraphic(t71, e72),
      labelingInfoChange: () => this._labels.enabledChanged(e71, t71),
      featureReductionChange: () => this.enabledChanged(e71, t71),
      slicePlaneEnabledChange: () => this._slicePlaneEnabledChanged(e71, t71),
      clear: () => t71.forEach((e72) => this._removeGraphic(t71, e72.graphics3DGraphic)),
      remove: () => this._removeGraphicsOwner(e71),
      setDirty: () => this.setDirty()
    };
  }
  _removeGraphicsOwner(e71) {
    const t71 = this._contexts.get(e71);
    t71 && (t71.forEach((e72) => this._removeGraphic(t71, e72.graphics3DGraphic)), this._contexts.delete(e71), this.setDirty());
  }
  _addGraphic(e71, t71, i49) {
    const s67 = i49.graphic.uid, r57 = new ti(i49, e71.symbolCreationContext.slicePlaneEnabled);
    t71.set(s67, r57), _21(e71) && this.addToActiveGraphics(r57), e71.labelsEnabled && this._labels.addToActiveGraphics(r57);
    const a59 = !this._graphicSupportsDeconfliction(i49) || !_21(e71);
    i49.setVisibilityFlag(A12.GRAPHIC, L8.DECONFLICTION, a59);
  }
  _removeGraphic(e71, t71) {
    const i49 = t71.graphic.uid, s67 = e71.get(i49);
    s67 && (this.removeFromActiveGraphics(s67), this._labels.removeFromActiveGraphics(s67), e71.delete(i49), this.setDirty());
  }
  enabledChanged(e71, t71) {
    const i49 = _21(e71);
    i49 || g19(e71), this.modifyGraphics(t71, i49);
  }
  _slicePlaneEnabledChanged(e71, t71) {
    const i49 = e71.symbolCreationContext.slicePlaneEnabled;
    t71.forEach((e72) => e72.slicePlaneEnabled = i49), this.setDirty();
  }
  getGraphicsLayers(e71) {
    return e71.layers;
  }
  _graphicSupportsDeconfliction(e71) {
    if (e71.isDraped) return false;
    const t71 = e71.layers;
    if (!t71?.length) return false;
    for (const i49 of t71) if (this.layerSupportsDeconfliction(i49)) return true;
    return false;
  }
  _getGraphicsContext(e71) {
    const t71 = this._contexts.get(e71);
    if (t71) return t71;
    const i49 = /* @__PURE__ */ new Map();
    return this._contexts.set(e71, i49), this.setDirty(), i49;
  }
};
function _21(e71) {
  const t71 = e71.layer;
  return !(!t71?.featureReduction || "selection" !== t71.featureReduction.type);
}
function g19(e71) {
  const t71 = e71.graphics3DGraphics;
  t71 && t71.forEach((e72) => e72.setVisibilityFlag(A12.GRAPHIC, L8.DECONFLICTION, true));
}
u32 = e6([a4("esri.views.3d.layers.graphics.GraphicsDeconflictor")], u32);

// ../../../node_modules/@arcgis/core/geometry/projection/projectVec3Array.js
function e49(e71, c44, f46, s67, u46, i49, l47 = 1) {
  const m45 = G3(c44, u46, En);
  if (null == m45) return false;
  if (m45 === f6) {
    if (e71 === s67 && f46 === i49) return true;
    const t71 = f46 + l47;
    for (let o60 = f46, n63 = i49; o60 < t71; ++o60, ++n63) r5(s67[n63], e71[o60]);
    return true;
  }
  const p49 = f46 + l47;
  for (let r57 = f46, t71 = i49; r57 < p49; ++r57, ++t71) m45(e71[r57], 0, s67[t71], 0);
  return true;
}

// ../../../node_modules/@arcgis/core/views/3d/layers/support/FeatureTileVisibility3D.js
var N11 = class {
  constructor(t71, e71) {
    this._renderCoordsHelper = t71, this._getIsGroundOpaque = e71, this._surfaceElevation = 0, this._isGroundOpaque = false, this._cache = /* @__PURE__ */ new Map(), this._frustumBoundingSphereCenter = n7(), this._frustumBoundingSphereRadius = 0, this._frustum = new c20(t71), this._extendedFrustum = new c20(t71), this._intersector = new N6({
      renderCoordsHelper: t71
    }), this._renderSR = t71.spatialReference;
    const s67 = a10(this._renderSR);
    this._renderSREllipsoidRadius = s6(s67).radius, this._renderCoordsHelper = t71;
  }
  begin(t71, e71) {
    this._surfaceElevation = e71, this._aboveGround = t71.aboveGround, this._isGroundOpaque = this._getIsGroundOpaque(), this._frustum.update(t71), k16(this._frustum), this._updateExtendedFrustum(t71), this._updateFrustumBoundingSphere();
  }
  end() {
    this._cache.clear();
  }
  calculate(t71) {
    const e71 = this._renderCoordsHelper.viewingMode === l9.Global && t71.lij[0] >= V14 && t71.lij[0] < v18, s67 = this._getOrCalculateSingleTileVisibility(t71, !e71);
    return s67 !== s32.INVISIBLE && e71 ? this._calculateAggregatedChildrenVisibility(t71) : s67;
  }
  _calculateAggregatedChildrenVisibility(t71) {
    let e71 = s32.INVISIBLE;
    const s67 = this._cache.get(t71.id);
    if (null != s67) return s67;
    const i49 = U15.acquire();
    t71.getChildren(i49);
    for (const r57 of i49) {
      const t72 = this.calculate(r57);
      if (t72 !== s32.INVISIBLE && (e71 = t72, t72 === s32.VISIBLE_ON_SURFACE)) break;
    }
    return U15.release(i49), this._cache.set(t71.id, e71), e71;
  }
  _getOrCalculateSingleTileVisibility(t71, e71) {
    const s67 = this._cache.get(t71.id);
    if (null != s67) return s67;
    const i49 = this._calculateSingleTileVisibility(t71);
    return e71 && this._cache.set(t71.id, i49), i49;
  }
  _calculateSingleTileVisibility(t71) {
    if (!this._aboveGround && this._renderCoordsHelper.viewingMode === l9.Global && t71.lij[0] < H15) {
      return this._calculateSingleTileVisibilitySided(t71, false) === s32.INVISIBLE ? this._calculateSingleTileVisibilitySided(t71, true) : void 0;
    }
    return this._calculateSingleTileVisibilitySided(t71, this._aboveGround);
  }
  _isTileVisibleInFrustum(t71) {
    return this._renderCoordsHelper.viewingMode === l9.Local ? this._isTileVisibleInFrustumLocal(t71) : this._isTileVisibleInFrustumGlobal(t71);
  }
  _updateFrustumBoundingSphere() {
    const t71 = this._frustum, e71 = t71.origin, o60 = at4;
    z(o60, t71.direction);
    const u46 = t71.points, c44 = lt4;
    K(c44, u46[4], e71);
    const a59 = 0.5 * P3(c44, c44) / P3(o60, c44), l47 = this._frustumBoundingSphereCenter;
    q(l47, e71, o60, a59);
    const d38 = 1 + a59;
    this._frustumBoundingSphereRadius = d38;
  }
  _isTileVisibleInFrustumLocal(t71) {
    const e71 = t71.tilingScheme.spatialReference, s67 = t71.extent, c44 = this._renderSR, a59 = $8;
    if (a59[0] = s67[0], a59[1] = s67[1], a59[2] = 0, a59[3] = s67[2], a59[4] = s67[3], a59[5] = 0, !n8(a59, e71, 0, a59, c44, 0, 2)) return false;
    const l47 = tt3;
    o4(l47[0], a59[0], a59[1], 0), o4(l47[1], a59[3], a59[1], 0), o4(l47[2], a59[3], a59[4], 0), o4(l47[3], a59[0], a59[4], 0);
    const d38 = et3;
    o4(d38, 0.5 * (a59[0] + a59[3]), 0.5 * (a59[1] + a59[4]), 0.5 * (a59[2] + a59[5]));
    const _30 = st3;
    o4(_30, 0, 0, 1);
    const h32 = 0.5 * U3(l47[0], l47[2]), f46 = this._frustum, m45 = this._frustumBoundingSphereRadius, p49 = this._frustumBoundingSphereCenter, T21 = _t2;
    K(T21, p49, d38);
    const E37 = P3(_30, T21), R17 = dt3;
    q(R17, d38, _30, E37);
    if (U3(R17, p49) > h32 + m45) return false;
    const F18 = Z8, I25 = this._isGroundOpaque && this._aboveGround, O34 = this._isGroundOpaque && !this._aboveGround, S26 = Math.min(O34 ? yt2 : 1 / 0, E37 + m45), b25 = Math.max(I25 ? -yt2 : -1 / 0, E37 - m45);
    for (let i49 = 0; i49 < 4; ++i49) q(F18[i49], l47[i49], _30, S26), q(F18[i49 + 4], l47[i49], _30, b25);
    return !J10(f46.planes, F18, 8);
  }
  _isTileVisibleInFrustumGlobal(t71) {
    const e71 = t71.tilingScheme.spatialReference, _30 = t71.extent, h32 = this._isGroundOpaque && this._aboveGround, p49 = this._isGroundOpaque && !this._aboveGround;
    if (t71.lij[0] < K10) return true;
    const T21 = tt3, g28 = 0.5 * (_30[0] + _30[2]);
    if (o4(T21[0], _30[0], _30[1], 0), o4(T21[1], _30[2], _30[1], 0), o4(T21[2], _30[2], _30[3], 0), o4(T21[3], _30[0], _30[3], 0), o4(T21[4], g28, _30[1], 0), o4(T21[5], g28, _30[3], 0), !e49(T21, e71, 0, T21, this._renderSR, 0, 6)) return false;
    const R17 = T21[0][2] > 0, F18 = T21[3][2] < 0, I25 = R17 || F18, S26 = this._renderSREllipsoidRadius;
    if (I25) {
      const t72 = r4(0, 0, 1), e72 = rt4;
      W6(e72, t72, T21[0]);
      const s67 = nt3;
      if (W6(s67, t72, T21[1]), R17) {
        const i49 = it4, r57 = T21[4], n63 = ot3;
        W6(n63, r57, t72), W6(i49, n63, r57);
        const o60 = T21[0];
        _2(o60, e72, i49), D7(o60, S26);
        const u46 = T21[1];
        _2(u46, s67, i49), D7(u46, S26);
      } else if (F18) {
        const i49 = it4, r57 = T21[5], n63 = ot3;
        W6(n63, r57, t72), W6(i49, r57, n63);
        const o60 = T21[3];
        _2(o60, i49, e72), D7(o60, S26);
        const u46 = T21[2];
        _2(u46, i49, s67), D7(u46, S26);
      }
    }
    const b25 = et3;
    {
      const t72 = K(Tt2, T21[3], T21[0]);
      z(t72, t72);
      const e72 = u5(gt2, T21[0], T21[3]);
      g3(e72, e72, 0.5);
      const o60 = -P3(e72, t72), u46 = u5(Et2, T21[0], T21[1]);
      g3(u46, u46, 0.5);
      const c44 = u5(Rt2, T21[2], T21[3]);
      g3(c44, c44, 0.5);
      const d38 = K(Ft2, c44, u46);
      z(d38, d38);
      const _31 = -(o60 + P3(t72, u46)) / P3(t72, d38);
      q(b25, u46, d38, _31), D7(b25, S26);
    }
    const A32 = this._frustumBoundingSphereRadius, G17 = this._frustumBoundingSphereCenter, B17 = this._frustum, M18 = B17.planes, P19 = ut2;
    z(P19, b25);
    const j21 = P3(T21[0], P19) / Y(T21[0]), x26 = B17.origin, N18 = B17.points;
    let V19 = false;
    if (h32) {
      {
        V19 = true;
        const t73 = z(n7(), x26);
        for (let e72 = 0; e72 < 4; ++e72) {
          const n63 = N18[4 + e72], o60 = K(n7(), n63, x26);
          z(o60, o60);
          const u46 = _2(n7(), t73, o60);
          z(u46, u46);
          const a59 = _2(n7(), o60, u46);
          z(a59, a59);
          if (P3(x26, a59) > S26) {
            V19 = false;
            break;
          }
        }
      }
      if (V19) {
        if (P3(x26, P19) < S26 * j21 - yt2) return false;
      }
      const t72 = z(Ct2, B17.origin);
      if (P3(t72, P19) < 0) return false;
      {
        const t73 = z(wt2, B17.direction);
        if (P3(t73, P19) > qt2) return false;
      }
    }
    const v28 = Math.sqrt(1 - j21 * j21);
    if (v28 > 0.9) return true;
    let H23 = false;
    {
      const t72 = P3(P19, G17), e72 = Y(G17);
      if (e72 <= A32 && !M18.some((t73) => V3(t73, ht3) > 0)) {
        if (!h32) return true;
        H23 = true;
      }
      const s67 = t72 / e72;
      if (!H23 && t72 <= 0) {
        if (-t72 > A32) return false;
      }
      const i49 = A32 / e72;
      if (Math.sqrt(1 - s67 * s67) * Math.sqrt(1 - i49 * i49) - i49 * s67 > v28) return false;
    }
    if (!V19) {
      if (T21.some((t72) => B17.intersectsPoint(t72))) return true;
      if (B17.intersectsPoint(b25)) return true;
    }
    const L25 = ft2;
    K(L25, G17, ht3);
    const y27 = P3(L25, P19), C25 = ct2;
    g3(C25, P19, y27);
    const w24 = U3(C25, G17), q20 = e71.isWGS84, U23 = t71.lij, k23 = q20 && U23[2] === 2 ** U23[0] - 1, X13 = q20 && 0 === U23[2], Y12 = X13 ? jt2 : k23 ? Mt2 : Gt2, Z11 = X13 ? xt2 : k23 ? Pt3 : Bt2;
    if (!H23) {
      const t72 = T21, e72 = Nt2, s67 = It2, i49 = Ot2, r57 = ht3;
      for (const n63 of Y12) {
        const o60 = t72[n63];
        if (z14(s67, t72[(n63 + 1) % 4], o60), z14(i49, r57, o60), W6(e72, i49, s67), Q13(e72, N18, 1)) return false;
      }
    }
    let $10 = null;
    if (!h32 && y27 < 1.01 * A32) {
      const t72 = 2.5 * A32;
      if (w24 > j21 * t72 + A32) return false;
      const e72 = pt2, s67 = t72 / j21;
      for (let i49 = 0; i49 < 4; ++i49) g3(e72[i49], T21[i49], s67 / S26);
      o4(e72[4], 0, 0, 0), $10 = e72;
    } else {
      const t72 = (p49 ? S26 + yt2 : y27 + A32) / j21, e72 = h32 ? S26 - yt2 : (y27 - A32) / j21, s67 = mt2;
      for (let i49 = 0; i49 < 4; ++i49) {
        const r57 = T21[i49];
        g3(s67[i49], r57, e72 / S26), g3(s67[i49 + 4], r57, t72 / S26);
      }
      $10 = s67;
    }
    if (J10(M18, $10, $10.length)) return false;
    const st5 = B17.lines, at7 = St2, lt6 = bt2;
    for (const r57 of st5) {
      z(lt6, r57.direction);
      for (const t72 of Z11) {
        const e72 = $10[t72];
        if (z(at7, e72), Lt2(lt6, at7, $10, N18)) return false;
        const r58 = (t72 + 1) % 4;
        if (h32) {
          const t73 = $10[r58];
          if (K(at7, t73, e72), z(at7, at7), Lt2(lt6, at7, $10, N18)) return false;
        }
        if (p49) {
          const e73 = $10[4 + t72], n63 = $10[4 + r58];
          if (K(at7, n63, e73), z(at7, at7), Lt2(lt6, at7, $10, N18)) return false;
        }
      }
    }
    return true;
  }
  _calculateSingleTileVisibilitySided(t71, e71) {
    return this._isTileVisibleInFrustum(t71) ? (this._intersector.update(t71.extent, t71.tilingScheme.spatialReference, this._surfaceElevation, e71), this._intersector.isVisibleInFrustum(this._frustum, this._renderSREllipsoidRadius, true) ? s32.VISIBLE_ON_SURFACE : s32.VISIBLE_WHEN_EXTENDED) : s32.INVISIBLE;
  }
  _updateExtendedFrustum(e71) {
    this._extendedFrustum.update(e71), k16(this._extendedFrustum);
    const s67 = this._renderCoordsHelper.worldUpAtPosition(e71.eye, C15);
    this._aboveGround || j2(s67, s67);
    const i49 = m3(-P3(s67, e71.viewForward));
    if (this._hasExtendedFrustum = i49 > e71.fovY / 2, !this._hasExtendedFrustum) return;
    const n63 = this._extendedFrustumParameters(), o60 = this._extendedFrustum.mutablePoints;
    for (let t71 = 0; t71 < 4; t71++) {
      const e72 = n63.pointIndices[t71], s68 = o60[e72], i50 = this._renderCoordsHelper.getAltitude(s68);
      if (n63.needsAltitudeAdjustment(i50)) {
        switch (this._renderCoordsHelper.worldUpAtPosition(s68, C15), e72) {
          case g6.FAR_BOTTOM_LEFT:
          case g6.FAR_TOP_LEFT:
          case g6.NEAR_BOTTOM_LEFT:
          case g6.NEAR_TOP_LEFT:
            Q2(this._extendedFrustum.planes[j6.LEFT], C15, C15);
            break;
          case g6.FAR_BOTTOM_RIGHT:
          case g6.FAR_TOP_RIGHT:
          case g6.NEAR_BOTTOM_RIGHT:
          case g6.NEAR_TOP_RIGHT:
            Q2(this._extendedFrustum.planes[j6.RIGHT], C15, C15);
        }
        g3(C15, C15, n63.direction), this._renderCoordsHelper.intersectInfiniteManifold(l8(s68, C15), n63.zWithMargin, s68);
      }
    }
    if (this._extendedFrustum.updatePoints(o60), b4(o60[g6.NEAR_BOTTOM_LEFT], o60[g6.NEAR_BOTTOM_RIGHT], o60[g6.NEAR_TOP_RIGHT], w14), b4(o60[g6.NEAR_BOTTOM_RIGHT], o60[g6.NEAR_TOP_RIGHT], o60[g6.NEAR_TOP_LEFT], q13), P3(F(w14), F(q13)) < 0) {
      const t71 = this._extendedFrustum.mutablePoints;
      this._aboveGround ? [t71[g6.NEAR_BOTTOM_LEFT], t71[g6.NEAR_BOTTOM_RIGHT]] = [t71[g6.NEAR_BOTTOM_RIGHT], t71[g6.NEAR_BOTTOM_LEFT]] : [t71[g6.NEAR_TOP_LEFT], t71[g6.NEAR_TOP_RIGHT]] = [t71[g6.NEAR_TOP_RIGHT], t71[g6.NEAR_TOP_LEFT]], this._extendedFrustum.updatePoints(t71);
    }
  }
  _extendedFrustumParameters() {
    return this._aboveGround ? this._extendedFrustumParametersAboveSurface() : this._extendedFrustumParametersBelowSurface();
  }
  _extendedFrustumParametersAboveSurface() {
    const t71 = this._surfaceElevation - y16;
    return {
      zWithMargin: t71,
      pointIndices: c20.planePointIndices.bottom,
      direction: -1,
      needsAltitudeAdjustment: (e71) => e71 > t71
    };
  }
  _extendedFrustumParametersBelowSurface() {
    const t71 = this._surfaceElevation + y16;
    return {
      zWithMargin: t71,
      pointIndices: c20.planePointIndices.top,
      direction: 1,
      needsAltitudeAdjustment: (e71) => e71 < t71
    };
  }
};
var V14 = 2;
var v18 = 6;
var H15 = 12;
var L16 = 0.95;
var y16 = 1;
var C15 = n7();
var w14 = E6();
var q13 = E6();
var U15 = new e3(Array, (t71) => {
  4 !== t71.length && (t71[0] = new t37(), t71[1] = new t37(), t71[2] = new t37(), t71[3] = new t37());
}, (t71) => {
  t71[0].release(), t71[1].release(), t71[2].release(), t71[3].release();
});
function k16(t71) {
  const e71 = c20.nearFarLineIndices, s67 = t71.mutablePoints;
  for (const i49 of e71) {
    const [t72, e72] = i49, r57 = s67[t72], n63 = s67[e72];
    e11(C15, n63, r57), g3(C15, C15, L16), u5(s67[e72], r57, C15);
  }
  t71.updatePoints(s67);
}
function W6(t71, e71, i49) {
  return _2(t71, e71, i49), z(t71, t71), t71;
}
function z14(t71, e71, r57) {
  return K(t71, e71, r57), z(t71, t71), t71;
}
function D7(t71, e71) {
  return g3(t71, t71, e71 / Y(t71)), t71;
}
var X9 = [j6.LEFT, j6.RIGHT, j6.BOTTOM, j6.TOP, j6.FAR];
function Y9(t71, e71, s67) {
  for (let i49 = 0; i49 < s67; ++i49) if (V3(t71, e71[i49]) <= 0) return false;
  return true;
}
function J10(t71, e71, s67) {
  for (const i49 of X9) if (Y9(t71[i49], e71, s67)) return true;
  return false;
}
var K10 = 4;
function Q13(t71, e71, s67) {
  for (const i49 of e71) if (P3(i49, t71) < s67) return false;
  return true;
}
var Z8 = [n7(), n7(), n7(), n7(), n7(), n7(), n7(), n7()];
var $8 = [0, 0, 0, 0, 0, 0];
var tt3 = [n7(), n7(), n7(), n7(), n7(), n7()];
var et3 = n7();
var st3 = n7();
var it4 = n7();
var rt4 = n7();
var nt3 = n7();
var ot3 = n7();
var ut2 = n7();
var ct2 = n7();
var at4 = n7();
var lt4 = n7();
var dt3 = n7();
var _t2 = n7();
var ht3 = r4(0, 0, 0);
var ft2 = n7();
var mt2 = [n7(), n7(), n7(), n7(), n7(), n7(), n7(), n7()];
var pt2 = [n7(), n7(), n7(), n7(), n7()];
var Tt2 = n7();
var gt2 = n7();
var Et2 = n7();
var Rt2 = n7();
var Ft2 = n7();
var It2 = n7();
var Ot2 = n7();
var St2 = n7();
var bt2 = n7();
var At2 = n7();
var Gt2 = [0, 1, 2, 3];
var Bt2 = [0, 1, 2, 3];
var Mt2 = [0, 1, 3];
var Pt3 = [0, 1, 3];
var jt2 = [1, 2, 3];
var xt2 = [1, 2, 3];
var Nt2 = n7();
function Vt2(t71, e71, s67) {
  let i49 = 1 / 0, n63 = -1 / 0;
  for (const o60 of s67) {
    const t72 = P3(e71, o60);
    i49 = Math.min(i49, t72), n63 = Math.max(n63, t72);
  }
  t71[0] = i49, t71[1] = n63;
}
function vt2(t71, e71, s67, i49) {
  let n63 = 1 / 0, o60 = -1 / 0;
  for (const u46 of i49) {
    const i50 = P3(s67, u46);
    if (n63 = Math.min(n63, i50), o60 = Math.max(o60, i50), n63 <= e71 && o60 >= t71) return false;
  }
  return true;
}
var Ht2 = [0, 0];
function Lt2(t71, e71, s67, i49) {
  if (0 === s67.length || 0 === i49.length) return true;
  const r57 = At2;
  W6(r57, t71, e71);
  const n63 = i49[0] < s67[0], o60 = n63 ? s67 : i49, u46 = Ht2;
  return Vt2(u46, r57, n63 ? i49 : s67), vt2(u46[0], u46[1], r57, o60);
}
var yt2 = 430;
var Ct2 = n7();
var wt2 = n7();
var qt2 = Math.cos(0.25 * Math.PI);

// ../../../node_modules/@arcgis/core/views/3d/layers/support/FeatureTileMeasurements3D.js
var v19 = class {
  constructor(e71) {
    this._camera = new it(), this._focusOnMap = [0, 0], this._screenRect = u6(), this._tileSize = e71.tileSize, this._renderCoordsHelper = e71.renderCoordsHelper, this._tilingScheme = e71.tilingScheme, this._visibility = new N11(e71.renderCoordsHelper, e71.getIsGroundOpaque);
  }
  begin(e71, t71, r57) {
    this._camera.copyFrom(e71), this._surfaceElevation = r57, this._focusOnMap[0] = t71.x, this._focusOnMap[1] = t71.y, a7(0, 0, e71.fullWidth, e71.fullHeight, this._screenRect), this._visibility.begin(this._camera, r57);
  }
  end() {
    this._visibility.end();
  }
  updateTile(e71) {
    e71.measures.visibility = this._visibility.calculate(e71), e71.measures.distance = d3(e71.extent, this._focusOnMap), e71.measures.visibility !== s32.INVISIBLE && this._updateScreenMeasure(e71);
  }
  _updateScreenMeasure(e71) {
    const t71 = R7, r57 = 1 << t71, i49 = e71.measures.screenRect;
    D(i49);
    let s67 = 0;
    const o60 = e71.lij, n63 = o60[0], c44 = n63 + t71, a59 = o60[1] << t71, m45 = o60[2] << t71, h32 = this._tileSizeWithBias(e71), p49 = h32 * h32, _30 = this._camera, {
      frustum: f46,
      viewport: S26
    } = _30;
    if (this._renderCoordsHelper.viewingMode === l9.Local || n63 > K10) {
      const t72 = C16;
      this._tilingScheme.getExtent(o60[0], o60[1], o60[2], t72);
      const r58 = y17, i50 = H16, s68 = D();
      for (let e72 = 0; e72 < 4; ++e72) this._toRenderCoords(t72, w15[e72][0], w15[e72][1], i50[e72]), _30.projectToScreen(i50[e72], r58[e72]), f5(s68, r58[e72]);
      const n64 = J10(f46, i50, 4), c45 = s68[0] > S26[2] || s68[1] > S26[3] || s68[2] < S26[0] || s68[3] < S26[1];
      if (n64 || c45) return void (e71.measures.shouldSplit = false);
    }
    for (let l47 = 0; l47 < r57; l47++) for (let t72 = 0; t72 < r57; t72++) if (s67 += this._computeScreenArea(c44, a59 + l47, m45 + t72, i49), s67 > p49) return void (e71.measures.shouldSplit = true);
    e71.measures.shouldSplit = false;
  }
  _tileSizeWithBias(e71) {
    return e71.measures.visibility === s32.VISIBLE_WHEN_EXTENDED ? this._tileSize * T12 : this._tileSize;
  }
  _computeScreenArea(e71, t71, r57, i49) {
    this._tilingScheme.ensureMaxLod(e71);
    const s67 = C16;
    this._tilingScheme.getExtent(e71, t71, r57, s67);
    const o60 = A22;
    this._toRenderCoords(s67, 0, 3, o60[0]), this._toRenderCoords(s67, 2, 3, o60[1]), this._toRenderCoords(s67, 2, 1, o60[2]), this._toRenderCoords(s67, 0, 1, o60[3]);
    return this._computeTriangleScreenArea([o60[0], o60[1], o60[2]], i49) + this._computeTriangleScreenArea([o60[2], o60[1], o60[3]], i49);
  }
  _computeTriangleScreenArea(e71, t71) {
    const i49 = this._camera.frustum[j6.NEAR];
    let s67 = 0, o60 = -1, n63 = -1;
    for (let r57 = 0; r57 < 3; ++r57) {
      V3(i49, e71[r57]) > 0 ? (s67++, -1 === o60 && (o60 = r57)) : -1 === n63 && (n63 = r57);
    }
    if (0 === s67) return this._computeTriangleScreenAreaInside(e71, t71);
    if (1 === s67) {
      const s68 = I18, n64 = (o60 + 1) % 3, c44 = (o60 + 2) % 3, a59 = o60;
      r5(s68[0], e71[n64]), r5(s68[1], e71[c44]), x18(s68[2], e71[c44], e71[a59], i49);
      const l47 = this._computeTriangleScreenAreaInside(s68, t71);
      x18(s68[1], e71[n64], e71[a59], i49);
      return l47 + this._computeTriangleScreenAreaInside(s68, t71);
    }
    if (2 === s67) {
      const s68 = I18, o61 = n63;
      r5(s68[0], e71[o61]);
      const c44 = (n63 + 1) % 3, a59 = (n63 + 2) % 3;
      return x18(s68[1], e71[o61], e71[c44], i49), x18(s68[2], e71[o61], e71[a59], i49), this._computeTriangleScreenAreaInside(s68, t71);
    }
    return 0;
  }
  _computeTriangleScreenAreaInside(e71, t71) {
    for (let r57 = 0; r57 < 3; r57++) this._camera.projectToRenderScreen(e71[r57], E27), this._camera.renderToScreen(E27, y17[r57]), m4(t71, y17[r57], t71);
    return S6(y17[0], y17[1], y17[2]);
  }
  _toRenderCoords(e71, t71, r57, i49) {
    return M10[0] = e71[t71], M10[1] = e71[r57], M10[2] = this._surfaceElevation, this._renderCoordsHelper.toRenderCoords(M10, this._tilingScheme.spatialReference, i49), i49;
  }
};
var R7 = 2;
var T12 = 5;
var y17 = [i4(), i4(), i4(), i4()];
var C16 = u6();
var M10 = n7();
var A22 = [n7(), n7(), n7(), n7()];
var E27 = x3();
var I18 = [n7(), n7(), n7()];
function x18(e71, t71, r57, o60) {
  const n63 = V3(o60, t71), c44 = V3(o60, r57), a59 = Math.abs(c44 - n63);
  g3(e71, t71, Math.abs(c44) / a59), q(e71, e71, r57, Math.abs(n63) / a59);
}
var H16 = [n7(), n7(), n7(), n7()];
var w15 = [[0, 3], [2, 3], [2, 1], [0, 1]];

// ../../../node_modules/@arcgis/core/views/3d/layers/support/FeatureTileTree3D.js
var w16 = class extends S3 {
  get tilingScheme() {
    const e71 = this.tilingSchemeOwner.tilingScheme;
    if (!e71) return null;
    return e71.clone();
  }
  set filterExtent(e71) {
    if (null != e71 && !e71.spatialReference.equals(this.viewState.spatialReference)) return void n.getLogger(this).error("#extent", "extent spatial reference needs to be in the same spatial reference as the view");
    const t71 = this._get("filterExtent");
    if (t71 === e71 || null != t71 && e71 && t71.equals(e71)) return;
    const i49 = null != e71 ? e71.clone() : null;
    this._set("filterExtent", i49), this._setDirty();
  }
  get _filterExtentRect() {
    if (null == this.filterExtent) return null;
    const e71 = u6();
    return u14(this.filterExtent, e71, this.tilingScheme.spatialReference), e71;
  }
  get _rootTileIds() {
    const {
      tilingScheme: e71
    } = this;
    return this._filterExtentRect && e71 ? e71.rootTilesInExtent(this._filterExtentRect) : [[0, 0, 0]];
  }
  set suspended(e71) {
    e71 !== this._get("suspended") && (this._set("suspended", e71), this._setDirty());
  }
  get updating() {
    return this._dirty || !!this._pendingTiles;
  }
  constructor(e71) {
    super(e71), this.tiles = new V(), this.tileSize = 512, this._idToTile = /* @__PURE__ */ new Map(), this._clients = /* @__PURE__ */ new Set(), this._dirty = false, this._pendingTiles = null, this._newTiles = new l3();
  }
  initialize() {
    this.addHandles([d2(() => [this.tilingScheme, this.tileSize], () => this._reset(), C), d2(() => [this.tileSize, this.cameraOnSurface?.location, this.tilingScheme, this.viewState?.contentCamera, this.focus?.location], () => this._setDirty(), A3), d2(() => this.terrain?.baseOpacity ?? 1, () => this._setDirty())]), this.scheduler && (this._frameWorker = this.scheduler.registerTask(I3.FEATURE_TILE_TREE, this));
  }
  destroy() {
    this._frameWorker = l(this._frameWorker);
  }
  addClient() {
    const e71 = e5();
    return this._clients.add(e71), 1 === this._clients.size && this._setDirty(), e2(() => this._removeClient(e71));
  }
  _removeClient(e71) {
    this._clients.delete(e71), this._hasClients || this._clear();
  }
  get _hasClients() {
    return this._clients.size > 0;
  }
  _setDirty() {
    !this._hasClients || this.suspended || this._dirty || (this._frameWorker ? (this._dirty = true, this.notifyChange("updating")) : this.runTask(C4));
  }
  _clear() {
    this.tiles.removeAll(), this._idToTile.clear(), this._reset(), this._dirty = false, this.notifyChange("updating");
  }
  get running() {
    return this.updating;
  }
  runTask(e71) {
    this._dirty = false, this._pendingTiles || (this._startUpdate(), null != this._frameWorker && (this._frameWorker.priority = I3.FEATURE_TILE_TREE_ACTIVE)), this._subdivideTilesForView(e71), this._pendingTiles || null == this._frameWorker || (this._frameWorker.priority = I3.FEATURE_TILE_TREE), this.notifyChange("updating");
  }
  _startUpdate() {
    if (this.suspended) return;
    if (!this.tilingScheme) return void this._clear();
    this._tileMeasurements || (this._tileMeasurements = new v19({
      renderCoordsHelper: this.renderCoordsHelper,
      tilingScheme: this.tilingScheme,
      tileSize: this.tileSize,
      getIsGroundOpaque: () => 1 === (this.terrain?.baseOpacity ?? 1)
    }));
    const e71 = this.viewState.contentCamera;
    this._tileMeasurements.begin(e71, this.focus.location, this.cameraOnSurface.location.z ?? 0), this._pendingTiles = this._getRootTiles();
  }
  _reset() {
    this._newTiles.clear(), this._tileMeasurements = null, this._pendingTiles = null, this._setDirty();
  }
  _getRootTiles() {
    const {
      tilingScheme: e71
    } = this;
    return this._rootTileIds.map((t71) => new t37(t71[0], t71[1], t71[2], e71));
  }
  _purgeHorizonTiles(e71) {
    e71.sort((e72, t71) => {
      const i49 = e72.measures.screenRect, s67 = t71.measures.screenRect;
      return i49[1] + i49[3] - (s67[1] + s67[3]);
    });
    if (!(e71.length > O22)) return e71.toArray();
    D(x19);
    for (let t71 = 0; t71 < e71.length; t71++) if (m4(x19, e71.data[t71].measures.screenRect, x19), s9(x19) > C17) return e71.data.slice(t71, e71.length);
    return [];
  }
  _subdivideTilesForView(e71) {
    if (!this._pendingTiles) return;
    const {
      tilingScheme: t71
    } = this;
    for (; this._pendingTiles.length > 0 && !e71.done; ) {
      const i49 = this._pendingTiles.pop();
      e71.madeProgress(), this._filterExtentRect && !E3(this._filterExtentRect, i49.extent) || (this._tileMeasurements.updateTile(i49), i49.measures.visibility !== s32.INVISIBLE && (i49.measures.shouldSplit ? (t71.ensureMaxLod(i49.lij[0] + 1), this._pendingTiles.push(...i49.getChildren())) : this._newTiles.push(i49)));
    }
    0 === this._pendingTiles.length && (this._updateTiles(this._purgeHorizonTiles(this._newTiles)), this._newTiles.clear(), this._tileMeasurements.end(), this._pendingTiles = null);
  }
  _updateTiles(e71) {
    for (const s67 of this.tiles.items) s67.used = false;
    const t71 = e71.filter((e72) => {
      const t72 = this._idToTile.get(e72.id);
      return t72 ? (t72.copyMeasurementsFrom(e72), t72.used = true) : this._idToTile.set(e72.id, e72), !t72;
    }), i49 = this.tiles.items.filter((e72) => !e72.used && (this._idToTile.delete(e72.id), true));
    this.tiles.removeMany(i49), this.tiles.addMany(t71), this._sortTiles();
  }
  _sortTiles() {
    this.viewState.fixedContentCamera || this.tiles.sort((e71, t71) => e71.measures.visibility !== t71.measures.visibility ? e71.measures.visibility === s32.VISIBLE_ON_SURFACE ? -1 : 1 : e71.measures.distance - t71.measures.distance), this.tiles.forEach((e71, t71) => e71.loadPriority = t71);
  }
};
e6([y2({
  constructOnly: true
})], w16.prototype, "scheduler", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "renderCoordsHelper", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "tilingSchemeOwner", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "cameraOnSurface", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "focus", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "viewState", void 0), e6([y2({
  constructOnly: true
})], w16.prototype, "terrain", void 0), e6([y2()], w16.prototype, "tiles", void 0), e6([y2()], w16.prototype, "tileSize", void 0), e6([y2({
  readOnly: true
})], w16.prototype, "tilingScheme", null), e6([y2()], w16.prototype, "filterExtent", null), e6([y2({
  readOnly: true
})], w16.prototype, "_filterExtentRect", null), e6([y2({
  readOnly: true
})], w16.prototype, "_rootTileIds", null), e6([y2({
  value: false
})], w16.prototype, "suspended", null), e6([y2({
  readOnly: true
})], w16.prototype, "updating", null), w16 = e6([a4("esri.views.3d.layers.support.FeatureTileTree3D")], w16);
var x19 = u6();
var C17 = 10;
var O22 = 50;

// ../../../node_modules/@arcgis/core/views/3d/state/ViewState.js
var _22 = class extends S3 {
  constructor() {
    super(...arguments), this._propertiesPool = new o21({
      camera: it
    }, this), this._lastSeenCameraProjectionValues = new it(), this.mode = I2.ANIMATING, this._cssCamera = new it(), this._camera = new it(), this.rasterPixelRatio = 1, this.contentPixelRatio = 1, this.events = new o3(), this.viewingMode = l9.Global, this._cameraChanged = false, this._updateQueue = new Array(), this._processingUpdates = false;
  }
  init(e71, t71) {
    this._set("viewingMode", e71), this._set("spatialReference", t71), this._set("constraints", new c25({
      mode: this.viewingMode
    }));
  }
  exit() {
    this.cameraController = null, this._propertiesPool.destroy(), this._propertiesPool = new o21({
      camera: it
    }, this);
  }
  destroy() {
    this.cameraController = null, this._propertiesPool?.destroy(), this._propertiesPool = null;
  }
  createInitialCamera() {
    if (this.viewingMode === l9.Global) {
      const e71 = s6(this.spatialReference).radius;
      this.camera = new it({
        eye: r4(4 * e71, 0, 0),
        center: r4(e71, 0, 0),
        up: r4(0, 0, 1)
      });
    } else this.camera = new it({
      eye: r4(0, 0, 100),
      center: r4(0, 0, 0),
      up: r4(0, 1, 0)
    });
  }
  get animation() {
    return this.cameraController instanceof a33 && null != this.cameraController.viewAnimation ? this.cameraController.viewAnimation : null;
  }
  get cssCamera() {
    const e71 = this._cssCamera.copyFrom(this.camera), {
      height: t71,
      width: r57,
      pixelRatio: o60
    } = this.camera;
    return e71.pixelRatio = 1, e71.height = Math.round(t71 / o60), e71.width = Math.round(r57 / o60), e71;
  }
  get camera() {
    return this._camera;
  }
  set camera(e71) {
    e71 !== v20 && v20.copyFrom(e71), v20.computeUp(this.viewingMode), this.events.emit("before-camera-change", v20);
    const t71 = this._camera;
    if (w17(this._lastSeenCameraProjectionValues, v20) && (this._lastSeenCameraProjectionValues.copyFrom(v20), this.events.emit("camera-projection-changed", this._lastSeenCameraProjectionValues)), !t71.equals(v20) && (this._camera = this._propertiesPool.get("camera").copyFrom(v20), this._cameraChanged = !t71.almostEquals(v20), this._cameraChanged)) {
      const e72 = U(() => {
        this._cameraChanged = false, e72.remove();
      });
    }
  }
  get pixelRatio() {
    return this.camera.pixelRatio;
  }
  get alignPixelEnabled() {
    return this.pixelRatio === this.rasterPixelRatio && this.mode === I2.IDLE;
  }
  get updating() {
    return this.mode !== I2.IDLE;
  }
  get contentCamera() {
    return this._contentCamera ?? this.camera;
  }
  set contentCamera(e71) {
    this._contentCamera = null != e71 ? e71.clone() : null;
  }
  get fixedContentCamera() {
    return null != this._contentCamera;
  }
  get isGlobal() {
    return this.viewingMode === l9.Global;
  }
  get isLocal() {
    return this.viewingMode === l9.Local;
  }
  get navigating() {
    return !!this.cameraController?.isInteractive;
  }
  get stationary() {
    return !this._cameraChanged && !this.navigating;
  }
  get cameraController() {
    return this._get("cameraController");
  }
  set cameraController(e71) {
    this.stopActiveCameraController() ? (this.cameraController?.destroy(), e71 && (this.removeHandles(j12), this.addHandles(p(() => e71.state === s44.Finished || e71.state === s44.Stopped, () => {
      this._set("cameraController", null), this.updateCamera((t71) => e71.onControllerEnd(t71));
    }, {
      sync: true,
      once: true
    }), j12), e71.onControllerStart(this.camera)), this._set("cameraController", e71)) : e71 && (e71.state = s44.Rejected);
  }
  switchCameraController(e71) {
    return this.cameraController = e71, e71.state !== s44.Rejected;
  }
  stopActiveCameraController() {
    return !(this.cameraController && !this.cameraController.stopController());
  }
  updateCamera(e71) {
    this._updateQueue.push(e71), this._processUpdateQueue();
  }
  _processUpdateQueue() {
    if (0 === this._updateQueue.length || this._processingUpdates) return;
    this._processingUpdates = true;
    const e71 = this._updateQueue.shift();
    v20.copyFrom(this._get("camera")), e71(v20), this.camera = v20, this._processingUpdates = false, this._processUpdateQueue();
  }
};
e6([y2()], _22.prototype, "mode", void 0), e6([y2({
  readOnly: true,
  type: a17
})], _22.prototype, "animation", null), e6([y2({
  type: it
})], _22.prototype, "cssCamera", null), e6([y2()], _22.prototype, "_cssCamera", void 0), e6([y2({
  type: it
})], _22.prototype, "camera", null), e6([y2()], _22.prototype, "_camera", void 0), e6([y2({
  readOnly: true
})], _22.prototype, "pixelRatio", null), e6([y2()], _22.prototype, "rasterPixelRatio", void 0), e6([y2()], _22.prototype, "contentPixelRatio", void 0), e6([y2({
  readOnly: true
})], _22.prototype, "alignPixelEnabled", null), e6([y2({
  readOnly: true
})], _22.prototype, "updating", null), e6([y2({})], _22.prototype, "_contentCamera", void 0), e6([y2({
  type: it
})], _22.prototype, "contentCamera", null), e6([y2({
  readOnly: true
})], _22.prototype, "fixedContentCamera", null), e6([y2({
  readOnly: true
})], _22.prototype, "constraints", void 0), e6([y2({
  readOnly: true
})], _22.prototype, "events", void 0), e6([y2({
  readOnly: true
})], _22.prototype, "isGlobal", null), e6([y2({
  readOnly: true
})], _22.prototype, "isLocal", null), e6([y2({
  readOnly: true
})], _22.prototype, "viewingMode", void 0), e6([y2({
  readOnly: true
})], _22.prototype, "spatialReference", void 0), e6([y2()], _22.prototype, "navigating", null), e6([y2()], _22.prototype, "stationary", null), e6([y2()], _22.prototype, "_cameraChanged", void 0), e6([y2()], _22.prototype, "cameraController", null), _22 = e6([a4("esri.views.3d.state.ViewState")], _22);
var f31 = _22;
function w17(e71, t71) {
  return e71.fov !== t71.fov || e71.fullViewport[0] !== t71.fullViewport[0] || e71.fullViewport[1] !== t71.fullViewport[1] || e71.fullViewport[2] !== t71.fullViewport[2] || e71.fullViewport[3] !== t71.fullViewport[3] || e71.padding[t33.TOP] !== t71.padding[t33.TOP] || e71.padding[t33.RIGHT] !== t71.padding[t33.RIGHT] || e71.padding[t33.BOTTOM] !== t71.padding[t33.BOTTOM] || e71.padding[t33.LEFT] !== t71.padding[t33.LEFT];
}
var v20 = new it();
var j12 = "ViewStateHandles";

// ../../../node_modules/@arcgis/core/views/3d/state/helpers/SceneIntersectionHelper.js
var U16 = class {
  constructor(t71, r57, n63) {
    this.viewingMode = t71, this._forEachLayer = r57, this._view = n63, this._externalIntersectionHandlers = new l3(), this._tolerance = E15, this._tmpRay = m7(), this._tmpRegion = u6(), this._validateHUDIntersector = T5(this.viewingMode), this._validateHUDIntersector.options.hud = false;
  }
  intersectScreen(e71, t71, r57) {
    return this.intersectRay(this._getPickRay(e71, this._tmpRay), T13(this.viewingMode), t71, r57);
  }
  intersectScreenFreePointFallback(e71, t71, r57) {
    return this.intersectRayFreePointFallback(this._getPickRay(e71, this._tmpRay), t71, r57);
  }
  intersectRayFreePointFallback(e71, t71, r57) {
    return this.intersectRay(e71, T13(this.viewingMode), t71, r57) || this._intersectRayFreePointLocal(e71, t71);
  }
  intersectRay(e71, t71, r57, n63) {
    return t71.options.selectionMode = false, t71.options.store = e30.MIN, this.computeIntersection(e71, t71, n63), !!t71.results.min && t71.results.min.getIntersectionPoint(r57);
  }
  getCenterRayWithSubpixelOffset(e71, t71, r57 = 0.5, n63 = 0.5) {
    return e71.getRenderCenter(D8, r57, n63), D8[0] += 0.0466, D8[1] -= 0.0123, f19(e71, D8, t71);
  }
  intersectIntersectorScreen(e71, t71, r57) {
    this.computeIntersection(this._getPickRay(e71, this._tmpRay), t71, r57);
  }
  intersectToolIntersectorScreen(e71, t71, r57) {
    const n63 = this._getPickRay(e71, this._tmpRay);
    this.intersectToolIntersectorRay(n63, t71, r57);
  }
  intersectToolIntersectorRay(e71, t71, r57) {
    t71.options.selectionMode = true, this.computeIntersection(e71, t71, r57);
    const n63 = t71.results.min;
    !!this._view.basemapTerrain && this._view.basemapTerrain.opaque || o25(n63) && n63.intersector !== i17.TERRAIN || (t71.options.selectionMode = false, this.computeIntersection(e71, t71, r57));
  }
  setTolerance(e71 = E15) {
    this._tolerance = e71;
  }
  addIntersectionHandler(e71) {
    this._externalIntersectionHandlers.push(e71), this._externalIntersectionHandlers.sort((e72, t71) => e72.type === i17.TERRAIN ? 1 : t71.type === i17.TERRAIN ? -1 : 0);
  }
  removeIntersectionHandler(e71) {
    null != this._externalIntersectionHandlers.removeUnordered(e71) && this._externalIntersectionHandlers.sort((e72, t71) => e72.type === i17.TERRAIN ? 1 : t71.type === i17.TERRAIN ? -1 : 0);
  }
  _getPickRay(e71, t71) {
    const r57 = this._view.state.camera;
    return g10(r57, e71, t71);
  }
  _intersectRayFreePointLocal(e71, t71) {
    return this.viewingMode !== l9.Local || null == e71 || u5(t71, e71.origin, z(c6.get(), e71.direction)), false;
  }
  intersectElevationFromScreen(e71, t71, r57 = 0, n63 = null) {
    return this._intersectElevation(this._getPickRay(e71, this._tmpRay), t71, r57, n63);
  }
  _intersectElevation(e71, r57, l47 = 0, c44 = null) {
    if (null == e71) return null;
    const a59 = this._view, {
      renderCoordsHelper: u46
    } = a59, h32 = L2(a59.spatialReference), d38 = null != r57 ? r57.mode : "absolute-height", p49 = R2(r57) / h32, m45 = ("on-the-ground" !== d38 ? p49 + l47 : 0) * h32 / u46.unitInMeters, {
      camera: g28
    } = a59.state;
    if ("absolute-height" === d38) {
      const t71 = u46?.getAltitude(g28.eye), r58 = P3(z(F9, e71.direction), u46.worldUpAtPosition(g28.eye, S17));
      if (t71 < m45 && r58 < 0 || t71 >= m45 && r58 > 0) return null;
      if (u46.intersectInfiniteManifold(e71, m45, F9)) {
        const e72 = L9(a59, F9);
        return e72.z ??= 0, e72.z -= p49, e72;
      }
      return null;
    }
    const _30 = p7(c6.get());
    g28.projectToRenderScreen(e71.origin, _30);
    const I25 = new A23(null, this._forEachLayer), {
      slicePlane: v28
    } = a59, j21 = null != v28 ? c13(v28) : null, U23 = T5(this.viewingMode);
    U23.options.store = e30.MIN, U23.options.verticalOffset = m45, U23.options.normalRequired = false;
    const x26 = e71.origin, E37 = u5(c6.get(), x26, e71.direction);
    U23.reset(x26, E37, g28), U23.point = _30;
    const H23 = c44 ? "type" in c44 && "graphics" === c44.type ? (e72) => e72.layerUid !== c44.uid : (e72) => e72.graphicUid !== c44.uid : null;
    switch (d38) {
      case "relative-to-scene": {
        const e72 = (e73) => (!H23 || H23(e73)) && !!e73.lastValidElevationBB;
        U23.intersect(I25.layers, _30, this._tolerance, null, e72), this._externalIntersectionHandlers.forAll((e73) => {
          if (e73.type === i17.I3S || e73.type === i17.TERRAIN || e73.type === i17.TILES3D) {
            const t71 = e73.slicePlaneEnabled ? j21 : null;
            e73.intersect(U23, t71, U23.rayBegin, U23.rayEnd, _30);
          }
        });
        break;
      }
      case "on-the-ground":
      case "relative-to-ground":
        this._externalIntersectionHandlers.forAll((e72) => {
          if (e72.isGround) {
            const t71 = e72.slicePlaneEnabled ? j21 : null;
            e72.intersect(U23, t71, U23.rayBegin, U23.rayEnd, _30);
          }
        });
    }
    if (U23.results.min.getIntersectionPoint(F9)) {
      const e72 = L9(a59, F9);
      return e72.z = l47, e72;
    }
    return null;
  }
  computeIntersection(e71, r57, n63, s67) {
    if (null == e71) return;
    const o60 = this._view.state.camera, l47 = p7(c6.get());
    o60.projectToRenderScreen(e71.origin, l47);
    const c44 = new A23(n63, this._forEachLayer);
    r57.options.selectOpaqueTerrainOnly = !n63 || !("include" in n63 || "exclude" in n63);
    const a59 = e71.origin, u46 = u5(c6.get(), e71.origin, e71.direction);
    r57.reset(a59, u46, o60), r57.intersect(c44.layers, l47, this._tolerance);
    const h32 = this._view.slicePlane, d38 = null != h32 ? c13(h32) : null;
    r57.intersect(c44.sliceableLayers, l47, this._tolerance, d38);
    const p49 = n63 && (n63.requiresGroundFeedback || n63.enableDraped);
    this._externalIntersectionHandlers.forAll((e72) => {
      const t71 = e72.layerUid, n64 = Array.isArray(t71), i49 = n64 ? t71 : [t71];
      n64 && (r57.options.filteredLayerUids = []);
      let o61 = false;
      for (const s68 of i49) {
        !c44.filterLayerUid(s68) ? n64 && r57.options.filteredLayerUids.push(s68) : o61 = true;
      }
      if (r57.options.isFiltered = !o61, e72.isGround && p49 || !r57.options.isFiltered) {
        const t72 = e72.slicePlaneEnabled ? d38 : null;
        e72.intersect(r57, t72, a59, u46, l47, s67);
      }
    });
    const m45 = c6.get(), f46 = this._view.basemapTerrain;
    if (n63 && n63.enableDraped && null != f46.spatialReference && r57.results.ground.getIntersectionPoint(m45)) {
      const e72 = f46.overlayManager.renderer, t71 = this._view.renderCoordsHelper.spatialReference, n64 = c6.get();
      this._view.renderCoordsHelper.fromRenderCoords(m45, n64, f46.spatialReference), n64[2] = this._view.elevationProvider?.getElevation(m45[0], m45[1], m45[2], t71, "ground") ?? 0, e72.intersect(r57, n64, r57.results.ground, (e73) => c44.filterRenderGeometry(e73));
    }
    r57.sortResults(), this._processHUDResults(r57);
  }
  _processHUDResults(e71) {
    const t71 = e71.results.hud;
    e13(this._tmpRegion, K2);
    const r57 = this._view.state.camera, n63 = [], i49 = this._tmpRegion, s67 = (e72) => {
      const t72 = new H17(e72);
      r57.projectToRenderScreen(e72.target.center, t72.screenPoint), t72.screenPoint[0] = Math.floor(t72.screenPoint[0]), t72.screenPoint[1] = Math.floor(t72.screenPoint[1]), n63.push(t72), f5(i49, t72.screenPoint);
    };
    e71.sortResults(t71.all), null != t71.min.dist && s67(t71.min);
    for (const a59 of t71.all) t71.min.target.object !== a59.target.object && t71.max.target.object !== a59.target.object && s67(a59);
    if (null != t71.max.dist && t71.max.target.object !== t71.min.target.object && s67(t71.max), !n63.length) return;
    i49[0] === i49[2] && (i49[2] += 1), i49[1] === i49[3] && (i49[3] += 1);
    const o60 = r57.fullWidth, l47 = r57.fullHeight, c44 = Math.max(0, i49[0] - x20), m45 = Math.max(0, i49[1] - x20), y27 = Math.min(M2(i49) + 2 * x20, o60 - c44), f46 = Math.min(s9(i49) + 2 * x20, l47 - m45);
    if (y27 <= 0 || f46 <= 0) return;
    const g28 = new Uint8Array(y27 * f46 * 4);
    this._view._stage.renderer.readHUDVisibility(c44, m45, y27, f46, g28);
    let R17 = true;
    const _30 = null == e71.results.max.dist;
    let I25 = 0;
    for (const a59 of n63) for (const t72 of E28) {
      const r58 = 4 * (Math.min(a59.screenPoint[0] + t72[0], o60) - i49[0] + (Math.min(a59.screenPoint[1] + t72[1], l47) - i49[1]) * y27);
      if (!(r58 < 0 || r58 >= g28.length) && g28[r58]) {
        R17 && (e71.results.min.copy(a59.result), R17 = false), _30 && e71.results.max.copy(a59.result), e71.options.store === e30.ALL && e71.results.all.splice(I25++, 0, a59.result);
        break;
      }
    }
  }
};
var x20 = 1;
var E28 = (() => {
  const e71 = [], t71 = x20;
  for (let r57 = -t71; r57 <= t71; r57++) for (let n63 = -t71; n63 <= t71; n63++) e71.push([n63 + t71, r57 + t71]);
  return e71;
})();
var H17 = class {
  constructor(e71) {
    this.result = e71, this.screenPoint = x3();
  }
};
var L17;
function T13(e71) {
  return L17 && L17.viewingMode === e71 || (L17 = T5(e71)), L17;
}
var A23 = class {
  constructor(e71, t71) {
    this.layers = new Array(), this.sliceableLayers = new Array(), this.include = e71?.include, this.exclude = e71?.exclude, t71((e72) => {
      e72.pickable && this.filterLayerUid(e72.apiLayerUid) && (e72.sliceable ? this.sliceableLayers : this.layers).push(e72);
    });
  }
  filterLayerUid(e71) {
    const {
      include: t71,
      exclude: r57
    } = this;
    return null == e71 ? null == t71 && null == r57 : (null == t71 || t71.has(e71)) && (null == r57 || !r57.has(e71));
  }
  filterRenderGeometry(e71) {
    return this.filterLayerUid(e71.layerUid);
  }
};
function k17(e71) {
  return "object" == typeof e71 && "intersect" in e71;
}
var F9 = n7();
var S17 = n7();
var D8 = x3();

// ../../../node_modules/@arcgis/core/views/3d/support/CombinedElevationProvider.js
var h23 = class extends o3.EventedMixin(S3) {
  get spatialReference() {
    return this.view?.basemapTerrain?.spatialReference;
  }
  constructor(e71) {
    super(e71), this._im = new Array(), this._ground = new Array(), this._scene = new Array(), this.lastElevationQuery = null, this._cacheEnabled = false;
  }
  destroy() {
    this._cachedQuery = u(this._cachedQuery);
  }
  enableCache(e71) {
    e71 || (this.lastElevationQuery = null), this._cacheEnabled = e71;
  }
  getElevation(e71, t71, s67, r57, n63) {
    if (this._cacheEnabled && null != this.lastElevationQuery) {
      const o61 = this.lastElevationQuery;
      if (e71 === o61.x && t71 === o61.y && s67 === o61.z && G(r57, o61.spatialReference) && n63 === o61.queryContext) return o61.result;
    }
    let o60 = null;
    return o60 = p34(o60, this._im, e71, t71, s67, r57, n63), null == o60 && (o60 = p34(o60, this._ground, e71, t71, s67, r57, n63)), "scene" === n63 && (o60 = p34(o60, this._scene, e71, t71, s67, r57, n63)), this._cacheEnabled && (this.lastElevationQuery = {
      x: e71,
      y: t71,
      z: s67,
      spatialReference: r57,
      queryContext: n63,
      result: o60
    }), o60;
  }
  getSphereElevationBounds(e71, t71, s67) {
    const r57 = new e23();
    function n63(n64) {
      for (const o60 of n64) if (o60.getSphereElevationBounds) {
        const n65 = o60.getSphereElevationBounds(e71, t71, s67);
        null != n65 && r57.expandElevationRangeValues(n65.elevationRangeMin, n65.elevationRangeMax);
      }
    }
    return n63(this._ground), n63(this._im), "scene" === s67 && n63(this._scene), r57;
  }
  getRootElevationBounds() {
    const e71 = new e23();
    for (const t71 of [this._im, this._ground, this._scene]) t71.forEach((t72) => {
      if (t72.getRootElevationBounds) {
        const s67 = t72.getRootElevationBounds();
        null != s67 && e71.expandElevationRangeValues(s67.elevationRangeMin, s67.elevationRangeMax);
      }
    });
    return e71;
  }
  queryElevation(e71, t71, s67, r57, o60, i49 = null, a59 = 0) {
    return __async(this, null, function* () {
      const l47 = this._getElevationQuery(r57);
      try {
        const n63 = yield l47.queryElevation(e71, t71, i49, a59);
        return "scene" === o60 ? p34(n63, this._scene, e71, t71, s67, r57, o60) : n63;
      } catch (c44) {
        return a3(c44), this.getElevation(e71, t71, s67, r57, o60);
      }
    });
  }
  register(e71, t71) {
    this.addHandles(t71.on("elevation-change", (e72) => this.emit("elevation-change", e72)), t71), this._providersFromContext(e71).push(t71);
  }
  unregister(e71) {
    this.removeHandles(e71);
    for (const t71 of [this._im, this._ground, this._scene]) {
      const s67 = t71.indexOf(e71);
      s67 > -1 && t71.splice(s67, 1);
    }
  }
  _providersFromContext(e71) {
    switch (e71) {
      case "ground":
        return this._ground;
      case "im":
        return this._im;
      case "scene":
        return this._scene;
    }
  }
  _getElevationQuery(e71 = this.view.spatialReference) {
    const t71 = this._cachedQuery;
    if (null != t71 && G(e71, t71.spatialReference)) return t71;
    t71?.destroy({
      completeTasks: true
    });
    const {
      wkid: s67,
      wkt: r57,
      wkt2: n63,
      latestWkid: o60
    } = e71, i49 = new a23(this.view.resourceController.scheduler, new f2({
      wkid: s67,
      wkt: r57,
      wkt2: n63,
      latestWkid: o60
    }), () => this.view.map?.ground, {
      maximumAutoTileRequests: 4
    });
    return this._cachedQuery = i49, i49;
  }
};
function p34(e71, t71, s67, r57, n63, o60, i49) {
  for (const a59 of t71) {
    const t72 = a59.getElevation(s67, r57, n63, o60, i49);
    null != t72 && (e71 = null != e71 ? Math.max(t72, e71) : t72);
  }
  return e71;
}
e6([y2({
  constructOnly: true
})], h23.prototype, "view", void 0), e6([y2()], h23.prototype, "spatialReference", null), h23 = e6([a4("esri.views.3d.support.CombinedElevationProvider")], h23);

// ../../../node_modules/@arcgis/core/views/3d/support/DisplayQualityProfile.js
var a38 = class _a {
  static isValidProfile(e71) {
    return e71 in _a.profiles;
  }
  static getDefaultProfile() {
    return has("esri-iPhone") ? "low" : "medium";
  }
  static apply(e71, i49) {
    const o60 = _a.profiles[e71];
    i49.graphics3D.maxTotalNumberOfFeatures = o60.graphics3D.maxTotalNumberOfFeatures, i49.graphics3D.maxNumberOfDrawCalls = o60.graphics3D.maxNumberOfDrawCalls, i49.graphics3D.maxTotalNumberOfVertices = o60.graphics3D.maxTotalNumberOfVertices, i49.graphics3D.polygonLodFactor = o60.graphics3D.polygonLodFactor, i49.graphics3D.polylineLodFactor = o60.graphics3D.polylineLodFactor, i49.graphics3D.snapshotAvailable = o60.graphics3D.snapshotAvailable, i49.graphics3D.skipHighSymbolLods = o60.graphics3D.skipHighSymbolLods, i49.graphics3D.uncompressedTextureDownsamplingEnabled = o60.graphics3D.uncompressedTextureDownsamplingEnabled;
    const l47 = i49.sceneService.object, t71 = o60.sceneService.object;
    l47.lodFactor = t71.lodFactor, i49.sceneService.point.lodFactor = o60.sceneService.point.lodFactor, i49.sceneService.integratedMesh.lodFactor = o60.sceneService.integratedMesh.lodFactor, i49.sceneService.pointCloud.lodFactor = o60.sceneService.pointCloud.lodFactor, i49.sceneService.uncompressedTextureDownsamplingEnabled = o60.sceneService.uncompressedTextureDownsamplingEnabled, i49.tiledSurface.lodBias = o60.tiledSurface.lodBias, i49.tiledSurface.angledSplitBias = o60.tiledSurface.angledSplitBias, i49.tiledSurface.vtlContentZoom = o60.tiledSurface.vtlContentZoom, i49.tiledSurface.elevationLevelDelta = o60.tiledSurface.elevationLevelDelta, i49.tiledSurface.reduceTileLevelDifferences = o60.tiledSurface.reduceTileLevelDifferences, i49.heatmap.pixelRatio = o60.heatmap.pixelRatio, i49.heatmap.maxTotalNumberOfFeatures = o60.heatmap.maxTotalNumberOfFeatures, i49.fadeDuration = o60.fadeDuration, i49.antialiasingEnabled = o60.antialiasingEnabled, i49.physicallyBasedRenderingEnabled = o60.physicalBasedRenderingEnabled, i49.highQualityTransparency = o60.highQualityTransparency, i49.highResolutionAtmosphere = o60.highResolutionAtmosphere, i49.reflections = o60.reflections, i49.ambientOcclusion = o60.ambientOcclusion, i49.memoryLimit = o60.memoryLimit, i49.additionalCacheMemory = o60.additionalCacheMemory, i49.frameRate = o60.frameRate, i49.maximumPixelRatio = o60.maximumPixelRatio;
  }
};
a38.test = {
  reset() {
    const e71 = o45();
    for (const i49 of Object.keys(e71)) a38.profiles[i49] = e71[i49];
  }
};
var i36 = {
  IPhone12Pro: 120,
  GalaxyS20: 200,
  FullHD: 240,
  SurfacePro7: 300,
  FullHDRetina: 430
};
function o45() {
  const a59 = !!has("esri-mobile"), o60 = !!has("ios"), l47 = n3(400);
  return {
    low: {
      graphics3D: {
        maxTotalNumberOfFeatures: 25e3,
        maxNumberOfDrawCalls: 8e3,
        maxTotalNumberOfVertices: 255e4,
        polygonLodFactor: 0.5,
        polylineLodFactor: 1,
        snapshotAvailable: false,
        skipHighSymbolLods: true,
        uncompressedTextureDownsamplingEnabled: true
      },
      heatmap: {
        pixelRatio: 0.125,
        maxTotalNumberOfFeatures: 5e4
      },
      sceneService: {
        object: {
          lodFactor: 0.2
        },
        point: {
          lodFactor: 1
        },
        integratedMesh: {
          lodFactor: 0.6
        },
        pointCloud: {
          lodFactor: 0.5
        },
        uncompressedTextureDownsamplingEnabled: true
      },
      tiledSurface: {
        lodBias: -1,
        angledSplitBias: 0.5,
        vtlContentZoom: 0.75,
        elevationLevelDelta: 3,
        reduceTileLevelDifferences: true
      },
      fadeDuration: n3(0),
      antialiasingEnabled: false,
      physicalBasedRenderingEnabled: false,
      highQualityTransparency: false,
      highResolutionAtmosphere: false,
      reflections: false,
      ambientOcclusion: false,
      memoryLimit: 200 + i36.IPhone12Pro,
      additionalCacheMemory: 0,
      frameRate: 0,
      maximumPixelRatio: 1
    },
    medium: {
      graphics3D: {
        maxTotalNumberOfFeatures: 1e5,
        maxNumberOfDrawCalls: 17e3,
        maxTotalNumberOfVertices: 625e4,
        polygonLodFactor: a59 ? 0.8 : 1,
        polylineLodFactor: a59 ? 1.2 : 1.5,
        snapshotAvailable: !o60,
        skipHighSymbolLods: false,
        uncompressedTextureDownsamplingEnabled: a59
      },
      heatmap: {
        pixelRatio: 0.25,
        maxTotalNumberOfFeatures: 13e4
      },
      sceneService: {
        object: {
          lodFactor: 1
        },
        point: {
          lodFactor: 1
        },
        integratedMesh: {
          lodFactor: 1
        },
        pointCloud: {
          lodFactor: 1
        },
        uncompressedTextureDownsamplingEnabled: a59
      },
      tiledSurface: {
        lodBias: 0,
        angledSplitBias: 1,
        vtlContentZoom: 1.5,
        elevationLevelDelta: 3,
        reduceTileLevelDifferences: !has("disable-feature:reduce-map-tile-levels")
      },
      fadeDuration: l47,
      antialiasingEnabled: false,
      physicalBasedRenderingEnabled: true,
      highQualityTransparency: true,
      highResolutionAtmosphere: false,
      reflections: false,
      ambientOcclusion: false,
      memoryLimit: a59 ? 600 + i36.GalaxyS20 : 750 + i36.FullHD,
      additionalCacheMemory: a59 ? -100 : 150,
      frameRate: 0,
      maximumPixelRatio: 1
    },
    high: {
      graphics3D: {
        maxTotalNumberOfFeatures: 1e5,
        maxNumberOfDrawCalls: 17e3,
        maxTotalNumberOfVertices: 125e5,
        polygonLodFactor: a59 ? 1.2 : 2,
        polylineLodFactor: a59 ? 1.2 : 2,
        snapshotAvailable: !o60,
        skipHighSymbolLods: false,
        uncompressedTextureDownsamplingEnabled: false
      },
      heatmap: {
        pixelRatio: 0.5,
        maxTotalNumberOfFeatures: 23e4
      },
      sceneService: {
        object: {
          lodFactor: 1
        },
        point: {
          lodFactor: 1
        },
        integratedMesh: {
          lodFactor: 1
        },
        pointCloud: {
          lodFactor: 1
        },
        uncompressedTextureDownsamplingEnabled: false
      },
      tiledSurface: {
        lodBias: 0,
        angledSplitBias: 1,
        vtlContentZoom: 1.5,
        elevationLevelDelta: 2,
        reduceTileLevelDifferences: !has("disable-feature:reduce-map-tile-levels")
      },
      fadeDuration: l47,
      antialiasingEnabled: true,
      physicalBasedRenderingEnabled: true,
      highQualityTransparency: true,
      highResolutionAtmosphere: true,
      reflections: true,
      ambientOcclusion: true,
      memoryLimit: a59 ? 900 + i36.SurfacePro7 : 1500 + i36.FullHDRetina,
      additionalCacheMemory: a59 ? -150 : 0,
      frameRate: 0,
      maximumPixelRatio: a59 ? 1 : 1 / 0
    }
  };
}
!function(e71) {
  e71.profiles = o45();
}(a38 || (a38 = {}));
var l32 = a38;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/HighlightDefaults.js
var r44 = new u7([0, 255, 255]);
var e50 = 1;
var n43 = 0.25;
var t50 = new u7([0, 0, 0]);
var m31 = 0.4;
var p35 = 0.2;

// ../../../node_modules/@arcgis/core/views/3d/support/HighlightOptions.js
var d28 = class extends S3 {
  constructor() {
    super(...arguments), this.color = r44.clone(), this.haloColor = null, this.haloOpacity = e50, this.fillOpacity = n43, this.shadowOpacity = m31, this.shadowColor = t50.clone(), this.shadowDifference = p35;
  }
};
e6([y2({
  type: u7
})], d28.prototype, "color", void 0), e6([y2({
  type: u7
})], d28.prototype, "haloColor", void 0), e6([y2()], d28.prototype, "haloOpacity", void 0), e6([y2()], d28.prototype, "fillOpacity", void 0), e6([y2()], d28.prototype, "shadowOpacity", void 0), e6([y2({
  type: u7
})], d28.prototype, "shadowColor", void 0), e6([y2()], d28.prototype, "shadowDifference", void 0), d28 = e6([a4("esri.views.3d.support.HighlightOptions")], d28);
var y18 = d28;

// ../../../node_modules/@arcgis/core/views/3d/support/MapCoordsHelper.js
var a39 = class {
  constructor(i49, s67) {
    this.spatialReference = s67, this.unitInMeters = W(this.spatialReference, s6(this.spatialReference).metersPerDegree);
    const m45 = i49 && "portalItem" in i49 ? i49.portalItem : void 0;
    this._geometryServiceURLPromise = n23(m45).catch(() => {
      throw new s("mapcoordshelper:missing-geometry-service", "Must specify geometryService in esri/config");
    });
  }
  toGeographic(e71) {
    return __async(this, null, function* () {
      const r57 = yield this._geometryServiceURLPromise;
      let t71, o60 = true;
      Array.isArray(e71[0]) && "number" != typeof e71[0] ? t71 = e71 : (t71 = [e71], o60 = false);
      const a59 = t71.map((e72) => e72 instanceof _ ? e72 : new _(e72, this.spatialReference)), c44 = new p12({
        geometries: a59,
        outSpatialReference: f2.WGS84
      }), n63 = (yield n22(r57, c44)).map((e72) => "point" === e72.type ? [e72.x, e72.y] : void 0).filter((e72) => !!e72);
      return o60 ? n63 : n63[0];
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/LayerClass.js
var A24;
!function(A32) {
  A32[A32.ELEVATION = 0] = "ELEVATION", A32[A32.MAP = 1] = "MAP";
}(A24 || (A24 = {}));
var E29 = [A24.ELEVATION, A24.MAP];

// ../../../node_modules/@arcgis/core/views/3d/support/popupHitTest.js
function t51(a59, t71) {
  return __async(this, null, function* () {
    const {
      results: o60,
      ground: l47
    } = yield t43(a59, t71), p49 = (!l47.layer || !m5(l47.layer.type)) && l47.mapPoint, y27 = [], c44 = i37(a59), u46 = p49 ? s50(a59, c44) : n44;
    let d38 = 0, f46 = 0;
    const m45 = () => {
      const e71 = u46.layerViews[f46];
      p49 && e71 && "fetchPopupFeaturesAtLocation" in e71 && y27.push({
        mapPoint: l47.mapPoint,
        layerView: e71
      }), ++f46;
    };
    let h32 = null;
    for (; d38 < o60.length || f46 < u46.layerViews.length; ) {
      const e71 = o60[d38];
      if (e71 && "graphic" !== e71.type) ++d38;
      else if ("scene" !== e71?.layer?.type || e71?.layer?.parent !== a59?.map?.basemap) {
        if (e71) {
          const a60 = e71.layer?.uid, r57 = u46.layerUids.has(a60) && e71.distance === l47.distance, t72 = c44.get(e71.layer?.uid);
          if (h32 ??= e71.mapPoint, f46 < u46.layerViews.length && (r57 || (e71.distance ?? 0) > l47.distance) && u46.layerViews[f46] !== t72) {
            m45();
            continue;
          }
          y27.push({
            graphic: e71.graphic,
            layerView: t72
          }), ++d38;
        } else m45();
      } else ++d38;
    }
    return h32 ??= l47.mapPoint, {
      hits: y27,
      location: h32
    };
  });
}
function s50(e71, r57) {
  const t71 = /* @__PURE__ */ new Set(), s67 = [];
  for (let i49 = e71.basemapTerrain.numLayers(A24.MAP) - 1; i49 >= 0; i49--) {
    const r58 = e71.basemapTerrain.layerViewByIndex(i49, A24.MAP);
    t71.add(r58.layer.uid), s67.push(r58);
  }
  const n63 = e71.basemapTerrain.overlayManager.renderer.layers;
  for (const {
    uid: a59
  } of n63) {
    const e72 = r57.get(a59);
    e72 && (t71.add(a59), s67.push(e72));
  }
  return s67.reverse(), {
    layerUids: t71,
    layerViews: s67
  };
}
var n44 = {
  layerUids: /* @__PURE__ */ new Set(),
  layerViews: []
};
function i37(e71) {
  const a59 = /* @__PURE__ */ new Map();
  for (const r57 of e71.allLayerViews) {
    const e72 = r57.layer.uid;
    a59.set(e72, r57);
  }
  return a59;
}

// ../../../node_modules/@arcgis/core/views/3d/support/QualitySettings.js
var r45 = class extends S3 {
  constructor() {
    super(...arguments), this.minTotalNumberOfFeatures = 2e3, this.maxTotalNumberOfFeatures = 5e4, this.maxNumberOfDrawCalls = 17e3, this.maxTotalNumberOfVertices = 17e5, this.snapshotAvailable = true, this.polygonLodFactor = 1, this.polylineLodFactor = 1, this.skipHighSymbolLods = false, this.uncompressedTextureDownsamplingEnabled = false;
  }
};
e6([y2()], r45.prototype, "minTotalNumberOfFeatures", void 0), e6([y2()], r45.prototype, "maxTotalNumberOfFeatures", void 0), e6([y2()], r45.prototype, "maxNumberOfDrawCalls", void 0), e6([y2()], r45.prototype, "maxTotalNumberOfVertices", void 0), e6([y2()], r45.prototype, "snapshotAvailable", void 0), e6([y2()], r45.prototype, "polygonLodFactor", void 0), e6([y2()], r45.prototype, "polylineLodFactor", void 0), e6([y2()], r45.prototype, "skipHighSymbolLods", void 0), e6([y2()], r45.prototype, "uncompressedTextureDownsamplingEnabled", void 0), r45 = e6([a4("esri.views.3d.support.QualitySettings.Graphics3DSettings")], r45);
var p36 = class extends S3 {
  constructor() {
    super(...arguments), this.lodFactor = 1;
  }
};
e6([y2()], p36.prototype, "lodFactor", void 0), p36 = e6([a4("esri.views.3d.support.QualitySettings.LoDFactorSettings")], p36);
var a40 = class extends S3 {
  constructor() {
    super(...arguments), this.object = new p36(), this.point = new p36(), this.integratedMesh = new p36(), this.pointCloud = new p36(), this.uncompressedTextureDownsamplingEnabled = false;
  }
};
e6([y2({
  type: p36
})], a40.prototype, "object", void 0), e6([y2({
  type: p36
})], a40.prototype, "point", void 0), e6([y2({
  type: p36
})], a40.prototype, "integratedMesh", void 0), e6([y2({
  type: p36
})], a40.prototype, "pointCloud", void 0), e6([y2()], a40.prototype, "uncompressedTextureDownsamplingEnabled", void 0), a40 = e6([a4("esri.views.3d.support.QualitySettings.SceneServiceSettings")], a40);
var n45 = class extends S3 {
  constructor() {
    super(...arguments), this.lodBias = 0, this.angledSplitBias = 1, this.vtlContentZoom = 1, this.elevationLevelDelta = 3, this.reduceTileLevelDifferences = true;
  }
};
e6([y2()], n45.prototype, "lodBias", void 0), e6([y2()], n45.prototype, "angledSplitBias", void 0), e6([y2()], n45.prototype, "vtlContentZoom", void 0), e6([y2()], n45.prototype, "elevationLevelDelta", void 0), e6([y2()], n45.prototype, "reduceTileLevelDifferences", void 0), n45 = e6([a4("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")], n45);
var l33 = class extends S3 {
  constructor() {
    super(...arguments), this.pixelRatio = 1, this.maxTotalNumberOfFeatures = 5e4;
  }
};
e6([y2()], l33.prototype, "pixelRatio", void 0), e6([y2()], l33.prototype, "maxTotalNumberOfFeatures", void 0), l33 = e6([a4("esri.views.3d.support.QualitySettings.HeatmapSettings")], l33);
var d29 = class extends S3 {
  constructor() {
    super(...arguments), this.graphics3D = new r45(), this.sceneService = new a40(), this.tiledSurface = new n45(), this.heatmap = new l33(), this.fadeDuration = n3(400), this.antialiasingEnabled = true, this.physicallyBasedRenderingEnabled = false, this.highQualityTransparency = true, this.highResolutionAtmosphere = false, this.reflections = false, this.ambientOcclusion = false, this.memoryLimit = 750, this.additionalCacheMemory = 0, this.frameRate = void 0, this.maximumPixelRatio = 1 / 0;
  }
};
e6([y2({
  type: r45
})], d29.prototype, "graphics3D", void 0), e6([y2({
  type: a40
})], d29.prototype, "sceneService", void 0), e6([y2({
  type: n45
})], d29.prototype, "tiledSurface", void 0), e6([y2({
  type: l33
})], d29.prototype, "heatmap", void 0), e6([y2()], d29.prototype, "fadeDuration", void 0), e6([y2()], d29.prototype, "antialiasingEnabled", void 0), e6([y2()], d29.prototype, "physicallyBasedRenderingEnabled", void 0), e6([y2()], d29.prototype, "highQualityTransparency", void 0), e6([y2()], d29.prototype, "highResolutionAtmosphere", void 0), e6([y2()], d29.prototype, "reflections", void 0), e6([y2()], d29.prototype, "ambientOcclusion", void 0), e6([y2()], d29.prototype, "memoryLimit", void 0), e6([y2()], d29.prototype, "additionalCacheMemory", void 0), e6([y2()], d29.prototype, "frameRate", void 0), e6([y2()], d29.prototype, "maximumPixelRatio", void 0), d29 = e6([a4("esri.views.3d.support.QualitySettings")], d29);
var c37 = d29;

// ../../../node_modules/@arcgis/core/views/3d/support/AsyncWorkerQueue.js
var s51 = class {
  constructor(t71) {
    this.client = t71, this._cancelled = false, this.size = 0, this.duration = 0;
  }
};
var e51 = class {
  constructor(t71) {
    this.typeWorkerQuota = t71, this.tasks = new Array(), this.numWorkers = 0, this.statistics = new i38();
  }
};
var i38 = class {
  constructor() {
    this.requests = 0, this.size = 0, this.duration = 0, this.speed = 0;
  }
};
var r46 = class {
  constructor(t71, s67, i49, r57) {
    this._workerFunc = t71, this._callbackFunc = s67, this._maxTotalNumWorkers = i49, this._totalNumWorkers = 0, this._clients = r57.map((t72) => new e51(t72));
  }
  destroy() {
    this._clients.length = 0;
  }
  hasQuota(t71) {
    const s67 = this._clients[t71];
    return !!s67 && (this._totalNumWorkers < this._maxTotalNumWorkers || s67.numWorkers + s67.tasks.length < s67.typeWorkerQuota);
  }
  push(t71) {
    const s67 = this._clients[t71.client];
    s67 && (this._totalNumWorkers < this._maxTotalNumWorkers ? (s67.numWorkers++, this._totalNumWorkers++, this._workerFunc(t71, (t72, s68) => this._taskCallback(t72, s68))) : s67.tasks.push(t71));
  }
  cancel(t71) {
    this._taskFinished(t71), t71._cancelled = true;
  }
  _taskFinished(s67) {
    const e71 = this._clients[s67.client];
    this._totalNumWorkers--, e71 && (e71.numWorkers--, e71.statistics.requests++, e71.statistics.size += s67.size || 0, e71.statistics.duration += s67.duration || 0, e71.statistics.speed = e71.statistics.duration > 0 ? e71.statistics.size / e71.statistics.duration : 0, s14(e71.numWorkers >= 0)), this._next();
  }
  _next() {
    for (const t71 of this._clients) if (t71 && t71.numWorkers < t71.typeWorkerQuota && this._processQueue(t71)) return;
    for (const t71 of this._clients) if (t71 && this._processQueue(t71)) return;
  }
  _processQueue(t71) {
    for (; t71.tasks.length > 0; ) if (this._workerFunc(t71.tasks.shift(), (t72, s67) => this._taskCallback(t72, s67))) return t71.numWorkers++, this._totalNumWorkers++, true;
    return false;
  }
  _taskCallback(t71, s67) {
    t71._cancelled || (this._callbackFunc(t71, s67), this._taskFinished(t71));
  }
  getStatsForType(t71) {
    const s67 = this._clients[t71];
    return s67 ? {
      quota: s67.typeWorkerQuota,
      workers: s67.numWorkers,
      queueSize: s67.tasks.length,
      requestStats: s67.statistics
    } : null;
  }
  get test() {
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/ImageWithType.js
var e52 = class {
  constructor(e71, t71) {
    this.element = e71, this.type = "image+type", this.isOpaque = "image/jpeg" === t71;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/StreamDataLoader.js
var b15 = class extends S3 {
  constructor() {
    super(...arguments), this._tasks = /* @__PURE__ */ new Map(), this._onLoadQueue = new Array(), this._doneQueue = new Array(), this.updating = false;
  }
  setup(e71, t71, s67) {
    this._loadQueue = new r46((e72, t72) => this._startLoading(e72, t72), (e72, t72) => this._doneLoadingCB(e72, t72), e71, t71), s67 && (this._frameTask = s67.registerTask(I3.STREAM_DATA_LOADER, this));
  }
  destroy() {
    this._frameTask = l(this._frameTask), this._tasks.forEach((e71) => e(e71.abortController)), this._loadQueue = u(this._loadQueue), this._onLoadQueue = null, this._doneQueue = null, this._tasks = null;
  }
  hasDownloadSlots(e71) {
    return this._loadQueue.hasQuota(e71);
  }
  request(e71, t71, s67, r57 = {}) {
    const o60 = L();
    o60.__signal = null != r57 ? r57.signal : null;
    const a59 = this._createOrUpdateTask(e71, t71, s67, r57, o60);
    return m(r57, () => this._cancelRequest(a59, o60)), o60.promise;
  }
  _createTask(e71, t71, s67, r57, o60, a59) {
    const n63 = new O23(e71, t71, s67, r57, o60);
    return this._updateTask(n63, a59), this._tasks.set(o60, n63), 1 === this._tasks.size && this._set("updating", true), this._loadQueue.push(n63), n63;
  }
  _cancelRequest(e71, t71) {
    S(e71.resolvers, t71), t71.reject(u2()), 0 === e71.resolvers.length && (e71.status === Q14.DOWNLOADING && (e71.status = Q14.CANCELLED, this._loadQueue.cancel(e71), e71.abortController?.abort(), e71.request = null, e71.abortController = null), e71.status = Q14.CANCELLED, this._tasks.delete(e71.key), 0 === this._tasks.size && this._set("updating", false));
  }
  _updateTask(e71, t71) {
    e71.resolvers.push(t71);
  }
  _createOrUpdateTask(e71, t71, s67, r57, o60) {
    const a59 = E30(r57?.uid || e71, t71, s67), n63 = this._tasks.get(a59);
    return n63 ? (this._updateTask(n63, o60), n63) : this._createTask(e71, r57, t71, s67, a59, o60);
  }
  _doneLoadingCB(e71, t71) {
    this._loadQueue && (s14(e71.status === Q14.DOWNLOADING), e71.status = Q14.DOWNLOADED, this._frameTask ? this._doneQueue.push({
      task: e71,
      err: t71
    }) : this._doneLoading(e71, t71));
  }
  get running() {
    return this._doneQueue.length > 0 || this._onLoadQueue.length > 0;
  }
  runTask(e71) {
    for (; !e71.done && this._onLoadQueue.length > 0; ) {
      const t71 = this._onLoadQueue.shift();
      s3(t71.task.abortController), t71.task.abortController = null, t71.callback(t71.task), e71.madeProgress();
    }
    for (; !e71.done && this._doneQueue.length > 0; ) {
      const t71 = this._doneQueue.shift();
      t71.task.status !== Q14.DOWNLOADED && (t71.err = t71.err || u2()), this._doneLoading(t71.task, t71.err), e71.madeProgress();
    }
  }
  _doneLoading(e71, t71) {
    if (t71 && !b(t71) && e71.numRetries > 0) return --e71.numRetries, void this._loadQueue.push(e71);
    let s67 = r29(e71.result) || e71.result instanceof HTMLImageElement ? 0 : e71.resolvers.length;
    for (const r57 of e71.resolvers) if (t71) b(t71) ? r57.reject(t71) : r57.reject(new s("stream-data-loader:request-error", `Failed to request resource at '${e71.url}'. ${t71}`, {
      url: e71.url,
      error: t71
    }));
    else {
      --s67;
      const t72 = s67 > 0 ? a2(e71.result) : e71.result;
      r57.resolve(t72);
    }
    this._tasks.delete(e71.key), 0 === this._tasks.size && this._set("updating", false);
  }
  _startLoading(e71, s67) {
    if (e71.status === Q14.CANCELLED) return false;
    let r57, o60;
    switch (e71.startTime = performance.now(), e71.status = Q14.DOWNLOADING, e71.docType) {
      case "binary":
        o60 = "array-buffer", r57 = 0;
        break;
      case "image":
        o60 = "image";
        break;
      case "image+type":
        o60 = "array-buffer";
        break;
      default:
        o60 = "json";
    }
    e71.abortController = new AbortController();
    const a59 = e71.abortController.signal;
    e71.request = U2(e71.url, __spreadProps(__spreadValues({}, e71.options), {
      responseType: o60,
      timeout: r57,
      signal: a59
    }));
    const n63 = (t71) => {
      e71.duration = performance.now() - e71.startTime, e71.size = t71 instanceof ArrayBuffer ? t71.byteLength : e71.size || 0, e71.result = t71, this._frameTask ? this._onLoadQueue.push({
        callback: s67,
        task: e71
      }) : (e71.abortController = null, s67(e71));
    }, i49 = (t71) => {
      e71.status === Q14.DOWNLOADING && s67(e71, t71);
    };
    return "image+type" !== e71.docType ? (e71.request.then((e72) => n63(e72.data), i49), true) : (e71.request.then((s68) => {
      const u46 = s68.data, l47 = A25(u46);
      if (o60 = "image", e71.size = u46.byteLength, "unknown" === l47) return e71.request = U2(e71.url, {
        responseType: o60,
        timeout: r57,
        signal: a59
      }), void e71.request.then((e72) => n63(e72.data), i49);
      const h32 = new Blob([u46], {
        type: l47
      }), c44 = window.URL.createObjectURL(h32);
      e71.request = U2(c44, {
        responseType: o60,
        timeout: r57,
        signal: a59
      }), e71.request.then((e72) => n63(new e52(e72.data, l47)), i49).finally(() => window.URL.revokeObjectURL(c44));
    }, i49), true);
  }
  get test() {
  }
};
e6([y2({
  readOnly: true
})], b15.prototype, "updating", void 0), b15 = e6([a4("esri.views.3d.support.StreamDataLoader")], b15);
var T14 = {
  numRetries: 0
};
function A25(e71) {
  if (e71.byteLength < 2) return "unknown";
  const t71 = new Uint8Array(e71, 0, e71.byteLength);
  return 137 === t71[0] && 80 === t71[1] ? "image/png" : 71 === t71[0] && 73 === t71[1] ? "image/gif" : 66 === t71[0] && 77 === t71[1] ? "image/bmp" : 255 === t71[0] && 216 === t71[1] ? "image/jpeg" : "unknown";
}
var O23 = class extends s51 {
  constructor(e71, t71, s67, r57, o60) {
    super(r57), this.url = e71, this.options = t71, this.docType = s67, this.key = o60, this.result = null, this.status = Q14.QUEUED, this.request = null, this.abortController = null, this.resolvers = new Array(), this.startTime = 0, this.numRetries = T14.numRetries;
  }
};
function E30(e71, t71, s67) {
  return `${e71}:${t71}:${s67}`;
}
var Q14;
!function(e71) {
  e71[e71.QUEUED = 1] = "QUEUED", e71[e71.DOWNLOADING = 2] = "DOWNLOADING", e71[e71.DOWNLOADED = 3] = "DOWNLOADED", e71[e71.CANCELLED = 4] = "CANCELLED";
}(Q14 || (Q14 = {}));

// ../../../node_modules/@arcgis/core/views/3d/support/ResourceController.js
var f32 = class extends S3 {
  constructor() {
    super(...arguments), this.updating = false;
  }
};
function j13(e71) {
  return new T15({
    view: e71
  });
}
e6([y2({
  readOnly: true
})], f32.prototype, "updating", void 0), f32 = e6([a4("esri.views.3d.support.ResourceController.ResourceControllerMain")], f32);
var T15 = class extends f32 {
  constructor() {
    super(...arguments), this._immediateTask = F2, this._normalTask = F2, this._updatingObjects = r12([]), this._frameTask = null;
  }
  get immediate() {
    return this._immediateTask;
  }
  get normal() {
    return this._normalTask;
  }
  initialize() {
    this._scheduler = g5(), this._memoryController = d12(this.view), this._streamDataLoader = new b15(), this._streamDataLoader.setup(I7, E19, this._scheduler), this.addHandles([d2(() => this.view.state?.mode, (e71) => {
      null != e71 && (this._scheduler.state = e71);
    }, C), d2(() => this.view.stationary, () => this._stationaryChangedHandler())]), this._frameTask = A2({
      update: (e71) => this._frame(e71)
    }), this._immediateTask = this._scheduler.registerTask(I3.RESOURCE_CONTROLLER_IMMEDIATE), this._normalTask = this._scheduler.registerTask(I3.RESOURCE_CONTROLLER);
  }
  destroy() {
    this._immediateTask.remove(), this._normalTask.remove(), this._frameTask = l(this._frameTask), this._streamDataLoader = u(this._streamDataLoader), this._memoryController = u(this._memoryController), this._scheduler = u(this._scheduler), this.view = null;
  }
  get updating() {
    return !!(this._memoryController?.updating || this._streamDataLoader?.updating || this._immediateTask?.updating) || this._updatingObjects?.value.some((e71) => e71.updating);
  }
  get scheduler() {
    return this._scheduler;
  }
  get memoryController() {
    return this._memoryController;
  }
  createStreamDataRequester(e71) {
    const t71 = this._streamDataLoader;
    return {
      request: (r57, s67, o60) => t71.request(r57, s67, e71, o60),
      get busy() {
        return !t71.hasDownloadSlots(e71);
      }
    };
  }
  addUpdatingObject(e71) {
    const t71 = this._updatingObjects;
    return t71.value = [...t71.value, e71], e2(() => {
      t71.value = t71.value.filter((t72) => t72 !== e71);
    });
  }
  _frame(e71) {
    this.view.suspended || this.view.stateManager && (this.view.stateManager.step(u3(e71.deltaTime)), !this._scheduler) || (this._memoryController.update(), this._scheduler.updateBudget(e71) && this._scheduler.frame());
  }
  _stationaryChangedHandler() {
    this.memoryController.resetStableQuality();
  }
  get test() {
  }
};
e6([y2()], T15.prototype, "view", void 0), e6([y2()], T15.prototype, "_scheduler", void 0), e6([y2()], T15.prototype, "_memoryController", void 0), e6([y2()], T15.prototype, "_streamDataLoader", void 0), e6([y2()], T15.prototype, "_immediateTask", void 0), e6([y2()], T15.prototype, "_normalTask", void 0), e6([y2()], T15.prototype, "_updatingObjects", void 0), e6([y2({
  readOnly: true
})], T15.prototype, "updating", null), T15 = e6([a4("esri.views.3d.support.ResourceController")], T15);

// ../../../node_modules/@arcgis/core/views/3d/support/LayerPerformanceInfo.js
var e53 = class {
  constructor(e71) {
    this.layer = null, this.memory = 0, this.displayedNumberOfFeatures = 0, this.maximumNumberOfFeatures = null, this.totalNumberOfFeatures = null, this.layer = e71.layer;
    const t71 = e71.performanceInfo;
    this.memory = t71.usedMemory, this.displayedNumberOfFeatures = t71.displayedFeatures, this.maximumNumberOfFeatures = t71.maximumFeatures, this.totalNumberOfFeatures = t71.totalFeatures;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/SceneViewPerformanceInfo.js
var s52 = class {
  constructor(s67) {
    if (this.totalMemory = 0, this.usedMemory = 0, this.quality = 1, this.load = 0, this.terrainMemory = 0, this.edgesMemory = 0, this.layerPerformanceInfos = new Array(), this.cachedMemory = 0, this.fboMemory = 0, null != s67.resourceController) {
      const r57 = s67.resourceController.memoryController;
      this.totalMemory = (r57.maxMemory ?? 0) * E9.MEGABYTES, this.usedMemory = Math.round(r57.usedMemory * this.totalMemory), this.quality = s67.quality, this.load = s67.resourceController.scheduler.load, this.cachedMemory = r57.usedCacheMemory;
    }
    this.terrainMemory = s67.basemapTerrain?.usedMemory ?? 0, this.edgesMemory = s67._stage?.renderer.usedMemory.edges ?? 0, this.fboMemory = s67._stage?.renderer.usedMemory.fbos ?? 0, s67.allLayerViews?.items.forEach((e71) => {
      e31(e71) && this.layerPerformanceInfos.push(new e53(e71));
    }), this.layerPerformanceInfos.sort((e71, r57) => r57.memory - e71.memory);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/graphics/ObjectResourceCache.js
var a41 = class {
  constructor(t71) {
    this._gltfLoading = /* @__PURE__ */ new Map(), this._wosrLoading = /* @__PURE__ */ new Map(), this._gltfMemCache = t71("gltf-resources", () => {
    }), this._wosrMemCache = t71("wosr-resources", () => {
    });
  }
  destroy() {
    this._gltfLoading.forEach((t71) => t71.abortController.abort()), this._wosrLoading.forEach((t71) => t71.abortController.abort()), this._gltfMemCache.destroy(), this._wosrMemCache.destroy();
  }
  loadGLTF(t71, o60, e71) {
    const l47 = e71 ? `gltfPBR:${t71}` : `gltf:${t71}`, a59 = this._gltfMemCache.get(l47);
    return null != a59 ? Promise.resolve(a59) : i39(this._gltfLoading, this._gltfMemCache, l47, (o61) => l11(new n18(o61.streamDataRequester), t71, o61, e71), o60);
  }
  loadWOSR(t71, o60) {
    const e71 = `wosr:${t71}:${o60.disableTextures}`, r57 = this._wosrMemCache.get(e71);
    return null != r57 ? Promise.resolve(r57) : i39(this._wosrLoading, this._wosrMemCache, e71, (o61) => A8(t71, o61), o60);
  }
};
function i39(r57, s67, l47, a59, i49) {
  return __async(this, null, function* () {
    s3(i49);
    const f46 = m(i49, () => n46(r57, l47));
    let c44 = r57.get(l47);
    if (c44) c44.refCount++;
    else {
      const t71 = new AbortController();
      c44 = {
        refCount: 1,
        abortController: t71,
        promise: a59(__spreadProps(__spreadValues({}, i49), {
          signal: t71.signal
        }))
      }, r57.set(l47, c44);
    }
    try {
      const t71 = yield c44.promise;
      return s67.put(l47, t71, t71.size), r57.delete(l47), s3(i49), t71;
    } finally {
      l(f46);
    }
  });
}
function n46(t71, o60) {
  const e71 = t71.get(o60);
  if (null != e71) {
    if (--e71.refCount > 0) return;
  }
  t71.delete(o60), null != e71 && e71.abortController.abort();
}

// ../../../node_modules/@arcgis/core/views/3d/support/TextureCollection.js
var i40 = class extends S3 {
  constructor(e71, t71) {
    super({}), this._stage = e71, this._textureRequests = /* @__PURE__ */ new Map(), this._frameTask = t71?.registerTask(I3.TEXTURE_UNLOAD) ?? F2;
  }
  normalizeCtorArgs() {
    return {};
  }
  destroy() {
    super.destroy(), this._frameTask?.remove(), this._textureRequests?.forEach((e71) => this._releaseTextureRequest(e71)), this._textureRequests?.clear();
  }
  get updating() {
    return this._frameTask.updating;
  }
  fromData(e71, t71) {
    const r57 = this.makeUid(e71);
    let s67 = this._textureRequests.get(r57);
    if (!s67) {
      const e72 = new a42();
      e72.texture = t71(), this._stage && (e72.texture.load(this._stage.renderView.renderingContext), this._stage.add(e72.texture)), this._textureRequests.set(r57, e72), s67 = e72;
    }
    return s67.referenceCount++, new n47(r57, s67.texture, () => this._release(r57));
  }
  _release(e71) {
    const t71 = this._textureRequests.get(e71);
    t71 ? (t71.referenceCount < 1 && console.warn("TextureCollection: reference count is < 1 for " + e71), t71.referenceCount--, t71.referenceCount < 1 && this._frameTask.schedule(() => this._releaseNow(e71))) : console.warn(`TextureCollection: texture doesn't exist: '${e71}'`);
  }
  get test() {
  }
  _releaseNow(e71) {
    if (!this._textureRequests) return;
    const t71 = this._textureRequests.get(e71);
    !t71 || t71.referenceCount > 0 || (t71.texture?.unload(), this._releaseTextureRequest(t71), this._textureRequests.delete(e71));
  }
  _releaseTextureRequest(e71) {
    e71.texture ? this._stage?.remove(e71.texture) : e71.abortController && (e71.abortController.abort(), e71.abortController = null);
  }
  makeUid(e71, t71 = null) {
    return null != t71 ? `${e71}.${t71}px` : e71;
  }
};
e6([y2()], i40.prototype, "_frameTask", void 0), e6([y2()], i40.prototype, "updating", null), i40 = e6([a4("esri.views.3d.support.TextureCollection")], i40);
var n47 = class {
  constructor(e71, t71, r57) {
    this.uid = e71, this.texture = t71, this.release = r57;
  }
};
var a42 = class {
  constructor() {
    this.referenceCount = 0;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/StreamTextureCollection.js
var a43 = class extends i40 {
  constructor(e71, t71, r57) {
    super(t71, r57), this._streamDataRequester = e71;
  }
  fromUrl(r57, s67, n63) {
    return __async(this, null, function* () {
      s3(n63);
      const l47 = n63?.signal, a59 = this.makeUid(r57, s67);
      let h32 = this._textureRequests.get(a59);
      if (!h32) {
        const e71 = new AbortController(), t71 = this._streamDataRequester.request(r57, "image", {
          uid: a59,
          signal: e71.signal
        });
        h32 = new a42(), h32.abortController = e71;
        const n64 = h32;
        this._textureRequests.set(a59, h32), h32.textureAsync = t71.then((e72) => __async(this, null, function* () {
          const t72 = this._createTexture(r57, e72, s67);
          return n64.texture = t72, n64.abortController = null, yield t72.load(this._stage.renderView.renderingContext), this._stage.add(t72), new n47(a59, t72, () => this._release(a59));
        }), (e72) => {
          throw n64.abortController = null, e72;
        });
      }
      h32.referenceCount++;
      try {
        return yield h2(h32.textureAsync, l47);
      } catch (u46) {
        throw this._release(a59), u46;
      }
    });
  }
  _createTexture(e71, t71, s67) {
    const i49 = {
      width: t71.width,
      height: t71.height,
      wrap: {
        s: D2.CLAMP_TO_EDGE,
        t: D2.CLAMP_TO_EDGE
      },
      preMultiplyAlpha: true,
      reloadable: true
    };
    if (Pt(e71)) {
      if (s67 || 0 === t71.width && 0 === t71.height) {
        const e72 = t71.width ? t71.height / t71.width : 1;
        s67 = s67 || 64, e72 > 1 ? (t71.width = Math.round(s67 / e72), t71.height = s67) : (t71.width = s67, t71.height = Math.round(s67 * e72));
      }
      this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result && (i49.preMultiplyAlpha = false);
    }
    return new N3(t71, i49);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/SharedSymbolResources.js
var S18 = class {
  constructor(e71) {
    this.streamDataRequester = null, this._graphicsOwners = [], this._screenSizePerspectiveHandles = null, this.cimSymbolRasterizer = null, this._viewState = e71.viewState, this._view = e71.view, this._pointsOfInterest = e71.pointsOfInterest, this.streamDataRequester = e71.resourceController.createStreamDataRequester(A11.SYMBOLOGY), this.objectResourceCache = new a41((t72, s67) => e71.resourceController.memoryController.newCache(t72, s67)), this.textures = new a43(this.streamDataRequester, e71.view._stage, e71.resourceController.scheduler);
    const t71 = s6(this._view.spatialReference).radius;
    this.screenSizePerspectiveSettings = n21(e71.viewingMode, t71), this.screenSizePerspectiveSettingsLabels = i12(e71.viewingMode, t71);
  }
  destroy() {
    this.textures.destroy(), this.streamDataRequester = null;
  }
  addGraphicsOwner(t71) {
    if (!t71) return e2();
    this._graphicsOwners.push(t71);
    const r57 = d2(() => t71.layer?.screenSizePerspectiveEnabled, () => this._updateScreenSizePerspectiveEnabled());
    return this._updateScreenSizePerspectiveEnabled(), e2(() => {
      r57.remove(), S(this._graphicsOwners, t71), this._updateScreenSizePerspectiveEnabled();
    });
  }
  _updateScreenSizePerspectiveEnabled() {
    const e71 = this._graphicsOwners.some((e72) => true === e72.layer?.screenSizePerspectiveEnabled);
    if (e71 && !this._screenSizePerspectiveHandles) {
      this._screenSizePerspectiveHandles = new r();
      const e72 = () => this._updateScreenSizePerspectiveSettings();
      this._screenSizePerspectiveHandles.add([d2(() => this._pointsOfInterest.centerOnSurfaceInfrequent.distance, e72, C), this._viewState.events.on("camera-projection-changed", e72)]), this._updateScreenSizePerspectiveSettings();
    } else e71 || (this._screenSizePerspectiveHandles = u(this._screenSizePerspectiveHandles));
  }
  _updateScreenSizePerspectiveSettings() {
    const e71 = this._pointsOfInterest;
    d30.distance = e71.centerOnSurfaceInfrequent.distance, d30.fovY = this._viewState.camera.fovY, this.screenSizePerspectiveSettings.update(d30), this.screenSizePerspectiveSettingsLabels.update(d30), this._view._stage.renderView.requestRender();
  }
  get test() {
  }
};
var d30 = {
  distance: 0,
  fovY: 0
};

// ../../../node_modules/@arcgis/core/views/3d/support/debugUtils.js
var m32 = class {
  constructor(o60, t71, m45 = "") {
    this.graphics = o60, this._symbol = new w4({
      symbolLayers: new V([new j4({
        material: {
          color: t71
        },
        outline: {
          color: [255, 255, 255],
          size: 1
        },
        resource: {
          primitive: "circle"
        }
      }), new z3({
        text: m45,
        halo: {
          color: "white",
          size: 1 / 0.75
        },
        material: {
          color: t71
        },
        size: 12
      })])
    });
  }
  show(r57, i49) {
    if (null == i49) return;
    this.hide();
    const s67 = new _({
      x: r57[0],
      y: r57[1],
      z: r57[2],
      spatialReference: i49
    });
    this._graphic = new d6({
      geometry: s67,
      symbol: this._symbol
    }), this.graphics.add(this._graphic);
  }
  hide() {
    null != this._graphic && (this.graphics.remove(this._graphic), this._graphic = null);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/PointOfInterest.js
var e54 = class extends S3 {
  constructor(o60) {
    super(o60);
  }
};
e6([y2({
  constructOnly: true
})], e54.prototype, "renderCoordsHelper", void 0), e6([y2({
  constructOnly: true
})], e54.prototype, "surface", void 0), e6([y2({
  constructOnly: true
})], e54.prototype, "state", void 0), e54 = e6([a4("esri.views.3d.support.pointsOfInterest.PointOfInterest")], e54);

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/CameraOnSurface.js
var g20 = Array;
var y19 = class extends e54 {
  constructor(t71) {
    super(t71), this._dirty = false, this._propertiesPool = new o21({
      location: _,
      renderLocation: g20
    }, this), this._estimatedSurfaceAltitude = 0, this._pendingElevationQueryController = null, this.renderLocation = n7(), this._tmpPoint = new _();
  }
  initialize() {
    if (this.scheduler && this.addHandles(this.scheduler.registerTask(this.task, this)), this.runTask(), this.map) {
      const t71 = () => this._setDirty();
      this.addHandles(v2(() => this.map?.ground?.layers, "change", t71, {
        onListenerAdd: t71,
        onListenerRemove: t71
      }));
    }
    this._updateRenderLocation();
  }
  destroy() {
    this._cancelPendingRequest(), this._propertiesPool = u(this._propertiesPool);
  }
  get _camera() {
    return this.state.contentCamera;
  }
  get location() {
    const t71 = this._propertiesPool.get("location");
    return t71.spatialReference = this.state.spatialReference, this.renderCoordsHelper.fromRenderCoords(this.renderLocation, t71), t71;
  }
  get scale() {
    const t71 = this._camera, e71 = x(t71.eye, this.renderLocation), r57 = {
      renderCoordsHelper: this.renderCoordsHelper,
      state: {
        camera: t71
      }
    };
    return _11(r57, e71, 0);
  }
  get updating() {
    return this._dirty || null != this._pendingElevationQueryController;
  }
  updateRenderLocation() {
    this._setDirty(), this._updateRenderLocation();
  }
  _setDirty() {
    this._dirty || (this._dirty = true, this.notifyChange("updating"));
  }
  _cancelPendingRequest() {
    const t71 = this._pendingElevationQueryController;
    t71 && (this._pendingElevationQueryController = null, t71.abort(), this.notifyChange("updating"));
  }
  get running() {
    return !this._pendingElevationQueryController && this._dirty;
  }
  runTask() {
    if (this._cancelPendingRequest(), this._dirty = false, this.notifyChange("updating"), !this.map?.ground) return this._updateSurfaceAltitude(0), o12;
    const t71 = this.state.spatialReference;
    this._tmpPoint.spatialReference = t71, this.renderCoordsHelper.fromRenderCoords(this._camera.eye, this._tmpPoint);
    const e71 = (this._tmpPoint.z ?? 0) > C18 && this.renderCoordsHelper.viewingMode === l9.Global && (t71.isWGS84 || t71.isWebMercator);
    let o60 = new AbortController();
    return this.map.ground.queryElevation(this._tmpPoint, {
      signal: o60.signal,
      cache: this.cache,
      minDemResolution: e71 ? v21 : 0
    }).then((t72) => this._updateSurfaceAltitude(t72.geometry.z ?? 0)).catch((t72) => {
      b(t72) || this._updateSurfaceAltitude(0);
    }).catch(() => {
    }).then(() => {
      this._pendingElevationQueryController === o60 && (this._pendingElevationQueryController = null, this.notifyChange("updating")), o60 = null;
    }), this._pendingElevationQueryController = o60, o12;
  }
  _updateSurfaceAltitude(t71) {
    this._estimatedSurfaceAltitude !== t71 && (this._estimatedSurfaceAltitude = t71, this._updateRenderLocation());
  }
  _updateRenderLocation() {
    this.renderCoordsHelper.setAltitude(f33, this._estimatedSurfaceAltitude, this._camera.eye), G2(this._get("renderLocation"), f33) || (this._set("renderLocation", r5(this._propertiesPool.get("renderLocation"), f33)), this.notifyChange("renderLocation"));
  }
};
e6([y2({
  constructOnly: true
})], y19.prototype, "scheduler", void 0), e6([y2({
  constructOnly: true
})], y19.prototype, "cache", void 0), e6([y2({
  constructOnly: true
})], y19.prototype, "task", void 0), e6([y2()], y19.prototype, "location", null), e6([y2({
  constructOnly: true
})], y19.prototype, "map", void 0), e6([y2()], y19.prototype, "renderLocation", void 0), e6([y2()], y19.prototype, "scale", null), e6([y2()], y19.prototype, "updating", null), y19 = e6([a4("esri.views.3d.support.pointsOfInterest.CameraOnSurface")], y19);
var f33 = n7();
var C18 = 1e5;
var v21 = 1e6;

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/CenterOnSurface.js
var j14 = Array;
var L18 = class extends e54 {
  constructor(t71) {
    super(t71), this._propertiesPool = new o21({
      location: _,
      renderLocation: j14
    }, this), this._currentSurfaceAltitude = 0, this._latestSurfaceAltitude = 0, this.distance = 0, this.renderLocation = n7(), this.updating = false;
  }
  initialize() {
    this._frameWorker = this.scheduler.registerTask(this.task, this), this.runTask();
  }
  destroy() {
    this._frameWorker = l(this._frameWorker), this._propertiesPool = u(this._propertiesPool);
  }
  get _camera() {
    return this.state.contentCamera;
  }
  get location() {
    const t71 = this._propertiesPool.get("location");
    return t71.spatialReference = this.state.spatialReference, this.renderCoordsHelper.fromRenderCoords(this.renderLocation, t71), t71;
  }
  updateRenderLocation() {
    this.updating = true, this._updateRenderLocation();
  }
  get estimatedSurfaceAltitude() {
    return this._latestSurfaceAltitude;
  }
  get running() {
    return this.updating;
  }
  runTask() {
    return this._latestSurfaceAltitude = this.estimateSurfaceAltitudeAtCenter(), this._updateRenderLocation(), this.updating = false, o12;
  }
  _updateRenderLocation() {
    const t71 = C19;
    let e71 = this._calculateSurfaceIntersection(this._currentSurfaceAltitude, t71);
    const r57 = this._currentSurfaceAltitude !== this._latestSurfaceAltitude;
    !e71 && r57 && (e71 = this._calculateSurfaceIntersection(this._latestSurfaceAltitude, t71), e71 && (this._currentSurfaceAltitude = this._latestSurfaceAltitude));
    const s67 = v22;
    e71 && this._latestSurfaceAltitudeChangesDistanceSignificantly(t71, s67) && (r5(t71, s67), this._currentSurfaceAltitude = this._latestSurfaceAltitude), e71 ? this.distance = x(this._camera.eye, t71) : (g3(t71, this._camera.viewForward, this._get("distance")), u5(t71, t71, this._camera.eye)), G2(this._get("renderLocation"), t71) || this._set("renderLocation", r5(this._propertiesPool.get("renderLocation"), t71));
  }
  _calculateSurfaceIntersection(t71, r57) {
    const s67 = this._camera;
    if (!this.renderCoordsHelper.intersectInfiniteManifold(s67.ray, t71, r57)) return false;
    if (this.state.isGlobal) {
      const e71 = s6(this.renderCoordsHelper.spatialReference).radius, i49 = e71 + t71, o60 = v3(s67.eye), a59 = o60 < i49 * i49, l47 = x(s67.eye, r57);
      if (a59 && l47 > e71 / 4) {
        const t72 = i49 - Math.sqrt(o60);
        return g3(r57, s67.viewForward, t72), u5(r57, r57, s67.eye), true;
      }
    } else {
      const t72 = this.surface?.ready ? this.surface.extent : null;
      null != t72 && i16(t72, this.surface?.spatialReference, I19, this.renderCoordsHelper.spatialReference) && (r57[0] = e12(r57[0], I19[0], I19[2]), r57[1] = e12(r57[1], I19[1], I19[3]));
    }
    return true;
  }
  _latestSurfaceAltitudeChangesDistanceSignificantly(t71, e71) {
    if (this._latestSurfaceAltitude === this._currentSurfaceAltitude || null == t71) return false;
    if (this._calculateSurfaceIntersection(this._latestSurfaceAltitude, e71)) {
      if (t19.TESTS_DISABLE_OPTIMIZATIONS) return true;
      const r57 = this._camera.eye, s67 = x(r57, t71), i49 = x(r57, e71);
      if (Math.abs(i49 - s67) / s67 > R8) return true;
    }
    return false;
  }
};
e6([y2({
  constructOnly: true
})], L18.prototype, "scheduler", void 0), e6([y2({
  constructOnly: true
})], L18.prototype, "task", void 0), e6([y2()], L18.prototype, "distance", void 0), e6([y2({
  constructOnly: true
})], L18.prototype, "estimateSurfaceAltitudeAtCenter", void 0), e6([y2({
  readOnly: true
})], L18.prototype, "location", null), e6([y2({
  readOnly: true
})], L18.prototype, "renderLocation", void 0), e6([y2()], L18.prototype, "updating", void 0), L18 = e6([a4("esri.views.3d.support.pointsOfInterest.CenterOnSurface")], L18);
var R8 = 0.05;
var C19 = n7();
var v22 = n7();
var I19 = u6();

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/ContentGeometryUpdates.js
var n48 = class {
  constructor(s67) {
    this._handles = new r(), this.events = new o3(), this._contentLayerViews = s67.contentLayerViews, this._handles.add(this._contentLayerViews.on("change", (e71) => this._layerViewsChanged(e71))), this._layerViewsChanged({
      added: this._contentLayerViews.toArray(),
      removed: [],
      moved: [],
      target: this._contentLayerViews
    });
  }
  destroy() {
    this._handles = u(this._handles), this._contentLayerViews.destroy();
  }
  _layerViewsChanged(e71) {
    e71.added.forEach((e72) => {
      "esri.views.3d.layers.SceneLayerView3D" === e72.declaredClass && this._handles.add(e72.on("visible-geometry-changed", () => this._contentChanged()), e72.uid);
    }), e71.removed.forEach((e72) => this._handles.remove(e72.uid));
  }
  _contentChanged() {
    this.events.emit("request-update", a44);
  }
};
var a44 = {};

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/Focus.js
var L19 = Array;
var O24 = class extends e54 {
  constructor(e71) {
    super(e71), this._propertiesPool = new o21({
      location: _,
      renderLocation: L19
    }, this), this._dirty = true, this.renderLocation = this._propertiesPool.get("renderLocation");
  }
  initialize() {
    this.addHandles([d2(() => this.centerOnSurface.renderLocation, () => this.updateRenderLocation()), d2(() => this.state.contentCamera, () => this.updateRenderLocation())]), this.scheduler && this.addHandles(this.scheduler.registerTask(I3.POINT_OF_INTEREST_FREQUENT, this));
  }
  destroy() {
    this._propertiesPool = u(this._propertiesPool);
  }
  get updating() {
    return this._dirty || this.centerOnSurface.updating;
  }
  get location() {
    const e71 = this._propertiesPool.get("location");
    return e71.spatialReference = this.state.spatialReference, this.renderCoordsHelper.fromRenderCoords(this.renderLocation, e71), e71;
  }
  get worldUnitsPerContentPixel() {
    const {
      camera: e71,
      contentPixelRatio: t71
    } = this.state;
    return e71.computeRenderPixelSizeAt(this.renderLocation) * (e71.pixelRatio / t71);
  }
  get running() {
    return this._dirty;
  }
  runTask() {
    const e71 = this._get("renderLocation"), r57 = this.centerOnSurface.renderLocation, o60 = this.renderCoordsHelper, i49 = this.state.contentCamera;
    this._dirty = false, o60.worldUpAtPosition(r57, S19);
    const s67 = Math.max(0, (Math.acos(P3(S19, i49.viewForward)) - 0.5 * Math.PI) * (i49.aboveGround ? 1 : -1));
    if (Number.isNaN(s67)) {
      if (!e71 || !H(e71, r57)) {
        const e72 = this._propertiesPool.get("renderLocation");
        r5(e72, r57), this._set("renderLocation", e72);
      }
      return o12;
    }
    const n63 = 1 - e12(s67 / (0.5 * Math.PI), 0, 1), l47 = n63 * n63 * n63;
    this._calculateScreenHorizontalEdgeOnSurface(C20);
    const u46 = this._propertiesPool.get("renderLocation");
    return A4(u46, r57, C20, l47), e71 && H(e71, u46) || this._set("renderLocation", u46), o12;
  }
  _calculateScreenHorizontalEdgeOnSurface(e71) {
    const t71 = this.state.contentCamera, r57 = t71.getRenderCenter(x3());
    if (r57[1] = t71.aboveGround ? t71.padding[t33.BOTTOM] : t71.fullHeight - t71.padding[t33.TOP], this.estimateSurfaceIntersectionAtRenderPoint(r57, e71)) return e71;
    const o60 = this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);
    if (t71.unprojectFromRenderScreen(r57, R9)) {
      e11(R9, R9, t71.eye);
      const r58 = z(R9, R9);
      if (this.renderCoordsHelper.intersectInfiniteManifold(l8(t71.eye, r58), o60, e71)) return e71;
    }
    return this.renderCoordsHelper.setAltitude(e71, o60, t71.eye);
  }
  updateRenderLocation() {
    this._dirty = true;
  }
};
e6([y2()], O24.prototype, "_dirty", void 0), e6([y2({
  constructOnly: true
})], O24.prototype, "scheduler", void 0), e6([y2({
  constructOnly: true
})], O24.prototype, "centerOnSurface", void 0), e6([y2({
  constructOnly: true
})], O24.prototype, "estimateSurfaceIntersectionAtRenderPoint", void 0), e6([y2()], O24.prototype, "updating", null), e6([y2()], O24.prototype, "location", null), e6([y2()], O24.prototype, "renderLocation", void 0), e6([y2()], O24.prototype, "worldUnitsPerContentPixel", null), O24 = e6([a4("esri.views.3d.support.pointsOfInterest.Focus")], O24);
var S19 = n7();
var R9 = n7();
var C20 = n7();

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/StableSurfaceCenter.js
var c38 = class extends S3 {
  get surface() {
    return this.view.map?.ground;
  }
  get surfaceView() {
    return this.view.basemapTerrain;
  }
  get renderLocation() {
    if (!this.location) return null;
    const e71 = n7();
    return this.view.renderCoordsHelper.toRenderCoords(this.location, e71), e71;
  }
  constructor(e71) {
    super(e71), this.location = null, this._updateController = null;
  }
  initialize() {
    this.view.state.isLocal && (this.addHandles([d2(() => [this.surfaceView?.spatialReference, this.surfaceView?.extent], () => this._update()), v2(() => this.surface?.layers, "change", () => this._update())]), this._update());
  }
  _update() {
    if (this._updateController && (this._updateController.abort(), this._updateController = null), null == this.surfaceView?.extent || null == this.surfaceView.spatialReference) return void this._set("location", null);
    const e71 = p5(this.surfaceView.extent), t71 = new _({
      x: e71[0],
      y: e71[1],
      z: 0,
      spatialReference: this.surfaceView.spatialReference
    });
    this.surface && this.surface.layers.length > 0 ? (this._set("location", null), this._updateController = new AbortController(), this.surface.queryElevation(t71, {
      noDataValue: 0,
      signal: this._updateController.signal,
      cache: this.cache
    }).then((e72) => {
      this._updateController = null, this._set("location", e72.geometry);
    }).catch((e72) => {
    })) : this._set("location", t71);
  }
};
e6([y2({
  constructOnly: true
})], c38.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], c38.prototype, "cache", void 0), e6([y2()], c38.prototype, "surface", null), e6([y2()], c38.prototype, "surfaceView", null), e6([y2({
  readOnly: true
})], c38.prototype, "location", void 0), e6([y2({
  readOnly: true
})], c38.prototype, "renderLocation", null), c38 = e6([a4("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")], c38);

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates.js
var u33 = class extends S3 {
  constructor(e71) {
    super(e71), this._tileGeometryUpdateExtent = D(), this._tileGeometryUpdateSpatialReference = null, this.events = new o3(), this.updating = false;
  }
  initialize() {
    this.addHandles([this.surface.on("elevation-change", (e71) => this._tileGeometryChanged(e71)), this.scheduler.registerTask(I3.SURFACE_GEOMETRY_UPDATES, this)]);
  }
  get running() {
    return this.updating;
  }
  runTask() {
    return this.updating ? (this._tileGeometryUpdateSpatialReference && this._centerIntersectsExtent(this._tileGeometryUpdateExtent, this._tileGeometryUpdateSpatialReference) && this.events.emit("request-update", l34), D(this._tileGeometryUpdateExtent), this._set("updating", false), o12) : o12;
  }
  _tileGeometryChanged(e71) {
    this._tileGeometryUpdateSpatialReference = e71.spatialReference, m4(this._tileGeometryUpdateExtent, e71.extent, this._tileGeometryUpdateExtent), this._set("updating", true);
  }
  _furthestCenterOnSurface() {
    let e71 = this.centerOnSurfaces[0];
    for (let t71 = 1; t71 < this.centerOnSurfaces.length; t71++) {
      const r57 = this.centerOnSurfaces[t71];
      r57.distance > e71.distance && (e71 = r57);
    }
    return e71;
  }
  _centerIntersectsExtent(e71, t71) {
    const r57 = this.state.contentCamera.eye, s67 = f34, o60 = this._furthestCenterOnSurface();
    return this.renderCoordsHelper.fromRenderCoords(r57, h24, t71), this.renderCoordsHelper.fromRenderCoords(o60.renderLocation, m33, t71), h24[0] < m33[0] ? (s67[0] = h24[0], s67[2] = m33[0]) : (s67[0] = m33[0], s67[2] = h24[0]), h24[1] < m33[1] ? (s67[1] = h24[1], s67[3] = m33[1]) : (s67[1] = m33[1], s67[3] = h24[1]), E3(s67, e71);
  }
};
e6([y2({
  constructOnly: true
})], u33.prototype, "state", void 0), e6([y2({
  constructOnly: true
})], u33.prototype, "centerOnSurfaces", void 0), e6([y2({
  constructOnly: true
})], u33.prototype, "renderCoordsHelper", void 0), e6([y2({
  constructOnly: true
})], u33.prototype, "scheduler", void 0), e6([y2({
  constructOnly: true
})], u33.prototype, "surface", void 0), e6([y2({
  readOnly: true
})], u33.prototype, "updating", void 0), u33 = e6([a4("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")], u33);
var l34 = {};
var h24 = n7();
var m33 = n7();
var f34 = D();

// ../../../node_modules/@arcgis/core/views/3d/support/pointsOfInterest/PointsOfInterest.js
var P13 = class extends S3 {
  constructor(e71) {
    super(e71), this.renderPointOfView = n7(), this._pois = new Array(), this._debugCenters = /* @__PURE__ */ new Map(), this._tmpRay = m7(), this._centerRayDirty = true, this._surfaceAltitudeAtCenter = 0, this._surfaceAltitudeAtCenterDirty = true, this._contentAltitudeAtCenter = 0, this._contentAltitudeAtCenterDirty = true, this._propertiesPool = new o21({
      renderPointOfView: j15
    }, this);
  }
  initialize() {
    const {
      state: e71,
      basemapTerrain: t71,
      renderCoordsHelper: a59,
      map: c44
    } = this.view;
    this._surfaceIntersector = T5(e71.viewingMode), e71.isGlobal ? this._surfaceIntersector.options.backfacesTerrain = false : this._surfaceIntersector.options.backfacesTerrain = true, this._surfaceIntersector.options.invisibleTerrain = false, this._surfaceIntersector.options.store = e30.MIN, this._contentIntersector = T5(e71.viewingMode);
    const u46 = () => this._estimateSurfaceAltitudeAtCenter(), h32 = this.view.resourceController.scheduler, d38 = this.view.basemapTerrain?.elevationQueryCache, f46 = {
      state: e71,
      scheduler: h32,
      surface: t71,
      renderCoordsHelper: a59
    };
    this._set("centerOnSurfaceInfrequent", new L18(__spreadProps(__spreadValues({}, f46), {
      task: I3.POINT_OF_INTEREST_INFREQUENT,
      estimateSurfaceAltitudeAtCenter: u46
    }))), this._set("centerOnSurfaceFrequent", new L18(__spreadProps(__spreadValues({}, f46), {
      task: I3.POINT_OF_INTEREST_FREQUENT,
      estimateSurfaceAltitudeAtCenter: u46
    }))), this._set("centerOnContent", new L18(__spreadProps(__spreadValues({}, f46), {
      task: I3.POINT_OF_INTEREST_FREQUENT,
      estimateSurfaceAltitudeAtCenter: () => this._estimateContentAltitudeAtCenter()
    }))), this._set("cameraOnSurface", new y19(__spreadProps(__spreadValues({}, f46), {
      cache: d38,
      task: I3.POINT_OF_INTEREST_INFREQUENT,
      map: c44
    }))), this._set("surfaceGeometryUpdates", new u33(__spreadProps(__spreadValues({}, f46), {
      centerOnSurfaces: [this.centerOnSurfaceFrequent, this.centerOnContent, this.centerOnSurfaceInfrequent]
    }))), this._set("contentGeometryUpdates", new n48({
      contentLayerViews: this.view.allLayerViews,
      renderCoordsHelper: a59
    })), this._set("surfaceOrigin", new c38({
      cache: d38,
      view: this.view
    })), this._set("focus", new O24({
      state: e71,
      scheduler: h32,
      surface: t71,
      renderCoordsHelper: a59,
      centerOnSurface: this.centerOnSurfaceFrequent,
      estimateSurfaceIntersectionAtRenderPoint: (e72, t72) => this._estimateSurfaceIntersectionAtRenderPoint(e72, this.view.state.contentCamera, t72)
    })), this._pois.push(this.centerOnContent, this.centerOnSurfaceFrequent, this.centerOnSurfaceInfrequent, this.cameraOnSurface, this.focus);
    const p49 = this.view.graphics;
    this._debugCenters.set(this.centerOnContent, new m32(p49, "red", "CenterOnContent")), this._debugCenters.set(this.centerOnSurfaceFrequent, new m32(p49, "red", "CenterOnSurface")), this._debugCenters.set(this.centerOnSurfaceInfrequent, new m32(p49, "red", "CenterOnSurface")), this._debugCenters.set(this.cameraOnSurface, new m32(p49, "blue", "CameraOnSurface")), this._debugCenters.set(this.focus, new m32(p49, "green", "Focus")), this.addHandles([d2(() => e71.contentCamera, (e72) => this._cameraChanged(e72), C), d2(() => t71.extent, () => this._updateCenterPointsOfInterest()), p(() => !t71.updating, () => this._updateCenterPointsOfInterest(), C), v2(() => this.surfaceGeometryUpdates.events, "request-update", () => this._updateCenterPointsOfInterest()), v2(() => this.contentGeometryUpdates.events, "request-update", () => this._updateCenterOnContent()), p(() => t19.SHOW_POI, (e72) => this._setDebug(e72), P)]), this._cameraChanged(this.view.state.contentCamera);
    for (const r57 of this._pois) r57.runTask();
  }
  destroy() {
    this._setDebug(false), this._propertiesPool.destroy();
    for (const e71 of this._pois) e71.destroy();
    this.surfaceOrigin.destroy();
  }
  get updating() {
    return !(!this.surfaceGeometryUpdates?.updating && !this._pois.some((e71) => e71.updating));
  }
  get _centerRay() {
    return this._centerRayDirty && (this._centerRayCached = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera, this._tmpRay), this._centerRayDirty = false), this._centerRayCached;
  }
  _estimateContentAltitudeAtCenter() {
    if (!this._contentAltitudeAtCenterDirty) return this._contentAltitudeAtCenter;
    this._contentAltitudeAtCenterDirty = false;
    const e71 = this._centerRay;
    return null == e71 || (this.view.sceneIntersectionHelper.intersectRay(e71, this._contentIntersector, T16, F10) ? this._contentAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(T16) : this._contentAltitudeAtCenter = this._estimateSurfaceAltitudeAtCenter()), this._contentAltitudeAtCenter;
  }
  _estimateSurfaceAltitudeAtCenter() {
    if (!this.view.basemapTerrain) return 0;
    if (!this._surfaceAltitudeAtCenterDirty) return this._surfaceAltitudeAtCenter;
    this._surfaceAltitudeAtCenterDirty = false;
    const e71 = this._centerRay;
    if (null == e71) return this._surfaceAltitudeAtCenter;
    const t71 = e71.origin, r57 = u5(T16, e71.origin, e71.direction);
    return this._surfaceIntersector.resetWithRay(e71, this.view.state.contentCamera), this.view.basemapTerrain.intersect(this._surfaceIntersector, null, t71, r57), this._surfaceIntersector.results.min.getIntersectionPoint(T16) && (this._surfaceAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(T16)), this._surfaceAltitudeAtCenter;
  }
  _estimateSurfaceIntersectionAtRenderPoint(e71, t71, r57) {
    const s67 = f19(t71, e71, E31);
    if (null == s67) return null;
    const n63 = s67.origin, i49 = u5(T16, s67.origin, s67.direction);
    return this._surfaceIntersector.resetWithRay(s67, t71), this.view.basemapTerrain.intersect(this._surfaceIntersector, null, n63, i49), this._surfaceIntersector.results.min.getIntersectionPoint(r57) ? r57 : null;
  }
  _cameraChanged(e71) {
    this._updateCenterPointsOfInterest();
    const t71 = e71.eye;
    G2(this.renderPointOfView, t71) || this._set("renderPointOfView", r5(this._propertiesPool.get("renderPointOfView"), t71));
  }
  _updateCenterPointsOfInterest() {
    this._centerRayDirty = true, this._surfaceAltitudeAtCenterDirty = true, this._contentAltitudeAtCenterDirty = true;
    for (const e71 of this._pois) e71.updateRenderLocation();
  }
  _updateCenterOnContent() {
    this._contentAltitudeAtCenterDirty = true, this.centerOnContent.updateRenderLocation();
  }
  _setDebug(e71) {
    if (!e71) return this._debugCenters.forEach((e72) => e72.hide()), void this.removeHandles("debug");
    for (const t71 of this._pois) this.addHandles(d2(() => t71.renderLocation, (e72) => this._debugCenters.get(t71)?.show(e72, t71.renderCoordsHelper.spatialReference), P), "debug");
  }
  get test() {
  }
};
e6([y2()], P13.prototype, "centerOnContent", void 0), e6([y2()], P13.prototype, "centerOnSurfaceFrequent", void 0), e6([y2()], P13.prototype, "centerOnSurfaceInfrequent", void 0), e6([y2()], P13.prototype, "cameraOnSurface", void 0), e6([y2()], P13.prototype, "focus", void 0), e6([y2()], P13.prototype, "renderPointOfView", void 0), e6([y2()], P13.prototype, "surfaceOrigin", void 0), e6([y2()], P13.prototype, "contentGeometryUpdates", void 0), e6([y2()], P13.prototype, "surfaceGeometryUpdates", void 0), e6([y2({
  constructOnly: true
})], P13.prototype, "view", void 0), e6([y2()], P13.prototype, "updating", null), P13 = e6([a4("esri.views.3d.support.pointsOfInterest.PointsOfInterest")], P13);
var j15 = Array;
var T16 = n7();
var E31 = m7();
var F10 = {
  exclude: /* @__PURE__ */ new Set([w6])
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/ElevationBounds.js
var s53 = class {
  constructor(s67 = 0, a59 = 0) {
    this.min = s67, this.max = a59, this.level = 0, this.hasNoDataValues = false;
  }
  copyFrom(s67) {
    this.min = s67.min, this.max = s67.max, this.level = s67.level, this.hasNoDataValues = s67.hasNoDataValues;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/ElevationData.js
var r47 = class {
  constructor(t71, o60, s67) {
    this.type = "elevation", this.level = t71[0], this.i = t71[1], this.j = t71[2], this.extent = o60, this.samplerData = new t13(s67, o60);
  }
  computeMinMaxValue(t71, a59, r57, i49) {
    i49.min = 1 / 0, i49.max = -1 / 0, i49.hasNoDataValues = false;
    const e71 = t71 - this.level;
    if (e71 <= 0) return i49;
    const l47 = 2 ** e71;
    if (!(Math.floor(a59 / l47) === this.i && Math.floor(r57 / l47) === this.j)) return i49;
    let n63 = 1 / 0, h32 = -1 / 0;
    const f46 = this.samplerData.data.width, m45 = this.samplerData.data.values, u46 = 0.5 * l16;
    let c44 = (f46 - 1) / l47, p49 = (r57 - this.j * l47) * c44, M18 = (a59 - this.i * l47) * c44;
    if (c44 < 1) {
      const t72 = Math.floor(p49), a60 = Math.floor(M18), s67 = t72 + a60 * f46, r58 = m45[s67], e72 = m45[s67 + 1], l48 = m45[s67 + f46], n64 = m45[s67 + f46 + 1];
      if (r58 + e72 + l48 + n64 < u46) {
        const s68 = p49 - t72, h33 = M18 - a60, f47 = p10(r58, e72, l48, n64, s68, h33), m46 = p10(r58, e72, l48, n64, s68 + c44, h33), u47 = p10(r58, e72, l48, n64, s68, h33 + c44), x26 = p10(r58, e72, l48, n64, s68 + c44, h33 + c44);
        return i49.min = Math.min(f47, m46, u47, x26), i49.max = Math.max(f47, m46, u47, x26), i49;
      }
      p49 = t72, M18 = a60, c44 = 1;
    } else p49 = Math.floor(p49), M18 = Math.floor(M18), c44 = Math.ceil(c44);
    for (let o60 = p49; o60 <= p49 + c44; o60++) for (let t72 = M18; t72 <= M18 + c44; t72++) {
      const a60 = m45[o60 + t72 * f46];
      a60 < u46 ? (n63 = Math.min(n63, a60), h32 = Math.max(h32, a60)) : i49.hasNoDataValues = true;
    }
    return i49.min = n63, i49.max = h32, i49;
  }
};
var i41 = 0.5 * l16;
function e55(a59, o60, s67) {
  if (null == s67) return null;
  for (const r57 of s67) {
    if (!r57) continue;
    const s68 = r57.safeWidth;
    let e71 = e12(r57.dy * (r57.y1 - o60), 0, s68), l47 = e12(r57.dx * (a59 - r57.x0), 0, s68);
    const n63 = Math.floor(e71), h32 = Math.floor(l47), f46 = r57.data.width, m45 = n63 * f46 + h32, u46 = r57.data.values, c44 = u46[m45], p49 = u46[m45 + 1], M18 = m45 + f46, x26 = u46[M18], d38 = u46[M18 + 1];
    if (c44 + x26 + p49 + d38 < i41) {
      e71 -= n63, l47 -= h32;
      const t71 = c44 + (p49 - c44) * l47;
      return t71 + (x26 + (d38 - x26) * l47 - t71) * e71;
    }
  }
  return null;
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/ExtentHelper.js
var x21 = class extends S3 {
  constructor(e71) {
    super(e71);
  }
  initialize() {
    this.addHandles([this.layerViews.on("change", () => this.notifyChange("stencilEnabledExtents"))]);
  }
  destroy() {
  }
  get layerViewsExtent() {
    return this._computeLayerViewsExtent();
  }
  get tiledLayersExtent() {
    return this._computeTiledLayersExtent();
  }
  get stencilEnabledExtents() {
    return this._computeStencilEnabledExtents();
  }
  _computeStencilEnabledExtents() {
    const e71 = [];
    return this.layerViews.forEach((t71) => {
      const r57 = t71.layer;
      if ("operationalLayerType" in r57 && d4(r57.operationalLayerType) && null != this.viewSpatialReference) {
        const t72 = L20(r57.fullExtent, this.viewSpatialReference);
        null != t72 && e71.push(o5(t72));
      }
    }), e71;
  }
};
function h25(e71, t71) {
  return e71 === l9.Global ? new w18(t71) : new g21(t71);
}
e6([y2({
  readOnly: true
})], x21.prototype, "layerViewsExtent", null), e6([y2({
  readOnly: true
})], x21.prototype, "tiledLayersExtent", null), e6([y2({
  readOnly: true
})], x21.prototype, "stencilEnabledExtents", null), e6([y2()], x21.prototype, "viewSpatialReference", void 0), e6([y2()], x21.prototype, "tilingScheme", void 0), e6([y2()], x21.prototype, "defaultTiledLayersExtent", void 0), e6([y2({
  constructOnly: true
})], x21.prototype, "layers", void 0), e6([y2({
  constructOnly: true
})], x21.prototype, "layerViews", void 0), x21 = e6([a4("esri.views.3d.terrain.ExtentHelper")], x21);
var w18 = class extends x21 {
  _computeLayerViewsExtent() {
    return this._globalExtent;
  }
  _computeTiledLayersExtent() {
    return this._globalExtent;
  }
  get _globalExtent() {
    return this.viewSpatialReference.isWebMercator ? m16 : c15;
  }
};
w18 = e6([a4("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")], w18);
var g21 = class extends x21 {
  _computeLayerViewsExtent() {
    const e71 = D(), t71 = this.viewSpatialReference;
    this.layerViews.forEach((r58) => {
      const n64 = r58.layer;
      if (r58.isResolved() && ("graphics" !== n64.type || !n64.internal)) {
        const n65 = L20("fullExtentInLocalViewSpatialReference" in r58 && r58.fullExtentInLocalViewSpatialReference || r58.layer.fullExtent, t71);
        m4(e71, n65, e71);
      }
    });
    const r57 = x2(e71) ? e71 : null, n63 = this._get("layerViewsExtent");
    return I(r57, n63) ? n63 : r57;
  }
  _computeTiledLayersExtent() {
    const e71 = this.tilingScheme;
    if (!e71) return null;
    const t71 = this.viewSpatialReference, r57 = D();
    this.layers.forEach((n64) => {
      if (n64.loaded && y4(n64)) {
        const i50 = k5(n64, t71, l9.Local);
        if (null == i50) return;
        const {
          tileInfo: l47,
          fullExtent: s67
        } = i50, a59 = "tilemapCache" in n64 ? n64.tilemapCache?.effectiveMaxLOD : void 0;
        null != l47 && null != s67 && (_12(n64) || e71.compatibleWith(l47, a59) && s67.spatialReference.equals(e71.spatialReference)) && m4(r57, s67, r57);
      }
    }), m4(r57, this.defaultTiledLayersExtent, r57);
    const n63 = x2(r57) ? r57 : null, i49 = this._get("tiledLayersExtent");
    return I(n63, i49) ? i49 : n63;
  }
};
function L20(e71, t71) {
  return null == e71 || e71.spatialReference.equals(t71) ? e71 : Q(e71, e71.spatialReference, t71);
}
g21 = e6([a4("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")], g21);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/requireUtils.js
function e56() {
  const e71 = globalThis.require?.modules;
  if (e71) {
    const o60 = Object.keys(e71);
    for (const s67 of o60) s67.includes(".glsl") && delete e71[s67];
  }
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/OverlayManager.js
var se4 = 1.3;
var ie3 = [[-0.1, -2, 3.9, 2], [-0.1, -3.9, 3.9, 0.1], [-2, -3.9, 2, 0.1], [-3.9, -3.9, 0.1, 0.1], [-3.9, -2, 0.1, 2], [-3.9, -0.1, 0.1, 3.9], [-2, -0.1, 2, 3.9], [-0.1, -0.1, 3.9, 3.9]];
var ae3;
var ne3 = class extends S3 {
  constructor(e71) {
    super(e71), this._spatialReference = null, this._renderSR = null, this._overlaySREqualsRenderSR = true, this._drapeSources = /* @__PURE__ */ new Set(), this._drapeTargets = /* @__PURE__ */ new Set(), this._placementDirty = false, this._contentUpdated = false, this._drawTexturesDirty = false, this._drawTexturesAnimateDirty = false, this._longitudeCyclical = null, this._latestOriginId = 0, this._maxResolution = has("esri-mobile") ? 2048 : 4096, this._animationTimeLast = 0;
  }
  initialize() {
    const e71 = this.view;
    this.renderer = new $3({
      view: e71,
      worldToPCSRatio: this._worldToPCSRatio,
      spatialReference: this._spatialReference
    }), e71._stage.renderer.plugins.add(this.renderer);
    const t71 = () => this.setDrawTexturesDirty();
    this._groundIntersector = T5(this.view.state.viewingMode), this._groundIntersector.options.backfacesTerrain = true, this._groundIntersector.options.invisibleTerrain = true, this._groundIntersector.options.hud = false, this.addHandles([d2(() => this.renderer.hasHighlights, t71), this.renderer.events.on("has-water", (t72) => e71._stage?.renderer.setParameters({
      hasOverlayWater: t72
    })), this.renderer.events.on("content-changed", t71), d2(() => e71.state.camera.pixelRatio, t71), d2(() => e71.state.alignPixelEnabled, t71), this.renderer.events.on("textures-disposed", () => this.surface.requestRender()), d2(() => [e71.pointsOfInterest?.renderPointOfView, e71.pointsOfInterest?.centerOnSurfaceFrequent?.location], () => this.setPlacementDirty()), d2(() => [e71.state?.pixelRatio, e71.state?.contentPixelRatio], () => this.setPlacementDirty(), C), this.surface.on("elevation-change", () => this.setPlacementDirty()), e71.on("resize", () => this.setPlacementDirty()), e71.resourceController.scheduler.registerTask(I3.OVERLAY, this), e71._stage.renderView.events.on("force-camera-for-screenshot", (e72) => {
      this._updateOverlays(C4, e72.camera, O7.BACKGROUND), this.renderer.hasOverlays && this._drawOverlays(O7.BACKGROUND, e72);
    })]), e71._stage.renderer.renderOverlay = (e72) => this._renderOverlay(e72);
  }
  destroy() {
    this.view?._stage && (this.view._stage.renderer.plugins.remove(this.renderer), this.view._stage.renderer.renderOverlay = () => {
    }), ae3 && (ae3.hide(), ae3 = null), this.renderer = u(this.renderer);
  }
  get running() {
    return this._placementDirty && (this._drapeSources.size > 0 || this.view.graphics.length > 0 || t19.OVERLAY_DRAW_DEBUG_TEXTURE) && !!this._spatialReference && !this.suspended && this.surface.ready;
  }
  get _isSpherical() {
    return this.view.state.isGlobal;
  }
  get _worldToPCSRatio() {
    return null != this._spatialReference && this._spatialReference.isGeographic && !this.view.state.isLocal ? s6(this._spatialReference).metersPerDegree : 1;
  }
  get _overlayStretch() {
    return se4 / this.view.resolutionScale;
  }
  get suspended() {
    return this.surface.suspended;
  }
  get updating() {
    return this.running || this.renderer.updating || this._contentUpdated;
  }
  get rendersOccludedDraped() {
    return this.renderer.rendersOccludedDraped;
  }
  _renderOverlay(e71) {
    if (this._contentUpdated = false, this.renderer.processSyncDrapeSources(), this.renderer.hasOverlays) return this._dispatchAnimationUpdate(e71), this._drawOverlays(O7.UPDATE, this.view.state);
  }
  get hasOverlays() {
    return this.renderer.hasOverlays;
  }
  setSpatialReference(e71) {
    this._spatialReference = e71, this.renderer.spatialReference = e71, this._longitudeCyclical = null;
    const t71 = this.view.renderSpatialReference;
    null != e71 && null != t71 ? (this._renderSR = t71, this._overlaySREqualsRenderSR = e71.equals(this._renderSR), this._isSpherical && (this._longitudeCyclical = e71.isWebMercator ? new n19(-20037508342787e-6, 20037508342787e-6) : new n19(-180, 180), this.renderer.longitudeCyclical = this._longitudeCyclical), this.renderer && (this.renderer.worldToPCSRatio = this._worldToPCSRatio)) : this.renderer.disposeOverlays();
  }
  registerDrapeSource(e71, t71, r57) {
    this._drapeSources.add(e71), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);
    const s67 = this.renderer.createDrapeSourceRenderer(e71, t71, r57);
    return this._updateDrapeSourceExtent(e71), this._setContentDirty(), this.notifyChange("running"), s67;
  }
  registerGeometryDrapeSource(e71) {
    return this.registerDrapeSource(e71, G8);
  }
  _updateDrapeSourceExtent(e71) {
    2 === this.renderer.overlays.length && null != e71.setDrapingExtent && null != this._spatialReference && e71.setDrapingExtent(this.renderer.overlays, this._spatialReference);
  }
  unregisterDrapeSource(e71) {
    this._drapeSources.has(e71) && (this._drapeSources.delete(e71), this.renderer.removeDrapeSourceRenderer(e71), this.renderer.ensureDrapeSources(this._drapeSources), this._setContentDirty(), this.notifyChange("running"));
  }
  registerDrapeTarget(e71) {
    this._drapeTargets.add(e71), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);
  }
  unregisterDrapeTarget(e71) {
    this._drapeTargets.delete(e71), this.renderer.ensureDrapeTargets(this._drapeTargets);
  }
  _setContentDirty() {
    this.setPlacementDirty(), this.setDrawTexturesDirty();
  }
  setPlacementDirty() {
    this._placementDirty = true;
  }
  runTask(e71) {
    return this._updateOverlays(e71, this.view.state.contentCamera, O7.UPDATE);
  }
  _updateOverlays(e71, t71, r57) {
    if (!this._spatialReference) return o12;
    const s67 = this._computeOverlayResolution(t71);
    this._computeOverlayExtents(t71, s67, de), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources, de.stretch);
    const i49 = this._updateOverlay(E17.INNER, de.inner, s67, 1 * de.pixelRatioAdjustment, de.mapUnitsPerPixel), a59 = M2(de.inner) / M2(de.outer), n63 = this._updateOverlay(E17.OUTER, de.outer, s67, a59 * de.pixelRatioAdjustment, de.mapUnitsPerPixel);
    i49 !== _e.EXTENT && n63 !== _e.EXTENT || (this._drapeSources.forEach((e72) => this._updateDrapeSourceExtent(e72)), this.surface.updateTileOverlayParams(r57)), i49 === _e.NONE && n63 === _e.NONE || this.setDrawTexturesDirty(), this._placementDirty = false, e71.madeProgress();
  }
  _computeOverlayResolution(e71) {
    const t71 = this.view.state.contentPixelRatio * this.view.resolutionScale, r57 = e71.fullWidth / e71.pixelRatio * t71, s67 = e71.fullHeight / e71.pixelRatio * t71, i49 = Math.ceil(1.5 * Math.max(r57, s67));
    return Math.min(n20(i49), this._maxResolution);
  }
  _updateOverlay(e71, t71, r57, s67, i49) {
    if (0 === this.renderer.overlays.length) return _e.NONE;
    const a59 = this.renderer.overlays[e71], n63 = a59.mapUnitsPerPixel;
    if (a59.mapUnitsPerPixel = i49, a59.pixelRatio = s67, oe2(t71, a59.extent) && r57 === a59.resolution) return n63 === i49 ? _e.NONE : _e.RERENDER_ONLY;
    e13(a59.extent, t71), a59.resolution = r57;
    const o60 = p5(a59.extent);
    return a59.renderLocalOrigin = t32(o60[0], o60[1], 0, "OV_" + this._latestOriginId++), _e.EXTENT;
  }
  setTileParameters(e71) {
    const t71 = e71.renderData.overlay;
    if (this.renderer.overlays.length > 0) {
      const r57 = this.renderer.overlays[E17.INNER], s67 = this.renderer.overlays[E17.OUTER], i49 = e71.extent;
      this._rectInsideRect(r57.extent, i49) || this._rectanglesOverlap(i49, r57.extent) || this._rectanglesOverlap(i49, s67.extent) ? (this._setTileOverlayData(i49, E17.INNER, t71), this._setTileOverlayData(i49, E17.OUTER, t71)) : (this._clearTileOverlayData(E17.INNER, t71), this._clearTileOverlayData(E17.OUTER, t71));
    } else this._clearTileOverlayData(E17.INNER, t71), this._clearTileOverlayData(E17.OUTER, t71);
  }
  overlayPixelSizeInMapUnits(e71, t71) {
    if (0 === this.renderer.overlays.length) return t71();
    const r57 = this.renderer.overlays[E17.INNER], s67 = this.renderer.overlays[E17.OUTER], i49 = this._pointIsInExtent(e71, r57.extent) ? r57 : s67;
    return (i49.extent[2] - i49.extent[0]) / i49.resolution;
  }
  _setTileOverlayData(e71, t71, r57) {
    if (0 === this.renderer.overlays.length) return;
    const s67 = this.renderer.overlays[t71].extent, i49 = M2(s67), a59 = s9(s67);
    let n63 = e71[0];
    if (this._longitudeCyclical) {
      n63 = this._longitudeCyclical.minimalMonotonic(s67[0], n63);
      const t72 = this._longitudeCyclical.minimalMonotonic(s67[0], e71[2]);
      n63 > t72 && (n63 = t72 - (e71[2] - e71[0]));
    }
    r57.setScale(t71, M2(e71) / i49, s9(e71) / a59), r57.setOffset(t71, (n63 - s67[0]) / i49, (e71[1] - s67[1]) / a59);
  }
  _clearTileOverlayData(e71, t71) {
    t71.setScale(e71, -1, -1), t71.setOffset(e71, -1, -1);
  }
  reloadShaders() {
    return __async(this, null, function* () {
      e56(), yield this.renderer.reloadShaders(), this.setDrawTexturesDirty(), this.runTask(C4);
    });
  }
  _dispatchAnimationUpdate(e71) {
    const t71 = n3(e71 - this._animationTimeLast);
    if (t71 >= this.surface.view._stage.renderer.animationTimestep || null != this.view.state.forcedAnimationTime || this._drawTexturesDirty || this._drawTexturesAnimateDirty) {
      const r57 = n3(t71 / this.surface.view._stage.renderer.animationTimeDilation), s67 = new d8(this.view.state.camera, r57, this.view.state.forcedAnimationTime);
      this.renderer.updateAnimation(s67) && (this._drawTexturesAnimateDirty = true), this._animationTimeLast = e71;
    }
  }
  setDrawTexturesDirty() {
    this.renderer.hasOverlays ? (this._contentUpdated = true, this._drawTexturesDirty = true, this.view._stage.renderView.requestRender()) : this.setPlacementDirty();
  }
  _intersectGroundFromView(e71, t71, r57, s67) {
    const i49 = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e71, me, t71, r57);
    if (null == i49) return false;
    const a59 = i49.origin, n63 = u5(ce3, i49.origin, i49.direction);
    return this._groundIntersector.reset(a59, n63, e71), this._groundIntersector.intersect([]), this.view.basemapTerrain.intersect(this._groundIntersector, null, a59, n63), this._groundIntersector.results.min.getIntersectionPoint(s67);
  }
  _findHorizonBasedPointOfInterest(e71, t71) {
    let r57 = 0.5;
    const a59 = 0.55, n63 = this.view.renderCoordsHelper.getAltitude(e71.eye), o60 = this.view.pointsOfInterest.centerOnSurfaceFrequent, l47 = 1e-5, h32 = e12(o60.estimatedSurfaceAltitude, e71.aboveGround ? -1 / 0 : n63 + l47, e71.aboveGround ? n63 - l47 : 1 / 0), c44 = e71.aboveGround;
    if ("global" === this.view.viewingMode) {
      const t72 = ce3;
      J3(L3(at, s6(this.view.spatialReference).radius + h32), l8(e71.eye, e71.viewForward), t72), e11(t72, t72, e71.eye);
      const i49 = s19.normalize(m8(e71.viewForward, t72, e71.viewRight)) / e71.fovY + 0.5, n64 = i49 <= 0 || i49 >= 1 ? 0.5 : a59;
      r57 = c44 ? n64 * i49 : i49 + n64 * (1 - i49);
    } else {
      const t72 = 0.5 * Math.PI - Math.acos(-e71.viewForward[2]), s67 = Math.tan(t72), n64 = r6(0, s67, 1, 0), o61 = z4(n64, n64, e71.projectionMatrix)[1], l48 = e12(0.5 + 0.5 * o61, 0, 1);
      r57 = 1 === l48 || 0 === l48 ? 0.5 : c44 ? l48 * a59 : 1 - (1 - l48) * a59;
    }
    return !!this._intersectGroundFromView(e71, 0.5, r57, t71) && X(t71, e71.eye) < o60.distance * o60.distance;
  }
  _computeOverlayExtents(e71, t71, r57) {
    const s67 = this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation, i49 = n7();
    this._findHorizonBasedPointOfInterest(e71, i49) || r5(i49, s67), t19.OVERLAY_SHOW_CENTER ? (null == ae3 && (ae3 = new m32(this.view.graphics, "red")), ae3.show(i49, this._renderSR)) : null != ae3 && ae3.hide();
    const n63 = Math.max(0.1, x(e71.eye, i49)), o60 = c30(this.view.renderCoordsHelper, s67, e71.eye);
    this._overlaySREqualsRenderSR || n12(i49, this._renderSR, i49, this._spatialReference);
    const l47 = this.surface.extent, h32 = !this._isSpherical && this._spatialReference?.isGeographic, c44 = h32 && this._spatialReference ? 1 / s6(this._spatialReference).metersPerDegree : 1, d38 = this.view.state.contentPixelRatio, p49 = e71.perScreenPixelRatio / d38 * n63 * c44;
    r57.mapUnitsPerPixel = p49 / this._worldToPCSRatio, r57.stretch = this._overlayStretch;
    let m45 = t71 * p49 / 2 * r57.stretch, _30 = false, v28 = h32 ? 90 : 1 / 0;
    this._isSpherical && l47 && this._spatialReference && (this._spatialReference.isWebMercator ? (m45 /= Math.cos(f3(i49[1])), v28 = l47[3]) : (_30 = true, m45 /= s6(this._spatialReference).metersPerDegree, v28 = 90), m45 >= v28 && (m45 = v28, i49[1] = 0, this._spatialReference.isWebMercator && (i49[0] = 0)));
    let O34 = 1;
    _30 && (O34 = 1 / Math.max(0.2, Math.cos(Math.abs(h3(i49[1])))), m45 * O34 > 180 && (O34 = 180 / m45), r57.mapUnitsPerPixel *= O34);
    const T21 = Math.log(2) / 12;
    m45 = Math.exp(Math.round(Math.log(m45) / T21) * T21);
    const S26 = m45 * O34, M18 = 32, b25 = 0.5 * t71 / (M18 * S26), C25 = 0.5 * t71 / (M18 * m45);
    i49[0] = Math.round(i49[0] * b25) / b25, i49[1] = Math.round(i49[1] * C25) / C25;
    const U23 = r57.inner;
    U23[0] = i49[0] - S26, U23[1] = i49[1] - m45, U23[2] = i49[0] + S26, U23[3] = i49[1] + m45, this._isSpherical && this._shiftExtentToFitBounds(U23, 1 / 0, v28);
    const N18 = r57.outer;
    if (6 * S26 > M2(l47)) e13(N18, l47);
    else {
      if (Math.PI / 2 - Math.abs(o60 - Math.PI / 2) <= 0.25 * Math.PI) N18[0] = U23[0] - S26, N18[1] = U23[1] - m45, N18[2] = U23[2] + S26, N18[3] = U23[3] + m45;
      else {
        n12(e71.eye, this._renderSR, ce3, this._spatialReference), e19(he, i49, ce3);
        let t72 = -Math.atan2(he[1], he[0]) + 0.125 * Math.PI;
        t72 < 0 && (t72 += 2 * Math.PI);
        const r58 = Math.floor(t72 / (0.25 * Math.PI));
        m6(he, ie3[r58], 2 * m45), he[0] *= O34, he[2] *= O34, o7(N18, U23, he);
      }
    }
    if (this._isSpherical) N18[0] = this._longitudeCyclical.clamp(N18[0]), N18[2] = this._longitudeCyclical.clamp(N18[2]), N18[1] = Math.max(N18[1], -v28), N18[3] = Math.min(N18[3], v28);
    else {
      const e72 = U4(U23, l47, ue), t72 = U4(N18, l47, pe);
      R(e72, t72) && (N18[2] = N18[0], N18[3] = N18[1]);
    }
    const A32 = Math.abs(U23[2] - U23[0]) / t71;
    r57.mapUnitsPerPixel = Math.max(r57.mapUnitsPerPixel, A32), r57.pixelRatioAdjustment = r57.mapUnitsPerPixel / A32;
  }
  _drawOverlays(e71, t71) {
    if (!this.renderer.hasOverlays) return;
    if (!this._drawTexturesDirty && !this._drawTexturesAnimateDirty) return this.renderer;
    const r57 = this._drawTexturesDirty;
    this._drawTexturesDirty = this._drawTexturesAnimateDirty = false;
    const s67 = this.renderer.computeValidity();
    this.renderer.releaseRenderTargets(), this.renderer.drawOverlays(t71);
    return s67 !== this.renderer.computeValidity() && this.surface.updateTileOverlayParams(O7.UPDATE), r57 ? (this.surface.requestRender(e71), e71 === O7.UPDATE && this.surface.requestUpdate()) : this.surface.requestRender(O7.BACKGROUND), this.renderer;
  }
  _rectanglesOverlap(e71, t71) {
    return null != e71 && (this._longitudeCyclical ? (this._longitudeCyclical.contains(t71[0], t71[2], e71[0]) || this._longitudeCyclical.contains(t71[0], t71[2], e71[2]) || this._longitudeCyclical.contains(e71[0], e71[2], t71[0])) && !(e71[1] > t71[3] || e71[3] < t71[1]) : E3(e71, t71));
  }
  _rectInsideRect(e71, t71) {
    return null != t71 && (this._longitudeCyclical ? this._longitudeCyclical.contains(e71[0], e71[2], t71[0]) && this._longitudeCyclical.contains(e71[0], e71[2], t71[2]) && t71[1] > e71[1] && t71[3] < e71[3] : R(e71, t71));
  }
  _pointIsInExtent(e71, t71) {
    if (this._longitudeCyclical) return this._longitudeCyclical.contains(t71[0], t71[2], e71.x) && e71.y >= t71[1] && e71.y <= t71[3];
    const r57 = e71.x, s67 = e71.y;
    return r57 > t71[0] && r57 < t71[2] && s67 > t71[1] && s67 < t71[3];
  }
  _shiftExtentToFitBounds(e71, t71, r57) {
    let s67 = 0, i49 = 0;
    e71[0] < -t71 ? s67 = e71[0] + t71 : e71[2] > t71 && (s67 = t71 - e71[2]), e71[1] < -r57 ? i49 = e71[1] + r57 : e71[3] > r57 && (i49 = r57 - e71[3]), z2(e71, s67, i49);
  }
  get test() {
  }
};
function oe2(e71, t71) {
  const r57 = 1e-5, s67 = t19.TESTS_DISABLE_OPTIMIZATIONS ? 0 : r57 * Math.max(e71[2] - e71[0], e71[3] - e71[1], t71[2] - t71[0], t71[3] - t71[1]);
  return Math.abs(t71[0] - e71[0]) <= s67 && Math.abs(t71[1] - e71[1]) <= s67 && Math.abs(t71[2] - e71[2]) <= s67 && Math.abs(t71[3] - e71[3]) <= s67;
}
e6([y2()], ne3.prototype, "_spatialReference", void 0), e6([y2({
  readOnly: true
})], ne3.prototype, "running", null), e6([y2()], ne3.prototype, "_placementDirty", void 0), e6([y2()], ne3.prototype, "_contentUpdated", void 0), e6([y2()], ne3.prototype, "_isSpherical", null), e6([y2()], ne3.prototype, "_worldToPCSRatio", null), e6([y2()], ne3.prototype, "renderer", void 0), e6([y2({
  constructOnly: true
})], ne3.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], ne3.prototype, "surface", void 0), e6([y2()], ne3.prototype, "suspended", null), e6([y2()], ne3.prototype, "updating", null), e6([y2({
  type: Boolean
})], ne3.prototype, "rendersOccludedDraped", null), ne3 = e6([a4("esri.views.3d.terrain.OverlayManager")], ne3);
var le2 = class {
  constructor() {
    this.inner = u6(), this.outer = u6(), this.mapUnitsPerPixel = 0, this.pixelRatioAdjustment = 1, this.stretch = se4;
  }
};
var he = n11();
var ce3 = n7();
var de = new le2();
var ue = u6();
var pe = u6();
var me = m7();
var _e;
!function(e71) {
  e71[e71.NONE = 0] = "NONE", e71[e71.EXTENT = 1] = "EXTENT", e71[e71.RERENDER_ONLY = 2] = "RERENDER_ONLY";
}(_e || (_e = {}));

// ../../../node_modules/@arcgis/core/views/3d/terrain/PatchGeometry.js
var o46 = class {
  constructor() {
    this.indices = null, this.indexCount = 0, this.edgeIndicesStartIndex = 0, this.poleIndicesStartIndex = 0, this.vertexAttributes = null, this.edgeVerticesStartIndex = 0, this.poleVerticesStartIndex = 0, this.maxEdgeVertexCount = 0, this.boundingBox = P4(), this.numVerticesPerSide = 0, this.minu = 0, this.minv = 0, this.maxu = 1, this.maxv = 1, this.outerEdgesOffsetAndLength = [0, 0, 0, 0, 0, 0, 0, 0];
  }
  release() {
    this.vertexAttributes = t2(this.vertexAttributes), this.indices = null;
  }
  reset() {
    this.indices = null, this.vertexAttributes = null, P4(this.boundingBox), this.numVerticesPerSide = 0;
  }
  getEdgeFirstVertexIndex(t71) {
    return this.outerEdgesOffsetAndLength[2 * t71];
  }
  getEdgeCount(t71) {
    return this.outerEdgesOffsetAndLength[2 * t71 + 1];
  }
  getEdgeVertexIndex(t71, e71) {
    return this.getEdgeAttributeIndex(t71, e71);
  }
  getEdgeVertexPosition(t71, s67, i49, r57) {
    this._getEdgeVertexRaw(this.getEdgeAttributeIndex(t71, r57), s67), u5(s67, s67, i49);
  }
  getEdgeNormal(t71, e71, s67) {
    const {
      typedBuffer: i49,
      typedBufferStride: n63
    } = this.vertexAttributes.normalCompressed;
    f11(e71, i49, this.getEdgeAttributeIndex(t71, s67), n63);
  }
  setEdgeNormalFromValues(t71, e71, s67, i49, r57) {
    this._setNormal(this.getEdgeAttributeIndex(t71, e71), s67, i49, r57);
  }
  setEdgeVertexFromValuesRawPositionUV(t71, e71, s67, i49, r57, n63, o60) {
    const d38 = this.getEdgeAttributeIndex(t71, e71);
    this.vertexAttributes.position.setValues(d38, s67, i49, r57), this._setUV(d38, n63, o60);
  }
  setEdgeVertexFromValuesRawPositionUVNormal(t71, e71, s67, i49, r57, n63, o60, d38, u46, g28) {
    const h32 = this.getEdgeAttributeIndex(t71, e71);
    this.vertexAttributes.position.setValues(h32, s67, i49, r57), this._setUV(h32, n63, o60), this._setNormal(h32, d38, u46, g28);
  }
  _getEdgeVertexRaw(t71, e71) {
    this.vertexAttributes.position.getVec(t71, e71);
  }
  _setNormal(t71, e71, s67, i49) {
    const {
      typedBuffer: r57,
      typedBufferStride: o60
    } = this.vertexAttributes.normalCompressed;
    s15(r57, t71, e71, s67, i49, o60);
  }
  _setUV(t71, e71, s67) {
    u34(this.vertexAttributes.uv0, t71, e71, s67);
  }
  getEdgeAttributeIndex(t71, e71) {
    return O9(0 <= e71 && e71 < this.getEdgeCount(t71)), this.getEdgeFirstVertexIndex(t71) + e71;
  }
};
var d31 = 16384;
function u34(t71, e71, s67, i49) {
  t71.setValues(e71, s67 * d31, i49 * d31);
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/PatchGeometryLUT.js
var t52 = class {
  constructor() {
    this.sinLonLUT = new Array(a22 + 1), this.cosLonLUT = new Array(a22 + 1), this.sinLatLUT = new Array(a22 + 1), this.cosLatLUT = new Array(a22 + 1);
  }
  update(s67, t71, n63) {
    const o60 = t71[0], i49 = t71[2];
    for (let r57 = 0; r57 <= s67; r57++) {
      const t72 = r57 / s67, L25 = o60 * (1 - t72) + i49 * t72;
      this.sinLonLUT[r57] = Math.sin(L25), this.cosLonLUT[r57] = Math.cos(L25);
      const a59 = n63(t72);
      this.sinLatLUT[r57] = Math.sin(a59), this.cosLatLUT[r57] = Math.cos(a59);
    }
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/GeometryState.js
var l35 = class {
  constructor() {
    this.numVerticesPerSide = 0, this.samplerData = null, this.samplerDataVersion = 0, this.clippingArea = null, this.wireframe = false, this.cornerPeerNeighbors = [null, null, null, null], this.cornerNeighborCornerTiles = [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], this.cornerNeighborCornerTileSamplerVersions = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1], this.edgeResolutions = [-1, -1, -1, -1], this.edgePeerNeighbors = [null, null, null, null], this.edgePeerNeighborSamplerVersions = [-1, -1, -1, -1];
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TextureFader.js
var i42 = class _i {
  constructor(t71) {
    this._getFadeDuration = t71, this._fadeStart = 0, this._delayedTime = 0;
  }
  clear() {
    this._current = u(this._current), this._next = u(this._next), this._waiting = u(this._waiting), this._delayed = u(this._delayed);
  }
  get current() {
    if (null == this._current) return null;
    if (!this._isFadingEnabled) {
      const t71 = this._delayed || this._waiting || this._next || this._current;
      t71 !== this._current && (this._current = null, this.clear(), this._current = t71);
    }
    let r57 = _i.test.fadeMoment;
    if (null != this._delayed && (r57 = r57 || performance.now(), r57 >= this._delayedTime && (this._push(this._delayed, n49.Immediate), this._delayed = null)), null != this._next) {
      r57 = r57 || performance.now();
      const i49 = this._fadeDuration, n63 = null != this._current && this._next.texture === this._current.texture, s67 = this._next.type !== H7.FADING, a59 = r57 - this._fadeStart >= i49;
      (n63 || s67 || a59) && (u(this._current), this._current = this._next, this._next = this._waiting, this._waiting = null, this._fadeStart = this._alignFadeStart(r57));
    }
    return this._current;
  }
  get next() {
    return this._next;
  }
  get fadeFactor() {
    if (null == this._next) return 1;
    const t71 = _i.test.fadeMoment || performance.now(), e71 = Math.max(0, t71 - this._fadeStart), n63 = this._fadeDuration;
    return e71 > n63 ? 0 : 1 - e71 / n63;
  }
  get isFading() {
    return null != this._next || null != this._delayed;
  }
  push(e71, i49 = n49.Immediate) {
    this._delayed = u(this._delayed), this._push(e71, i49);
  }
  _push(e71, r57) {
    if (this._isFadingEnabled || this.clear(), null == this._current) return void (this._current = e71);
    const s67 = _i.test.fadeMoment || performance.now();
    return r57 !== n49.Immediate ? (this._delayed = e71, void (this._delayedTime = s67 + r57)) : null == this._next ? (this._next = e71, void (this._fadeStart = this._alignFadeStart(s67))) : void (null != e71 && (u(this._waiting), this._waiting = e71));
  }
  get _fadeDuration() {
    return null == this._waiting ? this._getFadeDuration() : 0.5 * this._getFadeDuration();
  }
  _alignFadeStart(t71) {
    const e71 = this._getFadeDuration();
    return t71 + e71 - t71 % e71;
  }
  get _isFadingEnabled() {
    return this._getFadeDuration() > 0;
  }
};
var n49;
i42.test = {
  fadeMoment: 0
}, function(t71) {
  t71[t71.Immediate = 0] = "Immediate", t71[t71.Delayed = 5e3] = "Delayed";
}(n49 || (n49 = {}));

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileAgent.js
var l36 = class {
  get updating() {
    return !!this._tileRequested;
  }
  init(e71, t71, s67, i49) {
    this.tile = e71, this._layerIdx = t71, this._layerClass = s67, this._suspended = i49, this._tileLayerInfo = e71.getLayerInfo(t71, s67), this._tileRequested = null;
    const l47 = this._findAncestorWithData();
    this._setUpsampleTile(l47);
  }
  startLoading() {
    return this._requestNext();
  }
  dispose() {
    this._tileRequested && (this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null), this.tile = null, this._tileLayerInfo = null;
  }
  setSuspension(e71) {
    e71 !== this._suspended && (this._suspended = e71, e71 ? this._tileRequested && (this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null) : this._tileLayerInfo.data || this.update());
  }
  update() {
    const e71 = this._findAncestorWithData();
    return this._setUpsampleTile(e71), this._requestNext();
  }
  dataArrived(t71, s67) {
    this._setUpsampleTile(t71, s67), this._tileRequested = null, t71 === this.tile ? this.tile.updateRenderData(this._layerClass, H7.FADING, s67) : this._requestNext();
  }
  dataMissing() {
    this._tileRequested = null, this._tileLayerInfo.data = null, this._requestNext();
  }
  _agentDone() {
    this.tile.agentDone(this._layerIdx, this._layerClass), this.dispose();
  }
  _requestNext() {
    if (this._suspended) return true;
    const e71 = this._findNextDownload();
    if (this._tileRequested) {
      if (e71 === this._tileRequested) return true;
      this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null;
    }
    return null != e71 ? e71.requestLayerData(this._layerIdx, this._layerClass, this) && (this._tileRequested = e71) : this._agentDone(), !!this._tileRequested;
  }
  _findNextDownload() {
    const e71 = this._layerIdx, l47 = this._layerClass, a59 = this.tile.surface.layerViewByIndex(e71, l47), r57 = y9(a59), {
      minLevel: n63,
      maxLevel: h32
    } = a59.dataLevelRange, d38 = this._desiredMinLevelDelta, u46 = this._progressiveLevelModulo + d38, o60 = this._scaleRangeEnabled ? o29 : () => true;
    let _30 = this.tile;
    const p49 = _30.level;
    let y27;
    const f46 = this._tileLayerInfo.upsampleInfo, c44 = null != f46 ? f46.tile.level : -1, v28 = null != f46 && c44 - p49 >= d38, q20 = r57?.tilemapCache, I25 = "vector-tile-3d" === a59.type ? a59.schemaHelper : null;
    for (; _30 && o60(_30, r57, false) && _30.level >= n63; ) {
      const s67 = _30.level, i49 = p49 - s67, a60 = _30.layerInfo[l47][e71];
      if (a60.data && i49 >= d38) {
        (!v28 || s67 > c44) && this._setUpsampleTile(_30), a60.dataInvalidated && (y27 = _30);
        break;
      }
      const r58 = I25?.getLevelRowColumn(_30.lij) ?? _30.lij;
      if ("unavailable" !== q20?.getAvailability(r58[0], r58[1], r58[2]) && s67 <= h32 && !a60.data && !a60.dataMissing && ((!y27 || _30.level === n63 || s67 % n26 == 0 || p49 - y27.level < d38) && (y27 = _30), i49 >= u46)) break;
      _30 = _30.parent;
    }
    if (null != y27 && p49 - y27.level < d38) if (f46) y27 = null;
    else {
      const t71 = this._findAncestorWithData();
      if (null != t71) {
        this._setUpsampleTile(t71);
        y27 = t71.layerInfo[l47][e71].dataInvalidated ? t71 : null;
      }
    }
    return y27;
  }
  _findAncestorWithData() {
    const e71 = this.tile.elevationLevel, t71 = this._desiredMinLevelDelta;
    let s67;
    for (let i49 = this.tile; i49; i49 = i49.parent) if (i49.hasLayerData(this._layerIdx, this._layerClass)) {
      if (e71 - i49.level >= t71) return i49;
      s67 = i49;
    }
    return s67;
  }
  _setUpsampleTile(t71, s67) {
    this._tileLayerInfo.setUpsampleInfo(this.tile, t71), this.tile.updateRenderData(this._layerClass, H7.FADING, s67);
  }
  get test() {
  }
};
var a45 = class extends l36 {
  constructor() {
    super(...arguments), this.type = "none";
  }
  get _desiredMinLevelDelta() {
    throw r48;
  }
  get _progressiveLevelModulo() {
    throw r48;
  }
  dispose() {
  }
};
var r48 = new Error("Abstract method called on TileAgent");
var n50 = new a45();

// ../../../node_modules/@arcgis/core/views/3d/terrain/ElevationTileAgent.js
var t53 = class extends l36 {
  constructor() {
    super(...arguments), this.type = "elevation", this._scaleRangeEnabled = false;
  }
  get _desiredMinLevelDelta() {
    return this.tile.elevationLevelDelta - (this.tile.elevationLevel - this.tile.level);
  }
  get _progressiveLevelModulo() {
    return 0;
  }
};
function l37(e71) {
  return "elevation" === e71.type;
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/MapTileAgent.js
var t54 = class extends l36 {
  constructor() {
    super(), this.type = "map", this._scaleRangeEnabled = true;
  }
  get _desiredMinLevelDelta() {
    return 0;
  }
  get _progressiveLevelModulo() {
    return n26;
  }
};
function s54(e71) {
  return "map" === e71.type;
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileFrustumVisibility.js
var E32;
!function(E37) {
  E37[E37.INSIDE = 0] = "INSIDE", E37[E37.INTERSECTS = 1] = "INTERSECTS", E37[E37.OUTSIDE = 2] = "OUTSIDE";
}(E32 || (E32 = {}));

// ../../../node_modules/@arcgis/core/views/3d/terrain/TilePerLayerInfo.js
var l38 = class {
  constructor() {
    this.waitingAgents = new l3(), this._upsampleInfo = null, this.loadingAgent = null, this.requestPromise = null, this.requestAbort = null, this.pendingUpdates = 0;
  }
  static acquire(t71) {
    const s67 = o47.acquire();
    return s67._init(t71), s67;
  }
  release() {
    this.dispose(), p37.delete(this), o47.release(this);
  }
  dispose() {
    this.loadingAgent = r2(this.loadingAgent), this.abortRequest(), this._unsetUpsampleInfo(), this.pendingUpdates = 0, this._data = b6(this._data);
  }
  static prune() {
    o47.prune(0);
  }
  _init(t71) {
    this.waitingAgents.clear(), this._data = b6(this._data), this.dataMissing = false, this.dataInvalidated = false, this._unsetUpsampleInfo(), this.abortRequest(), this.loadingAgent = null, this.pendingUpdates = 0, this._pool = t71, this.elevationBounds = null;
  }
  invalidateSourceData() {
    this.dataInvalidated = true, this.dataMissing = false, this._unsetUpsampleInfo();
  }
  abortRequest() {
    this.requestAbort = e(this.requestAbort), this.requestPromise = null;
  }
  get upsampleInfo() {
    return this._upsampleInfo;
  }
  _unsetUpsampleInfo() {
    null != this._upsampleInfo && (this._upsampleInfo.tile.unrefMapData(), this._pool.release(this._upsampleInfo), this._upsampleInfo = null);
  }
  setUpsampleInfo(t71, s67) {
    if (t71 !== s67 && null != s67) {
      if (null == this._upsampleInfo) this._upsampleInfo = this._pool.acquire();
      else {
        if (this._upsampleInfo.tile === s67) return;
        this._upsampleInfo.tile.unrefMapData();
      }
      s67.refMapData(), m21(t71, s67, this._upsampleInfo);
    } else this._unsetUpsampleInfo();
  }
  get data() {
    return this._data;
  }
  set data(t71) {
    b6(this._data), this._data = t71;
  }
};
var o47 = new e3(l38, null, () => {
});
var p37 = /* @__PURE__ */ new Map();
function r49() {
  p37.size > 0 && (console.log(`${p37.size} live TilePerLayerInfo allocations:`), p37.forEach((t71) => console.log(t71, "\n")));
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileUpdate.js
var E33;
!function(E37) {
  E37[E37.NONE = 0] = "NONE", E37[E37.SPLIT = 1] = "SPLIT", E37[E37.ELEVATION = 2] = "ELEVATION", E37[E37.MERGE = 4] = "MERGE", E37[E37.GEOMETRY = 8] = "GEOMETRY", E37[E37.TEXTURE_NOFADING = 16] = "TEXTURE_NOFADING", E37[E37.TEXTURE_FADING = 32] = "TEXTURE_FADING";
}(E33 || (E33 = {}));

// ../../../node_modules/@arcgis/core/views/3d/terrain/Tile.js
var te3 = 0.1;
var ie4 = class {
  constructor() {
    this._lij = [0, 0, 0], this._children = [null, null, null, null], this._pendingUpdates = 0, this.renderData = null, this._dirty = true, this._previouslyRendered = false, this.extent = u6(), this._elevationBoundsMin = NaN, this._elevationBoundsMax = 0, this.layerInfo = [[], []], this.extentInRadians = u6(), this.centerAtSeaLevel = n7(), this._center = [n7(), _5(), n7()], this.up = a5(), this._isWithinClippingArea = true, this._intersectsClippingArea = true, this._maxTesselation = 0, this._usedMemory = null, this._mapTileMemoryInternal = 0, this._mapDataRefCount = 0, this.screenDepth = 0, this.renderOrder = 0, this._edgeLen = 0, this._edgeLen2 = 0, this._curvatureHeight = 0, this.extentMidX = 0, this.extentMidY = 0, this.distanceToPOI = -1, this._lastPOI = n7(), this.maxLevelDeltaNeighborCount = 0, this.unmergableChildCount = 0;
  }
  get lij() {
    return this._lij;
  }
  get elevationLevelDelta() {
    return this._surface.getElevationLevelDelta(this.level);
  }
  static prune() {
    re4.prune(0), ae4.prune(0), l38.prune();
  }
  get _isCached() {
    return !this.isLeaf && this._mapDataRefCount <= 0;
  }
  get maxTesselation() {
    return this._maxTesselation;
  }
  get isWithinClippingArea() {
    return this._isWithinClippingArea;
  }
  get intersectsClippingArea() {
    return this._intersectsClippingArea;
  }
  get clippingArea() {
    return this._clippingArea;
  }
  get parent() {
    return this._parent;
  }
  get children() {
    return this._children;
  }
  get surface() {
    return this._surface;
  }
  get elevationBoundsMin() {
    return this._elevationBoundsMin;
  }
  get elevationBoundsMax() {
    return this._elevationBoundsMax;
  }
  get level() {
    return this._lij[0];
  }
  get key() {
    return `${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`;
  }
  get edgeLen() {
    return this._edgeLen;
  }
  get radius() {
    return this._center[oe3.MIDDLE][3];
  }
  get visible() {
    return this._dirty && this.computeVisibility(), this._visible;
  }
  get frustumVisibility() {
    return this._dirty && this.computeVisibility(), this._frustumVisibility;
  }
  computeVisibility() {
    this._dirty = false;
    const e71 = this.parent, t71 = e71?.frustumVisibility ?? E32.INTERSECTS;
    this._frustumVisibility = t71 === E32.INSIDE ? E32.INSIDE : t71 === E32.OUTSIDE ? E32.OUTSIDE : this._calculateFrustumVisibilityStatus(this.surface.frustum);
    const i49 = this._frustumVisibility !== E32.OUTSIDE && this._intersectsClippingArea;
    i49 !== this._visible && (this._visible = i49, this._surface.emit("tiles-visibility-changed"), this._surface.renderer.setDirty(), this.updateAgentSuspension());
  }
  get loadable() {
    return this.visible || this._surface.view.state.fixedContentCamera;
  }
  get rendered() {
    const e71 = !!this.renderData;
    return e71 !== this._previouslyRendered && (this._surface.emit("tiles-visibility-changed"), this._previouslyRendered = e71, this._surface.renderer.setDirty()), e71;
  }
  init(e71, t71, i49, s67, n63) {
    this._lij[0] = e71, this._lij[1] = t71, this._lij[2] = i49, this.ellipsoid = s6(n63.tilingScheme.spatialReference), n63.tilingScheme.getExtent(e71, t71, i49, this.extent), n63.tilingScheme.convertExtentToRadians(this.extent, this.extentInRadians), this.extentMidX = 0.5 * (this.extent[0] + this.extent[2]), this.extentMidY = 0.5 * (this.extent[1] + this.extent[3]), this._isWithinClippingArea = true, this._intersectsClippingArea = true, this._clippingArea = null, this._mapDataRefCount = 0, n63.upsampleMapCache.pop(this.key), this._edgeLen = 0, this._edgeLen2 = 0, this._center[oe3.MIDDLE][3] = 0, this.elevationLevel = e71, s67 && !Number.isNaN(s67.elevationBoundsMin) ? (this._elevationBoundsMin = s67.elevationBoundsMin, this._elevationBoundsMax = s67.elevationBoundsMax) : (this._elevationBoundsMin = 0, this._elevationBoundsMax = 0), this._pendingUpdates = 0, this.renderData = null, this.screenDepth = 0, this._visible = false, this._previouslyRendered = false, this._parent = s67, this.unsetChildren(), this._surface = n63, this.updateVisibility(), this.maxLevelDeltaNeighborCount = 0, this.unmergableChildCount = 0;
    for (const r57 of E29) {
      const e72 = n63.numLayers(r57), t72 = this.layerInfo[r57];
      for (const i50 of t72) i50.release();
      t72.length = e72;
      for (let i50 = 0; i50 < e72; i50++) t72[i50] = l38.acquire(this._surface.upsampleInfoPool), r57 === A24.ELEVATION && this.findElevationBoundsForLayer(i50, -1);
    }
    this.computeElevationBounds(), this._maxTesselation = Math.min(n63.tilingScheme.pixelSize, a22);
  }
  dispose() {
    S8(!this.renderData, "tile.renderData was not unloaded"), this._surface.upsampleMapCache.pop(this.key);
    for (const e71 of E29) {
      for (const t71 of this.layerInfo[e71]) t71.release();
      this.layerInfo[e71].length = 0;
    }
    this._parent = null;
    for (let e71 = 0; e71 < 4; ++e71) this._children[e71] = null;
    this._surface = null, this.setMemoryDirty();
  }
  refMapData() {
    ++this._mapDataRefCount, this._isCached || this._surface.upsampleMapCache.pop(this.key);
  }
  unrefMapData() {
    if (--this._mapDataRefCount, this._isCached) {
      this.setMemoryDirty();
      const e71 = this._cachedMemory;
      e71 > 0 && this._surface.upsampleMapCache.put(this.key, this, e71);
    }
  }
  setMemoryDirty() {
    this._usedMemory = null;
  }
  get usedMemory() {
    return this._ensureUsedMemory() + (this._isCached ? 0 : this._mapTileMemoryInternal);
  }
  get _cachedMemory() {
    return this._isCached ? this._mapTileMemory : 0;
  }
  get _mapTileMemory() {
    return this._ensureUsedMemory(), this.layerInfo[A24.MAP].reduce((e71, {
      data: t71
    }) => e71 + (t31(t71) ? t71.usedMemory / t71.referenced : 0), this._mapTileMemoryInternal);
  }
  get _cpuImageMemorySize() {
    const e71 = 4, t71 = this._surface.tilingScheme.pixelSize;
    return t71 * t71 * e71;
  }
  _ensureUsedMemory() {
    if (null != this._usedMemory) return this._usedMemory;
    this._usedMemory = this._baseUsedMemory, this._mapTileMemoryInternal = 0;
    let e71 = 0;
    for (const {
      data: i49
    } of this.layerInfo[A24.MAP]) t31(i49) ? e71 += this._getTerrainDataMemory(i49) : this._mapTileMemoryInternal += this._getTerrainDataMemory(i49);
    const t71 = this._cpuImageMemorySize;
    for (const i49 of this.layerInfo[A24.ELEVATION]) this._usedMemory += i49.data ? t71 : 0;
    return this.renderData && (this._usedMemory += this.renderData.estimatedGeometryMemoryUsage, this._mapTileMemoryInternal += this.renderData.texture?.usedMemory ?? 0), this._isCached && this._surface.upsampleMapCache.updateSize(this.key, this, this._mapTileMemoryInternal + e71), this._usedMemory;
  }
  getUsedMemoryForLayer(e71, t71) {
    const i49 = this.layerInfo[e71][t71];
    return i49?.data ? e71 === A24.MAP ? this._isCached ? 0 : this._getTerrainDataMemory(i49.data) : e71 === A24.ELEVATION ? this._cpuImageMemorySize : 0 : 0;
  }
  _getTerrainDataMemory(e71) {
    return n27(e71) ? e71.texture.usedMemory : e32(e71) ? e71.memoryUsage : t31(e71) ? e71.usedMemory / e71.referenced : r29(e71) || e71 instanceof HTMLImageElement ? this._cpuImageMemorySize : 0;
  }
  updateScreenDepth(e71) {
    const t71 = this._center[oe3.MIDDLE], i49 = e71, s67 = t71[0], n63 = t71[1], r57 = t71[2], a59 = i49[2] * s67 + i49[6] * n63 + i49[10] * r57 + i49[14];
    this.screenDepth = a59 < 0 ? 0 : a59 / (i49[3] * s67 + i49[7] * n63 + i49[11] * r57 + i49[15]);
  }
  shouldSplit(e71, t71, i49) {
    if (!this.visible) return E33.NONE;
    if (e71.frustum && (!this._intersectsClippingArea || this._calculateFrustumVisibilityStatus(e71.frustum) === E32.OUTSIDE)) return E33.NONE;
    const h32 = this.level;
    e11(fe, V2(this._center[oe3.MIDDLE]), t71);
    let u46 = v3(fe), d38 = fe, c44 = V2(this._center[oe3.MIDDLE]);
    e11(_e2, this._center[oe3.TOP], t71);
    const g28 = v3(_e2);
    g28 < u46 && (u46 = g28, d38 = _e2, c44 = this._center[oe3.TOP]), e11(me2, this._center[oe3.BOTTOM], t71);
    const p49 = v3(me2);
    if (p49 < u46 && (u46 = p49, d38 = me2, c44 = this._center[oe3.BOTTOM]), this._edgeLen2 > u46 && h32 < e71.maxLod) return E33.SPLIT;
    const f46 = Math.sqrt(u46), _30 = e71.fovX * f46 * 2, y27 = this._edgeLen / _30, A32 = () => {
      if (h32 < e71.maxLod) return this.elevationLevel = h32, E33.NONE;
      const t72 = h32 + Math.ceil(-Math.log2(e71.relativeWidthLimit / y27));
      return t72 !== this.elevationLevel ? (this.elevationLevel = t72, E33.ELEVATION) : E33.NONE;
    }, M18 = null != i49 ? i49 - h32 : 1 / 0;
    if (M18 <= 0.5) return A32();
    const v28 = P3(this.up, fe), T21 = this._elevationBoundsMax - this._elevationBoundsMin, E37 = T21 / this.edgeLen;
    if (e71.aboveGround && v28 > 0 && E37 < 1e-3) {
      if (v28 / f46 - Math.sin(this._curvatureHeight / (this.edgeLen * Math.SQRT1_2) * Math.PI) - E37 > 0) return E33.NONE;
    }
    const I25 = null != i49 ? 3 - Math.min(M18, 2) : 1;
    if (y27 * I25 < e71.relativeWidthLimit || h32 >= e71.maxLod) return A32();
    if (h32 < 7) return E33.SPLIT;
    g3(ye, this.up, v28), e11(ye, ye, d38);
    const D15 = v3(ye);
    if (D15 <= this.radius * this.radius) return E33.SPLIT;
    g3(ye, ye, this.radius / Math.sqrt(D15)), u5(ye, ye, c44), e11(ye, t71, ye);
    const L25 = Math.min(1, (Math.abs(P3(ye, this.up)) + 0.5 * T21 + this._curvatureHeight) / s8(ye)), x26 = te3 / e71.angledSplitBias, S26 = e71.fovY * f46 * 2;
    return L25 * (this._edgeLen / S26 * I25) < x26 * e71.relativeHeightLimit ? E33.NONE : E33.SPLIT;
  }
  setChildren(e71, t71, i49, s67) {
    S8(!!(e71 && t71 && i49 && s67), "Null child passed");
    const n63 = this._children;
    return n63[0] = e71, n63[1] = t71, n63[2] = i49, n63[3] = s67, n63;
  }
  unsetChildren() {
    this._children[0] = null, this._children[1] = null, this._children[2] = null, this._children[3] = null;
  }
  get isLoaded() {
    return this.renderData?.hasGeometry ?? false;
  }
  load() {
    this.refMapData();
    for (const e71 of E29) this._createOrUpdateAgents(0, e71);
    this.surface.renderer.loadTile(this);
  }
  unload(e71) {
    e71.unloadTile(this);
    for (const t71 of E29) {
      const e72 = this.layerInfo[t71];
      for (const t72 of e72) t72.loadingAgent && t72.loadingAgent !== n50 && (ne4(t72.loadingAgent), t72.loadingAgent = null), t72.pendingUpdates = 0;
    }
    this.resetPendingUpdate(E33.GEOMETRY), this.resetPendingUpdate(E33.TEXTURE_NOFADING), this.resetPendingUpdate(E33.TEXTURE_FADING), this.unrefMapData();
  }
  unloadMapData() {
    const e71 = this.layerInfo[A24.MAP];
    for (const t71 of e71) t71.loadingAgent && t71.loadingAgent !== n50 && (ne4(t71.loadingAgent), t71.loadingAgent = null), t71.pendingUpdates = 0;
    this.renderData && this.renderData.releaseTexture(), this.setMemoryDirty();
  }
  updateClippingStatus(e71) {
    if (I(e71, this._clippingArea)) return false;
    const t71 = this._intersectsClippingArea, i49 = this._isWithinClippingArea;
    null != e71 ? (this._intersectsClippingArea = this.intersectsExtent(e71), this._isWithinClippingArea = this._isWithinExtent(e71)) : (this._intersectsClippingArea = true, this._isWithinClippingArea = true), this._clippingArea = e71, this.updateVisibility();
    const s67 = i49 && this._isWithinClippingArea, n63 = !(i49 || t71 || this._isWithinClippingArea || this._intersectsClippingArea);
    return !this.renderData || s67 || n63 || this.setPendingUpdate(E33.GEOMETRY), true;
  }
  updateVisibility() {
    this._dirty = true, this._surface.setTileTreeDirty();
  }
  getLayerInfo(e71, t71) {
    return this.layerInfo[t71][e71];
  }
  hasLayerData(e71, t71) {
    const i49 = this.layerInfo[t71][e71];
    return !(!i49?.data || i49.dataInvalidated);
  }
  get updating() {
    if (this.hasPendingUpdates) return true;
    for (const e71 of E29) {
      const t71 = this.layerInfo[e71];
      for (const e72 of t71) if (e72.loadingAgent && e72.loadingAgent !== n50 && e72.loadingAgent.updating) return true;
    }
    return false;
  }
  _isSuspended(e71) {
    return !!this.hasPendingUpdate(E33.SPLIT) || e71 !== A24.ELEVATION && !this.loadable;
  }
  get hasPendingUpdates() {
    return 0 !== this._pendingUpdates;
  }
  hasPendingUpdate(e71) {
    return (this._pendingUpdates & e71) === e71;
  }
  setPendingUpdate(e71) {
    const t71 = this._pendingUpdates;
    return this._pendingUpdates |= e71, e71 === E33.SPLIT || e71 === E33.MERGE ? this._surface.setTileTreeDirty() : this._surface.requestUpdate(), t71 !== this._pendingUpdates;
  }
  resetPendingUpdate(e71) {
    return !!this.hasPendingUpdate(e71) && (this._pendingUpdates &= ~e71, true);
  }
  requestLayerData(e71, i49, s67) {
    const n63 = this.layerInfo[i49][e71];
    if (n63.waitingAgents.has(s67)) return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)", this._lij.toString(), s67.tile.lij.toString(), i49, e71), true;
    if (n63.waitingAgents.push(s67), n63.data && !n63.dataInvalidated) {
      console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)", this._lij.toString(), s67.tile.lij.toString(), i49, e71);
      const t71 = t31(n63.data);
      return s67.dataArrived(this, t71), true;
    }
    if (n63.requestPromise) return true;
    e(n63.requestAbort), n63.requestAbort = new AbortController();
    const r57 = this._surface.requestTileData(this, e71, i49, n63.requestAbort);
    if (!r57) return n63.requestAbort = null, false;
    const a59 = () => {
      n63.requestPromise === r57 && (n63.requestPromise = null, n63.requestAbort = null);
    };
    return n63.requestPromise = r57, r57.then(a59, a59), true;
  }
  get isLeaf() {
    return null == this._children[0];
  }
  hasLij(e71) {
    return this._lij[0] === e71[0] && this._lij[1] === e71[1] && this._lij[2] === e71[2];
  }
  findByLij(e71) {
    if (this.hasLij(e71)) return this;
    const t71 = this._children;
    if (!t71[0]) return null;
    return t71[0].findByLij(e71) || t71[1].findByLij(e71) || t71[2].findByLij(e71) || t71[3].findByLij(e71);
  }
  distanceToSquared(e71) {
    return v3(e11(ye, V2(this._center[oe3.MIDDLE]), e71));
  }
  containsPoint(e71) {
    const t71 = this.extent;
    return e71[0] >= t71[0] && e71[1] >= t71[1] && e71[0] <= t71[2] && e71[1] <= t71[3];
  }
  containsPointXY(e71, t71) {
    const i49 = this.extent;
    return e71 >= i49[0] && t71 >= i49[1] && e71 <= i49[2] && t71 <= i49[3];
  }
  unrequestLayerData(e71, t71, i49) {
    const s67 = this.layerInfo[t71][e71], n63 = s67.waitingAgents, r57 = null != n63.removeUnordered(i49);
    S8(r57, "agent has not requested this piece of map data"), n63.length < 1 && (s67.abortRequest(), this.setMemoryDirty());
  }
  dataArrived(e71, t71, i49) {
    const s67 = t31(i49), n63 = this.layerInfo[t71][e71];
    n63.data = i49, n63.dataInvalidated = false, n63.waitingAgents.forAll((e72) => e72.dataArrived(this, s67)), n63.waitingAgents.clear(), this.setMemoryDirty();
  }
  dataMissing(e71, t71) {
    const i49 = this.layerInfo[t71][e71];
    i49.dataMissing = true, i49.waitingAgents.forAll((e72) => e72.dataMissing()), i49.waitingAgents.clear(), this.setMemoryDirty();
  }
  updateRenderData(e71, t71, i49) {
    switch (i49 && this.forEachLoadedNeighbor((i50) => i50.updateRenderData(e71, t71)), e71) {
      case A24.MAP:
        return this._updateTexture(t71);
      case A24.ELEVATION:
        return this._updateGeometry();
    }
  }
  _updateTexture(e71) {
    this.renderData && (this.resetPendingUpdate(e71 === H7.FADING ? E33.TEXTURE_NOFADING : E33.TEXTURE_FADING), this.setPendingUpdate(e71 === H7.FADING ? E33.TEXTURE_FADING : E33.TEXTURE_NOFADING));
  }
  _updateGeometry() {
    this.setPendingUpdate(E33.GEOMETRY);
    for (const e71 of this.layerInfo[A24.ELEVATION]) e71.pendingUpdates |= E33.GEOMETRY;
  }
  invalidateLayerData(e71, t71) {
    this.layerInfo[t71][e71].invalidateSourceData(), this.restartAgents(t71);
  }
  computeElevationBounds() {
    const e71 = this._elevationBoundsMin, t71 = this._elevationBoundsMax;
    let i49 = 1 / 0, s67 = -1 / 0;
    const n63 = this.layerInfo[A24.ELEVATION];
    let r57 = true;
    for (const a59 of n63) null != a59.elevationBounds && (i49 = Math.min(i49, a59.elevationBounds.min), s67 = Math.max(s67, a59.elevationBounds.max), a59.elevationBounds.hasNoDataValues || (r57 = false));
    r57 && (i49 = Math.min(i49, 0), s67 = Math.max(s67, 0)), e71 === i49 && t71 === s67 || (this._elevationBoundsMin = i49, this._elevationBoundsMax = s67, this.updateRadiusAndCenter(), this._surface.setTileTreeDirty());
  }
  _updateCenter() {
    const e71 = this._elevationBoundsMin, t71 = this._elevationBoundsMax, i49 = 0.5 * (e71 + t71), s67 = this._center;
    g3(ye, this.up, i49), u5(V2(s67[oe3.MIDDLE]), this.centerAtSeaLevel, ye), g3(ye, this.up, e71), u5(s67[oe3.TOP], this.centerAtSeaLevel, ye), g3(ye, this.up, t71), u5(s67[oe3.BOTTOM], this.centerAtSeaLevel, ye);
  }
  findElevationBoundsForLayer(e71, t71) {
    const i49 = this.layerInfo[A24.ELEVATION][e71], s67 = this.elevationLevelDelta, n63 = Math.max(this.elevationLevel - s67, 0), r57 = i49.elevationBounds;
    if (null != r57 && r57.level >= t71 && r57.level <= n63) return;
    const a59 = this._surface.layerViewByIndex(e71, A24.ELEVATION), l47 = y9(a59);
    if (!o29(this, l47, false)) return;
    const o60 = le3;
    let h32 = false;
    const u46 = i49.data;
    if (u46 && u46.level <= n63) {
      const e72 = i49.data;
      o60.min = e72.samplerData.data.minValue, o60.max = e72.samplerData.data.maxValue, o60.hasNoDataValues = e72.samplerData.data.hasNoDataValues, o60.level = this.level, h32 = true;
    } else {
      let t72, i50, r58 = 0;
      for (let a60 = this._parent; a60 && (!i50 || r58 < s67) && (r58 = this.elevationLevel - a60.level, t72 = i50 || t72, i50 = a60.layerInfo[A24.ELEVATION][e71].data, !(!i50 && t72 && a60.level <= n63)); a60 = a60.parent) ;
      i50 = i50 || t72, i50 && (i50.computeMinMaxValue(this._lij[0], this._lij[1], this._lij[2], o60), o60.min !== 1 / 0 && (o60.level = i50.level, h32 = true));
    }
    h32 && (null == i49.elevationBounds && (i49.elevationBounds = new s53()), i49.elevationBounds.copyFrom(o60));
  }
  modifyLayers(e71, t71, i49) {
    const s67 = this.layerInfo[i49];
    for (const a59 of s67) a59.loadingAgent && a59.loadingAgent !== n50 && (ne4(a59.loadingAgent), a59.loadingAgent = null), a59.waitingAgents.clear();
    for (let a59 = 0; a59 < s67.length; ++a59) void 0 === e71[a59] && s67[a59].release();
    const n63 = new Array(...s67), r57 = t71.length;
    s67.length = r57;
    for (let a59 = 0; a59 < r57; a59++) {
      const e72 = t71[a59];
      s67[a59] = e72 > -1 ? n63[e72] : l38.acquire(this._surface.upsampleInfoPool);
    }
    this.setMemoryDirty();
  }
  restartAgents(e71) {
    this.renderData && (this._createOrUpdateAgents(0, e71), this.updateRenderData(e71, H7.FADING));
  }
  updateAgents(e71) {
    if (this.renderData) {
      const t71 = this.layerInfo[e71];
      for (const e72 of t71) e72.loadingAgent === n50 && (e72.loadingAgent = null);
      this._createOrUpdateAgents(0, e71);
    }
  }
  updateAgentSuspension() {
    for (const e71 of E29) {
      const t71 = this._isSuspended(e71);
      for (const i49 of this.layerInfo[e71]) i49.loadingAgent && i49.loadingAgent !== n50 && (i49.loadingAgent.setSuspension(t71), i49.loadingAgent === n50 && this.updateRenderData(e71, H7.FADING));
    }
  }
  removeLayerAgent(e71, t71) {
    const i49 = this.layerInfo[t71][e71];
    i49.loadingAgent && i49.loadingAgent !== n50 && i49.loadingAgent.dispose(), i49.loadingAgent = null;
  }
  agentDone(e71, t71) {
    const i49 = this.layerInfo[t71][e71];
    i49.loadingAgent = n50, i49.data || null != i49.upsampleInfo || this._createOrUpdateAgents(e71 + 1, t71);
  }
  _hasBlendableAncestor(e71) {
    return "normal" !== e71.blendMode || p6(e71.parent) && this._hasBlendableAncestor(e71.parent);
  }
  _hasBlendModes(e71, t71, i49) {
    for (let s67 = e71; s67 < t71; ++s67) {
      const e72 = this._surface.layerViewByIndex(s67, i49);
      if (A9(e72) && "normal" !== e72?.layer?.blendMode || p6(e72?.layer?.parent) && this._hasBlendableAncestor(e72?.layer?.parent)) return true;
    }
    return false;
  }
  _createOrUpdateAgents(e71, t71) {
    const i49 = this.layerInfo[t71];
    if (0 === i49.length) return;
    const s67 = this._isSuspended(t71);
    for (let n63 = e71; n63 < i49.length; ++n63) {
      const r57 = i49[n63];
      let a59 = false;
      const l47 = this._surface.layerViewByIndex(n63, t71), o60 = y9(l47);
      if (r57.loadingAgent ? o29(this, o60, false) ? (r57.loadingAgent !== n50 && r57.loadingAgent.setSuspension(s67), r57.loadingAgent !== n50 && (a59 = r57.loadingAgent.update())) : r57.dispose() : o29(this, o60, false) && (r57.loadingAgent = se5(this, n63, t71, s67), a59 = r57.loadingAgent.startLoading(), a59 ? r57.loadingAgent === n50 && this.setPendingUpdate(E33.GEOMETRY) : (ne4(r57.loadingAgent), r57.loadingAgent = n50)), r57.loadingAgent === n50 && this.updateRenderData(t71, H7.FADING), !this._hasBlendModes(e71, i49.length, t71) && a59 && l47.isOpaque) return;
    }
  }
  _isWithinExtent(e71) {
    const t71 = this.extent;
    return t71[0] >= e71[0] && e71[2] >= t71[2] && t71[1] >= e71[1] && e71[3] >= t71[3];
  }
  intersectsExtent(e71) {
    const t71 = this.extent;
    return t71[2] >= e71[0] && e71[2] >= t71[0] && t71[3] >= e71[1] && e71[3] >= t71[1];
  }
  getElevationVerticesPerSide(t71) {
    const i49 = this.elevationLevel - this.level, s67 = Math.max(this.level - t71, this.elevationLevelDelta - i49), n63 = e12(1 + (this.maxTesselation >> s67), 2, this.maxTesselation + 1), r57 = this.getDefaultVerticesPerSide();
    return Math.max(n63, r57);
  }
  _findLIJ(e71, t71) {
    if (!e71) return null;
    const i49 = this.surface.rootTiles;
    if (null != i49) {
      for (const s67 of i49) if (he2(s67, e71)) {
        let i50 = s67, n63 = e71[0] - i50.level - 1;
        for (; n63 >= 0 && !i50.isLeaf && !t71(i50); ) {
          const t72 = e71[1] >> n63 & 1, s68 = e71[2] >> n63 & 1;
          i50 = i50.children[2 * t72 + s68], n63--;
        }
        return t71(i50) ? i50 : null;
      }
    }
    return null;
  }
  findNeighborTile(e71, t71) {
    const i49 = this._lij, s67 = this.getNeighborLIJ(i49, e71);
    return s67 ? ue2(i49, s67) ? t71(this) ? this : null : this._findLIJ(s67, t71) : null;
  }
  findCorner(e71, t71) {
    const i49 = e71 === T6.NORTH_EAST ? 1 : e71 === T6.NORTH_WEST ? 0 : e71 === T6.SOUTH_WEST ? 2 : 3;
    let s67 = this;
    for (; s67.children[0] && (!t71 || !t71(s67)); ) s67 = s67.children[i49];
    return s67;
  }
  findNeighborCornerTileExact(e71, t71) {
    return this.findNeighborTile(e71, (e72) => t71(e72) || e72.level === this.level)?.findCorner(z6(e71), t71) || null;
  }
  forAllSubtreeOnSide(e71, t71) {
    const i49 = e71 === T6.NORTH ? [0, 1] : e71 === T6.NORTH_EAST ? [1] : e71 === T6.EAST ? [1, 3] : e71 === T6.SOUTH_EAST ? [3] : e71 === T6.SOUTH ? [2, 3] : e71 === T6.SOUTH_WEST ? [2] : e71 === T6.WEST ? [0, 2] : [0], s67 = (e72) => {
      const n63 = e72.children;
      !t71(e72) && n63[0] && i49.forEach((e73) => s67(n63[e73]));
    };
    s67(this);
  }
  getNeighborEdgeStartVertexIndex(e71, t71) {
    if (!t71) return 0;
    const i49 = this.level - t71.level;
    if (O9(!E16 || i49 >= 0), 0 === i49) return 0;
    const s67 = 2 ** i49, n63 = !(1 & ~e71), r57 = n63 ? 0 : 1, a59 = t71.lij[r57 + 1] * s67, l47 = this._lij[r57 + 1], o60 = l47 - a59, h32 = n63 ? s67 - 1 - o60 : o60;
    return E16 && (O9(a59 <= l47 && l47 < a59 + s67), O9(0 <= h32 && h32 < s67)), h32;
  }
  forEachLoadedNeighbor(e71) {
    const t71 = this.level, i49 = (e72) => e72.level === t71 || e72.isLoaded;
    nn.forEach((t72) => {
      const s67 = this.findNeighborTile(t72, i49);
      null != s67 && s67 !== this && s67.forAllSubtreeOnSide(J4(t72), (i50) => !!i50.isLoaded && (e71(i50, t72), true));
    }), tn.forEach((t72) => {
      const s67 = this.findNeighborTile(t72, i49)?.findCorner(z6(t72), (e72) => e72.isLoaded);
      O9(!s67 || ce4(this, s67, t72)), s67?.isLoaded && e71(s67, t72);
    });
  }
  getNeighborLIJ(e71, t71) {
    const i49 = $2(t71) ? -1 : Z3(t71) ? 1 : 0, s67 = X5(t71) ? -1 : Y4(t71) ? 1 : 0, n63 = [e71[0], e71[1] + i49, e71[2] + s67];
    return n63[1] < 0 ? null : this.surface.isGlobal ? this.wrapLIJ(n63) : n63[2] < 0 ? null : n63;
  }
  wrapLIJ(e71) {
    return !e71 || e71[1] < 0 || e71[1] >= 2 ** e71[0] ? null : this.surface.wrapEastWest(e71);
  }
  get westNeighborWestExtent() {
    return this.extent[0] * (this.isWestEnd ? -1 : 1);
  }
  get eastNeighborEastExtent() {
    return this.extent[2] * (this.isEastEnd ? -1 : 1);
  }
  get isEastEnd() {
    return this._lij[2] === this.surface.lijEastEnd(this.level) - 1;
  }
  get isWestEnd() {
    return 0 === this._lij[2];
  }
  get isNorthEnd() {
    return 0 === this._lij[1];
  }
  get isSouthEnd() {
    const e71 = this.surface.extent, t71 = e71?.[1] ?? null;
    return null != t71 && this.extent[1] + e10() >= t71;
  }
  checkGeometryWaterproofness() {
    m17 && (O9(this.isLoaded), this.renderData?.checkGeometryWaterproofness());
  }
  shouldHaveNeighbor(e71) {
    const t71 = this.extent, i49 = this.surface.rootTilesExtent, s67 = 0.25 * (t71[2] - t71[0]);
    if ($2(e71) && t71[3] + s67 >= i49[3]) return false;
    if (Z3(e71) && t71[1] - s67 <= i49[1]) return false;
    const n63 = this.surface.isGlobal;
    return !(!n63 && X5(e71) && t71[0] - s67 <= i49[0]) && !(!n63 && Y4(e71) && t71[2] + s67 >= i49[2]);
  }
  updateDistanceToPOI(e71) {
    const t71 = this._lastPOI;
    if (this.distanceToPOI >= 0 && t71[0] === e71[0] && t71[1] === e71[1] && t71[2] === e71[2]) return;
    r5(this._lastPOI, e71);
    const i49 = this._center[oe3.MIDDLE], s67 = e71[0] - i49[0], n63 = e71[1] - i49[1], r57 = e71[2] - i49[2];
    this.distanceToPOI = s67 * s67 + n63 * n63 + r57 * r57;
  }
  get test() {
    return {
      cachedMemory: this._cachedMemory
    };
  }
};
function se5(e71, t71, i49, s67) {
  const n63 = i49 === A24.ELEVATION ? ae4.acquire() : re4.acquire();
  return n63.init(e71, t71, i49, s67), n63;
}
function ne4(e71) {
  e71.dispose(), l37(e71) ? ae4.release(e71) : s54(e71) && re4.release(e71);
}
var re4 = new e3(t54);
var ae4 = new e3(t53);
var le3 = new s53();
var oe3;
function he2(e71, t71) {
  const i49 = e71.lij, s67 = t71[0] - i49[0];
  return !(s67 < 0) && t71[1] >> s67 === i49[1] && t71[2] >> s67 === i49[2];
}
function ue2(e71, t71) {
  return e71[0] === t71[0] && e71[1] === t71[1] && e71[2] === t71[2];
}
function de2(e71, t71, i49) {
  if (null == e71 || null == t71) return false;
  if (0 === e71.level && 0 === t71.level) {
    if (e71.isEastEnd && t71.isWestEnd && i49 === T6.EAST) return true;
    if (e71.isWestEnd && t71.isEastEnd && i49 === T6.WEST) return true;
  }
  const s67 = Math.max(1e-6 * (e71.extent[2] - e71.extent[0]), 1);
  switch (i49) {
    case T6.NORTH:
      return q5(e71.extent[3], t71.extent[1], s67);
    case T6.SOUTH:
      return q5(e71.extent[1], t71.extent[3], s67);
    case T6.EAST:
      return q5(e71.extent[2], t71.extent[0], s67) || q5(e71.extent[2], -t71.extent[0], s67);
    case T6.WEST:
      return q5(e71.extent[0], t71.extent[2], s67) || q5(e71.extent[0], -t71.extent[2], s67);
  }
}
function ce4(e71, t71, i49) {
  return null != e71 && null != t71 && t71 !== e71 && (e71.level >= t71.level ? ge(e71, t71, i49) : ge(t71, e71, z6(i49)));
}
function ge(e71, t71, i49) {
  O9(e71.level >= t71.level);
  const s67 = K5(i49), n63 = Q4(i49), r57 = e71.extent, a59 = t71.extent, l47 = [s67 ? r57[0] : r57[2], n63 ? r57[3] : r57[1]], o60 = [s67 ? a59[2] : a59[0], n63 ? a59[1] : a59[3]], h32 = 1e-5 * (r57[2] - r57[0]), u46 = q5(l47[0], o60[0], h32) || e71.surface.isGlobal && q5(l47[0], -o60[0], h32), d38 = q5(l47[1], o60[1], h32);
  if (u46 && d38) return true;
  if (e71.level === t71.level) return O9(false), false;
  if (!u46 && !d38) return O9(false), false;
  const c44 = u46 ? pe2(a59[1], a59[3], r57[1], r57[3], h32) : pe2(a59[0], a59[2], r57[0], r57[2], h32);
  return O9(c44), c44;
}
function pe2(e71, t71, i49, s67, n63) {
  return e71 - n63 <= i49 && i49 <= s67 && s67 <= t71 + n63;
}
!function(e71) {
  e71[e71.TOP = 0] = "TOP", e71[e71.MIDDLE = 1] = "MIDDLE", e71[e71.BOTTOM = 2] = "BOTTOM";
}(oe3 || (oe3 = {}));
var fe = n7();
var _e2 = n7();
var me2 = n7();
var ye = n7();

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileOverlayData.js
var t55 = class {
  constructor() {
    this._scales = r6(-1, -1, -1, -1), this._offsets = r6(-1, -1, -1, -1);
  }
  clear() {
    this._scales[0] = this._scales[1] = this._scales[2] = this._scales[3] = -1, this._offsets[0] = this._offsets[1] = this._offsets[2] = this._offsets[3] = -1;
  }
  setScale(s67, t71, e71) {
    this._scales[2 * s67] = t71, this._scales[2 * s67 + 1] = e71;
  }
  setOffset(s67, t71, e71) {
    this._offsets[2 * s67] = t71, this._offsets[2 * s67 + 1] = e71;
  }
  get scales() {
    return this._scales;
  }
  get offsets() {
    return this._offsets;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/TerrainTechnique.js
var b16 = class _b extends r17 {
  constructor() {
    super(...arguments), this.useStencil = false;
  }
  initializeConfiguration(r57, i49) {
    i49.spherical = r57.viewingMode === l9.Global;
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _b.shader.get().build(this.configuration), S20);
  }
  initializePipeline() {
    return this._stencilPipelineState = this._createPipeline(true), this._createPipeline(false);
  }
  _createPipeline(e71) {
    const i49 = this.configuration, t71 = i49.backfaceCullingEnabled && !i49.renderOccluded;
    return S7({
      blending: i49.renderOccluded ? s20(R3.ONE, R3.ONE_MINUS_SRC_ALPHA) : null,
      culling: t71 ? r16 : null,
      depthTest: i49.renderOccluded ? null : {
        func: O6.LESS
      },
      depthWrite: i49.renderOccluded ? null : o17,
      colorWrite: _9,
      stencilTest: e71 ? t17(N2.IntegratedMeshMaskExcluded) : null,
      drawBuffers: i49.output === o9.Depth ? {
        buffers: [f10.NONE]
      } : null
    });
  }
  getPipeline() {
    return this.useStencil ? this._stencilPipelineState : super.getPipeline();
  }
};
b16.shader = new t16(q7, () => import("./Terrain.glsl-DXV5NTZX.js"));
var S20 = /* @__PURE__ */ new Map([[e18.POSITION, 0], [e18.UV0, 1], [e18.NORMALCOMPRESSED, 2]]);

// ../../../node_modules/@arcgis/core/views/3d/terrain/PatchRenderData.js
var G11 = class {
  constructor() {
    this.geometry = new o46(), this.intersectionData = null, this.geometryState = null, this._vao = null, this._texture = null, this._textureRef = new i42(() => this.tile.surface.fadeDuration), this.overlay = new t55(), this._localOrigin = null, this._geometryStateChangedSinceLastUpdate = true, this._hasGeometry = false, this._modifiedFlags = 0;
  }
  get tile() {
    return this._tile;
  }
  get localOrigin() {
    return this._localOrigin;
  }
  init(e71, t71) {
    this.clear(), this._tile = e71, this.geometry.reset(), this.intersectionData = null, this.geometryState = new l35(), this._localOrigin = t71, this.overlay.clear();
  }
  clear() {
    this.releaseGeometry(), this.releaseTexture(), this._textureRef.clear(), this._tile = null, this.intersectionData = null, this.geometryState = null;
  }
  updateGeometryIfNeeded(e71) {
    if ((!this._vao || this._geometryStateChangedSinceLastUpdate || this.wireframeChanged || this.clippingAreaChanged || this.samplerDataChanged || this.numVerticesPerSideChanged || this.dirtyCorners || this.dirtyEdgeResolutions || this.dirtyEdges) && (this._updateGeometry(e71), this._geometryStateChangedSinceLastUpdate = false), E16 && this.tile.intersectsClippingArea) for (let t71 = 0; t71 < 4; ++t71) O9(this.geometry.getEdgeCount(t71) === this.geometryState.edgeResolutions[t71] + 1);
  }
  _calculateEdgeResolution(e71, t71) {
    const r57 = this.tile, i49 = this.geometryState.numVerticesPerSide - 1;
    if (!r57.surface.isGlobal) {
      const t72 = r57.surface.extent;
      if (null != t72 && (0 === e71 && r57.extent[3] > t72[3] || 1 === e71 && r57.extent[2] > t72[2] || 2 === e71 && r57.extent[1] < t72[1] || 3 === e71 && r57.extent[0] < t72[0])) return i49;
    }
    const s67 = r57.level, o60 = nn[e71];
    if (!t71) return O9(null == r57.surface?.rootTiles || r57.surface.updatingRootTiles || !r57.shouldHaveNeighbor(o60)), i49;
    if (t71.isLoaded) {
      const r58 = t71, o61 = r58.renderData.geometryState, a60 = s67 - r58.level;
      if (O9(a60 >= 0), 0 === a60) {
        const e72 = o61.numVerticesPerSide - 1;
        return Math.max(e72, i49);
      }
      const n63 = 2 ** a60, l47 = o61.edgeResolutions[(e71 + 2) % 4] / n63;
      return Math.max(1, l47);
    }
    O9(!t71.isLeaf);
    let a59 = i49;
    return t71.forAllSubtreeOnSide(J4(o60), (e72) => e72 === r57 || (e72.isLoaded ? (a59 = Math.max(a59, 2 ** (e72.level - s67)), true) : (O9(!e72.isLeaf), false))), a59;
  }
  updateNeighborData() {
    const e71 = this.tile;
    if (!e71.intersectsClippingArea) return;
    const r57 = e71.renderData.geometryState, i49 = (t71) => (t71.isLoaded || t71.level === e71.level) && t71?.intersectsClippingArea, s67 = r57.edgePeerNeighbors, o60 = r57.edgePeerNeighborSamplerVersions;
    for (let a59 = 0; a59 < 4; ++a59) {
      const n63 = e71.findNeighborTile(nn[a59], i49), l47 = W7(e71, n63), g28 = l47?.renderData?.geometryState.samplerDataVersion ?? -1, d38 = s67[a59], h32 = l47 !== W7(e71, d38), m45 = o60[a59] !== g28;
      E16 && n63 && (O9(e71.level >= n63.level), O9(e71.level - n63.level <= f16)), s67[a59] = n63, (h32 || m45) && (o60[a59] = g28, this._markEdgeDirty(a59));
      const u46 = r57.edgeResolutions[a59], c44 = this._calculateEdgeResolution(a59, n63);
      O9(a6(c44)), O9(c44 >= 1), r57.edgeResolutions[a59] = c44, u46 !== c44 && this._markEdgeResolutionDirty(a59);
    }
    for (let t71 = 0; t71 < 4; ++t71) {
      const o61 = e71.findNeighborTile(tn[t71], i49);
      r57.cornerPeerNeighbors[t71] = o61;
      const a59 = W7(e71, s67[t71]), n63 = W7(e71, s67[(t71 + 1) % 4]), l47 = W7(e71, o61);
      B11[t71] = l47, B11[(t71 + 1) % 4] = n63, B11[(t71 + 2) % 4] = e71, B11[(t71 + 3) % 4] = a59, O9(B11.some((t72) => t72?.isLoaded || t72 === e71));
      const g28 = B11.reduce((e72, t72) => Math.min(e72, t72?.level ?? 1 / 0), 1 / 0);
      B11.forEach((e72, t72) => {
        e72 && e72?.level > g28 && (B11[t72] = null);
      }), O9(B11.some((t72) => t72?.isLoaded || t72 === e71));
      const d38 = r57.cornerNeighborCornerTiles, h32 = r57.cornerNeighborCornerTileSamplerVersions;
      for (let e72 = 0; e72 < 4; ++e72) {
        const r58 = B11[e72], i50 = r58?.renderData.geometryState.samplerDataVersion ?? -1, s68 = 4 * t71 + e72, o62 = d38[s68] !== r58, a60 = !o62 && h32[s68] !== i50;
        (o62 || a60) && (d38[s68] = r58, h32[s68] = i50, this._markCornerDirty(t71));
      }
      E16 && O9(ee3.some((r58) => d38[4 * t71 + r58]?.isLoaded || d38[4 * t71 + r58] === e71));
    }
    E16 && O9(this.geometryState.edgeResolutions.every((e72) => e72 > 0));
    for (let t71 = 0; t71 < 4; ++t71) B11[t71] = null;
  }
  _updateGeometry(e71) {
    if (!this.tile.intersectsClippingArea) return;
    E16 && O9(!this.tile.intersectsClippingArea || this.geometryState.edgeResolutions.every((e72) => e72 > 0)), this.intersectionData = null;
    const {
      tile: t71,
      _vao: r57,
      geometry: i49,
      geometryState: s67
    } = this, o60 = !r57 || !{
      geometry: i49
    } || this.wireframeChanged || this.samplerDataChanged || this.clippingAreaChanged || this.numVerticesPerSideChanged, a59 = 0 !== this.dirtyEdgeResolutions, n63 = s67.edgeResolutions.reduce((e72, t72) => e72 + t72 + 1, 0), l47 = o60 || a59 && n63 > (i49?.maxEdgeVertexCount ?? 0), g28 = !l47 && a59, d38 = !g28 && (0 !== this.dirtyEdges || a59), h32 = !d38 && 0 !== this.dirtyCorners;
    l47 ? (this.releaseGeometry(), this._createGeometry(e71)) : g28 ? t71.updateEdgeElevationsAndResolutions() : d38 || h32 ? t71.updateEdgeElevations() : h32 ? t71.updateCornerElevations() : console.warn("Update for no reason?"), this._modifiedFlags = 0;
  }
  get hasGeometry() {
    return this._hasGeometry;
  }
  releaseGeometry() {
    return this._hasGeometry = false, this.intersectionData = null, !!this._vao && (this._vao = r2(this._vao), this.geometry.release(), true);
  }
  ensureTexture(e71, t71, r57) {
    const i49 = t71 ? G4.RGBA : G4.RGB;
    return null == this._texture || this._texture.descriptor.width === e71 && this._texture.descriptor.pixelFormat === i49 || this.releaseTexture(), null == this._texture && (this._texture = r57(), this.tile.setMemoryDirty()), this._texture;
  }
  releaseTexture() {
    null != this._texture && (this._texture.release(), this._texture = null, this.tile.setMemoryDirty());
  }
  get numVerticesPerSideChanged() {
    return !!(this._modifiedFlags & q14);
  }
  get samplerDataChanged() {
    return !!(this._modifiedFlags & z15);
  }
  get clippingAreaChanged() {
    return !!(this._modifiedFlags & J11);
  }
  get wireframeChanged() {
    return !!(this._modifiedFlags & K11);
  }
  get dirtyEdges() {
    return this._modifiedFlags >> Q15 & 15;
  }
  get dirtyCorners() {
    return this._modifiedFlags >> Y10 & 15;
  }
  get dirtyEdgeResolutions() {
    return this._modifiedFlags >> Z9 & 15;
  }
  _markCornerDirty(e71) {
    const t71 = 1 << e71 << Y10;
    this._modifiedFlags |= t71;
  }
  _markEdgeDirty(e71) {
    const t71 = 1 << e71 << Q15;
    this._modifiedFlags |= t71, this._markCornerDirty((e71 + 0) % 4), this._markCornerDirty((e71 + 3) % 4);
  }
  _markEdgeResolutionDirty(e71) {
    const t71 = 1 << e71 << Z9;
    this._modifiedFlags |= t71, this._markEdgeDirty(e71);
  }
  _markAllEdgesAndCornersDirty() {
    this._modifiedFlags |= 15 << Y10 | 15 << Q15 | 15 << Z9;
  }
  updateGeometryState() {
    const t71 = this._getElevationInfo(), r57 = this.tile, i49 = t71.samplerData ? r57.getElevationVerticesPerSide(t71.maxTileLevel) : r57.getDefaultVerticesPerSide(), s67 = Math.max(i49, 5);
    let o60 = r57.clippingArea;
    r57.intersectsClippingArea && !r57.isWithinClippingArea || (o60 = null);
    const a59 = this.geometryState;
    let n63 = false;
    a59.numVerticesPerSide !== s67 && (this._modifiedFlags |= 1, a59.numVerticesPerSide = s67, a59.samplerDataVersion++, n63 = true), t71.changed && (this._modifiedFlags |= 2, a59.samplerData = t71.samplerData, a59.samplerDataVersion++, n63 = true), h(a59.clippingArea, o60) || (this._modifiedFlags = 4, a59.clippingArea = o60, n63 = true);
    const l47 = r57.surface.wireframe;
    return a59.wireframe !== l47 && (this._modifiedFlags = 8, a59.wireframe = l47, n63 = true), this._geometryStateChangedSinceLastUpdate ||= n63, n63 && this._markAllEdgesAndCornersDirty(), this._hasGeometry = true, this._geometryStateChangedSinceLastUpdate;
  }
  _createGeometry(e71) {
    this.tile.createGeometry();
    const t71 = this.geometry.vertexAttributes, r57 = this.geometry.indices, i49 = e71.gl;
    this._vao = new r32(e71, S20, {
      geometry: t8(t71.layout)
    }, {
      geometry: c7.createVertex(e71, i49.STATIC_DRAW, t71.buffer)
    }, c7.createIndex(e71, i49.STATIC_DRAW, r57)), this._hasGeometry = true;
  }
  get vao() {
    return this._vao;
  }
  setTextureReference(e71, t71 = n49.Immediate) {
    null != e71 && e71.texture !== this._texture && this.releaseTexture(), this._textureRef.push(e71, t71);
  }
  get textureReference() {
    return this._textureRef.current;
  }
  get nextTextureReference() {
    return this._textureRef.next;
  }
  get textureFadeFactor() {
    return this._textureRef.fadeFactor;
  }
  get textureIsFading() {
    return this._textureRef.isFading;
  }
  _getElevationInfo() {
    const e71 = this.geometryState.samplerData, t71 = this.tile.layerInfo[A24.ELEVATION], r57 = t71.length, i49 = new Array(r57);
    let s67 = 0, o60 = 0, a59 = false;
    for (let g28 = 0; g28 < r57; g28++) {
      const r58 = t71[g28];
      if (null != r58.upsampleInfo) {
        const t72 = r58.upsampleInfo.tile, n64 = t72.layerInfo[A24.ELEVATION][g28].data, l48 = n64 && n64.samplerData;
        e71 && e71[s67] === l48 || (a59 = true), i49[s67++] = l48, o60 = Math.max(o60, t72.lij[0]);
      } else if (r58.data) {
        const t72 = this.tile.surface.layerViewByIndex(g28, A24.ELEVATION);
        if (o29(this.tile, t72.layer, false)) {
          const t73 = r58.data;
          e71 && e71[s67] === t73.samplerData || (a59 = true), i49[s67++] = t73.samplerData, o60 = this.tile.level;
        }
      }
    }
    null != e71 && e71.length !== s67 && (a59 = true);
    const n63 = s67 > 0, l47 = n63 ? i49 : null;
    return n63 && (i49.length = s67), {
      changed: a59,
      samplerData: l47,
      maxTileLevel: o60
    };
  }
  get estimatedGeometryMemoryUsage() {
    const e71 = this.intersectionData?.estimatedMemoryUsage ?? 0;
    return (this.geometry.indices?.byteLength ?? 0) + (this.geometry.vertexAttributes?.byteLength ?? 0) + e71;
  }
  get texture() {
    return this._texture;
  }
  get test() {
  }
  checkGeometryWaterproofness() {
    if (!E16) return;
    const e71 = this.tile;
    if (!e71.isLoaded || !e71.intersectsClippingArea || 0 === e71.level) return void O9(e71?.isLoaded);
    const r57 = e71.surface.extent;
    if (null != r57 && !e71.intersectsExtent(r57)) return;
    const f46 = nn.map((t71, i49) => null != r57 && (i49 < 2 ? -1 : 1) * (e71.extent[3 - i49] - r57[3 - i49]) < 0), p49 = e71.level;
    O9(0 === this.dirtyCorners), O9(0 === this.dirtyEdges), O9(0 === this.dirtyEdgeResolutions), O9(!this.numVerticesPerSideChanged), O9(!this.samplerDataChanged), O9(!this.clippingAreaChanged), O9(!this.wireframeChanged);
    const y27 = tn.map((t71) => e71.findNeighborCornerTileExact(t71, (t72) => !t72.intersectsClippingArea || t72.isLoaded || t72.level === e71.level) ?? null).map((e72) => e72?.intersectsClippingArea ? e72 : null), x26 = this.geometryState;
    for (let t71 = 0; t71 < 4; ++t71) {
      const r58 = x26.cornerPeerNeighbors[t71], i49 = y27[t71];
      O9(i49 === r58, `Tile[${e71.lij}].corner[${t71}] out of date: cur=[${r58?.lij}] exp=[${i49?.lij}]`);
    }
    nn.forEach((r58, y28) => {
      if (f46[y28]) return;
      const x27 = e71.findNeighborTile(r58, (e72) => (e72.level === p49 || e72?.isLoaded) && e72?.intersectsClippingArea);
      if (!x27) {
        const t71 = !e71.surface.updatingRootTiles && null != e71.surface.rootTiles && e71.surface.rootTiles.length > 0 && e71.shouldHaveNeighbor(r58);
        return void O9(!t71);
      }
      O9(x27.isLoaded || x27.level === e71.level), O9(x27 === this.geometryState.edgePeerNeighbors[y28]);
      const v28 = p49 - x27.level;
      if (!x27.isLoaded) return O9(!x27.isLeaf), void O9(0 === v28);
      const E37 = x27.renderData;
      O9(de2(e71, x27, r58)), O9(v28 >= 0);
      const S26 = 2 ** v28;
      if (v28 < 0) return void O9(false);
      const C25 = e71.renderData, D15 = C25.geometry, j21 = C25.localOrigin, A32 = D15.getEdgeCount(y28), R17 = D15.numVerticesPerSide - 1, w24 = E37.geometry;
      if (!w24) return void O9(false);
      const L25 = E37.localOrigin, N18 = this.geometryState.edgePeerNeighbors[y28];
      if (N18?.isLoaded) {
        const e72 = N18.renderData;
        O9(C25.geometryState.edgePeerNeighborSamplerVersions[y28] === e72.geometryState.samplerDataVersion), O9(this.geometryState.edgePeerNeighborSamplerVersions[y28] === e72.geometryState.samplerDataVersion);
      }
      const P19 = (y28 + 2) % 4, F18 = w24.getEdgeCount(P19), G17 = A32 - 1, B17 = F18 - 1;
      O9(G17 * S26 === B17, `Tile[${e71.lij}]:e${y28},res=${G17} edgeRes mismatch with Neighbor[${x27.lij}]:e${P19},res=${B17} (expected:${G17 * S26})`);
      const W11 = e71.extent, q20 = r58 === T6.NORTH || r58 === T6.SOUTH, z19 = F18 - 1, J13 = z19 >> v28, K14 = A32 - 1;
      if (J13 < 1) return void O9(1 === K14);
      O9(J13 === K14), O9(a6(J13));
      const Q18 = w24.numVerticesPerSide - 1;
      O9(v28 > 0 || J13 === Math.max(Q18, R17));
      const Y12 = e71.getNeighborEdgeStartVertexIndex(y28, x27);
      O9(0 <= Y12 && Y12 < S26);
      const Z11 = Y12 * J13;
      O9(0 <= Z11 && Z11 <= z19 - J13);
      let ee5 = 0, te5 = Z11;
      D15.getEdgeVertexPosition(y28, O25, j21, 0), D15.getEdgeVertexPosition(y28, I20, j21, A32 - 1);
      const re6 = x(O25, I20), ie6 = Math.max(X10, 1e-4 * re6);
      for (let t71 = 0; t71 <= J13; ++t71) {
        D15.getEdgeVertexPosition(y28, O25, j21, ee5), w24.getEdgeVertexPosition(P19, I20, L25, te5);
        const i49 = t71 / J13, f47 = q20 ? W11[0] + i49 * (W11[2] - W11[0]) : r58 === T6.WEST ? W11[0] : W11[2], p50 = q20 ? r58 === T6.SOUTH ? W11[1] : W11[3] : W11[1] + i49 * (W11[3] - W11[1]), v29 = e71.surface.extent;
        if (null == v29 || w3(v29, f47, p50)) {
          const t72 = U3(O25, I20), r59 = Y(O25) - s5.radius, i50 = Y(I20) - s5.radius, u46 = t72 < ie6;
          if (!u46) {
            console.warn(`Tile edge vertex position mismatch: between [${e71.lij}].edge${y28}[${ee5}/${A32}] and [${x27.lij}].edge${P19}[${te5}/${F18}]`), null != v29 && console.warn("  surface extent= ", v29, " x,y=", f47, ",", p50);
            const s67 = n7();
            e11(s67, C25.localOrigin, E37.localOrigin), Y(s67) > 0 && console.warn(`   localOrigins: ${C25.localOrigin} vs ${E37.localOrigin} d=${Y(s67)} [${s67}]`);
            (() => {
              const t73 = t4(O25), r60 = t4(I20);
              e71.updateEdgeElevations(), x27.updateEdgeElevations(), D15.getEdgeVertexPosition(y28, O25, j21, ee5), w24.getEdgeVertexPosition(P19, I20, L25, te5);
              const i51 = n7();
              K(i51, O25, t73), Y(i51) > 0 && console.warn(`  XXX Tile[${e71.lij}] edge out of date: ${t73} vs ${O25} d=${Y(i51)} [${i51}]`), K(i51, I20, r60), Y(i51) > 0 && console.warn(`  XXX Neighbor[${x27.lij}] edge out of date: ${r60} vs ${I20} d=${Y(i51)} [${i51}]`);
            })();
            const n63 = D15.getEdgeCount(y28), l47 = w24.getEdgeCount(F18);
            O9(u46, `Mismatch in tile [${e71.lij}].edge[${y28}][${ee5}/${n63}] vs neighbor [${x27.lij}].edge[${P19}][${te5}/${l47}] ${P6(O25)} vs ${P6(I20)}  dist=${t72} h(t|n|d)=${r59}|${i50}|${i50 - r59}`);
          }
          D15.getEdgeNormal(y28, M11, ee5), w24.getEdgeNormal(P19, U17, te5), z(k18, M11), z(H18, U17);
          const _30 = P3(k18, H18), S27 = 1 - _30 < 0.01 || false || e71 === x27;
          if (!S27) {
            const t73 = n7();
            K(t73, M11, U17);
            const r60 = () => `Mismatch in tile edge normal ${B5(e71.lij)} (${ee5}/${A32 - 1}) edge ${y28} vs neighbor ${B5(x27.lij)}  (${te5}/${F18 - 1}) nedge ${P19} :${P6(M11)} vs ${P6(U17)}  dot = ${_30} : ${P6(t73)}`;
            console.warn("Mismatch in tile edge normal: ", r60());
            {
              e71.updateEdgeElevations(), x27.updateEdgeElevations();
              const t74 = n7(), r61 = n7();
              D15.getEdgeNormal(y28, t74, ee5), w24.getEdgeNormal(P19, r61, te5), H(M11, t74) || console.warn("Missing update in tile normal: ", P6(M11), " => ", P6(t74)), H(U17, r61) || console.warn("Missing update in neighbor normal: ", P6(U17), " => ", P6(r61));
            }
            O9(S27, r60());
          }
        }
        ee5 += 1, te5 += 1;
      }
    });
  }
};
var O25 = n7();
var I20 = n7();
var M11 = n7();
var U17 = n7();
var k18 = n7();
var H18 = n7();
var X10 = 1;
var B11 = [null, null, null, null];
function W7(e71, t71) {
  return t71?.isLoaded || t71 === e71 ? t71 : null;
}
var q14 = 1;
var z15 = 2;
var J11 = 4;
var K11 = 8;
var Q15 = 4;
var Y10 = 8;
var Z9 = 12;
var ee3 = [0, 1, 2, 3];

// ../../../node_modules/@arcgis/core/views/3d/terrain/PatchGeometryFactory.js
var M12 = 65536;
function S21(e71, t71) {
  const {
    tile: o60,
    geometry: s67,
    geometryState: i49
  } = e71, {
    extentInRadians: a59,
    surface: c44
  } = o60, {
    isWebMercator: l47,
    renderer: u46
  } = c44, {
    numVerticesPerSide: d38,
    wireframe: f46
  } = i49, m45 = d38 - 1, g28 = (d38 - 2) ** 2, p49 = l47 && (t71 === O10.HAS_SOUTH_POLE || t71 === O10.HAS_BOTH_POLES), x26 = l47 && (t71 === O10.HAS_NORTH_POLE || t71 === O10.HAS_BOTH_POLES), h32 = ((p49 ? 1 : 0) + (x26 ? 1 : 0)) * pe3 * d38, M18 = fe2(i49), S26 = g28 + h32 + 4 * M18, L25 = u46.tileGeometryCache.acquire(S26);
  s67.numVerticesPerSide = d38, s67.vertexAttributes = L25, s67.maxEdgeVertexCount = M18;
  const {
    boundingBox: B17
  } = s67;
  P4(B17);
  const I25 = O26(e71);
  re5.update(m45, a59, I25), v23(e71), s67.poleVerticesStartIndex = g28;
  const b25 = y20(e71, p49, x26);
  s67.edgeVerticesStartIndex = g28 + h32, X11(e71), V15(e71), W8(s67, b25, f46), e71.intersectionData = null;
}
function y20(e71, t71, n63) {
  const {
    tile: o60,
    localOrigin: s67,
    geometry: r57
  } = e71, {
    extent: i49,
    ellipsoid: c44
  } = o60, {
    boundingBox: l47,
    numVerticesPerSide: u46,
    vertexAttributes: d38,
    poleVerticesStartIndex: f46
  } = r57, m45 = u46 - 1, g28 = s67[0], p49 = s67[1], x26 = s67[2], M18 = c44.radius, S26 = i49[1], y27 = i49[3], v28 = [];
  let L25 = f46;
  const B17 = (e72, t72) => {
    const n64 = t72 * u46;
    de3(-g28, -p49, e72 * M18 - x26, l47), v28.push(new oe4(1 === e72, n64, 1 === e72 ? 0 : 2, L25, pe3));
    const o61 = P14(-1 === e72 ? S26 : y27, M18), s68 = e72 * Math.PI / 2 - o61, r58 = 0.99 * (1 === e72 ? 1 : -1), i50 = M18 + 0, {
      position: c45,
      uv0: f47
    } = d38, {
      typedBuffer: B18,
      typedBufferStride: I25
    } = d38.normalCompressed;
    for (let u47 = 1; u47 <= pe3; ++u47) {
      const e73 = o61 + s68 * (u47 / pe3), t73 = Math.cos(e73), n65 = Math.sin(e73);
      for (let o62 = 0; o62 <= m45; o62++) {
        const e74 = o62 / m45, s69 = re5.sinLonLUT[o62], u48 = re5.cosLonLUT[o62] * t73, d39 = s69 * t73, M19 = n65, S27 = u48 * i50 - g28, y28 = d39 * i50 - p49, v29 = M19 * i50 - x26;
        de3(S27, y28, v29, l47), c45.setValues(L25, S27, y28, v29), u34(f47, L25, e74, r58), s15(B18, L25, u48, d39, M19, I25), ++L25;
      }
    }
  };
  return t71 && B17(-1, 0), n63 && B17(1, m45), v28;
}
function v23(e71) {
  const {
    tile: t71
  } = e71;
  if (!t71.intersectsClippingArea) return;
  const {
    geometry: n63,
    geometryState: o60,
    localOrigin: r57
  } = e71, {
    numVerticesPerSide: i49,
    samplerData: c44
  } = o60, l47 = i49 - 2, u46 = i49 - 1, {
    vertexAttributes: d38,
    boundingBox: f46
  } = n63, m45 = d38.position, g28 = d38.uv0, {
    typedBuffer: p49,
    typedBufferStride: x26
  } = d38.normalCompressed, {
    extent: M18
  } = t71, S26 = M18[0], y27 = M18[2], v28 = M18[1], L25 = M18[3], B17 = t71.ellipsoid.radius, I25 = r57[0], V19 = r57[1], b25 = r57[2], C25 = m45.typedBuffer, P19 = m45.typedBufferStride, A32 = 1 / u46;
  let E37 = 0;
  if (1 <= l47) {
    const e72 = A32, t72 = v28 * (1 - e72) + L25 * e72, n64 = re5.sinLatLUT[1], o61 = re5.cosLatLUT[1];
    for (let r58 = 1; r58 <= l47; r58++) {
      const i50 = r58 * A32, l48 = S26 * (1 - i50) + y27 * i50, u47 = re5.sinLonLUT[r58], d39 = re5.cosLonLUT[r58], m46 = B17 + e55(l48, t72, c44), p50 = m46 * d39 * o61 - I25, x27 = m46 * u47 * o61 - V19, h32 = m46 * n64 - b25;
      de3(p50, x27, h32, f46);
      const M19 = (r58 - 1) * P19;
      C25[M19] = p50, C25[M19 + 1] = x27, C25[M19 + 2] = h32, u34(g28, r58 - 1, i50, e72);
    }
  }
  for (let O34 = 1; O34 <= l47; O34++) {
    const e72 = O34 * A32, t72 = v28 * (1 - e72) + L25 * e72, n64 = re5.sinLatLUT[O34], o61 = re5.cosLatLUT[O34], r58 = O34 + 1, i50 = r58 * A32, d39 = v28 * (1 - i50) + L25 * i50, m46 = re5.sinLatLUT[r58], M19 = re5.cosLatLUT[r58], T21 = re5.sinLonLUT[0], D15 = re5.cosLonLUT[0], R17 = B17 + e55(S26, t72, c44);
    let U23 = D15 * o61 * R17 - I25, N18 = T21 * o61 * R17 - V19, w24 = n64 * R17 - b25;
    const j21 = E37 * P19;
    let F18 = C25[j21], H23 = C25[j21 + 1], q20 = C25[j21 + 2];
    for (let L26 = 1; L26 <= l47; L26++) {
      const e73 = L26 * A32, r59 = S26 * (1 - e73) + y27 * e73, T22 = re5.sinLonLUT[L26], D16 = re5.cosLonLUT[L26];
      let R18 = 0, j22 = 0, _30 = 0;
      if (L26 < l47) {
        const e74 = (E37 + 1) * P19;
        R18 = C25[e74], j22 = C25[e74 + 1], _30 = C25[e74 + 2];
      } else {
        const e74 = re5.sinLonLUT[u46], r60 = re5.cosLonLUT[u46], i51 = B17 + e55(y27, t72, c44);
        R18 = r60 * o61 * i51 - I25, j22 = e74 * o61 * i51 - V19, _30 = n64 * i51 - b25;
      }
      const W11 = U23, G17 = N18, k23 = w24;
      U23 = F18, N18 = H23, w24 = q20, F18 = R18, H23 = j22, q20 = _30;
      const z19 = R18 - W11, J13 = j22 - G17, K14 = _30 - k23;
      let Q18 = 0, X13 = 0, Y12 = 0;
      if (O34 > 1) {
        const e74 = (E37 - l47) * P19;
        Q18 = C25[e74], X13 = C25[e74 + 1], Y12 = C25[e74 + 2];
      } else {
        const e74 = re5.sinLatLUT[0], t73 = re5.cosLatLUT[0], n65 = B17 + e55(r59, v28, c44);
        Q18 = D16 * t73 * n65 - I25, X13 = T22 * t73 * n65 - V19, Y12 = e74 * n65 - b25;
      }
      const Z11 = B17 + e55(r59, d39, c44), $10 = D16 * M19 * Z11 - I25, ee5 = T22 * M19 * Z11 - V19, te5 = m46 * Z11 - b25;
      if (O34 < l47) {
        const t73 = E37 + l47, n65 = t73 * P19;
        C25[n65] = $10, C25[n65 + 1] = ee5, C25[n65 + 2] = te5, de3($10, ee5, te5, f46), u34(g28, t73, e73, i50);
      }
      const ne6 = Q18 - $10, oe6 = X13 - ee5, se7 = Y12 - te5;
      let ie6 = D16 * o61, ae6 = T22 * o61, ce7 = n64;
      ce7 * ce7 < 0.999 && (ie6 = K14 * oe6 - J13 * se7, ae6 = z19 * se7 - K14 * ne6, ce7 = J13 * ne6 - z19 * oe6);
      const le6 = 1 / Math.sqrt(ie6 * ie6 + ae6 * ae6 + ce7 * ce7);
      s15(p49, E37, ie6 * le6, ae6 * le6, ce7 * le6, x26), ++E37;
    }
  }
}
function L21(e71) {
  e71.tile.intersectsClippingArea && (V15(e71), te4(e71), e71.intersectionData = null);
}
function B12(e71) {
  e71.tile.intersectsClippingArea && (Y11(e71), V15(e71), te4(e71), ne5(e71), e71.intersectionData = null);
}
function I21(e71) {
  e71.tile.intersectsClippingArea && (C21(e71), b17(e71, true), te4(e71), e71.intersectionData = null);
}
function V15(e71) {
  e71.tile.intersectsClippingArea && (C21(e71), b17(e71));
}
function b17(t71, n63 = false) {
  const {
    geometry: o60,
    geometryState: r57,
    tile: i49,
    localOrigin: c44
  } = t71, {
    level: u46,
    extent: p49,
    extentInRadians: h32,
    ellipsoid: M18
  } = i49, S26 = M18.radius, y27 = h32[0], v28 = h32[2], L25 = h32[1], B17 = h32[3], {
    samplerData: I25
  } = r57, V19 = p49[0], b25 = p49[2], C25 = p49[1], P19 = p49[3], A32 = O26(t71), {
    boundingBox: E37,
    vertexAttributes: T21
  } = o60, D15 = c44[0], R17 = c44[1], U23 = c44[2], N18 = T21.position, w24 = N18.typedBuffer, j21 = N18.typedBufferStride, F18 = T21.uv0;
  for (let O34 = 0; O34 < 4; ++O34) {
    const c45 = 1 === O34 || 3 === O34, h33 = r57.edgeResolutions[O34];
    O9(a6(h33));
    const M19 = h33 + 1, T22 = W7(i49, r57.edgePeerNeighbors[O34]);
    if (ce5(i49, T22, O34)) {
      Z10(t71, O34, T22);
      continue;
    }
    const N19 = null != T22;
    O9(!N19 || T22.level === i49.level), O9(!N19 || u18(i49, T22) <= 0);
    const H23 = T22?.renderData, q20 = H23?.geometryState;
    if (E16) {
      const e71 = i49.surface;
      if (!T22 && e71 && !e71.updatingRootTiles) {
        const t72 = nn[O34], n64 = i49.findNeighborTile(t72, (e72) => e72.isLoaded || e72.isLeaf || e72.level === i49.level);
        n64 ? n64.intersectsClippingArea && (O9(!n64.isLoaded), O9(!n64.isLeaf), O9(n64.level === u46)) : O9(null == e71?.rootTiles || !i49.shouldHaveNeighbor(t72));
      }
    }
    const _30 = 1 === O34 ? p49[2] : p49[0], W11 = T22?.extent, G17 = W11 && c45 ? 1 === O34 ? W11[0] : W11[2] : _30, k23 = 0 === O34 ? p49[3] : p49[1], z19 = 1 === O34 ? 1 : 0, J13 = 0 === O34 ? 1 : 0, K14 = 1 === O34 ? v28 : y27, Q18 = 0 === O34 ? B17 : L25, X13 = Math.sin(K14), Y12 = Math.cos(K14), $10 = Math.sin(Q18), ee5 = Math.cos(Q18), te5 = q20?.samplerData, ne6 = N19 ? (e71, t72, n64) => 0.5 * (e55(e71, t72, I25) + e55(n64, t72, te5)) : (e71, t72, n64) => e55(e71, t72, I25), oe6 = o60.outerEdgesOffsetAndLength[2 * O34 + 0], se7 = n63 && M19 > 3 ? M19 - 3 : 1, re6 = null != I25 && I25.some((e71) => null != e71), ie6 = null != te5 && te5.some((e71) => null != e71), ae6 = re6 || ie6, le6 = 1 / h33, ue5 = oe6;
    O9(!W11 || q5(W11[2] - W11[0], p49[2] - p49[0]));
    (() => {
      const e71 = 1 === O34 ? -1 : 3 === O34 ? 1 : 0, t72 = 0 === O34 ? -1 : 2 === O34 ? 1 : 0, n64 = (p49[2] - p49[0]) * le6, r58 = e71 * n64, i50 = t72 * n64, l47 = c45 ? e71 * ((v28 - y27) * le6) : 0, u47 = c45 ? 0 : t72 * le6, d38 = J13, f46 = c45 ? K14 + l47 : K14, m45 = c45 ? Math.sin(f46) : X13, g28 = c45 ? Math.cos(f46) : Y12, x26 = c45 ? K14 - l47 : K14, h34 = c45 ? Math.sin(x26) : X13, L26 = c45 ? Math.cos(x26) : Y12, B18 = c45 ? Q18 : A32(d38 + u47), T23 = c45 ? $10 : Math.sin(B18), H24 = c45 ? ee5 : Math.cos(B18), q21 = c45 ? Q18 : A32(d38 - u47), W12 = c45 ? $10 : Math.sin(q21), Z11 = c45 ? ee5 : Math.cos(q21);
      let oe7 = 0, re7 = 0, ie7 = 0;
      {
        const e72 = 0 * le6, t73 = c45 ? _30 : V19 * (1 - e72) + b25 * e72, n65 = c45 ? G17 : t73, o61 = c45 ? C25 * (1 - e72) + P19 * e72 : k23, s67 = c45 ? K14 : y27 * (1 - e72) + v28 * e72, r59 = c45 ? X13 : Math.sin(s67), i51 = c45 ? Y12 : Math.cos(s67), a59 = c45 ? A32(e72) : Q18, l48 = c45 ? Math.sin(a59) : $10, u48 = c45 ? Math.cos(a59) : ee5, d39 = S26 + ne6(t73, o61, n65);
        oe7 = i51 * u48 * d39, re7 = r59 * u48 * d39, ie7 = l48 * d39;
      }
      let ce7 = 0, fe4 = 0, me4 = 0;
      {
        const e72 = 1 * le6, t73 = c45 ? _30 : V19 * (1 - e72) + b25 * e72, n65 = c45 ? G17 : t73, o61 = c45 ? C25 * (1 - e72) + P19 * e72 : k23, s67 = c45 ? K14 : y27 * (1 - e72) + v28 * e72, r59 = c45 ? X13 : Math.sin(s67), i51 = c45 ? Y12 : Math.cos(s67), a59 = c45 ? A32(e72) : Q18, l48 = c45 ? Math.sin(a59) : $10, u48 = c45 ? Math.cos(a59) : ee5, d39 = S26 + ne6(t73, o61, n65);
        ce7 = i51 * u48 * d39, fe4 = r59 * u48 * d39, me4 = l48 * d39;
      }
      for (let p50 = 1; p50 < M19 - 1; p50 += se7) {
        let e72 = 0, t73 = 0, n65 = 0;
        {
          const o61 = (p50 + 1) * le6, s67 = c45 ? _30 : V19 * (1 - o61) + b25 * o61, r59 = c45 ? G17 : s67, i51 = c45 ? C25 * (1 - o61) + P19 * o61 : k23, a59 = c45 ? K14 : y27 * (1 - o61) + v28 * o61, l49 = c45 ? X13 : Math.sin(a59), u49 = c45 ? Y12 : Math.cos(a59), d40 = c45 ? A32(o61) : Q18, f48 = c45 ? Math.sin(d40) : $10, m46 = c45 ? Math.cos(d40) : ee5, g29 = S26 + ne6(s67, i51, r59);
          e72 = u49 * m46 * g29, t73 = l49 * m46 * g29, n65 = f48 * g29;
        }
        const l48 = e72, u48 = t73, d39 = n65, f47 = ce7, x27 = fe4, M20 = me4;
        ce7 = l48, fe4 = u48, me4 = d39;
        {
          const e73 = ue5 + p50, t74 = e73 * j21, n66 = f47 - D15, o61 = x27 - R17, s67 = M20 - U23;
          w24[t74] = n66, w24[t74 + 1] = o61, w24[t74 + 2] = s67, de3(n66, o61, s67, E37);
          const r59 = p50 * le6;
          u34(F18, e73, c45 ? z19 : r59, c45 ? r59 : J13);
        }
        const B19 = oe7, q22 = re7, se8 = ie7;
        oe7 = f47, re7 = x27, ie7 = M20;
        const ge3 = f47, pe5 = x27, xe = M20, he4 = 1 / Math.sqrt(ge3 * ge3 + pe5 * pe5 + xe * xe), Me2 = xe * he4;
        let Se2 = 0, ye3 = 0, ve = 0;
        if (ae6 && Me2 * Me2 < 0.999) {
          let e73 = 0, t74 = 0, n66 = 0;
          {
            const o61 = 0 === O34 ? -1 : 1;
            e73 = o61 * (l48 - B19), t74 = o61 * (u48 - q22), n66 = o61 * (d39 - se8);
          }
          {
            const o61 = p50 * le6, a59 = c45 ? _30 : V19 * (1 - o61) + b25 * o61, l49 = c45 ? G17 : a59, u49 = c45 ? C25 * (1 - o61) + P19 * o61 : k23, d40 = c45 ? K14 : y27 * (1 - o61) + v28 * o61, f48 = c45 ? X13 : Math.sin(d40), x28 = c45 ? Y12 : Math.cos(d40), M21 = c45 ? A32(o61) : Q18, B20 = c45 ? Math.sin(M21) : $10, E38 = c45 ? Math.cos(M21) : ee5;
            let D16 = ge3, R18 = pe5, U24 = xe;
            if (N19) {
              const e74 = S26 + e55(l49 - r58, u49 - i50, te5), t75 = c45 ? E38 : Z11;
              D16 = (c45 ? L26 : x28) * t75 * e74, R18 = (c45 ? h34 : f48) * t75 * e74, U24 = (c45 ? B20 : W12) * e74;
            }
            {
              const o62 = S26 + e55(a59 + r58, u49 + i50, I25), l50 = c45 ? E38 : H24, d41 = (c45 ? g28 : x28) * l50 * o62, p51 = (c45 ? m45 : f48) * l50 * o62, h35 = (c45 ? B20 : T23) * o62;
              N19 || (D16 = 2 * ge3 - d41, R18 = 2 * pe5 - p51, U24 = 2 * xe - h35);
              const M22 = 3 === O34 ? -1 : 1, y28 = M22 * (D16 - d41), v29 = M22 * (R18 - p51), L27 = M22 * (U24 - h35);
              Se2 = n66 * v29 - t74 * L27, ye3 = e73 * L27 - n66 * y28, ve = t74 * y28 - e73 * v29;
              const V20 = 1 / Math.sqrt(Se2 * Se2 + ye3 * ye3 + ve * ve);
              Se2 *= V20, ye3 *= V20, ve *= V20;
            }
          }
        } else Se2 = ge3 * he4, ye3 = pe5 * he4, ve = xe * he4;
        o60.setEdgeNormalFromValues(O34, p50, Se2, ye3, ve);
      }
    })();
  }
}
function C21(e71) {
  $9(e71);
}
function P14(e71, t71) {
  return Math.PI / 2 - 2 * Math.atan(Math.exp(-e71 / t71));
}
function A26(e71, t71, n63, o60) {
  return P14(e71 * (1 - o60) + t71 * o60, n63);
}
function E34(e71, t71, n63) {
  return e71 * (1 - n63) + t71 * n63;
}
function O26(e71) {
  const {
    tile: t71
  } = e71;
  if (t71.surface.isWebMercator) {
    const e72 = t71.extent, n64 = t71.ellipsoid.radius;
    return (t72) => A26(e72[1], e72[3], n64, t72);
  }
  const n63 = t71.extentInRadians;
  return (e72) => E34(n63[1], n63[3], e72);
}
function T17(e71, t71) {
  const {
    tile: o60,
    geometryState: s67,
    geometry: r57
  } = e71, {
    extent: i49,
    surface: a59
  } = o60, {
    wireframe: c44
  } = s67, l47 = i49[0], u46 = i49[1], d38 = i49[2] - l47, f46 = i49[3] - u46, {
    numVerticesPerSide: m45,
    clippingArea: g28
  } = s67, p49 = null != g28 ? Math.max(0, (g28[0] - l47) / d38) : 0, x26 = null != g28 ? Math.max(0, (g28[1] - u46) / f46) : 0, h32 = null != g28 ? Math.min(1, (g28[2] - l47) / d38) : 1, M18 = null != g28 ? Math.min(1, (g28[3] - u46) / f46) : 1, S26 = (m45 - 2) ** 2, y27 = fe2(s67), v28 = S26 + 4 * y27, L25 = a59.renderer.tileGeometryCache.acquire(v28), {
    boundingBox: B17
  } = r57;
  P4(B17), r57.numVerticesPerSide = m45, r57.vertexAttributes = L25, r57.maxEdgeVertexCount = y27, r57.minu = p49, r57.minv = x26, r57.maxu = h32, r57.maxv = M18, D9(e71), r57.edgeVerticesStartIndex = S26, X11(e71), w19(e71), W8(r57, [], c44), e71.intersectionData = null;
}
function D9(e71) {
  const n63 = e71.tile;
  if (!n63.intersectsClippingArea) return;
  const {
    geometry: o60,
    geometryState: r57,
    localOrigin: i49
  } = e71, {
    samplerData: c44,
    clippingArea: l47,
    numVerticesPerSide: u46
  } = r57, {
    surface: d38,
    extent: f46,
    ellipsoid: m45
  } = n63, {
    isWebMercatorOnPlateCarree: g28
  } = d38, p49 = null != l47 ? l47 : ie5, x26 = f46[0], M18 = f46[1], S26 = f46[2], y27 = f46[3], v28 = Math.max(x26, p49[0]), L25 = Math.min(S26, p49[2]), B17 = Math.max(M18, p49[1]), I25 = Math.min(y27, p49[3]), V19 = m45.radius, b25 = n63.horizontalScale, C25 = u46 - 1, P19 = u46 - 2, {
    minu: A32,
    minv: E37,
    maxu: O34,
    maxv: T21,
    boundingBox: D15,
    vertexAttributes: R17
  } = o60, U23 = R17.position, N18 = R17.uv0, {
    typedBuffer: w24,
    typedBufferStride: j21
  } = R17.normalCompressed, F18 = i49[0], H23 = i49[1], q20 = i49[2], _30 = U23.typedBuffer, W11 = U23.typedBufferStride;
  let G17 = 0;
  const k23 = e12(M18, B17, I25), z19 = g28 ? (Math.PI / 2 - 2 * Math.atan(Math.exp(-k23 / V19))) * V19 : k23 * b25, J13 = 1 / C25, K14 = e12(M18 * (1 - J13) + y27 * J13, B17, I25);
  let Q18 = z19, X13 = g28 ? (Math.PI / 2 - 2 * Math.atan(Math.exp(-K14 / V19))) * V19 : K14 * b25;
  for (let Y12 = 1; Y12 <= P19; Y12++) {
    const e72 = Y12 / C25, n64 = e12(M18 * (1 - e72) + y27 * e72, B17, I25), o61 = e12(e72, E37, T21), r58 = X13, i50 = (Y12 - 1) / C25, l48 = e12(M18 * (1 - i50) + y27 * i50, B17, I25), u47 = Q18, d39 = (Y12 + 1) / C25, f47 = e12(M18 * (1 - d39) + y27 * d39, B17, I25), m46 = g28 ? (Math.PI / 2 - 2 * Math.atan(Math.exp(-f47 / V19))) * V19 : f47 * b25, p50 = e12(d39, E37, T21);
    Q18 = X13, X13 = m46;
    const R18 = e12(x26, v28, L25);
    let U24 = R18 * b25, k24 = e55(R18, n64, c44);
    const z20 = 1 / C25, J14 = e12(z20, A32, O34), K15 = e12(x26 * (1 - J14) + S26 * J14, v28, L25);
    let Z11 = J14, $10 = K15, ee5 = K15 * b25, te5 = e55(K15, n64, c44);
    if (1 === Y12) {
      const e73 = ee5 - F18, n65 = Q18 - H23, s67 = te5 - q20, r59 = 0 * W11;
      _30[r59] = e73, _30[r59 + 1] = n65, _30[r59 + 2] = s67, de3(e73, n65, s67, D15);
      const i51 = e12(z20, A32, O34);
      u34(N18, G17, i51, o61);
    }
    for (let g29 = 1; g29 <= P19; g29++) {
      const e73 = ee5, i51 = te5, d40 = (g29 + 1) / C25, M19 = e12(d40, A32, O34), y28 = e12(x26 * (1 - d40) + S26 * d40, v28, L25), B18 = $10;
      $10 = y28;
      {
        const e74 = G17 + 1, t71 = e74 * W11;
        if (1 === Y12 || g29 === P19) {
          const i52 = y28 * b25, l49 = e55(y28, n64, c44);
          if (1 === Y12 && g29 < P19) {
            const n65 = i52 - F18, s67 = r58 - H23, c45 = l49 - q20;
            _30[t71] = n65, _30[t71 + 1] = s67, _30[t71 + 2] = c45, de3(n65, s67, c45, D15), u34(N18, e74, M19, o61);
          }
          ee5 = i52, te5 = l49;
        } else ee5 = _30[t71] + F18, te5 = _30[t71 + 2] + q20;
      }
      const I26 = ee5, V20 = te5, E38 = U24, T22 = k24;
      U24 = e73, k24 = i51;
      const R19 = (G17 - P19) * W11, z21 = 1 === Y12 ? e55(B18, l48, c44) : _30[R19 + 2] + q20, J15 = e55(B18, f47, c44);
      if (Y12 < P19) {
        const t71 = G17 + P19, n65 = t71 * W11, o62 = e73 - F18, s67 = m46 - H23, r59 = J15 - q20;
        _30[n65] = o62, _30[n65 + 1] = s67, _30[n65 + 2] = r59, de3(o62, s67, r59, D15);
        const i52 = Z11;
        Z11 = M19, u34(N18, t71, i52, p50);
      }
      {
        const e74 = I26 - E38, t71 = u47 - m46, n65 = t71 * (V20 - T22), o62 = e74 * (z21 - J15), s67 = -t71 * e74, r59 = n65 * n65 + o62 * o62 + s67 * s67;
        if (0 === r59) s15(w24, G17, 0, 0, 1, j21);
        else {
          const e75 = 1 / Math.sqrt(r59);
          s15(w24, G17, n65 * e75, o62 * e75, s67 * e75, j21);
        }
      }
      ++G17;
    }
  }
}
function R10(e71, t71) {
  e71.tile.intersectsClippingArea && (F11(e71), j16(e71, true), te4(e71), e71.intersectionData = null);
}
function U18(e71, t71) {
  e71.tile.intersectsClippingArea && (Y11(e71), w19(e71), te4(e71), ne5(e71), e71.intersectionData = null);
}
function N12(e71, t71) {
  e71.tile.intersectsClippingArea && (w19(e71), te4(e71), e71.intersectionData = null);
}
function w19(e71, t71) {
  e71.tile.intersectsClippingArea && (F11(e71), j16(e71, false));
}
function j16(n63, o60) {
  const {
    geometry: r57,
    geometryState: i49,
    localOrigin: a59
  } = n63, c44 = n63.tile, {
    surface: u46,
    extent: g28
  } = c44, {
    clippingArea: p49,
    samplerData: h32
  } = i49, M18 = null != p49 ? p49 : ie5, S26 = g28[0], y27 = g28[2], v28 = g28[1], L25 = g28[3], B17 = [L25 > M18[3], y27 > M18[2], v28 < M18[1], S26 < M18[0]], I25 = c44.horizontalScale, V19 = _23(u46.isWebMercatorOnPlateCarree, c44.ellipsoid.radius, I25), {
    minu: b25,
    minv: C25,
    maxu: P19,
    maxv: A32,
    boundingBox: E37
  } = r57, O34 = Math.max(S26, M18[0]), T21 = Math.min(y27, M18[2]), D15 = Math.max(v28, M18[1]), R17 = Math.min(L25, M18[3]), U23 = a59[0], N18 = a59[1], w24 = a59[2];
  for (let j21 = 0; j21 < 4; ++j21) {
    const a60 = 1 === j21 || 3 === j21, g29 = i49.edgeResolutions[j21];
    O9(a6(g29));
    const p50 = g29 + 1, M19 = B17[j21], F18 = W7(c44, i49.edgePeerNeighbors[j21]);
    if (!M19 && ce5(c44, F18, j21)) {
      Z10(n63, j21, F18);
      continue;
    }
    const H23 = null != F18 && !M19, q20 = F18?.renderData, _30 = q20?.geometryState;
    if (E16 && (O9(!H23 || F18.level === c44.level), O9(!H23 || u18(c44, F18) <= 0), c44 && !F18 && !u46.updatingRootTiles)) {
      const e71 = nn[j21], t71 = c44.findNeighborTile(e71, (e72) => e72.isLoaded || e72.isLeaf || e72.level === c44.level);
      u46.updatingRootTiles || (t71 ? t71.intersectsClippingArea && (O9(!t71.isLoaded), O9(!t71.isLeaf), O9(t71.level === c44.level)) : O9(null == u46?.rootTiles || !c44.shouldHaveNeighbor(e71)));
    }
    const W11 = e12(1 === j21 ? y27 : S26, O34, T21), G17 = e12(0 === j21 ? L25 : v28, D15, R17), k23 = _30?.samplerData, z19 = o60 && p50 > 3 ? p50 - 3 : 1, J13 = e12(1 === j21 ? 1 : 0, b25, P19), K14 = e12(0 === j21 ? 1 : 0, C25, A32), Q18 = H23 ? (e71, t71) => 0.5 * (e55(e71, t71, k23) + e55(e71, t71, h32)) : (e71, t71) => e55(e71, t71, h32), X13 = (y27 - S26) / g29, Y12 = a60 ? 1 === j21 ? X13 : -X13 : 0, $10 = a60 ? 0 : 0 === j21 ? X13 : -X13, ee5 = -Y12, te5 = -$10;
    let ne6 = 0, oe6 = 0, se7 = 0;
    {
      const e71 = 0 / g29, n64 = a60 ? W11 : e12(S26 * (1 - e71) + y27 * e71, O34, T21), o61 = a60 ? e12(v28 * (1 - e71) + L25 * e71, D15, R17) : G17, s67 = Q18(n64, o61);
      ne6 = n64 * I25, oe6 = V19(o61), se7 = s67;
    }
    let re6 = 0, ie6 = 0, ae6 = 0;
    {
      const e71 = 1 / g29, n64 = a60 ? W11 : e12(S26 * (1 - e71) + y27 * e71, O34, T21), o61 = a60 ? e12(v28 * (1 - e71) + L25 * e71, D15, R17) : G17, s67 = Q18(n64, o61);
      re6 = n64 * I25, ie6 = V19(o61), ae6 = s67;
    }
    for (let e71 = 1; e71 < p50 - 1; e71 += z19) {
      const n64 = e71 / g29, o61 = re6, i50 = ie6, c45 = ae6;
      {
        const s67 = a60 ? J13 : e12(n64, b25, P19), l48 = a60 ? e12(n64, C25, A32) : K14, u48 = o61 - U23, d39 = i50 - N18, f47 = c45 - w24;
        de3(o61, d39, f47, E37), r57.setEdgeVertexFromValuesRawPositionUV(j21, e71, u48, d39, f47, s67, l48);
      }
      {
        const n65 = (e71 + 1) / g29, o62 = a60 ? W11 : e12(S26 * (1 - n65) + y27 * n65, O34, T21), s67 = a60 ? e12(v28 * (1 - n65) + L25 * n65, D15, R17) : G17, r58 = Q18(o62, s67);
        re6 = o62 * I25, ie6 = V19(s67), ae6 = r58;
      }
      const l47 = re6, u47 = ae6, d38 = ne6, f46 = oe6, m45 = se7;
      ne6 = o61, oe6 = i50, se7 = c45;
      let p51 = 0, x26 = 0, M20 = 0;
      if (a60) {
        const e72 = ie6 - i50, r58 = u47 - c45, a61 = f46 - i50, l48 = m45 - c45, d39 = e12(v28 * (1 - n64) + L25 * n64, D15, R17), g30 = W11 + ee5, S27 = g30 * I25 - o61, y28 = e55(g30, d39, h32) - c45, B19 = 3 === j21 ? -1 : 1;
        if (p51 = B19 * (-a61 + e72) * y28, x26 = B19 * S27 * (-l48 + r58), M20 = -B19 * S27 * (-a61 + e72), H23) {
          const t71 = W11 + Y12, n65 = t71 * I25 - o61;
          p51 = (-a61 + e72) * (y28 - (e55(t71, d39, k23) - c45)), x26 = (S27 - n65) * (-l48 + r58), M20 = -(S27 - n65) * (-a61 + e72);
        }
      } else {
        const e72 = l47 - o61, r58 = u47 - c45, a61 = d38 - o61, f47 = m45 - c45, g30 = e12(S26 * (1 - n64) + y27 * n64, O34, T21), v29 = G17 + te5, L26 = e55(g30, v29, h32) - c45, B19 = V19(v29) - i50, I26 = 2 === j21 ? -1 : 1;
        if (p51 = I26 * B19 * (-f47 + r58), x26 = I26 * (-a61 + e72) * L26, M20 = -I26 * B19 * (-a61 + e72), H23) {
          const t71 = g30, n65 = G17 + $10, o62 = V19(n65) - i50;
          p51 = (-B19 + o62) * (-f47 + r58), x26 = (-a61 + e72) * (-L26 + (e55(t71, n65, k23) - c45)), M20 = -(-B19 + o62) * (-a61 + e72);
        }
      }
      const B18 = 1 / Math.sqrt(p51 * p51 + x26 * x26 + M20 * M20);
      r57.setEdgeNormalFromValues(j21, e71, p51 * B18, x26 * B18, M20 * B18);
    }
  }
}
function F11(e71, t71) {
  $9(e71);
}
function H19(e71, t71) {
  return (Math.PI / 2 - 2 * Math.atan(Math.exp(-e71 / t71))) * t71;
}
function q15(e71, t71) {
  return e71 * t71;
}
function _23(e71, t71, n63) {
  return e71 ? (e72) => H19(e72, t71) : (e72) => q15(e72, n63);
}
function W8(e71, t71, n63) {
  const {
    numVerticesPerSide: o60,
    vertexAttributes: s67,
    maxEdgeVertexCount: r57
  } = e71, i49 = o60 - 1, a59 = s67.count, c44 = 2 * (o60 - 3) * (o60 - 3), l47 = 4 * (i49 + r57 - 3), d38 = ee3.reduce((t72, n64) => t72 + (i49 + e71.getEdgeCount(n64) - 3), 0), f46 = t71.reduce((e72, t72) => e72 + i49 * (2 * (t72.latitudeResolution - 1) + 1), 0), m45 = 3 * (n63 ? 2 : 1), g28 = (c44 + l47 + f46) * m45, p49 = a59 >= M12 ? new Uint32Array(g28) : new Uint16Array(g28);
  for (let u46 = 0; u46 < g28; ++u46) p49[u46] = 0;
  e71.indices = p49, e71.indexCount = (c44 + d38 + f46) * m45, e71.poleIndicesStartIndex = c44 * m45, e71.edgeIndicesStartIndex = (c44 + f46) * m45, n63 ? (J12(e71), K12(e71, t71), Q16(e71)) : (G12(e71), k19(e71, t71), z16(e71));
}
function G12(e71) {
  const {
    numVerticesPerSide: t71,
    indices: n63,
    vertexAttributes: o60
  } = e71, {
    position: s67
  } = o60, {
    typedBuffer: r57,
    typedBufferStride: i49
  } = s67, a59 = t71 - 2, c44 = t71 - 3, l47 = 0, u46 = t71 - 3;
  let d38 = 0;
  for (let f46 = 0; f46 < c44; ++f46) {
    const e72 = f46 * a59;
    for (let t72 = l47; t72 < u46; ++t72) {
      const o61 = e72 + t72, s68 = o61 + 1, c45 = s68 + a59, l48 = c45 - 1;
      me3(o61, s68, c45, l48, i49, r57) ? (n63[d38] = o61, n63[d38 + 1] = s68, n63[d38 + 2] = c45, n63[d38 + 3] = c45, n63[d38 + 4] = l48, n63[d38 + 5] = o61) : (n63[d38] = o61, n63[d38 + 1] = s68, n63[d38 + 2] = l48, n63[d38 + 3] = l48, n63[d38 + 4] = s68, n63[d38 + 5] = c45), d38 += 6;
    }
  }
}
function k19(e71, t71) {
  const {
    numVerticesPerSide: n63,
    indices: o60,
    poleIndicesStartIndex: s67
  } = e71, r57 = n63 - 1;
  let i49 = s67;
  for (const a59 of t71) {
    const t72 = a59.isNorth ? 1 : 2, s68 = a59.isNorth ? 2 : 1, c44 = a59.isNorth ? 3 : 4, l47 = a59.isNorth ? 4 : 3;
    let u46 = e71.getEdgeVertexIndex(a59.connectedOuterEdgeOffset, 0), d38 = 1;
    for (let e72 = 0; e72 < a59.latitudeResolution; ++e72) {
      const f46 = 0 === e72 ? a59.rowOffset : u46 + n63;
      for (let n64 = 0; n64 < r57; n64++) {
        const r58 = f46 + n64;
        o60[i49] = u46, o60[i49 + t72] = u46 + 1, o60[i49 + s68] = r58, e72 < a59.latitudeResolution - 1 ? (o60[i49 + c44] = u46 + 1, o60[i49 + l47] = r58 + 1, o60[i49 + 5] = r58, i49 += 6) : i49 += 3, u46 += d38;
      }
      u46 = f46, d38 = 1;
    }
  }
}
function z16(e71) {
  const {
    indices: t71,
    numVerticesPerSide: n63,
    edgeIndicesStartIndex: o60
  } = e71, s67 = n63 - 1, r57 = s67 - 2;
  let i49 = o60;
  for (let a59 = 0; a59 < 4; ++a59) {
    const n64 = ue3[a59];
    let o61 = 0, c44 = 0;
    const l47 = e71.getEdgeCount(a59), u46 = n64.count;
    O9(u46 === s67 - 1);
    const f46 = 1 === a59 || 2 === a59, m45 = f46 ? 1 : 2, g28 = f46 ? 2 : 1, p49 = e71.getEdgeFirstVertexIndex(a59), x26 = 1, h32 = n64.vertex0Index, M18 = n64.stride;
    for (; o61 < l47 - 1 || c44 < u46 - 1; ) {
      const e72 = h32 + c44 * M18, n65 = p49 + o61 * x26, a60 = o61 < l47 - 1, d38 = c44 < u46 - 1, f47 = a60 && (!d38 || (a60 ? 0 + s67 * (o61 + 0.5) / (l47 - 1) : 0) <= (d38 ? 1 + r57 * (c44 + 0.5) / (u46 - 1) : 0));
      f47 ? ++o61 : ++c44;
      const S26 = f47 ? n65 + x26 : e72 + M18;
      t71[i49] = e72, t71[i49 + m45] = n65, t71[i49 + g28] = S26, i49 += 3;
    }
  }
  e71.indexCount = i49;
}
function J12(e71) {
  const {
    indices: t71,
    numVerticesPerSide: n63,
    vertexAttributes: o60
  } = e71, {
    position: s67
  } = o60, {
    typedBuffer: r57,
    typedBufferStride: i49
  } = s67, a59 = n63 - 2;
  let c44 = 0;
  for (let l47 = 0; l47 < n63 - 3; ++l47) {
    const e72 = l47 * a59;
    for (let o61 = 0; o61 < n63 - 3; ++o61) {
      const n64 = l47 * a59 + o61, s68 = n64 + 1, u46 = s68 + a59, d38 = u46 - 1, f46 = e72 + o61, m45 = f46 + 1, g28 = m45 + a59;
      me3(f46, m45, g28, g28 - 1, i49, r57) ? (ge2(t71, c44, n64, s68, u46), c44 += 6, ge2(t71, c44, u46, d38, n64)) : (ge2(t71, c44, n64, s68, d38), c44 += 6, ge2(t71, c44, d38, u46, s68)), c44 += 6;
    }
  }
}
function K12(e71, t71) {
  const {
    indices: n63,
    numVerticesPerSide: o60,
    poleIndicesStartIndex: s67
  } = e71, r57 = o60 - 1;
  let i49 = s67;
  for (const a59 of t71) {
    const t72 = a59.connectedOuterEdgeOffset;
    let s68 = e71.getEdgeVertexIndex(t72, 0), c44 = 1;
    for (let e72 = 0; e72 < a59.latitudeResolution; ++e72) {
      const t73 = 0 === e72 ? a59.rowOffset : s68 + o60;
      for (let o61 = 0; o61 < r57; o61++) ge2(n63, i49, s68, s68 + 1, t73 + o61), i49 += 6, e72 < a59.latitudeResolution - 1 && (ge2(n63, i49, s68 + 1, t73 + o61 + 1, t73 + o61), i49 += 6), s68 += c44;
      s68 = t73, c44 = 1;
    }
  }
}
function Q16(e71) {
  const {
    indices: t71,
    numVerticesPerSide: n63,
    edgeIndicesStartIndex: o60
  } = e71, s67 = n63 - 1, r57 = s67 - 2;
  let i49 = o60;
  for (let a59 = 0; a59 < 4; ++a59) {
    const n64 = ue3[a59];
    let o61 = 0, c44 = 0;
    const l47 = e71.getEdgeCount(a59), u46 = n64.count;
    O9(u46 === s67 - 1);
    const f46 = 1 === a59 || 2 === a59, m45 = f46 ? 1 : 3, g28 = f46 ? 3 : 1, p49 = e71.getEdgeFirstVertexIndex(a59), x26 = 1, h32 = n64.vertex0Index, M18 = n64.stride;
    for (; o61 < l47 - 1 || c44 < u46 - 1; ) {
      const e72 = h32 + c44 * M18, n65 = p49 + o61 * x26, a60 = o61 < l47 - 1, d38 = c44 < u46 - 1, f47 = a60 && (!d38 || (a60 ? 0 + s67 * (o61 + 0.5) / (l47 - 1) : 0) <= (d38 ? 1 + r57 * (c44 + 0.5) / (u46 - 1) : 0));
      f47 ? ++o61 : ++c44;
      const S26 = f47 ? n65 + x26 : e72 + M18;
      t71[i49] = e72, t71[i49 + m45] = n65, t71[i49 + m45 + 1] = n65, t71[i49 + g28] = S26, t71[i49 + g28 + 1] = S26, t71[i49 + 5] = e72, i49 += 6;
    }
  }
  e71.indexCount = i49;
}
function X11(e71) {
  const {
    geometry: t71,
    geometryState: n63
  } = e71, {
    edgeResolutions: o60
  } = n63, {
    numVerticesPerSide: s67,
    edgeVerticesStartIndex: r57
  } = t71, i49 = s67 - 2;
  let a59 = r57;
  for (let c44 = 0; c44 < 4; ++c44) {
    {
      const e72 = 0 === c44 || 2 === c44, t72 = (0 === c44 ? i49 - 1 : 0) * i49 + (1 === c44 ? i49 - 1 : 0), n64 = (e72 ? 0 : 1) * i49 + (e72 ? 1 : 0), o61 = ue3[c44];
      o61.vertex0Index = t72, o61.stride = n64, o61.count = i49;
    }
    {
      const e72 = o60[c44] + 1;
      t71.outerEdgesOffsetAndLength[2 * c44 + 0] = a59, t71.outerEdgesOffsetAndLength[2 * c44 + 1] = e72, a59 += e72;
    }
  }
}
function Y11(e71) {
  X11(e71), e71.geometryState.wireframe ? Q16(e71.geometry) : z16(e71.geometry);
}
function Z10(n63, o60, s67) {
  const {
    geometryState: r57,
    geometry: i49,
    tile: c44,
    localOrigin: l47
  } = n63, u46 = 1 === o60 || 3 === o60, f46 = r57.edgeResolutions[o60];
  O9(a6(f46));
  const m45 = f46 + 1, {
    boundingBox: g28,
    minu: p49,
    minv: x26,
    maxu: h32,
    maxv: M18,
    vertexAttributes: S26
  } = i49, y27 = e12(1 === o60 ? 1 : 0, p49, h32), v28 = e12(0 === o60 ? 1 : 0, x26, M18), L25 = s67.renderData, B17 = L25.geometryState, I25 = L25.geometry, V19 = (o60 + 2) % 4, b25 = I25.getEdgeCount(V19), C25 = c44.getNeighborEdgeStartVertexIndex(o60, s67) * f46, P19 = f46 * 2 ** (c44.level - s67.level);
  O9(B17.edgeResolutions[V19] === P19), O9(b25 - 1 === P19);
  const A32 = L25.localOrigin[0] - l47[0], E37 = L25.localOrigin[1] - l47[1], O34 = L25.localOrigin[2] - l47[2], T21 = i49.getEdgeFirstVertexIndex(o60), D15 = S26.position, R17 = D15.typedBuffer, U23 = D15.typedBufferStride, N18 = S26.normalCompressed, w24 = N18.typedBuffer, j21 = N18.typedBufferStride, F18 = S26.uv0, H23 = I25.vertexAttributes, q20 = I25.getEdgeFirstVertexIndex(V19), _30 = H23.position.typedBuffer, W11 = H23.position.typedBufferStride, G17 = H23.normalCompressed.typedBuffer, k23 = H23.normalCompressed.typedBufferStride;
  for (let e71 = 1; e71 < m45 - 1; ++e71) {
    const n64 = T21 + e71, o61 = q20 + (C25 + e71), s68 = n64 * U23, r58 = o61 * W11, i50 = _30[r58] + A32, c45 = _30[r58 + 1] + E37, l48 = _30[r58 + 2] + O34;
    R17[s68] = i50, R17[s68 + 1] = c45, R17[s68 + 2] = l48, de3(i50, c45, l48, g28);
    const d38 = n64 * j21, m46 = o61 * k23;
    w24[d38] = G17[m46], w24[d38 + 1] = G17[m46 + 1];
    const S27 = e71 / f46, L26 = u46 ? y27 : e12(S27, p49, h32), B18 = u46 ? e12(S27, x26, M18) : v28;
    u34(F18, n64, L26, B18);
  }
}
function $9(e71) {
  const {
    geometry: n63,
    geometryState: o60,
    localOrigin: r57
  } = e71, {
    clippingArea: i49,
    samplerData: c44
  } = o60, {
    minu: l47,
    minv: u46,
    maxu: f46,
    maxv: m45,
    boundingBox: g28,
    vertexAttributes: p49
  } = n63, h32 = e71.tile, {
    surface: M18,
    ellipsoid: S26,
    extent: y27,
    extentInRadians: v28,
    horizontalScale: L25
  } = h32, B17 = "local" === M18.view?.viewingMode, I25 = S26.radius;
  let V19 = 0, b25 = 0, C25 = 0;
  const P19 = (e72, t71, n64) => {
    const o61 = v28[0 === t71 ? 1 : 3], s67 = v28[0 === e72 ? 0 : 2], r58 = Math.cos(o61), i50 = Math.sin(o61), a59 = Math.sin(s67), c45 = Math.cos(s67), l48 = I25 + n64;
    V19 = c45 * r58 * l48, b25 = a59 * r58 * l48, C25 = i50 * l48;
  }, A32 = B17 ? (() => {
    const e72 = i49, n64 = null != e72 && (y27[3] > e72[3] || y27[2] > e72[2] || y27[1] < e72[1] || y27[0] < e72[0]), o61 = _23(M18.isWebMercatorOnPlateCarree, I25, L25);
    return (s67, r58, i50) => {
      const a59 = 0 === s67 ? y27[0] : y27[2], c45 = 0 === r58 ? y27[1] : y27[3], l48 = n64 ? e12(a59, e72[0], e72[2]) : a59, u47 = n64 ? e12(c45, e72[1], e72[3]) : c45, d38 = i50;
      V19 = l48 * L25, b25 = o61(u47), C25 = d38;
    };
  })() : P19;
  let E37 = 0, T21 = 0, D15 = 0, R17 = 0, U23 = 0, N18 = 0, w24 = 0, j21 = 0, F18 = 0;
  const H23 = B17 && M18.isWebMercatorOnPlateCarree, q20 = (e72, t71, n64, o61, s67) => {
    let r58 = 0, i50 = 0, a59 = 0;
    if (B17) {
      const e73 = t71 * L25, s68 = H23 ? (Math.PI / 2 - 2 * Math.atan(Math.exp(-n64 / I25))) * I25 : n64 * L25;
      r58 = e73 - V19, i50 = s68 - b25, a59 = o61 - C25;
    } else {
      const s68 = O26(e72), c45 = e72.tile, l48 = c45.extent, u47 = c45.extentInRadians, d38 = (t71 - l48[0]) / (l48[2] - l48[0]), f47 = (n64 - l48[1]) / (l48[3] - l48[1]), m46 = u47[0] * (1 - d38) + u47[2] * d38, g29 = s68(f47), p50 = Math.cos(g29), x26 = Math.sin(g29), h33 = Math.sin(m46), M19 = Math.cos(m46), S27 = I25 + o61;
      r58 = M19 * p50 * S27 - V19, i50 = h33 * p50 * S27 - b25, a59 = x26 * S27 - C25;
    }
    switch (s67) {
      case 0:
        w24 += r58, j21 += i50, F18 += a59;
        break;
      case 1:
        R17 -= r58, U23 -= i50, N18 -= a59;
        break;
      case 2:
        w24 -= r58, j21 -= i50, F18 -= a59;
        break;
      case 3:
        R17 += r58, U23 += i50, N18 += a59;
    }
  }, W11 = i49 ?? ie5, G17 = y27[0], k23 = y27[2], z19 = y27[1], J13 = y27[3], K14 = [J13 > W11[3], k23 > W11[2], z19 < W11[1], G17 < W11[0]], Q18 = Math.max(G17, W11[0]), X13 = Math.min(k23, W11[2]), Y12 = Math.max(z19, W11[1]), Z11 = Math.min(J13, W11[3]), $10 = (e72) => Math.max(W11[0], Math.min(W11[2], e72)), te5 = (e72) => Math.max(W11[1], Math.min(W11[3], e72)), ne6 = (e72) => {
    const t71 = o60.cornerNeighborCornerTiles;
    E37 = 0, T21 = 0, D15 = 1, R17 = 0, U23 = 0, N18 = 0, w24 = 0, j21 = 0, F18 = 0;
    let n64 = 1 / 0;
    for (let o61 = 0; o61 < 4; ++o61) {
      const s67 = t71[4 * e72 + o61];
      n64 = Math.min(n64, s67?.level ?? 1 / 0);
    }
    for (let o61 = 0; o61 < 4; ++o61) {
      const s67 = t71[4 * e72 + o61];
      ae5[o61] = s67?.level === n64 ? s67 : null;
    }
    let r58 = 1, i50 = 0;
    for (let o61 = 0; o61 < 4; ++o61) {
      const e73 = ae5[o61];
      e73 && (r58 = Math.max(r58, e73?.renderData.geometryState.numVerticesPerSide), i50 = e73.extent[2] - e73.extent[0]);
    }
    const a59 = i50, c45 = r58;
    O9(c45 > 1);
    const l48 = a59 / c45;
    for (let o61 = 0; o61 < 4; ++o61) {
      const e73 = ae5[(o61 + 3) % 4], t72 = ae5[o61 % 4];
      if (!e73 && !t72) continue;
      const n65 = 0 === o61 ? 1 : 1 === o61 ? 2 : 2 === o61 ? 3 : 0, r59 = 0 === o61 ? 2 : 1 === o61 ? 3 : 2 === o61 ? 0 : 1;
      if (e73 && t72) {
        const i51 = se6[o61][0] * l48, a60 = se6[o61][1] * l48, c46 = e73.extent, u47 = $10(c46[0 === n65 || 1 === n65 ? 2 : 0] + i51), d38 = te5(c46[0 === n65 || 3 === n65 ? 3 : 1] + a60), f47 = t72.extent, m46 = $10(f47[0 === r59 || 1 === r59 ? 2 : 0] + i51), g29 = te5(f47[0 === r59 || 3 === r59 ? 3 : 1] + a60), p50 = e73.renderData, x26 = t72.renderData, h33 = e55(u47, d38, p50.geometryState.samplerData), M19 = e55(m46, g29, x26.geometryState.samplerData);
        q20(p50, u47, d38, 0.5 * (h33 + M19), o61);
      } else {
        const i51 = e73 ?? t72, a60 = e73 ? n65 : r59, c46 = i51.extent, u47 = se6[o61], d38 = $10(c46[0 === a60 || 1 === a60 ? 2 : 0] + u47[0] * l48), f47 = te5(c46[0 === a60 || 3 === a60 ? 3 : 1] + u47[1] * l48), m46 = i51.renderData, g29 = e55(d38, f47, m46.geometryState.samplerData);
        q20(m46, d38, f47, g29, o61);
      }
    }
    if (!B17) {
      const e73 = Math.sqrt(V19 * V19 + b25 * b25 + C25 * C25);
      E37 = V19 / e73, T21 = b25 / e73, D15 = C25 / e73;
    }
    if (B17 || D15 * D15 < 0.999) {
      const e73 = Math.sqrt(R17 * R17 + U23 * U23 + N18 * N18);
      R17 /= e73, U23 /= e73, N18 /= e73;
      const t72 = Math.sqrt(w24 * w24 + j21 * j21 + F18 * F18);
      w24 /= t72, j21 /= t72, F18 /= t72, E37 = N18 * j21 - U23 * F18, T21 = R17 * F18 - N18 * w24, D15 = U23 * w24 - R17 * j21;
      const n65 = 1 / Math.sqrt(E37 * E37 + T21 * T21 + D15 * D15);
      E37 *= n65, T21 *= n65, D15 *= n65;
    }
  }, oe6 = o60.cornerNeighborCornerTiles;
  for (let O34 = 0; O34 < 4; ++O34) {
    const e72 = O34, i50 = (O34 + 1) % 4, M19 = 0 === O34 || 1 === O34 ? 1 : 0, S27 = 0 === O34 || 3 === O34 ? 1 : 0, y28 = e12(M19, l47, f46), v29 = e12(S27, u46, m45), L26 = n63.getEdgeFirstVertexIndex(e72), B18 = n63.getEdgeCount(e72), I26 = 0 === O34 || 3 === O34 ? B18 - 1 : 0, P20 = n63.getEdgeFirstVertexIndex(i50), R18 = n63.getEdgeCount(i50), U24 = 0 === O34 || 1 === O34 ? R18 - 1 : 0;
    let N19 = -1;
    for (let t71 = 0; t71 < 4; ++t71) {
      const e73 = oe6[4 * O34 + t71], n64 = oe6[4 * O34 + N19];
      e73 && (-1 === N19 || u18(n64, e73) > 0) && (N19 = t71);
    }
    const w25 = N19, j22 = oe6[4 * O34 + w25];
    if (j22 !== h32) {
      const e73 = h32.level - j22.level, t71 = 2 ** e73, n64 = [j22.lij[0] + e73, j22.lij[1] * t71, j22.lij[2] * t71], s67 = [n64[1] + t71 === h32.lij[1], 0 === O34 && (1 === w25 || 0 === w25 && j22 !== oe6[4 * O34 + 3]) || 1 === O34 && (0 === w25 || 1 === w25 && j22 !== oe6[4 * O34 + 2]), n64[1] === h32.lij[1] + 1, 2 === O34 && (3 === w25 || 2 === w25 && j22 !== oe6[4 * O34 + 1]) || 3 === O34 && (2 === w25 || 3 === w25 && j22 !== oe6[4 * O34 + 0])], i51 = s67.reduce((e74, t72) => e74 + (t72 ? 1 : 0), 0);
      O9(1 === i51 || 2 === i51);
      let c45 = -1, l48 = -1;
      const u47 = j22.renderData;
      if (1 === i51) {
        const e74 = s67.findIndex((e75) => e75);
        O9(0 <= e74 && e74 <= 3), c45 = (e74 + 2) % 4;
        const t72 = o60.edgeResolutions[e74];
        l48 = h32.getNeighborEdgeStartVertexIndex(e74, j22) * t72 + t72 * (0 === e74 && 0 === O34 || 1 === e74 && 0 === O34 || 2 === e74 && 1 === O34 || 3 === e74 && 3 === O34 ? 1 : 0);
      } else {
        O9(s67[1] || s67[3]), c45 = s67[1] ? 3 : 1;
        const e74 = u47.geometryState.edgeResolutions[c45];
        l48 = 0 === O34 || 3 === O34 ? 0 : e74;
      }
      const f47 = u47.geometry;
      {
        const e74 = L26 + I26, t72 = P20 + U24, n65 = f47.getEdgeFirstVertexIndex(c45) + l48, o61 = f47.vertexAttributes, s68 = u47.localOrigin;
        {
          const i53 = o61.position, a59 = i53.typedBuffer, c46 = n65 * i53.typedBufferStride, l49 = a59[c46] + s68[0] - r57[0], u48 = a59[c46 + 1] + s68[1] - r57[1], d38 = a59[c46 + 2] + s68[2] - r57[2];
          de3(l49, u48, d38, g28);
          const f48 = p49.position, m46 = f48.typedBuffer;
          {
            const t73 = e74 * f48.typedBufferStride;
            m46[t73] = l49, m46[t73 + 1] = u48, m46[t73 + 2] = d38;
          }
          {
            const e75 = t72 * f48.typedBufferStride;
            m46[e75] = l49, m46[e75 + 1] = u48, m46[e75 + 2] = d38;
          }
        }
        const i52 = p49.uv0;
        u34(i52, e74, y28, v29), u34(i52, t72, y28, v29);
        {
          const s69 = o61.normalCompressed.typedBuffer, r58 = n65 * o61.normalCompressed.typedBufferStride, i53 = p49.normalCompressed, a59 = i53.typedBuffer;
          {
            const t73 = e74 * i53.typedBufferStride;
            a59[t73] = s69[r58], a59[t73 + 1] = s69[r58 + 1];
          }
          {
            const e75 = t72 * i53.typedBufferStride;
            a59[e75] = s69[r58], a59[e75 + 1] = s69[r58 + 1];
          }
        }
      }
    } else {
      const o61 = K14[e72], a59 = K14[i50];
      let l48;
      if (o61 || a59) {
        const e73 = e12(G17 * (1 - M19) + k23 * M19, Q18, X13), n64 = e12(z19 * (1 - S27) + J13 * S27, Y12, Z11);
        l48 = e55(e73, n64, c44);
      } else l48 = ee4(oe6, O34);
      A32(M19, S27, l48), ne6(O34);
      const u47 = V19 - r57[0], d38 = b25 - r57[1], f47 = C25 - r57[2];
      de3(u47, d38, f47, g28), n63.setEdgeVertexFromValuesRawPositionUVNormal(e72, I26, u47, d38, f47, y28, v29, E37, T21, D15), n63.setEdgeVertexFromValuesRawPositionUVNormal(i50, U24, u47, d38, f47, y28, v29, E37, T21, D15);
    }
  }
  for (let t71 = 0; t71 < 4; ++t71) ae5[t71] = null;
}
function ee4(e71, t71) {
  const n63 = 4 * t71, o60 = ee3.reduce((t72, o61) => Math.min(t72, e71[n63 + o61]?.level ?? 1 / 0), 1 / 0);
  E16 && (O9(!e71[n63 + 0] || !e71[n63 + 2] || ce4(e71[n63 + 0], e71[n63 + 2], T6.SOUTH_WEST)), O9(!e71[n63 + 1] || !e71[n63 + 3] || ce4(e71[n63 + 1], e71[n63 + 3], T6.NORTH_WEST)));
  let r57 = 0, a59 = 0;
  for (let i49 = 0; i49 < 4; ++i49) {
    const t72 = e71[n63 + i49];
    if (t72 && t72.level === o60) {
      const e72 = 0 === i49 || 1 === i49, n64 = 0 === i49 || 3 === i49, o61 = t72.extent, c45 = o61[e72 ? 0 : 2], l47 = o61[n64 ? 1 : 3], u46 = t72.renderData?.geometryState?.samplerData;
      a59 += e55(c45, l47, u46), r57++;
    }
  }
  const c44 = r57 ? a59 / r57 : 0;
  return O9(null != c44), c44;
}
function te4(e71) {
  const {
    vao: t71,
    geometry: n63
  } = e71, {
    vertexAttributes: o60,
    edgeVerticesStartIndex: s67
  } = n63, r57 = o60.position.typedBuffer;
  t71.vertexBuffers.geometry.setSubData(r57, s67, s67, r57.length);
}
function ne5(e71) {
  const {
    vao: t71,
    geometry: n63
  } = e71, {
    indices: o60,
    indexCount: s67,
    edgeIndicesStartIndex: r57
  } = n63;
  t71.indexBuffer.setSubData(o60, r57, r57, s67);
}
var oe4 = class {
  constructor(e71, t71, n63, o60, s67) {
    this.isNorth = e71, this.connectedRowOffset = t71, this.connectedOuterEdgeOffset = n63, this.rowOffset = o60, this.latitudeResolution = s67;
  }
};
var se6 = [[0, 1], [1, 0], [0, -1], [-1, 0]];
var re5 = new t52();
var ie5 = a7(-1 / 0, -1 / 0, 1 / 0, 1 / 0);
var ae5 = [null, null, null, null];
function ce5(e71, t71, n63) {
  if (!t71) return false;
  const o60 = u18(e71, t71);
  return o60 > 0 || 0 === o60 && n63 >= 2;
}
var le4 = class {
  constructor() {
    this.vertex0Index = 0, this.stride = 1, this.count = 0;
  }
  getVertexIndex(e71) {
    return O9(0 <= e71 && e71 < this.count), this.vertex0Index + this.stride * e71;
  }
};
var ue3 = [new le4(), new le4(), new le4(), new le4()];
function de3(e71, t71, n63, o60) {
  e71 < o60[0] ? o60[0] = e71 : e71 > o60[3] && (o60[3] = e71), t71 < o60[1] ? o60[1] = t71 : t71 > o60[4] && (o60[4] = t71), n63 < o60[2] ? o60[2] = n63 : n63 > o60[5] && (o60[5] = n63);
}
function fe2(e71) {
  const {
    edgeResolutions: t71,
    numVerticesPerSide: n63
  } = e71, o60 = 1 + Math.max(...t71);
  return Math.max(n63, o60);
}
function me3(e71, t71, n63, o60, s67, r57) {
  const i49 = e71 * s67, a59 = r57[i49], c44 = r57[i49 + 1], l47 = r57[i49 + 2], u46 = t71 * s67, d38 = r57[u46], f46 = r57[u46 + 1], m45 = r57[u46 + 2], g28 = n63 * s67, p49 = r57[g28], x26 = r57[g28 + 1], h32 = r57[g28 + 2], M18 = o60 * s67, S26 = r57[M18], y27 = r57[M18 + 1], v28 = r57[M18 + 2];
  return (d38 - S26) * (d38 - S26) + (f46 - y27) * (f46 - y27) + (m45 - v28) * (m45 - v28) > (a59 - p49) * (a59 - p49) + (c44 - x26) * (c44 - x26) + (l47 - h32) * (l47 - h32);
}
function ge2(e71, t71, n63, o60, s67) {
  e71[t71] = n63, e71[t71 + 1] = o60, e71[t71 + 2] = o60, e71[t71 + 3] = s67, e71[t71 + 4] = s67, e71[t71 + 5] = n63;
}
var pe3 = 6;

// ../../../node_modules/@arcgis/core/views/3d/terrain/PlanarPatch.js
var _24 = class extends ie4 {
  constructor(e71, t71, r57, o60, i49) {
    super(), this._horizontalScaleFactor = 1, this._extentInRenderSR = u6(), this._baseUsedMemory = 900, this._subtreeGeometryElevationBoundMin = 0, this._subtreeGeometryElevationBoundMax = 0, this.init(e71, t71, r57, o60, i49);
  }
  init(t71, i49, s67, a59, l47) {
    super.init(t71, i49, s67, a59, l47);
    const u46 = l47.view.renderSpatialReference, h32 = l47.spatialReference, d38 = null != u46 && O(u46) && null != h32 && h32.isGeographic ? this.ellipsoid.radius * Math.PI / 180 : 1;
    this._horizontalScaleFactor = d38;
    const {
      isWebMercatorOnPlateCarree: c44
    } = l47, m45 = this._extentInRenderSR, p49 = this.extent;
    if (c44) {
      const t72 = r4(p49[0], p49[1], 0);
      n12(t72, f2.WebMercator, t72, f2.PlateCarree);
      const i50 = r4(p49[2], p49[3], 0);
      n12(i50, f2.WebMercator, i50, f2.PlateCarree), m45[0] = t72[0], m45[1] = t72[1], m45[2] = i50[0], m45[3] = i50[1];
    } else for (let e71 = 0; e71 < 4; ++e71) m45[e71] = p49[e71] * d38;
    this.centerAtSeaLevel[0] = 0.5 * (m45[0] + m45[2]), this.centerAtSeaLevel[1] = 0.5 * (m45[1] + m45[3]), this.centerAtSeaLevel[2] = 0, this._edgeLen = Math.max(m45[2] - m45[0], m45[3] - m45[1]), this._edgeLen2 = this._edgeLen * this._edgeLen, this.updateRadiusAndCenter();
  }
  updateRadiusAndCenter() {
    this._updateCenter();
    const e71 = this._extentInRenderSR, t71 = 0.5 * (e71[2] - e71[0]), r57 = 0.5 * (e71[3] - e71[1]), o60 = Math.sqrt(t71 * t71 + r57 * r57), i49 = 0.5 * (this.elevationBoundsMax - this.elevationBoundsMin), s67 = Math.max(o60, i49);
    this._center[oe3.MIDDLE][3] = s67;
  }
  _calculateFrustumVisibilityStatus(e71) {
    const t71 = this._aabb(), r57 = t71[0], o60 = t71[1], i49 = t71[2], s67 = t71[3], n63 = t71[4], a59 = t71[5];
    let l47 = true;
    for (let u46 = 0; u46 < 6; u46++) {
      const t72 = e71[u46], h32 = t72[0], d38 = t72[1], c44 = t72[2], p49 = t72[3];
      if (h32 * (h32 > 0 ? r57 : s67) + d38 * (d38 > 0 ? o60 : n63) + c44 * (c44 > 0 ? i49 : a59) + p49 >= 0) return E32.OUTSIDE;
      l47 = l47 && h32 * (h32 < 0 ? r57 : s67) + d38 * (d38 < 0 ? o60 : n63) + c44 * (c44 < 0 ? i49 : a59) + p49 <= 0;
    }
    return l47 ? E32.INSIDE : E32.INTERSECTS;
  }
  _aabb() {
    const e71 = this._extentInRenderSR;
    return k(e71[0], e71[1], Math.min(this.elevationBoundsMin, this._subtreeGeometryElevationBoundMin), e71[2], e71[3], Math.max(this.elevationBoundsMax, this._subtreeGeometryElevationBoundMax));
  }
  intersectsRay(e71, t71, r57, o60) {
    return b18[0] = 1 / t71[0], b18[1] = 1 / t71[1], b18[2] = 1 / t71[2], w5(this._aabb(), e71, b18, r57, o60);
  }
  createGeometry() {
    T17(this.renderData, this._horizontalScaleFactor), this._updateSubtreeGeometryElevationsBounds(), this.setMemoryDirty();
  }
  _updateSubtreeGeometryElevationsBounds() {
    const e71 = this._subtreeGeometryElevationBoundMin, t71 = this._subtreeGeometryElevationBoundMax, r57 = this.renderData;
    let o60 = e71, i49 = t71;
    if (r57) {
      const e72 = r57.geometry.boundingBox;
      o60 = e72[2], i49 = e72[5];
    } else if (!this.isLeaf) {
      o60 = 1 / 0, i49 = -1 / 0;
      for (const e72 of this.children) o60 = Math.min(o60, e72._subtreeGeometryElevationBoundMin), i49 = Math.max(i49, e72._subtreeGeometryElevationBoundMax);
    }
    if (o60 !== this._subtreeGeometryElevationBoundMin || i49 !== this._subtreeGeometryElevationBoundMax) {
      this._subtreeGeometryElevationBoundMin = o60, this._subtreeGeometryElevationBoundMax = i49;
      const e72 = this.parent;
      e72?._updateSubtreeGeometryElevationsBounds();
    }
  }
  getDefaultVerticesPerSide() {
    return this.level < 9 ? 3 : 2;
  }
  updateCornerElevations() {
    R10(this.renderData, this._horizontalScaleFactor), this._updateSubtreeGeometryElevationsBounds();
  }
  updateEdgeElevations() {
    N12(this.renderData, this._horizontalScaleFactor), this._updateSubtreeGeometryElevationsBounds();
  }
  updateEdgeElevationsAndResolutions() {
    U18(this.renderData, this._horizontalScaleFactor), this._updateSubtreeGeometryElevationsBounds();
  }
  get horizontalScale() {
    return this._horizontalScaleFactor;
  }
};
var b18 = n7();

// ../../../node_modules/@arcgis/core/views/3d/terrain/ScaleRangeQueries.js
var l39 = class {
  constructor() {
    this.extent = n11(), this.minLevel = 0, this.maxLevel = 0, this.callback = null;
  }
};
var a46 = class extends S3 {
  constructor() {
    super(...arguments), this._queries = new l3({
      initialSize: 10
    }), this._queriesInvPtr = 0, this._queryQueue = new l3({
      initialSize: 30
    }), this._queryPool = new e3(l39);
  }
  queryVisibleLevelRange(e71, t71, s67, r57) {
    const i49 = this._queryPool.acquire();
    a9(i49.extent, e71), i49.minLevel = t71 ?? -Number.MAX_VALUE, i49.maxLevel = s67 ?? Number.MAX_VALUE, i49.callback = r57, this._queryQueue.push(i49), this.notifyChange("updating");
  }
  get updating() {
    return 0 !== this._queryQueue.length;
  }
  prepare() {
    for (; this._queries.length < this._queries.data.length && this._queryQueue.length > 0; ) {
      const e71 = this._queryQueue.pop();
      this._queries.push(e71);
    }
    this._queriesInvPtr = this._queries.length;
  }
  process() {
    for (let e71 = 0; e71 < this._queries.length; e71++) {
      const t71 = this._queries.data[e71];
      this._queryPool.release(t71), t71.callback(e71 >= this._queriesInvPtr), t71.callback = null;
    }
    this._queries.clear(), this.notifyChange("updating");
  }
  queriesForTile(e71) {
    const t71 = e71.level;
    let s67 = 0;
    for (; s67 < this._queriesInvPtr; ) {
      const r57 = this._queries.data[s67], i49 = r57.extent;
      t71 >= r57.minLevel && t71 <= r57.maxLevel && i49[0] <= e71.extent[2] && i49[2] >= e71.extent[0] && i49[1] <= e71.extent[3] && i49[3] >= e71.extent[1] ? (this._queries.swapElements(s67, this._queriesInvPtr - 1), this._queriesInvPtr--) : s67++;
    }
  }
};
e6([y2()], a46.prototype, "updating", null), a46 = e6([a4("esri.views.3d.terrain.ScaleRangeQueries")], a46);

// ../../../node_modules/@arcgis/core/geometry/projection/lonLatToSphericalPCPF.js
function t56(t71, n63, o60, s67) {
  const a59 = Math.cos(o60);
  t71[0] = Math.cos(n63) * a59 * s67, t71[1] = Math.sin(n63) * a59 * s67, t71[2] = Math.sin(o60) * s67;
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/SphericalPatch.js
var y21 = class extends ie4 {
  constructor(t71, e71, i49, s67, o60) {
    super(), this._convexHull = new Array(24), this._boundingSphere = _5(), this._baseUsedMemory = 1816, this.init(t71, e71, i49, s67, o60);
  }
  init(i49, s67, o60, n63, r57) {
    super.init(i49, s67, o60, n63, r57);
    const l47 = this.ellipsoid.radius, a59 = this.extentInRadians[0], h32 = this.extentInRadians[1], u46 = this.extentInRadians[2], c44 = this.extentInRadians[3], p49 = f4(h32, c44, 0.5), f46 = f4(a59, u46, 0.5), m45 = 0 === i49 ? 0 : Math.min(Math.abs(h32), Math.abs(c44));
    this._edgeLen = (u46 - a59) * Math.cos(m45) * l47, this._edgeLen2 = this._edgeLen * this._edgeLen, this._curvatureHeight = l47 - Math.sqrt(l47 * l47 - this._edgeLen2 / 4), t56(this.centerAtSeaLevel, f46, p49, this.ellipsoid.radius), z(this.up, this.centerAtSeaLevel), this.updateRadiusAndCenter();
  }
  updateRadiusAndCenter() {
    this._updateBoundingVolumes();
    const t71 = this._center;
    if (0 === this.lij[0]) o4(V2(t71[oe3.MIDDLE]), 0, 0, 0), o4(t71[oe3.TOP], 0, 0, 0), o4(t71[oe3.BOTTOM], 0, 0, 0), t71[oe3.MIDDLE][3] = this.ellipsoid.radius + this.elevationBoundsMax;
    else {
      this._updateCenter();
      const e71 = t71[oe3.MIDDLE], i49 = this.convexHull;
      let s67 = 0;
      for (let t72 = 0; t72 < 8; ++t72) s67 = Math.max(s67, L22(V2(e71), i49, 3 * t72));
      t71[oe3.MIDDLE][3] = Math.sqrt(s67);
    }
  }
  _calculateFrustumVisibilityStatus(t71) {
    if (!s17(t71, this._boundingSphere)) return E32.OUTSIDE;
    if (this.lij[0] < 10) return E32.INTERSECTS;
    const e71 = this.convexHull, i49 = this.surface.view.state.camera.near;
    let s67 = true;
    for (let o60 = 0; o60 < b5; o60++) {
      const n63 = o60 === j6.NEAR, r57 = t71[o60], l47 = r57[0], a59 = r57[1], h32 = r57[2], u46 = r57[3] - (n63 ? i49 : 0);
      let d38 = false;
      for (let t72 = 0; t72 < 8; ++t72) {
        const i50 = 3 * t72;
        if (l47 * e71[i50] + a59 * e71[i50 + 1] + h32 * e71[i50 + 2] + u46 < 0) {
          if (d38 = true, !s67) break;
        } else s67 = false;
      }
      if (!d38) return E32.OUTSIDE;
    }
    return s67 ? E32.INSIDE : E32.INTERSECTS;
  }
  computeElevationBounds() {
    super.computeElevationBounds(), this._updateBoundingVolumes();
  }
  createGeometry() {
    S21(this.renderData, this._getPatchType()), this._updateBoundingVolumes(), this.setMemoryDirty();
  }
  _updateBoundingVolumes() {
    this._updateConvexHull(), this._updateBoundingSphere(), E16 && this._checkBVs();
  }
  _updateBoundingSphere() {
    const t71 = this._boundingSphere, e71 = V2(t71), r57 = this.elevationBoundsMin, l47 = this.elevationBoundsMax, a59 = this.ellipsoid.radius, h32 = l47;
    if (0 === this.level) o4(e71, 0, 0, 0), t71[3] = a59 + h32;
    else {
      const i49 = this.extentInRadians, h33 = 0.5 * (i49[0] + i49[2]), u46 = i49[1], d38 = i49[3];
      O27(V16, h33, u46, a59), O27(A27, h33, d38, a59), u5(e71, V16, A27);
      g3(e71, e71, (a59 + 0.5 * (r57 + l47)) / Y(e71));
      const c44 = this.convexHull;
      let p49 = 0;
      const f46 = (t72, e72) => {
        const i50 = t72[0] - c44[3 * e72], s67 = t72[1] - c44[3 * e72 + 1], o60 = t72[2] - c44[3 * e72 + 2];
        return Math.sqrt(i50 * i50 + s67 * s67 + o60 * o60);
      };
      for (let t72 = 0; t72 < 8; ++t72) {
        const i50 = f46(e71, t72);
        p49 = Math.max(p49, i50);
      }
      const m45 = p49;
      t71[3] = m45 + 2;
    }
  }
  _updateConvexHull() {
    const t71 = this.extentInRadians, i49 = this.ellipsoid.radius;
    if (0 === this.level) return;
    const a59 = this.elevationBoundsMin, d38 = this.elevationBoundsMax, c44 = this._getPatchType(), p49 = this.surface.isWebMercator, f46 = p49 && c44 === O10.HAS_NORTH_POLE, m45 = p49 && c44 === O10.HAS_SOUTH_POLE, g28 = m45 || f46, x26 = Math.PI / 2, _30 = t71[0], v28 = t71[2], M18 = m45 ? -x26 : t71[1], b25 = f46 ? x26 : t71[3], j21 = 0.5 * (_30 + v28), E37 = a59, H23 = i49 + (g28 ? Math.min(0, E37 - 1) : E37), B17 = (t72, e71, i50) => O27(t72, e71, i50, H23), I25 = n7(), y27 = n7(), D15 = n7(), L25 = n7();
    B17(I25, _30, M18), B17(y27, _30, b25), B17(D15, v28, b25), B17(L25, v28, M18);
    const R17 = (t72, e71) => {
      for (let i50 = 0; i50 < 3; ++i50) this._convexHull[3 * e71 + i50] = t72[i50];
    };
    R17(I25, 0), R17(y27, 1), R17(D15, 2), R17(L25, 3);
    const V19 = d38, A32 = i49 + (g28 ? Math.max(0, V19 + 1) : V19), C25 = n7(), F18 = n7(), N18 = n7();
    O27(F18, j21, b25, H23), O27(N18, j21, M18, H23), u5(C25, F18, N18), z(C25, C25);
    const U23 = n7(), k23 = n7(), w24 = (t72, i50) => {
      K(k23, t72, i50), z(k23, k23);
      const n63 = -P3(t72, U23) / P3(k23, U23);
      O9(n63 >= 0), g3(k23, k23, n63), u5(t72, t72, k23);
    };
    if (2 ** this.lij[0] > 2 * this.lij[1]) {
      const t72 = N18, i50 = n7();
      _2(i50, P15, t72), z(i50, i50), _2(U23, t72, i50), z(U23, U23), O9(q5(P3(U23, t72) / Y(t72), 0)), w24(I25, y27), w24(L25, D15), R17(I25, 0), R17(L25, 3);
    } else if (2 ** this.lij[0] !== 2 * this.lij[1]) {
      const t72 = F18, i50 = n7();
      _2(i50, P15, t72), z(i50, i50), _2(U23, i50, t72), z(U23, U23), w24(y27, I25), w24(D15, L25), R17(y27, 1), R17(D15, 2);
    }
    const q20 = (t72, e71) => {
      const i50 = A32 / P3(e71, C25);
      for (let s67 = 0; s67 < 3; ++s67) this._convexHull[3 * t72 + s67] = e71[s67] * i50;
    };
    q20(4, I25), q20(5, y27), q20(6, D15), q20(7, L25);
  }
  _getPatchType() {
    const t71 = this.lij[1], e71 = 0 === t71, i49 = t71 === (1 << this.level) - 1;
    return e71 ? i49 ? O10.HAS_BOTH_POLES : O10.HAS_NORTH_POLE : i49 ? O10.HAS_SOUTH_POLE : O10.REGULAR;
  }
  intersectsRay(t71, e71, i49, s67) {
    const o60 = this._boundingSphere, n63 = o60[3] + i49, r57 = e71[0] * e71[0] + e71[1] * e71[1] + e71[2] * e71[2], l47 = o60[0] - t71[0], a59 = o60[1] - t71[1], h32 = o60[2] - t71[2], u46 = (l47 * e71[0] + a59 * e71[1] + h32 * e71[2]) / r57, d38 = e71[0] * u46 - l47, c44 = e71[1] * u46 - a59, p49 = e71[2] * u46 - h32;
    return d38 * d38 + c44 * c44 + p49 * p49 < n63 * n63;
  }
  getDefaultVerticesPerSide() {
    return this.level < D10.length ? D10[this.level] + 1 : 2;
  }
  updateCornerElevations() {
    I21(this.renderData), this._updateBoundingVolumes();
  }
  updateEdgeElevations() {
    L21(this.renderData), this._updateBoundingVolumes();
  }
  updateEdgeElevationsAndResolutions() {
    B12(this.renderData), this._updateBoundingVolumes();
  }
  _checkBVs() {
    if (!E16) return;
    if (this.level <= 2) return;
    const t71 = this._boundingSphere, i49 = t71[3], o60 = V2(t71), d38 = n7(), p49 = this.ellipsoid.radius, f46 = this.elevationBoundsMin, m45 = this.elevationBoundsMax, g28 = p49 + f46, $10 = 1, _30 = 0, v28 = this._center[oe3.MIDDLE][3], M18 = this.convexHull, b25 = (t72, e71) => {
      for (let i50 = 0; i50 < 3; ++i50) t72[i50] = M18[3 * e71 + i50];
    };
    {
      const t72 = n7(), i50 = n7(), s67 = n7(), o61 = n7(), n63 = n7(), a59 = (a60, u46, d39, c44) => {
        b25(i50, a60), b25(s67, u46), b25(o61, d39), K(i50, i50, s67), K(o61, o61, s67), _2(t72, i50, o61), z(t72, t72);
        const p50 = P3(t72, s67);
        b25(n63, c44);
        const f47 = P3(t72, n63), m46 = Math.abs(f47 - p50);
        O9(q5(m46, 0), `Non coplanar ${a60},${u46},${d39},${c44} diff = ${m46}`);
      };
      a59(0, 1, 2, 3), a59(4, 5, 6, 7), a59(0, 1, 4, 5), a59(1, 2, 5, 6), a59(2, 3, 6, 7), a59(3, 0, 7, 4);
    }
    const E37 = t11(24), B17 = (t72, e71, i50) => {
      const s67 = 4 * t72;
      for (let o61 = 0; o61 < 3; ++o61) E37[s67 + o61] = e71[o61];
      E37[s67 + 3] = i50;
    }, y27 = n7(), D15 = n7(), L25 = n7(), P19 = n7(), V19 = (t72, i50, s67, o61) => {
      b25(y27, i50), b25(D15, s67), b25(L25, o61), K(y27, y27, D15), z(y27, y27), K(L25, L25, D15), z(L25, L25), _2(P19, y27, L25), z(P19, P19);
      const n63 = P3(P19, D15);
      B17(t72, P19, n63);
    };
    V19(0, 0, 1, 2), V19(1, 1, 0, 4), V19(2, 1, 5, 2), V19(3, 3, 2, 6), V19(4, 4, 0, 3), V19(5, 4, 6, 5);
    const A32 = 1, C25 = (t72, e71, i50, s67) => {
      const o61 = 4 * t72;
      return E37[o61] * e71 + E37[o61 + 1] * i50 + E37[o61 + 2] * s67 - E37[o61 + 3];
    }, F18 = (t72, e71, i50, s67) => C25(t72, e71, i50, s67) >= -A32, N18 = (t72, e71) => F18(t72, e71[0], e71[1], e71[2]), U23 = 2 ** this.lij[0] > 2 * this.lij[1], k23 = (t72, e71, s67) => Math.sqrt(R11(t72, e71, s67, o60[0], o60[1], o60[2])) < i49, w24 = (t72) => k23(t72[0], t72[1], t72[2]), q20 = (t72, e71) => k23(t72[e71], t72[e71 + 1], t72[e71 + 2]), G17 = this.extentInRadians, z19 = 0.5 * (G17[0] + G17[2]), W11 = G17[1], J13 = G17[3], K14 = n7(), Q18 = n7();
    O27(K14, z19, J13, g28), O27(Q18, z19, W11, g28);
    const X13 = U23 ? "Upper" : "Lower";
    let Y12 = true;
    for (let e71 = 0; e71 < 6; ++e71) {
      for (let t72 = 0; t72 < 8; ++t72) {
        const i50 = 3 * t72, s67 = F18(e71, M18[i50], M18[i50 + 1], M18[i50 + 2]);
        Y12 &&= s67, O9(s67, `Tile[${this.lij}] Convex hull point ${t72} outside of plane ${e71}`);
      }
      O9(N18(e71, Q18), `Tile[${this.lij}] (${X13}) bottom mid outside of plane ${e71}`), O9(N18(e71, K14), `Tile[${this.lij}] (${X13}) top mid outside of plane ${e71}`);
    }
    O9(Y12, "Not all convex hull points are inside  convex hull polyhedron"), O9(w24(Q18), `Tile[${this.lij}] (${X13}) bottom mid outside of bounding sphere`), O9(w24(K14), `Tile[${this.lij}] (${X13}) top mid outside of bounding sphere`);
    for (let e71 = 0; e71 < 8; ++e71) {
      const t72 = q20(M18, 3 * e71);
      O9(t72, `Tile[${this.lij}] Convex hull point ${e71} outside of bounding sphere`);
    }
    for (let e71 = 0; e71 < 6; ++e71) for (let t72 = 0; t72 < 8; ++t72) {
      const i50 = 3 * t72;
      F18(e71, M18[i50], M18[i50 + 1], M18[i50 + 2]) || console.error(`Tile[${this.lij}] Convex hull point ${t72} outside of plane ${e71}`);
    }
    const {
      extentInRadians: Z11
    } = this, tt5 = Math.max(Z11[2] - Z11[0], Z11[3] - Z11[1]), et4 = Math.round(tt5 * p49), {
      renderData: it6
    } = this;
    if (!it6) return;
    const {
      geometry: st5,
      geometryState: ot5,
      localOrigin: nt6
    } = it6, rt6 = st5.vertexAttributes?.position;
    if (!rt6) return;
    const lt6 = n7(), at7 = st5.numVerticesPerSide - 2, {
      indices: ht5,
      indexCount: ut4,
      edgeVerticesStartIndex: dt5,
      poleVerticesStartIndex: ct4
    } = st5;
    if (!ht5) return;
    const pt4 = /* @__PURE__ */ new Set();
    for (let e71 = 0; e71 < ut4; ++e71) {
      const t72 = ht5[e71];
      if (pt4.has(t72)) continue;
      pt4.add(t72);
      const r57 = t72 < ct4, l47 = t72 >= dt5;
      let h32 = false, u46 = -1;
      if (l47) {
        let e72 = dt5;
        for (let i50 = 0; i50 < 4; ++i50) {
          const s67 = ot5.edgeResolutions[i50];
          if (t72 === e72 || t72 === e72 + s67 - 1) {
            h32 = true;
            break;
          }
          if (e72 += s67, t72 < e72) {
            u46 = i50;
            break;
          }
        }
      }
      const c44 = l47 ? ot5.edgePeerNeighbors[u46] : null, g29 = l47 && c44 && u18(this, c44) > 0;
      rt6.getVec(t72, d38), u5(lt6, d38, nt6);
      const x26 = Y(lt6) - p49;
      let M19 = 0, b26 = false;
      const j21 = f46 - x26, S26 = x26 - m45, T21 = j21 > $10, E38 = S26 > $10, H23 = T21 || E38, B18 = () => {
        const e72 = r57 ? "internal" : l47 && !h32 ? "edge" : h32 ? "corner" : "pole";
        return `Tile[${this.lij}].vertex[${t72}]:${e72}` + (T21 ? "(below)" : E38 ? "(above)" : "") + (g29 ? "(Neighbor)" : "");
      }, y28 = U3(lt6, o60);
      if (y28 >= i49 + _30) {
        const t73 = y28 - i49;
        H23 || (console.error(`${B18()} is out of the bounding sphere by ${t73.toFixed(0)} / ${i49.toFixed(0)}[tol=${_30}] h=${x26.toFixed(0)} / [${f46.toFixed(0)}..${m45.toFixed(0)}] (${(t73 / i49).toFixed(0)})`), b26 = true);
      }
      for (let e72 = 0; e72 < 6; ++e72) if (!F18(e72, lt6[0], lt6[1], lt6[2])) {
        const s67 = C25(e72, lt6[0], lt6[1], lt6[2]), o61 = t72 % at7, n63 = (t72 - o61) / at7;
        0 === e72 && j21 || 5 === e72 && S26 || (console.error(`${B18()} (${o61},${n63})|${at7}] is out of the bounding trapezoid plane ${e72} h=${Math.round(x26)} / [${Math.round(f46)}..${Math.round(m45)}] dist=${Math.round(s67)} radii = ${Math.round(i49)}/${Math.round(v28)}} : maxL = ${et4}`), ++M19);
      }
      if (b26 || M19 > 0) break;
    }
  }
  get convexHull() {
    return this._convexHull;
  }
};
var D10 = [128, 64, 64, 32, 16, 8, 8, 4];
function L22(t71, e71, i49) {
  return R11(t71[0], t71[1], t71[2], e71[i49], e71[i49 + 1], e71[i49 + 2]);
}
function R11(t71, e71, i49, s67, o60, n63) {
  const r57 = s67 - t71, l47 = o60 - e71, a59 = n63 - i49;
  return r57 * r57 + l47 * l47 + a59 * a59;
}
var O27 = (t71, e71, i49, s67) => {
  const o60 = Math.cos(e71), n63 = Math.sin(e71), r57 = Math.cos(i49), l47 = Math.sin(i49);
  t71[0] = s67 * r57 * o60, t71[1] = s67 * r57 * n63, t71[2] = s67 * l47;
};
var P15 = [0, 0, 1];
var V16 = n7();
var A27 = n7();

// ../../../node_modules/@arcgis/core/views/3d/terrain/SplitLimits.js
var e57 = class extends S3 {
  constructor() {
    super(...arguments), this.fovX = 0, this.fovY = 0, this.relativeWidthLimit = 0, this.relativeHeightLimit = 0, this.maxLod = 0, this.angledSplitBias = 0, this.aboveGround = true;
  }
};
e6([y2()], e57.prototype, "fovX", void 0), e6([y2()], e57.prototype, "fovY", void 0), e6([y2()], e57.prototype, "relativeWidthLimit", void 0), e6([y2()], e57.prototype, "relativeHeightLimit", void 0), e6([y2()], e57.prototype, "maxLod", void 0), e6([y2()], e57.prototype, "angledSplitBias", void 0), e6([y2()], e57.prototype, "aboveGround", void 0), e6([y2()], e57.prototype, "frustum", void 0), e57 = e6([a4("esri.views.3d.terrain.SplitLimits")], e57);

// ../../../node_modules/@arcgis/core/views/3d/terrain/TerrainAttributes.js
var t57 = H2().vec3f(e18.POSITION).vec2i16(e18.UV0).vec2i16(e18.NORMALCOMPRESSED, {
  glNormalized: true
});

// ../../../node_modules/@arcgis/core/views/3d/terrain/TerrainAttributesCache.js
var t58 = class {
  constructor(r57) {
    this._storage = new c19((e71, t71) => r57.newCache(e71, t71), "TileGeometry");
  }
  acquire(e71) {
    const t71 = 4, s67 = Math.ceil(e71 / t71) * t71, a59 = this._storage, c44 = o48(s67), i49 = a59.pop(c44);
    if (i49) return i49;
    const n63 = t57.createBuffer(s67);
    return n63.release = () => a59.put(c44, n63), n63;
  }
  clear() {
    this._storage.clear();
  }
  destroy() {
    this._storage.destroy();
  }
};
function o48(e71) {
  return e71.toString();
}

// ../../../node_modules/@arcgis/core/views/3d/terrain/BlendModeTechniqueConfiguration.js
var s55 = class extends t18 {
  constructor() {
    super(...arguments), this.blendMode = t39.Normal;
  }
};
e6([r19({
  count: t39.COUNT
})], s55.prototype, "blendMode", void 0);

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileBlendTechniqueConfiguration.js
var s56 = class extends s55 {
  constructor() {
    super(...arguments), this.output = o35.Composite, this.baseOpacityMode = e37.NotRequired, this.premultipliedSource = O13.Off;
  }
};
e6([r19({
  count: o35.COUNT
})], s56.prototype, "output", void 0), e6([r19({
  count: e37.COUNT
})], s56.prototype, "baseOpacityMode", void 0), e6([r19()], s56.prototype, "premultipliedSource", void 0);

// ../../../node_modules/@arcgis/core/views/3d/terrain/BlendLayersTechnique.js
var b19 = class extends a26 {
  constructor() {
    super(...arguments), this.opacity = 1, this.baseOpacity = 1, this.texture = null, this.fboTexture = null, this.backgroundColor = l5;
  }
};
var p38 = class _p extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _p.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: s20(R3.ONE, R3.ONE_MINUS_SRC_ALPHA),
      colorWrite: _9
    });
  }
};
p38.shader = new t16(g11, () => import("./BlendLayers.glsl-YCZJMBTT.js"));
var f35 = class extends s56 {
  constructor() {
    super(...arguments), this.background = l21.BelowLayer;
  }
};
e6([r19()], f35.prototype, "background", void 0);

// ../../../node_modules/@arcgis/core/views/3d/terrain/TextureReference.js
var s57 = class {
  constructor(s67, r57, o60, i49, a59, c44) {
    this.texture = s67, this.type = r57, s67.retain(), this.offsetAndScale = r6(o60.offset[0], o60.offset[1], o60.scale, o60.scale), this.opacities = r4(i49, a59, c44);
  }
  destroy() {
    this.texture.release();
  }
};

// ../../../node_modules/@arcgis/core/views/2d/engine/vectorTiles/decluttering/jobsUtil.js
function y22(s67, y27) {
  const j21 = s67.transforms.tileUnitsToPixels, b25 = u4(y27), h32 = Math.cos(b25), u46 = Math.sin(b25), x26 = Math.ceil(512 * (Math.abs(u46) + Math.abs(h32)));
  o10(p39), M3(p39, p39, [x26 / 2, x26 / 2]), h6(p39, p39, b25), M3(p39, p39, [-256, -256]), f9(p39, p39, [1 / 8, 1 / 8, 1]), s67.transforms.tileUnitsToPixels = p39;
  const g28 = [], S26 = new r24(4096, g28, () => new s25()), M18 = new e28(g28, S26, (t71, o60, e71) => new l14(t71, o60, e71, s67.styleRepository, s67.key.level, y27), (t71, o60) => {
    r23(t71, o60, false);
  }, () => 0, (t71) => {
    const o60 = s67.styleRepository.getStyleLayerByUID(t71).getLayoutProperty("visibility");
    return !o60 || o60.getValue() !== i10.NONE;
  });
  g28.push(s67), S26.add(s67), M18.setScreenSize(x26, x26), M18.continue(1 / 0), S26.removeTile(s67), s67.transforms.tileUnitsToPixels = j21;
}
var p39 = e27();

// ../../../node_modules/@arcgis/core/views/2d/engine/vectorTiles/VectorTileRendererHelper3D.js
var p40 = 0.125;
var f36 = class {
  constructor() {
    this._renderParams = {
      reshuffleManager: new s22(),
      context: null,
      drawPhase: 1,
      state: new g22(),
      stationary: true,
      pixelRatio: 1,
      displayLevel: -1,
      requiredLevel: -1,
      globalOpacity: 1,
      renderPass: "background",
      styleLayer: null,
      styleLayerUID: -1,
      painter: null,
      glyphMosaic: null,
      spriteMosaic: null,
      profiler: null,
      renderingOptions: null,
      requestRender: null,
      allowDelayedRender: false,
      deltaTime: -1,
      timeline: null,
      time: 0,
      hasClipping: false,
      blendMode: null,
      dataUploadCounter: 0,
      effects: null,
      inFadeTransition: false,
      requireFBO: false,
      highlightGradient: null,
      stencilSymbols: true,
      is3D: true,
      backgroundColor: null
    }, this._backgroundTile = new t26(new e20(0, 0, 0, 0), 0, 0, 0, 512, 512, 4096, 4096), this._heading = 0, this._declutteredForHeading = /* @__PURE__ */ new WeakMap();
  }
  dispose() {
    this._renderParams = null;
  }
  renderBackground(e71, t71, i49, s67, l47, n63, r57, a59, o60, d38) {
    const c44 = this._backgroundTile;
    this._updateRenderParameters(e71, t71, c44, i49, l47, n63, r57, a59, o60, d38), this._renderParams.stencilSymbols = false, i49.drawBackground(this._renderParams, c44, s67);
  }
  renderContent(e71, t71, i49, s67, l47, n63, r57, a59, o60, d38, c44, h32) {
    this._declutter(i49), s67.forAll((e72) => this._declutter(e72.sourceLayerInfo.data)), this._stencilSymbols(e71, t71, i49, s67, l47, n63, r57, Math.round(1 / a59), o60, d38, c44, h32);
    let m45 = 1;
    i49.stencilRef = m45++, e71.setStencilFunction(O6.EQUAL, i49.stencilRef, 255), this._render(e71, t71, i49, l47, n63, r57, a59, o60, d38, c44, h32), s67.forAll((t72) => {
      t72.sourceLayerInfo.data.stencilRef = m45++, this._renderSymbols(e71, t72.sourceLod, t72.sourceLayerInfo.data, l47, n63, r57, Math.round(1 / a59), t72.offset, d38, c44, h32);
    });
  }
  _stencilSymbols(e71, t71, i49, s67, l47, n63, r57, a59, o60, d38, c44, h32) {
    let p49 = 1;
    i49.stencilRef = p49++, e71.setDepthTestEnabled(false), e71.setDepthWriteEnabled(false), e71.setStencilTestEnabled(true), e71.setBlendingEnabled(false), e71.setColorMask(false, false, false, false), e71.setStencilOp(I4.KEEP, I4.KEEP, I4.REPLACE), e71.setStencilWriteMask(255), e71.setStencilFunction(O6.ALWAYS, i49.stencilRef, 255), this._stencilTileSymbols(e71, t71, i49, l47, n63, r57, a59, o60, d38, c44, h32);
    for (const m45 of s67.toArray()) {
      const {
        sourceLod: t72,
        offset: i50,
        sourceLayerInfo: s68
      } = m45;
      s68.data.stencilRef = p49++, e71.setStencilFunction(O6.ALWAYS, s68.data.stencilRef, 255), this._stencilTileSymbols(e71, t72, s68.data, l47, n63, r57, a59, i50, d38, c44, h32);
    }
    e71.setStencilWriteMask(0), e71.setBlendingEnabled(true), e71.setDepthTestEnabled(true), e71.setColorMask(true, true, true, true);
  }
  _renderSymbols(e71, t71, i49, s67, l47, n63, r57, a59, o60, c44, h32) {
    e71.setStencilFunction(O6.EQUAL, i49.stencilRef, 255), this._render(e71, t71, i49, s67, l47, n63, r57, a59, o60, c44, h32, a15.SYMBOL);
  }
  _render(e71, t71, i49, s67, l47, n63, r57, a59, o60, d38, c44, h32) {
    this._updateRenderParameters(e71, t71, i49, s67, n63, r57, a59, o60, d38, c44), this._renderParams.stencilSymbols = false, s67.drawTile(this._renderParams, i49, l47, h32);
  }
  _stencilTileSymbols(e71, t71, i49, s67, l47, n63, r57, a59, o60, d38, c44) {
    this._updateRenderParameters(e71, t71, i49, s67, n63, r57, a59, o60, d38, c44), this._renderParams.stencilSymbols = true, i49.triangleCount = 0, s67.drawSymbols(this._renderParams, i49, l47);
  }
  _updateRenderParameters(n63, a59, o60, d38, c44, h32, u46, m45, f46, g28) {
    "type" in o60 && "vector-tile" === o60.type && !o60.stage && o60.attachWithContext(n63);
    const y27 = a59[0] - c44.getLevelShift(a59[0]), _30 = this._renderParams;
    _30.context = n63, _30.painter = d38, _30.glyphMosaic = d38.glyphMosaic, _30.spriteMosaic = d38.spriteMosaic, _30.pixelRatio = f46 * g28, _30.displayLevel = y27, _30.requiredLevel = y27;
    const b25 = c44.getScale(a59[0]), [S26, M18] = c44.getOffset(a59, h32 * b25), w24 = p40 * h32 * b25 / m45, R17 = o60.transforms.displayViewScreenMat3;
    R17[0] = w24, R17[4] = -w24, R17[6] = -1 - S26 - u46[0] * h32 * 2, R17[7] = 1 + M18 + (1 - u46[1]) * h32 * 2 - 2;
    const L25 = _30.state, T21 = m45 / g28;
    L25.size[0] = T21, L25.size[1] = T21, L25.pixelRatio = g28, L25.rotation = (360 - this._heading) % 360;
    const P19 = 2 / T21;
    r11(L25.displayViewMat3, P19, 0, 0, 0, -P19, 0, -1, 1, 1);
    const E37 = o10(L25.displayMat3), j21 = u4(this._heading);
    M3(E37, E37, [T21 / 2, T21 / 2]), h6(E37, E37, j21), M3(E37, E37, [-T21 / 2, -T21 / 2]), i6(E37, L25.displayViewMat3, E37);
  }
  updateHeading(e71) {
    this._heading = e71;
  }
  _declutter(e71) {
    this._declutteredForHeading.get(e71) !== this._heading && (y22(e71, (360 - this._heading) % 360), this._declutteredForHeading.set(e71, this._heading));
  }
};
var g22 = class {
  constructor() {
    this.size = [0, 0], this.pixelRatio = 1, this.rotation = 0, this.displayMat3 = e16(), this.displayViewMat3 = e16(), this.transform = null, this.inverseTransform = null, this.viewMat2d = null, this.viewMat3 = null, this.id = 0, this.extent = null, this.center = null, this.scale = 1, this.resolution = 0, this.worldScreenWidth = 0, this.spatialReference = null, this.viewpoint = null, this.getScreenTransform = null, this.toMap = null, this.toScreen = null, this.clone = null, this.copy = null, this.toJSON = null;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/RasterColorizerTechnique.js
var u35 = class _u extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _u.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: s20(R3.ONE, R3.ONE_MINUS_SRC_ALPHA),
      colorWrite: _9
    });
  }
};
u35.shader = new t16(z7, () => import("./RasterColorizer.glsl-37REO6L7.js"));
var d32 = class extends s56 {
  constructor() {
    super(...arguments), this.colorizerType = t38.Stretch, this.stretchType = e35.Noop, this.applyColormap = true, this.requireBilinearWithNN = false;
  }
};
e6([r19({
  count: t38.COUNT
})], d32.prototype, "colorizerType", void 0), e6([r19({
  count: e35.COUNT
})], d32.prototype, "stretchType", void 0), e6([r19()], d32.prototype, "applyColormap", void 0), e6([r19()], d32.prototype, "requireBilinearWithNN", void 0);

// ../../../node_modules/@arcgis/core/views/3d/terrain/support/MultiSizeFramebuffer.js
var o49 = class {
  constructor(e71) {
    this._rctx = e71, this._fbos = /* @__PURE__ */ new Map();
  }
  get(e71) {
    return this._getPool(e71);
  }
  dispose() {
    this._fbos.forEach((e71) => e71.dispose()), this._fbos.clear();
  }
  _getPool(o60) {
    const i49 = this._fbos.get(o60);
    if (i49) return i49;
    const f46 = new E11(this._rctx, new e22(o60), new i9(B3.DEPTH24_STENCIL8, o60));
    return this._fbos.set(o60, f46), f46;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileCompositor.js
var O28 = () => n.getLogger("esri.views.3d.terrain");
var L23 = class {
  constructor(e71, t71) {
    this._rctx = e71, this._techniques = t71, this._fbos = [], this._vectorTileHelper = new f36(), this._bindParameters = new m19(null, null), this._blendLayersTechniqueConfig = new f35(), this._current = 0, this._lastUsedIds = new Array(), this._lastCreatedBufferId = 0, this._onHoldIds = new Array(), this._vaoQuad = i21(this._rctx, m22);
  }
  dispose() {
    this._fbos.forEach(r2), this._fbos = null, this._vtFBO = r2(this._vtFBO), this._vaoQuad = r2(this._vaoQuad), this._vectorTileHelper = r2(this._vectorTileHelper), this._backgroundTechnique = t2(this._backgroundTechnique), this._applyOpacityTechnique = t2(this._applyOpacityTechnique), this._blendLayersTechnique = t2(this._blendLayersTechnique);
  }
  updateHeading(e71) {
    this._vectorTileHelper?.updateHeading(e71);
  }
  _getBlendLayersTechnique(e71, t71, r57, i49 = O13.Off, s67 = l21.BelowLayer) {
    return this._blendLayersTechniqueConfig.output = t71, this._blendLayersTechniqueConfig.blendMode = e71, this._blendLayersTechniqueConfig.baseOpacityMode = r57, this._blendLayersTechniqueConfig.premultipliedSource = i49, this._blendLayersTechniqueConfig.background = s67, this._blendLayersTechnique = this._techniques.releaseAndAcquire(p38, this._blendLayersTechniqueConfig, this._blendLayersTechnique), this._blendLayersTechnique;
  }
  drawBackground(e71, t71) {
    const r57 = this._getBlendLayersTechnique(t39.Normal, t71 ? o35.ColorComposite : o35.GridComposite, e37.NotRequired, O13.Off, l21.Only), i49 = this._rctx.bindTechnique(r57, this._bindParameters, e71);
    this._render(i49);
  }
  _render(e71) {
    this._rctx.bindVAO(this._vaoQuad), e71.assertCompatibleVertexAttributeLocations(this._vaoQuad), this._rctx.drawArrays(E7.TRIANGLE_STRIP, 0, i8(this._vaoQuad, "geometry"));
  }
  drawGroup(e71, t71, r57, i49, s67 = O13.On) {
    t71 === o35.Composite && (e71.fboTexture = this._fbos[this.getLastOnHoldId()].get(r57).colorTexture), e71.texture = this.currentFBO(r57).colorTexture, this.closeGroup(r57);
    const o60 = e71.baseOpacity < 1 ? e37.Required : e37.NotRequired, n63 = this._getBlendLayersTechnique(i49, t71, o60, s67), a59 = this._rctx.bindTechnique(n63, this._bindParameters, e71);
    this._render(a59);
  }
  drawImageData(e71, t71, r57, i49, s67 = O13.Off) {
    if (null == e71.texture) return;
    const o60 = e71.baseOpacity < 1 ? e37.Required : e37.NotRequired;
    e71.fboTexture = t71 === o35.GroupBackgroundComposite || i49 === t39.Normal && o60 === e37.NotRequired && s67 === O13.Off ? null : this.switch(r57).colorTexture;
    const n63 = this._getBlendLayersTechnique(i49, t71, o60, s67), a59 = this._rctx.bindTechnique(n63, this._bindParameters, e71);
    this._render(a59);
  }
  drawRasterData(e71, t71, r57, i49, s67) {
    const o60 = s67.sourceLayerInfo.data;
    if (!o60.source) return;
    if (s67.tile.surface.layerViewByIndex(s67.layerIndex, A24.MAP).ensureSymbolizerParameters(o60), !o60.bind(this._rctx)) return;
    const n63 = e71.baseOpacity < 1 ? e37.Required : e37.NotRequired;
    e71.fboTexture = i49 === t39.Normal && n63 === e37.NotRequired ? null : this.switch(r57).colorTexture;
    const a59 = this._getRasterColorizerTechnique(o60, t71, i49, n63);
    o60.opacity = e71.opacity;
    const h32 = o60.getUniforms();
    h32.scale = s67.scale, h32.offset = s67.offset, h32.backgroundColor = e71.backgroundColor, h32.fboTexture = e71.fboTexture, h32.baseOpacity = e71.baseOpacity;
    const c44 = this._rctx.bindTechnique(a59, null, h32);
    this._render(c44);
  }
  _getRasterColorizerTechnique(e71, t71, r57, i49) {
    const o60 = e71.symbolizerParameters, n63 = ["stretch", "lut", "hillshade"].indexOf(o60.type);
    return null == this._rasterColorizerConfig && (this._rasterColorizerConfig = new d32(), this._rctx.gl.getExtension("WEBGL_color_buffer_float"), this._rctx.gl.getExtension("OES_texture_float")), this._rasterColorizerConfig.output = t71, this._rasterColorizerConfig.blendMode = r57, this._rasterColorizerConfig.baseOpacityMode = i49, this._rasterColorizerConfig.colorizerType = n63, this._rasterColorizerConfig.applyColormap = !!o60.colormap, this._rasterColorizerConfig.requireBilinearWithNN = e71.isBilinearWithStretchColorRamp, this._rasterColorizerConfig.stretchType = e71.hasStretchTypeNone() ? e35.Noop : e35.PerBand, this._rasterColorizerTechnique = this._techniques.releaseAndAcquire(u35, this._rasterColorizerConfig, this._rasterColorizerTechnique), this._rasterColorizerTechnique;
  }
  drawVectorData(e71, t71, r57, s67, o60, n63, a59, h32) {
    const c44 = this._rctx, b25 = o60.sourceLayerInfo.data, g28 = o60.tile.surface.layerViewByIndex(o60.layerIndex, A24.MAP), m45 = e71.baseOpacity < 1 ? e37.Required : e37.NotRequired, T21 = m45 === e37.Required || e71.opacity < 1 || s67 !== t39.Normal || t71 !== o35.Composite, y27 = T21 ? O13.On : O13.Off, C25 = this._getBlendLayersTechnique(s67, t71, m45, y27);
    c44.setPipelineState(C25.getPipeline());
    let B17 = null, q20 = null;
    T21 ? (q20 = this.currentFBO(r57), null == this._vtFBO && (this._vtFBO = new o49(this._rctx)), B17 = this._vtFBO.get(r57), c44.bindFramebuffer(B17), this._clearCurrentFBO()) : h32 && c44.clear(_7.DEPTH_BUFFER_BIT);
    try {
      this._vectorTileHelper.renderBackground(c44, o60.sourceLod, g28.painter, g28.layer.styleRepository, g28.schemaHelper, Math.round(1 / o60.scale), o60.offset, a59, n63, g28.contentZoom), b25 && this._vectorTileHelper.renderContent(c44, o60.sourceLod, b25, o60.vtlNeighborInfos, g28.painter, g28.layer.styleRepository, g28.schemaHelper, Math.round(1 / o60.scale), o60.offset, a59, n63, g28.contentZoom);
    } catch (L25) {
      O28().warnOnce("A render call containing vector tiles did not resolve correctly.", L25);
    }
    return null == B17 || (c44.bindFramebuffer(q20), e71.texture = B17.colorTexture, e71.offset = a11, e71.scale = 1, this.drawImageData(e71, t71, r57, s67, y27), h32);
  }
  copyFBOToTexture(e71) {
    const t71 = this._rctx, r57 = t71.bindTexture(e71.texture, c8.TEXTURE_UNIT_FOR_UPDATES), i49 = e71.descriptor;
    t71.gl.copyTexImage2D(M4.TEXTURE_2D, 0, i49.pixelFormat, 0, 0, i49.width, i49.height, 0), e71.generateMipmap(), t71.bindTexture(r57, c8.TEXTURE_UNIT_FOR_UPDATES);
  }
  _clearCurrentFBO() {
    this._rctx.setStencilWriteMask(255), this._rctx.setClearColor(0, 0, 0, 0), this._rctx.setClearDepth(1), this._rctx.setClearStencil(0), this._rctx.clear(_7.COLOR_BUFFER_BIT | _7.DEPTH_BUFFER_BIT | _7.STENCIL_BUFFER_BIT);
  }
  _initFBO(e71, t71, r57) {
    this._rctx.bindFramebuffer(e71), r57 && (this._rctx.setViewport(0, 0, t71, t71), this._clearCurrentFBO());
  }
  ensureBuffer(e71) {
    this._lastUsedIds.length = 0, this._lastUsedIds.push(1), this._lastCreatedBufferId = 1, this._onHoldIds.length = 0, this.bind(e71);
  }
  bind(e71, t71 = 0, r57 = true) {
    if (this._current = t71, t71 >= this._fbos.length) for (let i49 = this._fbos.length; i49 <= t71; i49++) this._fbos.push(new o49(this._rctx));
    this._initFBO(this._fbos[t71].get(e71), e71, r57);
  }
  _bindNextFreeBuffer(e71) {
    this._lastUsedIds.length > 0 ? this.bind(e71, this._lastUsedIds.pop()) : (this._lastCreatedBufferId++, this.bind(e71, this._lastCreatedBufferId));
  }
  openGroup(e71) {
    this._onHoldIds.push(this._current), this._bindNextFreeBuffer(e71);
  }
  switch(e71) {
    const t71 = this.currentFBO(e71), r57 = this._current;
    return this._bindNextFreeBuffer(e71), this._lastUsedIds.push(r57), t71;
  }
  getLastOnHoldId() {
    return this._onHoldIds[this._onHoldIds.length - 1];
  }
  closeGroup(e71) {
    const t71 = this._current;
    this._bindNextFreeBuffer(e71), this._lastUsedIds.push(t71), this._lastUsedIds.push(this._onHoldIds.pop());
  }
  unbind() {
    this._rctx.bindFramebuffer(null);
  }
  currentFBO(e71) {
    return this._fbos[this._current].get(e71);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileRenderInfo.js
var o50 = class {
  constructor() {
    this.sourceLod = [0, 0, 0], this.offset = [0, 0], this.scale = 1, this.layerIndex = 0, this.isVTLBackground = false, this.vtlNeighborInfos = new l3({
      allocator: (s67) => s67 || new t59()
    });
  }
};
var t59 = class {
  constructor() {
    this.sourceLayerInfo = null, this.sourceLod = [0, 0, 0], this.offset = [-1, 0];
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileTexture.js
var t60 = class {
  constructor(t71, e71) {
    this._texture = t71, this._cache = e71, this.type = "tile-texture", this._refCount = 1;
  }
  retain() {
    ++this._refCount;
  }
  release() {
    if (--this._refCount, 0 === this._refCount) if (this._cache) {
      const t71 = `${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;
      this._cache.put(t71, this);
    } else this.dispose();
  }
  dispose() {
    this._texture.dispose();
  }
  get texture() {
    return this._texture;
  }
  generateMipmap() {
    this._texture.generateMipmap();
  }
  get descriptor() {
    return this._texture.descriptor;
  }
  get usedMemory() {
    return this._texture.usedMemory;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TileRenderer.js
var j17 = class {
  constructor(e71, t71, r57, s67, o60, i49) {
    this.start = e71, this.end = t71, this.blendMode = r57, this.opacity = s67, this.output = o60, this.baseOpacity = i49;
  }
};
var C22 = class {
  constructor(e71, t71, r57, s67) {
    this._rctx = e71, this.tileSize = t71, this._techniques = r57, this._cache = s67, this._passParameters = new b19(), this._backgroundTexture = null, this._backgroundColor = null, this._backgroundDirty = false, this._maxAnisotropy = this._rctx.parameters.maxMaxAnisotropy, this._compositor = new L23(this._rctx, this._techniques), this._ensureBackgroundTexture(this.tileSize);
  }
  dispose() {
    this._compositor = r2(this._compositor), this._backgroundTexture = t2(this._backgroundTexture);
  }
  get backgroundIsGrid() {
    return null == this._backgroundColor;
  }
  get backgroundColor() {
    return this._backgroundColor;
  }
  updateHeading(e71) {
    this._compositor?.updateHeading(e71);
  }
  updateTileTexture(e71, t71) {
    if (!e71.renderData) return;
    const r57 = e71.surface, s67 = r57.baseOpacity;
    let o60 = 0, n63 = 0, l47 = this.tileSize, p49 = false, m45 = false;
    const f46 = r57.view.state.contentPixelRatio;
    let _30 = false;
    q16.clear(), v24.length = 0;
    const T21 = e71.layerInfo[A24.MAP];
    let y27 = 0, b25 = null;
    for (; y27 < T21.length; y27++) {
      const t72 = r57.layerViewByIndex(y27, A24.MAP), u46 = t72.layer.opacity, g29 = t72.fullOpacity;
      if (m45 = m45 || j3(t72.layer), A9(t72)) {
        let e72 = "normal" !== t72.layer.blendMode;
        if (p6(t72.layer.parent)) {
          const r58 = S22(t72.layer.parent);
          null != r58 && "" !== r58 && (e72 = B13(t72.layer.parent) || e72);
        }
        e72 && (_30 = e72, p49 = false);
      }
      if (0 === u46 && !_30) {
        T21[y27].pendingUpdates &= ~(E33.TEXTURE_NOFADING & E33.TEXTURE_FADING);
        continue;
      }
      ++n63;
      const x27 = d11(t72), I25 = N13(e71, y27, x27);
      if (I25) {
        if (T21[y27].pendingUpdates &= ~(E33.TEXTURE_NOFADING & E33.TEXTURE_FADING), p6(t72.layer.parent)) {
          const e72 = S22(t72.layer.parent);
          null != e72 && "" !== e72 && G13(t72.layer.parent, y27);
        }
        x27 ? l47 = Math.max(l47, this.tileSize * f46) : 1 === s67 && 1 === g29 && (t72.isOpaque || this._dataToTexture(I25) && I25.sourceLayerInfo.data.descriptor.isOpaque) && (p49 = true), ++o60, null === b25 && (b25 = y27);
      }
    }
    const g28 = l47 / this.tileSize, x26 = this._ensureBackgroundTexture(this.tileSize);
    0 !== o60 && null !== b25 ? 1 === o60 && !_30 && this._useLayerTexture(e71, b25) || this._composeLayers(e71, t71, y27 - 1, m45, l47, g28, !p49 || _30, q16, _30) : F12(e71, n63, x26, t71 !== H7.FADING);
  }
  _ensureBackgroundTexture(e71) {
    return null == this._backgroundTexture && (this._backgroundTexture = this._buildTexture(e71, false), this._backgroundDirty = true), this._backgroundDirty && (this._compositor.bind(e71), this._passParameters.offset = a11, this._passParameters.scale = 1, this._passParameters.opacity = 1, this.backgroundColor && (this._passParameters.backgroundColor = this.backgroundColor), this._compositor.drawBackground(this._passParameters, null != this.backgroundColor), this._compositor.copyFBOToTexture(this._backgroundTexture), this._compositor.unbind(), this._backgroundDirty = false), this._backgroundTexture;
  }
  _useLayerTexture(e71, t71) {
    const r57 = e71.surface.layerViewByIndex(t71, A24.MAP), s67 = j3(r57.layer), o60 = s67 ? e71.surface.baseOpacity : 1, a59 = s67 ? 1 : e71.surface.baseOpacity, n63 = r57.fullOpacity, l47 = N13(e71, t71, false);
    return !!this._dataToTexture(l47) && (e71.renderData.setTextureReference(new s57(l47.sourceLayerInfo.data, H7.FADING, l47, o60, a59, n63)), true);
  }
  _composeLayers(e71, t71, r57, s67, a59, n63, u46, l47, p49) {
    this._compositor.ensureBuffer(a59);
    const _30 = e71.surface.baseOpacity;
    let T21 = false, y27 = L5.LINEAR_MIPMAP_LINEAR, b25 = false, x26 = 0;
    for (let g28 = r57; g28 >= 0; g28--) {
      const t72 = e71.surface.layerViewByIndex(g28, A24.MAP), r58 = d11(t72), I26 = N13(e71, g28, r58), w25 = t72.layer.opacity;
      if (!I26 || 0 === w25 && !p49) continue;
      const A33 = !j3(t72.layer) && !T21;
      A33 && (T21 = true);
      let O34 = false;
      l47.forEach((e72) => {
        e72.start === g28 && (e72.output = s67 ? o35.Composite : u46 && A33 ? this.backgroundIsGrid ? o35.GridComposite : o35.ColorComposite : o35.Composite, e72.baseOpacity = A33 ? _30 : 1, v24.push(e72), this._compositor.openGroup(a59), O34 = true);
      });
      const D15 = 0 === x26, M18 = O34 ? o35.GroupBackgroundComposite : u46 && D15 ? this.backgroundIsGrid ? o35.GridComposite : o35.ColorComposite : o35.Composite, L25 = e36[A9(t72) ? t72.layer.blendMode : "normal"];
      for (this._passParameters.baseOpacity = A33 && !O34 && _30 < 1 ? _30 : 1, this._passParameters.opacity = w25, w9(I26) ? b25 = this._compositor.drawVectorData(this._passParameters, M18, a59, L25, I26, n63, this.tileSize, b25) : g9(I26) ? (this._compositor.drawRasterData(this._passParameters, M18, a59, L25, I26), U19(I26) && (y27 = L5.NEAREST)) : this._dataToTexture(I26) && (this._passParameters.texture = I26.sourceLayerInfo.data.texture, this._passParameters.offset = I26.offset, this._passParameters.scale = I26.scale, this._compositor.drawImageData(this._passParameters, M18, a59, L25)); v24.length > 0 && v24[v24.length - 1].end === g28; ) {
        const e72 = v24.pop();
        this._passParameters.baseOpacity = e72.baseOpacity, this._passParameters.opacity = e72.opacity, this._passParameters.offset = a11, this._passParameters.scale = 1, this._compositor.drawGroup(this._passParameters, e72.output, a59, e36[e72.blendMode]);
      }
      x26++;
    }
    const I25 = e71.renderData, w24 = p49 || T21 && _30 < 1, A32 = I25.ensureTexture(a59, w24, () => this._buildTexture(a59, w24, y27));
    this._compositor.copyFBOToTexture(A32), this._compositor.unbind(), I25.setTextureReference(new s57(A32, t71, z17, T21 ? 1 : _30, 0, 1));
  }
  _dataToTexture(e71) {
    if (j7(e71)) {
      const t71 = e71.sourceLayerInfo;
      t71.data = this._buildTexture(t71.data, true), e71.tile.setMemoryDirty();
    }
    return C6(e71);
  }
  setBackground(e71) {
    this._backgroundColor !== e71 && (this._backgroundColor = e71, this._backgroundDirty = true);
  }
  _buildTexture(e71, t71, r57 = L5.LINEAR_MIPMAP_LINEAR) {
    if (null == e71) return null;
    const s67 = new e22();
    s67.wrapMode = D2.CLAMP_TO_EDGE, s67.samplingMode = r57, s67.maxAnisotropy = this._maxAnisotropy, s67.preMultiplyAlpha = true, s67.flipped = true, s67.hasMipmap = true, t71 || (s67.pixelFormat = G4.RGB);
    const o60 = this._rctx;
    let i49;
    if ("number" == typeof e71) s67.width = s67.height = e71, i49 = this._buildTileTexture(s67, e71);
    else if (r29(e71)) s67.isOpaque = e71.isOpaque, s67.isOpaque && (s67.pixelFormat = G4.RGB), i49 = this._buildTileTexture(s67, e71.element.width, e71.element);
    else try {
      s67.width = e71.width, s67.height = e71.height, i49 = this._buildTileTexture(s67, e71.width, e71);
    } catch (n63) {
      i49 = new t60(a25(o60)), console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.");
    }
    const a59 = o60.bindTexture(i49.texture, c8.TEXTURE_UNIT_FOR_UPDATES);
    return i49.generateMipmap(), o60.bindTexture(a59, c8.TEXTURE_UNIT_FOR_UPDATES), i49;
  }
  _buildTileTexture(e71, t71, r57) {
    const s67 = `${t71} ${e71.pixelFormat}`, o60 = this._cache.pop(s67);
    return o60 ? (o60.retain(), o60.texture.setData(r57), o60) : new t60(new c8(this._rctx, e71, r57), this._cache);
  }
  get test() {
  }
};
function N13(e71, t71, o60) {
  H20.layerIndex = t71, H20.vtlNeighborInfos.clear();
  const i49 = e71.layerInfo[A24.MAP][t71];
  if (o13(H20.offset, 0, 0), H20.tile = e71, H20.scale = 1, H20.sourceLod = e71.lij, H20.sourceLayerInfo = i49, H20.isVTLBackground = o60, i49.data) return o60 && e71.forEachLoadedNeighbor((r57, s67) => {
    if (r57.level !== e71.level) return;
    const o61 = r57.layerInfo[A24.MAP][t71];
    if (!v7(o61) || i49.data === o61.data) return;
    const a60 = H20.vtlNeighborInfos.pushNew();
    a60.offset = V17[s67], a60.sourceLod = r57.lij, a60.sourceLayerInfo = o61;
  }), H20;
  const a59 = i49.upsampleInfo;
  if (a59) {
    const e72 = a59.tile.layerInfo[A24.MAP][t71];
    return H20.tile = a59.tile, r13(H20.offset, a59.offset), H20.scale = a59.scale, H20.sourceLod = a59.tile.lij, H20.sourceLayerInfo = e72, H20;
  }
  return o60 ? H20 : null;
}
function S22(e71) {
  return e71.uid;
}
function U19(e71) {
  const t71 = e71.sourceLayerInfo.data;
  return !!t71.source && "nearest" === t71.interpolation;
}
function B13(e71) {
  let t71 = "normal" !== e71.blendMode;
  return p6(e71.parent) && (t71 = B13(e71.parent) || t71), t71;
}
function G13(e71, t71) {
  p6(e71.parent) && G13(e71.parent, t71);
  const r57 = S22(e71);
  if (null != r57 && "" !== r57) {
    const s67 = q16.get(r57);
    s67 ? s67.start = t71 : q16.set(r57, new j17(t71, t71, e71.blendMode, e71.opacity, o35.Composite, 1));
  }
}
function F12(e71, t71, r57, s67) {
  const o60 = e71.renderData, i49 = !s67 && null != o60.textureReference && (e71.surface.view.layerViewManager.updating || t71 > 0) ? n49.Delayed : n49.Immediate;
  o60.setTextureReference(new s57(r57, H7.FADING, z17, e71.surface.baseOpacity, 0, 1), i49);
}
var q16 = /* @__PURE__ */ new Map();
var v24 = new Array();
var H20 = new o50();
var z17 = {
  offset: [0, 0],
  scale: 1
};
var V17 = new Array();
V17[T6.NORTH] = [0, -1], V17[T6.NORTH_EAST] = [-1, -1], V17[T6.EAST] = [-1, 0], V17[T6.SOUTH_EAST] = [-1, 1], V17[T6.SOUTH] = [0, 1], V17[T6.SOUTH_WEST] = [1, 1], V17[T6.WEST] = [1, 0], V17[T6.NORTH_WEST] = [1, -1];

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentIntersectionData.js
var s58 = 200;
var o51 = 40;
var a47 = 0.8;
var c39 = 10;
var h26 = 1e-6;
function l40(t71, e71, i49) {
  const n63 = e71, r57 = i49;
  let s67 = 0, o60 = 1 / 0;
  for (let a59 = 0; a59 < 3; ++a59) {
    {
      const e72 = t71[a59];
      if (n63[a59] < e72) {
        if (r57[a59] <= h26) return false;
        const t72 = (e72 - n63[a59]) / r57[a59];
        s67 = Math.max(s67, t72);
      } else if (r57[a59] <= -h26) {
        const t72 = (e72 - n63[a59]) / r57[a59];
        o60 = Math.min(o60, t72);
      }
      if (s67 > o60) return false;
    }
    {
      const e72 = t71[a59 + 3];
      if (n63[a59] > e72) {
        if (r57[a59] >= -h26) return false;
        const t72 = (e72 - n63[a59]) / r57[a59];
        s67 = Math.max(s67, t72);
      } else if (r57[a59] >= h26) {
        const t72 = (e72 - n63[a59]) / r57[a59];
        o60 = Math.min(o60, t72);
      }
      if (s67 > o60) return false;
    }
  }
  return true;
}
var d33 = class {
  constructor(t71, e71, i49, n63, r57) {
    this.aabb = t71, this.axis = e71, this.d = i49, this.midStartIndex = n63, this.rightStartIndex = r57;
  }
};
var f37 = class _f {
  constructor(i49, n63, r57, s67) {
    this.globalTriangleVertexIndices = i49, this.firstTriangleIndex = n63, this.positions = s67, this._rayDirection = n7(), this._callback = R12, this._intersectionOptions = I22, this.bspNodeTree = new Array();
    const h32 = r57 - n63, l47 = new (h32 < N14 ? Uint8Array : h32 < b20 ? Uint16Array : Uint32Array)(h32);
    this.triangleIndexMap = l47;
    for (let t71 = 0; t71 < h32; ++t71) l47[t71] = t71;
    {
      const e71 = p41(i49, n63, r57, s67.data, s67.stride), f46 = e12(Math.log2(h32 / o51), 2, c39), m45 = (t71, i50, n64) => {
        const r58 = x22(l47, e71, t71, i50), s68 = i50 - t71;
        if (s68 <= o51) {
          const e72 = new d33(r58, void 0, 0, t71, i50);
          return this.bspNodeTree.push(e72), e72;
        }
        const {
          axis: c44,
          midValue: h33
        } = y23(r58), u46 = g23(l47, e71, t71, i50, c44, h33), p49 = (t72, e72) => {
          if (n64 > f46) return;
          const i51 = e72 - t72;
          return i51 < o51 || i51 >= a47 * s68 ? void 0 : m45(t72, e72, n64 + 1);
        }, N18 = new d33(r58, c44, h33, u46.next, u46.mid);
        return this.bspNodeTree.push(N18), N18.leftNode = p49(t71, u46.next), N18.rightNode = p49(u46.mid, i50), N18;
      };
      m45(0, h32, 0);
    }
  }
  intersectRayTriangleRange(t71, e71) {
    if (t71 >= e71) return;
    const i49 = this.positions;
    g7(this._rayFrom, this._rayDirection, t71, e71, this.globalTriangleVertexIndices, i49.data, i49.stride, this._intersectionOptions.normalRequired, this._callback, this.triangleIndexMap, this.firstTriangleIndex), _f.numFacesTested += e71 - t71;
  }
  intersectRay(t71, e71, i49, n63) {
    _f.numFacesTested = 0;
    const r57 = t71, s67 = e71, o60 = s67[0] - r57[0], a59 = s67[1] - r57[1], c44 = s67[2] - r57[2];
    if (o60 * o60 + a59 * a59 + c44 * c44 < h26) return;
    this._rayFrom = r57;
    const l47 = this._rayDirection;
    l47[0] = o60, l47[1] = a59, l47[2] = c44;
    const d38 = this.triangleIndexMap.length;
    this._callback = n63, this._intersectionOptions = i49, this.intersectRayBSP(this.bspNodeTree[0], 0, d38), this._callback = R12, this._intersectionOptions = I22;
  }
  intersectRayBSP(t71, e71, i49) {
    const n63 = this._rayFrom, r57 = this._rayDirection;
    if (!l40(t71.aabb, n63, r57)) return;
    const s67 = t71.axis, o60 = t71.d;
    if (n63[s67] < o60 || r57[s67] < 0) {
      const i50 = e71, n64 = t71.midStartIndex;
      if (i50 < n64) {
        const e72 = t71.leftNode;
        void 0 !== e72 ? this.intersectRayBSP(e72, i50, n64) : this.intersectRayTriangleRange(i50, n64);
      }
    }
    if (this.intersectRayTriangleRange(t71.midStartIndex, t71.rightStartIndex), n63[s67] > o60 || r57[s67] > 0) {
      const e72 = t71.rightStartIndex, n64 = i49;
      if (e72 < n64) {
        const i50 = t71.rightNode;
        void 0 !== i50 ? this.intersectRayBSP(i50, e72, n64) : this.intersectRayTriangleRange(e72, n64);
      }
    }
  }
  get estimatedMemoryUsage() {
    return this.triangleIndexMap.byteLength;
  }
};
f37.numFacesTested = 0;
var m34 = [1 / 0, 1 / 0, 1 / 0];
var u36 = [-1 / 0, -1 / 0, -1 / 0];
function g23(t71, e71, i49, n63, r57, s67) {
  let o60 = i49, a59 = n63;
  for (; o60 < a59; ) {
    const i50 = t71[o60];
    e71[6 * i50 + r57 + 3] <= s67 ? ++o60 : (--a59, t71[o60] = t71[a59], t71[a59] = i50);
  }
  let c44 = o60;
  for (a59 = n63; c44 < a59; ) {
    const i50 = t71[a59 - 1];
    e71[6 * i50 + r57] >= s67 ? --a59 : (t71[a59 - 1] = t71[c44], t71[c44] = i50, ++c44);
  }
  return {
    next: o60,
    mid: c44
  };
}
function x22(t71, e71, n63, r57) {
  if (r57 <= n63) return a8(NaN, NaN, NaN, NaN, NaN, NaN);
  {
    const i49 = 6 * t71[n63];
    for (let t72 = 0; t72 < 3; ++t72) m34[t72] = e71[i49 + 0 + t72], u36[t72] = e71[i49 + 3 + t72];
  }
  for (let i49 = n63 + 1; i49 < r57; ++i49) {
    const n64 = 6 * t71[i49];
    for (let t72 = 0; t72 < 3; ++t72) m34[t72] = Math.min(m34[t72], e71[n64 + 0 + t72]), u36[t72] = Math.max(u36[t72], e71[n64 + 3 + t72]);
  }
  return a8(m34[0], m34[1], m34[2], u36[0], u36[1], u36[2]);
}
function y23(t71) {
  const e71 = t71[3] - t71[0], i49 = t71[4] - t71[1], n63 = t71[5] - t71[2], r57 = e71 > i49 ? e71 > n63 ? 0 : i49 > n63 ? 1 : 2 : i49 > n63 ? 1 : n63 > e71 ? 2 : 0;
  return {
    axis: r57,
    midValue: (t71[r57] + t71[r57 + 3]) / 2
  };
}
function p41(t71, e71, i49, n63, r57) {
  const s67 = i49 - e71, o60 = new Float32Array(6 * s67);
  for (let a59 = 0; a59 < s67; ++a59) {
    const i50 = 3 * (a59 + e71), s68 = t71[i50] * r57, c44 = t71[i50 + 1] * r57, h32 = t71[i50 + 2] * r57;
    for (let t72 = 0; t72 < 3; ++t72) {
      const e72 = n63[s68 + t72], i51 = n63[c44 + t72], r58 = n63[h32 + t72];
      o60[6 * a59 + t72] = Math.min(e72, i51, r58), o60[6 * a59 + 3 + t72] = Math.max(e72, i51, r58);
    }
  }
  return o60;
}
var N14 = 255;
var b20 = 65535;
var I22 = new m13();
var R12 = () => {
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration.js
var d34 = class extends t20 {
  constructor() {
    super(...arguments), this.output = o9.Color, this.overlayMode = f17.Disabled, this.tileBlendInput = o37.LayerOnly, this.spherical = false, this.doublePrecisionRequiresObfuscation = false, this.receiveShadows = false, this.hasSlicePlane = false, this.backfaceCullingEnabled = false, this.textureFadingEnabled = false, this.renderOccluded = false, this.hasScreenSpaceReflections = false, this.hasCloudsReflections = false, this.invisible = false, this.opaque = true, this.tileBorders = false, this.visualizeNormals = false, this.screenSizePerspective = false, this.receiveAmbientOcclusion = false, this.pbrMode = c9.Simplified;
  }
};
e6([r19({
  count: o9.COUNT
})], d34.prototype, "output", void 0), e6([r19({
  count: f17.COUNT
})], d34.prototype, "overlayMode", void 0), e6([r19({
  count: o37.COUNT
})], d34.prototype, "tileBlendInput", void 0), e6([r19()], d34.prototype, "spherical", void 0), e6([r19()], d34.prototype, "doublePrecisionRequiresObfuscation", void 0), e6([r19()], d34.prototype, "receiveShadows", void 0), e6([r19()], d34.prototype, "hasSlicePlane", void 0), e6([r19()], d34.prototype, "backfaceCullingEnabled", void 0), e6([r19()], d34.prototype, "textureFadingEnabled", void 0), e6([r19()], d34.prototype, "renderOccluded", void 0), e6([r19()], d34.prototype, "hasScreenSpaceReflections", void 0), e6([r19()], d34.prototype, "hasCloudsReflections", void 0), e6([r19()], d34.prototype, "invisible", void 0), e6([r19()], d34.prototype, "opaque", void 0), e6([r19()], d34.prototype, "tileBorders", void 0), e6([r19()], d34.prototype, "visualizeNormals", void 0), e6([r19()], d34.prototype, "screenSizePerspective", void 0), e6([r19()], d34.prototype, "receiveAmbientOcclusion", void 0), e6([r19({
  count: c9.COUNT
})], d34.prototype, "pbrMode", void 0), e6([r19({
  constValue: a12.Compressed
})], d34.prototype, "normalType", void 0), e6([r19({
  constValue: d7.Compressed
})], d34.prototype, "textureCoordinateType", void 0), e6([r19({
  constValue: false
})], d34.prototype, "highStepCount", void 0), e6([r19({
  constValue: false
})], d34.prototype, "useCustomDTRExponentForWater", void 0), e6([r19({
  constValue: false
})], d34.prototype, "useFillLights", void 0), e6([r19({
  constValue: true
})], d34.prototype, "hasColorTexture", void 0);

// ../../../node_modules/@arcgis/core/views/3d/terrain/TerrainRenderer.js
var oe5 = 7;
var le5 = 10;
var he3 = i3();
var ce6;
!function(e71) {
  e71[e71.Opaque = 0] = "Opaque", e71[e71.Semitransparent = 1] = "Semitransparent", e71[e71.TransparentWithDraped = 2] = "TransparentWithDraped", e71[e71.Empty = 3] = "Empty";
}(ce6 || (ce6 = {}));
var de4 = class extends c18 {
  get _isGlobal() {
    return this._stage.viewingMode === l9.Global;
  }
  get _techniques() {
    return this._context.techniques;
  }
  get _rctx() {
    return this._context.renderContext.rctx;
  }
  constructor(e71, t71, i49, n63, a59) {
    super({}), this._overlayRenderer = e71, this._stage = t71, this._allTiles = i49, this._ellipsoidRadius = n63, this.type = i17.TERRAIN, this.isGround = true, this._tileSize = 256, this._techniqueConfiguration = new d34(), this._passParameters = new _15(), this._drawParameters = new s31(), this._renderDataPool = new e3(G11), this._visiblePatchesByOrigin = /* @__PURE__ */ new Map(), this._allPatchesByOrigin = /* @__PURE__ */ new Map(), this._patchesByOriginDirty = true, this._patchSortingDirty = true, this._tileIterator = new n34(), this._transparencyState = ce6.Opaque, this._castShadows = false, this._inViewshed = false, this._emptyTex = null, this._tileRenderer = null, this._stencilEnabledLayerExtents = new Array(), this._numTilesRendered = 0, this._numTilesCulled = 0, this._numOriginsRendered = 0, this.renderOccludedFlags = h8.Occlude, this.produces = /* @__PURE__ */ new Map([[E12.OPAQUE_TERRAIN, () => this._produces()], [E12.TRANSPARENT_TERRAIN, () => this._produces()], [E12.OCCLUDED_TERRAIN, () => this._produces()]]), this._tileTextureCache = new c19((e72, t72) => a59.newCache(e72, t72), "TileTexture"), this.tileGeometryCache = new t58(a59);
  }
  normalizeCtorArgs() {
    return {};
  }
  initialize() {
    this._stage.addRenderPlugin(this), this.addHandles(d2(() => this._overlayRenderer.rendersOccludedDraped, (e71) => {
      this.renderOccludedFlags = e71 ? se : h8.Occlude, this.setNeedsRender();
    }, C));
  }
  destroy() {
    this._stage.removeRenderPlugin(this), this._tileTextureCache.destroy(), this.tileGeometryCache.destroy();
  }
  _produces() {
    return this.visible && !!this._rootTiles && !this.renderingDisabled;
  }
  consumes() {
    return this._overlayRenderer.hasWater ? n31 : t34;
  }
  set renderingDisabled(e71) {
    this._set("renderingDisabled", !!e71), this.setDirty();
  }
  set visible(e71) {
    this._set("visible", !!e71), this.setDirty();
  }
  updateHeading(e71) {
    this._tileRenderer?.updateHeading(e71);
  }
  set transparency(e71) {
    this._transparencyState !== e71 && (this._techniqueConfiguration.invisible = e71 === ce6.TransparentWithDraped || e71 === ce6.Empty, this._techniqueConfiguration.opaque = e71 === ce6.Opaque, this._transparencyState = e71, this.setNeedsRender());
  }
  get transparency() {
    return this._transparencyState;
  }
  get renderPatchBorders() {
    return !!this._techniqueConfiguration.tileBorders;
  }
  set renderPatchBorders(e71) {
    this._techniqueConfiguration.tileBorders !== e71 && (this._techniqueConfiguration.tileBorders = e71, this.setNeedsRender(), this.notifyChange("renderPatchBorders"));
  }
  get visualizeNormals() {
    return !!this._techniqueConfiguration.visualizeNormals;
  }
  set visualizeNormals(e71) {
    this._techniqueConfiguration.visualizeNormals !== e71 && (this._techniqueConfiguration.visualizeNormals = e71, this.setNeedsRender(), this.notifyChange("visualizeNormals"));
  }
  get cullBackFaces() {
    return this._techniqueConfiguration.backfaceCullingEnabled;
  }
  set cullBackFaces(e71) {
    this._techniqueConfiguration.backfaceCullingEnabled !== e71 && (this._techniqueConfiguration.backfaceCullingEnabled = e71, this.notifyChange("cullBackFaces"), this.setNeedsRender());
  }
  set renderOrder(e71) {
    this._set("renderOrder", e71), this._setSortingDirty();
  }
  get layerUid() {
    return w6;
  }
  get slicePlaneEnabled() {
    return this._techniqueConfiguration.hasSlicePlane;
  }
  set slicePlaneEnabled(e71) {
    this._techniqueConfiguration.hasSlicePlane !== e71 && (this._techniqueConfiguration.hasSlicePlane = e71, this.setNeedsRender());
  }
  set textureFadingEnabled(e71) {
    this._techniqueConfiguration.textureFadingEnabled !== e71 && (this._techniqueConfiguration.textureFadingEnabled = e71, this.setNeedsRender());
  }
  set pbrMode(e71) {
    this._techniqueConfiguration.pbrMode !== e71 && (this._techniqueConfiguration.pbrMode = e71, this.setNeedsRender());
  }
  setDebugScreenSizePerspective(e71) {
    this._techniqueConfiguration.screenSizePerspective !== e71 && (this._techniqueConfiguration.screenSizePerspective = e71, this.setNeedsRender());
  }
  setRootTiles(e71) {
    this._rootTiles = e71, this.setDirty();
  }
  setStencilEnabledLayerExtents(e71) {
    this._stencilEnabledLayerExtents = e71, this._setSortingDirty();
  }
  setTileSize(e71) {
    this._tileSize = e71, null != this._tileRenderer && (this._tileRenderer.tileSize = e71), this.setDirty();
  }
  _prepareTileForLoading(e71) {
    e71.renderData || (e71.renderData = this._renderDataPool.acquire(), e71.renderData.init(e71, this._getLocalOriginOfTile(e71)));
  }
  loadTile(e71) {
    this._prepareTileForLoading(e71), this.updateTileGeometryState(e71), this.updateTileTexture(e71, E33.TEXTURE_FADING);
  }
  updateTileTexture(e71, t71) {
    null != this._tileRenderer && (this._tileRenderer.updateTileTexture(e71, t71 === E33.TEXTURE_FADING ? H7.FADING : H7.UNFADED), this.setNeedsRender(), e71.resetPendingUpdate(t71));
  }
  updateTileGeometryState(e71) {
    for (const i49 of e71.layerInfo[A24.ELEVATION]) i49.pendingUpdates &= ~E33.GEOMETRY;
    e71.resetPendingUpdate(E33.GEOMETRY);
    const t71 = e71.renderData.updateGeometryState();
    return t71 && this.setDirty(), t71;
  }
  updateGeometryIfNeeded(e71) {
    e71.isLoaded && e71.renderData.updateGeometryIfNeeded(this._rctx);
  }
  unloadTile(e71) {
    const t71 = e71.renderData;
    t71 && (t71.releaseGeometry(), this._renderDataPool.release(t71), t71.clear(), e71.renderData = null, e71.setMemoryDirty(), this.setDirty());
  }
  _getLocalOriginOfTile(e71) {
    const t71 = le5 - oe5, i49 = Math.max(0, Math.floor((e71.level - t71) / oe5) * oe5);
    if (this._isGlobal && 0 === i49) return l5;
    for (; e71.parent && e71.level > i49; ) e71 = e71.parent;
    return e71.centerAtSeaLevel;
  }
  getStats() {
    return {
      numTilesRendered: this._numTilesRendered,
      numTilesCulled: this._numTilesCulled,
      numOriginsRendered: this._numOriginsRendered
    };
  }
  set wireframe(e71) {
    this._get("wireframe") !== e71 && (this._set("wireframe", e71), this.setNeedsRender());
  }
  setDirty(e71 = O7.UPDATE) {
    this._patchesByOriginDirty = true, this._context.requestRender(e71);
  }
  _setSortingDirty(e71 = O7.UPDATE) {
    this._patchSortingDirty = true, this._context.requestRender(e71);
  }
  setNeedsRender(e71 = O7.UPDATE) {
    this._context.requestRender(e71);
  }
  initializeRenderContext(e71) {
    this._context = e71, this._tileRenderer = new C22(this._rctx, this._tileSize, this._techniques, this._tileTextureCache), this.updateTileBackground(), this._emptyTex = a25(this._rctx);
  }
  uninitializeRenderContext() {
    this._emptyTex = r2(this._emptyTex), this._tileRenderer = r2(this._tileRenderer);
  }
  intersect(e71, t71, i49, r57) {
    if (!this._rootTiles || e71.options.selectOpaqueTerrainOnly && e71.options.selectionMode && this.transparency !== ce6.Opaque) return;
    const s67 = ue4, n63 = pe4;
    e11(s67, r57, i49), o4(n63, 1 / s67[0], 1 / s67[1], 1 / s67[2]);
    const a59 = e71.results.min, o60 = e71.results.max, l47 = e71.results.ground, p49 = e71.options.store === e30.MIN, _30 = !!e71.results.ground.target, f46 = I5(e71.verticalOffset), g28 = e71.tolerance;
    let m45, T21 = p49 && null != a59.dist ? a59.dist : 1 / 0;
    const O34 = e71.options, C25 = O34.normalRequired || !O34.backfacesTerrain, R17 = new m13(false, C25), x26 = (d38) => {
      const _31 = d38.renderData;
      if (!_31?.vao) return;
      const x27 = _31.geometry;
      O3(he3, x27.boundingBox);
      const v29 = _31.localOrigin;
      null != f46 && (f46.localOrigin = v29, f46.applyToAabb(he3));
      const P19 = he3;
      if (_e3[0] = i49[0] - v29[0], _e3[1] = i49[1] - v29[1], _e3[2] = i49[2] - v29[2], !w5(P19, _e3, n63, g28, T21)) return;
      const w24 = (e72, t72, i50) => {
        e72.set(this.type, d38, t72, i50, o8), T21 = p49 && null != a59.dist ? a59.dist : 1 / 0;
      }, S26 = (n64, h32, c44) => {
        if ((!C25 || null != c44) && n64 >= 0 && (O34.backfacesTerrain || P3(c44, s67) < 0) && (O34.invisibleTerrain || !O34.selectionMode || null == t71 || t71(i49, r57, n64))) {
          if ((null == l47.dist || n64 < l47.dist) && w24(l47, n64, c44), O34.isFiltered) return;
          O34.store === e30.ALL && (null == m45 ? (m45 = G6(e71.ray), w24(m45, n64, c44), e71.results.all.push(m45)) : n64 < m45.dist && w24(m45, n64, c44)), (null == a59.dist || n64 < a59.dist) && w24(a59, n64, c44), O34.store !== e30.MIN && (null == o60.dist || n64 > o60.dist) && w24(o60, n64, c44);
        }
      }, D15 = fe3;
      e11(D15, r57, v29);
      const {
        indices: q20,
        indexCount: E37
      } = x27, A32 = x27.vertexAttributes, N18 = A32.getField(e18.POSITION, i7), I25 = new s13(N18.typedBuffer, 3, A32.stride / 4), F18 = E37 / 3;
      if (!f46 && F18 > s58) {
        const e72 = d38.renderData;
        null == e72.intersectionData && (e72.intersectionData = new f37(q20, 0, F18, I25)), e72.intersectionData.intersectRay(_e3, D15, R17, S26);
      } else x6(_e3, D15, 0, F18, q20, I25, f46, R17, S26);
    }, v28 = this._rootTiles;
    if (null != v28) {
      (() => {
        const t72 = this._tileIterator;
        t72.reset(v28);
        const r58 = e71.options.invisibleTerrain;
        for (let e72 = t72.next(); e72; e72 = t72.next()) !(e72.visible || r58 && e72.intersectsClippingArea) || null == f46 && !e72.intersectsRay(i49, s67, g28, T21) || _30 && this._useStencilForTile(e72) ? t72.skipSubtree() : x26(e72);
      })();
    }
  }
  processScaleRangeQueries(e71, t71) {
    if (!t71.done) for (this._updatePatchGroups(); e71.updating && !t71.done; ) {
      e71.prepare();
      for (const t72 of this._visiblePatchesByOrigin.values()) for (const i49 of t72) null != i49.renderData?.textureReference && e71.queriesForTile(i49);
      e71.process(), t71.madeProgress();
    }
  }
  prepareTechnique(e71) {
    const t71 = has("enable-feature:terrain-shadows") && e71.bindParameters.shadowMap.enabled;
    t71 !== this._castShadows && (this._castShadows = t71, this._patchesByOriginDirty = true);
    const i49 = e71.bindParameters.viewshedEnabled;
    if (this._inViewshed !== i49 && (this._inViewshed = i49, this._patchesByOriginDirty = true), e71.bindParameters.slot === E12.OCCLUDED_TERRAIN) {
      if (!(e71.renderOccludedMask & se)) return null;
    } else {
      const t72 = this.transparency === ce6.Opaque ? E12.OPAQUE_TERRAIN : E12.TRANSPARENT_TERRAIN;
      if (e71.bindParameters.slot !== t72) return null;
    }
    if (this.transparency === ce6.Empty) return null;
    switch (e71.output) {
      case o9.Color:
        return this._techniqueConfiguration.hasScreenSpaceReflections = null != e71.bindParameters.ssr.lastFrameColor, this._techniqueConfiguration.hasCloudsReflections = null != e71.bindParameters.cloudsFade.data, this._techniqueConfiguration.receiveShadows = e71.bindParameters.shadowMap.ready, this._techniqueConfiguration.receiveAmbientOcclusion = null != e71.bindParameters.ssao, this._techniqueConfiguration.overlayMode = this._overlayRenderer.mode, this._updateTechnique(o9.Color, e71.bindParameters.slot === E12.OCCLUDED_TERRAIN);
      case o9.Shadow:
      case o9.ShadowExcludeHighlight:
        return this._castShadows ? (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o9.Shadow, false)) : null;
      case o9.ViewshedShadow:
        return this._inViewshed ? (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o9.ViewshedShadow, false)) : null;
      case o9.Depth:
        return this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o9.Depth, false);
      case o9.Normal:
        return this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o9.Normal, false);
      case o9.ObjectAndLayerIdColor:
        return this._updateTechnique(o9.ObjectAndLayerIdColor, false);
      case o9.Highlight:
        return this._overlayRenderer.hasHighlights ? (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o9.Highlight, false)) : null;
    }
    return null;
  }
  renderNode(e71, t71) {
    switch (this._updatePatchGroups(), t71.useStencil = false, e71.output) {
      case o9.Color: {
        const i49 = e71.bindParameters.slot === E12.OCCLUDED_TERRAIN ? o27.Occluded : o27.Color;
        this._renderMaterialPass(e71, t71, i49);
        break;
      }
      case o9.Depth:
      case o9.Normal:
        this._renderAuxiliaryPass(e71, t71, o27.Color, this._visiblePatchesByOrigin);
        break;
      case o9.Highlight:
        this._renderAuxiliaryPass(e71, t71, o27.Highlight, this._visiblePatchesByOrigin);
        break;
      case o9.Shadow:
      case o9.ShadowExcludeHighlight:
      case o9.ViewshedShadow:
        this._renderAuxiliaryPass(e71, t71, null, this._allPatchesByOrigin);
        break;
      case o9.ObjectAndLayerIdColor:
        this._renderAuxiliaryPass(e71, t71, o27.ObjectAndLayerIdColor, this._visiblePatchesByOrigin);
    }
  }
  updateTileBackground(e71) {
    if (null == this._tileRenderer) return;
    const i49 = this._tileRenderer;
    let r57;
    if (null != e71) {
      const i50 = u7.toUnitRGBA(e71);
      r57 = r4(i50[0] || 0, i50[1] || 0, i50[2] || 0);
    }
    i49.setBackground(r57), this._allTiles.forAll((e72) => i49.updateTileTexture(e72, H7.FADING)), this._techniqueConfiguration.tileBlendInput = i49.backgroundIsGrid ? o37.GridComposite : null != i49.backgroundColor ? o37.ColorComposite : o37.LayerOnly, this.setNeedsRender();
  }
  _updatePatchGroups() {
    if (this._patchesByOriginDirty && (this._rebuildPatchGroups(), this._patchesByOriginDirty = false, this._patchSortingDirty = true), this._patchSortingDirty && this.renderOrder !== O12.NONE) {
      const e71 = Array.from(this._visiblePatchesByOrigin.values()), t71 = this._stencilEnabledLayerExtents;
      for (const i49 of e71) l20(this.renderOrder, i49, t71);
      e71.sort((e72, t72) => h12(e72[0], t72[0], this.renderOrder)), this._visiblePatchesByOrigin = new Map(e71.map((e72) => [e72[0].renderData.localOrigin, e72])), this._patchSortingDirty = false;
    }
  }
  _rebuildPatchGroups() {
    const e71 = this._rootTiles;
    if (null != e71) {
      e71[0]?.surface.checkAllTilesWaterproofness(), this._visiblePatchesByOrigin.clear(), this._allPatchesByOrigin.clear();
      for (const t71 of e71) this._rebuildPatchGroupsForRootTile(t71);
    }
  }
  _rebuildPatchGroupsForRootTile(e71) {
    const t71 = this._tileIterator;
    for (t71.resetOne(e71); !t71.done; ) {
      const e72 = t71.next(), i49 = e72.renderData;
      if (!i49) {
        this._numTilesCulled++;
        continue;
      }
      const r57 = i49.localOrigin;
      if (this._castShadows || this._inViewshed) {
        let t72 = this._allPatchesByOrigin.get(r57);
        t72 || (t72 = [], this._allPatchesByOrigin.set(r57, t72)), t72.push(e72);
      }
      if (!e72.visible) {
        this._numTilesCulled++, t71.skipSubtree();
        continue;
      }
      let s67 = this._visiblePatchesByOrigin.get(r57);
      s67 || (s67 = [], this._visiblePatchesByOrigin.set(r57, s67)), s67.push(e72), t71.skipSubtree();
    }
  }
  _useStencilForTile(e71) {
    for (const t71 of this._stencilEnabledLayerExtents) if (e71.intersectsExtent(t71)) return true;
    return false;
  }
  _renderAuxiliaryPass(e71, t71, i49, r57) {
    const s67 = e71.rctx;
    this._passParameters.overlayContent = i49, s67.bindTechnique(t71, e71.bindParameters, this._passParameters);
    const n63 = this._stencilEnabledLayerExtents.length > 0;
    r57.forEach((r58) => {
      this._drawParameters.origin = r58[0].renderData.localOrigin, t71.program.bindDraw(this._drawParameters, e71.bindParameters, this._passParameters);
      for (let s68 = 0; s68 < r58.length; s68++) this._renderPatch(e71, t71, r58[s68], E7.TRIANGLES, n63, i49);
    }), e71.rctx.bindVAO(null);
  }
  _renderMaterialPass(e71, t71, i49) {
    const {
      rctx: r57
    } = e71;
    this._passParameters.overlayContent = i49, r57.bindTechnique(t71, e71.bindParameters, this._passParameters), this._numTilesRendered = 0, this._numTilesCulled = 0, this._numOriginsRendered = 0;
    const s67 = e71.bindParameters.camera, n63 = t71.program;
    if (this._techniqueConfiguration.screenSizePerspective && this.pointsOfInterest) {
      const e72 = n21(this._stage.viewingMode, this._ellipsoidRadius), t72 = this.pointsOfInterest.centerOnSurfaceFrequent.distance;
      e72.update({
        distance: t72,
        fovY: s67.fovY
      });
    }
    const a59 = this._stencilEnabledLayerExtents.length > 0, o60 = i49 === o27.Occluded;
    o60 && (n63.bindTexture("tex", this._emptyTex), n63.setUniform3fv("textureOpacities", l5), n63.setUniform4fv("texOffsetAndScale", _4));
    const l47 = null != this._tileRenderer?.backgroundColor ? this._tileRenderer.backgroundColor : l5;
    this._techniqueConfiguration.tileBlendInput === o37.ColorComposite && n63.setUniform3fv("backgroundColor", l47);
    const h32 = this.wireframe ? E7.LINES : E7.TRIANGLES;
    this._techniqueConfiguration.textureFadingEnabled && n63.bindTexture("texNext", this._emptyTex);
    const c44 = this._visiblePatchesByOrigin;
    for (const d38 of c44.values()) {
      const r58 = d38[0].renderData.localOrigin;
      t71.program.bindDraw(new s31(r58), e71.bindParameters, this._passParameters), this._numOriginsRendered++;
      for (const s68 of d38) {
        const r59 = s68.renderData, l48 = r59.textureReference;
        if (null != l48) {
          if (!o60) {
            n63.setUniform4fv("texOffsetAndScale", l48.offsetAndScale), n63.bindTexture("tex", l48.texture.texture);
            const e72 = r59.textureFadeFactor, t72 = e72 < 1 ? r59.nextTextureReference : null;
            this._techniqueConfiguration.textureFadingEnabled && null != t72 && e72 < 1 ? (n63.setUniform1f("fadeFactor", e72), n63.setUniform4fv("nextTexOffsetAndScale", t72.offsetAndScale), n63.setUniform3fv("nextTexOpacities", t72.opacities), n63.bindTexture("texNext", t72.texture.texture)) : n63.setUniform1f("fadeFactor", 1), r59.textureIsFading && this.setNeedsRender(), n63.setUniform3fv("textureOpacities", l48.opacities);
          }
          this._renderPatch(e71, t71, s68, h32, a59, i49), s68.renderOrder = this._numTilesRendered, this._numTilesRendered++;
        }
      }
    }
    e71.rctx.bindVAO(null);
  }
  _renderPatch(e71, t71, i49, r57, s67, n63) {
    const a59 = i49.renderData, o60 = a59.vao, l47 = o60?.indexBuffer;
    if (!o60 || null == l47) return void (E16 && console.error("Rendered tile with no indices: ", i49.lij, " : ", a59));
    const h32 = t71.program;
    null == n63 || this._overlayRenderer.isEmpty || this._bindOverlayPatchData(h32, a59.overlay), s67 && (t71.useStencil = this._useStencilForTile(i49), e71.rctx.setPipelineState(t71.getPipeline()));
    const c44 = a59.geometry.indexCount;
    e71.rctx.bindVAO(o60), h32.assertCompatibleVertexAttributeLocations(o60), e71.rctx.drawElements(r57, c44, l47.indexType, 0);
  }
  _bindOverlayPatchData(e71, t71) {
    e71.setUniform4fv("overlayTexOffset", t71.offsets), e71.setUniform4fv("overlayTexScale", t71.scales);
  }
  _updateTechnique(e71, t71) {
    return this._techniqueConfiguration.output = e71, this._techniqueConfiguration.renderOccluded = t71, this._shaderTechnique = this._techniques.releaseAndAcquire(b16, this._techniqueConfiguration, this._shaderTechnique), this._shaderTechnique;
  }
  get test() {
  }
};
e6([y2({
  readOnly: true
})], de4.prototype, "_isGlobal", null), e6([y2()], de4.prototype, "renderOccludedFlags", void 0), e6([y2({
  value: false
})], de4.prototype, "renderingDisabled", null), e6([y2({
  value: true
})], de4.prototype, "visible", null), e6([y2()], de4.prototype, "renderPatchBorders", null), e6([y2()], de4.prototype, "visualizeNormals", null), e6([y2()], de4.prototype, "cullBackFaces", null), e6([y2({
  value: O12.FRONT_TO_BACK
})], de4.prototype, "renderOrder", null), e6([y2()], de4.prototype, "wireframe", null), de4 = e6([a4("esri.views.3d.terrain.TerrainRenderer")], de4);
var ue4 = n7();
var pe4 = n7();
var _e3 = n7();
var fe3 = n7();

// ../../../node_modules/@arcgis/core/views/3d/terrain/TerrainSurfacePerformanceInfo.js
var e58 = class {
  constructor() {
    this.numNodes = 0, this.numLeaves = 0, this.numVisible = 0, this.numRendered = 0, this.numSplit = 0, this.numMerged = 0, this.numRenderedPerLevel = new Array(), this.numLoadedPerLevel = new Array();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TilingSchemeLogic.js
var m35 = class extends S3 {
  constructor(e71) {
    super(e71);
  }
  initialize() {
    this.addHandles([this.layers.on("change", () => this._update()), d2(() => this.extentHelper.layerViewsExtent, () => this._setAdHocTilingScheme())]), this._update(), this.tilingSchemeLocked || this._setAdHocTilingScheme();
  }
  destroy() {
    this._waitTask = null, this.layers.destroy();
  }
  _update() {
    if (this._waitTask = null, this.tilingSchemeLocked) return;
    let e71;
    if (this.layers.some((t71) => !(!y4(t71) || t71.isRejected()) && !(t71.isFulfilled() && !u37(t71, this.viewSpatialReference, this.viewingMode)) && (e71 = t71, !("vector-tile" === t71?.type || _12(t71)))), e71) if (e71.isResolved()) {
      const t71 = k5(e71, this.viewSpatialReference, this.viewingMode);
      if (null != t71) {
        const e72 = new f15(t71.tileInfo);
        this._lockTilingScheme(e72);
      }
    } else this._updateWhen(e71);
  }
  _updateWhen(e71) {
    const t71 = e71.when().catch(() => {
    }).then(() => {
      t71 !== this._waitTask || this.destroyed || this._update();
    });
    this._waitTask = t71;
  }
  _lockTilingScheme(e71) {
    if (this.viewingMode === l9.Global) {
      const t71 = e71.levels.length - 1, i49 = e71.spatialReference;
      i49.isWebMercator ? e71 = f15.makeWebMercatorAuxiliarySphere(t71) : i19(i49) && (e71 = f15.makeGCSWithTileSize(e71.spatialReference, e71.pixelSize, t71));
    }
    this.tilingSchemeLocked = true, this.tilingScheme = e71, this.extentHelper.tilingScheme = this.tilingScheme, this._updateTiledLayerExtent(), this.removeAllHandles(), this.addHandles(d2(() => this.extentHelper.tiledLayersExtent, () => this._updateTiledLayerExtent()));
  }
  _updateTiledLayerExtent() {
    this._set("extent", this.extentHelper.tiledLayersExtent);
  }
  _setAdHocTilingScheme() {
    if (this.viewingMode === l9.Global) {
      const e71 = this.extentHelper.viewSpatialReference;
      e71.isWebMercator ? this.tilingScheme = f15.WebMercatorAuxiliarySphere : o26(e71) && (this.tilingScheme = f15.makeGCSWithTileSize(e71, 256)), this._set("extent", this.extentHelper.layerViewsExtent);
    } else {
      const e71 = this.extentHelper.layerViewsExtent;
      null == e71 || I(e71, this.extent) || (this.tilingScheme = f15.fromExtent(e71, this.extentHelper.viewSpatialReference), this._set("extent", e71));
    }
  }
  get test() {
  }
};
function u37(e71, t71, i49) {
  return null != k5(e71, t71, i49);
}
e6([y2()], m35.prototype, "tilingScheme", void 0), e6([y2({
  readOnly: true
})], m35.prototype, "extent", void 0), e6([y2({
  value: false
})], m35.prototype, "tilingSchemeLocked", void 0), e6([y2({
  constructOnly: true
})], m35.prototype, "viewSpatialReference", void 0), e6([y2({
  constructOnly: true
})], m35.prototype, "layers", void 0), e6([y2({
  constructOnly: true
})], m35.prototype, "extentHelper", void 0), e6([y2({
  constructOnly: true
})], m35.prototype, "viewingMode", void 0), m35 = e6([a4("esri.views.3d.terrain.TilingSchemeLogic")], m35);

// ../../../node_modules/@arcgis/core/views/3d/terrain/UpsampleInfo.js
var t61 = class {
  constructor() {
    this.offset = n13(), this.scale = 0, this.tile = null;
  }
  init(s67, t71, i49, e71) {
    this.tile = s67, this.offset[0] = t71, this.offset[1] = i49, this.scale = e71;
  }
  dispose() {
    this.tile = null, this.offset[0] = 0, this.offset[1] = 0, this.scale = 0;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/terrain/TerrainSurface.js
var at5;
var nt4 = at5 = class extends o3.EventedMixin(S3) {
  constructor(e71) {
    super(e71), this._scaleRangeQueries = new a46(), this._iteratorPool = new e3(n34, (e72) => e72.remove = () => this._iteratorPool.release(e72)), this._postorderIterator = new r34(), this._hasPendingUpdates = false, this._pendingUpdates = 0, this._asyncWorkItems = 0, this._allTilesDirty = true, this._allTilesSorted = true, this._usedMemory = null, this._performanceInfo = new e58(), this._viewChanged = false, this.heading = 0, this._inFrameTask = false, this._viewChangeUpdateDirty = false, this._eyePosRenderSR = n7(), this._eyePosSurfaceSR = n7(), this._splitLimits = new e57(), this._frustum = H3(), this._viewProjectionMatrix = e15(), this._layerViews = [new Array(), new Array()], this._layerIndexByUid = [/* @__PURE__ */ new Map(), /* @__PURE__ */ new Map()], this._basemapLayerViewHandles = /* @__PURE__ */ new Map(), this._watchUpdatingTracking = new h7(), this._frameTask = F2, this._allTiles = new l3(), this._upsampleInfoPool = new e3(t61), this._shouldEmitChangeEvent = false, this._rootTilesExtent = u6(), this.updatingProgress = 0.5, this._maxNumUpdating = 1, this.maxTextureScale = 1.2, this._spatialReference = f2.WebMercator, this._elevationProjectorCache = /* @__PURE__ */ new Map(), this.visibleElevationBounds = new s53(1 / 0, -1 / 0), this.rootTileElevationBounds = new s53(1 / 0, -1 / 0), this._sebProjectorMap = /* @__PURE__ */ new Map(), this._sebProjectorCache = Cn(), this._tilingSchemeSpatialReference = null, this._updatingRootTiles = false, this._pendingTilesForElevationUpdateEvent = /* @__PURE__ */ new Set(), this._pendingTilesToUpdate = /* @__PURE__ */ new Set(), this.totalGeometryUpdates = 0, this.totalTileUpdates = 0, this._oneBatchPerFrameTask = true, this._layerViewsDirty = false, this.unloadedMemory = 0, this.ignoresMemoryFactor = false, this._isWebMercator = false, this._isWebMercatorOnPlateCarree = false, this.overlayManager = new ne3(__spreadProps(__spreadValues({}, e71), {
      surface: this
    })), this._isGlobal = !e71.view?.state?.isLocal, this._isGeographic = this._spatialReference?.isGeographic ?? false, this._tileConstructor = this._isGlobal ? y21 : _24;
  }
  initialize() {
    const e71 = this.view, t71 = e71.resourceController, i49 = t71.memoryController;
    this._tileCache = new c19((e72, t72) => i49.newCache(e72, t72), "terrain-tile"), this._upsampleMapCache = i49.newCache("terrain-upsample", (e72) => e72.unloadMapData()), this._elevationQueryCache = new t44(i49.newCache("elevation-query"));
    const r57 = this.overlayManager;
    this._renderer = new de4(r57.renderer, e71._stage, this._allTiles, s6(e71.spatialReference).radius, i49), this.addHandles([d2(() => r57.renderer.isEmpty, () => this._evaluateTransparency()), d2(() => this.renderer.visible, (e72) => this.suspended = !e72), d2(() => this.heading, (e72) => {
      this._renderer.updateHeading(e72), this._updateTileTextures(H7.FADING);
    }), d2(() => ({
      heading: e71.camera?.heading,
      state: e71.state?.mode
    }), ({
      heading: e72,
      state: t72
    }) => {
      if (null == e72) return;
      if (this.isGlobal && this.isGeographic || this.isWebMercatorOnPlateCarree) return void (this.heading = 90 * Math.round(e72 / 90) % 360);
      const i50 = Math.round(e72) % 360, r58 = Math.abs(i50 - this.heading);
      (t72 === I2.IDLE || Math.min(r58, 360 - r58) >= 30) && (this.heading = i50);
    })], "overlayManager"), this.addHandles([d2(() => this.baseOpacity, () => {
      this._handleLayerViewChanges(), this._updateTileTextures(this._evaluateTransparency() ? H7.UNFADED : H7.IMMEDIATE);
    }, A3), d2(() => this.hasCompositeBlendMode, () => this._updateTileTextures(this._evaluateTransparency() ? H7.UNFADED : H7.IMMEDIATE), A3), d2(() => this.backgroundColor, (e72, t72) => {
      e72?.equals(t72) || (this._handleLayerViewChanges(), this._renderer.updateTileBackground(e72));
    }, C), d2(() => this.snapLevel, () => this._viewChanged = true, C), d2(() => this.view.pointsOfInterest, (e72) => {
      this._renderer.pointsOfInterest = e72, this._watchUpdatingTracking.removeAll(), e72 && this._watchUpdatingTracking.add(() => e72.focus.renderLocation, () => this._allTilesSorted = false);
    }), d2(() => t19.TERRAIN_TILE_TREE_SHOW_TILES, (t72) => {
      t72 && !this._treeDebugger ? import("./TerrainTileTree3DDebugger-HWAVT6NO.js").then(({
        TerrainTileTree3DDebugger: t73
      }) => {
        !this._treeDebugger && t19.TERRAIN_TILE_TREE_SHOW_TILES && (this._treeDebugger = new t73({
          view: e71
        }));
      }) : t72 || (this._treeDebugger = u(this._treeDebugger));
    }, P)]);
    const {
      spatialReference: a59
    } = e71;
    this._extentHelper = h25(this.viewingMode, {
      layers: e71.map.allLayers,
      layerViews: e71.allLayerViews,
      viewSpatialReference: a59
    });
    const n63 = new l7({
      getCollections: () => e71.defaultsFromMap?.mapCollections?.map(({
        layers: e72
      }) => e72),
      getChildrenFunction: (e72) => e72 && "layers" in e72 ? e72.layers : null
    }), l47 = new m35({
      layers: n63,
      extentHelper: this._extentHelper,
      viewingMode: this.viewingMode,
      viewSpatialReference: a59
    });
    this._set("tilingSchemeLogic", l47), this._updateTilingScheme(), this._elevationDataRequester = t71.createStreamDataRequester(A11.ELEVATION), this._mapDataRequester = t71.createStreamDataRequester(A11.BASEMAP);
    const d38 = t71.scheduler;
    this._frameTask = d38.registerTask(I3.TERRAIN_SURFACE, this), this.addHandles([d2(() => this._extentHelper.stencilEnabledExtents, (e72) => this._renderer.setStencilEnabledLayerExtents(e72), P), d2(() => this.tilingSchemeLogic.tilingScheme, () => this._updateTilingScheme(), C), d2(() => this.extent, () => this._updateRootTiles(), P), e71.on("resize", () => this._viewChangeUpdate()), d2(() => {
      const t72 = e71.state;
      return [this._lodBias, this.lodSnapping, e71.quality, t72.camera, t72.contentCamera, t72.fixedContentCamera];
    }, () => this._viewChangeUpdate(), A3), d2(() => e71.qualitySettings?.fadeDuration, (e72) => this._renderer.textureFadingEnabled = e72 > 0, P), d2(() => e71.qualitySettings?.physicallyBasedRenderingEnabled, (e72) => this._renderer.pbrMode = e72 ? c9.Simplified : c9.Disabled, P), d2(() => e71.qualitySettings?.tiledSurface.elevationLevelDelta, () => this._updateAllTileGeometries()), d2(() => this._userClippingExtent, () => this._updateClippingExtent(), C)]), this.addHandles(e71.allLayerViews.on("after-changes", () => this._layerViewsDirty = true)), this._layerViewsDirty = true, this._handleLayerViewChanges(), this._renderer.updateTileBackground(this.backgroundColor);
  }
  destroy() {
    this._frameTask.remove(), this._watchUpdatingTracking.destroy(), this._removeAllTiles(), this._set("tilingSchemeLogic", u(this.tilingSchemeLogic)), this._basemapLayerViewHandles.forEach((e71, t71) => this._unregisterTiledLayerView(t71)), this._elevationDataRequester = null, this._mapDataRequester = null, this._set("overlayManager", u(this.overlayManager)), this._tileCache = u(this._tileCache), ie4.prune(), this._treeDebugger = u(this._treeDebugger), this._renderer = u(this._renderer), this._iteratorPool = u(this._iteratorPool), this._upsampleMapCache = u(this._upsampleMapCache), this._elevationQueryCache = u(this._elevationQueryCache), this._set("view", null), this._extentHelper = u(this._extentHelper), this._upsampleInfoPool = u(this._upsampleInfoPool), u9(), r49();
  }
  get renderer() {
    return this._renderer;
  }
  get frustum() {
    return this._frustum;
  }
  get snapLevel() {
    if (this.lodSnapping === A10.ON) {
      const e71 = this.view, t71 = this.tilingScheme, i49 = e71.terrainScale;
      if (t71 && i49) {
        const r57 = t71.levelAtScale(i49) + e71.qualitySettings.tiledSurface.lodBias, s67 = t71.getMaxLod();
        return Math.min(r57, s67 || 1 / 0);
      }
    }
    return null;
  }
  get lodSnapping() {
    return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences ? A10.ON : A10.OFF;
  }
  get upsampleInfoPool() {
    return this._upsampleInfoPool;
  }
  get upsampleMapCache() {
    return this._upsampleMapCache;
  }
  get elevationQueryCache() {
    return this._elevationQueryCache;
  }
  get _userClippingExtent() {
    const {
      spatialReference: e71
    } = this, {
      clippingArea: t71
    } = this.view;
    if (null == t71 || null == e71) return null;
    const i49 = u6(), r57 = u14(t71, i49, e71) ? i49 : null, s67 = this._get("extent");
    return I(r57, s67) ? s67 : r57;
  }
  get rootTilesExtent() {
    return this._rootTilesExtent;
  }
  get extent() {
    const e71 = U4(this.groundExtent, this._userClippingExtent, u6()), t71 = this._get("extent");
    return I(e71, t71) ? t71 : e71;
  }
  get groundExtent() {
    return null != this._tilingSchemeExtent ? this._tilingSchemeExtent : this._rootTilesExtent;
  }
  get _tilingSchemeExtent() {
    return this.tilingSchemeLogic?.extent;
  }
  get updating() {
    return this._hasPendingUpdates || (this._maxNumUpdating = 1), !!((this.running || this._watchUpdatingTracking?.updating || this._asyncWorkItems > 0) && this.ready && !this.suspended || this.overlayManager?.updating);
  }
  get running() {
    return (this._hasPendingUpdates || this._viewChanged || this._allTilesDirty || !this._allTilesSorted || this._layerViewsDirty || this._scaleRangeQueries.updating || this._frameTask.updating) && this.ready && !this.suspended;
  }
  get updatingProgressValue() {
    return this._maxNumUpdating = Math.max(this._pendingUpdates, this._maxNumUpdating), 1 - this._pendingUpdates / this._maxNumUpdating;
  }
  get baseOpacity() {
    return this.view?.map?.ground?.opacity ?? 1;
  }
  set baseOpacity(e71) {
    this.view.map.ground.opacity = e71;
  }
  get viewingMode() {
    return this.view.state.viewingMode;
  }
  get ready() {
    return null != this._rootTiles;
  }
  set renderOrder(e71) {
    this._renderer.renderOrder = e71, this._set("renderOrder", e71);
  }
  get rootTiles() {
    return this._rootTiles;
  }
  get spatialReference() {
    return this.tilingScheme?.spatialReference ?? null;
  }
  get backgroundColor() {
    return this.view?.map?.ground?.surfaceColor;
  }
  set backgroundColor(e71) {
    this.view.map.ground.surfaceColor = e71;
  }
  set slicePlaneEnabled(e71) {
    this._renderer.slicePlaneEnabled = e71, this._set("slicePlaneEnabled", e71), this._evaluateTransparency();
  }
  get tilingSchemeLocked() {
    return this.tilingSchemeLogic?.tilingSchemeLocked ?? false;
  }
  get wireframe() {
    return this._renderer?.wireframe;
  }
  set wireframe(e71) {
    e71 !== this._renderer.wireframe && (this._renderer.wireframe = e71, this._updateAllTileGeometries());
  }
  get opaque() {
    return this._renderer.transparency === ce6.Opaque;
  }
  set suspended(e71) {
    this._set("suspended", e71), this._viewChangeUpdate();
  }
  get fadeDuration() {
    return this.view.qualitySettings.fadeDuration ?? 0;
  }
  intersect(e71, t71, i49, r57) {
    this._renderer.intersect(e71, t71, i49, r57);
  }
  getElevationLevelDelta(e71) {
    return e71 < 4 ? 3 : this.view.qualitySettings.tiledSurface.elevationLevelDelta;
  }
  getElevation(e71, t71, i49, r57) {
    const s67 = this._rootTiles;
    if (!s67?.length) return null;
    if (0 === s67[0].layerInfo[A24.ELEVATION].length) return null;
    let a59 = this._elevationProjectorCache.get(r57);
    if (void 0 === a59 && (a59 = G3(r57, this._spatialReference) ?? null, this._elevationProjectorCache.set(r57, a59)), null == a59) return n.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"), null;
    const l47 = o4(ot4, e71, t71, i49);
    a59(l47, 0, l47, 0);
    return ct3(s67, l47[0], l47[1]);
  }
  getElevations(e71, t71, i49) {
    const r57 = this._rootTiles, s67 = r57 ? r57[0].layerInfo[A24.ELEVATION].length : 0;
    if (r57?.length && 0 !== s67) for (let a59 = 0; a59 < t71; ++a59) {
      const t72 = 3 * a59;
      i49(a59, ct3(r57, e71[t72], e71[t72 + 1]));
    }
    else for (let a59 = 0; a59 < t71; ++a59) i49(a59, null);
  }
  getScale(e71) {
    if (!this.tilingScheme) return null;
    if (!c5(e71, ot4, this.spatialReference)) return n.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"), null;
    const t71 = this._rootTiles;
    if (null != t71) {
      for (const i49 of t71) if (i49?.containsPoint(ot4)) {
        let e72 = i49;
        for (; e72.children[0] && !e72.rendered; ) {
          const t72 = e72.children[0].extent;
          let i50 = 0;
          ot4[0] > t72[2] && (i50 += 1), ot4[1] < t72[1] && (i50 += 2), e72 = e72.children[i50];
        }
        return this._getLodBiasCorrectedScale(e72.level);
      }
    }
    return 1 / 0;
  }
  _ensureSEBProject(e71) {
    const t71 = this._sebProjectorMap.get(e71);
    if (t71) return t71;
    const i49 = G3(e71, this._tilingSchemeSpatialReference, this._sebProjectorCache) ?? null;
    return this._sebProjectorMap.set(e71, i49), i49;
  }
  getSphereElevationBounds(e71, t71) {
    const i49 = this._ensureSEBProject(t71);
    if (null == i49) return n.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"), null;
    T2(e71, ht4);
    const r57 = V2(ht4);
    i49(r57, 0, r57, 0);
    const s67 = new e23(), a59 = this._rootTiles;
    if (null != a59) {
      const e72 = [];
      for (const i50 of a59) e72.push(i50);
      let t72 = 0;
      for (; t72 < e72.length; ) {
        const i50 = e72[t72];
        if (++t72, !g4(i50.extent, ht4)) continue;
        const r58 = i50.children;
        if (null == r58[0] || i50.rendered) s67.expandElevationRangeValues(i50.elevationBoundsMin, i50.elevationBoundsMax);
        else for (const t73 of r58) e72.push(t73);
      }
    }
    return s67;
  }
  getRootElevationBounds() {
    return new e23(this.rootTileElevationBounds.min, this.rootTileElevationBounds.max);
  }
  getSphereScale(e71, t71) {
    if (!this.tilingScheme) return null;
    if (!c5(e71, V2(ht4), this.spatialReference)) return n.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"), null;
    ht4[3] = t71;
    let i49 = null;
    const r57 = (e72) => {
      if (e72 && g4(e72.extent, ht4)) {
        const t72 = e72.children;
        if (t72[0] && !e72.rendered) for (const e73 of t72) r57(e73);
        else {
          const t73 = this._getLodBiasCorrectedScale(e72.level);
          i49 = null == i49 ? t73 : Math.min(i49, t73);
        }
      }
    }, s67 = this._rootTiles;
    if (null != s67) for (const a59 of s67) r57(a59);
    return i49;
  }
  queryVisibleScaleRange(e71, t71, i49, r57) {
    const s67 = t71 ? this.tilingScheme.levelAtScale(t71) : 0, a59 = i49 ? this.tilingScheme.levelAtScale(i49) : 1 / 0, n63 = this._lodBias;
    this._scaleRangeQueries.queryVisibleLevelRange(e71, s67 + n63, a59 + n63, r57);
  }
  _evaluateTransparency() {
    const e71 = this.baseOpacity, t71 = this.overlayManager.renderer.isEmpty, i49 = this._renderer.transparency, r57 = this._allSurfaceLayersTransparent() ? t71 ? ce6.Empty : ce6.TransparentWithDraped : e71 >= 1 && !this.hasCompositeBlendMode && !this._renderer.slicePlaneEnabled ? ce6.Opaque : ce6.Semitransparent, s67 = i49 !== r57;
    return s67 && (this._renderer.transparency = r57, this.view?._stage?.renderer.setParameters({
      terrainTransparency: this._renderer.transparency
    })), s67;
  }
  _updateTilingScheme() {
    const e71 = this.tilingSchemeLogic.tilingScheme;
    if (!(e71 !== this.tilingScheme)) return;
    S8(!!e71, "tiling scheme cannot be reset to undefined"), this._isGlobal = !this.view?.state?.isLocal, this.tilingScheme && this._removeAllTiles();
    const t71 = e71?.spatialReference ?? f2.WebMercator;
    this._spatialReference = t71, this._isWebMercator = !!t71?.isWebMercator, this._isWebMercatorOnPlateCarree = this._isWebMercator && O(this.view?.renderSpatialReference), this._isGeographic = t71?.isGeographic ?? false, this._set("tilingScheme", e71), this._tilingSchemeSpatialReference = this.tilingScheme?.spatialReference, this._sebProjectorMap.clear(), this._updateClippingExtent(), e71 && (this._updateTiledLayers(), this._renderer.setTileSize(e71.pixelSize), this.overlayManager.setSpatialReference(e71.spatialReference), this._updateRootTiles());
  }
  _acquireTile(e71, t71, i49, r57) {
    const s67 = this._tileCache.pop(at5._tileMemcacheKey);
    return s67 ? (s67.init(e71, t71, i49, r57, this), s67) : new this._tileConstructor(e71, t71, i49, r57, this);
  }
  get updatingRootTiles() {
    return this._updatingRootTiles;
  }
  _updateRootTiles() {
    const {
      extent: e71,
      tilingScheme: t71
    } = this;
    if (!t71) return;
    const i49 = dt4;
    let s67 = t71.rootTilesInExtent(e71, i49, 5 * s28);
    if (null != this._rootTiles) {
      if (s67.length > s28) return void n.getLogger(this).warn(u13);
      const e72 = this._rootTiles.map((e73) => e73.lij), t72 = g(e72, s67, ue2);
      if (this._updatingRootTiles = true, t72.removed.length > 0 || t72.added.length > 0) {
        const e73 = this._rootTiles.filter((e74) => !(t72.removed.findIndex((t73) => ue2(t73, e74.lij)) > -1) || (this._purgeTile(e74), false));
        t72.added.forEach((t73) => e73.push(this._newRootTile(t73))), this._setRootTiles(e73);
      }
    } else this._updatingRootTiles = true, s67.length > s28 && (n.getLogger(this).warn(p14), s67 = t71.rootTilesInExtent(e71, i49, s28)), this._setRootTiles(s67.map((e72) => this._newRootTile(e72)));
    I(i49, this._rootTilesExtent) || (this._rootTilesExtent = u6(i49)), this.renderer.visible = true, this._viewChangeUpdate(), this.overlayManager.setPlacementDirty(), this.notifyChange("ready"), this._updateAllTileGeometries(), this._updatingRootTiles = false, this.checkAllTilesWaterproofness();
  }
  _updateAllTileGeometries() {
    const e71 = this._allTiles.filter((e72) => e72.isLoaded && e72.intersectsClippingArea);
    e71.sort(u18), e71.forEach((e72) => this._renderer.updateTileGeometryState(e72)), e71.forEach((e72) => e72.renderData.updateNeighborData()), this._updateTilesGeometries(e71), this._pendingTilesToUpdate.clear();
  }
  _updateTilesGeometries(e71) {
    if (0 === e71.length) return;
    e71.sort(u18);
    const t71 = this.renderer;
    e71.forEach((e72) => t71.updateGeometryIfNeeded(e72)), e71.forEach((e72) => this._pendingTilesForElevationUpdateEvent.add(e72));
  }
  _shouldSplit(e71) {
    return e71.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.snapLevel) === E33.SPLIT;
  }
  _newRootTile(e71) {
    const t71 = this._acquireTile(0, e71[1], e71[2], null);
    return this._shouldSplit(t71) && t71.setPendingUpdate(E33.SPLIT), this._loadTile(t71), this._markTileToUpdate(t71), this._updateRootTileElevationBounds(), t71;
  }
  _setRootTiles(e71) {
    if (this._rootTiles = e71, this._allTiles.clear(), null != e71) {
      const t71 = this._iteratorPool.acquire();
      for (t71.reset(e71); !t71.done; ) this._allTiles.push(t71.next());
      t71.remove();
    }
    this._renderer.setRootTiles(this._rootTiles), this._updateTilesVisibility(e71);
  }
  _runViewChangeUpdateIfDirty() {
    this._viewChangeUpdateDirty && (this._viewChangeUpdateDirty = false, this._viewChangeUpdate());
  }
  _viewChangeUpdate() {
    this.view && !this.suspended && this.tilingScheme && this.renderer.visible && (this._inFrameTask ? this._viewChangeUpdateDirty = true : (this._viewChangeUpdateDirty = false, this._updateViewDependentParameters(), this._updateTilesVisibility(this._rootTiles)));
  }
  _updateClippingStatus(e71) {
    e71.updateClippingStatus(this.extent) && e71.resetPendingUpdate(E33.GEOMETRY) && this._updateTileGeometryState(e71);
  }
  _updateTilesVisibility(e71) {
    if (null == e71) return;
    const t71 = q6(e71), i49 = this.visibleElevationBounds;
    let r57 = t71 ? i49.min : 1 / 0, s67 = t71 ? i49.max : -1 / 0;
    const a59 = this.extent, n63 = this._viewProjectionMatrix;
    this.setTileTreeDirty();
    const l47 = this._iteratorPool.acquire();
    for (l47.reset(e71); !l47.done; ) {
      const e72 = l47.next();
      e72.updateClippingStatus(a59) && e72.resetPendingUpdate(E33.GEOMETRY) && this._updateTileGeometryState(e72), e72.computeVisibility(), e72.updateScreenDepth(n63), e72.renderData && (r57 = Math.min(e72.elevationBoundsMin, r57), s67 = Math.max(e72.elevationBoundsMax, s67));
    }
    l47.remove(), this._viewChanged = true, this._allTilesDirty = true, this._updatePendingTileGeometries(), isFinite(r57) && isFinite(s67) && (i49.min !== r57 || i49.max !== s67) && (this.visibleElevationBounds = new s53(r57, s67));
  }
  _updateRootTileElevationBounds() {
    let e71 = 1 / 0, t71 = -1 / 0;
    const i49 = this._rootTiles;
    null != i49 && i49.forEach(({
      elevationBoundsMin: i50,
      elevationBoundsMax: r58
    }) => {
      e71 = Math.min(e71, i50), t71 = Math.max(t71, r58);
    });
    const r57 = this.rootTileElevationBounds;
    r57.min === e71 && r57.max === t71 || (this.rootTileElevationBounds = new s53(e71, t71));
  }
  _updateViewDependentParameters() {
    const {
      camera: e71,
      contentCamera: t71
    } = this.view.state, i49 = Math.tan(0.5 * t71.fovX), r57 = Math.tan(0.5 * t71.fovY), s67 = this.tilingScheme.pixelSize, a59 = 2 ** -this._lodBias * e71.pixelRatio;
    this._splitLimits.aboveGround = e71.aboveGround, this._splitLimits.fovX = i49, this._splitLimits.fovY = r57, this._splitLimits.relativeWidthLimit = s67 / e71.width * this.maxTextureScale * a59, this._splitLimits.relativeHeightLimit = s67 / e71.height * this.maxTextureScale * a59, this._splitLimits.maxLod = this.tilingScheme.getMaxLod(), this._splitLimits.angledSplitBias = this.view.qualitySettings.tiledSurface.angledSplitBias, this.view.state.fixedContentCamera ? this._splitLimits.frustum = N(this._splitLimits.frustum ?? H3(), t71.frustum) : this._splitLimits.frustum = null, N(this._frustum, e71.frustum), c4(this._viewProjectionMatrix, t71.projectionMatrix, t71.viewMatrix), r5(this._eyePosRenderSR, t71.eye), n12(e71.eye, this.view.renderSpatialReference, this._eyePosSurfaceSR, this.spatialReference);
  }
  _updateTileGeometryState(e71) {
    e71.updateVisibility();
    this._renderer.updateTileGeometryState(e71) && this._markTileToUpdate(e71), this._usedMemory = null;
  }
  _markAllTileNeighborsForUpdate(e71) {
    e71.forEachLoadedNeighbor((e72) => {
      this._layerViews[A24.MAP].some(d11) && e72.setPendingUpdate(E33.TEXTURE_FADING), this._pendingTilesToUpdate.add(e72);
    });
  }
  _updateTileTexture(e71, t71) {
    const i49 = e71.resetPendingUpdate(E33.TEXTURE_FADING) ? E33.TEXTURE_FADING : !!e71.resetPendingUpdate(E33.TEXTURE_NOFADING) && E33.TEXTURE_NOFADING;
    i49 && (this._renderer.updateTileTexture(e71, i49), this._usedMemory = null, t71.madeProgress());
  }
  _emitElevationUpdateEventForTiles() {
    if (!this._shouldEmitChangeEvent) return;
    const e71 = pt3.extent;
    D(e71), this._pendingTilesForElevationUpdateEvent.forEach((t71) => m4(e71, t71.extent, e71)), this._pendingTilesForElevationUpdateEvent.clear(), pt3.spatialReference = this.spatialReference, this.emit("elevation-change", pt3), this._shouldEmitChangeEvent = false;
  }
  runTask(e71) {
    this._handleLayerViewChanges(e71), this._frameTask.processQueue(e71), this.renderer.processScaleRangeQueries(this._scaleRangeQueries, e71), this._inFrameTask = true, this._pendingUpdates = 0, this._hasPendingUpdates = false, this._updateAllTilesStatus(e71), this._sortTiles(e71);
    const t71 = !this.view.state.fixedContentCamera;
    if (this._mergeAndSplit(e71, t71), this._updateElevation(e71), this._updateTextures(e71), t71 || this._mergeAndSplit(e71, true), this._inFrameTask = false, this._runViewChangeUpdateIfDirty(), this._updatePendingTileGeometries(), this._emitElevationUpdateEventForTiles(), e71.done && e71.hasProgressed && this.requestUpdate(), this.notifyChange("updatingProgressValue"), E16 && this._checkTileInvariant(), !e71.hasProgressed) return o12;
  }
  _checkTileInvariant() {
    const e71 = /* @__PURE__ */ new Map();
    this._allTiles.forAll((t71) => e71.set(t71, /* @__PURE__ */ new Set())), this._allTiles.forAll((t71) => {
      if (S8(t71.rendered === t71.isLeaf, ` rendered ${t71.rendered} != ${t71.isLeaf} leaf`), !t71.isLeaf) {
        const e72 = (e73) => 0 === e73.unmergableChildCount && 0 === e73.maxLevelDeltaNeighborCount, i49 = t71.children.reduce((t72, i50) => t72 + (e72(i50) ? 0 : 1), 0);
        if (S8(t71.unmergableChildCount === i49, ` Tile[${t71.lij.toString()}] unmergeable child count mismatch: actual ${t71.unmergableChildCount} vs ${i49}`), t71.hasPendingUpdate(E33.MERGE)) {
          S8(!t71.hasPendingUpdate(E33.SPLIT), "Tile can be both split and merge at the same time");
          for (const e73 of t71.children) S8(e73.isLeaf || e73.hasPendingUpdate(E33.MERGE), "Child of tile to merge must also merge");
        }
      }
      for (let i49 = 0; i49 < 4; ++i49) {
        if (t71.rendered) {
          const e72 = t71.renderData?.geometryState.edgePeerNeighbors[i49];
          if (null != e72) {
            {
              const r58 = t71.level - e72.level <= f16;
              r58 || (console.log(`tile level delta [${t71.lij.toString()}] vs [${e72.lij.toString()}] > ${f16}  (edge[${i49}])`), S8(r58, `tile level delta [${t71.level}] vs [${e72.level}] > ${f16}`));
            }
            S8(t71.level - e72.level <= f16, `Max tile lod delta exceeded: [${t71.lij.toString()}] vs [${e72.lij.toString()}]`);
          }
        }
        const r57 = t71.level - f16, s67 = (e72) => e72.isLeaf || e72.level === t71.level, a59 = t71.findNeighborTile(nn[i49], s67);
        if (null != a59) {
          if (t71.isLeaf && t71.level >= f16) {
            let i50 = a59;
            for (; t71.level - i50.level < f16; ) i50 = i50.parent;
            const s68 = [r57, t71.lij[1] >> f16, t71.lij[2] >> f16];
            if (!ue2(s68, i50.lij)) {
              const r58 = e71.get(i50);
              S8(!r58.has(t71), "Cannot already have neighbor"), r58.add(t71);
            }
          }
          S8(a59.rendered || a59.level === t71.level, "Non-same-level-neighbor of rendered must be rendered"), S8(t71.level - a59.level <= f16, `Tile level delta [${t71.level}] vs [${a59.level}] > ${f16}`);
        }
      }
    }), this._allTiles.forAll((t71) => {
      const i49 = t71.maxLevelDeltaNeighborCount, r57 = e71.get(t71);
      S8(i49 === r57.size, `Tile[${t71.lij.toString()}] merge-blocker mismatch: actual ${i49} vs ${r57.size}`);
    });
  }
  _updateAllTilesStatus(e71) {
    if (!this._viewChanged || !this._rootTiles || e71.done) return;
    this._viewChanged = false;
    const t71 = new gt3(this._allTiles.length);
    t71.pushAll(this._rootTiles);
    const i49 = this.snapLevel, r57 = this._splitLimits, s67 = this._eyePosRenderSR;
    this._allTiles.forAll((e72) => {
      e72.maxLevelDeltaNeighborCount = 0, e72.unmergableChildCount = 0;
    });
    const a59 = this._viewProjectionMatrix;
    for (; !t71.empty; ) {
      const e72 = t71.pop(), n63 = e72.parent, l47 = null != n63 && n63.hasPendingUpdate(E33.MERGE), o60 = l47 ? E33.MERGE : e72.shouldSplit(r57, s67, i49), h32 = o60 === E33.SPLIT;
      e72.isLeaf ? _t3(e72, h32) : t71.pushAll(e72.children), l47 ? (e72.resetPendingUpdate(E33.SPLIT), e72.isLeaf || e72.setPendingUpdate(E33.MERGE), this._updateClippingStatus(e72), e72.updateVisibility(), e72.updateScreenDepth(a59)) : h32 ? (e72.resetPendingUpdate(E33.MERGE), e72.isLeaf && e72.setPendingUpdate(E33.SPLIT)) : (e72.resetPendingUpdate(E33.SPLIT) && e72.updateAgentSuspension(), o60 === E33.ELEVATION && e72.updateAgents(A24.ELEVATION), e72.isLeaf || (e72.setPendingUpdate(E33.MERGE), e72.resetPendingUpdate(E33.SPLIT)));
    }
    this.requestUpdate(), (this._shortBatches || !this._oneBatchPerFrameTask) && this._updatePendingTileGeometries(), e71.madeProgress();
  }
  _sortTiles(e71) {
    e71.done || this._allTilesSorted || (d13(this._allTiles, this.view.pointsOfInterest.focus.renderLocation), this._allTilesSorted = true, this._treeDebugger && this._treeDebugger.update(), e71.madeProgress());
  }
  _markTileToUpdate(e71) {
    O9(e71.isLoaded), e71.intersectsClippingArea && (this._pendingTilesToUpdate.add(e71), this._markAllTileNeighborsForUpdate(e71));
  }
  _updatePendingTileGeometries() {
    const e71 = this._pendingTilesToUpdate, t71 = Array.from(e71.keys()).filter((e72) => e72.isLoaded && e72.intersectsClippingArea);
    if (0 === t71.length) return void e71.clear();
    const i49 = (i50, r58) => {
      !r58?.isLoaded || !r58.intersectsClippingArea || r58.level < i50.level || e71.has(r58) || (e71.add(r58), t71.push(r58), r58.renderData.updateNeighborData());
    };
    t71.sort(u18);
    const r57 = t71.length;
    for (let s67 = 0; s67 < r57; ++s67) {
      const r58 = t71[s67];
      O9(r58.isLoaded), O9(r58.intersectsClippingArea);
      const a59 = r58.renderData;
      a59.updateNeighborData();
      const n63 = a59.dirtyEdgeResolutions, l47 = a59.geometryState, o60 = (e72) => {
        const t72 = tn[e72];
        i49(r58, l47.cornerPeerNeighbors[e72]?.findCorner(z6(t72), (e73) => e73.isLoaded));
      };
      for (let t72 = 0; t72 < 4; ++t72) if (n63 & 1 << t72) {
        const s68 = a59.geometryState.edgePeerNeighbors[t72];
        s68 && s68?.level >= r58.level && s68.forAllSubtreeOnSide(J4(nn[t72]), (t73) => !(!t73.isLoaded || !t73.intersectsClippingArea) && (O9(e71.has(t73) || u18(r58, t73) < 0), i49(r58, t73), true)), o60((t72 + 1) % 4), o60(t72);
      }
    }
    e71.clear(), this._updateTilesGeometries(t71), this._shouldEmitChangeEvent = true, E16 && m17 && this.checkAllTilesWaterproofness();
  }
  _mergeAndSplit(e71, t71) {
    if (this.suspended || e71.done || !this._allTilesDirty) return;
    this._allTilesDirty = false, this.requestUpdate();
    let i49 = false;
    const r57 = this.view.state.fixedContentCamera;
    let s67 = false;
    for (; !e71.done; ) {
      s67 = true;
      let a59 = false;
      const n63 = !this._allTiles.some((s68) => {
        if (!i49 && !r57 && !s68.visible) return e71.done;
        let n64 = s68;
        if (s68.hasPendingUpdate(E33.MERGE)) {
          if (!t71 || s68.unmergableChildCount > 0) return e71.done;
          for (s68.resetPendingUpdate(E33.MERGE); null != n64.parent && 0 === n64.parent.unmergableChildCount && n64.parent.resetPendingUpdate(E33.MERGE); ) n64 = n64.parent;
          this._mergeTile(n64), a59 = true, e71.madeProgress();
        } else if (s68.resetPendingUpdate(E33.SPLIT)) {
          let t72 = true;
          const i50 = s68.level;
          if (i50 >= f16) {
            const e72 = (e73) => e73.isLeaf || i50 - e73.level < f16;
            for (let r58 = 0; r58 < 4; ++r58) {
              const a60 = s68.findNeighborTile(nn[r58], e72);
              null != a60 && i50 - a60.level === f16 && (t72 = false, E16 && (O9(a60.isLeaf), O9(a60.hasPendingUpdate(E33.SPLIT))));
            }
          }
          t72 ? (this._splitTile(s68), e71.madeProgress(), a59 = true) : s68.setPendingUpdate(E33.SPLIT);
        }
        return e71.done;
      });
      if (a59 && (this._allTilesSorted = false, this._allTilesDirty = true, !this._oneBatchPerFrameTask && this._updatePendingTileGeometries()), n63) {
        if (!i49) {
          i49 = true;
          continue;
        }
        if (!a59) break;
      } else this._allTilesDirty = true;
    }
    s67 ? e71.madeProgress() : this._allTilesDirty = true, !this._oneBatchPerFrameTask && this._updatePendingTileGeometries(), this._sortTiles(e71);
  }
  _updateElevation(e71) {
    e71.done || (this._allTiles.some((t71) => (t71.resetPendingUpdate(E33.GEOMETRY) && (this._updateTileGeometryState(t71), this._shortBatches && this._updatePendingTileGeometries(), e71.madeProgress()), e71.done)), !this._oneBatchPerFrameTask && this._updatePendingTileGeometries());
  }
  _updateTextures(e71) {
    e71.done || this._allTiles.some((t71) => (this._updateTileTexture(t71, e71), e71.done));
  }
  _updateClippingExtent() {
    this.spatialReference && (this.updateTileOverlayParams(O7.UPDATE), this.overlayManager.setPlacementDirty(), this._updateRootTiles());
  }
  get _lodBias() {
    const e71 = this.view.quality;
    return this.view.qualitySettings.tiledSurface.lodBias - (1 - e71) * i18;
  }
  _getLodBiasCorrectedScale(e71) {
    const t71 = this.tilingScheme.levels, i49 = e12(e71 - this._lodBias, 0, t71.length - 1), r57 = i49 - Math.floor(i49);
    return t71[Math.floor(i49)].scale * (1 - r57) + t71[Math.ceil(i49)].scale * r57;
  }
  _removeAllTiles() {
    null != this._rootTiles && (this._rootTiles.forEach((e71) => this._purgeTile(e71)), this._setRootTiles(null), this.notifyChange("ready")), this._allTiles.clear(), this.renderer.visible = false;
  }
  _purgeDescendantTiles(e71) {
    if (!e71.children[0]) return;
    const t71 = e71.children.slice();
    e71.unsetChildren();
    for (let i49 = 0; i49 < 4; ++i49) this._purgeTile(t71[i49]);
  }
  _purgeTile(e71) {
    e71.isLeaf ? ft3(e71) : this._purgeDescendantTiles(e71), this._allTiles.removeUnordered(e71), this._unloadTile(e71), this._tileCache.put(at5._tileMemcacheKey, e71);
  }
  _unloadTile(e71) {
    this._pendingTilesToUpdate.delete(e71), this._pendingTilesForElevationUpdateEvent.delete(e71), e71.unload(this._renderer);
  }
  _splitTile(e71) {
    S8(e71.isLeaf, "Tile that is already split should not be split again!"), S8(e71.rendered, "Tile marked to split is not rendered"), ft3(e71);
    const t71 = e71.level + 1, i49 = 2 * e71.lij[1], r57 = 2 * e71.lij[2], s67 = e71.setChildren(this._createTile(t71, i49, r57, e71), this._createTile(t71, i49, r57 + 1, e71), this._createTile(t71, i49 + 1, r57, e71), this._createTile(t71, i49 + 1, r57 + 1, e71));
    this._allTiles.pushArray(s67), e71.updateAgentSuspension(), S8(e71.rendered, "parent should be rendered"), this._unloadTile(e71), s67.forEach((e72) => this._loadTile(e72)), s67.forEach((e72) => this._pendingTilesToUpdate.add(e72)), this._markAllTileNeighborsForUpdate(e71), this._emitTileScaleChange(e71, e71.level + 1), this._allTilesDirty = true, this._shortBatches && this._updatePendingTileGeometries(), s67.forEach((e72) => _t3(e72, e72.hasPendingUpdate(E33.SPLIT))), ++this._performanceInfo.numSplit;
  }
  _emitTileScaleChange(e71, t71 = e71.level) {
    ut3.spatialReference = this.spatialReference, ut3.extent = e71.extent, ut3.scale = this._getLodBiasCorrectedScale(t71), this.emit("scale-change", ut3);
  }
  _createTile(e71, t71, i49, r57) {
    S8(!!r57, "_createTile sanity check");
    const s67 = this._acquireTile(e71, t71, i49, r57);
    return s67.updateClippingStatus(this.extent), s67.updateScreenDepth(this._viewProjectionMatrix), this._shouldSplit(s67) && s67.setPendingUpdate(E33.SPLIT), s67;
  }
  get _shortBatches() {
    return this.view.state.mode !== I2.IDLE;
  }
  _mergeTile(e71) {
    S8(!e71.hasPendingUpdate(E33.SPLIT), "_mergeTile sanity check"), S8(!e71.isLeaf, "Cannot merge a leaf"), e71.isLeaf || (this._purgeDescendantTiles(e71), S8(!e71.renderData, "_mergeTile sanity check"), this._loadTile(e71), this._markTileToUpdate(e71), this._emitTileScaleChange(e71), this._shortBatches && this._updatePendingTileGeometries(), _t3(e71, false), this._allTilesDirty = true, ++this._performanceInfo.numMerged);
  }
  _loadTile(e71) {
    e71.load(), this.requestUpdate(), this._allTilesDirty = true, this.overlayManager && this.overlayManager.hasOverlays && this.overlayManager.setTileParameters(e71);
  }
  _handleLayerViewChanges(e71 = C4) {
    if (!this._layerViewsDirty) return;
    this._layerViewsDirty = false;
    let t71 = false;
    const i49 = /* @__PURE__ */ new Set();
    let r57 = -1;
    for (let s67 = this.view.allLayerViews.length - 1; s67 >= 0; s67--) {
      const e72 = this.view.allLayerViews.items[s67];
      if (i49.add(e72.uid), L7(e72) || x7(e72)) if (this._basemapLayerViewHandles.has(e72.uid) && !x7(e72)) {
        const i50 = this._layerClassFromLayerView(e72), s68 = this._getLayerIdxByUID(i50, e72.uid);
        null != s68 && ((s68 < r57 || null == r57) && (t71 = true), r57 = s68);
      } else this._registerTiledLayerView(e72), e72.layer.loaded && (t71 = true);
    }
    this._basemapLayerViewHandles.forEach((e72, r58) => {
      i49.has(r58) || (this._unregisterTiledLayerView(r58), t71 = true);
    }), t71 && this._updateTiledLayers(), this.hasCompositeBlendMode = this._hasCompositeBlendMode(), this._evaluateTransparency(), e71.madeProgress();
  }
  _allSurfaceLayersTransparent() {
    let e71 = 0 === this.view.map?.ground?.opacity;
    for (const t71 of this.view.allLayerViews.items) if (h10(t71) && !j3(t71.layer) && 0 !== t71.fullOpacity) return e71 = false, e71;
    return e71;
  }
  _hasCompositeBlendMode() {
    for (const e71 of this.view.allLayerViews.items) if ((A9(e71) || x7(e71)) && o34(e36[e71.layer.blendMode])) return true;
    return false;
  }
  _layerClassFromLayerView(e71) {
    return U7(e71) ? A24.ELEVATION : A24.MAP;
  }
  _registerTiledLayerView(e71) {
    const t71 = [];
    if ((A9(e71) || x7(e71)) && t71.push(d2(() => e71.layer.blendMode, () => {
      this.hasCompositeBlendMode = this._hasCompositeBlendMode(), this._updateTileTextures(H7.UNFADED);
    })), !x7(e71)) {
      const i49 = this._layerClassFromLayerView(e71);
      t71.push(d2(() => e71.suspended, () => this._updateTiledLayers())), t71.push(d2(() => e71.fullOpacity, () => this._updateTileTextures(H7.UNFADED))), t71.push(d2(() => "effectiveScaleRange" in e71.layer ? e71.layer.effectiveScaleRange : null, () => this._restartAllAgents(i49))), t71.push(e71.on("data-changed", () => {
        const t72 = this._getLayerIdxByUID(i49, e71.uid);
        null != t72 && this._invalidateLayerData(t72, i49);
      }));
    }
    this._unregisterTiledLayerView(e71.uid), this._basemapLayerViewHandles.set(e71.uid, t71);
  }
  _unregisterTiledLayerView(e71) {
    const t71 = this._basemapLayerViewHandles.get(e71);
    if (t71) {
      for (const e72 of t71) e72.remove();
      this._basemapLayerViewHandles.delete(e71);
    }
  }
  _updateTiledLayers() {
    if (!this.tilingScheme || this.view.suspended) return;
    const e71 = this.view.allLayerViews, t71 = [[], []];
    let i49 = null;
    e71.forEach((e72) => {
      if (!e72.layer || e72.suspended || !L7(e72) || !e72.fullExtent) return;
      const r57 = this._layerClassFromLayerView(e72);
      if (r57 === A24.MAP) {
        const t72 = e72.displayLevelRange.maxLevel;
        t72 !== 1 / 0 && (null === i49 || t72 > i49) && (i49 = t72);
      }
      t71[r57].push(e72);
    });
    for (const r57 of E29) {
      const e72 = this._layerViews[r57], i50 = t71[r57];
      i50.reverse();
      const s67 = i50.length;
      let a59 = e72.length !== s67;
      const n63 = new Array(s67), l47 = new Array(e72.length);
      this._layerIndexByUid[r57].clear();
      for (let t72 = 0; t72 < s67; t72++) {
        const s68 = i50[t72].uid;
        this._layerIndexByUid[r57].set(s68, t72);
        const o60 = e72.indexOf(i50[t72]);
        n63[t72] = o60, t72 !== o60 && (a59 = true), o60 > -1 && (l47[o60] = t72);
      }
      if (a59) {
        const e73 = this._postorderIterator;
        for (e73.reset(this._rootTiles); !e73.done; ) e73.next().modifyLayers(l47, n63, r57);
        this._layerViews[r57] = i50, this._restartAllAgents(r57), this._updateTilesVisibility(this._rootTiles);
      }
    }
    this.tilingScheme.ensureMaxLod(i49) && (this._viewChangeUpdate(), this.notifyChange("tilingScheme"));
  }
  _restartAllAgents(e71) {
    const t71 = this._postorderIterator;
    for (t71.reset(this._rootTiles); !t71.done; ) {
      const i49 = t71.next();
      i49.restartAgents(e71), e71 === A24.ELEVATION && i49.computeElevationBounds();
    }
    this._updateRootTileElevationBounds();
  }
  layerViewByIndex(e71, t71) {
    return this._layerViews[t71][e71];
  }
  numLayers(e71) {
    return this._layerViews[e71].length;
  }
  _updateTileTextures(e71) {
    this._allTiles.forAll((t71) => {
      t71.updateAgents(A24.MAP), e71 === H7.IMMEDIATE ? this.renderer.updateTileTexture(t71, E33.TEXTURE_NOFADING) : t71.updateRenderData(A24.MAP, e71);
    }), this._evaluateTransparency();
  }
  _invalidateLayerData(e71, t71) {
    this._allTiles.forAll((i49) => i49.removeLayerAgent(e71, t71)), this._allTiles.forAll((i49) => i49.invalidateLayerData(e71, t71));
  }
  setTileTreeDirty() {
    this._allTilesDirty = true;
  }
  requestRender(e71 = O7.UPDATE) {
    this.renderer.setNeedsRender(e71);
  }
  requestUpdate() {
    1 == ++this._pendingUpdates && (this._hasPendingUpdates = true);
  }
  requestTileData(e71, t71, i49, r57) {
    const s67 = this.layerViewByIndex(t71, i49), a59 = s67.layer;
    return !a59.tilemapCache || d11(s67) ? this._requestTileData(e71, i49, s67, r57) : (++this._asyncWorkItems, a59.tilemapCache.fetchAvailability(e71.lij[0], e71.lij[1], e71.lij[2], __spreadProps(__spreadValues({}, r57), {
      timeout: 6e3
    })).then(() => --this._asyncWorkItems).catch((t72) => {
      throw --this._asyncWorkItems, s3(r57), b(t72) || this._dataMissing(e71, i49, s67), t72;
    }).then(() => this._frameTask.schedule(() => this._requestTileData(e71, i49, s67, r57), r57.signal)));
  }
  _requestTileData(e71, t71, i49, r57) {
    const s67 = t71 === A24.ELEVATION;
    return r57.requester ??= s67 ? this._elevationDataRequester : this._mapDataRequester, s67 ? U7(i49) ? this._requestElevationTileData(e71, i49, r57) : Promise.reject() : h10(i49) ? this._requestMapTileData(e71, i49, r57) : Promise.reject();
  }
  _requestElevationTileData(e71, t71, i49) {
    ++this._asyncWorkItems;
    const r57 = (r58) => {
      !c(i49) && r58 && (this._usedMemory = null, this.requestUpdate(), this._elevationDataArrived(e71, t71, r58));
    }, s67 = (i50) => {
      b(i50) || (n.getLogger(this).error(`Tile ${e71.lij.toString()} layer ${A24.ELEVATION}/${t71.uid} error ${i50}`), this._dataMissing(e71, A24.ELEVATION, t71), this.requestUpdate());
    };
    return t71.fetchTile(e71.lij, i49).then((e72) => this._frameTask.schedule(() => r57(e72)), s67).finally(() => --this._asyncWorkItems);
  }
  _elevationDataArrived(e71, t71, i49) {
    const r57 = this._layerIndexByUid[A24.ELEVATION].get(t71.uid);
    if (null == r57) return void n.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s", A24.ELEVATION, e71.lij.toString());
    const s67 = new r47(e71.lij, e71.extent, i49);
    e71.dataArrived(r57, A24.ELEVATION, s67);
    const a59 = [e71], l47 = e71.level, o60 = this._iteratorPool.acquire();
    for (o60.reset(a59); !o60.done; ) {
      const e72 = o60.next();
      e72.findElevationBoundsForLayer(r57, l47), e72.computeElevationBounds();
    }
    0 === l47 && this._updateRootTileElevationBounds(), o60.remove(), this._updateTilesVisibility(a59);
  }
  _requestMapTileData(e71, t71, i49) {
    ++this._asyncWorkItems;
    const r57 = (r58, s68) => {
      b6(s68), c(i49) || (console.error(`Tile ${e71.lij.toString()} layer ${A24.MAP}/${t71.uid} error ${r58}`), this._dataMissing(e71, A24.MAP, t71), this.requestUpdate());
    }, s67 = (e72) => (t72) => r57(t72, e72), a59 = (r58) => this._frameTask.schedule(() => {
      this.requestUpdate(), c(i49) ? b6(r58) : this._mapTileDataArrived(e71, t71, r58);
    }, i49.signal, s67(r58)).catch(s67(r58)), n63 = (e72, t72 = null) => this._frameTask.schedule(() => r57(e72, t72));
    return t71.fetchTile(e71.lij, i49).then(a59, n63).finally(() => --this._asyncWorkItems);
  }
  _mapTileDataArrived(e71, t71, i49) {
    const r57 = this._getLayerIdxByUID(A24.MAP, t71.uid);
    if (null == r57) return b6(i49), void n.getLogger(this).warn("TerrainSurface: received data from unknown layer");
    e71.dataArrived(r57, A24.MAP, i49);
  }
  _getLayerIdxByUID(e71, t71) {
    return this._layerIndexByUid[e71].get(t71);
  }
  _dataMissing(e71, t71, i49) {
    const r57 = this._getLayerIdxByUID(t71, i49.uid);
    null != r57 ? e71.dataMissing(r57, t71) : n.getLogger(this).warn("TerrainSurface: received data from unknown layer");
  }
  updateTileOverlayParams(e71) {
    this._rootTiles && this.overlayManager && (this._allTiles.forAll((e72) => {
      e72.renderData && this.overlayManager.setTileParameters(e72);
    }), this._renderer.setNeedsRender(e71));
  }
  get performanceInfo() {
    const e71 = this._performanceInfo;
    return e71.numNodes = this._allTiles.length, e71.numLeaves = e71.numVisible = e71.numRendered = e71.numLoadedPerLevel.length = e71.numRenderedPerLevel.length = 0, this._allTiles.forAll((t71) => {
      t71.isLeaf && e71.numLeaves++;
      const i49 = t71.level;
      t71.renderData && (e71.numLoadedPerLevel[i49] = (e71.numLoadedPerLevel[i49] || 0) + 1), t71.visible && (e71.numVisible++, t71.rendered && (e71.numRenderedPerLevel[i49] = (e71.numRenderedPerLevel[i49] || 0) + 1, e71.numRendered++));
    }), e71;
  }
  get usedMemory() {
    return this.tilingScheme ? (null == this._usedMemory && (this._usedMemory = this._recalculateUsedMemory()), this._usedMemory ?? 0) : 0;
  }
  _recalculateUsedMemory() {
    return this.tilingScheme ? Math.round(this._allTiles.reduce((e71, t71) => e71 + t71.usedMemory, 0)) : null;
  }
  getUsedMemoryForLayerView(e71) {
    let t71 = 0;
    const i49 = this._layerClassFromLayerView(e71), r57 = this._getLayerIdxByUID(i49, e71.uid);
    return null != r57 && this._allTiles.forAll((e72) => t71 += e72.getUsedMemoryForLayer(i49, r57)), t71;
  }
  getTile(e71) {
    if (null == e71 || null == this._rootTiles) return null;
    const t71 = e71.split("/").map((e72) => +e72);
    if (0 === t71[0]) return this._rootTiles.find((e72) => e72.lij[1] === t71[1] && e72.lij[2] === t71[2]);
    const i49 = t71[0], r57 = t71[1] >> i49, s67 = t71[2] >> i49;
    let a59;
    if (this._rootTiles.some((e72) => e72.lij[1] === r57 && e72.lij[2] === s67 && (a59 = e72, true)), a59) {
      let e72 = 1 << t71[0] - 1;
      for (; a59.lij[0] < t71[0]; ) {
        let i50 = t71[1] & e72 ? 2 : 0;
        if ((t71[2] & e72) > 0 && i50++, !a59.children[i50]) return null;
        a59 = a59.children[i50], e72 >>= 1;
      }
      return S8(a59.lij[0] === t71[0] && a59.lij[1] === t71[1] && a59.lij[2] === t71[2], "not the right tile?"), a59;
    }
    return null;
  }
  get renderPatchBorders() {
    return this._renderer.renderPatchBorders;
  }
  set renderPatchBorders(e71) {
    this._renderer.renderPatchBorders = e71;
  }
  get visualizeNormals() {
    return this._renderer.visualizeNormals;
  }
  set visualizeNormals(e71) {
    this._renderer.visualizeNormals = e71;
  }
  get renderingDisabled() {
    return this._renderer.renderingDisabled;
  }
  set renderingDisabled(e71) {
    this._renderer.renderingDisabled = e71;
  }
  get test() {
  }
  checkAllTilesWaterproofness() {
    if (!m17) return;
    const e71 = this._rootTiles;
    if (null == e71) return;
    const t71 = (e72) => e72?.renderData?.geometry?.indices?.length > 0, i49 = (e72, i50) => {
      t71(e72) && console.error("Tile[", e72.lij, "] has geometry although parent[", i50.lij, "] has geom");
    }, r57 = (e72) => {
      if (e72.intersectsClippingArea) if (e72.renderData && !e72.renderData.geometryState && console.error("Tile[", e72.lij, "] has renderData but not geometryState"), e72.renderData && !e72.renderData.geometry && console.error("Tile[", e72.lij, "] has renderData but not geometryInfo"), !e72.renderData?.geometry || (e72.renderData.geometry.indices?.length ?? 0) > 0 || console.error("Tile[", e72.lij, "] has renderData but no indices - geometryInfo: ", e72.renderData.geometry), t71(e72)) {
        e72.checkGeometryWaterproofness();
        for (const t72 of e72.children) i49(t72, e72);
      } else if (e72.isLeaf) console.error("Tile[", e72.lij, "] has no geometry and no children, from root to leaf");
      else for (const t72 of e72.children) r57(t72);
    }, s67 = (e72) => {
      const t72 = e72.parent?.visible ?? true, i50 = e72.visible;
      e72.computeVisibility();
      const r58 = e72.visible;
      if (i50 !== r58 && t72 && console.error(" Tile[", e72.lij, "] has out of date visibility: ", i50, " instead of ", r58), !e72.isLeaf) for (const a59 of e72.children) s67(a59);
    };
    for (const a59 of e71) r57(a59), s67(a59);
  }
  get isGlobal() {
    return this._isGlobal;
  }
  get isGeographic() {
    return this._isGeographic;
  }
  get isWebMercator() {
    return this._isWebMercator;
  }
  get isWebMercatorOnPlateCarree() {
    return this._isWebMercatorOnPlateCarree;
  }
  isEastEndWrap(e71) {
    return this._isGlobal && e71[2] === this.lijEastEnd(e71[0]) - 1;
  }
  isWestEndWrap(e71) {
    return this._isGlobal && 0 === e71[2];
  }
  lijEastEnd(e71) {
    return 1 << e71 + (this._isGeographic ? 1 : 0);
  }
  wrapEastWest(e71) {
    const t71 = this.lijEastEnd(e71[0]), i49 = e71[2];
    if (0 <= i49 && i49 < t71) return e71;
    if (!this._isGlobal) return null;
    const r57 = (i49 + (i49 < 0 ? t71 : 0)) % t71;
    return [e71[0], e71[1], r57];
  }
  enableInternalChecks(e71) {
    H6(e71);
  }
  enableWaterproofnessChecks(e71) {
    p15(e71);
  }
};
nt4._tileMemcacheKey = "TerrainTileMemcache", e6([y2()], nt4.prototype, "_renderer", void 0), e6([y2({
  constructOnly: true
})], nt4.prototype, "_scaleRangeQueries", void 0), e6([y2({
  constructOnly: true
})], nt4.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], nt4.prototype, "overlayManager", void 0), e6([y2()], nt4.prototype, "_hasPendingUpdates", void 0), e6([y2()], nt4.prototype, "_asyncWorkItems", void 0), e6([y2()], nt4.prototype, "_allTilesDirty", void 0), e6([y2()], nt4.prototype, "_allTilesSorted", void 0), e6([y2()], nt4.prototype, "_viewChanged", void 0), e6([y2({
  type: Number
})], nt4.prototype, "heading", void 0), e6([y2()], nt4.prototype, "_splitLimits", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "_watchUpdatingTracking", void 0), e6([y2()], nt4.prototype, "_frameTask", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "snapLevel", null), e6([y2({
  readOnly: true
})], nt4.prototype, "lodSnapping", null), e6([y2()], nt4.prototype, "_userClippingExtent", null), e6([y2()], nt4.prototype, "_rootTilesExtent", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "extent", null), e6([y2({
  readOnly: true
})], nt4.prototype, "groundExtent", null), e6([y2({
  readOnly: true
})], nt4.prototype, "_tilingSchemeExtent", null), e6([y2({
  readOnly: true
})], nt4.prototype, "updating", null), e6([y2({
  readOnly: true
})], nt4.prototype, "running", null), e6([y2(t30)], nt4.prototype, "updatingProgress", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "updatingProgressValue", null), e6([y2()], nt4.prototype, "_maxNumUpdating", void 0), e6([y2()], nt4.prototype, "baseOpacity", null), e6([y2()], nt4.prototype, "hasCompositeBlendMode", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "viewingMode", null), e6([y2()], nt4.prototype, "maxTextureScale", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "ready", null), e6([y2({
  value: O12.FRONT_TO_BACK
})], nt4.prototype, "renderOrder", null), e6([y2({
  readOnly: true
})], nt4.prototype, "rootTiles", null), e6([y2()], nt4.prototype, "_rootTiles", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "spatialReference", null), e6([y2({
  type: u7
})], nt4.prototype, "backgroundColor", null), e6([y2({
  value: false
})], nt4.prototype, "slicePlaneEnabled", null), e6([y2({
  readOnly: true
})], nt4.prototype, "tilingScheme", void 0), e6([y2({
  readOnly: true
})], nt4.prototype, "tilingSchemeLocked", null), e6([y2({
  readOnly: true
})], nt4.prototype, "tilingSchemeLogic", void 0), e6([y2()], nt4.prototype, "wireframe", null), e6([y2({
  value: false
})], nt4.prototype, "suspended", null), e6([y2()], nt4.prototype, "fadeDuration", null), e6([y2()], nt4.prototype, "visibleElevationBounds", void 0), e6([y2()], nt4.prototype, "rootTileElevationBounds", void 0), e6([y2()], nt4.prototype, "_layerViewsDirty", void 0), e6([y2()], nt4.prototype, "renderPatchBorders", null), e6([y2()], nt4.prototype, "visualizeNormals", null), e6([y2()], nt4.prototype, "renderingDisabled", null), nt4 = at5 = e6([a4("esri.views.3d.terrain.TerrainSurface")], nt4);
var lt5 = nt4;
var ot4 = n7();
var ht4 = _5();
var dt4 = u6();
new l3();
var pt3 = new e33("ground");
var ut3 = {
  spatialReference: null,
  extent: null,
  scale: 0
};
function ct3(e71, t71, i49) {
  for (const r57 of e71) {
    if (!r57.containsPointXY(t71, i49)) continue;
    let e72 = r57;
    for (; e72 && !e72.renderData; ) {
      const r58 = (t71 > e72.extentMidX ? 1 : 0) + (i49 < e72.extentMidY ? 2 : 0);
      e72 = e72.children[r58];
    }
    const s67 = e72?.renderData?.geometryState.samplerData ?? null;
    return e55(t71, i49, s67);
  }
  return null;
}
var gt3 = class {
  constructor(e71) {
    this.capacity = e71, this._head = 0, this._tail = 0, this._data = new Array(e71);
  }
  push(e71) {
    const t71 = this._tail;
    if (!(t71 < this.capacity)) throw new Error("Queue full");
    this._data[t71] = e71, this._tail = t71 + 1;
  }
  pushAll(e71) {
    const t71 = e71.length;
    if (0 === t71) return;
    const i49 = this._tail;
    if (!(i49 + t71 <= this.capacity)) throw new Error("Queue full");
    for (let r57 = 0; r57 < t71; ++r57) this._data[i49 + r57] = e71[r57];
    this._tail = i49 + t71;
  }
  pop() {
    const e71 = this._head;
    if (e71 < this._tail) {
      const t71 = this._data[e71];
      return this._head = e71 + 1, t71;
    }
  }
  get empty() {
    return this._head >= this._tail;
  }
  get full() {
    return this._tail >= this._data.length;
  }
};
function _t3(e71, t71) {
  !e71.isLeaf || e71.level < f16 || yt3(e71, (e72) => {
    t71 && mt3(e72);
    const i49 = Tt3(e72);
    if (e72.maxLevelDeltaNeighborCount++, i49) {
      let t72 = e72.parent;
      for (; t72; ) {
        const e73 = Tt3(t72);
        if (t72.unmergableChildCount++, !e73) break;
        t72 = t72.parent;
      }
    }
  });
}
function mt3(e71) {
  if (e71.hasPendingUpdate(E33.SPLIT)) return;
  let t71 = e71.parent;
  for (; t71?.resetPendingUpdate(E33.MERGE); ) t71 = t71.parent;
  e71.resetPendingUpdate(E33.MERGE), e71.isLeaf && e71.setPendingUpdate(E33.SPLIT), e71.level < f16 || yt3(e71, (e72) => {
    mt3(e72);
  });
}
function ft3(e71) {
  e71.level < f16 || yt3(e71, (e72) => {
    if (e72.maxLevelDeltaNeighborCount--, 0 === e72.maxLevelDeltaNeighborCount && 0 === e72.unmergableChildCount) {
      let t71 = e72.parent;
      for (; t71 && (t71.unmergableChildCount--, Tt3(t71)); ) t71 = t71.parent;
    }
  });
}
function Tt3(e71) {
  return 0 === e71.maxLevelDeltaNeighborCount && 0 === e71.unmergableChildCount;
}
function yt3(e71, t71) {
  if (e71.level < f16) return;
  const i49 = e71.level - f16, r57 = e71.lij[1] >> f16, s67 = e71.lij[2] >> f16, a59 = (e72) => e72.isLeaf || e72.level === i49;
  for (let n63 = 0; n63 < 4; ++n63) {
    const l47 = e71.findNeighborTile(nn[n63], a59);
    if (!l47 || l47.level !== i49) continue;
    const o60 = l47.lij;
    o60[1] === r57 && o60[2] === s67 || t71(l47);
  }
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ModelDirtySet.js
var a48 = class {
  constructor(e71, t71, o60, r57) {
    this.operation = e71, this.geometry = t71, this.states = o60, this.sync = r57;
  }
};
var n51 = class extends S3 {
  constructor(e71) {
    super(e71), this._residentGeomRecords = /* @__PURE__ */ new Map(), this._dirtyGeomRecords = /* @__PURE__ */ new Map(), this.dirty = false;
  }
  commitLayer(e71, t71) {
    const o60 = this._dirtyGeomRecords.get(e71);
    o60 && (o60.forEach((o61, r57) => {
      const s67 = this._ensureGeomRecord(e71, r57);
      o61.forEach(({
        geometry: e72,
        operation: o62,
        states: a59
      }, n63) => {
        let m45 = false;
        if (o62 === E18.UPDATE) {
          const o63 = s67.get(n63);
          if (o63) {
            if (a59 & I6.TRANSFORMATION) {
              const t72 = this.model.getObject(r57);
              this.model.updateRenderGeometryTransformation(t72, e72, o63) && (m45 = true);
            }
            m45 || t71.updates.push({
              renderGeometry: o63,
              updateType: a59
            });
          } else s14(false, "ModelDirtySet.commitLayer: invalid update");
        }
        if (o62 === E18.REMOVE || m45) {
          const e73 = s67.get(n63);
          e73 ? (t71.removes.push(e73), s67.delete(n63)) : o62 === E18.REMOVE && s14(false, "ModelDirtySet.commitLayer: invalid remove");
        }
        if (o62 === E18.ADD || m45) {
          const o63 = this.model.getObject(r57);
          if (null != o63) {
            const r58 = this.model.getRenderGeometry(o63, e72);
            t71.adds.push(r58), s67.set(n63, r58);
          }
        }
      }), 0 === s67.size && this._residentGeomRecords.get(e71).delete(r57);
    }), 0 === this._residentGeomRecords.get(e71).size && this._residentGeomRecords.delete(e71), this._dirtyGeomRecords.delete(e71), this.dirty = this._hasDirtyGeometryRecords);
  }
  commitSyncUpdates(e71, t71) {
    const o60 = this._dirtyGeomRecords.get(e71);
    o60 && o60.forEach((o61, r57) => {
      const s67 = this._ensureGeomRecord(e71, r57);
      o61.forEach(({
        geometry: e72,
        operation: o62,
        states: a59,
        sync: n63
      }, m45) => {
        let h32 = false;
        if (o62 === E18.UPDATE && n63) {
          const o63 = s67.get(m45);
          if (o63) {
            if (a59 & I6.TRANSFORMATION) {
              const t72 = this.model.getObject(r57);
              this.model.updateRenderGeometryTransformation(t72, e72, o63) && (h32 = true);
            }
            h32 || t71.updates.push({
              renderGeometry: o63,
              updateType: a59
            });
          } else s14(false, "ModelDirtySet.commitSyncUpdates: invalid update");
        }
      });
    });
  }
  getResidentRenderGeometries(e71, t71) {
    const o60 = this._residentGeomRecords.get(e71);
    o60 && o60.forEach((e72) => e72.forEach((e73) => t71.push(e73)));
  }
  _objectStateChanged(e71, t71) {
    for (const o60 of t71.geometries) this._updateOrCreateDirtyRecord(t71, o60, null, E18.UPDATE, e71);
  }
  visibilityChanged(e71) {
    this._objectStateChanged(I6.VISIBILITY, e71);
  }
  highlightChanged(e71) {
    this._objectStateChanged(I6.HIGHLIGHT, e71);
  }
  occlusionChanged(e71) {
    this._objectStateChanged(I6.OCCLUDEE, e71);
  }
  attributesChanged({
    object: e71,
    geometry: t71,
    sync: o60
  }) {
    this._updateOrCreateDirtyRecord(e71, t71, null, E18.UPDATE, I6.GEOMETRY, o60);
  }
  layerAdded(e71) {
    e71.objects.forAll((t71) => this._layerObjectAdded(e71, t71));
  }
  layerRemoved(e71) {
    e71.objects.forAll((t71) => this._layerObjectRemoved(e71, t71));
  }
  layerObjectAdded(e71) {
    this._layerObjectAdded(e71.layer, e71.object);
  }
  _layerObjectAdded(e71, t71) {
    const o60 = e71.id;
    for (const r57 of t71.geometries) this._geometryAdded(t71, r57, o60);
  }
  layerObjectRemoved(e71) {
    this._layerObjectRemoved(e71.layer, e71.object);
  }
  layerObjectsAdded(e71) {
    for (const t71 of e71.objects) this._layerObjectAdded(e71.layer, t71);
  }
  layerObjectsRemoved(e71) {
    for (const t71 of e71.objects) this._layerObjectRemoved(e71.layer, t71);
  }
  _layerObjectRemoved(e71, t71) {
    const o60 = e71.id;
    for (const r57 of t71.geometries) this._geometryRemoved(t71, r57, o60);
  }
  transformationChanged(e71) {
    const t71 = this._getParentLayerId(e71), o60 = e71.id;
    this._ensureGeomRecord(t71, o60).forEach((o61) => {
      this._updateOrCreateDirtyRecord(e71, o61.geometry, t71, E18.UPDATE, I6.TRANSFORMATION);
    });
  }
  shaderTransformationChanged(e71) {
    const t71 = this._getParentLayerId(e71), o60 = e71.id;
    this._ensureGeomRecord(t71, o60).forEach((t72) => {
      t72.objectShaderTransformationChanged(e71.shaderTransformation);
    });
  }
  geometryAdded(e71) {
    this._geometryAdded(e71.object, e71.geometry);
  }
  _geometryAdded(e71, t71, o60 = null) {
    this._updateOrCreateDirtyRecord(e71, t71, o60, E18.ADD);
  }
  geometryRemoved(e71) {
    this._geometryRemoved(e71.object, e71.geometry);
  }
  _geometryRemoved(e71, t71, o60 = null) {
    this._updateOrCreateDirtyRecord(e71, t71, o60, E18.REMOVE);
  }
  _updateOrCreateDirtyRecord(e71, t71, o60, r57, s67 = I6.NONE, n63 = false) {
    o60 = o60 ?? this._getParentLayerId(e71);
    const m45 = e71.id, h32 = t71.id, y27 = this._ensureDirtyRecord(o60, m45), l47 = y27.get(h32);
    let g28 = false;
    if (l47) {
      const e72 = l47.operation;
      e72 === E18.REMOVE && r57 === E18.ADD && l47.states !== I6.NONE ? l47.operation = E18.UPDATE : e72 === E18.REMOVE && r57 === E18.ADD || e72 === E18.ADD && r57 === E18.REMOVE ? (y27.delete(h32), g28 = true) : e72 !== E18.UPDATE || r57 !== E18.REMOVE && r57 !== E18.UPDATE ? (s14((e72 === E18.REMOVE || e72 === E18.ADD) && r57 === E18.UPDATE, "ModelDirtySet.objectGeometryAdded: inconsistent state"), l47.states |= s67) : (l47.operation = r57, l47.states |= s67), l47.sync = l47.sync || n63;
    } else y27.set(h32, new a48(r57, t71, s67, n63));
    this.dirty = !g28 || this._hasDirtyGeometryRecords;
  }
  _ensureGeomRecord(e71, t71) {
    let o60 = this._residentGeomRecords.get(e71);
    o60 || (o60 = /* @__PURE__ */ new Map(), this._residentGeomRecords.set(e71, o60));
    let r57 = o60.get(t71);
    return r57 || (r57 = /* @__PURE__ */ new Map(), o60.set(t71, r57)), r57;
  }
  get _hasDirtyGeometryRecords() {
    for (const e71 of this._dirtyGeomRecords.values()) for (const t71 of e71.values()) if (t71.size > 0) return true;
    return false;
  }
  _ensureDirtyRecord(e71, t71) {
    let o60 = this._dirtyGeomRecords.get(e71);
    o60 || (o60 = /* @__PURE__ */ new Map(), this._dirtyGeomRecords.set(e71, o60));
    let r57 = o60.get(t71);
    return r57 || (r57 = /* @__PURE__ */ new Map(), o60.set(t71, r57)), r57;
  }
  _getParentLayerId(e71) {
    return e71.parentLayer ? e71.parentLayer.id : n4;
  }
  formatDebugInfo() {
    const e71 = ["ADD", "UPD", void 0, "REM"];
    let t71 = "";
    return this._dirtyGeomRecords.forEach((o60, r57) => {
      o60.forEach((o61, s67) => {
        t71.length > 0 && (t71 += "\n"), t71 += r57 + "." + s67;
        const d38 = [];
        o61.forEach((e72) => {
          const t72 = e72.operation;
          d38[t72] || (d38[t72] = []), d38[t72].push(e72.geometry.id);
        });
        for (let r58 = 0; r58 < d38.length; r58++) if (d38[r58]) {
          t71 += " " + e71[r58 - 1] + ": ";
          for (let e72 = 0; e72 < d38[r58].length; e72++) t71 += d38[r58][e72] + ", ";
        }
      });
    }), t71;
  }
  get test() {
  }
};
e6([y2({
  constructOnly: true
})], n51.prototype, "model", void 0), e6([y2()], n51.prototype, "dirty", void 0), n51 = e6([a4("esri.views.3d.webgl-engine.lib.ModelDirtySet")], n51);
var m36 = n51;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/Model.js
var h27 = class extends S3 {
  constructor() {
    super(...arguments), this.dirtySet = new m36({
      model: this
    }), this._content = /* @__PURE__ */ new Map(), this._originFactory = new _13(null);
  }
  getObject(t71) {
    return this._content.get(t71);
  }
  add(t71) {
    const e71 = t71.id;
    s14(!this._content.has(e71), "Model/Stage already contains object to be added"), this._content.set(e71, t71), n32(t71) && this.dirtySet.layerAdded(t71);
  }
  remove(t71) {
    return !!this._content.has(t71.id) && (this._content.delete(t71.id), n32(t71) && this.dirtySet.layerRemoved(t71), true);
  }
  addMany(t71) {
    for (const e71 of t71) e71 && (s14(!this._content.has(e71.id), "Model/Stage already contains object to be added"), this._content.set(e71.id, e71));
  }
  removeMany(t71) {
    for (const e71 of t71) e71 && (s14(this._content.has(e71.id), "Model/Stage doesn't contain object to be removed"), this._content.delete(e71.id));
  }
  has(t71) {
    return this._content.has(t71.id);
  }
  forEachOfType(t71, e71) {
    this._content.forEach((o60) => {
      o60.type === t71 && e71(o60);
    });
  }
  getRenderGeometry(t71, e71) {
    const o60 = new m18(e71, {
      castShadow: t71.castShadow,
      objectShaderTransformation: t71.shaderTransformation
    });
    o60.transformation = t71.getCombinedStaticTransformation(e71, p42);
    const {
      localOrigin: r57
    } = e71;
    return o60.localOrigin = null != r57 ? r57 : this._originFactory.getOrigin(V2(o60.boundingSphere)), o60;
  }
  updateRenderGeometryTransformation(t71, e71, o60) {
    if (null == t71) return false;
    o60.transformation = t71.getCombinedStaticTransformation(e71, p42);
    const r57 = this._originFactory.getOrigin(V2(o60.boundingSphere));
    return o60.localOrigin !== r57;
  }
  getStats() {
    const t71 = {}, e71 = Array.from(this._content.values());
    for (let o60 = 0; o60 < e24.COUNT; ++o60) t71[o60] = e71.filter((t72) => t72.type === o60).length;
    return {
      contentTypes: t71,
      dirtySet: this.dirtySet.formatDebugInfo()
    };
  }
  get test() {
  }
};
e6([y2({
  constructOnly: true
})], h27.prototype, "dirtySet", void 0), h27 = e6([a4("esri.views.3d.webgl-engine.parts.Model")], h27);
var p42 = e15();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded.js
var t62 = class {
  constructor(t71) {
    this._totalCount = t71, this._componentCountCache = -1, this._indexRanges = [0, t71];
  }
  allVisible() {
    return this.componentCount === this._totalCount;
  }
  allInvisible() {
    return 0 === this._indexRanges.length;
  }
  isVisible(t71) {
    if (t71 < 0 || t71 >= this._totalCount) return false;
    if (this.allVisible()) return true;
    {
      const n63 = this._indexRanges;
      let e71 = 0, o60 = n63.length / 2;
      if (t71 < n63[2 * e71] || t71 > n63[2 * o60] + n63[2 * o60 + 1]) return false;
      for (; o60 - e71 > 0; ) {
        const s67 = Math.floor(0.5 * (e71 + o60)), i49 = n63[2 * s67];
        if (t71 < i49) {
          if (o60 - e71 == 1) return false;
          o60 = s67;
          continue;
        }
        if (t71 < i49 + n63[2 * s67 + 1]) return true;
        if (o60 - e71 == 1) return false;
        e71 = s67 + 1;
      }
      return false;
    }
  }
  get componentCount() {
    if (-1 === this._componentCountCache) {
      const t71 = this._indexRanges;
      let n63 = 0;
      for (let e71 = 0; e71 < t71.length; e71 += 2) n63 += t71[e71 + 1];
      this._componentCountCache = n63;
    }
    return this._componentCountCache;
  }
  reset(t71) {
    "all" === t71 || t71.length === this._totalCount ? this._indexRanges = [0, this._totalCount] : this._indexRanges = n52(t71), this._componentCountCache = -1;
  }
  forEachComponent(t71) {
    const n63 = this._indexRanges;
    for (let e71 = 0; e71 < n63.length; e71 += 2) {
      const o60 = n63[e71], s67 = o60 + n63[e71 + 1];
      for (let n64 = o60; n64 < s67; n64++) if (!t71(n64)) return false;
    }
    return true;
  }
  forEachComponentRange(t71) {
    const n63 = this._indexRanges;
    for (let e71 = 0; e71 < n63.length; e71 += 2) {
      const o60 = n63[e71];
      if (!t71(o60, o60 + n63[e71 + 1])) return false;
    }
    return true;
  }
  computeOffsetRanges(t71) {
    const n63 = new Array(this._indexRanges.length), e71 = this._indexRanges;
    for (let o60 = 0; o60 < e71.length; o60 += 2) {
      const s67 = e71[o60], i49 = s67 + e71[o60 + 1], r57 = t71[s67], h32 = t71[i49];
      n63[o60] = r57, n63[o60 + 1] = h32 - r57;
    }
    return n63;
  }
};
function n52(t71) {
  const n63 = new Array();
  if (0 === t71.length) return n63;
  let e71 = t71[0], o60 = 1;
  for (let s67 = 1; s67 < t71.length; s67++) {
    const i49 = t71[s67];
    e71 + o60 === i49 ? o60 += 1 : (n63.push(e71), n63.push(o60), e71 = i49, o60 = 1);
  }
  return n63.push(e71), n63.push(o60), n63;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentData.js
var e59 = class {
  constructor(e71, h32) {
    this.offsets = h32, this.pickability = null, this.highlightCounts = null, this.verticalOffsets = null, this.cachedGeometryRanges = null, this.cachedHighlightRanges = null, this.cachedDefaultRanges = null;
    const i49 = this.count;
    this.visibility = new t62(i49), this.materialDataBuffer = e71.getBuffer(i49), this.materialDataIndices = new Uint16Array(i49);
    for (let t71 = 0; t71 < i49; t71++) this.materialDataIndices[t71] = this.materialDataBuffer.acquireIndex();
  }
  destroy() {
    for (let t71 = 0; t71 < this.count; t71++) this.materialDataBuffer.releaseIndex(this.materialDataIndices[t71]);
  }
  get count() {
    return this.offsets.length - 1;
  }
  get geometryRanges() {
    return null == this.cachedGeometryRanges && (this.cachedGeometryRanges = this.visibility.computeOffsetRanges(this.offsets)), this.cachedGeometryRanges;
  }
  get highlightRanges() {
    return null == this.highlightCounts ? null : (this._updateCachedHighlightRanges(), this.cachedHighlightRanges);
  }
  get defaultShadowMapRanges() {
    return null == this.highlightCounts ? this.geometryRanges : (this._updateCachedHighlightRanges(), this.cachedDefaultRanges);
  }
  highlightsDirty() {
    this.cachedHighlightRanges = null, this.cachedDefaultRanges = null;
  }
  visibilityDirty() {
    this.cachedGeometryRanges = null, this.highlightsDirty();
  }
  _updateCachedHighlightRanges() {
    if ((null == this.cachedHighlightRanges || null == this.cachedDefaultRanges) && null != this.highlightCounts) {
      const {
        highlightRanges: t71,
        defaultRanges: e71
      } = h28(this.highlightCounts, this.visibility, this.offsets);
      this.cachedHighlightRanges = t71, this.cachedDefaultRanges = e71;
    }
  }
};
function h28(t71, e71, h32) {
  const i49 = [], s67 = [];
  let a59 = h32.length, n63 = h32.length;
  return e71.forEachComponent((e72) => (t71[e72] > 0 ? (a59 !== e72 - 1 && (i49.length && i49.push(h32[a59 + 1] - i49[i49.length - 1]), i49.push(h32[e72])), a59 = e72) : (n63 !== e72 - 1 && (s67.length && s67.push(h32[n63 + 1] - s67[s67.length - 1]), s67.push(h32[e72])), n63 = e72), true)), i49.length && i49.push(h32[a59 + 1] - i49[i49.length - 1]), s67.length && s67.push(h32[n63 + 1] - s67[s67.length - 1]), {
    highlightRanges: i49,
    defaultRanges: s67
  };
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentObject.js
var e60 = class {
  constructor(t71, e71, s67, i49, o60, r57) {
    this.transform = t71, this.toMapSpace = e71, this.obb = s67, this.components = i49, this.renderable = o60, this.intersectionGeometry = r57, this.visible = false, this.offsetObb = null;
  }
  destroy() {
    this.intersectionGeometry = u(this.intersectionGeometry), this.renderable = u(this.renderable), this.components = u(this.components);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/triangleIntersectionUtils.js
function w20(n63, t71, r57, o60, c44, s67, u46) {
  const e71 = s67 - u46, i49 = t71 - n63, a59 = new Float64Array(4 * i49);
  for (let f46 = 0; f46 < i49; ++f46) {
    const t72 = 3 * (f46 + n63), s68 = c44 * r57[t72 + 0], i50 = o60[s68 + 0], m45 = o60[s68 + 1], h32 = e71 / (o60[s68 + 2] - u46), l47 = i50 * h32, M18 = m45 * h32, x26 = c44 * r57[t72 + 1], y27 = o60[x26 + 0], A32 = o60[x26 + 1], b25 = e71 / (o60[x26 + 2] - u46), p49 = y27 * b25, w24 = A32 * b25, F18 = c44 * r57[t72 + 2], U23 = o60[F18 + 0], d38 = o60[F18 + 1], g28 = e71 / (o60[F18 + 2] - u46), j21 = U23 * g28, v28 = d38 * g28, k23 = 4 * f46;
    a59[k23 + 0] = Math.min(l47, p49, j21), a59[k23 + 1] = Math.min(M18, w24, v28), a59[k23 + 2] = Math.max(l47, p49, j21), a59[k23 + 3] = Math.max(M18, w24, v28);
  }
  return a59;
}
function F13(n63, t71, r57, o60, c44) {
  const s67 = t71 - n63, u46 = new Float64Array(4 * s67);
  for (let e71 = 0; e71 < s67; ++e71) {
    const t72 = 3 * (e71 + n63), s68 = c44 * r57[t72 + 0], i49 = o60[s68 + 0], a59 = o60[s68 + 1], f46 = c44 * r57[t72 + 1], m45 = o60[f46 + 0], h32 = o60[f46 + 1], l47 = c44 * r57[t72 + 2], M18 = o60[l47 + 0], x26 = o60[l47 + 1], y27 = 4 * e71;
    u46[y27 + 0] = Math.min(i49, m45, M18), u46[y27 + 1] = Math.min(a59, h32, x26), u46[y27 + 2] = Math.max(i49, m45, M18), u46[y27 + 3] = Math.max(a59, h32, x26);
  }
  return u46;
}
function U20(n63, t71) {
  return new (d35(n63))(t71);
}
function d35(n63) {
  return n63 < 128 ? Uint8Array : n63 < 32768 ? Uint16Array : n63 < 1 << 31 ? Uint32Array : Array;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ElevationAgnosticBVH.js
var i43 = class {
  constructor(t71, n63) {
    this.elementCount = t71, this.model = n63, this._elementIndexMap = null, this._bspNodes = [], this._generatedBVH = false, this.localMode = n63.localMode, this.planetCenterZ = n63.planetCenterZ, this.geometryMinZ = n63.geometryMinZ, this.planetCenter = r4(0, 0, this.planetCenterZ), this.maxBspNodeDepth = n63.maxBspNodeDepth ?? 8, this.minElementCountForBVH = n63.minElementCountForBVH ?? 15, this.minBspNodeElementCount = n63.minBspNodeElementCount ?? 5;
  }
  get elementIndexMap() {
    return this._ensureBVH(), this._elementIndexMap;
  }
  get _skipBVH() {
    return this.elementCount < this.minElementCountForBVH || this.geometryMinZ < 0.5 * this.planetCenterZ;
  }
  _ensureBVH() {
    this._generatedBVH || this._skipBVH || 0 === this._bspNodes.length && this._generateBsp();
  }
  intersectRay(t71, e71, n63) {
    this.elementCount < 1 || (this._skipBVH ? this._intersectRayWithoutBVH(n63) : this._intersectRayWithBVH(t71, e71, n63));
  }
  _intersectRayWithoutBVH(t71) {
    this._intersectRange(0, this.elementCount);
  }
  _intersectRange(t71, e71) {
    this.model.intersectRange(t71, e71);
  }
  _intersectRayWithBVH(t71, e71, n63) {
    this._ensureBVH(), n63 ? this._intersectGeometryWithBVHVerticalRay(t71) : this._intersectGeometryWithBVHGeneralRay(t71, e71);
  }
  _intersectGeometryWithBVHVerticalRay(t71) {
    let e71 = t71[0], n63 = t71[1];
    if (!this.localMode) {
      const {
        geometryMinZ: i50,
        planetCenterZ: s68
      } = this, h32 = (i50 - s68) / (t71[2] - s68);
      e71 = t71[0] * h32, n63 = t71[1] * h32;
    }
    const {
      _bspNodes: i49
    } = this;
    let s67 = 0;
    for (; s67 >= 0; ) {
      const t72 = i49[s67], {
        d: h32,
        dim: a59,
        minIndexIndex: o60,
        minMidIndexIndex: r57,
        maxMidIndexIndex: c44,
        maxIndexIndex: m45,
        aabb2D: l47
      } = t72;
      if (e71 < l47[0] || e71 > l47[2] || n63 < l47[1] || n63 > l47[3]) break;
      if (-1 === a59 || -1 === t72.child0 && -1 === t72.child1) {
        this._intersectRange(o60, m45);
        break;
      }
      {
        this._intersectRange(r57, c44);
        const i50 = (0 === a59 ? e71 : n63) - h32;
        if (i50 < 0) {
          if (-1 === t72.child0) {
            this._intersectRange(o60, r57);
            break;
          }
          s67 = t72.child0;
        } else {
          if (!(i50 > 0)) break;
          if (-1 === t72.child1) {
            this._intersectRange(c44, m45);
            break;
          }
          s67 = t72.child1;
        }
      }
    }
  }
  _intersectGeometryWithBVHGeneralRay(e71, n63) {
    let i49 = e71[0], s67 = e71[1], h32 = n63[0], a59 = n63[1];
    const {
      geometryMinZ: o60
    } = this;
    if (!this.localMode) {
      let t71 = 0, r58 = 1;
      const c45 = Math.min(0.5 * this.planetCenterZ, o60), m46 = e71[2], l48 = n63[2];
      if (m46 < c45 && l48 < c45) return;
      if (m46 < c45 && (t71 = (c45 - m46) / (l48 - m46)), l48 < c45 && (r58 = (c45 - m46) / (l48 - m46)), t71 > r58) return;
      const d39 = (1 - t71) * e71[0] + t71 * n63[0], M19 = (1 - t71) * e71[1] + t71 * n63[1], x26 = (1 - t71) * e71[2] + t71 * n63[2], u46 = (1 - r58) * e71[0] + r58 * n63[0], p49 = (1 - r58) * e71[1] + r58 * n63[1], f46 = (1 - r58) * e71[2] + r58 * n63[2], {
        planetCenterZ: _30
      } = this, g28 = o60 - _30, I25 = g28 / (x26 - _30);
      i49 = d39 * I25, s67 = M19 * I25;
      const B17 = g28 / (f46 - _30);
      h32 = u46 * B17, a59 = p49 * B17;
    }
    const r57 = h32 - i49, c44 = a59 - s67, m45 = this._bspNodes;
    let l47 = 1;
    {
      const {
        aabb2D: t71
      } = m45[0], e72 = (t72, e73, n65, i50) => {
        if (Math.abs(e73) < 1e-5 * Math.max(i50 - n65, 1)) return false;
        const s68 = e73 > 0, h34 = s68 ? i50 : n65, a60 = t72 + l47 * e73;
        return (s68 ? a60 < h34 : a60 > h34) && (l47 = Math.max((h34 - t72) / e73, l47), true);
      }, n64 = () => e72(i49, r57, t71[0], t71[2]), h33 = () => e72(s67, c44, t71[1], t71[3]);
      Math.abs(r57) >= Math.abs(c44) ? n64() || h33() : h33() || n64();
    }
    const d38 = [0, 0, l47];
    let M18 = 0;
    for (; M18 < d38.length; ) {
      const e72 = d38[M18];
      let n64 = d38[M18 + 1], h33 = d38[M18 + 2];
      if (M18 += 3, n64 > h33) continue;
      const a60 = m45[e72], {
        minIndexIndex: o61,
        maxIndexIndex: x26
      } = a60, {
        child0: u46,
        child1: p49,
        minMidIndexIndex: f46,
        maxMidIndexIndex: _30,
        aabb2D: g28,
        d: I25,
        dim: B17
      } = a60;
      {
        const t71 = i49 + n64 * r57, e73 = i49 + h33 * r57, s68 = Math.min(t71, e73), a61 = Math.max(t71, e73), o62 = g28[0], c45 = g28[2];
        if (a61 < o62 || c45 < s68) continue;
        if (s68 < o62) {
          const t72 = (o62 - i49) / r57;
          r57 > 0 ? n64 = Math.max(n64, t72) : h33 = Math.min(h33, t72);
        }
        if (c45 < a61) {
          const t72 = (c45 - i49) / r57;
          r57 > 0 ? h33 = Math.min(h33, t72) : n64 = Math.max(n64, t72);
        }
      }
      {
        const t71 = s67 + n64 * c44, e73 = s67 + h33 * c44, i50 = Math.min(t71, e73), a61 = Math.max(t71, e73), o62 = g28[1], r58 = g28[3];
        if (a61 < o62 || r58 < i50) continue;
        if (i50 < o62) {
          const t72 = (o62 - s67) / c44;
          c44 > 0 ? n64 = Math.max(n64, t72) : h33 = Math.min(h33, t72);
        }
        if (r58 < a61) {
          const t72 = (r58 - s67) / c44;
          c44 > 0 ? h33 = Math.min(h33, t72) : n64 = Math.max(n64, t72);
        }
      }
      if (-1 === u46 && -1 === p49) this._intersectRange(o61, x26);
      else {
        const e73 = 0 === B17 ? i49 : s67, a61 = 0 === B17 ? r57 : c44, m46 = e73 + n64 * a61, M19 = e73 + h33 * a61, g29 = Math.min(m46, M19), b25 = Math.max(m46, M19), V19 = e12((I25 - e73) / a61, 0, l47);
        o61 < f46 && g29 <= I25 && (-1 !== u46 ? (d38.push(u46), d38.push(a61 >= 0 ? n64 : Math.max(n64, V19)), d38.push(a61 >= 0 ? Math.min(h33, V19) : h33)) : this._intersectRange(o61, f46)), this._intersectRange(f46, _30), _30 < x26 && I25 <= b25 && (-1 !== p49 ? (d38.push(p49), d38.push(a61 >= 0 ? Math.max(n64, V19) : n64), d38.push(a61 >= 0 ? h33 : Math.min(h33, V19))) : this._intersectRange(_30, x26));
      }
    }
  }
  _generateBsp() {
    const {
      elementCount: t71
    } = this;
    if (t71 < 1) return;
    const e71 = U20(t71, t71);
    this._elementIndexMap = e71;
    for (let n63 = 0; n63 < t71; ++n63) e71[n63] = n63;
    const i49 = this.model.getAabbs2D();
    let o60 = 0;
    const m45 = this._bspNodes;
    m45.length = 0;
    const {
      localMode: l47
    } = this;
    let d38 = false;
    if (!l47) {
      const {
        planetCenterZ: t72,
        geometryMinZ: e72
      } = this;
      d38 = t72 >= 0 || e72 < 0.5 * t72;
    }
    const M18 = [], x26 = (t72, e72, n63, i50, s67) => {
      M18.push(t72), M18.push(e72), M18.push(n63), M18.push(i50 < 0 ? -1 : (s67 ? 0 : 1) + 2 * i50);
    }, {
      maxBspNodeDepth: u46,
      minBspNodeElementCount: p49
    } = this, f46 = (t72, n63, o61, M19, f47) => {
      const _30 = m45.length;
      if (_30 > 0 && (d38 || o61 >= u46 || n63 - t72 < p49)) return;
      const g28 = [0, 0, 0, 0];
      r50(g28, t72, n63, e71, i49);
      const {
        d: I25,
        dim: B17
      } = l47 ? s59(g28) : h29(g28), {
        rangeMidStart: b25,
        rangeMidEnd: V19
      } = a49(t72, n63, B17, I25, e71, i49), C25 = o61 === u46 - 1, H23 = !C25 && b25 >= t72 + p49, R17 = !C25 && n63 >= V19 + p49;
      if (H23 || R17 || 0 === _30) {
        const e72 = new c40(t72, b25, V19, n63, B17, I25, g28);
        if (H23 && x26(t72, b25, o61 + 1, _30, true), R17 && x26(V19, n63, o61 + 1, _30, false), m45.push(e72), -1 !== M19) {
          const t73 = m45[M19];
          f47 ? t73.child0 = _30 : t73.child1 = _30;
        }
      }
    };
    for (x26(0, t71, 0, -1, false); o60 < M18.length; ) {
      const t72 = M18[o60], e72 = M18[o60 + 1], n63 = M18[o60 + 2], i50 = M18[o60 + 3];
      o60 += 4;
      const s67 = i50 >> 1;
      f46(t72, e72, n63, s67, i50 - (s67 << 1) == 0);
    }
    this._generatedBVH = true;
  }
};
function s59(t71) {
  const e71 = t71[0], n63 = t71[1], i49 = t71[2], s67 = t71[3];
  let h32, a59;
  return i49 - e71 >= s67 - n63 ? (a59 = 0.5 * (e71 + i49), h32 = 0) : (a59 = 0.5 * (n63 + s67), h32 = 1), {
    d: a59,
    dim: h32
  };
}
function h29(t71) {
  const e71 = t71[0], n63 = t71[1], i49 = t71[2], s67 = t71[3];
  let h32, a59;
  return i49 - e71 >= s67 - n63 ? (h32 = 0, a59 = 0.5 * (e71 + i49)) : (h32 = 1, a59 = 0.5 * (n63 + s67)), {
    dim: h32,
    d: a59
  };
}
function a49(t71, e71, n63, i49, s67, h32) {
  let a59 = t71;
  {
    let t72 = e71;
    for (; a59 < t72; ) {
      const e72 = s67[a59];
      o52(e72, n63, i49, h32) < 0 ? ++a59 : (--t72, s67[a59] = s67[t72], s67[t72] = e72);
    }
  }
  const r57 = a59;
  let c44 = a59, m45 = e71;
  for (; c44 < m45; ) {
    const t72 = s67[m45 - 1];
    o52(t72, n63, i49, h32) > 0 ? --m45 : (s67[m45 - 1] = s67[c44], s67[c44] = t72, ++c44);
  }
  return {
    rangeMidStart: r57,
    rangeMidEnd: m45
  };
}
function o52(t71, e71, n63, i49) {
  const s67 = 4 * t71, h32 = i49[s67 + 0 + e71];
  return i49[s67 + 2 + e71] < n63 ? -1 : h32 > n63 ? 1 : 0;
}
function r50(t71, e71, n63, i49, s67) {
  let h32 = 1 / 0, a59 = 1 / 0, o60 = -1 / 0, r57 = -1 / 0;
  for (let c44 = e71; c44 < n63; ++c44) {
    const t72 = 4 * i49[c44];
    h32 = Math.min(h32, s67[t72 + 0]), a59 = Math.min(a59, s67[t72 + 1]), o60 = Math.max(o60, s67[t72 + 2]), r57 = Math.max(r57, s67[t72 + 3]);
  }
  t71[0] = h32, t71[1] = a59, t71[2] = o60, t71[3] = r57;
}
var c40 = class {
  constructor(t71, e71, n63, i49, s67, h32, a59) {
    this.minIndexIndex = t71, this.minMidIndexIndex = e71, this.maxMidIndexIndex = n63, this.maxIndexIndex = i49, this.dim = s67, this.d = h32, this.aabb2D = a59, this.child0 = -1, this.child1 = -1;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentObjectElevationAgnosticComponentGeometryBVH.js
var l41 = class {
  constructor(t71, e71, r57, a59, n63, h32, l47, o60, c44) {
    this.componentIndex = t71, this.vertexData = e71, this.vertexStride = r57, this.indexData = a59, this.startTriangleNumber = n63, this.endTriangleNumber = h32, this.geometryMinZ = l47, this.planetCenterZ = o60, this.localMode = c44, this.maxBspNodeDepth = 8, this.minElementCountForBVH = 20, this.minBspNodeElementCount = 10, this.rayDirection = n7(), this.ray0 = n7(), this.isVerticalRay = false, this._triangleHitCallback = m37, this.totalElevationOffset = 0, this.normalRequired = false, this._bvh = new i43(h32 - n63, this);
  }
  getAabbs2D() {
    return this.localMode ? F13(this.startTriangleNumber, this.endTriangleNumber, this.indexData, this.vertexData, this.vertexStride) : w20(this.startTriangleNumber, this.endTriangleNumber, this.indexData, this.vertexData, this.vertexStride, this.geometryMinZ, this.planetCenterZ);
  }
  get numTriangles() {
    return this.endTriangleNumber - this.startTriangleNumber;
  }
  intersectRay(i49, s67, r57, a59, n63, h32) {
    r5(this.ray0, i49), K(this.rayDirection, s67, i49), this.isVerticalRay = r57, this.totalElevationOffset = a59, this.normalRequired = h32, this._triangleHitCallback = n63, this._bvh.intersectRay(i49, s67, r57), this._triangleHitCallback = m37;
  }
  intersectRange(t71, e71) {
    const i49 = this._bvh.elementIndexMap;
    o53(this.ray0, this.rayDirection, t71, e71, this.indexData, this.vertexData, this.vertexStride, this.totalElevationOffset, this.planetCenterZ, this.normalRequired, this._triangleHitCallback, i49, this.startTriangleNumber);
  }
  getTriangleElevationOffset(t71) {
    return this.totalElevationOffset;
  }
};
function o53(t71, e71, i49, s67, n63, h32, l47, o60, m45, c44, g28, u46 = null, b25 = 0) {
  0 !== o60 ? y5(t71, e71, i49, s67, n63, h32, l47, o60, m45, c44, g28, u46, b25) : g7(t71, e71, i49, s67, n63, h32, l47, c44, g28, u46, b25);
}
function m37() {
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ComponentUtils.js
function n53(n63, i49, e71, s67) {
  if (e71 >= i49) return n63;
  null == n63 && (n63 = r51());
  const a59 = n63.isVisibleBit;
  let l47 = n63.data;
  const c44 = u38(l47), f46 = e71 / c44 | 0, h32 = e71 - c44 * f46, B17 = (i49 - 1) / c44 | 0, E37 = l47, b25 = s67 === a59;
  if (!(e71 < E37.length * c44) && b25) {
    const n64 = f46 + 1, i50 = Math.ceil(E37.length * t), r57 = B17 + 1;
    let e72 = Math.max(n64, i50);
    e72 = Math.min(e72, r57), l47 = new Uint32Array(e72), l47.set(E37);
  }
  return f46 < l47.length && (l47[f46] = o54(l47[f46], h32, b25)), n63.data = l47, n63;
}
function i44(t71, n63) {
  if (null == t71) return true;
  const {
    isVisibleBit: i49,
    data: r57
  } = t71, o60 = u38(r57);
  return n63 < r57.length * o60 ? e61(i49, r57, n63, o60) : !t71.isVisibleBit;
}
function r51(t71 = true) {
  return {
    isVisibleBit: !t71,
    data: new Uint32Array(0)
  };
}
function e61(t71, n63, i49, r57) {
  const e71 = i49 / r57 | 0, u46 = i49 - e71 * r57;
  return s60(n63[e71], u46) === t71;
}
function u38(t71) {
  const n63 = 8;
  return t71.BYTES_PER_ELEMENT * n63;
}
function o54(t71, n63, i49) {
  return t71 & ~(1 << n63) | (i49 ? 1 : 0) << n63;
}
function s60(t71, n63) {
  return !!(t71 & 1 << n63);
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentObjectElevationAgnosticComponentBVH.js
var m38 = class {
  constructor(t71, e71, o60, s67, i49, a59, c44, l47) {
    this.vertexData = t71, this.vertexStride = e71, this.indexData = o60, this._components = s67, this._componentAabbs3D = i49, this.geometryMinZ = a59, this.planetCenterZ = c44, this.localMode = l47, this.maxBspNodeDepth = 6, this.minElementCountForBVH = 10, this.minBspNodeElementCount = 3, this._ray0 = f38, this._ray1 = u39, this._invDir = n7(), this._componentVerticalOffsets = null, this._verticalOffset = null, this._tolerance = 0, this._intersectionOptions = D11, this._callback = y24, this.rayDirectionC = n7(), this._componentIndexMap = null, this._bvh = new i43(s67.count, this), this.componentIntersectionData = new Array(s67.count);
  }
  get numComponents() {
    return this._components.count;
  }
  get minZGlobal() {
    return this.geometryMinZ - this.planetCenterZ;
  }
  getAabbs2D() {
    return this.localMode ? this.getAabbs2DLocal() : this.getAabbs2DGlobal();
  }
  getAabbs2DGlobal() {
    const {
      numComponents: t71,
      planetCenterZ: e71,
      minZGlobal: n63
    } = this, o60 = new Float64Array(4 * t71), s67 = this._componentAabbs3D;
    for (let i49 = 0; i49 < t71; ++i49) {
      const t72 = 6 * i49, r57 = s67[t72 + 0], a59 = s67[t72 + 1], c44 = s67[t72 + 2], l47 = s67[t72 + 3], h32 = s67[t72 + 4], m45 = n63 / (c44 - e71), p49 = n63 / (s67[t72 + 5] - e71), _30 = Math.min(r57 * m45, r57 * p49), b25 = Math.min(a59 * m45, a59 * p49), f46 = Math.max(l47 * m45, l47 * p49), u46 = Math.max(h32 * m45, h32 * p49), y27 = 4 * i49;
      o60[y27 + 0] = _30, o60[y27 + 1] = b25, o60[y27 + 2] = f46, o60[y27 + 3] = u46;
    }
    return o60;
  }
  getAabbs2DLocal() {
    const {
      numComponents: t71
    } = this, e71 = new Float64Array(4 * t71), n63 = this._componentAabbs3D;
    for (let o60 = 0; o60 < t71; ++o60) {
      const t72 = 6 * o60, s67 = n63[t72 + 0], i49 = n63[t72 + 1], r57 = n63[t72 + 3], a59 = n63[t72 + 4], c44 = 4 * o60;
      e71[c44 + 0] = s67, e71[c44 + 1] = i49, e71[c44 + 2] = r57, e71[c44 + 3] = a59;
    }
    return e71;
  }
  intersectRay(t71, e71, n63, o60, s67, i49, r57) {
    const {
      isVerticalRay: a59
    } = r57;
    this._ray0 = t71, this._ray1 = e71, this._componentVerticalOffsets = n63, this._verticalOffset = o60, this._tolerance = i49, this._intersectionOptions = r57, this._componentIndexMap = this._bvh.elementIndexMap, B4(t71, e71, this._invDir), this._callback = s67, this._bvh.intersectRay(t71, e71, a59), this._callback = y24;
  }
  intersectRange(t71, e71) {
    const n63 = this._componentIndexMap, o60 = this._components, s67 = o60.pickability, i49 = o60.visibility;
    for (let r57 = t71; r57 < e71; ++r57) {
      const t72 = n63 ? n63[r57] : r57;
      i44(s67, t72) && i49.isVisible(t72) && this._intersectComponent(t72);
    }
  }
  getComponentTriangleCount(t71) {
    const e71 = this._components.offsets, n63 = e71[t71] / 3;
    return e71[t71 + 1] / 3 - n63;
  }
  getComponentAabb3D(t71, e71) {
    const n63 = this._componentAabbs3D, o60 = 6 * t71;
    return e71[0] = n63[o60], e71[1] = n63[o60 + 1], e71[2] = n63[o60 + 2], e71[3] = n63[o60 + 3], e71[4] = n63[o60 + 4], e71[5] = n63[o60 + 5], e71;
  }
  _intersectComponent(n63) {
    if (!i44(this._components.pickability, n63)) return;
    const o60 = this.getComponentAabb3D(n63, p43);
    let r57 = false;
    const {
      localMode: c44,
      _componentVerticalOffsets: h32,
      _verticalOffset: m45,
      _ray0: f46,
      _ray1: u46,
      _invDir: y27,
      planetCenterZ: D15,
      _tolerance: C25,
      rayDirectionC: v28,
      componentIntersectionData: A32
    } = this, {
      isVerticalRay: x26
    } = this._intersectionOptions, d38 = this._components.offsets, M18 = r5(_25, f46), O34 = r5(b21, u46), V19 = h32?.[n63] ?? 0, Z11 = V19 + (m45?.offset ?? 0);
    if (0 !== Z11 && (c44 ? (M18[2] = f46[2] - Z11, O34[2] = u46[2] - Z11, r57 = true) : null != m45 && (m45.componentOffset = V19)), null == m45 || r57 || 0 === Z11 || m45.applyToAabb(o60), !k4(o60, M18, y27, C25)) return;
    K(v28, O34, M18);
    const j21 = d38[n63] / 3, R17 = d38[n63 + 1] / 3, k23 = R17 - j21, B17 = (t71, e71, o61) => {
      this._callback(t71, e71, n63, o61);
    }, {
      vertexData: I25,
      vertexStride: w24,
      indexData: G17,
      _intersectionOptions: E37
    } = this, {
      normalRequired: F18
    } = E37;
    if (k23 > g24) {
      let t71 = A32[n63];
      null == t71 && (t71 = new l41(n63, I25, w24, G17, j21, R17, this.geometryMinZ, D15, c44), A32[n63] = t71), t71.intersectRay(M18, O34, x26, r57 ? 0 : Z11, B17, F18);
    } else {
      o53(M18, v28, j21, R17, G17, I25, w24, r57 ? 0 : Z11, D15, F18, B17);
    }
  }
};
var p43 = i3();
var _25 = n7();
var b21 = n7();
var f38 = n7();
var u39 = n7();
var y24 = () => {
};
var D11 = new m13();
var g24 = 40;

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/IntersectionGeometry.js
var b22 = class {
  constructor(t71, s67, e71) {
    this.viewingMode = t71, this.positionData = s67, this._components = e71, this.verticalOffset = null, this.componentVerticalOffsets = null, this._planetCenter = n7(), this._componentBvh = null, this._aabb = [0, 0, 0, 0, 0, 0], this._indices = s67.indices ? t9(s67.indices) : l10(s67.positions.length / 3), this._positions = s67.positions;
  }
  destroy() {
    this._positions = null, this._indices = null, this._perComponentAabbs = null, this._componentBvh = null;
  }
  getComponentAabb(t71, s67) {
    const e71 = this._ensureComponentAabbs(), n63 = 6 * t71;
    return s67[0] = e71[n63], s67[1] = e71[n63 + 1], s67[2] = e71[n63 + 2], s67[3] = e71[n63 + 3], s67[4] = e71[n63 + 4], s67[5] = e71[n63 + 5], s67;
  }
  getComponentAabbs() {
    return this._ensureComponentAabbs();
  }
  _ensureComponentAabbs() {
    return this._perComponentAabbs || (this._perComponentAabbs = this._computePerComponentAabbs()), this._perComponentAabbs;
  }
  getComponentPositions(t71, s67) {
    s67.indices = this._indices, s67.data = this._positions, s67.stride = 3, s67.startIndex = this._components.offsets[t71], s67.endIndex = this._components.offsets[t71 + 1];
  }
  intersect(e71, a59, r57, h32, m45, c44, b25, d38) {
    this.verticalOffset = h32, this.componentVerticalOffsets = m45;
    const {
      position: C25
    } = c44, M18 = K(l42, e71, C25), A32 = K(_26, a59, C25), v28 = s12(u40, c44.rotationScale);
    S4(M18, M18, v28), S4(A32, A32, v28);
    const x26 = u8(g25, v28);
    if (this.viewingMode === l9.Global) {
      const t71 = this._planetCenter;
      j2(t71, C25), S4(t71, t71, v28);
    }
    const j21 = (t71, s67, e72, n63) => {
      d38(e72, t71, n63 ? S4(f39, n63, x26) : null, s67);
    };
    this._intersectComponents(M18, A32, m45, h32, j21, r57, b25);
  }
  _computePerComponentAabbs() {
    const t71 = this._aabb, s67 = 0.5 * (t71[0] + t71[3]), e71 = 0.5 * (t71[1] + t71[4]), n63 = 0.5 * (t71[2] + t71[5]), i49 = this._components.count, o60 = t10(6 * i49), a59 = this._indices, h32 = this._positions, m45 = this._components.offsets;
    let p49 = 0, c44 = 1 / 0, b25 = 1 / 0, l47 = 1 / 0, _30 = -1 / 0, u46 = -1 / 0, f46 = -1 / 0;
    for (let r57 = 0; r57 < i49; r57++) {
      const t72 = m45[r57], i50 = m45[r57 + 1];
      let g28 = 1 / 0, d38 = 1 / 0, C25 = 1 / 0, M18 = -1 / 0, A32 = -1 / 0, v28 = -1 / 0;
      if (t72 < i50) for (let s68 = t72; s68 < i50; s68++) {
        const t73 = 3 * a59[s68], e72 = h32[t73], n64 = h32[t73 + 1], i51 = h32[t73 + 2];
        g28 = Math.min(g28, e72), d38 = Math.min(d38, n64), C25 = Math.min(C25, i51), M18 = Math.max(M18, e72), A32 = Math.max(A32, n64), v28 = Math.max(v28, i51);
      }
      else g28 = s67, d38 = e71, C25 = n63, M18 = s67, A32 = e71, v28 = n63;
      o60[p49++] = g28, o60[p49++] = d38, o60[p49++] = C25, o60[p49++] = M18, o60[p49++] = A32, o60[p49++] = v28, c44 = Math.min(c44, g28), b25 = Math.min(b25, d38), l47 = Math.min(l47, C25), _30 = Math.max(_30, M18), u46 = Math.max(u46, A32), f46 = Math.max(f46, v28);
    }
    return this._aabb[0] = c44, this._aabb[1] = b25, this._aabb[2] = l47, this._aabb[3] = _30, this._aabb[4] = u46, this._aabb[5] = f46, o60;
  }
  _intersectComponents(t71, s67, e71, n63, i49, o60, a59) {
    let r57 = this._componentBvh;
    null == r57 && (r57 = new m38(this._positions, 3, this._indices, this._components, this._ensureComponentAabbs(), this.geometryMinZ, this.planetCenterZ, this.localMode), this._componentBvh = r57), r57.intersectRay(t71, s67, e71, n63, i49, o60, a59);
  }
  get geometryMinZ() {
    return this._aabb[2];
  }
  get planetCenterZ() {
    return this._planetCenter[2];
  }
  get numTriangles() {
    return this._indices.length / 3;
  }
  get localMode() {
    return this.viewingMode === l9.Local;
  }
  get positions() {
    return this._positions;
  }
  get indices() {
    return this._indices;
  }
  get aabb() {
    return this._ensureComponentAabbs(), this._aabb;
  }
};
var l42 = n7();
var _26 = n7();
var u40 = e16();
var f39 = n7();
var g25 = e16();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/Renderable.js
var t63 = class {
  constructor(t71, s67, e71) {
    this.material = t71, this.geometry = s67, this.meta = e71;
  }
  destroy() {
    this.material.dispose(), this.geometry.dispose();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/RenderGeometry.js
var s61 = class {
  constructor(s67, i49, t71, e71) {
    this.vao = s67, this.primitiveType = i49, this.parameters = t71, this.indexed = e71;
  }
  dispose() {
    this.vao.dispose();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/depthRange.js
var r52 = class {
  constructor() {
    this.near = Number.MAX_VALUE, this.far = -Number.MAX_VALUE;
  }
};
function n54(r57, n63) {
  return {
    near: r57,
    far: n63
  };
}
function a50(r57) {
  return r57 ? t64(r57, 1 / 0, -1 / 0) : n54(1 / 0, -1 / 0);
}
function t64(r57, n63, a59) {
  return r57.near = n63, r57.far = a59, r57;
}
function e62(r57, n63) {
  null != n63 && (r57.near = Math.min(r57.near, n63.near), r57.far = Math.max(r57.far, n63.far));
}
function f40(r57, n63) {
  return r57.near <= n63 && n63 <= r57.far;
}
var u41 = {
  near: 0,
  far: 0
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/DepthRange.js
function w21(t71, e71) {
  const r57 = a50(), {
    eye: o60,
    frustum: n63,
    viewForward: a59
  } = t71;
  e71.forAll((t72) => {
    const e72 = null != t72.offsetObb ? t72.offsetObb : t72.obb, l47 = P3(K(C23, e72.center, o60), a59), f46 = e72.projectedRadius(a59);
    if (f40(r57, l47 - f46) && f40(r57, l47 + f46)) return;
    const i49 = M13(e72, n63);
    if (-1 === i49) return;
    if (0 === i49) return k20.far = l47 + f46, k20.near = l47 - f46, void e62(r57, k20);
    const u46 = x23.pushNew();
    u46.near = l47 - f46, u46.far = l47 + f46, u46.mask = i49, u46.object = t72;
  });
  for (let l47 = 0; l47 < x23.length; l47++) {
    const t72 = x23.data[l47];
    if (f40(r57, t72.near) && f40(r57, t72.far)) continue;
    k20.far = t72.far, k20.near = 1 / 0;
    const e72 = R13(null != t72.object.offsetObb ? t72.object.offsetObb : t72.object.obb, o60, y25, (e73) => {
      let r58 = O29;
      for (let o61 = 0; o61 < F14 && e73.length > 0; o61++) {
        if (!(t72.mask & 1 << o61)) continue;
        z18(n63[o61], e73, r58);
        const a60 = e73;
        e73 = r58, r58 = a60;
      }
      for (let t73 = 0; t73 < e73.length; t73 += 3) {
        o4(q17, e73.data[t73], e73.data[t73 + 1], e73.data[t73 + 2]);
        const r59 = P3(K(q17, q17, o60), a59);
        k20.near = Math.min(k20.near, r59);
      }
    });
    0 === e72 && (k20.near = 0), e62(r57, k20);
  }
  return x23.length = 0, r57;
}
var x23 = new l3({
  allocator: (t71) => t71 || {
    near: 1 / 0,
    far: -1 / 0,
    mask: 0,
    object: null
  },
  deallocator: (t71) => (t71.object = null, t71)
});
var k20 = a50();
var q17 = n7();
var v25 = n7();
var y25 = new l3({
  deallocator: null
});
var O29 = new l3({
  deallocator: null
});
function z18(t71, e71, r57) {
  r57.length = 0;
  const o60 = e71.length - 3;
  A28(q17, e71, o60);
  const n63 = V3(t71, q17);
  n63 <= 0 && (r57.push(q17[0]), r57.push(q17[1]), r57.push(q17[2]));
  let a59 = 0, s67 = n63;
  for (; a59 < o60; a59 += 3) {
    A28(v25, e71, a59);
    const o61 = V3(t71, v25);
    if (s67 * o61 < 0) {
      A4(q17, v25, q17, o61 / (o61 - s67)), P16(r57, q17);
    }
    o61 <= 0 && P16(r57, v25), s67 = o61, r5(q17, v25);
  }
  if (s67 * n63 < 0) {
    A28(v25, e71, o60);
    A4(q17, v25, q17, n63 / (n63 - s67)), P16(r57, q17);
  }
}
function A28(t71, e71, r57) {
  return o4(t71, e71.data[r57], e71.data[r57 + 1], e71.data[r57 + 2]);
}
function P16(t71, e71) {
  t71.push(e71[0]), t71.push(e71[1]), t71.push(e71[2]);
}
function R13(t71, o60, a59, s67) {
  O4(B14, t71.quaternion), K(C23, o60, t71.center), E2(C23, C23, B14);
  const i49 = t71.halfSize, u46 = 8 * ((C23[0] < -i49[0] ? -1 : C23[0] > i49[0] ? 1 : 0) + 3 * (C23[1] < -i49[1] ? -1 : C23[1] > i49[1] ? 1 : 0) + 9 * (C23[2] < -i49[2] ? -1 : C23[2] > i49[2] ? 1 : 0) + 13), h32 = S23[u46];
  if (0 === h32) return h32;
  p9(N15, t71.quaternion), f9(N15, N15, t71.halfSize);
  const p49 = (e71, r57) => {
    const o61 = S23[u46 + r57 + 1];
    return o4(e71, ((1 & o61) << 1) - 1, (2 & o61) - 1, ((4 & o61) >> 1) - 1), S4(e71, e71, N15), u5(e71, t71.center, e71);
  };
  return a59.length = 0, P16(a59, p49(D12, 0)), P16(a59, p49(E35, 1)), P16(a59, p49(C23, 2)), P16(a59, p49(G14, 3)), s67(a59), 1 === h32 ? h32 : (a59.length = 0, P16(a59, D12), P16(a59, G14), P16(a59, p49(C23, 4)), P16(a59, p49(H21, 5)), s67(a59), 2 === h32 || (a59.length = 0, P16(a59, D12), P16(a59, H21), P16(a59, p49(C23, 6)), P16(a59, E35), s67(a59)), h32);
}
var S23 = (() => {
  const t71 = new Array(216);
  let e71 = 0;
  const r57 = (r58) => {
    for (let o60 = 0; o60 < r58.length; o60++) t71[e71 + o60] = r58[o60];
    e71 += 8;
  };
  return r57([3, 0, 6, 2, 3, 1, 5, 4]), r57([2, 0, 2, 3, 1, 5, 4, 0]), r57([3, 1, 0, 2, 3, 7, 5, 4]), r57([2, 0, 1, 3, 2, 6, 4, 0]), r57([1, 0, 1, 3, 2, 0, 0, 0]), r57([2, 1, 5, 7, 3, 2, 0, 0]), r57([3, 2, 0, 1, 3, 7, 6, 4]), r57([2, 2, 0, 1, 3, 7, 6, 0]), r57([3, 3, 0, 1, 5, 7, 6, 2]), r57([2, 0, 1, 5, 4, 6, 2, 0]), r57([1, 0, 1, 5, 4, 0, 0, 0]), r57([2, 1, 3, 7, 5, 4, 0, 0]), r57([1, 0, 2, 6, 4, 0, 0, 0]), r57([0, 0, 0, 0, 0, 0, 0, 0]), r57([1, 1, 3, 7, 5, 0, 0, 0]), r57([2, 2, 3, 7, 6, 4, 0, 0]), r57([1, 2, 3, 7, 6, 0, 0, 0]), r57([2, 3, 1, 5, 7, 6, 2, 0]), r57([3, 4, 0, 1, 5, 7, 6, 2]), r57([2, 5, 7, 6, 4, 0, 1, 0]), r57([3, 5, 0, 1, 3, 7, 6, 4]), r57([2, 4, 5, 7, 6, 2, 0, 0]), r57([1, 4, 5, 7, 6, 0, 0, 0]), r57([2, 5, 1, 3, 7, 6, 4, 0]), r57([3, 6, 0, 2, 3, 7, 5, 4]), r57([2, 6, 2, 3, 7, 5, 4, 0]), r57([3, 7, 6, 2, 3, 1, 5, 4]), t71;
})();
var F14 = 4;
function M13(t71, e71) {
  let r57 = 0;
  for (let o60 = 0; o60 < F14; o60++) {
    const n63 = t71.intersectPlane(e71[o60]);
    if (n63 > 0) return -1;
    0 === n63 && (r57 |= 1 << o60);
  }
  return r57;
}
var N15 = e16();
var B14 = e17();
var C23 = n7();
var D12 = n7();
var E35 = n7();
var G14 = n7();
var H21 = n7();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/RenderSubmitSystem.js
var e63 = class {
  constructor(t71) {
    this._objects = t71;
  }
  submit(t71, e71) {
    this._objects.preSubmit(e71), this._objects.visibleObjects.forAll((s67) => s67.renderable.material.submit(t71, e71, s67));
  }
  queryShadowCasterDepthRange(e71) {
    return this._objects.visibleObjects.length ? w21(e71, this._objects.visibleObjects) : null;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/UniformComponentParameters.js
var s62 = class {
  constructor() {
    this.externalColor = n11(), this.externalColorMixMode = n14.Multiply, this.castShadows = true, this.pickable = true, this.elevationOffset = 0;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentObjectCollection.js
var k21 = () => n.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");
var q18 = class {
  constructor(e71, o60) {
    this._renderManager = e71, this._viewingMode = o60, this._elevationRangeCacheVerticalOffset = NaN, this._elevationRangeCacheMin = NaN, this._elevationRangeCacheMax = NaN, this._visible = new l3(), this._hidden = new l3(), this._renderSubmit = new e63(this), this._renderManager.register(this._renderSubmit), this._hasObjectAndLayerId = has("enable-feature:objectAndLayerId-rendering"), this._componentBufferManager = new r36(e71.rctx, 2 + (this._hasObjectAndLayerId ? 1 : 0));
  }
  destroy() {
    s14(0 === this._hidden.length && 0 === this._visible.length, "ObjectCollection should be empty upon disposal"), this._componentBufferManager.destroy(), this._visible.forAll((e71) => e71.destroy()), this._hidden.forAll((e71) => e71.destroy()), this._visible.clear(), this._hidden.clear();
  }
  createObject(e71) {
    const t71 = e71.geometry, o60 = new e59(this._componentBufferManager, t9(t71.componentOffsets)), n63 = this._createRenderable(e71, o60), i49 = new b22(this._viewingMode, t71.positionData, o60), r57 = new e60(e71.transform, e71.toMapSpace, e71.obb.clone(), o60, n63, i49);
    return (r57.visible ? this._visible : this._hidden).push(r57), r57;
  }
  destroyObject(e71) {
    const t71 = e71;
    (t71.visible ? this._visible : this._hidden).removeUnordered(t71), t71.destroy(), this._notifyDirty();
  }
  setObjectVisibility(e71, t71) {
    const o60 = e71;
    t71 !== o60.visible && (t71 ? (this._hidden.removeUnordered(o60), this._visible.push(o60)) : (this._visible.removeUnordered(o60), this._hidden.push(o60)), o60.visible = t71, this._notifyDirty());
  }
  preSubmit(e71) {
    const t71 = e71.camera.eye;
    this.visibleObjects.forAll((e72) => e72.renderable.meta.cameraDepthSquared = p3(t71, e72.obb.center));
  }
  getMaterial(e71) {
    return e71.renderable.material;
  }
  updateMaterial(e71, t71) {
    const o60 = e71.renderable.material;
    t71(o60), o60.dirty && this._notifyDirty();
  }
  setAllComponentVisibilities(e71, t71) {
    const o60 = e71;
    o60.components.visibility.reset(t71), o60.components.visibilityDirty(), this._notifyDirty();
  }
  forEachVisibleComponent(e71, t71) {
    return e71.components.visibility.forEachComponent(t71);
  }
  getComponentCount(e71) {
    const t71 = e71, o60 = t71.components.visibility.componentCount;
    return {
      visible: o60,
      invisible: t71.components.count - o60
    };
  }
  setComponentData(e71, t71) {
    const o60 = e71, n63 = o60.renderable.material, i49 = o60.components, r57 = i49.materialDataBuffer, s67 = i49.materialDataIndices, a59 = new s62(), l47 = r57.textureBuffer, c44 = new Uint8Array(4), p49 = new Uint32Array(c44.buffer);
    let u46 = 0, d38 = 0, g28 = 0, b25 = i49.verticalOffsets, y27 = 1 / 0, v28 = -1 / 0, C25 = false, _30 = false, w24 = 0;
    for (let f46 = 0; f46 < i49.count; f46++) {
      t71(f46, a59), u46 += +(a59.externalColor[3] < 1), d38 += +(a59.externalColorMixMode === n14.Replace && 1 === a59.externalColor[3]), g28 += +a59.castShadows, r10(a59.externalColor, a59.externalColorMixMode, c44), c44[2] = 254 & c44[2] | +a59.castShadows, l47.setData(s67[f46], 0, c44[0], c44[1], c44[2], c44[3]), C25 ||= f46 > 0 && w24 !== p49[0], w24 = p49[0], _30 ||= 0 !== a59.elevationOffset, _30 && null == b25 && (b25 = new Array(f46).fill(0)), null != b25 && (b25[f46] = a59.elevationOffset), y27 = Math.min(y27, a59.elevationOffset), v28 = Math.max(v28, a59.elevationOffset), C3(a59.elevationOffset, c44), l47.setData(s67[f46], 1, c44[0], c44[1], c44[2], c44[3]);
      const e72 = a59.objectAndLayerIdColor;
      null != e72 && l47.setData(s67[f46], 2, e72[0], e72[1], e72[2], e72[3]), a59.pickable !== i44(i49.pickability, f46) && (i49.pickability = n53(i49.pickability, i49.count, f46, a59.pickable));
    }
    i49.verticalOffsets = _30 ? b25 : null, o60.offsetObb = _30 ? L4(o60.obb, y27, v28, this._viewingMode, o60.offsetObb ?? o60.obb.clone()) : null, C25 || _30 || this._hasObjectAndLayerId ? (n63.componentParameters = new _14(), n63.componentParameters.castShadows = H22(g28, i49.count), n63.componentParameters.transparent = H22(u46, i49.count), n63.componentParameters.opaqueOverride = H22(d38, i49.count), n63.componentParameters.texture = l47, l47.updateTexture()) : (n63.componentParameters = new W4(), n63.componentParameters.castShadows = a59.castShadows ? I9.All : I9.None, n63.componentParameters.externalColor = a59.externalColor, n63.componentParameters.externalColorMixMode = a59.externalColorMixMode), this._elevationRangeCacheVerticalOffset = NaN, this._notifyDirty();
  }
  getComponentAabb(e71, t71, o60, n63 = false) {
    e71.intersectionGeometry.getComponentAabb(t71, o60);
    const i49 = e71, r57 = i49.components.verticalOffsets;
    if (n63 || null == r57) return o60;
    const s67 = r57[t71];
    if (this._viewingMode === l9.Local || 0 === s67) return o60[2] += s67, o60[5] += s67, o60;
    const a59 = L6(s67);
    return a59.localOrigin = i49.transform.position, a59.applyToAabb(o60);
  }
  getComponentObb(e71) {
    return e71.obb;
  }
  getObjectTransform(e71) {
    return e71.transform;
  }
  getComponentPositions(e71, t71, o60) {
    return e71.intersectionGeometry.getComponentPositions(t71, o60);
  }
  expandRangeWithComponentObjectElevationRange(e71, t71, o60, n63) {
    Number.isNaN(this._elevationRangeCacheVerticalOffset) || this._elevationRangeCacheVerticalOffset !== t71 || n63.expandElevationRangeValues(this._elevationRangeCacheMin, this._elevationRangeCacheMax);
    const i49 = e71, r57 = i49.components, s67 = r57.count, a59 = r57.verticalOffsets, l47 = i49.intersectionGeometry, m45 = this._viewingMode === l9.Local, h32 = l47.getComponentAabbs(), f46 = X12;
    let p49 = 1 / 0, u46 = -1 / 0;
    for (let c44 = 0; c44 < s67; c44++) {
      const e72 = 6 * c44, r58 = a59?.[c44] ?? 0;
      let s68 = 1 / 0, l48 = -1 / 0;
      if (m45) s68 = h32[e72 + 2] + r58 + t71, l48 = h32[e72 + 5] + r58 + t71;
      else {
        if (f46[0] = h32[e72], f46[1] = h32[e72 + 1], f46[2] = h32[e72 + 2], f46[3] = h32[e72 + 3], f46[4] = h32[e72 + 4], f46[5] = h32[e72 + 5], 0 !== r58) {
          const e73 = L6(r58);
          e73.localOrigin = i49.transform.position, e73.applyToAabb(f46);
        }
        const s69 = Math.max(Math.abs(f46[3]), Math.abs(f46[0])), a60 = Math.max(Math.abs(f46[4]), Math.abs(f46[1])), l49 = t71 + f46[5] + o60;
        n63.expandElevationRangeValues(t71 + f46[2], Math.sqrt(s69 * s69 + a60 * a60 + l49 * l49) - o60);
      }
      n63.expandElevationRangeValues(s68, l48), p49 = Math.min(p49, s68), u46 = Math.max(u46, l48);
    }
    this._elevationRangeCacheVerticalOffset = t71, this._elevationRangeCacheMin = p49, this._elevationRangeCacheMax = u46;
  }
  intersect(e71, t71, o60, n63, i49, r57, s67) {
    const a59 = e71, {
      transform: l47
    } = a59, {
      position: c44
    } = l47;
    return null != i49 && (i49.localOrigin = c44), a59.intersectionGeometry.intersect(t71, o60, n63, i49, a59.components.verticalOffsets, l47, r57, s67);
  }
  addEdges(e71, t71, o60, n63, i49) {
    const r57 = e71, {
      indices: s67,
      positions: a59
    } = r57.intersectionGeometry, l47 = r57.components.offsets;
    return t71.addComponentObject(r57, a59, s67, l47, o60, n63, i49);
  }
  extractEdgeInformation(e71, t71, o60) {
    return __async(this, null, function* () {
      const n63 = e71, r57 = n63.components.visibility;
      if (r57.allInvisible()) return {
        buffer: m11.createBuffer(0),
        origin: [0, 0, 0]
      };
      const {
        indices: s67,
        positions: c44
      } = n63.intersectionGeometry, m45 = n63.components.offsets, h32 = E8.createBuffer(c44.length / 3);
      t12(h32.position.typedBuffer, c44, h32.position.typedBufferStride, 3), r14(h32.position, h32.position, n63.transform.rotationScale), this._setComponentIndices(h32.componentIndex, s67, m45);
      const f46 = h32.count, p49 = this._computeVisibilityIndices(s67, r57, m45, f46);
      return {
        origin: t4(n63.transform.position),
        buffer: yield t71.extractComponentsEdgeLocations({
          indices: p49,
          indicesLength: p49.length,
          skipDeduplicate: true,
          data: h32,
          writerSettings: {
            reducedPrecision: false,
            variants: 0
          }
        }, o60)
      };
    });
  }
  _setComponentIndices(e71, t71, o60) {
    let n63 = 0;
    for (let i49 = 0; i49 < o60.length - 1; i49++) {
      const r57 = o60[i49], s67 = o60[i49 + 1];
      for (let o61 = r57; o61 < s67; o61++) {
        const i50 = t71 ? t71[o61] : o61;
        e71.set(i50, n63);
      }
      n63++;
    }
  }
  _computeVisibilityIndices(e71, t71, n63, i49) {
    if (e71 && t71.allVisible()) return e71;
    let r57 = 0;
    t71.forEachComponentRange((e72, t72) => (r57 += n63[t72] - n63[e72], true));
    const s67 = y(e71) ? new Array(r57) : 2 === e71?.BYTES_PER_ELEMENT || i49 <= 65536 ? new Uint16Array(r57) : new Uint32Array(r57);
    let a59 = 0;
    return t71.forEachComponentRange((t72, o60) => {
      const i50 = n63[t72], r58 = n63[o60];
      for (let n64 = i50; n64 < r58; n64++) s67[a59++] = e71 ? e71[n64] : n64;
      return true;
    }), s67;
  }
  addComponentHighlight(e71, t71) {
    const o60 = e71.components;
    null == o60.highlightCounts && (o60.highlightCounts = new Uint32Array(o60.count + 1));
    0 === o60.highlightCounts[t71]++ && (o60.highlightsDirty(), this._notifyDirty()), o60.highlightCounts[o60.count]++;
  }
  removeComponentHighlight(e71, t71) {
    const o60 = e71.components;
    if (null == o60.highlightCounts) return void k21().warn("Removing non-existing highlight.");
    const n63 = o60.highlightCounts[t71], i49 = o60.highlightCounts[o60.count];
    if (0 !== n63) {
      if (n63 > 1) return o60.highlightCounts[t71] = n63 - 1, void (o60.highlightCounts[o60.count] = i49 - 1);
      o60.highlightCounts[t71] = 0, o60.highlightsDirty(), this._notifyDirty(), 1 === i49 ? o60.highlightCounts = null : o60.highlightCounts[o60.count] = i49 - 1;
    } else k21().warn("Removing non-existing highlight.");
  }
  clearHighlights(e71) {
    const t71 = e71.components;
    null != t71.highlightCounts && (t71.highlightCounts = null, t71.highlightsDirty(), this._notifyDirty());
  }
  getObjectGPUMemoryUsage(e71) {
    return e71.renderable.meta.gpuMemoryEstimate;
  }
  get visibleObjects() {
    return this._visible;
  }
  _createRenderable(e71, t71) {
    const o60 = this._renderManager.rctx, n63 = e71.geometry, i49 = n63.vertices.layoutParameters, r57 = c7.createVertex(o60, F3.STATIC_DRAW, n63.vertices.data), s67 = n63.indices ? c7.createIndex(o60, F3.STATIC_DRAW, n63.indices) : null, a59 = t8(o31(i49)), l47 = new Uint16Array(n63.vertices.count);
    for (let p49 = 0; p49 < t71.count; p49++) {
      const e72 = t71.offsets[p49], o61 = t71.offsets[p49 + 1], i50 = t71.materialDataIndices[p49];
      if (null != n63.indices) for (let t72 = e72; t72 < o61; t72++) {
        l47[n63.indices[t72]] = i50;
      }
      else for (let t72 = e72; t72 < o61; t72++) l47[t72] = i50;
    }
    const c44 = c7.createVertex(o60, F3.STATIC_DRAW, l47.buffer), m45 = new R5(e71.transform, e71.toMapSpace), h32 = new o23(o60, S10, {
      data: a59,
      componentIndices: W9
    }, {
      data: r57,
      componentIndices: c44
    }, s67), f46 = new s61(h32, E7.TRIANGLES, i49, null != s67), u46 = {
      cameraDepthSquared: 0.5,
      gpuMemoryEstimate: r57.usedMemory + c44.usedMemory + (null != s67 ? s67.usedMemory : 0)
    };
    return new t63(m45, f46, u46);
  }
  _notifyDirty() {
    this._renderManager.notifyDirty();
  }
};
var W9 = t8(H2().u16(e18.COMPONENTINDEX));
function H22(e71, t71) {
  return e71 === t71 ? I9.All : 0 === e71 ? I9.None : I9.Some;
}
var X12 = i3();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique.js
var n55 = class _n extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _n.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      colorWrite: _9
    });
  }
};
n55.shader = new t16(d15, () => import("./HighlightApply.glsl-BYQVBUZB.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/HighlightBlurTechnique.js
var a51 = class _a extends r17 {
  initializeProgram(r57) {
    return new r18(r57.rctx, _a.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: _9
    });
  }
};
a51.shader = new t16(c22, () => import("./HighlightBlur.glsl-7IPIQYID.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique.js
var l43 = class _l extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _l.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: _9
    });
  }
};
l43.shader = new t16(c21, () => import("./HighlightDownsample.glsl-QZEWO5M7.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/HighlightPassParameters.js
var r53 = class extends n15 {
  constructor() {
    super(...arguments), this.color = r6(1, 0, 1, 1), this.haloColor = r6(1, 0, 1, 1), this.haloOpacity = 1, this.haloOpacityOccluded = 0.25, this.fillOpacity = 0.2, this.fillOpacityOccluded = 0.05, this.coverageRounding = r7(1, 1);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/Highlight.js
var R14 = class extends c10 {
  constructor(e71) {
    super(e71), this.produces = "highlight-color", this.consumes = {
      required: ["highlight-color", "highlights"]
    }, this._passParameters = new r53(), this._downsampleDrawParameters = new o38(), this._blurDrawParameters = new d16(), this._blurColorFormat = has("mac") ? R4.RGBA : R4.RGBA4, this._grid = {
      coverage: null,
      vao: null,
      verticalCellCount: 0,
      horizontalCellCount: 0,
      viewportWidth: 0,
      viewportHeight: 0
    }, this._blurTechnique = e71.techniques.acquire(a51), this._downsampleTechnique = e71.techniques.acquire(l43), this._applyTechnique = e71.techniques.acquire(n55);
  }
  initialize() {
    this.addHandles([d2(() => this.view.highlightOptions.color, (e71) => {
      this._passParameters.color = E5(e71 ?? r44), this.view.highlightOptions.haloColor || (this._passParameters.haloColor = this._passParameters.color), this.requestRender(O7.UPDATE);
    }, A3), d2(() => this.view.highlightOptions.haloColor, (e71) => {
      this._passParameters.haloColor = null != e71 ? E5(e71) : this._passParameters.color, this.requestRender(O7.UPDATE);
    }, A3), d2(() => this.view.highlightOptions.haloOpacity, (e71) => {
      this._passParameters.haloOpacity = e71 ?? e50, this._passParameters.haloOpacityOccluded = 0.25 * this._passParameters.haloOpacity, this.requestRender(O7.UPDATE);
    }, A3), d2(() => this.view.highlightOptions.fillOpacity, (e71) => {
      this._passParameters.fillOpacity = e71 ?? n43, this._passParameters.fillOpacityOccluded = 0.25 * this._passParameters.fillOpacity, this.requestRender(O7.UPDATE);
    }, A3)]);
  }
  destroy() {
    this._blurTechnique.release(), this._downsampleTechnique.release(), this._applyTechnique.release(), this._grid.coverage = t2(this._grid.coverage), this._grid.vao = r2(this._grid.vao);
  }
  render(e71) {
    if (this.bindParameters.decorations === i11.OFF) return e71.find(({
      name: e72
    }) => "highlight-color" === e72);
    if (!(this._blurTechnique.compiled && this._downsampleTechnique.compiled && this._applyTechnique.compiled)) return this.requestRender(O7.UPDATE), e71.find(({
      name: e72
    }) => "highlight-color" === e72);
    const r57 = e71.find(({
      name: e72
    }) => "highlights" === e72).getTexture(), t71 = this.bindParameters.camera, i49 = t71.fullWidth, s67 = t71.fullHeight, o60 = t71.pixelRatio, a59 = Math.ceil(i49 / o60), h32 = Math.ceil(s67 / o60), c44 = this.renderingContext;
    this._gridUpdateResources(r57), this._gridComputeCoverage(r57, this.bindParameters), this._passParameters.highlightTexture = r57, this._passParameters.coverageTexture = this._grid.coverage?.getTexture();
    const {
      width: n63,
      height: u46
    } = r57.descriptor;
    o13(this._passParameters.coverageRounding, n63 / (Math.ceil(n63 / n36) * n36), u46 / (Math.ceil(u46 / n36) * n36));
    const m45 = this._grid.vao;
    c44.bindVAO(m45);
    const p49 = this.fboCache.acquire(a59, h32, "highlight blur", this._blurColorFormat);
    c44.unbindTexture(p49.fbo?.colorTexture), c44.bindFramebuffer(p49.fbo), c44.setClearColor(0, 0, 0, 0), c44.clear(_7.COLOR_BUFFER_BIT), c44.setViewport(0, 0, a59, h32), this._blurDrawParameters.blurInputTexture = r57, o13(this._blurDrawParameters.blurSize, 1 / a59, 0);
    const g28 = c44.bindTechnique(this._blurTechnique, this.bindParameters, this._passParameters, this._blurDrawParameters);
    c44.drawArrays(this._blurTechnique.primitiveType, 0, i8(m45, "geometry"));
    const d38 = this.fboCache.acquire(a59, h32, "highlight blur", this._blurColorFormat);
    c44.unbindTexture(d38.fbo?.colorTexture), c44.bindFramebuffer(d38.fbo), c44.setClearColor(0, 0, 0, 0), c44.clear(_7.COLOR_BUFFER_BIT), this._blurDrawParameters.blurInputTexture = p49.getTexture(), o13(this._blurDrawParameters.blurSize, 0, 1 / h32), g28.bindDraw(this._blurDrawParameters, this.bindParameters, this._passParameters), c44.drawArrays(this._blurTechnique.primitiveType, 0, i8(m45, "geometry"));
    const b25 = e71.find(({
      name: e72
    }) => "highlight-color" === e72);
    return c44.bindFramebuffer(b25.fbo), c44.setViewport4fv(t71.fullViewport), this._passParameters.blurTexture = d38.getTexture(), c44.bindTechnique(this._applyTechnique, this.bindParameters, this._passParameters), c44.drawArrays(this._applyTechnique.primitiveType, 0, i8(m45, "geometry")), p49.release(), d38.release(), b25;
  }
  _gridUpdateResources(e71) {
    const r57 = this.renderingContext, t71 = this._grid, i49 = Math.ceil(e71.descriptor.height / n36), s67 = Math.ceil(e71.descriptor.width / n36);
    if (t71.vao && t71.verticalCellCount === i49 && t71.horizontalCellCount === s67) return;
    t71.verticalCellCount = i49, t71.horizontalCellCount = s67;
    const o60 = i49 + 1, a59 = s67 + 1, h32 = 1 / i49, l47 = 1 / s67, c44 = new Float32Array(6 * 4 * o60 * a59);
    let n63 = 0;
    for (let u46 = 0; u46 < o60; u46++) for (let e72 = 0; e72 < a59; e72++) c44[n63++] = (e72 - 0.5) * l47 * 2 - 1, c44[n63++] = (u46 - 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32, c44[n63++] = (e72 + 0.5) * l47 * 2 - 1, c44[n63++] = (u46 - 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32, c44[n63++] = (e72 - 0.5) * l47 * 2 - 1, c44[n63++] = (u46 + 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32, c44[n63++] = (e72 - 0.5) * l47 * 2 - 1, c44[n63++] = (u46 + 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32, c44[n63++] = (e72 + 0.5) * l47 * 2 - 1, c44[n63++] = (u46 - 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32, c44[n63++] = (e72 + 0.5) * l47 * 2 - 1, c44[n63++] = (u46 + 0.5) * h32 * 2 - 1, c44[n63++] = e72 * l47, c44[n63++] = u46 * h32;
    t71.vao?.dispose(), t71.vao = new r32(r57, O8, {
      geometry: m22
    }, {
      geometry: c7.createVertex(r57, F3.STATIC_DRAW, c44)
    });
  }
  _gridComputeCoverage(e71, r57) {
    const t71 = this.renderingContext, i49 = this._grid, s67 = e71.descriptor, o60 = Math.ceil(s67.width / n36), a59 = Math.ceil(s67.height / n36);
    this._downsampleDrawParameters.input = e71, i49.coverage?.release(), i49.coverage = this.fboCache.acquire(o60, a59, "highlight coverage", R4.RG), t71.unbindTexture(i49.coverage.fbo?.colorTexture), t71.bindFramebuffer(i49.coverage.fbo), t71.bindTechnique(this._downsampleTechnique, r57, this._passParameters, this._downsampleDrawParameters), t71.setViewport(0, 0, o60, a59), t71.screen.draw();
  }
  get test() {
  }
};
e6([y2()], R14.prototype, "produces", void 0), e6([y2()], R14.prototype, "consumes", void 0), e6([y2({
  constructOnly: true
})], R14.prototype, "techniques", void 0), R14 = e6([a4("esri.views.3d.webgl-engine.effects.highlight.Highlight")], R14);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowConfiguration.js
var s63 = class extends t18 {
  constructor() {
    super(...arguments), this.receiveShadows = true;
  }
};
e6([r19()], s63.prototype, "receiveShadows", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique.js
var p44 = class extends h9 {
  constructor() {
    super(...arguments), this.shadowColor = r6(1, 0, 1, 1), this.shadowOpacity = 0.2, this.occludedShadowOpacity = 0.1, this.opacityElevation = 1, this.dayNightTerminator = 1;
  }
};
var u42 = class _u extends r17 {
  constructor(r57) {
    super(r57, new s63(), () => this.destroy());
  }
  initializeProgram(r57) {
    return new r18(r57.rctx, _u.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      colorWrite: _9,
      depthTest: null,
      depthWrite: null
    });
  }
  get primitiveType() {
    return E7.TRIANGLE_STRIP;
  }
};
u42.shader = new t16(D3, () => import("./ShadowHighlight.glsl-CUMAIAVN.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/highlight/ShadowHighlight.js
var O30 = 1953125e-9;
var v26 = 4e4;
var P17 = 5e4;
var b23 = class extends c10 {
  constructor(e71) {
    super(e71), this.produces = "composite-color", this.consumes = {
      required: ["composite-color", "highlights"]
    }, this._passParameters = new p44(), this._maxOpacity = 1, this._shadowDifference = 0.2, this._technique = e71.techniques.acquire(u42);
  }
  initialize() {
    this.addHandles([d2(() => this.view.highlightOptions.shadowOpacity, (e71) => {
      this._passParameters.shadowOpacity = e71 ?? m31, this._updateOccludedShadowOpacity(), this._updateMaxOpacity();
    }, A3), d2(() => this.view.highlightOptions.shadowDifference, (e71) => {
      this._shadowDifference = e71 ?? p35, this._updateOccludedShadowOpacity(), this._updateMaxOpacity();
    }, A3), d2(() => this.view.highlightOptions.shadowColor, (e71) => {
      this._passParameters.shadowColor = E5(e71 ?? t50), this._updateMaxOpacity();
    }, A3)]);
  }
  destroy() {
    this._technique.release();
  }
  _updateOccludedShadowOpacity() {
    this._passParameters.occludedShadowOpacity = this._passParameters.shadowOpacity * (1 - this._shadowDifference);
  }
  _updateMaxOpacity() {
    const e71 = Math.max(this._passParameters.shadowOpacity, this._passParameters.occludedShadowOpacity);
    this._maxOpacity = e71 * this._passParameters.shadowColor[3];
  }
  render(e71) {
    const t71 = e71.find(({
      name: e72
    }) => "composite-color" === e72), s67 = this.bindParameters;
    if (!s67.shadowHighlightsVisible || !s67.depth || !this._ensureIfVisible(s67.camera, s67.lighting.mainLight.direction)) return t71;
    if (!this._technique.compiled) return this.requestRender(O7.UPDATE), t71;
    this._passParameters.highlight = e71.find(({
      name: e72
    }) => "highlights" === e72)?.getTexture(), this._passParameters.origin = s67.camera.center;
    const i49 = this.renderingContext;
    return i49.bindFramebuffer(t71.fbo), i49.bindTechnique(this._technique, s67, this._passParameters), i49.screen.draw(), t71;
  }
  _ensureIfVisible(e71, t71) {
    this._passParameters.opacityElevation = 1 - p4(v26, P17, e71.relativeElevation);
    const r57 = this.viewingMode === l9.Global ? z(j18, e71.center) : o4(j18, 0, 0, 1), a59 = P3(r57, t71);
    return this._passParameters.dayNightTerminator = p4(0, 1, e12(30 * a59, 0, 1)), this._maxOpacity * this._passParameters.opacityElevation * this._passParameters.dayNightTerminator >= O30;
  }
};
e6([y2()], b23.prototype, "produces", void 0), e6([y2()], b23.prototype, "consumes", void 0), e6([y2({
  constructOnly: true
})], b23.prototype, "viewingMode", void 0), e6([y2({
  constructOnly: true
})], b23.prototype, "techniques", void 0), b23 = e6([a4("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")], b23);
var j18 = n7();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/magnifier/MagnifierTechnique.js
var m39 = class _m extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _m.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: s20(R3.ONE, R3.ONE_MINUS_SRC_ALPHA),
      depthTest: null,
      depthWrite: null,
      colorWrite: _9
    });
  }
};
m39.shader = new t16(w11, () => import("./Magnifier.glsl-MKIQJS2T.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/magnifier/MagnifierRenderNode.js
var S24 = class extends c10 {
  constructor(e71) {
    super(e71), this.produces = "magnifier-color", this.consumes = {
      required: ["magnifier-color"]
    }, this._imageSources = null, this._imageLoadTask = null, this._passParameters = new f22(), this._vao = null, this._technique = null, this._magnifier = null, this._tmpScreenPoint = i4(), this._tmpRenderPoint = s10();
  }
  initialize() {
    this.addHandles([d2(() => this.view.magnifier, (e71) => this._update(e71), A3)]);
  }
  _update(e71) {
    if (e71 === this._magnifier) return;
    this.removeAllHandles(), this._magnifier = e71;
    const s67 = () => {
      const e72 = this._validMagnifier;
      e72 ? (this._loadResources(e72), this.produces = "magnifier-color") : this.produces = "disabled", this.requestRender();
    };
    this._magnifier && this.addHandles(d2(() => this._magnifier?.version, s67)), s67();
  }
  get _validMagnifier() {
    return this._magnifier?.visible && this._magnifier?.position && this._magnifier?.size > 0 ? this._magnifier : null;
  }
  get _factor() {
    return this._magnifier?.factor || 1;
  }
  destroy() {
    this._magnifier = null, null != this._imageLoadTask && (this._imageLoadTask.task.abort(), this._imageLoadTask = null), this._disposeTextures(), this._vao = r2(this._vao);
  }
  _disposeTextures() {
    this._passParameters.mask = r2(this._passParameters.mask), this._passParameters.overlay = r2(this._passParameters.overlay), this._passParameters.input = r2(this._passParameters.input);
  }
  render(e71) {
    const s67 = this._validMagnifier, r57 = e71.find(({
      name: e72
    }) => "magnifier-color" === e72);
    if (null == s67) return r57;
    if (null == this._imageSources) return this.requestRender(O7.UPDATE), r57;
    const t71 = this.renderingContext, a59 = this.camera.pixelRatio, o60 = Math.ceil(a59 * s67.size);
    if (this._vao ??= i21(t71, o30, O8, 0, 1), this._technique ??= this.techniques.acquire(m39), this._ensureTextureResources(t71, o60), !this._technique?.compiled || !this._passParameters.input) return this.requestRender(O7.UPDATE), r57;
    const m45 = Math.ceil(1 / this._factor * o60), l47 = this._passParameters.input;
    l47.resize(m45, m45), d5(s67.position, this._tmpScreenPoint);
    const h32 = this.camera.screenToRender(this._tmpScreenPoint, this._tmpRenderPoint), u46 = this.camera.fullWidth, p49 = this.camera.fullHeight, c44 = 0.5 * m45, P19 = 0.5 * m45;
    h32[0] = e12(h32[0], c44, u46 - c44 - 1), h32[1] = e12(h32[1], P19, p49 - P19 - 1);
    const T21 = Math.floor(h32[0] - c44), k23 = Math.floor(h32[1] - P19);
    t71.bindFramebuffer(r57.fbo);
    return this._technique.program.bindTexture("textureInput", l47), t71.gl.copyTexImage2D(l47.descriptor.target, 0, l47.descriptor.pixelFormat, T21, k23, m45, m45, 0), this._passParameters.magnifier = s67, t71.bindTechnique(this._technique, this.bindParameters, this._passParameters), t71.bindVAO(this._vao), t71.drawArrays(E7.TRIANGLE_STRIP, 0, 4), r57;
  }
  _loadResources(e71) {
    const {
      maskUrl: i49,
      overlayUrl: r57
    } = e71;
    this._imageLoadTask?.maskUrl === i49 && this._imageLoadTask?.overlayUrl === r57 || (this._imageLoadTask?.task.abort(), this._imageLoadTask = this._imageSources = null), this._imageSources || this._imageLoadTask || (this._imageLoadTask = {
      maskUrl: i49,
      overlayUrl: r57,
      task: d((e72) => __async(this, null, function* () {
        const s67 = null == i49 || null == r57 ? s24(e72) : null, t71 = null != i49 ? t15(i49, {
          signal: e72
        }) : s67.then((e73) => e73.mask), a59 = null != r57 ? t15(r57, {
          signal: e72
        }) : s67.then((e73) => e73.overlay);
        this._imageSources = {
          mask: yield t71,
          overlay: yield a59
        };
      }))
    });
  }
  _ensureTextureResources(e71, s67) {
    if (null == this._imageSources || this._passParameters.size === s67 && this._passParameters.input && this._passParameters.mask && this._passParameters.overlay) return;
    this._disposeTextures(), this._imageSources.overlay.width = this._imageSources.mask.width = s67, this._imageSources.overlay.height = this._imageSources.mask.height = s67;
    const i49 = new e22();
    i49.internalFormat = G4.RGBA, i49.wrapMode = D2.CLAMP_TO_EDGE, i49.flipped = true, i49.preMultiplyAlpha = !Pt(this._imageSources.overlay.src) || !e71.driverTest.svgPremultipliesAlpha.result, this._passParameters.overlay = new c8(e71, i49, this._imageSources.overlay), i49.pixelFormat = i49.internalFormat = G4.ALPHA, i49.preMultiplyAlpha = false, this._passParameters.mask = new c8(e71, i49, this._imageSources.mask), i49.pixelFormat = i49.internalFormat = G4.RGBA, i49.flipped = false, this._passParameters.input = new c8(e71, i49);
  }
};
e6([y2()], S24.prototype, "produces", void 0), e6([y2()], S24.prototype, "consumes", void 0), e6([y2()], S24.prototype, "_imageSources", void 0), e6([y2()], S24.prototype, "_imageLoadTask", void 0), e6([y2({
  constructOnly: true
})], S24.prototype, "techniques", void 0), S24 = e6([a4("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")], S24);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique.js
var a52 = class _a extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _a.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: _9
    });
  }
};
a52.shader = new t16(x8, () => import("./BlendWeights.glsl-UV2UDW4J.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique.js
var a53 = class _a extends r17 {
  initializeProgram(r57) {
    return new r18(r57.rctx, _a.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: _9
    });
  }
};
a53.shader = new t16(f23, () => import("./Blur.glsl-ALU7JAVY.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique.js
var l44 = class _l extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _l.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: _9
    });
  }
};
l44.shader = new t16(s37, () => import("./EdgeDetect.glsl-E33G3TOX.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/smaa/SMAAPassParameters.js
var s64 = class extends n15 {
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/smaa/SMAA.js
var g26 = class extends c10 {
  constructor(e71) {
    super(e71), this.produces = "disabled", this.consumes = {
      required: ["aa-color", "composite-color"]
    }, this._areaTexture = null, this._searchTexture = null, this._smaaParameters = new s64(), this._edgeTechnique = e71.techniques.acquire(l44), this._blendTechnique = e71.techniques.acquire(a52), this._blurTechnique = e71.techniques.acquire(a53);
  }
  initialize() {
    this.addHandles([d2(() => this.isEnabled(), (e71) => e71 ? this.enable() : this.disable(), A3)]);
  }
  enable() {
    return __async(this, null, function* () {
      if (this.produces = "aa-color", this._abortController || this._areaTexture && this._searchTexture) return;
      this._abortController = new AbortController();
      const e71 = this._abortController.signal;
      try {
        const r57 = yield import("./SMAAData-YARUO75Q.js");
        yield this._loadTextures(r57, e71), this.requestRender(O7.UPDATE);
      } catch {
      }
      this._abortController = null;
    });
  }
  _loadTextures(e71, r57) {
    return __async(this, null, function* () {
      s3(r57);
      const [s67, i49] = yield Promise.allSettled([t15(e71.areaTexture, {
        signal: r57
      }), t15(e71.searchTexure, {
        signal: r57
      })]);
      if (s3(r57), "fulfilled" !== s67.status || "fulfilled" !== i49.status) return;
      const o60 = this.renderingContext;
      this._areaTexture = w22(o60, L5.LINEAR, G4.RGB, s67.value), this._searchTexture = w22(o60, L5.NEAREST, G4.LUMINANCE, i49.value);
    });
  }
  disable() {
    this.produces = "disabled";
  }
  destroy() {
    this._searchTexture = r2(this._searchTexture), this._areaTexture = r2(this._areaTexture), this._blurTechnique.release(), this._blendTechnique.release(), this._edgeTechnique.release();
  }
  render(e71) {
    const r57 = e71.find(({
      name: e72
    }) => "aa-color" === e72);
    if (!(this._edgeTechnique.compiled && this._blendTechnique.compiled && this._blurTechnique.compiled && this._areaTexture && this._searchTexture)) return this.requestRender(O7.UPDATE), r57;
    const t71 = e71.find(({
      name: e72
    }) => "composite-color" === e72), s67 = t71.fbo.width, i49 = t71.fbo.height, o60 = this.renderingContext;
    o60.setViewport(0, 0, s67, i49);
    const a59 = this.fboCache.acquire(s67, i49, "smaa edges", R4.RG);
    o60.unbindTexture(a59.fbo?.colorTexture), o60.bindFramebuffer(a59.fbo), o60.setClearColor(0, 0, 0, 1), o60.clear(_7.COLOR_BUFFER_BIT), this._smaaParameters.color = t71.getTexture(), o60.bindTechnique(this._edgeTechnique, null, this._smaaParameters), o60.screen.draw();
    const n63 = this.fboCache.acquire(s67, i49, "smaa blend");
    return o60.unbindTexture(n63.fbo?.colorTexture), o60.bindFramebuffer(n63.fbo), o60.setClearColor(0, 0, 1, 1), o60.clear(_7.COLOR_BUFFER_BIT), this._smaaParameters.inputTexture = a59.getTexture(), this._smaaParameters.areaTexture = this._areaTexture, this._smaaParameters.searchTexture = this._searchTexture, o60.bindTechnique(this._blendTechnique, null, this._smaaParameters), o60.screen.draw(), a59.release(), o60.bindFramebuffer(r57.fbo), o60.setClearColor(0, 1, 0, 1), o60.clear(_7.COLOR_BUFFER_BIT), this._smaaParameters.inputTexture = n63.getTexture(), o60.bindTechnique(this._blurTechnique, null, this._smaaParameters), o60.screen.draw(), n63.release(), r57;
  }
};
function w22(e71, r57, t71, s67) {
  const i49 = new e22();
  return i49.pixelFormat = t71, i49.wrapMode = D2.CLAMP_TO_EDGE, i49.width = s67.width, i49.height = s67.height, i49.samplingMode = r57, new c8(e71, i49, s67);
}
e6([y2()], g26.prototype, "produces", void 0), e6([y2()], g26.prototype, "consumes", void 0), e6([y2({
  constructOnly: true
})], g26.prototype, "isEnabled", void 0), e6([y2({
  constructOnly: true
})], g26.prototype, "techniques", void 0), e6([y2()], g26.prototype, "_abortController", void 0), g26 = e6([a4("esri.views.3d.webgl-engine.effects.smaa.SMAA")], g26);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration.js
var i45;
!function(t71) {
  t71[t71.None = 0] = "None", t71[t71.Alpha = 1] = "Alpha", t71[t71.PremultipliedAlpha = 2] = "PremultipliedAlpha", t71[t71.COUNT = 3] = "COUNT";
}(i45 || (i45 = {}));
var p45 = class extends t18 {
  constructor() {
    super(...arguments), this.alphaMode = i45.None, this.hasOpacityFactor = false, this.isDepthBlit = false;
  }
};
e6([r19({
  count: i45.COUNT
})], p45.prototype, "alphaMode", void 0), e6([r19()], p45.prototype, "hasOpacityFactor", void 0), e6([r19()], p45.prototype, "isDepthBlit", void 0);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/CompositingTechnique.js
var p46 = class _p extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _p.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    switch (this.configuration.alphaMode) {
      case i45.None:
        return S7({
          colorWrite: _9
        });
      case i45.Alpha:
        return S7({
          blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
          colorWrite: _9
        });
      case i45.PremultipliedAlpha:
      case i45.COUNT:
        return S7({
          blending: s20(R3.ONE, R3.ONE_MINUS_SRC_ALPHA),
          colorWrite: _9
        });
    }
  }
};
p46.shader = new t16(c23, () => import("./Compositing.glsl-4VKX4DY6.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/HUDCompositingTechnique.js
var a54 = class _a extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _a.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      colorWrite: {
        r: false,
        g: true,
        b: false,
        a: false
      }
    });
  }
};
a54.shader = new t16(i26, () => import("./HUDCompositing.glsl-36V4QRAK.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/OITCompositingTechnique.js
var a55 = class _a extends r17 {
  initializeProgram(e71) {
    return new r18(e71.rctx, _a.shader.get().build(), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.SRC_ALPHA, R3.ONE, R3.ONE_MINUS_SRC_ALPHA, R3.ONE_MINUS_SRC_ALPHA),
      colorWrite: _9
    });
  }
};
a55.shader = new t16(c24, () => import("./OITCompositing.glsl-GR2DVM2J.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/CompositingHelper.js
var n56 = class {
  constructor(s67, e71) {
    this._rctx = s67, this._techniques = e71, this._configuration = new p45(), this._passParameters = new l22(), this._oitParameters = new s38(), this._hudParameters = new t45();
  }
  compositeOIT(t71, s67, i49, e71) {
    this._oitParameters.colorTexture = s67, this._oitParameters.alphaTexture = i49, this._oitParameters.frontFaceTexture = e71;
    const r57 = this._techniques.acquire(a55);
    this._rctx.bindTechnique(r57, t71, this._oitParameters), this._rctx.screen.draw(), r57.release();
  }
  compositeHUD(t71, s67) {
    this._hudParameters.texture = s67;
    const i49 = this._techniques.acquire(a54);
    this._rctx.bindTechnique(i49, t71, this._hudParameters), this._rctx.screen.draw(), i49.release();
  }
  composite(t71, i49, r57 = i45.None, o60 = 1) {
    this._configuration.alphaMode = r57, this._configuration.hasOpacityFactor = 1 !== o60, this._passParameters.texture = i49, this._passParameters.opacity = o60;
    const a59 = this._techniques.acquire(p46, this._configuration);
    this._rctx.bindTechnique(a59, t71, this._passParameters), this._rctx.screen.draw(), a59.release();
  }
  blitDepthToLinearDepth(t71, s67) {
    this._configuration.isDepthBlit = true, this.composite(t71, s67), this._configuration.isDepthBlit = false;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/depthRangeUtils.js
var v27 = 1e4;
var R15 = 100;
var j19 = 500;
var C24 = 500;
var A29 = 0.1;
function B15(t71, r57, i49) {
  return r9(r57, t71) * (i49[1] - i49[0]) + i49[0];
}
function M14(e71, t71, r57) {
  let i49 = 0;
  if (!t71.some((e72) => !!e72.materialReference && (i49 += e72.numGeometries, i49 >= v27))) return Q17.compute(e71, t71);
  const n63 = a50();
  return r57.forAll((t72) => e62(n63, O31(e71, t72))), n63;
}
function O31(e71, t71) {
  if (!t71.visible) return;
  const r57 = a50(), i49 = t71.getSpatialQueryAccelerator();
  return i49 ? x24(r57, e71, i49) : D13(r57, e71, t71.objects), r57;
}
function x24(e71, t71, r57) {
  const i49 = t71.eye, n63 = t71.viewForward, s67 = t71.frustum, a59 = (e72) => e72.visible, o60 = r57.objectCount;
  if (o60 < j19) t64(G15, t71.near, Math.min(e71.near, t71.far)), r57.forEachInDepthRange(i49, n63, Y3.DepthOrder.FRONT_TO_BACK, G15, (r58, i50) => {
    T18(e71, t71, r58), G15.far = e71.near, i50.setRange(G15);
  }, s67, a59), t64(G15, Math.max(e71.far, t71.near), t71.far), r57.forEachInDepthRange(i49, n63, Y3.DepthOrder.BACK_TO_FRONT, G15, (r58, i50) => {
    T18(e71, t71, r58), G15.near = e71.far, i50.setRange(G15);
  }, s67, a59);
  else {
    const i50 = Math.max(Math.min(o60, C24), Math.ceil(o60 * A29)), h32 = r57.findClosest(n63, Y3.DepthOrder.FRONT_TO_BACK, s67, a59, i50), f46 = r57.findClosest(n63, Y3.DepthOrder.BACK_TO_FRONT, s67, a59, i50);
    h32 && f46 && (I23(e71, t71, h32.boundingVolumeWorldSpace.bounds), I23(e71, t71, f46.boundingVolumeWorldSpace.bounds));
  }
}
function D13(e71, t71, r57) {
  U21.clear(), r57.forAll((e72) => {
    e72.visible && 0 !== e72.geometries.length && U21.add(e72);
  }), U21.empty || (U21.sort(t71), t64(G15, t71.near, Math.min(e71.near, t71.far)), U21.forEachInDepthRange(G15, Y3.DepthOrder.FRONT_TO_BACK, (r58, i49) => {
    i49 < e71.near && T18(e71, t71, r58);
  }), t64(G15, Math.max(e71.far, t71.near), t71.far), U21.forEachInDepthRange(G15, Y3.DepthOrder.BACK_TO_FRONT, (t72, r58, i49) => {
    e71.far = Math.max(e71.far, i49);
  }));
}
function T18(e71, t71, i49) {
  if (!i49.visible) return;
  if (!s17(t71.frustum, i49.boundingVolumeWorldSpace.bounds)) return;
  const n63 = i49.transformation, s67 = k22;
  i49.geometries.forEach((i50) => {
    c4(s67, n63, i50.transformation);
    const a59 = m9(s67);
    F15(e71, t71, i50.boundingInfo, s67, a59);
  });
}
function F15(e71, t71, r57, i49, n63) {
  if (null == r57) return;
  O2(V2(V18), r57.center, i49);
  const {
    eye: a59,
    viewForward: o60
  } = t71, f46 = o60[0] * (V18[0] - a59[0]) + o60[1] * (V18[1] - a59[1]) + o60[2] * (V18[2] - a59[2]);
  if (V18[3] = r57.radius * n63, !(f46 - V18[3] > e71.near && f46 + V18[3] < e71.far) && s17(t71.frustum, V18)) if (r57.radius > R15 && r57.getChildren()) for (const s67 of r57.getChildren()) F15(e71, t71, s67, i49, n63);
  else q19.unionDepthRangeWithAABB(e71, t71.viewProjectionMatrix, i49, r57.bbMin, r57.bbMax);
}
function I23(e71, t71, r57) {
  const i49 = t71.eye, n63 = t71.viewForward, s67 = (r57[0] - i49[0]) * n63[0] + (r57[1] - i49[1]) * n63[1] + (r57[2] - i49[2]) * n63[2];
  e71.near = Math.min(e71.near, s67 - r57[3]), e71.far = Math.max(e71.far, s67 + r57[3]);
}
var y26 = class {
  constructor() {
    this._items = new l3({
      allocator: (e71) => e71 || {
        object: null,
        distance: 0,
        near: 0,
        far: 0
      },
      deallocator: (e71) => (e71.object = null, e71.distance = 0, e71.near = 0, e71.far = 0, e71)
    });
  }
  get length() {
    return this._items.length;
  }
  get empty() {
    return 0 === this._items.length;
  }
  clear() {
    this._items.clear();
  }
  add(e71) {
    this._items.pushNew().object = e71;
  }
  sort(e71) {
    const t71 = e71.eye, r57 = e71.viewForward;
    this._items.forAll((e72) => {
      const i49 = e72.object.boundingVolumeWorldSpace.bounds, n63 = (i49[0] - t71[0]) * r57[0] + (i49[1] - t71[1]) * r57[1] + (i49[2] - t71[2]) * r57[2];
      e72.distance = n63, e72.near = n63 - i49[3], e72.far = n63 + i49[3];
    }), this._items.sort((e72, t72) => e72.distance - t72.distance);
  }
  forEachInDepthRange(e71, t71, r57) {
    if (t71 === Y3.DepthOrder.FRONT_TO_BACK) for (let i49 = 0; i49 < this._items.length; ++i49) {
      const t72 = this._items.data[i49];
      t72.far < e71.near || t72.near > e71.far || r57(t72.object, t72.near, t72.far);
    }
    else for (let i49 = this._items.length - 1; i49 >= 0; --i49) {
      const t72 = this._items.data[i49];
      t72.far < e71.near || t72.near > e71.far || r57(t72.object, t72.near, t72.far);
    }
  }
};
var P18 = class {
  constructor() {
    this._view = e15(), this._viewProj = e15(), this._frustum = H3(), this._geometries = new Array(), this._near = [], this._far = [], this._nearCandidates = [], this._farCandidates = [], this._looseRange = {
      near: 0,
      far: 0
    };
  }
  compute(e71, t71) {
    this._reset(), n9(this._view, e71.viewMatrix), c4(this._viewProj, e71.projectionMatrix, this._view), N(this._frustum, e71.frustum);
    const n63 = this._view, s67 = n63[2], a59 = n63[6], o60 = n63[10], h32 = n63[14];
    t71.forAll((e72) => {
      e72.materialReference && e72.forEachGeometry && e72.forEachGeometry((e73) => {
        if (!e73.visible || !e73.castShadow) return;
        const t72 = e73.boundingSphere, r57 = s67 * t72[0] + a59 * t72[1] + o60 * t72[2] + h32, i49 = r57 - t72[3], n64 = r57 + t72[3];
        this._geometries.push(e73), this._near.push(-n64), this._far.push(-i49);
      });
    });
    const f46 = new r52();
    if (0 === this._geometries.length) return f46;
    for (let r57 = 0; r57 < this._geometries.length; ++r57) this._near[r57] > f46.far && (f46.far = this._near[r57]), this._near[r57] > 2 && this._far[r57] < f46.near && (f46.near = this._far[r57]);
    const l47 = this._looseRange;
    l47.near = Math.max(0.5 * f46.near, 2), l47.far = 2 * f46.far;
    let u46 = 0, _30 = 0;
    for (let r57 = 0; r57 < this._geometries.length; ++r57) this._near[r57] < f46.near && (this._near[r57] >= l47.near ? f46.near = this._near[r57] : this._nearCandidates[u46++] = r57), this._far[r57] > f46.far && (this._far[r57] <= l47.far ? f46.far = this._far[r57] : this._farCandidates[_30++] = r57);
    if (0 === this._nearCandidates.length && 0 === this._farCandidates.length) return f46;
    this._nearCandidates.sort((e72, t72) => this._near[e72] < this._near[t72] ? -1 : this._near[e72] > this._near[t72] ? 1 : 0), this._farCandidates.sort((e72, t72) => this._far[e72] < this._far[t72] ? 1 : this._far[e72] > this._far[t72] ? -1 : 0);
    for (let r57 = 0; r57 < this._nearCandidates.length; ++r57) {
      const e72 = this._nearCandidates[r57];
      if (this._near[e72] < f46.near) {
        const t72 = this._geometries[e72], r58 = t72.boundingInfo;
        this._includeNearBoundingInfoRec(r58, t72.shaderTransformation, f46);
      }
    }
    for (let r57 = 0; r57 < this._farCandidates.length; ++r57) {
      const e72 = this._farCandidates[r57];
      if (this._far[e72] > f46.far) {
        const t72 = this._geometries[e72], r58 = t72.boundingInfo;
        this._includeFarBoundingInfoRec(r58, t72.shaderTransformation, f46);
      }
    }
    return this._reset(), f46;
  }
  _reset() {
    this._geometries.length = 0, this._near.length = 0, this._far.length = 0, this._nearCandidates.length = 0, this._farCandidates.length = 0;
  }
  _includeNearBoundingInfoRec(e71, t71, r57) {
    if (null == e71) return;
    const i49 = e71.center;
    O2(V2(V18), i49, t71);
    const n63 = m9(t71), a59 = V18[0], o60 = V18[1], h32 = V18[2], f46 = e71.radius * n63, c44 = this._frustum;
    if (c44[0][0] * a59 + c44[0][1] * o60 + c44[0][2] * h32 + c44[0][3] > f46 || c44[1][0] * a59 + c44[1][1] * o60 + c44[1][2] * h32 + c44[1][3] > f46 || c44[2][0] * a59 + c44[2][1] * o60 + c44[2][2] * h32 + c44[2][3] > f46 || c44[3][0] * a59 + c44[3][1] * o60 + c44[3][2] * h32 + c44[3][3] > f46) return;
    const u46 = this._view[2] * a59 + this._view[6] * o60 + this._view[10] * h32 + this._view[14], d38 = u46 + f46;
    if (!(-(u46 - f46) < 2 || -d38 >= r57.near)) if (-d38 > this._looseRange.near) r57.near = -d38;
    else {
      if (f46 > R15) {
        const i50 = e71.getChildren();
        if (void 0 !== i50) {
          for (const e72 of i50) this._includeNearBoundingInfoRec(e72, t71, r57);
          return;
        }
      }
      q19.unionDepthRangeWithAABB(r57, this._viewProj, t71, e71.bbMin, e71.bbMax);
    }
  }
  _includeFarBoundingInfoRec(e71, t71, r57) {
    if (null == e71) return;
    let i49 = e71.radius;
    const n63 = e71.center;
    O2(V2(V18), n63, t71);
    const a59 = m9(t71), o60 = V18[0], h32 = V18[1], f46 = V18[2];
    i49 *= a59;
    const c44 = this._frustum;
    if (c44[0][0] * o60 + c44[0][1] * h32 + c44[0][2] * f46 + c44[0][3] > i49 || c44[1][0] * o60 + c44[1][1] * h32 + c44[1][2] * f46 + c44[1][3] > i49 || c44[2][0] * o60 + c44[2][1] * h32 + c44[2][2] * f46 + c44[2][3] > i49 || c44[3][0] * o60 + c44[3][1] * h32 + c44[3][2] * f46 + c44[3][3] > i49) return;
    const u46 = this._view[2] * o60 + this._view[6] * h32 + this._view[10] * f46 + this._view[14] - i49;
    if (!(-u46 <= r57.far)) if (-u46 < this._looseRange.far) r57.far = -u46;
    else {
      if (i49 > R15) {
        const i50 = e71.getChildren();
        if (void 0 !== i50) {
          for (const e72 of i50) this._includeFarBoundingInfoRec(e72, t71, r57);
          return;
        }
      }
      q19.unionDepthRangeWithAABB(r57, this._viewProj, t71, e71.bbMin, e71.bbMax);
    }
  }
};
var N16 = class {
  constructor() {
    this._modelViewProj = e15(), this._clipPosition = [n11(), n11(), n11(), n11(), n11(), n11(), n11(), n11()];
  }
  unionDepthRangeWithAABB(e71, t71, i49, n63, s67) {
    const a59 = this._modelViewProj;
    c4(a59, t71, i49);
    let o60 = false;
    for (let r57 = 0; r57 < 8; ++r57) {
      const e72 = this._clipPosition[r57], t72 = 0 === r57 || 3 === r57 || 4 === r57 || 7 === r57 ? n63[0] : s67[0], i50 = 0 === r57 || 1 === r57 || 4 === r57 || 5 === r57 ? n63[1] : s67[1], o61 = r57 < 4 ? n63[2] : s67[2];
      e72[0] = a59[0] * t72 + a59[4] * i50 + a59[8] * o61 + a59[12], e72[1] = a59[1] * t72 + a59[5] * i50 + a59[9] * o61 + a59[13], e72[2] = a59[2] * t72 + a59[6] * i50 + a59[10] * o61 + a59[14], e72[3] = a59[3] * t72 + a59[7] * i50 + a59[11] * o61 + a59[15];
    }
    for (let r57 = 0; r57 < 12; ++r57) {
      const t72 = E36(this._clipPosition[S25[r57][0]], this._clipPosition[S25[r57][1]], this._clipPosition[S25[r57][2]]);
      let i50 = true;
      for (let e72 = 0; e72 < t72.length; ++e72) {
        if (t72[e72][3] >= 2) {
          i50 = false;
          break;
        }
      }
      if (!i50) {
        o60 = true;
        for (let r58 = 0; r58 < t72.length; ++r58) {
          const i51 = t72[r58][3];
          Number.isFinite(i51) && (e71.near = Math.min(i51, e71.near), e71.far = Math.max(i51, e71.far));
        }
      }
    }
    return o60;
  }
};
function E36(e71, t71, r57) {
  let i49 = [e71, t71, r57];
  for (let n63 = 0; n63 < 4; ++n63) {
    const e72 = i49;
    i49 = [];
    for (let t72 = 0; t72 < e72.length; ++t72) {
      const r58 = e72[t72], s67 = e72[(t72 + 1) % e72.length];
      W10(s67, n63) ? (W10(r58, n63) || i49.push(K13(r58, s67, n63)), i49.push(s67)) : W10(r58, n63) && i49.push(K13(r58, s67, n63));
    }
  }
  return i49;
}
function W10(e71, t71) {
  return 0 === t71 ? e71[0] >= -e71[3] : 1 === t71 ? e71[1] >= -e71[3] : 2 === t71 ? e71[0] <= e71[3] : 3 === t71 ? e71[1] <= e71[3] : void s14(false);
}
function K13(e71, t71, r57) {
  let i49 = 0;
  return 0 === r57 ? i49 = (-e71[3] - e71[0]) / (t71[0] - e71[0] + t71[3] - e71[3]) : 1 === r57 ? i49 = (-e71[3] - e71[1]) / (t71[1] - e71[1] + t71[3] - e71[3]) : 2 === r57 ? i49 = (e71[3] - e71[0]) / (t71[0] - e71[0] - t71[3] + e71[3]) : 3 === r57 && (i49 = (e71[3] - e71[1]) / (t71[1] - e71[1] - t71[3] + e71[3])), _3(n11(), e71, t71, i49);
}
var S25 = [[0, 1, 3], [2, 3, 1], [1, 5, 2], [6, 2, 5], [5, 4, 6], [7, 6, 4], [4, 0, 7], [3, 7, 0], [3, 2, 7], [6, 7, 2], [4, 5, 0], [1, 0, 5]];
var V18 = _5();
var k22 = e15();
var G15 = a50();
var U21 = new y26();
var Q17 = new P18();
var q19 = new N16();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper.js
var o55 = class {
  constructor() {
    this.declaredClass = "esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper", this.colorZero = new x5(new ArrayBuffer(4)), this._layerToOidToColor = new t14(), this._colorToUID = /* @__PURE__ */ new Map(), this._layerUidToGraphicsUidToObjectId = new t14(), this._layerUidToId = /* @__PURE__ */ new Map(), this._layerUidToPopupEnabled = /* @__PURE__ */ new Map();
  }
  setUidToObjectAndLayerId(e71, r57, t71, o60, i49, d38 = null, a59 = null, s67 = null) {
    e71 && r57 && t71 && o60 && (this._layerUidToId.set(o60, t71), this._layerUidToPopupEnabled.set(o60, i49), i49 && this._layerUidToGraphicsUidToObjectId.set(o60, r57, {
      objectId: e71,
      attributeNodeId: d38,
      attributeIndex: a59,
      subLayerId: s67
    }));
  }
  getObjectAndLayerIdColor(e71) {
    const t71 = this.getObjectAndLayerIdColorArray(e71);
    return r6(t71.get(0, 1), t71.get(0, 2), t71.get(0, 3), 255);
  }
  getObjectAndLayerIdColorArray(e71) {
    if (!e71.layerUid || !e71.graphicUid) return this.colorZero;
    const r57 = this._layerUidToPopupEnabled.get(e71.layerUid);
    if (void 0 === r57) return this.colorZero;
    if (false === r57) return this.colorZero;
    const o60 = this._layerUidToGraphicsUidToObjectId.get(e71.layerUid, e71.graphicUid)?.objectId;
    if (!o60) return this.colorZero;
    let i49 = this._layerToOidToColor.get(e71.layerUid, o60);
    if (!i49) {
      for (; !i49; ) {
        const e72 = Math.floor(16777214 * Math.random()) + 1;
        this._colorToUID.has(e72) || (i49 = e72);
      }
      if (i49 > 16777215) throw new Error("Object ID Overflow");
      this._layerToOidToColor.set(e71.layerUid, o60, i49), this._colorToUID.set(i49, e71);
    }
    const d38 = new ArrayBuffer(4);
    new DataView(d38).setUint32(0, i49, false);
    return new x5(d38);
  }
  getColorToObjectAndLayerIdMapping() {
    const e71 = /* @__PURE__ */ new Map();
    for (const [r57, t71] of this._colorToUID.entries()) {
      const o60 = this._layerUidToGraphicsUidToObjectId.get(t71.layerUid, t71.graphicUid), i49 = this._layerUidToId.get(t71.layerUid);
      o60 && i49 && e71.set(r57, o60.attributeNodeId ? {
        type: "object-and-layer-and-i3s-id",
        oid: o60.objectId,
        lid: i49,
        attrId: o60.attributeNodeId,
        attrIdx: o60.attributeIndex,
        subLayerId: o60.subLayerId
      } : {
        type: "object-and-layer-id",
        oid: o60.objectId,
        lid: i49
      });
    }
    return e71;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl.js
var n57;
var t65;
!function(e71) {
  e71.OPAQUE = "opaque-color", e71.TRANSPARENT = "transparent-color", e71.COMPOSITE = "composite-color", e71.FINAL = "final-color";
}(n57 || (n57 = {})), function(e71) {
  e71.ANTIALIASING = "aa-color", e71.HIGHLIGHTS = "highlight-color", e71.MAGNIFIER = "magnifier-color";
}(t65 || (t65 = {}));

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedFBObject.js
var e64 = class {
  constructor(e71, t71) {
    this.key = e71, this.free = t71, this.incarnation = 0, this._refCount = 1;
  }
  retain(e71 = 1) {
    this._refCount += e71;
  }
  release() {
    return 0 === this._refCount ? (console.log(`Releasing already released FBO attachment in ${new Error().stack}`), true) : (--this._refCount, 0 === this._refCount && (this.free(), true));
  }
};
var t66;
!function(e71) {
  e71[e71.FBO = 0] = "FBO", e71[e71.DEPTH = 1] = "DEPTH", e71[e71.COLOR = 2] = "COLOR";
}(t66 || (t66 = {}));

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedFBOAttachment.js
var e65 = class extends e64 {
  constructor(t71, e71, s67) {
    super(t71, s67), this.attachment = e71, this.name = "";
  }
  dispose() {
    this.attachment.dispose();
  }
  get usedMemory() {
    return this.attachment.usedMemory;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedColorAttachment.js
var s65 = class extends e65 {
  constructor(t71, s67, a59) {
    super(t71, s67, a59), this.attachment = s67, this.type = t66.COLOR;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedDepthAttachment.js
var r54 = class extends e65 {
  constructor() {
    super(...arguments), this.type = t66.DEPTH;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedDepthTexture.js
function e66(e71) {
  return e71?.attachment.type === e21.Texture;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl/ManagedFBO.js
var i46 = class extends e64 {
  constructor(t71, e71, h32, o60, r57, i49) {
    super(t71, i49), this.type = t66.FBO, this._colors = /* @__PURE__ */ new Map(), this._name = "composite-color", this.acquireDepth = null, this.acquireColor = null, this._name = e71, this.fbo = h32, this.acquireDepth = o60, this.acquireColor = r57;
  }
  dispose() {
    this.fbo?.dispose();
  }
  get usedMemory() {
    return this.fbo?.usedMemory || 0;
  }
  get name() {
    return this._name;
  }
  setName(t71) {
    this._name = t71;
  }
  getTexture(t71 = X4.COLOR_ATTACHMENT0) {
    return t71 === t7 ? this.fbo?.depthStencilTexture : this.fbo?.getColorTexture(t71);
  }
  getAttachment(t71 = X4.COLOR_ATTACHMENT0) {
    return t71 === t7 ? this._depth : this._colors.get(t71);
  }
  attachDepth(t71) {
    return t71?.retain(), this.detachDepth(), t71 && this.fbo?.attachDepthStencil(t71.attachment), this._depth = t71, this;
  }
  detachDepth() {
    this.fbo?.detachDepthStencilTexture(), this.fbo?.detachDepthStencilBuffer(), this._depth = t2(this._depth);
  }
  obtainDepthTexture() {
    const t71 = this._depth;
    return e66(t71) ? (this.fbo?.detachDepthStencilTexture(), this._depth = null, t71) : null;
  }
  attachColor(t71, e71) {
    return t71.retain(), this.detachColor(e71), this.fbo?.attachColorTexture(t71.attachment, e71), this._colors.set(e71, t71), this;
  }
  detachColor(t71) {
    this.fbo?.detachColorTexture(t71);
    const e71 = this._colors.get(t71);
    this._colors.delete(t71), e71?.release();
  }
  detachAll() {
    this._colors.forEach((t71, e71) => this.detachColor(e71)), this.detachDepth();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/core/FBOPool.js
var i47 = class {
  constructor(i49, e71) {
    this._last = new l3(), this._incarnation = 0, this._cache = new c19(i49, e71);
  }
  destroy() {
    this._last?.forAll((t71) => t71.dispose()), this._last = null, this._cache.destroy();
  }
  set interactive(t71) {
    t71 && !this._last ? this._last = new l3() : t71 || (this._last?.forAll((t72) => t72.dispose()), this._last = null);
  }
  clean() {
    this._last?.filterInPlace((t71) => !(t71.incarnation < this._incarnation) || (this._cache.put(t71.key, t71), false));
  }
  frame() {
    ++this._incarnation;
  }
  pop(t71) {
    if (this._last) {
      const s67 = this._last.find((s68) => s68.key === t71);
      if (s67) return this._last.removeUnordered(s67), s67;
    }
    return this._cache.pop(t71);
  }
  put(t71) {
    t71.incarnation = this._incarnation, this._last ? this._last.push(t71) : this._cache.put(t71.key, t71);
  }
  get usedMemory() {
    return this._last?.reduce((t71, s67) => t71 + s67.usedMemory, 0) ?? 0;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/core/FBOCache.js
var f41 = class {
  constructor(e71) {
    this.rctx = e71, this._acquired = /* @__PURE__ */ new Set(), this._cache = new i47(e71.newCache, "FBOCache"), this._depthCache = new i47(e71.newCache, "DepthAttachmentCache"), this._colorCache = new i47(e71.newCache, "ColorAttachmentCache");
  }
  destroy() {
    this._cache.destroy(), this._depthCache.destroy(), this._colorCache.destroy();
  }
  clean() {
    this._cache.clean(), this._colorCache.clean(), this._depthCache.clean();
  }
  frameStart() {
    this._cache.frame(), this._colorCache.frame(), this._depthCache.frame(), this.debugCallback && this.debugCallback();
  }
  frameEnd() {
    const e71 = this.debugCallback;
    e71 && this._acquired.forEach((t71) => t71.type === t66.FBO && e71(t71.name, t71.fbo));
  }
  get usedMemory() {
    return Array.from(this._acquired.values()).reduce((e71, t71) => e71 + ("getTexture" in t71 ? t71.getTexture()?.usedMemory ?? 0 : t71.usedMemory), this._cache.usedMemory + this._colorCache.usedMemory + this._depthCache.usedMemory);
  }
  set interactive(e71) {
    this._cache.interactive = this._colorCache.interactive = this._depthCache.interactive = e71;
  }
  acquire(r57, a59, h32, i49 = R4.RGBA) {
    const o60 = b24(i49, r57, a59);
    let s67 = this._cache.pop(o60);
    if (s67) {
      s67.retain(), s67.setName(h32);
      const e71 = this.rctx.getBoundFramebufferObject();
      this.rctx.bindFramebuffer(s67.fbo), this.rctx.setDrawBuffers([X4.COLOR_ATTACHMENT0]), this.rctx.bindFramebuffer(e71);
    } else s67 = new i46(o60, h32, new E11(this.rctx, __spreadProps(__spreadValues({}, O32[i49]), {
      width: r57,
      height: a59
    })), (e71) => {
      e71 ??= E13.DEPTH_STENCIL_TEXTURE;
      const r58 = this._acquireDepth(e71, s67.fbo.width, s67.fbo.height, `${s67.name} depth`);
      return s67.attachDepth(r58), r58.release(), s67;
    }, (t71, c44) => {
      c44 ??= R4.RGBA;
      const h33 = this._acquireColor(c44, r57, a59, `${s67.name} color ${t71}`);
      return s67.attachColor(h33, t71), h33.release(), s67;
    }, () => {
      this.debugCallback && this.debugCallback(s67.name, s67.fbo), this._acquired.delete(s67), s67.detachAll(), this._cache.put(s67);
    });
    return this._trackHandle(s67);
  }
  acquireDepth(e71, t71, r57, a59) {
    return this._acquireDepth(e71, t71, r57, a59);
  }
  _acquireDepth(e71, r57, c44, h32) {
    const i49 = b24(e71, r57, c44), o60 = this._depthCache.pop(i49);
    if (o60) return o60.retain(), o60.name = h32, this._trackHandle(o60);
    const s67 = e71 === E13.DEPTH_STENCIL_TEXTURE ? new r54(i49, new c8(this.rctx, __spreadProps(__spreadValues({}, N17[e71]), {
      width: r57,
      height: c44
    })), () => {
      this._acquired.delete(s67), this._depthCache.put(s67);
    }) : new r54(i49, new s16(this.rctx, __spreadProps(__spreadValues({}, N17[e71]), {
      width: r57,
      height: c44
    })), () => {
      this._acquired.delete(s67), this._depthCache.put(s67);
    });
    return s67.name = h32, this._trackHandle(s67);
  }
  _acquireColor(e71, t71, a59, c44) {
    const h32 = b24(e71, t71, a59), i49 = this._colorCache.pop(h32);
    if (i49) return i49.retain(), i49.name = c44, this._trackHandle(i49);
    const o60 = new s65(h32, new c8(this.rctx, __spreadProps(__spreadValues({}, O32[e71]), {
      width: t71,
      height: a59
    })), () => {
      this._acquired.delete(o60), this._colorCache.put(o60);
    });
    return o60.name = c44, this._trackHandle(o60);
  }
  _trackHandle(e71) {
    return this._acquired.add(e71), e71;
  }
};
var T19 = new i46("default", "default", null, () => T19, () => T19, () => {
});
function b24(e71, t71, r57) {
  return `${e71}x${t71}x${r57}`;
}
var A30 = new e22();
A30.pixelFormat = G4.RED, A30.internalFormat = P5.R8, A30.wrapMode = D2.CLAMP_TO_EDGE;
var g27 = new e22();
g27.pixelFormat = G4.RG, g27.internalFormat = P5.RG8, g27.wrapMode = D2.CLAMP_TO_EDGE;
var M15 = new e22();
M15.internalFormat = P5.RGBA4, M15.dataType = U6.UNSIGNED_SHORT_4_4_4_4, M15.wrapMode = D2.CLAMP_TO_EDGE;
var R16 = new e22();
R16.wrapMode = D2.CLAMP_TO_EDGE;
var F16 = new e22();
F16.wrapMode = D2.CLAMP_TO_EDGE, F16.samplingMode = L5.LINEAR_MIPMAP_LINEAR, F16.hasMipmap = true, F16.maxAnisotropy = 8;
var D14 = new e22();
D14.pixelFormat = G4.RED, D14.dataType = U6.HALF_FLOAT, D14.internalFormat = P5.R16F, D14.samplingMode = L5.NEAREST;
var x25 = new e22();
x25.dataType = U6.HALF_FLOAT, x25.internalFormat = P5.RGBA16F, x25.samplingMode = L5.NEAREST;
var O32 = {
  [R4.RED]: A30,
  [R4.RG]: g27,
  [R4.RGBA4]: M15,
  [R4.RGBA]: R16,
  [R4.RGBA_MIPMAP]: F16,
  [R4.R16F]: D14,
  [R4.RGBA16F]: x25
};
var G16 = new e22();
G16.pixelFormat = G4.DEPTH_STENCIL, G16.dataType = U6.UNSIGNED_INT_24_8, G16.samplingMode = L5.NEAREST, G16.wrapMode = D2.CLAMP_TO_EDGE;
var N17 = {
  [E13.DEPTH_STENCIL_TEXTURE]: G16,
  [E13.DEPTH16_BUFFER]: new i9(B3.DEPTH_COMPONENT16, 4)
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/core/renderPasses/RenderPass.js
var a56;
!function(e71) {
  e71[e71.FrontToBack = 0] = "FrontToBack", e71[e71.BackToFront = 1] = "BackToFront";
}(a56 || (a56 = {}));
var i48 = class {
  constructor(t71, r57, i49 = a56.FrontToBack) {
    this._rctx = t71, this._techniques = r57, this._sorting = i49, this._draws = new l3({
      initialSize: 32,
      allocator: (e71) => e71 || {
        material: null,
        geometry: null,
        geometryRanges: null,
        bindDrawParams: null,
        depthSquaredHint: 0,
        indexType: 0
      }
    }), this._previouslyBoundDraw = /* @__PURE__ */ new Map();
  }
  submitDraw(e71, t71, r57, a59) {
    const i49 = this._draws.pushNew();
    i49.geometry = t71, i49.geometryRanges = r57, i49.material = e71, i49.depthSquaredHint = a59, i49.indexType = (t71.indexed ? t71.vao.indexBuffer.indexType : null) ?? 0;
  }
  prepare(e71, t71) {
    return this._draws.map((r57) => r57.material.prepareTechnique(this._techniques, e71, t71, r57.geometry.parameters));
  }
  dispatch(e71, r57, a59) {
    const i49 = this._rctx;
    this._previouslyBoundDraw.clear();
    let s67 = null;
    const o60 = this._draws.length;
    for (let l47 = 0; l47 < o60; l47++) {
      const o61 = a59[l47];
      o61 === s67 && o61.configuration.transparencyPassType === o16.NONE || (i49.bindTechnique(o61, r57, e71), s67 = o61);
      const p49 = this._draws.data[l47], d38 = p49.geometry;
      i49.bindVAO(d38.vao), this._previouslyBoundDraw.get(o61) !== p49.material && (o61.program.bindDraw(p49.material, r57, e71), this._previouslyBoundDraw.set(o61, p49.material));
      const c44 = p49.geometryRanges, u46 = c44.length;
      if (0 !== p49.indexType) {
        const e72 = n58.get(p49.indexType);
        for (let t71 = 0; t71 < u46; t71 += 2) {
          const r58 = c44[t71], a60 = c44[t71 + 1];
          i49.drawElements(d38.primitiveType, a60, p49.indexType, r58 * e72);
        }
      } else for (let e72 = 0; e72 < u46; e72 += 2) {
        const t71 = c44[e72], r58 = c44[e72 + 1];
        i49.drawArrays(d38.primitiveType, t71, r58);
      }
    }
  }
  prepareSubmit() {
    this._draws.clear();
  }
  finishSubmit() {
    const e71 = this._sorting === a56.FrontToBack ? 1 : -1;
    this._draws.sort((t71, r57) => {
      const a59 = e71 * (t71.depthSquaredHint - r57.depthSquaredHint);
      return 0 !== a59 ? a59 : t71.geometry.vao.byteSize - r57.geometry.vao.byteSize;
    });
  }
  get count() {
    return this._draws.length;
  }
};
var n58 = /* @__PURE__ */ new Map();
n58.set(C5.UNSIGNED_BYTE, 1), n58.set(C5.UNSIGNED_SHORT, 2), n58.set(C5.UNSIGNED_INT, 4);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/core/renderPasses/RenderPassManager.js
var M16 = class extends i20 {
  constructor() {
    super({}), this._passes = null, this.produces = /* @__PURE__ */ new Map([[E12.OPAQUE_MATERIAL, (s67) => this._produces(s67)], [E12.TRANSPARENT_MATERIAL, (s67) => !!(this._passes && this._passes.materialTransparent.count > 0) && this._produces(s67)], [E12.INTEGRATED_MESH, (s67) => this._produces(s67)]]), this._materialPassParameters = new h11(), this._shadowPassParameters = new l17(), this._highlightPassParameters = new n29(), this._viewshedPassParameters = new c17(), this._systems = /* @__PURE__ */ new Set();
  }
  initializeRenderContext(s67) {
    this._context = s67;
    const e71 = s67.renderContext.rctx, t71 = s67.techniques;
    this._passes = {
      materialOpaque: new i48(e71, t71),
      materialTransparent: new i48(e71, t71, a56.BackToFront),
      materialIntegratedMesh: new i48(e71, t71),
      shadowMap: new i48(e71, t71),
      highlight: new i48(e71, t71),
      highlightIntegratedMesh: new i48(e71, t71),
      highlightShadowMap: new i48(e71, t71),
      viewshedShadowMap: new i48(e71, t71),
      defaultShadowMap: new i48(e71, t71)
    };
  }
  get rctx() {
    return this._context.renderContext.rctx;
  }
  uninitializeRenderContext() {
  }
  dispose() {
    this._context = null, this._systems.clear();
  }
  register(s67) {
    this._systems.add(s67);
  }
  _produces(s67) {
    return 0 !== this._systems.size && null !== this._passes && (s67 === o9.Highlight ? this._passes.highlight.count > 0 || this._passes.highlightIntegratedMesh.count > 0 : s67 !== o9.ShadowHighlight || this._passes.highlight.count > 0);
  }
  prepareRender(s67) {
    if (0 !== this._systems.size && null !== this._passes) {
      for (const s68 of Object.values(this._passes)) s68.prepareSubmit();
      this._systems.forEach((e71) => e71.submit(this._passes, s67.bindParameters));
      for (const s68 of Object.values(this._passes)) s68.finishSubmit();
      this._context.techniques.frameUpdate();
    }
  }
  prepareTechniques(s67) {
    if (0 === this._systems.size) return null;
    const e71 = s67.output === o9.Shadow || s67.output === o9.ShadowHighlight || s67.output === o9.ShadowExcludeHighlight ? this._shadowPassParameters : s67.output === o9.ViewshedShadow ? this._viewshedPassParameters : s67.output === o9.Highlight ? this._highlightPassParameters : this._materialPassParameters, t71 = s67.bindParameters;
    return this._updateParameters(t71.camera, e71, t71.slot === E12.TRANSPARENT_MATERIAL), this._materialPassParameters.output = s67.output, this._invoke(s67, (e72, t72) => e72.prepare(t72, s67.bindParameters));
  }
  renderNode(s67, e71) {
    this._invoke(s67, (t71, a59) => t71.dispatch(a59, s67.bindParameters, e71));
  }
  _invoke(s67, e71) {
    if (null === this._passes) return null;
    switch (s67.bindParameters.slot) {
      case E12.OPAQUE_MATERIAL:
        switch (s67.output) {
          case o9.Color:
          case o9.Depth:
          case o9.Normal:
          case o9.ObjectAndLayerIdColor:
            return e71(this._passes.materialOpaque, this._materialPassParameters);
          case o9.Highlight:
            return e71(this._passes.highlight, this._highlightPassParameters);
          case o9.Shadow:
            return e71(this._passes.shadowMap, this._shadowPassParameters);
          case o9.ShadowHighlight:
            return e71(this._passes.highlightShadowMap, this._shadowPassParameters);
          case o9.ShadowExcludeHighlight:
            return e71(this._passes.defaultShadowMap, this._shadowPassParameters);
          case o9.ViewshedShadow:
            return e71(this._passes.viewshedShadowMap, this._viewshedPassParameters);
        }
        break;
      case E12.TRANSPARENT_MATERIAL:
        switch (s67.output) {
          case o9.Color:
          case o9.Depth:
          case o9.Normal:
          case o9.ObjectAndLayerIdColor:
            return e71(this._passes.materialTransparent, this._materialPassParameters);
        }
        break;
      case E12.INTEGRATED_MESH:
        switch (s67.output) {
          case o9.Color:
          case o9.Depth:
          case o9.Normal:
          case o9.ObjectAndLayerIdColor:
            return e71(this._passes.materialIntegratedMesh, this._materialPassParameters);
          case o9.Highlight:
            return e71(this._passes.highlightIntegratedMesh, this._highlightPassParameters);
        }
    }
    return null;
  }
  notifyDirty() {
    this._context.requestRender();
  }
  queryDepthRange(s67) {
    const e71 = new r52();
    return this._systems.forEach((t71) => e62(e71, t71.queryShadowCasterDepthRange(s67))), e71;
  }
  _updateParameters(s67, e71, i49) {
    const m45 = s67.viewInverseTransposeMatrix;
    o4(j20, m45[3], m45[7], m45[11]), T20.set(j20), r5(e71.transformWorldFromViewTH, T20.high), r5(e71.transformWorldFromViewTL, T20.low), r5(e71.slicePlaneLocalOrigin, j20), n16(e71.transformViewFromCameraRelativeRS, s67.viewMatrix), n9(e71.transformProjFromView, s67.projectionMatrix), e71.identifier === o28.Material && (this._materialPassParameters.transparent = i49, u8(A31, e71.transformViewFromCameraRelativeRS), s12(e71.transformNormalViewFromGlobal, A31));
  }
};
M16 = e6([a4("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")], M16);
var j20 = n7();
var A31 = e16();
var T20 = new e34();

// ../../../node_modules/@arcgis/core/views/3d/webgl/utils.js
function n59(n63) {
  return n63.name;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/RenderNodes.js
var n60 = class {
  constructor(e71) {
    this._context = e71, this._nodes = new l3();
  }
  destroy() {
    this._nodes.forEach((e71) => e71.destroy()), this._nodes.clear();
  }
  add(e71) {
    this._nodes.push(e71), n17 && console.log(`Registered render nodes: ${this._nodes.map(({
      declaredClass: e72
    }) => e72).join(", ")}`);
  }
  remove(e71) {
    this._nodes.remove(e71), n17 && console.log(`Registered render nodes: ${this._nodes.map(({
      declaredClass: e72
    }) => e72).join(", ")}`);
  }
  produces(e71) {
    return this._nodes.some(({
      produces: o60
    }) => o60 === e71);
  }
  require(e71, ...o60) {
    const s67 = this._nodes;
    return o60.reduce((o61, r57) => o61 + s67.reduce((o62, {
      consumes: s68,
      produces: t71
    }) => o62 + (s68.required.includes(e71) && t71 === r57 ? 1 : 0), 0), 0);
  }
  optional(e71, ...o60) {
    const s67 = this._nodes;
    return o60.reduce((o61, r57) => o61 + s67.reduce((o62, {
      consumes: s68,
      produces: t71
    }) => o62 + (s68.optional?.includes(e71) && t71 === r57 ? 1 : 0), 0), 0);
  }
  updateAnimation() {
    return this._nodes.reduce((e71, o60) => o60.updateAnimation() || e71, false);
  }
  render(o60, t71, n63 = () => {
  }) {
    const c44 = n59(o60) ? o60.name : o60, d38 = this._nodes.filter(({
      produces: e71
    }) => e71 === c44);
    return 0 === d38.length || (d38.forEach((r57) => {
      const d39 = n59(o60) ? [o60] : [];
      for (const e71 of r57.consumes.required) {
        if (e71 === c44) continue;
        const o61 = t71.get(e71);
        if (!o61) return void (n63 && n63(d39));
        d39.push(o61);
      }
      if (r57.consumes.optional) for (const e71 of r57.consumes.optional) {
        if (e71 === c44) continue;
        const o61 = t71.get(e71);
        o61 && d39.push(o61);
      }
      try {
        const e71 = r57.doRender(d39, this._context);
        e71 && e71 !== o60 && (n59(o60) ? (o60.release(), o60 = e71, t71.set(c44, o60)) : o60 = e71);
      } catch (i49) {
        n.getLogger(r57).errorOnce(i49);
      }
      n63 && n63(d39);
    }), this._context.rctx.enforceState()), n59(o60) ? o60 : T19;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/RenderPluginManager.js
var h30 = class {
  constructor(r57) {
    this._context = r57, this._renderPlugins = new l3(), this._materialRenderers = /* @__PURE__ */ new Map(), this._slots = new Array(), this._renderVersion = r12(0);
    for (let e71 = 0; e71 < E12.MAX_SLOTS; ++e71) this._slots[e71] = [];
  }
  destroy() {
    this._renderPlugins.forEach((e71) => e71.destroy()), this._renderPlugins.clear(), this._materialRenderers.clear();
  }
  get plugins() {
    return this._renderPlugins;
  }
  add(e71, n63) {
    const s67 = () => {
      if (n63?.aborted) throw e71.uninitializeRenderContext(), u2();
      this._renderPlugins.push(e71), e71.materialReference && this._materialRenderers.set(e71.materialReference, e71), e71.produces.forEach((r57, t71) => {
        this._slots[t71].push(e71);
      }), this._context.requestRender(), this._renderVersion.value++;
    }, i49 = e71.initializeRenderContext(this._context, n63);
    if (S2(i49)) return i49.then(s67);
    s67();
  }
  remove(e71) {
    if (null != e71.materialReference && this._materialRenderers.delete(e71.materialReference), null != this._renderPlugins.removeUnordered(e71)) {
      for (let r57 = 0; r57 < this._slots.length; ++r57) this._slots[r57] = this._slots[r57].filter((r58) => r58 !== e71);
      e71.uninitializeRenderContext(), this._context.requestRender(), this._renderVersion.value++;
    }
  }
  prepareRender() {
    this._renderPlugins.forAll((e71) => {
      e71.prepareRender && e71.prepareRender(this._context.renderContext);
    });
  }
  updateAnimation(e71) {
    let r57 = false;
    return this._renderPlugins.forAll((t71) => {
      t71.updateAnimation && (r57 = t71.updateAnimation(e71) || r57);
    }), r57;
  }
  renderFeatureChanged() {
    this._renderPlugins.forAll((e71) => {
      e71.renderFeatureChanged && e71.renderFeatureChanged();
    });
  }
  prepare(...e71) {
    for (const r57 of e71) this._context.renderContext.bindParameters.slot = r57, this._slots[r57].forEach((e72) => {
      const t71 = e72.produces.get(r57);
      t71?.(o9.Color) && (a24(e72) && e72.prepareTechnique(this._context.renderContext), l18(e72) && e72.prepareTechniques(this._context.renderContext));
    });
  }
  _getRenderables() {
    const e71 = this._context.renderContext.bindParameters.slot, r57 = this._context.renderContext.output ?? o9.Color, t71 = /* @__PURE__ */ new Map();
    return this._slots[e71].forEach((n63) => {
      const s67 = n63.produces.get(e71);
      if (s67?.(r57) && (!n63.isDecoration || this._context.renderContext.bindParameters.decorations !== i11.OFF)) if (a24(n63)) {
        const e72 = n63.prepareTechnique(this._context.renderContext);
        null != e72 && t71.set(n63, e72);
      } else if (l18(n63)) {
        const e72 = n63.prepareTechniques(this._context.renderContext);
        null != e72 && t71.set(n63, e72);
      } else t71.set(n63, null);
    }), t71;
  }
  render(e71, ...r57) {
    for (const t71 of r57) this._context.renderContext.bindParameters.slot = t71, this._getRenderables().forEach((r58, t72) => t72.renderNode(this._context.renderContext, r58, e71));
  }
  queryDepthRange(e71) {
    const r57 = new r52();
    return this._renderPlugins.forAll((t71) => {
      const n63 = t71.queryDepthRange?.(e71);
      e62(r57, n63);
    }), r57;
  }
  get updating() {
    return this._renderVersion.value >= 0 && this._renderPlugins.some((e71) => e71.running);
  }
  produces(e71, ...r57) {
    for (const t71 of r57) if (this._slots[t71].some((r58) => {
      const n63 = r58.produces.get(t71);
      return !!n63 && n63(e71);
    })) return true;
    return false;
  }
  consumes(e71) {
    return this._renderPlugins.some((r57) => r57.consumes().required.includes(e71));
  }
  getMaterialRenderer(e71) {
    return this._materialRenderers.get(e71);
  }
  removeEmptyMaterialRenderers() {
    this._renderPlugins.filterInPlace((e71) => !e71.materialReference || 0 !== e71.numGeometries || (this._materialRenderers.delete(e71.materialReference), e71.destroy(), false));
  }
  get hasDecorations() {
    return this._renderPlugins.some((e71) => e71.isDecoration);
  }
  get hasOccludees() {
    return this._renderPlugins.some((e71) => e71.hasOccludees);
  }
  get renderOccludedFlags() {
    return this._renderPlugins.reduce((e71, r57) => e71 | r57.renderOccludedFlags, h8.None);
  }
  get usedMemory() {
    return this._renderPlugins.reduce((e71, r57) => null !== r57.materialReference ? e71 : e71 + (r57.usedMemory ?? 0), 0);
  }
  get test() {
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/blit/Blit.js
var o56 = class {
  constructor(e71) {
    this.techniques = e71, this._blitConfiguration = new p45(), this._blitParameters = new l22();
  }
  render(i49, t71, o60, n63, a59) {
    i49.bindFramebuffer(o60.fbo);
    const m45 = this.techniques.acquire(p46, this._blitConfiguration);
    return i49.setClearColor(0, 0, 0, 1), i49.clear(_7.COLOR_BUFFER_BIT), m45?.compiled ? (this._blitParameters.texture = t71.getTexture(), i49.bindTechnique(m45, n63, this._blitParameters), i49.screen.draw(), m45.release(), o60) : (a59(O7.UPDATE), o60);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/AnimationTimeStep.js
var e67 = class {
  constructor() {
    this._step = m40, this._dilation = 1, this._firstIdleTime = n3(0);
  }
  frame(e71, _30) {
    _30 ? 0 === this._firstIdleTime && (this._firstIdleTime = n3(performance.now())) : this._firstIdleTime = n3(0);
    if (!has("disable-feature:high-quality-idle")) {
      const t71 = _30 ? performance.now() - this._firstIdleTime : 0;
      if (t71 >= r55 + o57) return this._step = n3(1 / 0), void (this._dilation = 1);
      this._dilation = t71 >= r55 ? h31 : 1;
    } else this._dilation = 1;
    const n63 = e12(e71 / s66, m40, a57);
    this._step === 1 / 0 ? this._step = n3(n63) : this._step = n3(this._step * l45 + n63 * (1 - l45));
  }
  get value() {
    return this._step;
  }
  get timeDilation() {
    return this._dilation;
  }
  clear() {
    this._step = this._firstIdleTime = n3(0);
  }
};
var s66 = 0.5;
var r55 = n3(12e4);
var o57 = n3(1e4);
var h31 = 10;
var l45 = 0.9;
var _27 = 30;
var m40 = n3(1e3 / 1);
var a57 = n3(1e3 / _27);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/OffscreenRendering.js
var f42 = class {
  constructor(t71, e71) {
    this._fbos = t71, this.compositingHelper = e71, this._width = 4, this._height = 4, this._clearColor = n11();
  }
  dispose() {
    this._color = t2(this._color), this.releaseBuffers();
  }
  get framebuffer() {
    return this.color.attachDepth(this.depth), this.color.fbo;
  }
  get colorTexture() {
    return this.color.getTexture();
  }
  get depthTexture() {
    return this.depth.attachment;
  }
  initializeFrame(t71, r57, i49) {
    this._fbos.interactive = i49 === r30.Default;
    const h32 = this._fbos.rctx;
    this._width = t71.fullWidth, this._height = t71.fullHeight, A6(this, h32.parameters.maxTextureSize);
    const o60 = this._color;
    return this._color = null, this.releaseBuffers(), a9(this._clearColor, r57), o60;
  }
  releaseBuffers() {
    this._color?.detachDepth(), this._depth = t2(this._depth);
  }
  renderHUDVisibility(t71, e71, r57) {
    return t71?.fbo?.width === this._width && t71?.fbo?.height === this._height || (t71?.release(), t71 = this._fbos.acquire(this._width, this._height, "hud visibility", R4.RGBA4)), t71.attachDepth(r57 || this.depth), this._fbos.rctx.bindFramebuffer(t71.fbo), this._fbos.rctx.clearFramebuffer(_28), e71(), t71.detachDepth(), t71;
  }
  compositeToHUDVisibility(t71, e71) {
    this._fbos.rctx.bindFramebuffer(t71.hudVisibility?.fbo), this.compositingHelper.compositeHUD(t71, e71);
  }
  renderOITPass(t71, e71, r57) {
    let s67, a59;
    const {
      _width: l47,
      _height: f46
    } = this;
    switch (e71) {
      case o16.ColorAlpha:
        s67 = this._fbos.acquire(l47, f46, r57 ? "oit hud color alpha" : "oit color alpha", R4.RGBA16F), s67.acquireColor(X4.COLOR_ATTACHMENT1, R4.R16F), a59 = [0, 0, 0, 1];
        break;
      case o16.FrontFace:
        s67 = this._fbos.acquire(l47, f46, r57 ? "oit hud front" : "oit front"), a59 = [0, 0, 0, 0];
    }
    return r57 ? s67.acquireDepth(E13.DEPTH16_BUFFER) : s67.attachDepth(this.depth), this._fbos.rctx.bindFramebuffer(s67.fbo), this._fbos.rctx.clearFramebuffer(a59, r57, r57), t71(), s67.detachDepth(), s67;
  }
  compositeToFramebuffer(t71, e71, r57, i49) {
    this.bindFbo(), this.compositingHelper.composite(t71, e71, r57, i49);
  }
  compositeOIT(t71, e71, r57, i49) {
    i49 ? (this._fbos.rctx.bindFramebuffer(i49.fbo), this._fbos.rctx.setClearColor(0, 0, 0, 1e-13), this._fbos.rctx.clear(_7.COLOR_BUFFER_BIT)) : this.bindFbo(), this.compositingHelper.compositeOIT(t71, e71.getTexture(), e71.getTexture(X4.COLOR_ATTACHMENT1), r57.getTexture());
  }
  renderDepthDetached(t71) {
    this._bindTarget(this.color), t71(), this._bindTarget(this.color, this.depth);
  }
  renderToCachedFBO(e71, r57, s67, o60, c44 = R4.RGBA, a59 = E13.DEPTH16_BUFFER, l47 = this._width, f46 = this._height, _30 = null) {
    return e71?.fbo?.width === l47 && e71?.fbo?.height === f46 || (e71 = t2(e71)), e71 = e71 ?? this._fbos.acquire(l47, f46, r57, c44), _30?.forEach((t71) => e71.acquireColor(t71.attachment, t71.format)), null != a59 && e71.acquireDepth(a59), this._fbos.rctx.bindFramebuffer(e71.fbo), this._fbos.rctx.clearFramebuffer(o60, true, true), s67(), e71;
  }
  renderToTargets(t71, e71, r57, i49, h32 = false, s67 = false) {
    this._bindTarget(e71, r57), this._fbos.rctx.clearFramebuffer(i49, h32, s67), t71(), e71.detachDepth();
  }
  bindFbo() {
    const t71 = null == this._color;
    if (this._bindTarget(this.color, this.depth), t71) {
      const t72 = this._fbos.rctx;
      t72.setClearStencil(0), t72.setClearColor(this._clearColor[0], this._clearColor[1], this._clearColor[2], this._clearColor[3]), t72.clear(_7.COLOR_BUFFER_BIT | _7.DEPTH_BUFFER_BIT | _7.STENCIL_BUFFER_BIT);
    }
  }
  _bindTarget(t71, e71) {
    t71.attachDepth(e71), this._fbos.rctx.bindFramebuffer(t71.fbo);
  }
  get width() {
    return this._width;
  }
  get height() {
    return this._height;
  }
  get color() {
    return this._ensureColor();
  }
  _ensureColor() {
    return this._color || (this._color = this._fbos.acquire(this._width, this._height, "composite-color")), this._color;
  }
  updateColor(t71) {
    const e71 = this._ensureColor();
    e71.attachDepth(this.depth), this._color = t71(e71);
  }
  get depth() {
    return this._depth || (this._depth = this._fbos.acquireDepth(E13.DEPTH_STENCIL_TEXTURE, this._width, this._height, "depth")), this._depth;
  }
};
var _28 = [0, 1, 0, 1];

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderPluginInput.js
var t67 = class {
  constructor() {
    this._inputs = /* @__PURE__ */ new Map();
  }
  set(t71, s67) {
    this._inputs.set(t71, s67);
  }
  get(t71) {
    return this._inputs.get(t71);
  }
  has(t71) {
    return this._inputs.has(t71);
  }
  release(t71) {
    this._inputs.get(t71)?.release() && this._inputs.delete(t71);
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique.js
var m41 = class _m extends r17 {
  constructor(e71, r57) {
    super(e71, r57, () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _m.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: A7,
      colorWrite: _9,
      depthTest: null,
      depthWrite: null
    });
  }
  get primitiveType() {
    return E7.TRIANGLE_STRIP;
  }
};
m41.shader = new t16(f24, () => import("./ShadowCastVisualize.glsl-VHPPKYWA.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowCastRenderer.js
var u44 = 4e4;
var c41 = 5e4;
var p47 = 1 / 512;
var m42 = class extends S3 {
  constructor(e71, s67, t71, i49) {
    super({}), this._techniques = e71, this._rctx = s67, this._data = t71, this._requestRender = i49, this._passParameters = new p20(this._data), this._techniqueConfig = new r37(), this._enabled = false, this._vao = i21(s67);
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._stop(), this._vao = r2(this._vao), this._techniques.release(this._technique), this._technique = null;
  }
  get _visualizeShadowCastTechnique() {
    return this._technique = this._techniques.releaseAndAcquire(m41, this._techniqueConfig, this._technique), this._technique;
  }
  render(e71) {
    if (!this._showVisualization) return;
    this._passParameters.sampleScale = 1 / this._data.computedSamples;
    const s67 = this._visualizeShadowCastTechnique;
    this._rctx.bindVAO(this._vao), this._rctx.bindTechnique(s67, e71, this._passParameters), this._rctx.drawArrays(s67.primitiveType, 0, i8(this._vao, "geometry"));
  }
  setOptions(e71) {
    void 0 !== e71.enabled && this._setEnabled(e71.enabled), void 0 !== e71.color && this._setColor(e71.color), void 0 !== e71.threshold && (this._threshold = e71.threshold), void 0 !== e71.visualization && (this._visualization = e71.visualization), void 0 !== e71.bandSize && (this._bandSize = e71.bandSize), void 0 !== e71.bandsEnabled && (this._bandsEnabled = e71.bandsEnabled);
  }
  get opacityFromElevation() {
    return this._passParameters.opacityFromElevation;
  }
  set opacityFromElevation(e71) {
    this._passParameters.opacityFromElevation !== e71 && (this._passParameters.opacityFromElevation = e71, this.notifyChange("opacityFromElevation"));
  }
  get _showVisualization() {
    return this._enabled && this._data.computedSamples > 0 && this.opacityFromElevation > p47;
  }
  get _threshold() {
    return this._passParameters.threshold;
  }
  set _threshold(e71) {
    this._threshold !== e71 && (this._passParameters.threshold = e71, this._requestRenderIfRunning());
  }
  get _visualization() {
    return this._techniqueConfig.visualization;
  }
  set _visualization(e71) {
    e71 !== this._visualization && (this._techniqueConfig.visualization = e71, this._techniques.release(this._technique), this._technique = null, this._requestRenderIfRunning());
  }
  get _bandSize() {
    return this._passParameters.bandSize;
  }
  set _bandSize(e71) {
    e71 !== this._bandSize && (this._passParameters.bandSize = e71, this._requestRenderIfRunning());
  }
  get _bandsEnabled() {
    return this._techniqueConfig.bandsEnabled;
  }
  set _bandsEnabled(e71) {
    e71 !== this._bandsEnabled && (this._techniqueConfig.bandsEnabled = e71, this._techniques.release(this._technique), this._technique = null, this._requestRenderIfRunning());
  }
  _setColor(e71) {
    const s67 = this._passParameters.color;
    E4(e71, s67) || (a9(this._passParameters.color, e71), this._requestRenderIfRunning());
  }
  _setEnabled(e71) {
    e71 !== this._enabled && (e71 ? this._start() : this._stop());
  }
  _requestRenderIfRunning() {
    this._enabled && this._requestRender();
  }
  _start() {
    this._enabled = true, this._requestRender();
  }
  _stop() {
    this._enabled = false, this._requestRender();
  }
};
e6([y2()], m42.prototype, "opacityFromElevation", null), m42 = e6([a4("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")], m42);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique.js
var d36 = class _d extends r17 {
  constructor(e71) {
    super(e71, new s63(), () => this.destroy());
  }
  initializeProgram(e71) {
    return new r18(e71.rctx, _d.shader.get().build(this.configuration), O8);
  }
  initializePipeline() {
    return S7({
      blending: l12(R3.ONE, R3.ONE, R3.ONE, R3.ONE),
      colorWrite: _9,
      depthTest: null,
      depthWrite: null
    });
  }
  get primitiveType() {
    return E7.TRIANGLE_STRIP;
  }
};
d36.shader = new t16(g12, () => import("./ShadowCastAccumulate.glsl-Y4K3H5Y7.js"));

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowAccumulator.js
var M17 = class extends S3 {
  constructor(e71, t71, i49, r57, s67, o60) {
    super({}), this.fbos = e71, this._stage = i49, this._prepareForShadowMapPass = r57, this._renderToShadowMap = s67, this._requestRender = o60, this._progress = 0, this._sampleCount = 0, this._passParameters = new h9(), this._cachedLightDirections = [], this._depthRange = u41, this._previewing = false, this._cameraForcedForScreenshot = false, this._shadowAccumulatorKey = "shadowAccumulator", this._rctx = e71.rctx, this._bindParameters = new m19(new G7(e71, i49.viewingMode), null), this._bindParameters.shadowMap.enabled = true, this._vao = i21(this._rctx), this._accumulationRenderer = new m42(t71, this._rctx, this, o60);
    const c44 = this._stage.view.resourceController.scheduler;
    this.addHandles([c44.registerTask(I3.SHADOW_ACCUMULATOR, this), d2(() => i49.renderView, (e72) => {
      this.removeHandles(L24), null != e72 && this.addHandles(e72.events.on("force-camera-for-screenshot", () => this._cameraForcedForScreenshot = true), L24);
    }, A3), d2(() => this._previewing, () => this._requestRenderIfEnabled(), C)], this._shadowAccumulatorKey);
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._disable(), this.removeHandles(this._shadowAccumulatorKey), this._accumulationRenderer = r2(this._accumulationRenderer), this._bindParameters.shadowMap.dispose(), this._fbo = r2(this._fbo), this._vao = r2(this._vao), this._accumulationTechniqueCached = t2(this._accumulationTechniqueCached), this._cachedLightDirections.length = 0, this._sampleCount = 0;
  }
  get computedSamples() {
    return this._progress;
  }
  get shadowCastTexture() {
    return this._fbo?.colorTexture;
  }
  get isAccumulating() {
    return this._isPreviewing || this._isRefining;
  }
  get _accumulationTechnique() {
    if (null == this._accumulationTechniqueCached) {
      const e71 = {
        rctx: this._rctx,
        viewingMode: this._stage.viewingMode
      };
      this._accumulationTechniqueCached = new d36(e71);
    }
    return this._accumulationTechniqueCached;
  }
  get _isRefining() {
    return this._isActive && !this._isDoneAccumulating && !this._previewing;
  }
  get _isPreviewing() {
    return this._isActive && this._previewing;
  }
  get _isActive() {
    return null != this._fbo && this._sampleCount > 0;
  }
  get canAccumulate() {
    return null != this._bindParameters.depth && this._depthRange !== u41 && this._opacityFromElevation > p47;
  }
  get _isDoneAccumulating() {
    return this._progress >= this._sampleCount;
  }
  get _lightDirections() {
    return this._cachedLightDirections;
  }
  set _lightDirections(e71) {
    const t71 = this._cachedLightDirections;
    if (h(t71, e71, H)) return;
    const r57 = Math.min(h14, e71.length);
    t71.length = r57, this._sampleCount = r57;
    for (let i49 = 0; i49 < r57; ++i49) t71[i49] = r5(t71[i49] ?? n7(), e71[i49]);
    this._invalidate();
  }
  get _opacityFromElevation() {
    return this._accumulationRenderer.opacityFromElevation;
  }
  set _opacityFromElevation(e71) {
    this._accumulationRenderer.opacityFromElevation = e71;
  }
  get running() {
    return this._isRefining && this.canAccumulate && this._progress > 0;
  }
  runTask(e71) {
    for (this._prepareForShadowMapPass(this._bindParameters); !e71.done && !this._isDoneAccumulating; ) this._accumulateShadow(), e71.madeProgress();
    this._requestRender();
  }
  renderAccumulation(e71, t71, i49, r57) {
    if (this._depthRange = t71, this._updateCamera(i49), this._bindParameters.contentCamera = r57, this._bindParameters.depth = e71, this._passParameters.origin = this._bindParameters.camera.center, this.notifyChange("canAccumulate"), !this.isAccumulating || !this.canAccumulate) return false;
    (this._previewing || 0 === this._progress || this._cameraForcedForScreenshot) && this._clear();
    const s67 = this._cameraForcedForScreenshot ? this._sampleCount : Math.min(U22, this._sampleCount - this._progress);
    for (let o60 = 0; o60 < s67; ++o60) this._accumulateShadow();
    return this._cameraForcedForScreenshot = false, this._requestRender(), s67 > 0;
  }
  render(e71) {
    this._accumulationRenderer.render(e71);
  }
  setOptions(e71) {
    if (void 0 !== e71.enabled) {
      const t71 = null != this._fbo;
      e71.enabled !== t71 && (e71.enabled ? this._enable() : this._disable());
    }
    void 0 !== e71.previewing && (this._previewing = e71.previewing), void 0 !== e71.lightDirections && (this._lightDirections = e71.lightDirections), this._accumulationRenderer.setOptions(e71);
  }
  readAccumulatedShadow(e71, t71) {
    return !this._isActive || !this._fbo || this._progress < 1 || e71 < 0 || e71 >= this._fbo.width || t71 < 0 || t71 >= this._fbo.height ? 0 : (this._fbo.readPixels(e71, t71, 1, 1, G4.RGBA, U6.UNSIGNED_BYTE, O33), O33[0] / this._progress);
  }
  _enable() {
    this._progress = 0;
    const e71 = new e22();
    e71.pixelFormat = G4.RED, e71.internalFormat = P5.R8, e71.wrapMode = D2.CLAMP_TO_EDGE, this._fbo = new E11(this._rctx, e71), this._requestRender();
  }
  _disable() {
    this._fbo = r2(this._fbo), this._requestRender();
  }
  _invalidate() {
    this._progress = 0, this._requestRenderIfEnabled();
  }
  _clear() {
    this._rctx.bindFramebuffer(this._fbo), this._rctx.setClearColor(0, 0, 0, 0), this._rctx.clear(_7.COLOR_BUFFER_BIT), this._progress = 0;
  }
  _accumulateShadow() {
    this._renderToShadowMap(this._bindParameters, this._lightDirections[this._progress++], this._depthRange);
    const e71 = this._accumulationTechnique;
    this._rctx.bindFramebuffer(this._fbo), this._rctx.bindTechnique(e71, this._bindParameters, this._passParameters), this._rctx.bindVAO(this._vao), this._rctx.drawArrays(e71.primitiveType, 0, i8(this._vao, "geometry"));
  }
  _updateCamera(e71) {
    const t71 = this._fbo;
    if (null == t71) return;
    const i49 = this._bindParameters.camera;
    e71.equals(i49) || i49.copyFrom(e71), t71.resize(e71.fullWidth, e71.fullHeight), this._opacityFromElevation = 1 - p4(u44, c41, e71.relativeElevation);
  }
  _requestRenderIfEnabled() {
    this._fbo && this._requestRender();
  }
  get test() {
  }
};
e6([y2()], M17.prototype, "_progress", void 0), e6([y2()], M17.prototype, "_sampleCount", void 0), e6([y2()], M17.prototype, "_fbo", void 0), e6([y2()], M17.prototype, "_depthRange", void 0), e6([y2()], M17.prototype, "_previewing", void 0), e6([y2()], M17.prototype, "_accumulationRenderer", void 0), e6([y2()], M17.prototype, "_isRefining", null), e6([y2()], M17.prototype, "_isActive", null), e6([y2()], M17.prototype, "canAccumulate", null), e6([y2()], M17.prototype, "_isDoneAccumulating", null), e6([y2()], M17.prototype, "_opacityFromElevation", null), e6([y2()], M17.prototype, "running", null), M17 = e6([a4("esri.views.3d.webgl-engine.lib.ShadowAccumulator")], M17);
var U22 = 6;
var L24 = "renderView";
var O33 = new Uint8Array(4);

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/SliceHelper.js
var t68 = W3();
var n61 = class {
  constructor() {
    this._plane = W3();
  }
  get isEnabled() {
    return !ps(this.plane, t68);
  }
  get plane() {
    return this._plane;
  }
  set plane(e71) {
    Z(e71 || t68, this._plane);
  }
};

// ../../../node_modules/@arcgis/core/views/webgl/TimerPool.js
function e68(t71, e71) {
  const u46 = t71.capabilities.disjointTimerQuery;
  return null == u46 ? null : new r56(u46, e71);
}
var r56 = class {
  constructor(t71, e71) {
    this._timer = t71, this._queryPool = new Array(), this._queryResults = /* @__PURE__ */ new Map(), this._currentQuery = null, e71.forEach((t72) => {
      const e72 = this._timer.createQuery(), r57 = this._timer.createQuery();
      this._queryPool.push(e72, r57), this._queryResults.set(t72, null);
    });
  }
  start() {
    E14 || (this._currentQuery = this._queryPool.pop(), null != this._currentQuery && (this._timer.disjoint(), this._timer.beginTimeElapsed(this._currentQuery)));
  }
  stop(t71) {
    if (this._timer.disjoint() || null == this._currentQuery || !this._queryResults.has(t71)) return this.abort(), null;
    this._timer.endTimeElapsed();
    const e71 = this._queryResults.get(t71);
    if (null == e71) return this._queryResults.set(t71, this._currentQuery), this._currentQuery = null, null;
    if (!this._timer.resultAvailable(e71)) return this._queryPool.unshift(this._currentQuery), this._currentQuery = null, null;
    const r57 = this._timer.getResult(e71) / 1e6;
    return this._queryPool.unshift(e71), this._queryResults.set(t71, this._currentQuery), this._currentQuery = null, r57;
  }
  abort() {
    null != this._currentQuery && (this._timer.deleteQuery(this._currentQuery), this._queryPool.unshift(this._timer.createQuery()), this._currentQuery = null);
  }
  dispose() {
    null != this._currentQuery && this._timer.deleteQuery(this._currentQuery), this._queryPool.forEach((t71) => {
      this._timer.deleteQuery(t71);
    }), this._queryResults.forEach((t71) => {
      null != t71 && this._timer.deleteQuery(t71);
    });
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/statistics/RendererPerformanceInfo.js
var a58;
!function(e71) {
  e71.OVERLAY = "overlay", e71.PREPARE = "prepare", e71.SHADOW_MAP = "shadow map", e71.DEPTH = "depth", e71.ACCUMULATED_SHADOWS = "accumulated shadows", e71.OBJECT_AND_LAYER_ID_COLOR = "object/layer id color", e71.NORMALS = "normals", e71.SSAO = "SSAO", e71.OPAQUE_EDGES = "opaque edges", e71.VOXEL = "voxel", e71.TRANSPARENT = "transparent", e71.TRANSPARENT_EDGES = "transparent edges", e71.HUD_VISIBILITY = "HUD visibility", e71.TRANSPARENT_TERRAIN = "transparent terrain", e71.OPAQUE_ENVIRONMENT = "opaque environment", e71.TRANSPARENT_ENVIRONMENT = "transparent environment", e71.LASER_LINES = "laser lines", e71.VIEWSHED = "viewshed", e71.OCCLUDED = "occluded", e71.HUD = "HUD", e71.HUD_OCCLUDED = "HUD occluded", e71.FINISH = "finish";
}(a58 || (a58 = {}));
var m43 = Object.values(n57).concat(Object.values(t65)).concat(Object.values(a58));
var l46 = "Total";
var p48 = class {
  constructor(e71) {
    this._rctx = e71, this._startTimeStampCPU = n3(0), this._lastTimeStampCPU = n3(0), this._totalCPUTime = new s2(l46), this._cpuTimeSamplers = new Map(m43.map((e72) => [e72, new s2(e72)])), this._enableGPUTimer = 0, this._totalGPUTime = new s2("GPU"), this._gpuTimeSamplers = new Map(m43.map((e72) => [e72, new s2(e72)])), this._totalTime = n3(0), this._totalFrameCount = 0;
  }
  get totalCPUTimeSampler() {
    return this._totalCPUTime;
  }
  get cpuTimeSamplers() {
    return Array.from(this._cpuTimeSamplers.values());
  }
  get totalGPUTimeSampler() {
    return this._totalGPUTime;
  }
  get gpuTimeSamplers() {
    return Array.from(this._gpuTimeSamplers.values());
  }
  get gpuSamplingEnabled() {
    return null != this._gpuTimerPool;
  }
  get totalTime() {
    return this._totalTime;
  }
  get totalFrameCount() {
    return this._totalFrameCount;
  }
  get elapsedTime() {
    return n3(performance.now() - this._startTimeStampCPU);
  }
  enableGPUPerformanceInfo() {
    if (null == this._gpuTimerPool) {
      const e71 = [...m43, l46];
      this._gpuTimerPool = e68(this._rctx, e71);
    }
    if (null == this._gpuTimerPool) return {
      hasGPUTimerSupport: false,
      remove: () => {
      }
    };
    ++this._enableGPUTimer;
    let t71 = false;
    return {
      hasGPUTimerSupport: true,
      remove: () => {
        t71 || (t71 = true, --this._enableGPUTimer, 0 === this._enableGPUTimer && (this._gpuTimerPool = r2(this._gpuTimerPool)));
      }
    };
  }
  startFrame() {
    this._startTimeStampCPU = this._lastTimeStampCPU = n3(performance.now()), this._gpuTimerPool && this._gpuTimerPool.start();
  }
  advance(e71) {
    const t71 = n3(performance.now());
    if (this._cpuTimeSamplers.get(e71).record(t71 - this._lastTimeStampCPU), this._lastTimeStampCPU = t71, this._gpuTimerPool) {
      const t72 = this._gpuTimerPool.stop(e71);
      this._gpuTimeSamplers.get(e71).record(t72), this._gpuTimerPool.start();
    }
  }
  finishFrame() {
    if (this._gpuTimerPool) {
      const e72 = this._gpuTimerPool.stop(a58.FINISH);
      this._gpuTimeSamplers.get(a58.FINISH).record(e72), this._rctx.gl.flush();
    }
    const e71 = n3(performance.now() - this._startTimeStampCPU);
    this._totalTime = n3(this._totalTime + e71), this._totalCPUTime.record(e71), this._gpuTimerPool && this._totalGPUTime.record(this.gpuTimeSamplers.reduce((e72, t71) => e72 + (t71.last || 0), 0)), ++this._totalFrameCount;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Renderer.js
var Pe2 = class {
  constructor(e71, t71, r57, i49, a59, n63) {
    this._stage = e71, this._techniques = r57, this._rctx = i49, this._compositingHelper = a59, this._requestRender = n63, this._pluginsHas = {
      hudElements: false,
      water: false
    }, this._hasOverlayWater = false, this.renderOverlay = (e72) => {
    }, this._isRendering = false, this._inGlobeView = false, this._backgroundColor = r6(0, 0, 0, 1), this._sliceHelper = new n61(), this._blit = null, this._state = r12(I2.IDLE), this._highQualityTransparencyEnabled = true, this._terrainTransparency = ce6.Opaque, this._ssrEnabled = false, this._hasAnimations = false, this._animationTimestep = new e67(), this._loadEdgeViewTask = null, this._edgeViewCallbacks = [], this._reprojectionMatrixVersion = r12(0), this._renderHiddenTransparentEdges = () => {
    }, this._pluginInput = new t67(), this._releaseNormals = (e72) => {
      e72.some(({
        name: e73
      }) => "normals" === e73) && this._pluginInput.release("normals");
    }, this._debugNeedsDepth = false, this.fboCache = new f41(i49), this._renderStateFeatures = r12(s33(!has("disable-feature:high-quality-idle"), e71.view.qualityProfile)), this._offscreen = new f42(this.fboCache, this._compositingHelper), this.performanceInfo = new p48(this._rctx), this._shadowMap = new G7(this.fboCache, e71.viewingMode), this._viewshed = new C8({
      fboCache: this.fboCache,
      view: e71.view
    }, (e72, t72, r58) => {
      t72.setGLViewport(this._rctx);
      const {
        camera: s67,
        contentCamera: i50
      } = e72;
      this._ensureBindParametersCamera(t72, t72), this._renderAllGeometry(r58), this._ensureBindParametersCamera(s67, i50), e72.camera.setGLViewport(this._rctx);
    }), this._shadowAccumulator = new M17(this.fboCache, r57, e71, (e72) => {
      const t72 = this.shadowsEnabled;
      this._shadowMap.enabled = true, this._ensureBindParametersCamera(e72.camera, e72.contentCamera), this._plugins.prepareRender(), this._shadowMap.enabled = t72;
    }, (e72, t72, r58) => {
      const s67 = this._stage.view.qualitySettings.maximumPixelRatio;
      e72.shadowMap.start(e72.camera, t72, r58, true, s67), this._renderShadowCascades(o9.Shadow, e72.shadowMap), e72.shadowMap.finish(), e72.camera.setGLViewport(this._rctx), this._ensureBindParametersCamera(e72.camera, e72.contentCamera);
    }, n63), this._renderContext = new n33(this._rctx, this._offscreen, this._shadowMap, this._sliceHelper), this._nodes = new n60(this._renderContext), this._plugins = new h30({
      renderContext: this._renderContext,
      techniques: r57,
      materials: t71,
      requestRender: n63,
      controller: e71,
      fbos: this.fboCache,
      isFeatureEnabled: (e72) => this.isFeatureEnabled(e72)
    }), this.renderPassManager = new M16(), this._plugins.add(this.renderPassManager), this._plugins.add(this._viewshed), this._handles = [d2(() => this._stage.view.state.camera, () => n63(), A3), d2(() => t19.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES, (e72) => {
      this._renderHiddenTransparentEdges = e72 ? () => this._renderEdges(A5.TRANSPARENT) : () => {
      }, n63();
    }, P), d2(() => this._stage.view.environment.background?.color, (e72) => {
      const t72 = e72 ? E5(e72) : _4;
      s11(this._backgroundColor, t72[0] * t72[3], t72[1] * t72[3], t72[2] * t72[3], t72[3]), n63();
    }, A3), d2(() => this._stage.view.state.camera.relativeElevation, (e72) => {
      this._inGlobeView = (e72 ?? 1 / 0) >= o18;
    }, A3)];
  }
  destroy() {
    this._handles.forEach((e71) => e71.remove()), this._gpuTimerHandle = l(this._gpuTimerHandle), this._nodes.destroy(), this._offscreen.dispose(), this._shadowMap.dispose(), this._shadowAccumulator.dispose(), this._loadEdgeViewTask = e(this._loadEdgeViewTask), this._edgeView = u(this._edgeView), this.renderPassManager.dispose(), this._releaseFBOs(), this._disposeOffscreenBuffers(), this.fboCache.destroy(), this._plugins.destroy(), o15.prune();
  }
  get _bindParameters() {
    return this._renderContext.bindParameters;
  }
  updateRenderFeatures(e71 = null, t71 = !has("disable-feature:high-quality-idle")) {
    this._renderStateFeatures.value = s33(t71, e71), this._plugins.renderFeatureChanged(), this._requestRender();
  }
  isFeatureEnabled(e71, t71 = this._state.value) {
    return this._renderStateFeatures.value.get(t71, e71) ?? false;
  }
  setFeatureEnabled(e71, t71, r57) {
    this._renderStateFeatures.mutate((s67) => s67.set(t71, e71, r57)), this._requestRender();
  }
  get _highQualityTransparency() {
    return this._highQualityTransparencyEnabled || this.isFeatureEnabled(o32.HighQualityTransparency);
  }
  get hasReflections() {
    return (this._pluginsHas.water || this._hasOverlayWater) && (this._ssrEnabled || this.isFeatureEnabled(o32.WaterReflection));
  }
  get hasDecorations() {
    return this._plugins.hasDecorations || this._nodes.produces("magnifier-color");
  }
  get hasHighlights() {
    return this._plugins.produces(o9.Highlight, E12.OPAQUE_MATERIAL, E12.TRANSPARENT_MATERIAL, E12.DRAPED_MATERIAL);
  }
  get hasLaserlines() {
    return this._plugins.produces(this._renderContext.output, E12.LASERLINES, E12.LASERLINES_CONTRAST_CONTROL);
  }
  get hasSSAO() {
    return (this._stage.view.qualitySettings.ambientOcclusion || this.isFeatureEnabled(o32.SSAO)) && !this._inGlobeView;
  }
  get hasSMAA() {
    return this._stage.view.qualitySettings.antialiasingEnabled || this.isFeatureEnabled(o32.Antialiasing);
  }
  get fullResolutionAtmosphere() {
    return this._stage.view.qualitySettings.highResolutionAtmosphere || this.isFeatureEnabled(o32.HighResolutionAtmosphere);
  }
  _releaseFBOs() {
    this._bindParameters.ssr.lastFrameColor = t2(this._bindParameters.ssr.lastFrameColor), this._bindParameters.multipassTerrain.depth = t2(this._bindParameters.multipassTerrain.depth), this._bindParameters.multipassGeometry.depth = t2(this._bindParameters.multipassGeometry.depth);
  }
  _disposeOffscreenBuffers() {
    this._offscreen.dispose(), this._disposeBindBuffers();
  }
  _disposeBindBuffers() {
    this._shadowMap.disposeOffscreenBuffers(), this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(), this._bindParameters.depth = t2(this._bindParameters.depth), this._bindParameters.hudVisibility = t2(this._bindParameters.hudVisibility);
  }
  get updating() {
    return null != this._edgeView && this._edgeView.updating || this._shadowAccumulator.running || this._plugins.updating || !this.isCameraFinal;
  }
  loadEdgeView() {
    return this._loadEdgeViewTask || (this._loadEdgeViewTask = d((e71) => __async(this, null, function* () {
      const {
        EdgeView: t71
      } = yield import("./EdgeView-3XJDS6XT.js");
      s3(e71);
      const r57 = this._edgeView = new t71({
        rctx: this._rctx,
        renderSR: this._stage.view.renderSpatialReference,
        viewingMode: this._stage.viewingMode,
        techniques: this._techniques,
        setNeedsRender: () => this._requestRender(),
        schedule: Me(this._stage.view.resourceController)
      });
      return this._handles.push(d2(() => r57.updating, () => this._requestRender(), C)), this._requestRender(), this._edgeViewCallbacks.forEach((e72) => e72(r57)), this._edgeViewCallbacks.length = 0, r57;
    }))), this._loadEdgeViewTask.promise;
  }
  withEdgeView(e71) {
    this.loadEdgeView(), null == this._edgeView ? this._edgeViewCallbacks.push(e71) : e71(this._edgeView);
  }
  get edgeView() {
    return this._edgeView;
  }
  get isCameraFinal() {
    return this._reprojectionMatrixVersion.value >= 0 && C2(this._bindParameters.ssr.reprojectionMatrix, o8);
  }
  set _reprojectionMatrix(e71) {
    a(this._bindParameters.ssr.reprojectionMatrix, e71) && this._reprojectionMatrixVersion.value++;
  }
  get shadowsEnabled() {
    return !!this._shadowMap?.enabled;
  }
  setParameters(e71) {
    const {
      _shadowMap: t71,
      _bindParameters: r57
    } = this;
    if (void 0 !== e71.qualitySettings?.reflections && this._ssrEnabled !== e71.qualitySettings.reflections && (this._ssrEnabled = e71.qualitySettings.reflections, this._requestRender()), void 0 !== e71.shadowMap && this._shadowMap.enabled !== e71.shadowMap && (this._shadowMap.enabled = e71.shadowMap, this._requestRender()), void 0 !== e71.shadowMapMaxCascades && t71.maxCascades !== e71.shadowMapMaxCascades && (t71.maxCascades = e71.shadowMapMaxCascades, this._requestRender()), null != e71.environment) {
      null != e71.environment.weather && (this._bindParameters.weather = e71.environment.weather, this._bindParameters.weatherVisible = !!e71.weatherVisible);
      const t72 = "virtual" !== e71.environment.lighting.type;
      r57.enableFillLights !== t72 && (r57.enableFillLights = t72, this._requestRender());
    }
    void 0 !== e71.highQualityTransparency && this._highQualityTransparencyEnabled !== e71.highQualityTransparency && (this._highQualityTransparencyEnabled = e71.highQualityTransparency, this._requestRender()), void 0 !== e71.hasOverlayWater && this._hasOverlayWater !== e71.hasOverlayWater && (this._hasOverlayWater = e71.hasOverlayWater, this._requestRender()), void 0 !== e71.slicePlane && this._sliceHelper.plane !== e71.slicePlane && (this._sliceHelper.plane = e71.slicePlane, this._requestRender()), void 0 !== e71.terrainTransparency && this._terrainTransparency !== e71.terrainTransparency && (this._terrainTransparency = e71.terrainTransparency, this._requestRender()), void 0 !== e71.shadowCast && this._shadowAccumulator.setOptions(e71.shadowCast);
  }
  get hasSlicePlane() {
    return !!this._sliceHelper.plane;
  }
  get plugins() {
    return this._plugins;
  }
  get _hasOITSupport() {
    return this._rctx.driverTest.floatBufferBlend.result;
  }
  get _oitEnabled() {
    return this._highQualityTransparency && this._hasOITSupport;
  }
  modify(e71, t71) {
    this._isRendering && console.warn("Renderer.modify called while rendering");
    const {
      adds: r57,
      removes: s67,
      updates: i49
    } = e71;
    if (0 === r57.length && 0 === s67.length && 0 === i49.length) return;
    const a59 = n28(e71);
    let n63 = false;
    a59.forEach((r58, s68) => {
      if (t71.done) return;
      let i50 = this._plugins.getMaterialRenderer(s68);
      if (null == i50 && r58.adds.length > 0) {
        const e72 = new S9({
          material: s68
        });
        e72.initializeRenderContext(this._plugins._context), i50 = e72, this._plugins.add(i50);
      }
      i50 && (i50.modify(r58), 0 === i50.numGeometries && (n63 = true)), r58.removes.forEach((t72) => e71.removes.removeUnordered(t72)), r58.adds.forEach((t72) => e71.adds.removeUnordered(t72)), r58.updates.forEach((t72) => e71.updates.removeUnordered(t72)), t71.madeProgress();
    }), n63 && this._plugins.removeEmptyMaterialRenderers(), this._updateHasFlags(), this._requestRender();
  }
  _updateHasFlags() {
    const has2 = this._pluginsHas;
    has2.hudElements = this._plugins.produces(o9.Color, E12.LINE_CALLOUTS_HUD_DEPTH, E12.HUD_MATERIAL, E12.LABEL_MATERIAL), has2.water = this._plugins.produces(o9.Normal, E12.DRAPED_WATER), this._bindParameters.hasOccludees = this._plugins.hasOccludees;
  }
  updateAnimation(e71) {
    const t71 = this._hasAnimations;
    return this._hasAnimations = this._plugins.updateAnimation(e71), this._hasAnimations = this._nodes.updateAnimation() || this._hasAnimations, this._hasAnimations !== t71 && (this._gpuTimerHandle = t71 ? l(this._gpuTimerHandle) : this.performanceInfo.enableGPUPerformanceInfo()), this._hasAnimations;
  }
  get animationTimestep() {
    return this._animationTimestep.value;
  }
  get animationTimeDilation() {
    return this._animationTimestep.timeDilation;
  }
  resetAnimation() {
    this._animationTimestep.clear();
  }
  tick() {
    this.fboCache.clean();
  }
  render(e71, t71, r57 = r30.Default, s67 = i11.ON) {
    this._isRendering = true, this.performanceInfo.startFrame(), this.fboCache.frameStart(), this._disposeBindBuffers();
    const i49 = this._offscreen, {
      camera: a59,
      contentCamera: n63,
      mode: o60,
      alignPixelEnabled: d38
    } = e71;
    this._state.value = o60, this._bindParameters.overlay = this.renderOverlay(t71), this._bindParameters.overlay && this.performanceInfo.advance(a58.OVERLAY), this._renderContext.time = t71, this._bindParameters.transparencyPassType = o16.NONE, this._bindParameters.alignPixelEnabled = d38, this._bindParameters.decorations = s67, this._bindParameters.mainColor = this._bindParameters.mainDepth = null, this._bindParameters.viewshedEnabled = this._viewshed.enabled;
    const l47 = this._nodes.produces("magnifier-color"), _30 = this._nodes.produces("final-color"), p49 = W3(this._sliceHelper.plane);
    s67 === i11.OFF && (this._sliceHelper.plane = null), a59.setGLViewport(this._rctx);
    const u46 = i49.initializeFrame(a59, this._backgroundColor, r57);
    this.hasReflections ? this._bindParameters.ssr.lastFrameColor = u46 : u46?.release(), this._ensureBindParametersCamera(a59, n63), this._plugins.prepareRender(), this._bindParameters.shadowHighlightsVisible = this._needsShadowHighlight && s67 === i11.ON;
    const c44 = this._plugins.produces(o9.Color, E12.OPAQUE_TERRAIN) && (this._terrainTransparency === ce6.Semitransparent || this._terrainTransparency === ce6.TransparentWithDraped), m45 = this._highQualityTransparency && c44, f46 = this._plugins.produces(o9.Color, ...Ie);
    this._prepareShaders(m45, f46), this.performanceInfo.advance(a58.PREPARE);
    const g28 = this._computeDepthRange(a59);
    this._renderShadowMap(a59, this._bindParameters.lighting.mainLight.direction, g28), this._ensureBindParametersCamera(a59, n63);
    let T21 = this._renderNormals();
    if (this._pluginInput.set("normals", T21), T21) {
      let e72 = null;
      this._needsDepth && (e72 = T21.getAttachment(t7), e72?.retain()), this._pluginInput.set("ssao", this._renderSSAO()), this._renderNoSSAOGeometryDepth(e72), T21 = null;
    } else this._renderAllGeometryDepth();
    this._renderShadowAccumulation(g28, a59, n63), this._ensureBindParametersSSR(t71), this._renderContext.output = o9.Color, i49.bindFbo(), this._bindParameters.mainColor = i49.colorTexture, this._bindParameters.mainDepth = i49.depthTexture;
    const b25 = this.plugins.produces(o9.Color, ...we2);
    b25 && this._renderOpaqueGeometry(), this._offscreen.updateColor((e72) => this._renderNodes(n57.OPAQUE, e72, b25)), this.fboCache.debugCallback?.("opaque-color", this._offscreen.color.fbo), this._renderPlugins(E12.OPAQUE_ENVIRONMENT, a58.OPAQUE_ENVIRONMENT), this._renderMultipassTerrainDepth(m45), this._setMultipassTerrain(m45), this._renderEdges(A5.OPAQUE), i49.bindFbo(), this._renderPlugins(E12.VOXEL, a58.VOXEL), this._renderHiddenTransparentEdges(), f46 && (this._oitEnabled ? this._renderOITPass(Re2.Geometry) : this._renderTransparentMaterial()), this._offscreen.updateColor((e72) => this._renderNodes(n57.TRANSPARENT, e72, f46)), this.fboCache.debugCallback?.("transparent-color", this._offscreen.color.fbo), this._renderMultipassGeometryDepth(m45), this._renderHUDVisibility(), m45 || this._plugins.render(this._pluginInput, E12.LINE_CALLOUTS);
    const E37 = r57 === r30.ObjectAndLayerID ? this._renderObjectAndLayerIdColor() : null;
    this._renderEdges(A5.TRANSPARENT);
    const A32 = c44 ? this._renderTransparentTerrain() : null;
    A32 && (this.performanceInfo.advance(a58.TRANSPARENT_TERRAIN), this._bindParameters.hudVisibility && (m45 ? this._renderLineCallouts(c16.Occluded) : i49.compositeToHUDVisibility(this._bindParameters, A32.getTexture()), this._renderHUD(c16.Occluded, i49.color))), this._setTerrainCulling(false), A32 && (i49.compositeToFramebuffer(this._bindParameters, A32.getTexture(), i45.PremultipliedAlpha, 1), A32.release(), m45 && (this._renderEdges(A5.OPAQUE), f46 && (this._oitEnabled ? this._renderOITPass(Re2.Geometry) : this._renderTransparentMaterial(), this.performanceInfo.advance(a58.TRANSPARENT)), this._renderEdges(A5.TRANSPARENT))), this._bindParameters.ssao = t2(this._bindParameters.ssao), m45 && this._renderLineCallouts(c16.NotOccluded), this._setMultipassEnabled(false), this._renderTransparentEnvironment(), this._renderViewshed(), this._renderLaserlines(), this._renderOccluded(), this._pluginInput.set("highlights", this._renderHighlightPrepass()), this._offscreen.updateColor((e72) => this._renderNodes(n57.COMPOSITE, e72));
    const P19 = this._nodes.produces("aa-color"), R17 = !(r57 !== r30.Default || _30 || l47 && s67 === i11.ON && r57 === r30.Default), I25 = this._pluginInput.get("composite-color"), N18 = R17 ? T19 : this.fboCache.acquire(I25.fbo.width, I25.fbo.height, "aa-color"), y27 = P19 ? this._renderNodes(t65.ANTIALIASING, N18) : this._blitToDefault(I25, N18, false);
    this._pluginInput.set(t65.ANTIALIASING, y27), this._renderHUD(c16.NotOccluded, y27);
    const D15 = this._renderNodes(t65.HIGHLIGHTS, y27);
    let L25 = this._renderNodes(t65.MAGNIFIER, D15);
    return l47 && s67 === i11.ON && r57 === r30.Default && !_30 && (L25 = this._blitToDefault(L25)), _30 ? (L25.attachDepth(i49.depth), this._blitToDefault(this._renderNodes(n57.FINAL, L25)), L25.detachDepth()) : this._pluginInput.set(n57.FINAL, L25), this._pluginInput.release("highlights"), this.onPostRender && this.onPostRender(), this._releaseFBOs(), this._offscreen.releaseBuffers(), this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera), this._sliceHelper.plane = p49, this._isRendering = false, this.fboCache.frameEnd(), this.performanceInfo.finishFrame(), r57 !== r30.Default && (this._releaseFBOs(), this._disposeOffscreenBuffers()), {
      screen: this._pluginInput.get("final-color"),
      oid: E37
    };
  }
  _prepareShaders(e71, t71) {
    this._renderContext.output = o9.Color, this._prepareOpaqueGeometry(), this._setMultipassTerrain(e71), this._plugins.prepare(E12.TRANSPARENT_TERRAIN), this._setMultipassTerrain(false), e71 || this._plugins.prepare(E12.LINE_CALLOUTS), t71 && this._prepareTransparencySlots(), this._plugins.prepare(E12.VIEWSHED, E12.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL, E12.TRANSPARENT_ENVIRONMENT, E12.LASERLINES), this._rctx.gl.flush();
  }
  _renderObjectAndLayerIdColor() {
    if (!has("enable-feature:objectAndLayerId-rendering")) return;
    const e71 = this._renderContext.output, t71 = this.fboCache.acquire(this._offscreen.width, this._offscreen.height, "oid");
    return t71.acquireDepth(E13.DEPTH_STENCIL_TEXTURE), this._rctx.bindFramebuffer(t71.fbo), this.fboCache.rctx.clearFramebuffer([0, 0, 0, 0], true, true), this._renderAllGeometry(o9.ObjectAndLayerIdColor), this._rctx.bindFramebuffer(t71.fbo), this.fboCache.rctx.clearFramebuffer(void 0, true, true), this._bindParameters.hudRenderStyle = c16.NotOccluded, this._plugins.render(this._pluginInput, E12.HUD_MATERIAL), this._renderContext.output = e71, this.performanceInfo.advance(a58.OBJECT_AND_LAYER_ID_COLOR), t71;
  }
  finish(e71) {
    this._hasAnimations || this._animationTimestep.clear();
    const t71 = this.performanceInfo.gpuSamplingEnabled, r57 = e71 === O7.BACKGROUND;
    if (r57 || t71) {
      const e72 = r57 ? this.performanceInfo.elapsedTime : 0, s67 = t71 ? this.performanceInfo.totalGPUTimeSampler.last : this._rctx.gl.getError(), i49 = Math.max(e72, s67);
      this._animationTimestep.frame(i49, r57);
    }
  }
  readDepthPixels(e71, t71) {
    if (!this._bindParameters.mainDepth) return;
    const {
      width: r57,
      height: s67
    } = this._offscreen, i49 = this.fboCache.acquire(r57, s67, "linear-depth");
    this._rctx.bindFramebuffer(i49.fbo), this._bindParameters.camera.setGLViewport(this._rctx), this._rctx.clearFramebuffer([0, 0, 0, 0], true, true), this._compositingHelper.blitDepthToLinearDepth(this._bindParameters, this._bindParameters.mainDepth), i49.fbo?.readPixels(e71[0], e71[1], e71[2], e71[3], G4.RGBA, U6.UNSIGNED_BYTE, t71), i49.release();
  }
  readHUDVisibility(e71, t71, r57, s67, i49) {
    this._bindParameters.hudVisibility?.fbo?.readPixels(e71, t71, r57, s67, G4.RGBA, U6.UNSIGNED_BYTE, i49);
  }
  readAccumulatedShadow(e71) {
    return this._shadowAccumulator.readAccumulatedShadow(e71[0], e71[1]);
  }
  _setMultipassTerrain(e71) {
    this._setMultipassEnabled(e71), this._setTerrainCulling(e71);
  }
  _setMultipassEnabled(e71) {
    this._bindParameters.multipassEnabled = e71;
  }
  _setTerrainCulling(e71) {
    this._bindParameters.multipassTerrain.cullAboveGround = e71;
  }
  _renderEdges(e71) {
    const t71 = this._edgeView;
    if (!t71?.shouldRender()) return;
    const {
      width: r57,
      height: s67,
      depth: i49
    } = this._offscreen, a59 = this.fboCache.acquire(r57, s67, "edges"), n63 = () => t71.render(this._bindParameters, e71), h32 = this._bindParameters.multipassGeometry.depth;
    this._offscreen.renderToTargets(n63, a59, h32 ?? i49, Ce), this._offscreen.compositeToFramebuffer(this._bindParameters, a59.getTexture(), i45.Alpha, 1), a59.release(), this.performanceInfo.advance(e71 === A5.OPAQUE ? a58.OPAQUE_EDGES : a58.TRANSPARENT_EDGES);
  }
  _renderShadowMap(e71, t71, r57) {
    const s67 = this._shadowMap;
    s67.enabled && (s67.start(e71, t71, r57, this.isFeatureEnabled(o32.HighResolutionShadows), this._stage.view.qualitySettings.maximumPixelRatio), this._needsShadowHighlight ? (this._renderShadowCascades(o9.ShadowHighlight, this._shadowMap), s67.moveSnapshot(P7.Highlight), this._renderShadowCascades(o9.ShadowExcludeHighlight, this._shadowMap), s67.copySnapshot(P7.ExcludeHighlight), this._renderShadowCascades(o9.ShadowHighlight, this._shadowMap)) : this._renderShadowCascades(o9.Shadow), s67.finish(), e71.setGLViewport(this._rctx), this.performanceInfo.advance(a58.SHADOW_MAP));
  }
  _renderShadowCascades(e71, t71 = this._shadowMap) {
    for (const r57 of t71.cascades) r57.camera.setGLViewport(this._rctx), this._ensureBindParametersCamera(r57.camera, r57.camera), this._renderAllGeometry(e71);
  }
  get _needsDepth() {
    return this._plugins.consumes(o9.Depth) || this.hasReflections || this._needsShadowHighlight || this._needsShadowCast || this._debugNeedsDepth;
  }
  _renderNoSSAOGeometryDepth(e71) {
    if (!this._needsDepth || !e71) return void (this._bindParameters.depth = t2(this._bindParameters.depth));
    const {
      width: t71,
      height: r57
    } = this._offscreen, s67 = this.fboCache.acquire(t71, r57, "depth");
    s67.attachDepth(e71), e71.release(), this._rctx.bindFramebuffer(s67.fbo), this._rctx.clearFramebuffer(void 0, false, true), this._renderGeometryExcludedFromSSAO(o9.Depth), t2(this._bindParameters.depth), this._bindParameters.depth = s67.obtainDepthTexture(), s67.release(), this.performanceInfo.advance(a58.DEPTH);
  }
  _renderAllGeometryDepth() {
    if (!this._needsDepth) return void (this._bindParameters.depth = t2(this._bindParameters.depth));
    const {
      width: e71,
      height: t71
    } = this._offscreen, r57 = this.fboCache.acquire(e71, t71, "depth").acquireDepth(E13.DEPTH_STENCIL_TEXTURE);
    this._rctx.bindFramebuffer(r57.fbo), this._rctx.clearFramebuffer(void 0, true, true), this._renderAllGeometry(o9.Depth), t2(this._bindParameters.depth), this._bindParameters.depth = r57.obtainDepthTexture(), r57.release(), this.performanceInfo.advance(a58.DEPTH);
  }
  _renderMultipassTerrainDepth(e71) {
    if (!e71) return void (this._bindParameters.multipassTerrain.depth = t2(this._bindParameters.multipassTerrain.depth));
    const t71 = this._renderContext.output;
    this._renderContext.output = o9.Depth;
    const {
      width: r57,
      height: s67
    } = this._offscreen, i49 = this.fboCache.acquire(r57, s67, "terrain depth").acquireDepth(E13.DEPTH_STENCIL_TEXTURE);
    this._rctx.bindFramebuffer(i49.fbo), this._rctx.clearFramebuffer(void 0, true, true), this._renderTransparentTerrain(), t2(this._bindParameters.multipassTerrain.depth), this._bindParameters.multipassTerrain.depth = i49.obtainDepthTexture(), this._renderContext.output = t71, i49.release();
  }
  _renderMultipassGeometryDepth(e71) {
    if (!e71) return void (this._bindParameters.multipassGeometry.depth = t2(this._bindParameters.multipassGeometry.depth));
    const t71 = this._renderContext.output, {
      width: r57,
      height: s67
    } = this._offscreen, i49 = this.fboCache.acquire(r57, s67, "geometry depth").acquireDepth(E13.DEPTH_STENCIL_TEXTURE);
    this._rctx.bindFramebuffer(i49.fbo), this._rctx.clearFramebuffer(void 0, true, true), this._renderOpaqueGeometryAndTransparentMaterial(o9.Depth), this._renderContext.output = t71, t2(this._bindParameters.multipassGeometry.depth), this._bindParameters.multipassGeometry.depth = i49.obtainDepthTexture(), i49.release();
  }
  get _needsDepthRange() {
    return this._shadowMap.enabled || this._needsShadowCast;
  }
  _computeDepthRange(e71) {
    if (!this._needsDepthRange) return u41;
    const t71 = M14(e71, this._plugins.plugins, this._stage.layers);
    return e62(t71, this._plugins.queryDepthRange(e71)), t71.near = Math.max(e71.near, t71.near), t71.far = Math.min(e71.far, t71.far), t71;
  }
  _renderNormals() {
    const e71 = this._nodes.require("normals", "final-color", "composite-color", "opaque-color", "transparent-color"), t71 = (this.hasSSAO ? 1 : 0) + (this.hasLaserlines ? 1 : 0) + e71;
    if (0 === t71) return;
    const r57 = this._offscreen.renderToCachedFBO(null, "normals", () => this._renderGeometryForSSAO(o9.Normal), [0, 0, 0, 0], R4.RGBA, E13.DEPTH_STENCIL_TEXTURE), s67 = this._nodes.optional("normals", "final-color", "composite-color", "opaque-color", "transparent-color") + (this._viewshedEnabled ? 1 : 0);
    return r57.retain(t71 + s67 - 1), this.performanceInfo.advance(a58.NORMALS), r57;
  }
  _renderSSAO() {
    const e71 = this._pluginInput.get("normals");
    if (!this.hasSSAO || !e71) return void e71?.detachDepth();
    const t71 = this._nodes.render("ssao", this._pluginInput);
    return this._bindParameters.ssao = t71, e71.detachDepth(), this._pluginInput.release("normals"), this.performanceInfo.advance(a58.SSAO), t71;
  }
  _renderAllGeometry(e71) {
    this._renderContext.output = e71, this._plugins.prepare(E12.TRANSPARENT_TERRAIN), this._renderOpaqueGeometryAndTransparentMaterial(e71), this._renderTransparentTerrain();
  }
  _renderOpaqueGeometryAndTransparentMaterial(e71) {
    this._renderContext.output = e71, this._plugins.prepare(E12.TRANSPARENT_MATERIAL, E12.TRANSPARENT_NO_SSAO_DEPTH), this._renderOpaqueGeometry(), this._renderTransparentMaterial();
  }
  _renderGeometryForSSAO(e71) {
    this._renderContext.output = e71, this._plugins.render(this._pluginInput, E12.INTEGRATED_MESH, E12.OPAQUE_TERRAIN, E12.OPAQUE_MATERIAL, E12.TRANSPARENT_MATERIAL), this._renderTransparentTerrain();
  }
  _renderGeometryExcludedFromSSAO(e71) {
    this._renderContext.output = e71, this._plugins.render(this._pluginInput, E12.OPAQUE_NO_SSAO_DEPTH, E12.TRANSPARENT_NO_SSAO_DEPTH);
  }
  _prepareOpaqueGeometry() {
    this._plugins.prepare(...we2, E12.OPAQUE_ENVIRONMENT);
  }
  _renderOpaqueGeometry() {
    this._plugins.render(this._pluginInput, ...we2);
  }
  _renderTransparentMaterial() {
    this._plugins.render(this._pluginInput, ...Ie);
  }
  _renderTransparentTerrain() {
    const e71 = this._renderContext.output;
    if (!this._plugins.produces(e71, E12.TRANSPARENT_TERRAIN)) return;
    const t71 = () => this._plugins.render(this._pluginInput, E12.TRANSPARENT_TERRAIN);
    if (e71 !== o9.Color) return void t71();
    const {
      width: r57,
      height: s67,
      depth: i49
    } = this._offscreen, a59 = this.fboCache.acquire(r57, s67, "transparent terrain");
    return this._offscreen.renderToTargets(t71, a59, i49, [0, 0, 0, 0]), a59;
  }
  _renderHUDVisibility() {
    this._plugins.produces(this._renderContext.output, E12.OCCLUSION_PIXELS) ? (this._bindParameters.hudVisibility = this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility, () => this._plugins.render(this._pluginInput, E12.OCCLUSION_PIXELS), this._bindParameters.multipassGeometry.depth), this._offscreen.bindFbo(), this.performanceInfo.advance(a58.HUD_VISIBILITY)) : this._bindParameters.hudVisibility = t2(this._bindParameters.hudVisibility);
  }
  _renderLineCallouts(e71) {
    if (this._bindParameters.hudRenderStyle = e71, e71 === c16.Occluded) {
      const e72 = () => this._plugins.render(this._pluginInput, E12.LINE_CALLOUTS), {
        width: t71,
        height: r57,
        color: s67
      } = this._offscreen, i49 = this.fboCache.acquireDepth(E13.DEPTH16_BUFFER, t71, r57, "line callouts");
      this._offscreen.renderToTargets(e72, s67, i49, void 0, true, true), i49.release();
    } else this._plugins.render(this._pluginInput, E12.LINE_CALLOUTS);
  }
  _renderLaserlines() {
    if (!this.hasLaserlines) return;
    this._plugins.render(this._pluginInput, E12.LASERLINES);
    if (this._plugins.produces(this._renderContext.output, E12.LASERLINES_CONTRAST_CONTROL)) {
      const e71 = this._offscreen, {
        width: t71,
        height: r57,
        depth: s67
      } = e71, i49 = this.fboCache.acquire(t71, r57, "laser lines"), a59 = () => this._plugins.render(this._pluginInput, E12.LASERLINES_CONTRAST_CONTROL);
      e71.renderToTargets(a59, i49, s67, Ce), e71.compositeToFramebuffer(this._bindParameters, i49.getTexture(), i45.PremultipliedAlpha, 1), i49.release();
    }
    this._pluginInput.release("normals"), this.performanceInfo.advance(a58.LASER_LINES);
  }
  _renderHUD(e71, t71) {
    if (this._pluginsHas.hudElements) {
      if (this._oitEnabled) {
        const r57 = this._renderOITPass(Re2.HUD, e71);
        this._rctx.bindFramebuffer(t71.fbo), this._compositingHelper.composite(this._bindParameters, r57.getTexture(), i45.PremultipliedAlpha), r57.release();
      } else if (e71 === c16.Occluded) {
        this._renderContext.output = o9.Color;
        const t72 = () => this._renderHUDElements(e71), {
          width: r57,
          height: s67,
          color: i49
        } = this._offscreen, a59 = this.fboCache.acquireDepth(E13.DEPTH16_BUFFER, r57, s67, "hud");
        this._offscreen.renderToTargets(t72, i49, a59, void 0, true, true), a59.release();
      } else this._renderContext.output = o9.Color, t71.acquireDepth(E13.DEPTH16_BUFFER), this._rctx.bindFramebuffer(t71.fbo), this._renderHUDElements(e71), t71.detachDepth();
      this.performanceInfo.advance(e71 === c16.Occluded ? a58.HUD_OCCLUDED : a58.HUD);
    }
  }
  _renderHUDElements(e71) {
    this._bindParameters.hudRenderStyle = e71, this._plugins.prepare(E12.LINE_CALLOUTS_HUD_DEPTH, E12.HUD_MATERIAL, E12.LABEL_MATERIAL), this._plugins.render(this._pluginInput, E12.LINE_CALLOUTS_HUD_DEPTH, E12.HUD_MATERIAL, E12.LABEL_MATERIAL);
  }
  get _needsShadowHighlight() {
    return this._shadowMap.enabled && this._plugins.produces(o9.ShadowHighlight, E12.OPAQUE_MATERIAL);
  }
  _renderHighlightPrepass() {
    if (!this.hasHighlights) return;
    const e71 = () => {
      this._renderAllGeometry(o9.Highlight), this._rctx.clear(_7.DEPTH_BUFFER_BIT), this._renderHUDElements(c16.Both);
    }, t71 = this._offscreen.renderToCachedFBO(null, "highlights", e71, [0, 0, 0, 0], R4.RGBA4, E13.DEPTH_STENCIL_TEXTURE);
    return t71.detachDepth(), t71;
  }
  get _needsShadowCast() {
    return this._shadowAccumulator.isAccumulating;
  }
  _renderShadowAccumulation(e71, t71, r57) {
    this._needsShadowCast && this._bindParameters.depth && this._shadowAccumulator.renderAccumulation(this._bindParameters.depth, e71, t71, r57) && this.performanceInfo.advance(a58.ACCUMULATED_SHADOWS);
  }
  _prepareTransparencySlots() {
    this._renderContext.output = o9.Color, this._bindParameters.transparencyPassType = o16.ColorAlpha, this._plugins.prepare(...Ie), this._bindParameters.transparencyPassType = o16.FrontFace, this._plugins.prepare(...Ie), this._bindParameters.transparencyPassType = o16.NONE, this._techniques.acquire(a55).release();
  }
  _renderOITPass(e71, t71 = c16.Both) {
    const r57 = e71 === Re2.HUD, s67 = r57 ? this.fboCache.acquire(this._offscreen.width, this._offscreen.height, "oit hud composite") : null, i49 = r57 ? () => this._renderHUDElements(t71) : () => this._renderTransparentMaterial(), a59 = this._renderContext.output;
    this._renderContext.output = o9.Color, this._bindParameters.transparencyPassType = o16.ColorAlpha;
    const n63 = this._offscreen.renderOITPass(i49, o16.ColorAlpha, r57);
    this._bindParameters.transparencyPassType = o16.FrontFace;
    const h32 = this._offscreen.renderOITPass(i49, o16.FrontFace, r57);
    return this._offscreen.compositeOIT(this._bindParameters, n63, h32, s67), s67?.detachDepth(), h32.release(), n63.release(), this._bindParameters.transparencyPassType = o16.NONE, this._renderContext.output = a59, s67;
  }
  _renderOccluded() {
    let e71 = 0;
    Oe.clear(), this._plugins.plugins.forAll((t72) => {
      if (!t72.materialReference) return;
      t72.queryRenderOccludedState(h8.OccludeAndTransparentStencil) && (e71 |= h8.OccludeAndTransparentStencil, Oe.push(t72));
    });
    const t71 = this._offscreen, r57 = (r58, s68, i50, a60, n64) => {
      if (!(e71 & s68)) return;
      const {
        width: h32,
        height: o60,
        depth: d38
      } = t71, l47 = this.fboCache.acquire(h32, o60, "tmp color");
      t71.renderToTargets(i50, l47, d38, [0, 0, 0, 0], a60, n64), t71.compositeToFramebuffer(this._bindParameters, l47.getTexture(), i45.PremultipliedAlpha, r58), l47.release();
    }, s67 = (e72, t72) => {
      this._bindParameters.slot = e72, t72.forAll((e73) => {
        if (a24(e73)) {
          const t73 = e73.prepareTechnique(this._renderContext);
          t73 && e73.renderNode(this._renderContext, t73);
        }
      });
    };
    0 !== Oe.length && (s67(E12.OCCLUDER_MATERIAL, Oe), r57(0.5, h8.OccludeAndTransparentStencil, () => s67(E12.TRANSPARENT_OCCLUDER_MATERIAL, Oe), false, false));
    const i49 = Oe.length > 0;
    Oe.clear(), this._plugins.plugins.forAll((t72) => {
      if (!t72.materialReference) return;
      const r58 = t72.queryRenderOccludedState(h8.OccludeAndTransparent), s68 = t72.queryRenderOccludedState(h8.Transparent), i50 = t72.queryRenderOccludedState(h8.Opaque);
      (r58 || s68 || i50) && (e71 |= r58 ? h8.OccludeAndTransparent : s68 ? h8.Transparent : h8.Opaque, Oe.push(t72));
    });
    const a59 = this._plugins.renderOccludedFlags;
    if (e71 |= a59, !e71) return;
    const n63 = (e72) => {
      this._renderContext.renderOccludedMask = e72, a59 > h8.Occlude && this._plugins.render(this._pluginInput, E12.OCCLUDED_TERRAIN), s67(E12.OPAQUE_MATERIAL, Oe), s67(E12.TRANSPARENT_MATERIAL, Oe), s67(E12.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL, Oe), this._renderContext.renderOccludedMask = l19;
    };
    this._renderContext.output = o9.Color, r57(0.5, h8.OccludeAndTransparent, () => n63(h8.OccludeAndTransparent), true, N2.OutlineVisualElementMask), r57(0.5, h8.Transparent, () => n63(h8.Transparent), true, N2.OutlineVisualElementMask), r57(1, h8.Opaque, () => n63(h8.Opaque), true, N2.OutlineVisualElementMask), (i49 || Oe.length > 0) && this.performanceInfo.advance(a58.OCCLUDED), Oe.clear();
  }
  _renderTransparentEnvironment() {
    this._shadowAccumulator.render(this._bindParameters), this._offscreen.bindFbo(), this._plugins.render(this._pluginInput, E12.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL, E12.TRANSPARENT_ENVIRONMENT), this.performanceInfo.advance(a58.TRANSPARENT_ENVIRONMENT);
  }
  _renderViewshed() {
    this._viewshedEnabled && (this._viewshed.renderHighQuality = this.isFeatureEnabled(o32.HighResolutionViewshed), this._plugins.render(this._pluginInput, E12.VIEWSHED), this._pluginInput.release("normals"), this.performanceInfo.advance(a58.VIEWSHED));
  }
  _renderPlugins(e71, t71) {
    this._plugins.produces(this._renderContext.output, e71) && (this._plugins.render(this._pluginInput, e71), this.performanceInfo.advance(t71));
  }
  _renderNodes(e71, t71, r57 = false) {
    if (!this._nodes.produces(e71)) return r57 && this.performanceInfo.advance(e71), t71;
    t71.setName(e71), this._pluginInput.set(e71, t71);
    const s67 = this._nodes.render(t71, this._pluginInput, this._releaseNormals);
    return this.performanceInfo.advance(e71), s67;
  }
  _blitToDefault(e71, t71 = T19, r57 = true) {
    this._blit || (this._blit = new o56(this._techniques));
    const s67 = this._blit.render(this._rctx, e71, t71, this._bindParameters, this._requestRender);
    return this._pluginInput.set(e71.name, s67), r57 && e71.release(), s67;
  }
  _ensureBindParametersCamera(e71, t71) {
    this._bindParameters.camera = e71, this._bindParameters.contentCamera = t71;
  }
  _ensureBindParametersSSR(e71) {
    if (this._bindParameters.ssr.lastFrameColor) {
      null == this._ssrEnableTime && (this._ssrEnableTime = e71), this._renderContext.lastFrameCamera.equals(this._bindParameters.camera) ? this._reprojectionMatrix = o8 : (h5(ye2, this._bindParameters.camera.viewMatrix), h5(Ne, this._bindParameters.camera.projectionMatrix), c4(De, ye2, Ne), c4(De, this._renderContext.lastFrameCamera.viewMatrix, De), c4(De, this._renderContext.lastFrameCamera.projectionMatrix, De), this._reprojectionMatrix = De);
      const t71 = this._stage.view.qualitySettings.fadeDuration;
      this._bindParameters.ssr.fadeFactor = t71 > 0 ? Math.min(t71, e71 - this._ssrEnableTime) / t71 : 1, this._bindParameters.ssr.fadeFactor < 1 && this._requestRender();
    } else this._reprojectionMatrix = o8, this._ssrEnableTime = null;
  }
  addRenderNode(e71) {
    this._nodes.add(e71), this._requestRender();
  }
  removeRenderNode(e71) {
    this._nodes.remove(e71), this._requestRender();
  }
  get usedMemory() {
    return {
      fbos: this.fboCache.usedMemory,
      plugins: this._plugins.usedMemory,
      edges: this.edgeView?.usedMemory ?? 0
    };
  }
  get _viewshedEnabled() {
    return this._viewshed.enabled && this._plugins.produces(this._renderContext.output, E12.VIEWSHED);
  }
  get test() {
  }
};
var Re2;
var Se;
e6([y2({
  readOnly: true
})], Pe2.prototype, "fullResolutionAtmosphere", null), e6([y2()], Pe2.prototype, "_edgeView", void 0), e6([y2()], Pe2.prototype, "updating", null), function(e71) {
  e71[e71.Geometry = 0] = "Geometry", e71[e71.HUD = 1] = "HUD";
}(Re2 || (Re2 = {})), function(e71) {
  e71[e71.Color = 0] = "Color", e71[e71.LinearDepth = 1] = "LinearDepth", e71[e71.ShadowMap = 2] = "ShadowMap", e71[e71.HudVisibility = 3] = "HudVisibility", e71[e71.ViewshedShadowMap = 4] = "ViewshedShadowMap";
}(Se || (Se = {}));
var Ce = [0, 0, 0, 0];
var we2 = [E12.INTEGRATED_MESH, E12.OPAQUE_TERRAIN, E12.OPAQUE_MATERIAL, E12.OPAQUE_NO_SSAO_DEPTH];
var Ie = [E12.TRANSPARENT_MATERIAL, E12.TRANSPARENT_NO_SSAO_DEPTH];
var Oe = new l3();
var Ne = e15();
var ye2 = e15();
var De = e15();
function Me(e71) {
  return (t71) => e71.immediate.schedule(t71);
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/effects/ScreenSpaceGeometry.js
var m44 = class {
  constructor(t71) {
    this._rctx = t71, this._vao = c42(t71);
  }
  destroy() {
    this._vao = r2(this._vao);
  }
  draw() {
    null != this._vao && (this._rctx.bindVAO(this._vao), this._rctx.drawArrays(E7.TRIANGLES, 0, 3));
  }
  get test() {
  }
};
function c42(t71, i49 = o30, m45 = O8) {
  const c44 = new Float32Array([-1, -1, 3, -1, -1, 3]);
  return new r32(t71, m45, {
    geometry: i49
  }, {
    geometry: c7.createVertex(t71, F3.STATIC_DRAW, c44)
  });
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderingContext.js
var t69 = class extends y8 {
  constructor(r57, s67, t71) {
    super(r57, s67), this.gl = r57, this.newCache = t71, this._appleAmdDriverHelper = null, this._refCount = 1, this.screen = new m44(this);
  }
  destroy() {
    --this._refCount > 0 || this.dispose();
  }
  ref() {
    ++this._refCount;
  }
  dispose() {
    super.dispose(), this._appleAmdDriverHelper?.dispose(), this.screen.destroy();
  }
  bindTechnique(e71, r57, s67, t71, i49) {
    return this.useProgram(e71.program), this.setPipelineState(e71.getPipeline(!!i49)), e71.program.bindPass(s67, r57), t71 && e71.program.bindDraw(t71, r57, s67), e71.program;
  }
  runAppleAmdDriverHelper() {
    this.driverTest.drawArraysRequiresIndicesTypeReset.result && (this._appleAmdDriverHelper ??= new n25(this), this._appleAmdDriverHelper.run());
  }
  get test() {
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/ITexture.js
function e69(e71) {
  return !!e71.frameUpdate;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureRepository.js
var _29 = class extends S3 {
  constructor(e71, t71, s67) {
    super({}), this._stage = e71, this._techniques = t71, this._rctx = s67, this._textures = /* @__PURE__ */ new Map(), this._loadingCount = 0, this._frameUpdates = /* @__PURE__ */ new Map(), this.events = new o3(), this._frameTask = e71.view.resourceController.scheduler.registerTask(I3.TEXTURE_UNLOAD);
  }
  normalizeCtorArgs() {
    return {};
  }
  destroy() {
    this._frameTask.remove(), this._stage.forEachOfType(e24.Texture, (e71) => e71.unload());
  }
  get updating() {
    return this._loadingCount > 0 || this._frameTask.updating;
  }
  get textureTechnique() {
    return null == this._textureTechnique && (this._textureTechnique = this._techniques.acquire(m20, new r33())), this._textureTechnique;
  }
  acquire(e71) {
    const t71 = this._textures.get(e71);
    return t71 ? (t71.ref(), t71.loadingPromise ?? t71) : this._createNewRef(e71);
  }
  update() {
    let e71 = false;
    this._frameUpdates.forEach((t71) => {
      const r57 = t71.texture.frameUpdate(t71.previousToken);
      r57 >= 0 && r57 !== t71.previousToken && (t71.previousToken = r57, e71 = true);
    }), e71 && this.events.emit("changed", O7.BACKGROUND);
  }
  _createNewRef(e71) {
    const t71 = this._stage.getObject(e71);
    if (null == t71) return s14(void 0 !== t71), null;
    const r57 = t71.events.on("unloaded", () => {
      r57.remove(), this._onTextureUnloaded(e71);
    }), n63 = new f43(e71, () => {
      this._frameTask.schedule(() => {
        n63.isUnreferenced && t71.unload();
      });
    });
    return this._textures.set(e71, n63), n63.ref(), t71.glTexture ? (this._updateGLTexture(n63, t71.glTexture), e69(t71) && this._frameUpdates.set(e71, {
      texture: t71,
      previousToken: -1
    }), n63) : (this._loadingCount++, n63.loadingPromise = this._stage.schedule(() => {
      const r58 = t71.load(this._rctx), u46 = (r59) => (this._loadingCount--, n63.loadingPromise = null, this._updateGLTexture(n63, r59), e69(t71) && this._frameUpdates.set(e71, {
        texture: t71,
        previousToken: -1
      }), n63), a59 = (e72) => (this._loadingCount--, n63.loadingPromise = null, b(e72) || n.getLogger(this).error(e72), null);
      return S2(r58) ? r58.then(u46, a59) : u46(r58);
    }), n63.loadingPromise);
  }
  _updateGLTexture(e71, t71) {
    e71.glTexture = t71, this.events.emit("changed", O7.UPDATE);
  }
  _onTextureUnloaded(e71) {
    this._textures.delete(e71), this._frameUpdates.delete(e71);
  }
};
e6([y2()], _29.prototype, "_loadingCount", void 0), e6([y2()], _29.prototype, "_frameTask", void 0), e6([y2()], _29.prototype, "updating", null), _29 = e6([a4("esri.views.3d.webgl-engine.lib.TextureRepository")], _29);
var f43 = class {
  constructor(e71, t71) {
    this.id = e71, this._release = t71, this._refCount = 0;
  }
  get isUnreferenced() {
    return 0 === this._refCount;
  }
  ref() {
    ++this._refCount;
  }
  release() {
    --this._refCount, this._refCount > 0 || (0 !== this._refCount ? (n.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"), this._refCount = 0) : this._release());
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/markerTextureRepository.js
function o58(o60, t71) {
  return new t35((e71) => f18(e71, o60), (r57) => r57, t71);
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/WaterTextureRepository.js
var w23 = class extends S3 {
  constructor() {
    super(...arguments), this._passParameters = new f44(), this._resourcesTask = null;
  }
  get passParameters() {
    return this._passParameters;
  }
  destroy() {
    this._resourcesTask = e(this._resourcesTask), this._passParameters.waveNormal = r2(this._passParameters.waveNormal), this._passParameters.wavePerturbation = r2(this._passParameters.wavePerturbation);
  }
  get updating() {
    return !!this._resourcesTask && !this._resourcesTask.finished;
  }
  ensureResources(s67) {
    return this._resourcesTask || (this._resourcesTask = d((r57) => __async(this, null, function* () {
      yield Promise.allSettled([this._loadImageResource(s67, n6("esri/images/materials/water/normals.jpg"), (s68) => this._passParameters.waveNormal = s68, r57), this._loadImageResource(s67, n6("esri/images/materials/water/perturbation.jpg"), (s68) => this._passParameters.wavePerturbation = s68, r57)]);
    }))), this._resourcesTask.finished ? a16.LOADED : a16.LOADING;
  }
  _loadImageResource(s67, e71, r57, t71) {
    return __async(this, null, function* () {
      try {
        const a59 = yield t15(e71, {
          signal: t71
        });
        s3(t71);
        const o60 = new e22(a59.width, a59.height);
        o60.pixelFormat = G4.RGB, o60.samplingMode = L5.LINEAR_MIPMAP_LINEAR, o60.hasMipmap = true, o60.maxAnisotropy = 8, r57(new c8(s67, o60, a59));
      } catch (o60) {
        n.getLogger(this).error("Failed to load water material normal texture.", o60);
      }
    });
  }
};
e6([y2()], w23.prototype, "_resourcesTask", void 0), e6([y2({
  type: Boolean,
  readOnly: true
})], w23.prototype, "updating", null), w23 = e6([a4("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")], w23);
var f44 = class extends n15 {
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/contextCache.js
var n62 = /* @__PURE__ */ new Map();
function t70() {
  return n62;
}

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/ScreenshotManager.js
var d37 = class {
  constructor(e71, t71, r57) {
    this.parameters = e71, this.frameHasDecorations = t71, this.fbos = r57;
  }
};
var f45 = class {
  constructor(e71, t71, r57) {
    this._rctx = e71, this._renderFunctions = t71, this._forceCameraHook = r57, this.supersample = true, this._screenshotQueue = new Array();
  }
  destroy() {
    this._rctx = null;
  }
  takeScreenshot(t71) {
    return __async(this, null, function* () {
      yield this._renderFunctions.prepareOverlay(), this._renderFunctions.requestRenderScene(O7.BACKGROUND);
      const s67 = L();
      return this._screenshotQueue.push({
        settings: t71,
        resolver: s67
      }), s67.promise;
    });
  }
  update(e71, t71) {
    for (const r57 of this._screenshotQueue) {
      if (null == this._rctx) {
        r57.resolver.reject();
        continue;
      }
      const s67 = __spreadProps(__spreadValues({}, r57.settings), {
        pixelRatio: r57.settings.pixelRatio * e71.parameters.camera.pixelRatio
      }), i49 = this._renderScreenshot(e71, s67, t71);
      r57.resolver(i49);
    }
    this._screenshotQueue.length = 0;
  }
  _renderScreenshotOverlay(e71, t71, r57) {
    e71.width = t71.width, e71.height = t71.height;
    const i49 = e71.getContext("2d"), o60 = r57.pixelRatio;
    return i49.save(), i49.translate(0, t71.height), i49.scale(1, -1), r57.region && i49.translate(-r57.region.x, -r57.region.y), i49.scale(o60, o60), t71 = this._renderFunctions.renderOverlay(e71, r57.disableDecorations ? i11.OFF : i11.ON, t71), i49.restore(), t71;
  }
  _readbackScreenshot(e71, t71) {
    return e71.resample ? this._readbackScreenshotResampled(__spreadProps(__spreadValues({}, e71), {
      resample: e71.resample
    }), t71) : this._readbackScreenshotImmediate(e71, t71);
  }
  _readbackScreenshotResampled(e71, t71) {
    const {
      framebufferWidth: r57,
      framebufferHeight: s67,
      region: i49,
      resample: o60
    } = e71, h32 = this._ensureScreenshotEncodeCanvas();
    let d38 = s18(r57, s67, h32);
    this._rctx.gl.readPixels(0, 0, r57, s67, G4.RGBA, C5.UNSIGNED_BYTE, new Uint8Array(d38.data.buffer)), t71(), d38 = this._renderScreenshotOverlay(h32, d38, __spreadProps(__spreadValues({}, e71), {
      region: void 0
    }));
    const f46 = s18(i49.width, i49.height, h32);
    return w7(d38, f46, true, o60.region.x, s67 - (o60.region.y + o60.region.height), o60.region.width, o60.region.height);
  }
  _readbackScreenshotImmediate(e71, t71) {
    const {
      framebufferHeight: r57,
      region: s67
    } = e71, i49 = this._ensureScreenshotEncodeCanvas(), o60 = s18(s67.width, s67.height, i49);
    return this._rctx.gl.readPixels(s67.x, r57 - (s67.y + s67.height), s67.width, s67.height, G4.RGBA, C5.UNSIGNED_BYTE, new Uint8Array(o60.data.buffer)), t71(), this._renderScreenshotOverlay(i49, o60, e71);
  }
  _renderScreenshot(e71, r57, n63) {
    const a59 = e71.parameters.camera, c44 = {
      width: r57.framebufferWidth,
      height: r57.framebufferHeight
    };
    A6(c44, Math.min(this._rctx.parameters.maxTextureSize, this._rctx.parameters.maxRenderbufferSize));
    let l47 = false;
    const d38 = r57.disableDecorations && e71.frameHasDecorations, f46 = c44.width !== a59.fullWidth || c44.height !== a59.fullHeight, m45 = r57.ignorePadding && a59.pixelRatio !== r57.pixelRatio, u46 = f46 || d38 || m45 || r57.objectAndLayerIdColor;
    let p49 = null, g28 = null;
    if (u46) {
      const e72 = a59.clone();
      if (r57.ignorePadding) {
        const s67 = t5(e72.padding);
        for (let t71 = 0; t71 < 4; t71++) s67[t71] = Math.round(s67[t71] / e72.pixelRatio * r57.pixelRatio);
        e72.padding = s67;
      }
      e72.fullWidth = c44.width, e72.fullHeight = c44.height, e72.pixelRatio = r57.pixelRatio;
      const h32 = a59.fovX - e72.fovX, d39 = a59.fovY - e72.fovY;
      h32 < 0 && h32 < d39 ? e72.fovX = a59.fovX : d39 < 0 && d39 < h32 && (e72.fovY = a59.fovY);
      const f47 = {
        camera: e72,
        contentCamera: e72,
        mode: I2.IDLE,
        alignPixelEnabled: true,
        contentPixelRatio: e72.pixelRatio
      };
      this._forceCameraHook(f47), l47 = true;
      const m46 = this._renderFunctions.renderScene(f47, n63, r57.objectAndLayerIdColor ? r30.ObjectAndLayerID : r30.Screenshot, r57.disableDecorations ? i11.OFF : i11.ON);
      g28 = m46.screen, p49 = m46.oid;
    }
    const b25 = () => {
      this._rctx.bindFramebuffer(null), g28?.release();
    };
    this._rctx.bindFramebuffer(g28?.fbo);
    const _30 = this._readbackScreenshot(r57, b25);
    let x26 = null;
    if (r57.objectAndLayerIdColor) {
      const e72 = () => {
        this._rctx.bindFramebuffer(null), p49?.release();
      };
      this._rctx.bindFramebuffer(p49?.fbo), x26 = this._readbackScreenshot(r57, e72), this._rctx.bindFramebuffer(null);
    }
    if (u46 && !this._rctx.contextAttributes.alpha) for (let t71 = 3; t71 < _30.data.length; t71 += 4) _30.data[t71] = 255;
    if (x26 && !this._rctx.contextAttributes.alpha) for (let t71 = 3; t71 < x26.data.length; t71 += 4) x26.data[t71] = 255;
    return l47 && this._forceCameraHook(e71.parameters), [_30, x26];
  }
  _ensureScreenshotEncodeCanvas() {
    return this._screenshotEncodeCanvas || (this._screenshotEncodeCanvas = document.createElement("canvas")), this._screenshotEncodeCanvas;
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/testUtils.js
var o59 = {
  enabled: false,
  disposeContextCache: () => {
    const o60 = t70();
    o60.forEach((e71) => e71.dispose()), o60.clear();
  }
};

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/parts/RenderView.js
var B16 = class extends S3 {
  constructor(e71) {
    super({}), this.events = new o3(), this.waterTextures = new w23(), this.objectAndLayerIdRenderHelper = has("enable-feature:objectAndLayerId-rendering") ? new o55() : null, this._needsUpdate = true, this._needsRender = true, this._idleSuspend = true, this._needsWaterReflectionUpdate = false, this._lastAnimationUpdate = 0, this._container = e71.container, this._viewingMode = e71.viewingMode;
    try {
      this._initializeContext(e71);
    } catch (i49) {
      return void console.error("Failed to initialize context", i49);
    }
    const {
      memoryController: t71
    } = e71.view.resourceController;
    this.stippleTextures = u17(this._rctx, t71), this.markerTextures = o58(this._rctx, t71), this._techniques = new r31({
      rctx: this._rctx,
      viewingMode: e71.viewingMode,
      stippleTextures: this.stippleTextures,
      waterTextures: this.waterTextures,
      markerTextures: this.markerTextures
    }), this._textures = new _29(e71, this._techniques, this._rctx), this.addHandles(this._textures.events.on("changed", (e72) => this.requestRender(e72))), this._materials = new s30(this._textures, this._techniques, () => this.requestRender(), () => this.requestRender()), this._compositingHelper = new n56(this._rctx, this._techniques), this.renderer = new Pe2(e71, this._materials, this._techniques, this._rctx, this._compositingHelper, (e72) => this.requestRender(e72)), this.addHandles([d2(() => e71.view.ready, (t72) => {
      t72 && this._createRenderNodes(e71.view, e71.viewingMode);
    }, P), d2(() => this.waterTextures?.updating, () => this.requestRender(), P), d2(() => e71.view.qualityProfile, (e72) => this.renderer?.updateRenderFeatures(e72), A3)]);
    const s67 = {
      renderScene: (e72, t72, r57, s68) => this.renderer.render(e72, t72, r57, s68),
      requestRenderScene: (e72) => this.requestRender(e72),
      prepareOverlay: () => e71.options.screenshot.prepareOverlay(),
      renderOverlay: (t72, r57, s68) => e71.options.screenshot.renderOverlay(t72, r57, s68)
    };
    this._screenshotManager = new f45(this._rctx, s67, (e72) => this.events.emit("force-camera-for-screenshot", e72)), this._registerFrameTask(e71);
  }
  normalizeCtorArgs() {
    return {};
  }
  destroy() {
    this._container.contains(this._canvas) && this._container.removeChild(this._canvas), this._frameTask = l(this._frameTask), this._techniques = u(this._techniques), this._componentObjects = u(this._componentObjects), this._screenshotManager = u(this._screenshotManager), u(this.renderer), this._textures = u(this._textures), u(this.waterTextures), u(this.markerTextures), u(this.stippleTextures), this._canvas = null, this._container = null, this._rctx = u(this._rctx);
  }
  _createRenderNodes(e71, t71) {
    new y6({
      view: e71,
      isEnabled: () => this.renderer.hasSSAO,
      techniques: this._techniques
    }), new g26({
      view: e71,
      isEnabled: () => this.renderer.hasSMAA,
      techniques: this._techniques
    }), new S24({
      view: e71,
      techniques: this._techniques
    }), new R14({
      view: e71,
      techniques: this._techniques
    }), new b23({
      view: e71,
      viewingMode: t71,
      techniques: this._techniques
    });
  }
  requestRender(e71 = O7.UPDATE) {
    this._needsRender = true, e71 === O7.UPDATE && (this._needsUpdate = true);
  }
  get updating() {
    return this._needsUpdate || this._needsWaterReflectionUpdate || this.renderer.updating || this._textures.updating || this.waterTextures.updating;
  }
  get textures() {
    return this._textures;
  }
  get compositingHelper() {
    return this._compositingHelper;
  }
  setIdleSuspend(e71) {
    this._idleSuspend !== e71 && (this._idleSuspend = e71, this.requestRender());
  }
  get renderingContext() {
    return this._rctx;
  }
  get capabilities() {
    return this._rctx.capabilities;
  }
  get canvas() {
    return this._canvas;
  }
  takeScreenshot(e71) {
    return this._screenshotManager.takeScreenshot(e71).then((e72) => e72[0]);
  }
  takeScreenshotWithOID(e71) {
    return e71.objectAndLayerIdColor = true, this._screenshotManager.takeScreenshot(e71);
  }
  getAlpha() {
    return !!this._rctx.contextAttributes.alpha;
  }
  getMinimalDepthForArea(e71, t71, r57, s67, i49, n63 = i49) {
    const o60 = s67.constrainWindowSize(t71, r57, i49 * s67.pixelRatio, n63 * s67.pixelRatio), a59 = this._ensureDepthBuffer(o60);
    this.renderer.readDepthPixels(o60, a59);
    let h32 = Number.MAX_VALUE;
    for (let c44 = 0; c44 < o60[2] * o60[3]; c44++) {
      const e72 = B15(4 * c44, a59, s67.nearFar);
      h32 > e72 && e72 !== s67.nearFar[0] && e72 !== s67.nearFar[1] && (h32 = e72);
    }
    if (e71) {
      const i50 = e71.pickDepth(t71 * s67.pixelRatio, r57 * s67.pixelRatio, s67);
      null != i50 && h32 > i50 && i50 !== s67.nearFar[0] && i50 !== s67.nearFar[1] && (h32 = i50);
    }
    return h32 === Number.MAX_VALUE ? void 0 : h32;
  }
  _ensureDepthBuffer(e71) {
    const t71 = 4 * e71[2] * e71[3];
    return (null == this._tmpDepthBuffer || this._tmpDepthBuffer.byteLength < t71) && (this._tmpDepthBuffer = new Uint8Array(t71)), this._tmpDepthBuffer;
  }
  reloadShaders() {
    return __async(this, null, function* () {
      e56(), yield this._techniques.reloadAll(), this.requestRender();
    });
  }
  _registerFrameTask(e71) {
    const t71 = e71.view.state;
    let r57 = false, s67 = O7.BACKGROUND, i49 = false;
    const n63 = {
      preRender: ({
        time: i50
      }) => {
        r57 = this.updating, s67 = this._needsUpdate ? O7.UPDATE : O7.BACKGROUND, e71.commitSyncLayers();
        const n64 = n3(i50 - this._lastAnimationUpdate);
        if (n64 > this.renderer.animationTimestep || null != t71.forcedAnimationTime || r57 || this._needsRender) {
          const e72 = n3(n64 / this.renderer.animationTimeDilation), r58 = new d8(t71.camera, e72, t71.forcedAnimationTime);
          this.renderer.updateAnimation(r58) && this.requestRender(O7.BACKGROUND), this._lastAnimationUpdate = i50;
        }
      },
      render: ({
        time: e72
      }) => {
        if ((this._needsRender || !this._idleSuspend || !this.renderer.isCameraFinal || this._needsWaterReflectionUpdate) && t71.camera.fullWidth > 0 && t71.camera.fullHeight > 0) {
          const r58 = this._needsUpdate && this._idleSuspend && this.renderer.isCameraFinal;
          this._needsRender = false, this._needsUpdate = false, this._needsWaterReflectionUpdate = false, this.renderer.render(t71, e72), i49 = true, r58 && this.renderer.hasReflections && (this.requestRender(O7.BACKGROUND), this._needsWaterReflectionUpdate = true);
        }
      },
      update: ({
        time: e72
      }) => {
        const r58 = this.renderer.hasSlicePlane || this.renderer.hasDecorations || this.renderer.hasHighlights, s68 = new d37(t71, r58, this.renderer.fboCache);
        this._textures.update(), this._screenshotManager.update(s68, e72);
      },
      finish: () => {
        i49 && (this.renderer.finish(t71.mode === I2.IDLE ? s67 : O7.UPDATE), i49 = false);
      }
    };
    this._frameTask = A2(n63);
  }
  _initializeContext(e71) {
    const t71 = e71.options;
    this._canvas = t71.canvas, this._canvas || (this._canvas = document.createElement("canvas")), this._canvas.setAttribute("style", "width: 100%; height:100%; display:block;");
    const r57 = {
      alpha: t71.alpha || false,
      premultipliedAlpha: true,
      antialias: false,
      depth: true,
      stencil: t71.stencil ?? true,
      powerPreference: "high-performance",
      preserveDrawingBuffer: t71.preserveDrawingBuffer ?? false
    }, i49 = t21(this._canvas, r57);
    null != i49 ? (this._rctx = F17(i49, e71), this._loadShaderOnlyExtensions(), !t71.alpha && this._rctx.contextAttributes.alpha && n.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"), !this._rctx.contextAttributes.alpha && has("safari") >= 11 && (this._container.style.backgroundColor = "black"), this._container.appendChild(this._canvas)) : n.getLogger(this).error("A WebGL2 context could not be created.");
  }
  _loadShaderOnlyExtensions() {
    this._rctx.capabilities.enable("textureFloatLinear");
  }
  getObjectAndLayerIdColor(e71) {
    return null != this.objectAndLayerIdRenderHelper ? this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e71) : null;
  }
  get componentObjectCollection() {
    return null == this._componentObjects && (this._componentObjects = new q18(this.renderer.renderPassManager, this._viewingMode)), this._componentObjects;
  }
  set componentObjectCollection(e71) {
    this._componentObjects = e71;
  }
};
function F17(e71, t71) {
  const r57 = {
    disabledExtensions: t71.options.deactivatedWebGLExtensions || {},
    debugWebGLExtensions: t71.options.debugWebGLExtensions || {},
    maxAnisotropy: 8
  }, s67 = (e72, r58) => t71.view.resourceController.memoryController.newCache(e72, r58);
  if (o59.enabled) {
    let t72 = I24.get(e71);
    return t72 ? (t72.configure(r57), t72.newCache = s67, t72.ref(), t72) : (t72 = new t69(e71, r57, s67), I24.set(e71, t72), t72.ref(), t72);
  }
  return new t69(e71, r57, s67);
}
e6([y2({
  type: Boolean,
  readOnly: true
})], B16.prototype, "updating", null), e6([y2()], B16.prototype, "_rctx", void 0), e6([y2()], B16.prototype, "_container", void 0), e6([y2()], B16.prototype, "_canvas", void 0), e6([y2()], B16.prototype, "stippleTextures", void 0), e6([y2()], B16.prototype, "markerTextures", void 0), e6([y2()], B16.prototype, "waterTextures", void 0), e6([y2({
  readOnly: true
})], B16.prototype, "objectAndLayerIdRenderHelper", void 0), e6([y2()], B16.prototype, "_textures", void 0), e6([y2({
  readOnly: true
})], B16.prototype, "renderer", void 0), e6([y2()], B16.prototype, "_screenshotManager", void 0), e6([y2()], B16.prototype, "componentObjectCollection", null), e6([y2()], B16.prototype, "_componentObjects", void 0), e6([y2()], B16.prototype, "_needsUpdate", void 0), e6([y2()], B16.prototype, "_needsWaterReflectionUpdate", void 0), B16 = e6([a4("esri.views.3d.webgl-engine.parts.RenderView")], B16);
var I24 = t70();

// ../../../node_modules/@arcgis/core/views/3d/webgl-engine/Stage.js
var u45 = class extends S3 {
  constructor(e71) {
    super(e71), this._model = new h27(), this._layers = new l3(), this._asyncChangeSet = new s29(), this._syncChangeSet = new s29(), this._layerSyncSet = /* @__PURE__ */ new Set();
  }
  initialize() {
    this._set("renderView", new B16(this)), this._frameTask = this.view.resourceController.scheduler.registerTask(I3.STAGE, this), this.addHandles(this._frameTask);
  }
  destroy() {
    this.renderView.destroy();
  }
  get viewingMode() {
    return this.view.state.viewingMode;
  }
  get updating() {
    return this.running || this.renderView.updating || this._frameTask.updating;
  }
  get renderer() {
    return this.renderView?.renderer;
  }
  add(e71) {
    this._model.add(e71), n32(e71) && this._addLayer(e71), this.renderView.requestRender();
  }
  remove(e71) {
    null != e71 && !this.destroyed && this._model.remove(e71) && (n32(e71) && this._removeLayer(e71), this.renderView.requestRender());
  }
  addMany(e71) {
    null != e71 && (this._model.addMany(e71), this.renderView.requestRender());
  }
  removeMany(e71) {
    null != e71 && (this._model?.removeMany(e71), this.renderView?.requestRender());
  }
  forEachOfType(e71, t71) {
    this._model.forEachOfType(e71, t71);
  }
  handleEvent(e71, t71) {
    this.destroyed || (this._model.dirtySet[e71](t71), this.renderView.requestRender());
  }
  get running() {
    return this._model.dirtySet.dirty || !this._asyncChangeSet.empty;
  }
  runTask(e71) {
    if (this._frameTask.processQueue(e71), this._commit(e71), !e71.hasProgressed) return o12;
  }
  _commit(e71) {
    const t71 = this._model.dirtySet;
    this._asyncChangeSet.empty || e71.done || (this.renderer.modify(this._asyncChangeSet, e71), this.renderView.requestRender(), e71.madeProgress()), this._layers.forAll((r57) => {
      if (e71.done) return;
      const s67 = this._layerSyncSet.has(r57.id) || r57.updatePolicy === C7.SYNC, i49 = s67 ? this._syncChangeSet : this._asyncChangeSet;
      t71.commitLayer(r57.id, i49), this._layerSyncSet.delete(r57.id), i49.empty || (this.renderer.modify(i49, s67 ? C4 : e71), this.renderView.requestRender(), e71.madeProgress());
    }), this._syncChangeSet.empty || (this.renderer.modify(this._syncChangeSet, C4), this.renderView.requestRender(), e71.madeProgress()), this._layers.forAll((r57) => {
      e71.done || this._layerSyncSet.has(r57.id) || r57.updatePolicy !== C7.ASYNC || (t71.commitLayer(r57.id, this._asyncChangeSet), this._asyncChangeSet.empty || (this.renderer.modify(this._asyncChangeSet, e71), this.renderView.requestRender(), e71.madeProgress()));
    }), this._layerSyncSet.clear(), this.notifyChange("running");
  }
  commitSyncLayers() {
    const e71 = this._model.dirtySet;
    this._layers.forAll((t71) => {
      this._layerSyncSet.has(t71.id) || t71.updatePolicy === C7.SYNC ? (e71.commitLayer(t71.id, this._syncChangeSet), this._layerSyncSet.delete(t71.id)) : e71.commitSyncUpdates(t71.id, this._syncChangeSet);
    });
    for (const t71 of this._layerSyncSet) e71.commitLayer(t71, this._syncChangeSet);
    this._layerSyncSet.clear(), this._syncChangeSet.empty || (this.renderer.modify(this._syncChangeSet, C4), this.renderView.requestRender());
  }
  _commitLayer(e71) {
    this._model.dirtySet.commitLayer(e71.id, this._syncChangeSet), this._layerSyncSet.delete(e71.id), this._syncChangeSet.empty || (this.renderer.modify(this._syncChangeSet, C4), this.renderView.requestRender());
  }
  schedule(e71, t71) {
    return this._frameTask.schedule(e71, t71);
  }
  reschedule(e71, t71) {
    return this._frameTask.reschedule(e71, t71);
  }
  syncLayer(e71) {
    this._layerSyncSet.add(e71), this.renderView.requestRender();
  }
  getObject(e71) {
    return this._model.getObject(e71);
  }
  get layers() {
    return this._layers;
  }
  _addLayer(e71) {
    this._layers.includes(e71) || this._layers.push(e71);
  }
  _removeLayer(e71) {
    this._commitLayer(e71), null != this._layers.removeUnordered(e71) && (this._model.dirtySet.getResidentRenderGeometries(e71.id, this._syncChangeSet.removes), this.renderer.modify(this._syncChangeSet, C4));
  }
  addRenderPlugin(e71, t71) {
    const r57 = this.renderer.plugins.add(e71, t71), i49 = () => {
      k17(e71) && this.view.sceneIntersectionHelper.addIntersectionHandler(e71);
    };
    if (S2(r57)) return r57.then(i49);
    i49();
  }
  removeRenderPlugin(e71) {
    this.destroyed || (k17(e71) && this.view.sceneIntersectionHelper.removeIntersectionHandler(e71), this.renderer.plugins.remove(e71));
  }
  get performanceInfo() {
    return this._model.getStats();
  }
  get test() {
  }
};
u45.DebugSettings = {
  endFrameContentValidation: false
}, e6([y2({
  constructOnly: true
})], u45.prototype, "view", void 0), e6([y2({
  constructOnly: true
})], u45.prototype, "options", void 0), e6([y2({
  readOnly: true
})], u45.prototype, "viewingMode", null), e6([y2({
  constructOnly: true
})], u45.prototype, "container", void 0), e6([y2({
  readOnly: true
})], u45.prototype, "updating", null), e6([y2({
  constructOnly: true
})], u45.prototype, "_model", void 0), e6([y2()], u45.prototype, "renderView", void 0), e6([y2({
  readOnly: true
})], u45.prototype, "renderer", null), e6([y2({
  readOnly: true
})], u45.prototype, "running", null), u45 = e6([a4("esri.views.3d.webgl-engine.Stage")], u45);

// ../../../node_modules/@arcgis/core/views/ui/3d/DefaultUI3D.js
var e70 = class extends u10 {
  constructor(o60) {
    super(o60), this.components = ["attribution", "zoom", "navigation-toggle", "compass"];
  }
};
e6([y2()], e70.prototype, "components", void 0), e70 = e6([a4("esri.views.ui.3d.DefaultUI3D")], e70);
var c43 = e70;

// ../../../node_modules/@arcgis/core/views/SceneView.js
var tt4 = class extends o20(y7(H4(N4))) {
  constructor(e71) {
    super(e71), this._userClippingArea = null, this._clippingArea = null, this._initialDefaultSpatialReference = null, this._createGraphicsViewController = null, this._resolveWhenReady = [], this._propertiesPool = new o21({
      slicePlane: G5
    }, this), this._resourceController = j13(this), this._defaultToMapOptions = {
      include: /* @__PURE__ */ new Set()
    }, this._defaultHitTestOptions = {
      exclude: /* @__PURE__ */ new Set()
    }, this.deconflictor = new u32({
      view: this
    }), this.labeler = new V5({
      view: this,
      deconflictor: this.deconflictor.labels
    }), this.sharedSymbolResources = null, this.analyses = new t23(), this.basemapTerrain = null, this.elevationProvider = null, this.canvas = null, this.constraints = new c27(), this.environment = new f27(), this.environmentManager = new L11(), this.floors = new V(), this.fullOpacity = 1, this.graphicsView = null, this.analysisViewManager = new f25({
      view: this
    }), this.groundView = null, this.map = null, this.screenSizePerspectiveEnabled = true, this.state = new f31(), this.spatialReference = null, this.alphaCompositingEnabled = false, this.preserveDrawingBufferEnabled = false, this.supersampleScreenshotsEnabled = true, this.type = "3d", this.ui = new c43(), this._numUpdating = 0, this._lastUpdateTime = 0, this.updatingProgress = 0.5, this.highlightOptions = new y18(), m12();
    const t71 = (e72 = null) => {
      null != e72 && e72.type === E.MOVE || (this._updatingChanged(), this.map && this.map.allLayers.forEach((e73) => __async(this, null, function* () {
        try {
          yield e73.when();
        } catch {
        }
        this._updatingChanged();
      })));
    };
    this.addHandles([v2(() => this.map?.allLayers, "after-changes", (e72) => t71(e72), {
      onListenerAdd: () => t71(),
      onListenerRemove: () => t71(),
      sync: true
    }), this.allLayerViews.on("after-changes", (e72) => this._updateUpdatingMonitors(e72)), d2(() => this.map, (e72) => {
      e72 && "load" in e72 && e72.load && e72.load().catch(() => {
      });
    })]), this.inputManager = new C14({
      view: this
    }), this.stateManager = new Q10({
      view: this
    });
  }
  initialize() {
    this.groundView = new u21({
      view: this
    }), this._updateUpdatingMonitors();
    const e71 = () => this._updateDefaultToMapOptions();
    this.addHandles(v2(() => this.map?.allLayers, "after-changes", e71, {
      onListenerAdd: e71,
      onListenerRemove: e71
    })), this.updatingHandles.add(() => this.qualitySettings.memoryLimit, (e72) => {
      this.resourceController && (this.resourceController.memoryController.maxMemory = e72);
    }, P), this.updatingHandles.add(() => this.qualitySettings.additionalCacheMemory, (e72) => {
      this.resourceController && (this.resourceController.memoryController.additionalCacheMemory = e72);
    }, P), this.updatingHandles.add(() => this.qualitySettings.frameRate ?? 0, (e72) => j(e72 > 0 ? 1e3 / Math.ceil(e72) : 0), P), this.updatingHandles.add(() => this.map?.ground, e71, A3), this.updatingHandles.add(() => this.map?.ground?.opacity, () => this._updateDefaultHitTestOptions(), A3), this.addHandles(d2(() => this.spatialReference, () => this.notifyChange("clippingArea"), C));
  }
  destroy() {
    this.destroyed || (this.updatingHandles.removeAll(), this.invalidate(), this.activeTool = null, this.layerViewManager.clear(), this._exitSurface(), this._disposeGraphicsView(), this.sharedSymbolResources = u(this.sharedSymbolResources), this._set("labeler", u(this.labeler)), this._set("deconflictor", u(this.deconflictor)), this._resourceController = u(this._resourceController), this._set("stateManager", u(this.stateManager)), this._set("inputManager", u(this.inputManager)), this.state.destroy(), this._propertiesPool.destroy(), this.removeHandles("updatingMonitors"), this._set("environmentManager", u(this.environmentManager)), this._set("environment", u(this.environment)), this.groundView = u(this.groundView), this._exitBasemapTerrain(), this._stage?.destroy());
  }
  get renderSpatialReference() {
    return this.renderCoordsHelper && this.renderCoordsHelper.spatialReference;
  }
  get basemapSpatialReference() {
    return this.basemapTerrain?.spatialReference;
  }
  get animation() {
    return this.state?.animation;
  }
  get camera() {
    return this.stateManager?.camera;
  }
  set camera(e71) {
    this.stateManager && (this.stateManager.camera = e71);
  }
  get contentCamera() {
    return this.stateManager?.contentCamera;
  }
  set contentCamera(e71) {
    this.stateManager && (this.stateManager.contentCamera = e71);
  }
  installContentCameraReset(e71 = {
    sticky: false
  }) {
    return this.stateManager.installContentCameraReset(e71);
  }
  get center() {
    return this.stateManager?.center;
  }
  set center(e71) {
    this.stateManager && (this.stateManager.center = e71);
  }
  get clippingArea() {
    if ("global" === this.viewingMode) return null;
    const e71 = this.map;
    let t71 = this._userClippingArea || i(e71, "clippingArea");
    return !this._userClippingArea && !i(e71, "clippingEnabled") || null == t71 ? (this._clippingArea = null, null) : t71 instanceof w2 ? this.spatialReference && (t71 = it5(t71, this.spatialReference), null == t71) ? (n.getLogger(this).error("#clippingArea", "setting clippingArea with incompatible SpatialReference"), this._clippingArea) : (t71 = t71.clone(), null == t71.intersection(this._groundAndLayersExtent) && (t71.xmin = t71.xmax, t71.ymin = t71.ymax), t71.zmin = void 0, t71.zmax = void 0, t71.equals(this._clippingArea) || (this._clippingArea = t71), this._clippingArea) : (n.getLogger(this).error("#clippingArea", "only clippingArea geometries of type Extent are supported"), this._clippingArea);
  }
  set clippingArea(e71) {
    this.ready && "global" === this.viewingMode && null != e71 ? n.getLogger(this).error("#clippingArea=", "Clipping area is only supported in local viewingMode") : this._userClippingArea = e71;
  }
  get renderDataExtent() {
    if (this.state.viewingMode === l9.Global) return null;
    const e71 = this.renderSpatialReference, t71 = this.dataExtent;
    return null == t71 || null == e71 || t71.spatialReference.equals(e71) ? t71 : it5(t71, e71);
  }
  get tileInfo() {
    return this.basemapTerrain?.tilingScheme?.toTileInfo();
  }
  get dataExtent() {
    let e71 = this._groundAndLayersExtent;
    const t71 = this.spatialReference || f2.WGS84, i49 = it5(this.clippingArea, t71);
    null != i49 && (e71 = null != e71 ? e71.intersection(i49) : i49);
    const r57 = this._get("dataExtent");
    return null != e71 && e71.equals(r57) ? r57 : e71;
  }
  get _groundAndLayersExtent() {
    const e71 = this.spatialReference || f2.WGS84;
    let t71;
    const i49 = (i50) => {
      const r58 = it5(i50, e71);
      null != r58 && (null != t71 ? t71.union(r58) : t71 = r58.clone());
    }, r57 = this.basemapTerrain;
    if (r57?.spatialReference) {
      const e72 = r57.groundExtent;
      i49(new w2({
        xmin: e72[0],
        ymin: e72[1],
        zmin: 0,
        xmax: e72[2],
        ymax: e72[3],
        zmax: 0,
        spatialReference: r57.spatialReference
      }));
    }
    if (this.map) {
      const e72 = (e73) => {
        null == e73.fullExtent || "graphics" === e73.type && e73.internal || i49(e73.fullExtent);
      };
      this.map.allLayers.forEach((t72) => e72(t72));
    }
    if (null == t71) return null;
    t71.hasZ ? (t71.zmin = Math.min(0, t71.zmin ?? 0), t71.zmax = Math.max(0, t71.zmax ?? 0)) : (t71.zmin = 0, t71.zmax = 0);
    const s67 = this._get("_groundAndLayersExtent");
    return t71.equals(s67) ? s67 : t71;
  }
  castEnvironment(e71) {
    return e71 ? e71 instanceof f27 ? e71 : e71 instanceof b7 ? this.environment?.cloneWithWebsceneEnvironment(e71) ?? f27.fromWebsceneEnvironment(e71) : b2(f27, e71) : new f27();
  }
  get extent() {
    return this.stateManager?.extent;
  }
  set extent(e71) {
    this.stateManager && (this.stateManager.extent = e71);
  }
  get screenCenter() {
    return this.stateManager?.screenCenter;
  }
  get frustum() {
    return this.stateManager?.frustum;
  }
  get initialExtentRequired() {
    return this.stateManager && !this.stateManager.hasInitialView;
  }
  get _defaultsFromMapSettings() {
    return {
      required: {
        tileInfo: false,
        heightModelInfo: true,
        extent: false
      }
    };
  }
  get interacting() {
    return this.navigating || (this.toolViewManager?.interacting ?? false);
  }
  get stationary() {
    return !this.animation && !this.resizing && (null == this.state || this.state.stationary);
  }
  get navigating() {
    return this.state?.navigating ?? false;
  }
  get padding() {
    return this.stateManager?.padding;
  }
  set padding(e71) {
    this.stateManager && (this.stateManager.padding = e71);
  }
  set qualityProfile(e71) {
    l32.isValidProfile(e71) && (l32.apply(e71, this.qualitySettings), this._set("qualityProfile", e71));
  }
  get qualityProfile() {
    return this._get("qualityProfile") || l32.getDefaultProfile();
  }
  set slicePlane(e71) {
    if (null != this._stage && this._stage.renderer.setParameters({
      slicePlane: e71
    }), null == e71) return void this._set("slicePlane", null);
    const t71 = this._propertiesPool.get("slicePlane");
    Z(e71, t71), this._set("slicePlane", t71);
  }
  get typeSpecificPreconditionsReady() {
    return !!this.viewingMode && !!this.stateManager?.preinit(this.spatialReference);
  }
  get resolution() {
    return null != this.spatialReference ? o19(this.scale, this.spatialReference) : 0;
  }
  get scale() {
    return this.stateManager?.scale;
  }
  set scale(e71) {
    this.stateManager && (this.stateManager.scale = e71);
  }
  get terrainScale() {
    return this.stateManager?.terrainScale;
  }
  get heightModelInfo() {
    const e71 = this.getDefaultHeightModelInfo();
    return null != e71 ? v6.deriveUnitFromSR(e71, this.spatialReference) : null;
  }
  get updating() {
    if (this.destroyed) return false;
    let e71 = 0, t71 = this.layerViewManager.updating, i49 = t71 ? this.layerViewManager.updatingRemaining : 0;
    this.allLayerViews.forEach((r58) => {
      if (r58.isFulfilled()) {
        if (r58.updating) {
          if (t71 = true, r58.suspended || L7(r58)) return;
          ++i49, e71 += r58.updatingProgress;
        }
      } else ++i49;
    });
    for (const s67 of this._updatingObjects) if (null != s67 && s67.updating) {
      const t72 = 0.1;
      i49 += t72, e71 += 0.5 * t72;
    }
    for (const s67 of this._updatingObjectsWithProgress) null != s67 && s67.updating && (++i49, e71 += s67.updatingProgress);
    const r57 = !this.stateManager.test.updatingIgnoreRenderState && this.state.updating;
    if (t71 = !!(t71 || i49 > 0 || this.updatingHandles.updating || !this.ready || !this.stationary || r57 || this._createGraphicsViewController || this.inputManager?.updating || this.map?.allLayers?.some((e72) => !e72.isFulfilled()) || this.textures?.updating), t71 ? (this._numUpdating = Math.max(i49, this._numUpdating), e71 += this._numUpdating - i49) : this._numUpdating = 0, this._numUpdating > 0 ? e71 /= this._numUpdating : e71 = t71 ? 0 : 1, this._get("updatingProgress") !== e71) {
      const i50 = performance.now();
      if (e71 < 1) {
        const t72 = Math.min((i50 - this._lastUpdateTime) / 2e3, 1);
        e71 = this.updatingProgress * (1 - t72) + e71 * t72;
      }
      this._set("updatingProgress", e71), this._lastUpdateTime = t71 && e71 < 1 ? i50 : 0;
    }
    return t71;
  }
  get _updatingObjects() {
    return [this.graphicsView, this.basemapView, this._resourceController, this._stage, this.featureTiles, this.pointsOfInterest, this.environmentManager, this.overlay, this._featureTreeDebugger, this.toolViewManager, this.analysisViewManager];
  }
  get _updatingObjectsWithProgress() {
    return [this.deconflictor, this.labeler, this.basemapTerrain];
  }
  get viewingMode() {
    const e71 = this._predeterminedViewingMode;
    if (null != e71) return a13(e71);
    const t71 = this.spatialReference;
    return t71 ? null != this.defaultsFromMap?.viewingMode && t71.equals(this.defaultsFromMap.spatialReference) ? a13(this.defaultsFromMap.viewingMode) : r28(t71, l9.Global) ? "global" : "local" : "global";
  }
  set viewingMode(e71) {
    this.ready ? n.getLogger(this).error("#viewingMode", "viewingMode cannot be set once view is ready") : this._overrideIfSome("viewingMode", e71);
  }
  get viewpoint() {
    return this.stateManager?.viewpoint;
  }
  set viewpoint(e71) {
    this.stateManager && (this.stateManager.viewpoint = e71);
  }
  get zoom() {
    return this.stateManager.zoom;
  }
  set zoom(e71) {
    this.stateManager && (this.stateManager.zoom = e71);
  }
  get resourceController() {
    return this._resourceController;
  }
  get quality() {
    return this._resourceController?.memoryController?.memoryFactor ?? 1;
  }
  get resolutionScale() {
    return Math.sqrt(Math.min(1, this.quality / 0.75));
  }
  get performanceInfo() {
    return new s52(this);
  }
  on(e71, t71, i49, r57) {
    const s67 = this.viewEvents.on(e71, t71, i49, r57);
    return s67 || super.on(e71, t71);
  }
  hasEventListener(e71) {
    return super.hasEventListener(e71) || this.viewEvents.hasHandler(e71);
  }
  toMap(e71, t71) {
    if (!this.ready) return n.getLogger(this).error("#toMap()", "Scene view cannot be used before it is ready"), null;
    const i49 = o22(e71) ? r21(this, e71) : e71;
    return I10(this, i49, t71, this._defaultToMapOptions);
  }
  toScreen(e71) {
    if (!this.ready) return n.getLogger(this).error("#toScreen()", "Scene view cannot be used before it is ready"), null;
    const t71 = (null == e71.z ? a21(this.elevationProvider, e71) : null) ?? 0;
    return c5(e71, rt5, this.renderSpatialReference, t71), this.state.camera.projectToScreen(rt5, st4), c3(st4[0], st4[1]);
  }
  pixelSizeAt(e71) {
    return this.ready ? e71 ? (c5(e71, rt5, this.renderSpatialReference), this.state.camera.computeScreenPixelSizeAt(rt5)) : 0 : (n.getLogger(this).error("#pixelSizeAt()", "Scene view cannot be used before it is ready"), null);
  }
  overlayPixelSizeInMapUnits(e71) {
    const t71 = this.basemapTerrain.overlayManager;
    return t71 ? t71.overlayPixelSizeInMapUnits(e71, () => this.pixelSizeAt(e71)) : 1;
  }
  hitTest(e71, t71) {
    if (!this.ready) return n.getLogger(this).error("#hitTest()", "Scene view cannot be used before it is ready"), null;
    const i49 = o22(e71) ? r21(this, e71) : e71;
    return U8(this, i49, t71, this._defaultHitTestOptions);
  }
  popupHitTest(e71) {
    return __async(this, null, function* () {
      return t51(this, e71);
    });
  }
  goTo(e71, t71) {
    return this.updatingHandles.addPromise(this.stateManager.goTo(e71, t71));
  }
  whenAnalysisView(e71) {
    return __async(this, null, function* () {
      if (null == e71.parent) throw new s("view:no-analysisview-for-analysis", "The analysis has not been added to view.analyses", {
        analysis: e71
      });
      switch (e71.parent.type) {
        case "line-of-sight":
        case "dimension":
          return (yield this.whenLayerView(e71.parent)).whenAnalysisView();
        default:
          return this.analysisViewManager.whenAnalysisView(e71);
      }
    });
  }
  whenLayerView(e71) {
    return super.whenLayerView(e71);
  }
  takeScreenshot(e71) {
    return __async(this, null, function* () {
      const t71 = this._completeSettings(e71);
      yield this.whenReady();
      const i49 = yield this._stage.renderView.takeScreenshot(t71);
      return a19(i49, t71, this._pixelFormat());
    });
  }
  _takeScreenshot(e71) {
    return __async(this, null, function* () {
      const t71 = this._completeSettings(e71);
      yield this.whenReady();
      const i49 = yield this._stage.renderView.takeScreenshot(t71);
      return r22(i49, this._pixelFormat());
    });
  }
  _takeScreenshotWithObjectAndLayerId(e71) {
    return __async(this, null, function* () {
      const t71 = this._completeSettings(e71);
      yield this.whenReady();
      const i49 = yield this._stage.renderView.takeScreenshotWithOID(t71);
      return [r22(i49[0], this._pixelFormat()), r22(i49[1], this._pixelFormat())];
    });
  }
  _completeSettings(e71) {
    const t71 = n24(e71, this);
    return t71.pixelRatio /= this.state.pixelRatio, M5(t71, this.supersampleScreenshotsEnabled, this.padding);
  }
  _pixelFormat() {
    return {
      flipY: true,
      premultipliedAlpha: this._stage.renderView.getAlpha()
    };
  }
  get test() {
  }
  takeScreenshotWithObjectAndLayerId(e71) {
    return __async(this, null, function* () {
      if (!has("enable-feature:objectAndLayerId-rendering")) throw new Error("has enable-feature:objectAndLayerId-rendering must be true");
      const t71 = this._completeSettings(e71);
      yield this.whenReady();
      const i49 = yield this._stage.renderView.takeScreenshotWithOID(t71), r57 = a19(i49[0], t71, this._pixelFormat()), s67 = this._completeSettings(e71);
      s67.format = "png";
      return [r57, a19(i49[1], s67, this._pixelFormat())];
    });
  }
  getColorToObjectAndLayerIdMapping() {
    if (null == this._stage.renderView.objectAndLayerIdRenderHelper) throw new Error("has enable-feature:objectAndLayerId-rendering must be true");
    return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping();
  }
  addUpdatingPromise(e71) {
    return this.updatingHandles.addPromise(e71);
  }
  importLayerView(e71) {
    return l23.importLayerView(e71);
  }
  hasLayerViewModule(e71) {
    return l23.hasLayerViewModule(e71);
  }
  forceDOMReadyCycle() {
    this.forceReadyCycle();
  }
  getDefaultSpatialReference() {
    return this.map && "initialViewProperties" in this.map && this.map.initialViewProperties?.spatialReference || this.defaultsFromMap?.spatialReference || this.defaultsFromMap?.ready && this._initialDefaultSpatialReference || null;
  }
  validate() {
    return __async(this, null, function* () {
      let e71 = t29(this.type);
      const t71 = has("safari");
      if (t71 && t71 < 9 && (e71 = new s("sceneview:browser-not-supported", "This browser is not supported by SceneView (Safari < 9)", {
        type: "safari",
        requiredVersion: 9,
        detectedVersion: t71
      })), null != e71) throw n.getLogger(this).warn("#validate()", e71.message), e71;
    });
  }
  get _predeterminedViewingMode() {
    const e71 = this._isOverridden("viewingMode") ? this._get("viewingMode") : (this.map && "initialViewProperties" in this.map ? this.map.initialViewProperties?.viewingMode : null) ?? null;
    return null != e71 ? o11(e71) : null;
  }
  getSpatialReferenceSupport(e71, t71) {
    const i49 = this._predeterminedViewingMode;
    if (null != i49) return this._validateSpatialReferenceForViewingMode(e71, t71, i49) ? {
      constraints: this._makeSpatialReferenceConstraints(e71, t71, i49)
    } : null;
    const r57 = this._validateSpatialReferenceForViewingMode(e71, t71, l9.Local), s67 = this._validateSpatialReferenceForViewingMode(e71, t71, l9.Global);
    return r57 || s67 ? r57 && s67 ? {
      constraints: this._makeSpatialReferenceConstraints(e71, t71, null)
    } : r57 ? {
      constraints: this._makeSpatialReferenceConstraints(e71, t71, l9.Local)
    } : {
      constraints: this._makeSpatialReferenceConstraints(e71, t71, l9.Global)
    } : null;
  }
  _validateSpatialReferenceForViewingMode(e71, t71, i49) {
    return !!r28(e71, i49) && (null == t71 || !!v4(t71) || (!y4(t71) || null != k5(t71, e71, i49)) && (!h4(t71) || i49 !== l9.Global));
  }
  _makeSpatialReferenceConstraints(e71, t71, i49) {
    if (null == t71) return [{
      spatialReference: e71,
      viewingMode: i49
    }];
    const {
      isWebMercator: r57,
      isWGS84: s67
    } = e71;
    if (v4(t71) && (r57 || s67)) {
      return !s67 || i49 === l9.Local || null === V4(t71.tileInfo, t71.fullExtent, e71, l9.Global) ? [{
        spatialReference: e71,
        viewingMode: i49
      }, {
        spatialReference: f2.WebMercator,
        viewingMode: i49
      }] : [{
        spatialReference: r57 ? f2.WGS84 : f2.WebMercator,
        viewingMode: i49
      }];
    }
    return y4(t71) || h4(t71) || !r57 && !s67 ? y4(t71) && r57 && i49 !== l9.Global ? [{
      spatialReference: e71,
      viewingMode: i49
    }, {
      spatialReference: f2.WGS84,
      viewingMode: l9.Local
    }] : [{
      spatialReference: e71,
      viewingMode: i49
    }] : [{
      spatialReference: e71,
      viewingMode: i49
    }, {
      spatialReference: r57 ? f2.WGS84 : f2.WebMercator,
      viewingMode: i49
    }];
  }
  _validateSpatialReference(e71) {
    const t71 = null != this.getSpatialReferenceSupport(e71), i49 = this._predeterminedViewingMode;
    return t71 || (null != i49 ? n.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${a13(i49)} viewing mode.`) : e71.isGeographic && n.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")), t71;
  }
  whenReady() {
    return new Promise((e71) => {
      this.ready ? e71(this) : this._resolveWhenReady.push(e71);
    });
  }
  trackGraphicState(e71) {
    if (!e71.graphic) return n.getLogger(this).error("trackGraphicState", "GraphicState.graphic must not be null or undefined to start tracking"), null;
    const t71 = this.getViewForGraphic(e71.graphic);
    let i49 = null, r57 = false;
    const s67 = (t72) => {
      !r57 && null != t72 && "processor" in t72 && "graphics-3d" === t72.processor?.type && t72.processor.graphicsCore && (i49 = t72.processor.graphicsCore.trackGraphicState(e71));
    };
    return null != t71 ? s67(t71) : this.whenViewForGraphic(e71.graphic, {
      waitForLayer: true
    }).then((e72) => s67(e72), () => {
    }).catch(() => {
    }), e2(() => {
      r57 = true, null != i49 && (i49.remove(), i49 = null);
    });
  }
  highlight(e71) {
    if (Array.isArray(e71)) return o(e71.map((e72) => this.highlight(e72)));
    if (V.isCollection(e71)) return o(e71.toArray().map((e72) => this.highlight(e72)));
    const t71 = this.getViewForGraphic(e71);
    return t71 && "highlight" in t71 ? t71.highlight(e71) : e2();
  }
  maskOccludee(e71) {
    if (!e71) return n.getLogger(this).error("maskOccludee", "GraphicState.graphic must not be null or undefined to mask an occludee"), null;
    const t71 = this.getViewForGraphic(e71);
    let i49 = null, r57 = false;
    const s67 = (t72) => {
      !r57 && null != t72 && e26(t72) && (i49 = t72.maskOccludee(e71));
    };
    return null != t71 ? s67(t71) : this.whenViewForGraphic(e71, {
      waitForLayer: true
    }).then((e72) => s67(e72), () => {
    }).catch(() => {
    }), e2(() => {
      r57 = true, null != i49 && (i49.remove(), i49 = null);
    });
  }
  getViewForGraphic(e71) {
    return e71.layer === this.graphics ? this.graphicsView : e71.layer ? this.allLayerViews.find((t71) => t71.layer === e71.layer) : null;
  }
  graphicChanged(e71) {
    null != this.graphicsView && this.graphicsView.graphicChanged(e71);
  }
  whenViewForGraphic(e71, t71) {
    return __async(this, null, function* () {
      if (e71.layer === this) return yield w(() => this.graphicsView), this.graphicsView;
      if (!e71.layer || !this.map) throw new s("no-view-for-graphic");
      return t71 && t71.waitForLayer && !this.map.allLayers.includes(e71.layer) ? new Promise((t72, i49) => {
        const r57 = this.map.allLayers.on("change", (s67) => {
          s67.added.includes(e71.layer) && (r57.remove(), this.whenLayerView(e71.layer).then(t72, i49));
        });
      }) : this.whenLayerView(e71.layer);
    });
  }
  _initBasemapTerrain() {
    this._set("basemapTerrain", new lt5({
      view: this
    })), this._set("elevationProvider", new h23({
      view: this
    })), this.elevationProvider.register("ground", this.basemapTerrain);
  }
  _exitBasemapTerrain() {
    this.basemapTerrain && (this.elevationProvider.unregister(this.basemapTerrain), this.elevationProvider.destroy(), this._set("elevationProvider", null), this.basemapTerrain.destroy(), this._set("basemapTerrain", null));
  }
  _initGlobe() {
    this._initCoordinateSystem(), this.state.createInitialCamera(), this._initBasemapTerrain(), this._set("pointsOfInterest", new P13({
      view: this
    })), this._set("featureTiles", new w16({
      renderCoordsHelper: this.renderCoordsHelper,
      cameraOnSurface: this.pointsOfInterest.cameraOnSurface,
      focus: this.pointsOfInterest.focus,
      tilingSchemeOwner: this.basemapTerrain,
      viewState: this.state,
      scheduler: this._resourceController.scheduler,
      terrain: this.basemapTerrain
    }));
    const e71 = () => {
      const e72 = this.basemapTerrain?.extent;
      if (this.clippingArea || e72) {
        if (e72 && this.basemapTerrain.spatialReference) {
          const e73 = null != this.basemapTerrain.extent && null != this.basemapTerrain.spatialReference ? K3(c2(this.basemapTerrain.extent, this.basemapTerrain.spatialReference), this.spatialReference) : null;
          null != this.clippingArea ? this.featureTiles.filterExtent = this.clippingArea.intersection(e73) : this.featureTiles.filterExtent = e73;
        } else this.featureTiles.filterExtent = this.clippingArea;
      } else this.featureTiles.filterExtent = null;
    };
    this.addHandles([this.updatingHandles.add(() => t19.FEATURE_TILE_TREE_SHOW_TILES, (e72) => {
      e72 && this.featureTiles && !this._featureTreeDebugger ? this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger-7HN67MY5.js")).then(({
        FeatureTileTree3DDebugger: e73
      }) => {
        !this._featureTreeDebugger && t19.FEATURE_TILE_TREE_SHOW_TILES && (this._featureTreeDebugger = new e73({
          view: this
        }));
      }) : e72 || !this._featureTreeDebugger || t19.FEATURE_TILE_TREE_SHOW_TILES || (this._featureTreeDebugger.destroy(), this._featureTreeDebugger = null);
    }, A3), this.updatingHandles.add(() => this.clippingArea, e71, A3), this.updatingHandles.add(() => this.basemapTerrain.extent, e71, A3)], "feature-tiles"), this.stateManager.init();
  }
  _exitGlobe() {
    this.state && (this.stateManager.exit(), this.removeHandles("render-coords-helper"), this.removeHandles("feature-tiles"), this.featureTiles.destroy(), this._set("featureTiles", null), this.pointsOfInterest.destroy(), this._set("pointsOfInterest", null), this._exitBasemapTerrain(), this.state.exit(), this._exitCoordinateSystem());
  }
  _initCoordinateSystem() {
    if (this.spatialReference) {
      const e71 = this.spatialReference;
      this.mapCoordsHelper && this.mapCoordsHelper.spatialReference.equals(e71) || this._set("mapCoordsHelper", new a39(this.map, e71));
      const t71 = this.state.isGlobal, i49 = z5(t71, e71);
      i49 !== this.renderSpatialReference && (this._set("renderCoordsHelper", v8.create(this.state.viewingMode, i49)), t71 || this.addHandles(d2(() => this.basemapTerrain?.extent, (e72) => {
        const t72 = this.renderCoordsHelper.spatialReference;
        null == e72 || 0 === e72[0] && 0 === e72[1] && 0 === e72[2] && 0 === e72[3] || !i16(e72, this.basemapTerrain.spatialReference, nt5, t72) || (this.renderCoordsHelper.extent = nt5);
      }, C), "render-coords-helper"), this.sceneIntersectionHelper && this.sceneIntersectionHelper.setTolerance(E15 / this.renderCoordsHelper.unitInMeters));
    } else this._set("mapCoordsHelper", null), this._set("renderCoordsHelper", null);
  }
  _exitCoordinateSystem() {
    this.mapCoordsHelper && (this.removeHandles("render-coords-helper"), this._set("renderCoordsHelper", null), this._set("mapCoordsHelper", null));
  }
  _updatingChanged() {
    this.notifyChange("updating");
  }
  _updateUpdatingMonitors(e71 = null) {
    null != e71 && e71.type === E.MOVE || (this.removeHandles("updatingMonitors"), this.allLayerViews.forEach((e72) => {
      e72.destroyed || (this.addHandles(d2(() => [e72.updating, e72.updatingProgress], () => this._updatingChanged(), C), "updatingMonitors"), e72.when(() => this._updatingChanged(), () => this._updatingChanged()));
    }), this._updatingChanged());
  }
  _prepareScreenshotOverlay() {
    return __async(this, null, function* () {
      this.overlay && (yield this.overlay.prepare());
    });
  }
  _renderScreenshotOverlay(e71, t71, i49) {
    if (!this.overlay || !this.overlay.hasVisibleItems) return i49;
    const r57 = e71.getContext("2d");
    return r57.putImageData(i49, 0, 0), this.overlay.renderCanvas(e71, {
      disableDecorations: t71 === i11.OFF
    }), r57.getImageData(0, 0, i49.width, i49.height);
  }
  _initStage() {
    const e71 = {
      deactivatedWebGLExtensions: this.deactivatedWebGLExtensions,
      debugWebGLExtensions: this.debugWebGLExtensions,
      alpha: this.alphaCompositingEnabled,
      preserveDrawingBuffer: this.preserveDrawingBufferEnabled,
      canvas: this.renderCanvas,
      screenshot: {
        prepareOverlay: () => this._prepareScreenshotOverlay(),
        renderOverlay: (e72, t72, i50) => this._renderScreenshotOverlay(e72, t72, i50)
      }
    }, t71 = new U16(this.state.viewingMode, (e72) => this._stage.layers.forAll(e72), this);
    this._set("sceneIntersectionHelper", t71);
    const i49 = e7(this.surface);
    this._stage = new u45({
      view: this,
      options: e71,
      container: i49
    }), this._stage.renderer.setParameters({
      slicePlane: this.slicePlane
    }), this.addHandles([this.updatingHandles.add(() => this.qualitySettings.highQualityTransparency, (e72) => this._stage.renderer.setParameters({
      highQualityTransparency: e72
    }), P), this.on("pointer-move", () => this._stage?.renderer.resetAnimation()), o2(this._stage.renderView.canvas, "webglcontextlost", (e72) => {
      this.fatalError = new s("webgl-context-lost", e72.statusMessage);
    })], "stage"), this.renderCoordsHelper && this.sceneIntersectionHelper.setTolerance(E15 / this.renderCoordsHelper.unitInMeters), this._set("canvas", this._stage.renderView.canvas);
  }
  _exitStage() {
    this._set("sceneIntersectionHelper", null), this._stage = u(this._stage), this.removeHandles("stage"), this._set("canvas", null);
  }
  _initSurface(e71) {
    this._exitSurface(), this.state.init(e71, this.spatialReference), this._initStage(), this._initGlobe(), this.sharedSymbolResources = new S18({
      view: this,
      viewingMode: e71,
      resourceController: this._resourceController,
      pointsOfInterest: this.pointsOfInterest,
      viewState: this.state
    });
  }
  _exitSurface() {
    this.sharedSymbolResources && (this.sharedSymbolResources.objectResourceCache.destroy(), this.sharedSymbolResources.destroy(), this.sharedSymbolResources = null, this._exitGlobe(), this._exitStage());
  }
  _createGraphicsViewIfNeeded() {
    if (this.graphicsView || this._createGraphicsViewController) return;
    if (0 === this.graphics.length) return;
    this.removeHandles("graphics-view"), this._createGraphicsViewController = new AbortController();
    const e71 = () => {
      this._createGraphicsViewController = null, this._updatingChanged();
    };
    this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e71, e71), this._updatingChanged();
  }
  _createGraphicsViewAsync(e71) {
    return __async(this, null, function* () {
      const t71 = (yield import("./GraphicsView3D-UO5VPCNG.js")).default;
      s3(e71), yield w(() => this.basemapTerrain?.ready, e71), this._set("graphicsView", new t71({
        view: this
      }));
    });
  }
  _disposeGraphicsView() {
    this._createGraphicsViewController && (this._createGraphicsViewController.abort(), this._createGraphicsViewController = null), this.removeHandles("graphics-view"), null != this.graphicsView && (this.removeHandles(this.graphicsView.processor.layer.id), this.graphicsView.destroy(), this._set("graphicsView", null));
  }
  _startup() {
    const e71 = o11(this.viewingMode);
    e71 === l9.Global && (this._clippingArea = null), this._initSurface(e71), this._set("ready", true), this.addHandles(v2(() => this.graphics, "after-changes", () => this._createGraphicsViewIfNeeded()), "graphics-view"), this._createGraphicsViewIfNeeded();
    const t71 = this.map && "initialViewProperties" in this.map ? this.map.initialViewProperties : null, i49 = t71?.environment;
    i49 && n37(this.environment, i49), this.timeExtent = t71?.timeExtent, this.labeler.setup(), this.environmentManager.connectView(this), this.inputManager.connect(), this._set("textures", new i40(this._stage, this.resourceController.scheduler));
    const r57 = this._resolveWhenReady;
    this._resolveWhenReady = [], r57.forEach((e72) => e72(this));
  }
  _teardown() {
    this._initialDefaultSpatialReference = null, this.inputManager.disconnect(), this.environmentManager.disconnectView(), this.labeler.dispose(), this._disposeGraphicsView(), this.removeHandles("graphics-view"), this._set("textures", u(this.textures)), this._exitSurface(), this._set("ready", false);
  }
  _updateDefaultToMapOptions() {
    if (this._defaultToMapOptions.include.clear(), this.map) {
      this.map.ground && this._defaultToMapOptions.include.add(w6);
      for (const e71 of this.map.allLayers.items) m5(e71.type) && this._defaultToMapOptions.include.add(e71.uid);
    }
  }
  _updateDefaultHitTestOptions() {
    if (this._defaultHitTestOptions.exclude.clear(), this.map) {
      this.map.ground && this.map.ground.opacity < 1 && this._defaultHitTestOptions.exclude.add(w6);
      for (const e71 of this.map.allLayers.items) m5(e71.type) && e71.opacity < 1 && this._defaultHitTestOptions.exclude.add(e71.uid);
    }
  }
};
function it5(e71, t71) {
  return null != e71 && J2(e71.spatialReference, t71) ? K3(e71, t71) : null;
}
tt4.type = "3d", e6([y2()], tt4.prototype, "_userClippingArea", void 0), e6([y2()], tt4.prototype, "_resourceController", void 0), e6([y2()], tt4.prototype, "_stage", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "deconflictor", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "labeler", void 0), e6([y2(l13(t23, "analyses"))], tt4.prototype, "analyses", void 0), e6([y2({
  type: a17,
  readOnly: true
})], tt4.prototype, "animation", null), e6([y2({
  readOnly: true
})], tt4.prototype, "basemapTerrain", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "elevationProvider", void 0), e6([y2()], tt4.prototype, "camera", null), e6([y2({
  type: d9
})], tt4.prototype, "contentCamera", null), e6([y2({
  readOnly: true
})], tt4.prototype, "canvas", void 0), e6([y2({
  type: _
})], tt4.prototype, "center", null), e6([y2({
  type: w2
})], tt4.prototype, "clippingArea", null), e6([y2({
  type: c27
})], tt4.prototype, "constraints", void 0), e6([y2({
  type: w2,
  readOnly: true
})], tt4.prototype, "renderDataExtent", null), e6([y2({
  readOnly: true
})], tt4.prototype, "tileInfo", null), e6([y2({
  type: w2,
  readOnly: true
})], tt4.prototype, "dataExtent", null), e6([y2({
  type: w2,
  readOnly: true
})], tt4.prototype, "_groundAndLayersExtent", null), e6([y2({
  type: f27
})], tt4.prototype, "environment", void 0), e6([s4("environment")], tt4.prototype, "castEnvironment", null), e6([y2({
  readOnly: true
})], tt4.prototype, "environmentManager", void 0), e6([y2({
  type: w2
})], tt4.prototype, "extent", null), e6([y2()], tt4.prototype, "floors", void 0), e6([y2()], tt4.prototype, "screenCenter", null), e6([y2()], tt4.prototype, "frustum", null), e6([y2({
  type: Number,
  readOnly: true
})], tt4.prototype, "fullOpacity", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "graphicsView", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "analysisViewManager", void 0), e6([y2()], tt4.prototype, "groundView", void 0), e6([y2({
  type: Boolean
})], tt4.prototype, "initialExtentRequired", null), e6([y2()], tt4.prototype, "_defaultsFromMapSettings", null), e6([y2()], tt4.prototype, "interacting", null), e6([y2()], tt4.prototype, "stationary", null), e6([y2()], tt4.prototype, "navigating", null), e6([y2()], tt4.prototype, "map", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "mapCoordsHelper", void 0), e6([y2()], tt4.prototype, "padding", null), e6([y2({
  type: P13,
  readOnly: true
})], tt4.prototype, "pointsOfInterest", void 0), e6([y2({
  type: w16,
  readOnly: true
})], tt4.prototype, "featureTiles", void 0), e6([y2()], tt4.prototype, "_featureTreeDebugger", void 0), e6([y2({
  type: Boolean
})], tt4.prototype, "screenSizePerspectiveEnabled", void 0), e6([y2({
  constructOnly: true
})], tt4.prototype, "deactivatedWebGLExtensions", void 0), e6([y2({
  constructOnly: true
})], tt4.prototype, "debugWebGLExtensions", void 0), e6([y2({
  constructOnly: true
})], tt4.prototype, "renderCanvas", void 0), e6([y2({
  constructOnly: true
})], tt4.prototype, "state", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "inputManager", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "stateManager", void 0), e6([y2({
  type: ["low", "medium", "high"]
})], tt4.prototype, "qualityProfile", null), e6([y2({
  type: c37,
  get() {
    let e71 = this._get("qualitySettings");
    return e71 || (e71 = new c37(), l32.apply(this.qualityProfile, e71)), e71;
  }
})], tt4.prototype, "qualitySettings", void 0), e6([y2()], tt4.prototype, "slicePlane", null), e6([y2({
  readOnly: true
})], tt4.prototype, "typeSpecificPreconditionsReady", null), e6([y2({
  readOnly: true
})], tt4.prototype, "renderCoordsHelper", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "sceneIntersectionHelper", void 0), e6([y2({
  type: Number,
  dependsOn: ["scale", "spatialReference"],
  readOnly: true
})], tt4.prototype, "resolution", null), e6([y2({
  type: Number
})], tt4.prototype, "scale", null), e6([y2()], tt4.prototype, "heightModelInfo", null), e6([y2()], tt4.prototype, "spatialReference", void 0), e6([y2({
  type: Boolean,
  constructOnly: true
})], tt4.prototype, "alphaCompositingEnabled", void 0), e6([y2({
  constructOnly: true
})], tt4.prototype, "preserveDrawingBufferEnabled", void 0), e6([y2({
  type: Boolean
})], tt4.prototype, "supersampleScreenshotsEnabled", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "type", void 0), e6([y2(), s4((e71) => e71 instanceof u10 ? e71 : g2(c43, e71))], tt4.prototype, "ui", void 0), e6([y2({
  type: Boolean,
  readOnly: true,
  dependsOn: ["graphicsView.updating", "basemapView.updating", "basemapTerrain.updating", "layerViewManager.updating", "layerViewManager.updatingRemaining", "_resourceController.updating", "_stage.updating", "featureTiles.updating", "pointsOfInterest.updating", "environmentManager.updating", "overlay.updating", "updatingHandles.updating", "featureTreeDebugger.updating", "labeler.updating", "deconflictor.updating", "ready", "stationary", "inputManager.updating", "toolViewManager.updating", "analysisViewManager.updating", "state.updating", "textures.updating"]
})], tt4.prototype, "updating", null), e6([y2()], tt4.prototype, "_updatingObjects", null), e6([y2()], tt4.prototype, "_updatingObjectsWithProgress", null), e6([y2({
  type: Number,
  readOnly: true,
  dependsOn: ["updating"]
})], tt4.prototype, "updatingProgress", void 0), e6([y2({
  type: ["global", "local"]
})], tt4.prototype, "viewingMode", null), e6([y2({
  type: m14
})], tt4.prototype, "viewpoint", null), e6([y2({
  type: Number
})], tt4.prototype, "zoom", null), e6([y2({
  type: y18
})], tt4.prototype, "highlightOptions", void 0), e6([y2({
  readOnly: true
})], tt4.prototype, "quality", null), e6([y2({
  readOnly: true
})], tt4.prototype, "resolutionScale", null), e6([y2()], tt4.prototype, "textures", void 0), tt4 = e6([a4("esri.views.SceneView")], tt4);
var rt5 = n7();
var st4 = i4();
var nt5 = u6();
var at6 = tt4;

export {
  d19 as d,
  a31 as a,
  at6 as at
};
//# sourceMappingURL=chunk-DXJWONZ5.js.map
