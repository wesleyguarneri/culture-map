{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/layers/support/kmlUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../config.js\";\nimport { id as o } from \"../../kernel.js\";\nimport t from \"../../PopupTemplate.js\";\nimport r from \"../../request.js\";\nimport { clone as s } from \"../../core/lang.js\";\nimport { addQueryParameters as n } from \"../../core/urlUtils.js\";\nimport i from \"../../geometry/SpatialReference.js\";\nimport { create as f, negativeInfinity as a, expandWithAABB as l, equals as u } from \"../../geometry/support/aaBoundingBox.js\";\nimport { getBoundsXYZ as m } from \"../../geometry/support/boundsUtils.js\";\nimport { fromJSON as p } from \"../../renderers/support/jsonUtils.js\";\nimport y from \"../../rest/support/FeatureSet.js\";\nconst c = {\n  esriGeometryPoint: \"points\",\n  esriGeometryPolyline: \"polylines\",\n  esriGeometryPolygon: \"polygons\"\n};\nfunction d(e) {\n  const o = e.folders || [],\n    t = o.slice(),\n    r = new Map(),\n    n = new Map(),\n    i = new Map(),\n    f = new Map(),\n    a = new Map(),\n    l = {\n      esriGeometryPoint: n,\n      esriGeometryPolyline: i,\n      esriGeometryPolygon: f\n    };\n  (e.featureCollection?.layers || []).forEach(e => {\n    const o = s(e);\n    o.featureSet.features = [];\n    const t = e.featureSet.geometryType;\n    r.set(t, o);\n    const a = e.layerDefinition.objectIdField;\n    \"esriGeometryPoint\" === t ? h(n, a, e.featureSet.features) : \"esriGeometryPolyline\" === t ? h(i, a, e.featureSet.features) : \"esriGeometryPolygon\" === t && h(f, a, e.featureSet.features);\n  }), e.groundOverlays && e.groundOverlays.forEach(e => {\n    a.set(e.id, e);\n  }), o.forEach(o => {\n    o.networkLinkIds.forEach(r => {\n      const s = P(r, o.id, e.networkLinks);\n      s && t.push(s);\n    });\n  }), t.forEach(e => {\n    if (e.featureInfos) {\n      e.points = s(r.get(\"esriGeometryPoint\")), e.polylines = s(r.get(\"esriGeometryPolyline\")), e.polygons = s(r.get(\"esriGeometryPolygon\")), e.mapImages = [];\n      for (const o of e.featureInfos) switch (o.type) {\n        case \"esriGeometryPoint\":\n        case \"esriGeometryPolyline\":\n        case \"esriGeometryPolygon\":\n          {\n            const t = l[o.type].get(o.id);\n            t && e[c[o.type]]?.featureSet.features.push(t);\n            break;\n          }\n        case \"GroundOverlay\":\n          {\n            const t = a.get(o.id);\n            t && e.mapImages.push(t);\n            break;\n          }\n      }\n      e.fullExtent = j([e]);\n    }\n  });\n  const u = j(t);\n  return {\n    folders: o,\n    sublayers: t,\n    extent: u\n  };\n}\nfunction g(t, s, i, f) {\n  const a = o?.findCredential(t);\n  t = n(t, {\n    token: a?.token\n  });\n  const l = e.kmlServiceUrl;\n  return r(l, {\n    query: {\n      url: t,\n      model: \"simple\",\n      folders: \"\",\n      refresh: 0 !== i || void 0,\n      outSR: JSON.stringify(s)\n    },\n    responseType: \"json\",\n    signal: f\n  });\n}\nfunction S(e, o, t = null, r = []) {\n  const s = [],\n    n = {},\n    i = o.sublayers,\n    f = new Set(o.folders.map(e => e.id));\n  return i.forEach(o => {\n    const i = new e();\n    if (t ? i.read(o, t) : i.read(o), r.length && f.has(i.id) && (i.visible = r.includes(i.id)), n[o.id] = i, null != o.parentFolderId && -1 !== o.parentFolderId) {\n      const e = n[o.parentFolderId];\n      e.sublayers || (e.sublayers = []), e.sublayers?.unshift(i);\n    } else s.unshift(i);\n  }), s;\n}\nfunction h(e, o, t) {\n  t.forEach(t => {\n    e.set(t.attributes[o], t);\n  });\n}\nfunction G(e, o) {\n  let t;\n  return o.some(o => o.id === e && (t = o, !0)), t;\n}\nfunction P(e, o, t) {\n  const r = G(e, t);\n  return r && (r.parentFolderId = o, r.networkLink = r), r;\n}\nasync function b(e) {\n  const o = y.fromJSON(e.featureSet).features,\n    r = e.layerDefinition,\n    s = p(r.drawingInfo.renderer),\n    n = t.fromJSON(e.popupInfo),\n    i = [];\n  for (const t of o) {\n    const e = await s.getSymbolAsync(t);\n    t.symbol = e, t.popupTemplate = n, t.visible = !0, i.push(t);\n  }\n  return i;\n}\nfunction j(e) {\n  const o = f(a),\n    t = f(a);\n  for (const r of e) {\n    if (r.polygons?.featureSet?.features) for (const e of r.polygons.featureSet.features) m(o, e.geometry), l(t, o);\n    if (r.polylines?.featureSet?.features) for (const e of r.polylines.featureSet.features) m(o, e.geometry), l(t, o);\n    if (r.points?.featureSet?.features) for (const e of r.points.featureSet.features) m(o, e.geometry), l(t, o);\n    if (r.mapImages) for (const e of r.mapImages) m(o, e.extent), l(t, o);\n  }\n  return u(t, a) ? void 0 : {\n    xmin: t[0],\n    ymin: t[1],\n    zmin: t[2],\n    xmax: t[3],\n    ymax: t[4],\n    zmax: t[5],\n    spatialReference: i.WGS84\n  };\n}\nexport { j as computeExtent, g as fetchService, b as getGraphics, d as parseKML, S as sublayersFromJSON };"],
  "mappings": "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",
  "names": ["d", "o", "t", "i", "f", "a", "e", "r", "s"]
}
