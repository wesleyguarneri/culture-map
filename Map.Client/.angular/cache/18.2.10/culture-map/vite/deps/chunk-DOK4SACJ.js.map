{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/layers/mixins/refresh.js", "../../../../../../node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Collection.js\";\nimport \"../../core/asyncUtils.js\";\nimport \"../../core/Error.js\";\nimport \"../../core/Logger.js\";\nimport \"../../core/accessorSupport/watch.js\";\nimport { autorun as r } from \"../../core/accessorSupport/trackingUtils.js\";\nconst t = new e(),\n  o = new WeakMap();\nfunction n(e) {\n  f(e) && t.push(new WeakRef(e));\n}\nfunction s(e) {\n  const r = t.find(r => r.deref() === e);\n  r && t.remove(r);\n}\nfunction f(e) {\n  return null != e && \"object\" == typeof e && \"refreshInterval\" in e && \"refresh\" in e;\n}\nfunction c(e, r) {\n  return Number.isFinite(e) && Number.isFinite(r) ? r <= 0 ? e : c(r, e % r) : 0;\n}\nlet i = 0,\n  l = 0;\nfunction a() {\n  const e = Date.now();\n  let r = !1;\n  for (const n of t) {\n    const t = n.deref();\n    if (t) {\n      if (t.refreshInterval) {\n        e - (o.get(t) ?? 0) + 5 >= 6e4 * t.refreshInterval && (o.set(t, e), t.refresh(e));\n      }\n    } else r = !0;\n  }\n  if (r) for (let o = t.length - 1; o >= 0; o--) {\n    t.at(o).deref() || t.removeAt(o);\n  }\n}\nr(() => {\n  const e = Date.now();\n  let r = 0;\n  for (const n of t) {\n    const t = n.deref();\n    t && (r = c(Math.round(6e4 * t.refreshInterval), r), t.refreshInterval ? o.get(t) || o.set(t, e) : o.delete(t));\n  }\n  if (r !== l) {\n    if (l = r, clearInterval(i), 0 === l) return void (i = 0);\n    i = setInterval(a, l);\n  }\n});\nconst u = {\n  get hasRefreshTimer() {\n    return i > 0;\n  },\n  get tickInterval() {\n    return l;\n  },\n  forceRefresh() {\n    a();\n  },\n  hasLayer: e => f(e) && t.some(r => r.deref() === e),\n  clear() {\n    for (const e of t) {\n      const r = e.deref();\n      r && o.delete(r);\n    }\n    t.removeAll();\n  }\n};\nexport { n as registerLayer, u as test, s as unregisterLayer };", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport \"../../core/has.js\";\nimport r from \"../../core/Logger.js\";\nimport { debounce as s, ignoreAbortErrors as t } from \"../../core/promiseUtils.js\";\nimport { property as o } from \"../../core/accessorSupport/decorators/property.js\";\nimport { cast as a } from \"../../core/accessorSupport/decorators/cast.js\";\nimport \"../../core/RandomLCG.js\";\nimport { subclass as i } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { excludeTables as n } from \"../../core/accessorSupport/layerContainerType.js\";\nimport { registerLayer as h, unregisterLayer as p } from \"./refresh.js\";\nfunction m(e) {\n  return null != e && \"object\" == typeof e && \"refreshTimestamp\" in e && \"refresh\" in e;\n}\nconst c = .1,\n  f = m => {\n    let f = class extends m {\n      constructor(...e) {\n        super(...e), this.refreshInterval = 0, this.refreshTimestamp = 0, this._debounceHasDataChanged = s(() => this.hasDataChanged()), this.when().then(() => {\n          this.destroyed || h(this);\n        }, () => {});\n      }\n      destroy() {\n        p(this);\n      }\n      castRefreshInterval(e) {\n        return e >= c ? e : e <= 0 ? 0 : c;\n      }\n      get refreshParameters() {\n        return {\n          _ts: this.refreshTimestamp || null\n        };\n      }\n      refresh(e = Date.now()) {\n        t(this._debounceHasDataChanged()).then(r => {\n          r && this._set(\"refreshTimestamp\", e), this.emit(\"refresh\", {\n            dataChanged: r\n          });\n        }, e => {\n          r.getLogger(this).error(e), this.emit(\"refresh\", {\n            dataChanged: !1,\n            error: e\n          });\n        });\n      }\n      async hasDataChanged() {\n        return !0;\n      }\n      get test() {}\n    };\n    return e([o({\n      type: Number,\n      json: {\n        write: !0,\n        origins: {\n          \"web-scene\": {\n            write: {\n              enabled: !0,\n              layerContainerTypes: n\n            }\n          }\n        }\n      }\n    })], f.prototype, \"refreshInterval\", void 0), e([a(\"refreshInterval\")], f.prototype, \"castRefreshInterval\", null), e([o({\n      readOnly: !0\n    })], f.prototype, \"refreshTimestamp\", void 0), e([o({\n      readOnly: !0\n    })], f.prototype, \"refreshParameters\", null), f = e([i(\"esri.layers.mixins.RefreshableLayer\")], f), f;\n  };\nexport { f as RefreshableLayer, m as isRefreshableLayer };"],
  "mappings": "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",
  "names": ["n", "e", "s", "r", "i", "a", "t", "o", "e", "c", "f", "m", "n", "s", "a"]
}
