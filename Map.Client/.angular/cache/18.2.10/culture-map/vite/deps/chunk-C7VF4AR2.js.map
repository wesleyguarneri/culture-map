{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/webgl/BufferObject.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { isArrayLike as t } from \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport e from \"../../core/Logger.js\";\nimport { isUint16Array as i, isUint32Array as s } from \"../../core/typedArrayUtil.js\";\nimport { checkWebGLError as r } from \"./checkWebGLError.js\";\nimport { BufferType as n, Usage as _, ResourceType as a, DataType as u } from \"./enums.js\";\nconst f = () => e.getLogger(\"esri.views.webgl.BufferObject\"),\n  h = null;\nclass c {\n  static createIndex(t, e, i) {\n    return new c(t, n.ELEMENT_ARRAY_BUFFER, e, i);\n  }\n  static createVertex(t, e, i) {\n    return new c(t, n.ARRAY_BUFFER, e, i);\n  }\n  static createUniform(t, e, i) {\n    return new c(t, n.UNIFORM_BUFFER, e, i);\n  }\n  static createPixelPack(t, e = _.STREAM_READ, i) {\n    const s = new c(t, n.PIXEL_PACK_BUFFER, e);\n    return i && s.setSize(i), s;\n  }\n  static createPixelUnpack(t, e = _.STREAM_DRAW, i) {\n    return new c(t, n.PIXEL_UNPACK_BUFFER, e, i);\n  }\n  static createTransformFeedback(t, e = _.STATIC_DRAW, i) {\n    const s = new c(t, n.TRANSFORM_FEEDBACK_BUFFER, e);\n    return s.setSize(i), s;\n  }\n  constructor(t, e, i, s) {\n    this._context = t, this.bufferType = e, this.usage = i, this._glName = null, this._size = -1, this._indexType = void 0, t.instanceCounter.increment(a.BufferObject, this), this._glName = this._context.gl.createBuffer(), r(this._context.gl), s && this.setData(s);\n  }\n  get glName() {\n    return this._glName;\n  }\n  get size() {\n    return this._size;\n  }\n  get indexType() {\n    return this._indexType;\n  }\n  get usedMemory() {\n    return this.bufferType === n.ELEMENT_ARRAY_BUFFER ? this._indexType === u.UNSIGNED_INT ? 4 * this._size : 2 * this._size : this._size;\n  }\n  get _isVAOAware() {\n    return this.bufferType === n.ELEMENT_ARRAY_BUFFER || this.bufferType === n.ARRAY_BUFFER;\n  }\n  dispose() {\n    if (this._context?.gl) {\n      if (this._glName) {\n        this._context.gl.deleteBuffer(this._glName), this._glName = null;\n      }\n      this._context.instanceCounter.decrement(a.BufferObject, this), this._context = null;\n    } else this._glName && f().warn(\"Leaked WebGL buffer object\");\n  }\n  setSize(t, e = null) {\n    if (this.bufferType === n.ELEMENT_ARRAY_BUFFER && null != e) switch (this._indexType = e, e) {\n      case u.UNSIGNED_SHORT:\n        t *= 2;\n        break;\n      case u.UNSIGNED_INT:\n        t *= 4;\n    }\n    this._setBufferData(t);\n  }\n  setData(t) {\n    if (!t) return;\n    let e = t.byteLength;\n    this.bufferType === n.ELEMENT_ARRAY_BUFFER && (i(t) && (e /= 2, this._indexType = u.UNSIGNED_SHORT), s(t) && (e /= 4, this._indexType = u.UNSIGNED_INT)), this._setBufferData(e, t);\n  }\n  _setBufferData(t, e = null) {\n    this._size = t;\n    const i = this._context.getBoundVAO();\n    this._isVAOAware && this._context.bindVAO(null), this._context.bindBuffer(this);\n    const s = this._context.gl;\n    null != e ? s.bufferData(this.bufferType, e, this.usage) : s.bufferData(this.bufferType, t, this.usage), r(s), this._isVAOAware && this._context.bindVAO(i);\n  }\n  setSubData(t, e, i, s) {\n    if (!t) return;\n    const n = this._context.getBoundVAO();\n    this._isVAOAware && this._context.bindVAO(null), this._context.bindBuffer(this);\n    const {\n      gl: _\n    } = this._context;\n    _.bufferSubData(this.bufferType, e * t.BYTES_PER_ELEMENT, t, i, s - i), r(_), this._isVAOAware && this._context.bindVAO(n);\n  }\n  getSubData(t, e = 0, i, s) {\n    if (i < 0 || s < 0) return;\n    const r = o(t) ? t.BYTES_PER_ELEMENT : 1;\n    if (r * ((i ?? 0) + (s ?? 0)) > t.byteLength) return;\n    e + r * (s ?? 0) > this.usedMemory && f().warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");\n    const _ = this._context.gl;\n    this.bufferType === n.TRANSFORM_FEEDBACK_BUFFER ? (this._context.bindBuffer(this, n.TRANSFORM_FEEDBACK_BUFFER), _.getBufferSubData(n.TRANSFORM_FEEDBACK_BUFFER, e, t, i, s), this._context.unbindBuffer(n.TRANSFORM_FEEDBACK_BUFFER)) : (this._context.bindBuffer(this, n.COPY_READ_BUFFER), _.getBufferSubData(n.COPY_READ_BUFFER, e, t, i, s), this._context.unbindBuffer(n.COPY_READ_BUFFER));\n  }\n  async getSubDataAsync(t, e = 0, i, s) {\n    await this._context.clientWaitAsync(), this.getSubData(t, e, i, s);\n  }\n}\nfunction o(e) {\n  return t(e);\n}\nexport { c as BufferObject, h as tracer };"],
  "mappings": "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",
  "names": ["f", "i", "f", "n"]
}
