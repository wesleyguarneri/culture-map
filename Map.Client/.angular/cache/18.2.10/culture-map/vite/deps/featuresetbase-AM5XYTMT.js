import {
  l
} from "./chunk-HMQ3JMIV.js";
import {
  l as l2
} from "./chunk-LZNBGZUA.js";
import {
  t as t2
} from "./chunk-KNXGNI77.js";
import {
  B as B2,
  E,
  G as G2,
  I,
  L,
  N as N2,
  O as O2,
  T,
  a as a2,
  a2 as a3,
  b,
  c,
  d,
  e,
  k,
  q
} from "./chunk-J2LUX7NH.js";
import "./chunk-CLQXLLGB.js";
import {
  D as D2,
  u
} from "./chunk-JP4I7LNZ.js";
import {
  D
} from "./chunk-ADMKSP6W.js";
import {
  N
} from "./chunk-FAW72HJW.js";
import {
  B2 as B,
  G2 as G,
  H,
  He,
  Ne,
  P,
  Q,
  Re,
  U,
  V,
  W,
  X,
  _,
  a,
  ae,
  ee,
  ge,
  he,
  me,
  r,
  te,
  v2 as v,
  y as y2
} from "./chunk-WD7XZJEZ.js";
import {
  t
} from "./chunk-ADI7256P.js";
import "./chunk-77LCO3ZZ.js";
import "./chunk-DBVSL4LU.js";
import "./chunk-TXBBE7ID.js";
import "./chunk-BB54E5CP.js";
import "./chunk-YZI2XBXY.js";
import "./chunk-WBUJP5OW.js";
import "./chunk-UOW7A3SI.js";
import "./chunk-ZQ57XGAE.js";
import "./chunk-UXW277HY.js";
import "./chunk-OR5F5ACQ.js";
import "./chunk-E2WAKNLZ.js";
import "./chunk-C7NRYPDG.js";
import "./chunk-Z3GMSC63.js";
import "./chunk-F35MWZH7.js";
import "./chunk-ED7UGR2X.js";
import "./chunk-YA5CTHMT.js";
import "./chunk-4QBFFLOC.js";
import "./chunk-O437BSYE.js";
import "./chunk-YZNT6QWD.js";
import {
  Ze
} from "./chunk-B7GRWOZI.js";
import "./chunk-SAOPWBKU.js";
import "./chunk-Z2JVKOTW.js";
import "./chunk-YW5DYBTP.js";
import "./chunk-2C54H6O6.js";
import "./chunk-UHMXQYZT.js";
import "./chunk-LZUPV7SL.js";
import "./chunk-2GRLWAHK.js";
import "./chunk-C3UDKWXD.js";
import "./chunk-YTFX4PFO.js";
import "./chunk-VOROPCKI.js";
import "./chunk-N3IR233K.js";
import "./chunk-DSMB46HB.js";
import "./chunk-USSQX44O.js";
import "./chunk-OTI4DGZ5.js";
import "./chunk-KQDYTHCF.js";
import "./chunk-TR6FCWXY.js";
import "./chunk-TROPJVOL.js";
import "./chunk-JKHDI77M.js";
import "./chunk-3AY5EJVP.js";
import "./chunk-XQCKIDQO.js";
import "./chunk-BNK4CEA6.js";
import "./chunk-BPMRTFHU.js";
import "./chunk-6LDLRQX4.js";
import "./chunk-Z4YAQ5JI.js";
import "./chunk-K2XCQKCC.js";
import "./chunk-AJS4B62I.js";
import "./chunk-S5EXT7FA.js";
import "./chunk-73Y7XDLH.js";
import "./chunk-YFOAET4H.js";
import "./chunk-5U4TBXYS.js";
import "./chunk-6WG22V46.js";
import "./chunk-OOGIXDXG.js";
import "./chunk-JFYQTYD3.js";
import "./chunk-KDJZAYOF.js";
import "./chunk-5453A3C5.js";
import "./chunk-HCFDI7IX.js";
import "./chunk-AQJS6F3O.js";
import "./chunk-WUB6LJVL.js";
import "./chunk-QXSES7JX.js";
import "./chunk-5YIMTGEC.js";
import "./chunk-YPU2P4KO.js";
import "./chunk-UFVMJL32.js";
import "./chunk-B67FUUE5.js";
import "./chunk-5GQ3OMCZ.js";
import "./chunk-2SMFPIRI.js";
import "./chunk-2GMKFOCL.js";
import "./chunk-ZR5BOILP.js";
import "./chunk-QCBC3RJX.js";
import "./chunk-6XGV55XZ.js";
import "./chunk-HOH445RO.js";
import "./chunk-63QCTVYB.js";
import "./chunk-U74WRHVJ.js";
import "./chunk-TCPN7AEH.js";
import "./chunk-W2IRSMFY.js";
import "./chunk-TRSGUVSM.js";
import "./chunk-U3MA63JX.js";
import "./chunk-WYKKCLBI.js";
import {
  y
} from "./chunk-PFMGJTQM.js";
import "./chunk-Q7SRMLJZ.js";
import "./chunk-PQ4T66BG.js";
import "./chunk-SWPHGZYB.js";
import "./chunk-DWASPXVI.js";
import "./chunk-TNWXOQKO.js";
import "./chunk-MAO5BVLA.js";
import "./chunk-T2S5VXNP.js";
import "./chunk-4U5GUJRA.js";
import "./chunk-7KRERHHR.js";
import "./chunk-T4AP6CTC.js";
import "./chunk-HD65DNIO.js";
import "./chunk-4KWLMXIA.js";
import "./chunk-BIUXKPKA.js";
import "./chunk-N6TJI25E.js";
import "./chunk-634JLXD4.js";
import "./chunk-Y3EDGYWG.js";
import "./chunk-UF6JOUSJ.js";
import "./chunk-T5JGQSO3.js";
import "./chunk-CIW3KHOW.js";
import "./chunk-J55F4AC2.js";
import "./chunk-IQLBZKUD.js";
import "./chunk-7MZZCQ64.js";
import "./chunk-JOJZ6YC5.js";
import "./chunk-L4TOCXR5.js";
import "./chunk-IMVP5ADD.js";
import "./chunk-H7WPOTQH.js";
import "./chunk-RTWBKPWJ.js";
import "./chunk-ZZEAVAVX.js";
import "./chunk-SJX5DIA7.js";
import "./chunk-6A7CWJED.js";
import "./chunk-LFKEQKEA.js";
import "./chunk-DUTZNK67.js";
import "./chunk-IN6BQCWS.js";
import "./chunk-CRNUMTSV.js";
import "./chunk-JM7HAEY6.js";
import "./chunk-DOK4SACJ.js";
import "./chunk-OUKUASAF.js";
import "./chunk-V5RMUGJJ.js";
import "./chunk-D2NB6D6N.js";
import "./chunk-UWJIHV6Q.js";
import "./chunk-ZUSCOMQM.js";
import "./chunk-DSEUCBVP.js";
import "./chunk-UPDWQH75.js";
import "./chunk-RXWBJSJ5.js";
import "./chunk-M2NS3MSU.js";
import "./chunk-HMNBB7ED.js";
import "./chunk-3RRMLFFN.js";
import "./chunk-DR5TVNEL.js";
import "./chunk-HT2T6PUB.js";
import "./chunk-K64AAM77.js";
import "./chunk-6EUVKE22.js";
import "./chunk-A3NNJ7XA.js";
import "./chunk-OKJHJ3CY.js";
import "./chunk-XTVPEVHA.js";
import "./chunk-DTUSTSEJ.js";
import "./chunk-JCWFGRHQ.js";
import "./chunk-JILEJ6R2.js";
import "./chunk-GAW5JHG4.js";
import "./chunk-OEKKQXBD.js";
import "./chunk-S3IO7V4Q.js";
import "./chunk-DZALMCYL.js";
import "./chunk-K226GFDN.js";
import "./chunk-4ZZRP4MA.js";
import "./chunk-7ZJ6P7J7.js";
import "./chunk-FPFZQCEQ.js";
import "./chunk-5I6J67HP.js";
import "./chunk-YVULORT6.js";
import "./chunk-PB33BAI3.js";
import "./chunk-CVB43GGP.js";
import {
  O
} from "./chunk-XWXBNAOW.js";
import {
  m
} from "./chunk-GWC3DAGP.js";
import "./chunk-EODIWR2E.js";
import "./chunk-LLDOZWVV.js";
import "./chunk-FYAEQPUY.js";
import {
  C
} from "./chunk-7XMEZQ34.js";
import "./chunk-BDM2D6IC.js";
import "./chunk-U2ZVAEKG.js";
import "./chunk-EDSMXTFO.js";
import "./chunk-MNLT652N.js";
import "./chunk-OGZAGPIO.js";
import "./chunk-HJJIIYFF.js";
import "./chunk-7RMVJCDW.js";
import "./chunk-T6GCUITX.js";
import "./chunk-TUIGM7TV.js";
import "./chunk-IHVSZYZS.js";
import "./chunk-6CA6K3O7.js";
import "./chunk-NYQ5CYNR.js";
import "./chunk-O7UDKFOW.js";
import "./chunk-TKPMIAIW.js";
import "./chunk-NQOJNTB3.js";
import "./chunk-MFOQYQFG.js";
import "./chunk-NKCPFCP3.js";
import "./chunk-3ZXOUEQG.js";
import "./chunk-AXVPJBVW.js";
import "./chunk-OXEPWRM7.js";
import "./chunk-POILQGXA.js";
import "./chunk-JJS7PR2U.js";
import "./chunk-L5YS4GSA.js";
import "./chunk-PRREDSOB.js";
import "./chunk-V5C6HSAM.js";
import "./chunk-SYATLP3H.js";
import "./chunk-V6AMQYXE.js";
import "./chunk-6WHTZNUH.js";
import "./chunk-EITGQLII.js";
import "./chunk-TIVJXVMN.js";
import "./chunk-XNUH25NY.js";
import "./chunk-WGAPNV7F.js";
import "./chunk-BXQGM56A.js";
import "./chunk-4Z5SGKRM.js";
import "./chunk-ANKOCGE2.js";
import "./chunk-7CJXZOFG.js";
import "./chunk-IRGZKO7V.js";
import "./chunk-5SELS7VU.js";
import "./chunk-DDYVXG4F.js";
import "./chunk-ANP42J2U.js";
import {
  S
} from "./chunk-HJY2YILU.js";
import "./chunk-7DA6A5LD.js";
import "./chunk-2MMLMOWS.js";
import "./chunk-4323ZVPF.js";
import "./chunk-WYIDUUN2.js";
import "./chunk-DXLOWWK7.js";
import {
  __async
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/arcade/functions/featuresetbase.js
function X2(e2) {
  if (1 === e2.length) {
    if (U(e2[0])) return l("distinct", e2[0], -1);
    if (Q(e2[0])) return l("distinct", e2[0].toArray(), -1);
  }
  return l("distinct", e2, -1);
}
function ee2(e2, t3, n) {
  return __async(this, null, function* () {
    const a4 = e2.getVariables();
    if (a4.length > 0) {
      const i = [];
      for (let e3 = 0; e3 < a4.length; e3++) {
        const r3 = {
          name: a4[e3]
        };
        i.push(yield t3.evaluateIdentifier(n, r3));
      }
      const r2 = {};
      for (let e3 = 0; e3 < a4.length; e3++) r2[a4[e3]] = i[e3];
      return e2.parameters = r2, e2;
    }
    return e2;
  });
}
function te2(e2, t3, n = null) {
  for (const a4 in e2) if (a4.toLowerCase() === t3.toLowerCase()) return e2[a4];
  return n;
}
function ne(e2) {
  if (null === e2) return null;
  const t3 = {
    type: te2(e2, "type", ""),
    name: te2(e2, "name", "")
  };
  if ("range" === t3.type) t3.range = te2(e2, "range", []);
  else {
    t3.codedValues = [];
    for (const n of te2(e2, "codedValues", [])) t3.codedValues.push({
      name: te2(n, "name", ""),
      code: te2(n, "code", null)
    });
  }
  return t3;
}
function ae2(e2) {
  if (null === e2) return null;
  const t3 = {}, n = te2(e2, "wkt");
  null !== n && (t3.wkt = n);
  const a4 = te2(e2, "wkid");
  return null !== a4 && (t3.wkid = a4), t3;
}
function ie(e2) {
  if (null === e2) return null;
  const t3 = {
    hasZ: te2(e2, "hasz", false),
    hasM: te2(e2, "hasm", false)
  }, n = te2(e2, "spatialreference");
  null != n && (t3.spatialReference = ae2(n));
  const a4 = te2(e2, "x", null);
  if (null !== a4) return t3.x = a4, t3.y = te2(e2, "y", null), t3.hasZ && (t3.z = te2(e2, "z", null)), t3.hasM && (t3.m = te2(e2, "m", null)), t3;
  const i = te2(e2, "rings", null);
  if (null !== i) return t3.rings = i, t3;
  const r2 = te2(e2, "paths", null);
  if (null !== r2) return t3.paths = r2, t3;
  const s = te2(e2, "points", null);
  if (null !== s) return t3.points = s, t3;
  for (const o of ["xmin", "xmax", "ymin", "ymax", "zmin", "zmax", "mmin", "mmax"]) {
    const n2 = te2(e2, o, null);
    null !== n2 && (t3[o] = n2);
  }
  return t3;
}
function re(e2, t3) {
  for (const n of t3) if (n === e2) return true;
  return false;
}
function se(e2) {
  return !!e2.layerDefinition && !!e2.featureSet && false !== re(e2.layerDefinition.geometryType, ["", null, "esriGeometryNull", "esriGeometryPoint", "esriGeometryPolyline", "esriGeometryPolygon", "esriGeometryMultipoint", "esriGeometryEnvelope"]) && false !== U(e2.layerDefinition.fields) && false !== U(e2.featureSet.features);
}
function oe(e2) {
  return "utc" === e2?.toLowerCase() ? "UTC" : "unknown" === e2?.toLowerCase() ? "Unknown" : e2;
}
function le(q2) {
  "async" === q2.mode && (q2.functions.timezone = function(t3, r2) {
    return q2.standardFunctionAsync(t3, r2, (s, o, l3) => __async(this, null, function* () {
      if (ae(l3, 1, 2, t3, r2), te(l3[0])) return "Unknown";
      if (ee(l3[0])) return "Unknown";
      if (B(l3[0])) {
        if (yield l3[0].load(), 1 === l3.length || null === l3[1]) return l3[0].datesInUnknownTimezone ? oe("unknown") : oe(l3[0].dateFieldsTimeZone);
        if (!(l3[1] instanceof N) || false === l3[1].hasField("type")) throw new a(t3, r.InvalidParameter, r2);
        const e2 = l3[1].field("type");
        if (false === G(e2)) throw new a(t3, r.InvalidParameter, r2);
        switch (me(e2).toLowerCase()) {
          case "preferredtimezone":
            return oe(l3[0].preferredTimeZone);
          case "editfieldsinfo":
            return oe(l3[0].editFieldsInfo?.timeZone ?? null);
          case "timeinfo":
            return oe(l3[0].timeInfo?.timeZone ?? null);
          case "field":
            if (l3[1].hasField("fieldname") && G(l3[1].field("fieldname"))) return oe(l3[0].fieldTimeZone(me(l3[1].field("fieldname"))));
        }
        throw new a(t3, r.InvalidParameter, r2);
      }
      const f = he(l3[0], He(t3));
      if (null === f) return null;
      const u2 = f.timeZone;
      return "system" === u2 ? m.systemTimeZoneCanonicalName : "utc" === u2.toLowerCase() ? "UTC" : "unknown" === u2.toLowerCase() ? "Unknown" : u2;
    }));
  }, q2.functions.sqltimestamp = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 1, 3, e2, t3);
      const o = s[0];
      if (X(o)) {
        if (1 === s.length) return o.toSQLWithKeyword();
        if (2 === s.length) return o.changeTimeZone(me(s[1])).toSQLWithKeyword();
        throw new a(e2, r.InvalidParameter, t3);
      }
      if (ee(o)) return o.toSQLWithKeyword();
      if (B(o)) {
        if (3 !== s.length) throw new a(e2, r.InvalidParameter, t3);
        yield o.load();
        const n2 = me(s[1]);
        if (ee(s[2])) return s[2].toSQLWithKeyword();
        if (false === X(s[2])) throw new a(e2, r.InvalidParameter, t3);
        const r3 = o.fieldTimeZone(n2);
        return null === r3 ? s[2].toSQLWithKeyword() : s[2].changeTimeZone(r3).toSQLWithKeyword();
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "sqltimestamp",
    min: 2,
    max: 4
  }), q2.functions.featuresetbyid = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => {
      if (ae(s, 2, 4, e2, t3), W(s[0])) {
        const n2 = me(s[1]);
        let r3 = P(s[2], null);
        const o = Ne(P(s[3], true));
        if (null === r3 && (r3 = ["*"]), false === U(r3)) throw new a(e2, r.InvalidParameter, t3);
        return s[0].featureSetById(n2, o, r3);
      }
      throw new a(e2, r.InvalidParameter, t3);
    });
  }, q2.signatures.push({
    name: "featuresetbyid",
    min: 2,
    max: 4
  }), q2.functions.getfeatureset = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, o) => __async(this, null, function* () {
      if (ae(o, 1, 2, e2, t3), H(o[0])) {
        let t4 = P(o[1], "datasource");
        return null === t4 && (t4 = "datasource"), t4 = me(t4).toLowerCase(), q(o[0].fullSchema(), t4, e2.lrucache, e2.interceptor, e2.spatialReference ?? null);
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "getfeatureset",
    min: 1,
    max: 2
  }), q2.functions.featuresetbyportalitem = function(e2, n) {
    return q2.standardFunctionAsync(e2, n, (r2, s, l3) => {
      if (ae(l3, 2, 5, e2, n), null === l3[0]) throw new a(e2, r.PortalRequired, n);
      if (l3[0] instanceof t2) {
        const t3 = me(l3[1]), r3 = me(l3[2]);
        let s2 = P(l3[3], null);
        const f2 = Ne(P(l3[4], true));
        if (null === s2 && (s2 = ["*"]), false === U(s2)) throw new a(e2, r.InvalidParameter, n);
        let u3;
        return u3 = e2.services?.portal ? e2.services.portal : C.getDefault(), u3 = l2(l3[0], u3), G2(t3, r3, e2.spatialReference ?? null, s2, f2, u3, e2.lrucache, e2.interceptor);
      }
      if (false === G(l3[0])) throw new a(e2, r.PortalRequired, n);
      const f = me(l3[0]), u2 = me(l3[1]);
      let d2 = P(l3[2], null);
      const c2 = Ne(P(l3[3], true));
      if (null === d2 && (d2 = ["*"]), false === U(d2)) throw new a(e2, r.InvalidParameter, n);
      return G2(f, u2, e2.spatialReference ?? null, d2, c2, e2.services?.portal ?? C.getDefault(), e2.lrucache, e2.interceptor);
    });
  }, q2.signatures.push({
    name: "featuresetbyportalitem",
    min: 2,
    max: 5
  }), q2.functions.featuresetbyname = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => {
      if (ae(s, 2, 4, e2, t3), W(s[0])) {
        const n2 = me(s[1]);
        let r3 = P(s[2], null);
        const o = Ne(P(s[3], true));
        if (null === r3 && (r3 = ["*"]), false === U(r3)) throw new a(e2, r.InvalidParameter, t3);
        return s[0].featureSetByName(n2, o, r3);
      }
      throw new a(e2, r.InvalidParameter, t3);
    });
  }, q2.signatures.push({
    name: "featuresetbyname",
    min: 2,
    max: 4
  }), q2.functions.featureset = function(e2, t3) {
    return q2.standardFunction(e2, t3, (r2, s, o) => {
      ae(o, 1, 1, e2, t3);
      const l3 = {
        layerDefinition: {
          geometryType: "",
          objectIdField: "",
          globalIdField: "",
          typeIdField: "",
          hasM: false,
          hasZ: false,
          fields: []
        },
        featureSet: {
          geometryType: "",
          features: []
        }
      };
      if (G(o[0])) {
        const e3 = JSON.parse(o[0]);
        void 0 !== e3.layerDefinition ? (l3.layerDefinition = e3.layerDefinition, l3.featureSet = e3.featureSet, e3.layerDefinition.spatialReference && (l3.layerDefinition.spatialReference = e3.layerDefinition.spatialReference)) : (l3.featureSet.features = e3.features, l3.featureSet.geometryType = e3.geometryType, l3.layerDefinition.geometryType = l3.featureSet.geometryType, l3.layerDefinition.objectIdField = e3.objectIdFieldName ?? "", l3.layerDefinition.typeIdField = e3.typeIdFieldName, l3.layerDefinition.globalIdField = e3.globalIdFieldName, l3.layerDefinition.fields = e3.fields, e3.spatialReference && (l3.layerDefinition.spatialReference = e3.spatialReference));
      } else {
        if (!(o[0] instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = JSON.parse(o[0].castToText(true)), r3 = te2(n, "layerdefinition");
          if (null !== r3) {
            l3.layerDefinition.geometryType = te2(r3, "geometrytype", ""), l3.featureSet.geometryType = l3.layerDefinition.geometryType, l3.layerDefinition.globalIdField = te2(r3, "globalidfield", ""), l3.layerDefinition.objectIdField = te2(r3, "objectidfield", ""), l3.layerDefinition.typeIdField = te2(r3, "typeidfield", ""), l3.layerDefinition.hasZ = true === te2(r3, "hasz", false), l3.layerDefinition.hasM = true === te2(r3, "hasm", false);
            const e3 = te2(r3, "spatialreference");
            e3 && (l3.layerDefinition.spatialReference = ae2(e3));
            const t4 = [];
            for (const n2 of te2(r3, "fields", [])) {
              const e4 = {
                name: te2(n2, "name", ""),
                alias: te2(n2, "alias", ""),
                type: te2(n2, "type", ""),
                nullable: te2(n2, "nullable", true),
                editable: te2(n2, "editable", true),
                length: te2(n2, "length", null),
                domain: ne(te2(n2, "domain"))
              };
              t4.push(e4);
            }
            l3.layerDefinition.fields = t4;
            const a4 = te2(n, "featureset");
            if (a4) {
              const e4 = {};
              for (const n2 of t4) e4[n2.name.toLowerCase()] = n2.name;
              for (const t5 of te2(a4, "features", [])) {
                const n2 = {}, a5 = te2(t5, "attributes", {});
                for (const t6 in a5) n2[e4[t6.toLowerCase()]] = a5[t6];
                l3.featureSet.features.push({
                  attributes: n2,
                  geometry: ie(te2(t5, "geometry"))
                });
              }
            }
          } else {
            l3.layerDefinition.hasZ = true === te2(n, "hasz", false), l3.layerDefinition.hasM = true === te2(n, "hasm", false), l3.layerDefinition.geometryType = te2(n, "geometrytype", ""), l3.featureSet.geometryType = l3.layerDefinition.geometryType, l3.layerDefinition.objectIdField = te2(n, "objectidfieldname", ""), l3.layerDefinition.typeIdField = te2(n, "typeidfieldname", "");
            const r4 = te2(n, "spatialreference");
            r4 && (l3.layerDefinition.spatialReference = ae2(r4));
            const s2 = [], o2 = te2(n, "fields", null);
            if (!U(o2)) throw new a(e2, r.InvalidParameter, t3);
            for (const e3 of o2) {
              const t4 = {
                name: te2(e3, "name", ""),
                alias: te2(e3, "alias", ""),
                type: te2(e3, "type", ""),
                nullable: te2(e3, "nullable", true),
                editable: te2(e3, "editable", true),
                length: te2(e3, "length", null),
                domain: ne(te2(e3, "domain"))
              };
              s2.push(t4);
            }
            l3.layerDefinition.fields = s2;
            const f = {};
            for (const e3 of s2) f[e3.name.toLowerCase()] = e3.name;
            let u2 = te2(n, "features", null);
            if (U(u2)) for (const e3 of u2) {
              const t4 = {}, n2 = te2(e3, "attributes", {});
              for (const e4 in n2) t4[f[e4.toLowerCase()]] = n2[e4];
              l3.featureSet.features.push({
                attributes: t4,
                geometry: ie(te2(e3, "geometry", null))
              });
            }
            else u2 = null, l3.featureSet.features = u2;
          }
        }
      }
      if (false === se(l3)) throw new a(e2, r.InvalidParameter, t3);
      return l3.layerDefinition.geometryType || (l3.layerDefinition.geometryType = "esriGeometryNull"), d.create(l3, e2.spatialReference);
    });
  }, q2.signatures.push({
    name: "featureset",
    min: 1,
    max: 1
  }), q2.functions.filter = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), U(s[0]) || Q(s[0])) {
        const n2 = [];
        let r3, o = s[0];
        if (o instanceof t && (o = o.toArray()), !_(s[1])) throw new a(e2, r.InvalidParameter, t3);
        r3 = s[1].createFunction(e2);
        for (const e3 of o) {
          const t4 = r3(e3);
          S(t4) ? true === (yield t4) && n2.push(e3) : true === t4 && n2.push(e3);
        }
        return n2;
      }
      if (B(s[0])) {
        const t4 = yield s[0].load(), n2 = O.create(s[1], t4.getFieldsIndex(), t4.dateFieldsTimeZoneDefaultUTC), a4 = n2.getVariables();
        if (a4.length > 0) {
          const t5 = [];
          for (let n3 = 0; n3 < a4.length; n3++) {
            const i2 = {
              name: a4[n3]
            };
            t5.push(yield q2.evaluateIdentifier(e2, i2));
          }
          const i = {};
          for (let e3 = 0; e3 < a4.length; e3++) i[a4[e3]] = t5[e3];
          return n2.parameters = i, new c({
            parentfeatureset: s[0],
            whereclause: n2
          });
        }
        return new c({
          parentfeatureset: s[0],
          whereclause: n2
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "filter",
    min: 2,
    max: 2
  }), q2.functions.orderby = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) {
        const e3 = new e(s[1]);
        return new a2({
          parentfeatureset: s[0],
          orderbyclause: e3
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "orderby",
    min: 2,
    max: 2
  }), q2.functions.top = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) return new a3({
        parentfeatureset: s[0],
        topnum: s[1]
      });
      if (U(s[0])) return ge(s[1]) >= s[0].length ? s[0].slice(0) : s[0].slice(0, ge(s[1]));
      if (Q(s[0])) return ge(s[1]) >= s[0].length() ? s[0].slice(0) : s[0].slice(0, ge(s[1]));
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "top",
    min: 2,
    max: 2
  }), q2.functions.first = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, a4, i) => __async(this, null, function* () {
      if (ae(i, 1, 1, e2, t3), B(i[0])) {
        const t4 = yield i[0].first(n.abortSignal);
        if (null !== t4) {
          const n2 = D.createFromGraphicLikeObject(t4.geometry, t4.attributes, i[0], e2.timeZone);
          return n2._underlyingGraphic = t4, n2;
        }
        return t4;
      }
      return U(i[0]) ? 0 === i[0].length ? null : i[0][0] : Q(i[0]) ? 0 === i[0].length() ? null : i[0].get(0) : null;
    }));
  }, q2.signatures.push({
    name: "first",
    min: 1,
    max: 1
  }), q2.functions.attachments = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      ae(o, 1, 2, e2, t3);
      const f = {
        minsize: -1,
        maxsize: -1,
        types: null,
        returnMetadata: false
      };
      if (o.length > 1) {
        if (o[1] instanceof N) {
          if (o[1].hasField("minsize") && (f.minsize = ge(o[1].field("minsize"))), o[1].hasField("metadata") && (f.returnMetadata = Ne(o[1].field("metadata"))), o[1].hasField("maxsize") && (f.maxsize = ge(o[1].field("maxsize"))), o[1].hasField("types")) {
            const e3 = Re(o[1].field("types"), false);
            e3.length > 0 && (f.types = e3);
          }
        } else if (null !== o[1]) throw new a(e2, r.InvalidParameter, t3);
      }
      if (H(o[0])) {
        let t4 = o[0]._layer;
        return t4 instanceof Ze && (t4 = T(t4, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === t4 ? [] : false === B(t4) ? [] : (yield t4.load(), t4.queryAttachments(o[0].field(t4.objectIdField), f.minsize, f.maxsize, f.types, f.returnMetadata));
      }
      if (null === o[0]) return [];
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "attachments",
    min: 1,
    max: 2
  }), q2.functions.featuresetbyrelationshipname = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 2, 4, e2, t3);
      const o = s[0], d2 = me(s[1]);
      let c2 = P(s[2], null);
      const p = Ne(P(s[3], true));
      if (null === c2 && (c2 = ["*"]), false === U(c2)) throw new a(e2, r.InvalidParameter, t3);
      if (null === s[0]) return null;
      if (!H(s[0])) throw new a(e2, r.InvalidParameter, t3);
      let y3 = o._layer;
      if (y3 instanceof Ze && (y3 = T(y3, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === y3) return null;
      if (false === B(y3)) return null;
      y3 = yield y3.load();
      const h = y3.relationshipMetaData().filter((e3) => e3.name === d2);
      if (0 === h.length) return null;
      if (void 0 !== h[0].relationshipTableId && null !== h[0].relationshipTableId && h[0].relationshipTableId > -1) return E(y3, h[0], o.field(y3.objectIdField), y3.spatialReference, c2, p, e2.lrucache, e2.interceptor);
      let F = y3.serviceUrl();
      if (!F) return null;
      F = "/" === F.charAt(F.length - 1) ? F + h[0].relatedTableId.toString() : F + "/" + h[0].relatedTableId.toString();
      const I2 = yield N2(F, y3.spatialReference, c2, p, e2.lrucache, e2.interceptor);
      yield I2.load();
      let D3 = I2.relationshipMetaData();
      if (D3 = D3.filter((e3) => e3.id === h[0].id), false === o.hasField(h[0].keyField) || null === o.field(h[0].keyField)) {
        const e3 = yield y3.getFeatureByObjectId(o.field(y3.objectIdField), [h[0].keyField]);
        if (e3) {
          const t4 = O.create(D3[0].keyField + "= @id", I2.getFieldsIndex(), I2.dateFieldsTimeZoneDefaultUTC);
          return t4.parameters = {
            id: e3.attributes[h[0].keyField]
          }, I2.filter(t4);
        }
        return new u({
          parentfeatureset: I2
        });
      }
      const T2 = O.create(D3[0].keyField + "= @id", I2.getFieldsIndex(), I2.dateFieldsTimeZoneDefaultUTC);
      return T2.parameters = {
        id: o.field(h[0].keyField)
      }, I2.filter(T2);
    }));
  }, q2.signatures.push({
    name: "featuresetbyrelationshipname",
    min: 2,
    max: 4
  }), q2.functions.featuresetbyassociation = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 2, 3, e2, t3);
      const o = s[0], f = me(P(s[1], "")).toLowerCase(), u2 = G(s[2]) ? me(s[2]) : null;
      if (null === s[0]) return null;
      if (!H(s[0])) throw new a(e2, r.InvalidParameter, t3);
      let c2 = o._layer;
      if (c2 instanceof Ze && (c2 = T(c2, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === c2) return null;
      if (false === B(c2)) return null;
      yield c2.load();
      const p = c2.serviceUrl(), y3 = yield O2(p, e2.spatialReference);
      let F = null, I2 = null, D3 = false;
      if (null !== u2 && "" !== u2 && void 0 !== u2) {
        for (const e3 of y3.terminals) e3.terminalName === u2 && (I2 = e3.terminalId);
        null === I2 && (D3 = true);
      }
      const T2 = y3.associations.getFieldsIndex(), E2 = T2.get("TOGLOBALID").name, A = T2.get("FROMGLOBALID").name, x = T2.get("TOTERMINALID").name, L2 = T2.get("FROMTERMINALID").name, S2 = T2.get("FROMNETWORKSOURCEID").name, C2 = T2.get("TONETWORKSOURCEID").name, v2 = T2.get("ASSOCIATIONTYPE").name, P2 = T2.get("ISCONTENTVISIBLE").name, k2 = T2.get("OBJECTID").name;
      for (const e3 of c2.fields) if ("global-id" === e3.type) {
        F = o.field(e3.name);
        break;
      }
      let O3 = null, z = new B2(new y({
        name: "percentalong",
        alias: "percentalong",
        type: "double"
      }), O.create("0", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), H2 = new B2(new y({
        name: "side",
        alias: "side",
        type: "string"
      }), O.create("''", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
      const W2 = "globalid", G3 = "globalId", K = {};
      for (const e3 in y3.lkp) K[e3] = y3.lkp[e3].sourceId;
      const q3 = new b(new y({
        name: "classname",
        alias: "classname",
        type: "string"
      }), null, K);
      let B3 = "";
      switch (f) {
        case "midspan": {
          B3 = `((${E2}='${F}') OR ( ${A}='${F}')) AND (${v2} IN (5))`, q3.codefield = O.create(`CASE WHEN (${E2}='${F}') THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const e3 = y2(L.findField(y3.associations.fields, A));
          e3.name = W2, e3.alias = W2, O3 = new B2(e3, O.create(`CASE WHEN (${A}='${F}') THEN ${E2} ELSE ${A} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), z = y3.unVersion >= 4 ? new I(L.findField(y3.associations.fields, T2.get("PERCENTALONG").name)) : new B2(new y({
            name: "percentalong",
            alias: "percentalong",
            type: "double"
          }), O.create("0", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "junctionedge": {
          B3 = `((${E2}='${F}') OR ( ${A}='${F}')) AND (${v2} IN (4,6))`, q3.codefield = O.create(`CASE WHEN (${E2}='${F}') THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const e3 = y2(L.findField(y3.associations.fields, A));
          e3.name = W2, e3.alias = W2, O3 = new B2(e3, O.create(`CASE WHEN (${A}='${F}') THEN ${E2} ELSE ${A} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), H2 = new B2(new y({
            name: "side",
            alias: "side",
            type: "string"
          }), O.create(`CASE WHEN (${v2}=4) THEN 'from' ELSE 'to' END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "connected": {
          let e3 = `${E2}='@T'`, t4 = `${A}='@T'`;
          null !== I2 && (e3 += ` AND ${x}=@A`, t4 += ` AND ${L2}=@A`), B3 = "((" + e3 + ") OR (" + t4 + "))", B3 = v(B3, "@T", F ?? ""), e3 = v(e3, "@T", F ?? ""), null !== I2 && (e3 = v(e3, "@A", I2.toString()), B3 = v(B3, "@A", I2.toString())), q3.codefield = O.create("CASE WHEN " + e3 + ` THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const n2 = y2(L.findField(y3.associations.fields, A));
          n2.name = W2, n2.alias = W2, O3 = new B2(n2, O.create("CASE WHEN " + e3 + ` THEN ${A} ELSE ${E2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "container":
          B3 = `${E2}='${F}' AND ${v2} = 2`, null !== I2 && (B3 += ` AND ${x} = ` + I2.toString()), q3.codefield = S2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, A), W2, W2);
          break;
        case "content":
          B3 = `(${A}='${F}' AND ${v2} = 2)`, null !== I2 && (B3 += ` AND ${L2} = ` + I2.toString()), q3.codefield = C2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, E2), W2, W2);
          break;
        case "structure":
          B3 = `(${E2}='${F}' AND ${v2} = 3)`, null !== I2 && (B3 += ` AND ${x} = ` + I2.toString()), q3.codefield = S2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, A), W2, G3);
          break;
        case "attached":
          B3 = `(${A}='${F}' AND ${v2} = 3)`, null !== I2 && (B3 += ` AND ${L2} = ` + I2.toString()), q3.codefield = C2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, E2), W2, G3);
          break;
        default:
          throw new a(e2, r.InvalidParameter, t3);
      }
      D3 && (B3 = "1 <> 1");
      return new L({
        parentfeatureset: y3.associations,
        adaptedFields: [new I(L.findField(y3.associations.fields, k2)), new I(L.findField(y3.associations.fields, P2)), O3, H2, q3, z],
        extraFilter: B3 ? O.create(B3, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC) : null
      });
    }));
  }, q2.signatures.push({
    name: "featuresetbyassociation",
    min: 2,
    max: 6
  }), q2.functions.groupby = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      if (ae(o, 3, 3, e2, t3), !B(o[0])) throw new a(e2, r.InvalidParameter, t3);
      const l3 = yield o[0].load(), f = [], u2 = [];
      let d2 = false, c2 = [];
      if (G(o[1])) c2.push(o[1]);
      else if (o[1] instanceof N) c2.push(o[1]);
      else if (U(o[1])) c2 = o[1];
      else {
        if (!Q(o[1])) throw new a(e2, r.InvalidParameter, t3);
        c2 = o[1].toArray();
      }
      for (const m2 of c2) if (G(m2)) {
        const e3 = O.create(me(m2), l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC), t4 = true === D2(e3) ? me(m2) : "%%%%FIELDNAME";
        f.push({
          name: t4,
          expression: e3
        }), "%%%%FIELDNAME" === t4 && (d2 = true);
      } else {
        if (!(m2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = m2.hasField("name") ? m2.field("name") : "%%%%FIELDNAME", r3 = m2.hasField("expression") ? m2.field("expression") : "";
          if ("%%%%FIELDNAME" === n && (d2 = true), !n) throw new a(e2, r.InvalidParameter, t3);
          f.push({
            name: n,
            expression: O.create(r3 || n, l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC)
          });
        }
      }
      if (c2 = [], G(o[2])) c2.push(o[2]);
      else if (U(o[2])) c2 = o[2];
      else if (Q(o[2])) c2 = o[2].toArray();
      else {
        if (!(o[2] instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        c2.push(o[2]);
      }
      for (const m2 of c2) {
        if (!(m2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = m2.hasField("name") ? m2.field("name") : "", r3 = m2.hasField("statistic") ? m2.field("statistic") : "", s2 = m2.hasField("expression") ? m2.field("expression") : "";
          if (!n || !r3 || !s2) throw new a(e2, r.InvalidParameter, t3);
          u2.push({
            name: n,
            statistic: r3.toLowerCase(),
            expression: O.create(s2, l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC)
          });
        }
      }
      if (d2) {
        const e3 = {};
        for (const n of l3.fields) e3[n.name.toLowerCase()] = 1;
        for (const n of f) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
        for (const n of u2) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
        let t4 = 0;
        for (const n of f) if ("%%%%FIELDNAME" === n.name) {
          for (; 1 === e3["field_" + t4.toString()]; ) t4++;
          e3["field_" + t4.toString()] = 1, n.name = "FIELD_" + t4.toString();
        }
      }
      for (const t4 of f) yield ee2(t4.expression, q2, e2);
      for (const t4 of u2) yield ee2(t4.expression, q2, e2);
      return o[0].groupby(f, u2);
    }));
  }, q2.signatures.push({
    name: "groupby",
    min: 3,
    max: 3
  }), q2.functions.distinct = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      if (B(o[0])) {
        ae(o, 2, 2, e2, t3);
        const r3 = yield o[0].load(), s2 = [];
        let l3 = [];
        if (G(o[1])) l3.push(o[1]);
        else if (o[1] instanceof N) l3.push(o[1]);
        else if (U(o[1])) l3 = o[1];
        else {
          if (!Q(o[1])) throw new a(e2, r.InvalidParameter, t3);
          l3 = o[1].toArray();
        }
        let f = false;
        for (const o2 of l3) if (G(o2)) {
          const e3 = O.create(me(o2), r3.getFieldsIndex(), r3.dateFieldsTimeZoneDefaultUTC), t4 = true === D2(e3) ? me(o2) : "%%%%FIELDNAME";
          s2.push({
            name: t4,
            expression: e3
          }), "%%%%FIELDNAME" === t4 && (f = true);
        } else {
          if (!(o2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
          {
            const n = o2.hasField("name") ? o2.field("name") : "%%%%FIELDNAME", l4 = o2.hasField("expression") ? o2.field("expression") : "";
            if ("%%%%FIELDNAME" === n && (f = true), !n) throw new a(e2, r.InvalidParameter, t3);
            s2.push({
              name: n,
              expression: O.create(l4 || n, r3.getFieldsIndex(), r3.dateFieldsTimeZoneDefaultUTC)
            });
          }
        }
        if (f) {
          const e3 = {};
          for (const n of r3.fields) e3[n.name.toLowerCase()] = 1;
          for (const n of s2) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
          let t4 = 0;
          for (const n of s2) if ("%%%%FIELDNAME" === n.name) {
            for (; 1 === e3["field_" + t4.toString()]; ) t4++;
            e3["field_" + t4.toString()] = 1, n.name = "FIELD_" + t4.toString();
          }
        }
        for (const t4 of s2) yield ee2(t4.expression, q2, e2);
        return o[0].groupby(s2, []);
      }
      return X2(o);
    }));
  }, q2.functions.getfeaturesetinfo = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (a4, i, r2) => __async(this, null, function* () {
      if (ae(r2, 1, 1, e2, t3), !B(r2[0])) return null;
      const s = yield r2[0].getFeatureSetInfo();
      return s ? N.convertObjectToArcadeDictionary({
        layerId: s.layerId,
        layerName: s.layerName,
        itemId: s.itemId,
        serviceLayerUrl: s.serviceLayerUrl,
        webMapLayerId: s.webMapLayerId ?? null,
        webMapLayerTitle: s.webMapLayerTitle ?? null,
        className: null,
        objectClassId: null
      }, He(e2), false, false) : null;
    }));
  }, q2.signatures.push({
    name: "getfeaturesetinfo",
    min: 1,
    max: 1
  }), q2.functions.filterbysubtypecode = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) {
        const n2 = yield s[0].load(), r3 = s[1];
        if (!V(r3)) throw new a(e2, r.InvalidParameter, t3);
        if (n2.subtypeField) {
          const e3 = O.create(`${n2.subtypeField}= ${s[1]}`, n2.getFieldsIndex(), n2.dateFieldsTimeZoneDefaultUTC);
          return new c({
            parentfeatureset: s[0],
            whereclause: e3
          });
        }
        if (null === n2.typeIdField || "" === n2.typeIdField) throw new a(e2, r.FeatureSetDoesNotHaveSubtypes, t3);
        const o = O.create(`${n2.typeIdField}= ${s[1]}`, n2.getFieldsIndex(), n2.dateFieldsTimeZoneDefaultUTC);
        return new c({
          parentfeatureset: s[0],
          whereclause: o
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "filterbysubtypecode",
    min: 2,
    max: 2
  }));
}
export {
  le as registerFunctions
};
//# sourceMappingURL=featuresetbase-AM5XYTMT.js.map
