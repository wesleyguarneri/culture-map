import {
  pe
} from "./chunk-3QL6OCU3.js";
import "./chunk-WU45X43Z.js";
import {
  T,
  n as n4,
  s as s2
} from "./chunk-IFHCRMMI.js";
import "./chunk-PQKIJHUT.js";
import {
  s as s3
} from "./chunk-S3GWRL6P.js";
import "./chunk-GJ7RIUPZ.js";
import "./chunk-7NERSLA5.js";
import {
  a as a2,
  m as m2
} from "./chunk-ECL36OQK.js";
import "./chunk-R5TKJUPW.js";
import "./chunk-CYRWOVUJ.js";
import "./chunk-VKKATW5E.js";
import "./chunk-2ACBZNFZ.js";
import "./chunk-W24CYY6Q.js";
import "./chunk-JBQJ3BUL.js";
import "./chunk-3FSYWRTQ.js";
import {
  c,
  p as p2
} from "./chunk-STVIJ4IV.js";
import "./chunk-QRVAQWLH.js";
import "./chunk-TMPIWG43.js";
import "./chunk-EU7GCI2A.js";
import "./chunk-WE6VW4MG.js";
import "./chunk-5QM72RFD.js";
import "./chunk-WQXGIEVZ.js";
import "./chunk-T3EGKTN6.js";
import "./chunk-ZFPMGEAK.js";
import "./chunk-4SCJM64G.js";
import "./chunk-DABQKFI5.js";
import "./chunk-67V5AGVJ.js";
import "./chunk-FLWLBYXO.js";
import "./chunk-2ERGO64O.js";
import "./chunk-RP2GKJCD.js";
import "./chunk-QL5HR3YL.js";
import "./chunk-D3AKDIJC.js";
import {
  e as e4
} from "./chunk-ZDGJDLVE.js";
import "./chunk-IIVUY2T7.js";
import {
  e as e3
} from "./chunk-HBMA4SRU.js";
import {
  t as t2
} from "./chunk-322SYD2C.js";
import "./chunk-5NCKEQLF.js";
import {
  h as h2
} from "./chunk-GT3AQDRW.js";
import "./chunk-5APMY2AQ.js";
import {
  E,
  I,
  R,
  b as b2,
  i as i2,
  j,
  k
} from "./chunk-GHUJU3NS.js";
import "./chunk-SLCHZ6DD.js";
import "./chunk-VS26W5Y5.js";
import "./chunk-PVO5NM6Q.js";
import "./chunk-DM4WHMQY.js";
import "./chunk-YA5CTHMT.js";
import "./chunk-6MR4UDDL.js";
import {
  Ze
} from "./chunk-B7GRWOZI.js";
import "./chunk-SAOPWBKU.js";
import "./chunk-Z2JVKOTW.js";
import "./chunk-YW5DYBTP.js";
import "./chunk-2C54H6O6.js";
import "./chunk-UHMXQYZT.js";
import "./chunk-LZUPV7SL.js";
import "./chunk-2GRLWAHK.js";
import "./chunk-C3UDKWXD.js";
import "./chunk-YTFX4PFO.js";
import "./chunk-VOROPCKI.js";
import "./chunk-N3IR233K.js";
import "./chunk-DSMB46HB.js";
import "./chunk-USSQX44O.js";
import "./chunk-OTI4DGZ5.js";
import "./chunk-KQDYTHCF.js";
import "./chunk-TR6FCWXY.js";
import "./chunk-TROPJVOL.js";
import "./chunk-JKHDI77M.js";
import "./chunk-3AY5EJVP.js";
import "./chunk-XQCKIDQO.js";
import "./chunk-BNK4CEA6.js";
import "./chunk-BPMRTFHU.js";
import "./chunk-6LDLRQX4.js";
import "./chunk-Z4YAQ5JI.js";
import "./chunk-K2XCQKCC.js";
import "./chunk-AJS4B62I.js";
import "./chunk-S5EXT7FA.js";
import "./chunk-73Y7XDLH.js";
import "./chunk-YFOAET4H.js";
import "./chunk-5U4TBXYS.js";
import "./chunk-6WG22V46.js";
import "./chunk-OOGIXDXG.js";
import "./chunk-JFYQTYD3.js";
import "./chunk-KDJZAYOF.js";
import "./chunk-5453A3C5.js";
import "./chunk-HCFDI7IX.js";
import "./chunk-AQJS6F3O.js";
import "./chunk-WUB6LJVL.js";
import "./chunk-QXSES7JX.js";
import "./chunk-5YIMTGEC.js";
import "./chunk-YPU2P4KO.js";
import "./chunk-UFVMJL32.js";
import "./chunk-B67FUUE5.js";
import "./chunk-5GQ3OMCZ.js";
import "./chunk-2SMFPIRI.js";
import "./chunk-L7ZKWTWL.js";
import "./chunk-O2DTA3XK.js";
import "./chunk-ZE47C44H.js";
import "./chunk-5GIS2C3K.js";
import "./chunk-XCOHDMBF.js";
import "./chunk-2GMKFOCL.js";
import "./chunk-ZR5BOILP.js";
import "./chunk-QCBC3RJX.js";
import "./chunk-6XGV55XZ.js";
import "./chunk-HOH445RO.js";
import "./chunk-63QCTVYB.js";
import "./chunk-N4KQPPPI.js";
import "./chunk-4OGGMTIH.js";
import "./chunk-NQVBBKAN.js";
import "./chunk-U74WRHVJ.js";
import "./chunk-TCPN7AEH.js";
import "./chunk-DY7FJHTG.js";
import "./chunk-Q4KYZS3X.js";
import "./chunk-BQZBOYBD.js";
import "./chunk-TYQXPPSP.js";
import "./chunk-W2IRSMFY.js";
import "./chunk-TRSGUVSM.js";
import "./chunk-U3MA63JX.js";
import "./chunk-WYKKCLBI.js";
import {
  i
} from "./chunk-PFMGJTQM.js";
import "./chunk-Q7SRMLJZ.js";
import "./chunk-PQ4T66BG.js";
import "./chunk-SWPHGZYB.js";
import "./chunk-DWASPXVI.js";
import "./chunk-TNWXOQKO.js";
import "./chunk-MAO5BVLA.js";
import "./chunk-T2S5VXNP.js";
import "./chunk-4U5GUJRA.js";
import "./chunk-7KRERHHR.js";
import "./chunk-T4AP6CTC.js";
import {
  d as d3
} from "./chunk-HD65DNIO.js";
import {
  k as k2,
  n as n3
} from "./chunk-4KWLMXIA.js";
import "./chunk-BIUXKPKA.js";
import "./chunk-N6TJI25E.js";
import "./chunk-634JLXD4.js";
import "./chunk-Y3EDGYWG.js";
import "./chunk-UF6JOUSJ.js";
import "./chunk-T5JGQSO3.js";
import "./chunk-CIW3KHOW.js";
import "./chunk-J55F4AC2.js";
import {
  S
} from "./chunk-IQLBZKUD.js";
import {
  y as y2
} from "./chunk-7MZZCQ64.js";
import "./chunk-JOJZ6YC5.js";
import "./chunk-L4TOCXR5.js";
import "./chunk-IMVP5ADD.js";
import "./chunk-H7WPOTQH.js";
import "./chunk-RTWBKPWJ.js";
import "./chunk-ZZEAVAVX.js";
import "./chunk-SJX5DIA7.js";
import "./chunk-6A7CWJED.js";
import "./chunk-LFKEQKEA.js";
import {
  K,
  W
} from "./chunk-DUTZNK67.js";
import "./chunk-IN6BQCWS.js";
import "./chunk-CRNUMTSV.js";
import {
  r as r2,
  x
} from "./chunk-JM7HAEY6.js";
import "./chunk-DOK4SACJ.js";
import "./chunk-OUKUASAF.js";
import "./chunk-V5RMUGJJ.js";
import "./chunk-D2NB6D6N.js";
import "./chunk-UWJIHV6Q.js";
import "./chunk-ZUSCOMQM.js";
import "./chunk-DSEUCBVP.js";
import "./chunk-UPDWQH75.js";
import "./chunk-RXWBJSJ5.js";
import "./chunk-M2NS3MSU.js";
import "./chunk-HMNBB7ED.js";
import "./chunk-3RRMLFFN.js";
import "./chunk-DR5TVNEL.js";
import "./chunk-HT2T6PUB.js";
import "./chunk-K64AAM77.js";
import "./chunk-6EUVKE22.js";
import "./chunk-A3NNJ7XA.js";
import "./chunk-OKJHJ3CY.js";
import "./chunk-XTVPEVHA.js";
import "./chunk-DTUSTSEJ.js";
import "./chunk-JCWFGRHQ.js";
import "./chunk-JILEJ6R2.js";
import "./chunk-GAW5JHG4.js";
import "./chunk-OEKKQXBD.js";
import {
  l,
  u
} from "./chunk-S3IO7V4Q.js";
import {
  d as d2
} from "./chunk-DZALMCYL.js";
import "./chunk-K226GFDN.js";
import "./chunk-4ZZRP4MA.js";
import "./chunk-7ZJ6P7J7.js";
import "./chunk-FPFZQCEQ.js";
import {
  B,
  e2,
  r
} from "./chunk-WYMXVOAT.js";
import {
  n as n2
} from "./chunk-K7TO5IIO.js";
import "./chunk-A4VVDRCH.js";
import {
  b
} from "./chunk-CQDYITZC.js";
import "./chunk-5I6J67HP.js";
import "./chunk-YVULORT6.js";
import {
  h
} from "./chunk-PB33BAI3.js";
import "./chunk-CVB43GGP.js";
import "./chunk-EODIWR2E.js";
import "./chunk-LLDOZWVV.js";
import "./chunk-FYAEQPUY.js";
import {
  C
} from "./chunk-7XMEZQ34.js";
import "./chunk-BDM2D6IC.js";
import "./chunk-U2ZVAEKG.js";
import "./chunk-EDSMXTFO.js";
import "./chunk-MNLT652N.js";
import "./chunk-OGZAGPIO.js";
import "./chunk-HJJIIYFF.js";
import "./chunk-ONPREQKF.js";
import "./chunk-7RMVJCDW.js";
import "./chunk-GTY5NXA4.js";
import {
  m2 as m
} from "./chunk-T6GCUITX.js";
import "./chunk-TUIGM7TV.js";
import "./chunk-IHVSZYZS.js";
import "./chunk-6CA6K3O7.js";
import "./chunk-NYQ5CYNR.js";
import "./chunk-O7UDKFOW.js";
import {
  f
} from "./chunk-TKPMIAIW.js";
import "./chunk-NQOJNTB3.js";
import "./chunk-MFOQYQFG.js";
import "./chunk-NKCPFCP3.js";
import "./chunk-3ZXOUEQG.js";
import "./chunk-AXVPJBVW.js";
import "./chunk-OXEPWRM7.js";
import "./chunk-POILQGXA.js";
import "./chunk-JJS7PR2U.js";
import "./chunk-L5YS4GSA.js";
import "./chunk-PRREDSOB.js";
import "./chunk-V5C6HSAM.js";
import {
  t3 as t
} from "./chunk-SYATLP3H.js";
import "./chunk-V6AMQYXE.js";
import {
  d,
  p,
  w
} from "./chunk-6WHTZNUH.js";
import {
  V
} from "./chunk-EITGQLII.js";
import "./chunk-TIVJXVMN.js";
import "./chunk-XNUH25NY.js";
import {
  o
} from "./chunk-WGAPNV7F.js";
import "./chunk-BXQGM56A.js";
import {
  e
} from "./chunk-4Z5SGKRM.js";
import "./chunk-YPWMP2VK.js";
import "./chunk-23E6RT3O.js";
import "./chunk-RCBGISRX.js";
import "./chunk-2P72IR2Y.js";
import "./chunk-ANKOCGE2.js";
import {
  y
} from "./chunk-7CJXZOFG.js";
import "./chunk-IRGZKO7V.js";
import "./chunk-5SELS7VU.js";
import {
  a3 as a
} from "./chunk-DDYVXG4F.js";
import "./chunk-ANP42J2U.js";
import "./chunk-HJY2YILU.js";
import "./chunk-7DA6A5LD.js";
import "./chunk-2MMLMOWS.js";
import "./chunk-4323ZVPF.js";
import {
  n2 as n,
  s2 as s
} from "./chunk-WYIDUUN2.js";
import "./chunk-DXLOWWK7.js";
import {
  __async,
  __spreadValues
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace/support/GeometryHandler.js
function f2(e6) {
  return "polygon" === e6.type || "polyline" === e6.type;
}
function u2(e6) {
  return e6.hasOwnProperty("points");
}
function y3(e6) {
  return u2(e6) && 2 === e6.points.length;
}
var g = class {
  createBuffer(r3, n7, o2, i4) {
    if (Array.isArray(r3)) {
      if (r3.length > 0) {
        const s7 = f.fromJSON(r3[0].spatialReference);
        return s7.isWGS84 || s7.isWebMercator ? E(r3, n7, o2) : j(r3, n7, o2, i4);
      }
      return;
    }
    const s6 = f.fromJSON(r3.spatialReference);
    return s6.isWGS84 || s6.isWebMercator ? E(r3, n7[0], o2) : j(r3, n7[0], o2);
  }
  createConvexHull(e6) {
    if (Array.isArray(e6)) {
      if (1 === e6.length && y3(e6[0])) {
        const t5 = R(e6[0]);
        if (f2(t5)) return t5;
      }
      return R(e6, true).filter(f2);
    }
    const t4 = R(e6);
    if (f2(t4)) return t4;
  }
  calculateArea(e6, t4) {
    const r3 = new f({
      wkid: e6.spatialReference.wkid
    });
    return r3.isWGS84 || r3.isWebMercator ? parseFloat(k(e6, t4).toFixed(2)) : parseFloat(I(e6, t4).toFixed(2));
  }
  mergeAggregatedToGeometries(e6) {
    const t4 = [], {
      line: r3,
      multipoint: n7,
      polygon: o2
    } = e6;
    return r3 && t4.push(r3), n7 && t4.push(n7), o2 && t4.push(o2), t4;
  }
  getPercentageAlong(e6, t4, r3) {
    let n7 = e6;
    const o2 = this._createPolyline(e6.paths, r3.wkid);
    if ("point" === t4.type) {
      const e7 = t4.x - 0.5, a5 = t4.x + 0.5, l3 = [[e7, t4.y - 0.5], [a5, t4.y + 0.5]];
      n7 = this._createPolyline(l3, t4.spatialReference.wkid);
      n7 = K(n7, r3);
      const p4 = i2(o2, n7);
      if (p4.length > 0) {
        const e8 = b2(o2, "feet");
        let t5;
        t5 = p4[0].paths[0][0][0] === o2.paths[0][0][0] ? b2(p4[0], "feet") : b2(p4[1], "feet");
        return [t5 / e8];
      }
      return [0.5];
    }
    n7 = K(t4, r3);
    const a4 = i2(o2, n7);
    if (a4.length > 0) {
      const e7 = b2(o2, "feet");
      return [b2(a4[0], "feet") / e7];
    }
    return [0.5];
  }
  projectGeometry(e6, t4) {
    return __async(this, null, function* () {
      return yield W(), K(e6, t4);
    });
  }
  _createPolyline(e6, t4) {
    return new m({
      hasZ: false,
      hasM: true,
      paths: e6,
      spatialReference: {
        wkid: t4
      }
    });
  }
};

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace/support/GraphicHandler.js
var p3 = [227, 27, 21, 0.6];
var n5 = [21, 244, 21, 0.6];
var s4 = 12;
var h3 = [{
  color: [255, 0, 0, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#ff0000"
}, {
  color: [255, 0, 255, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#ff00ff"
}, {
  color: [217, 188, 255, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#D9BCFF"
}, {
  color: [0, 255, 0, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#00ff00"
}, {
  color: [255, 255, 0, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#ffff00"
}, {
  color: [0, 0, 255, 0.6],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#0000ff"
}, {
  color: [255, 165, 0, 0.5],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#ffa500"
}, {
  color: [0, 0, 0, 0.5],
  haloOpacity: 0.9,
  fillOpacity: 0.2,
  hex: "#000000"
}];
var f3 = class {
  constructor() {
    this.highlightColor = [...h3];
  }
  addCustomColor(o2) {
    this.highlightColor = [...h3];
    this.highlightColor.some((i4) => i4.hex.toLowerCase() === o2.hex.toLowerCase()) || this.highlightColor.push(o2);
  }
  getFlagGraphic(o2, i4, e6, t4) {
    const l3 = "starting-point" === i4 ? n5 : p3;
    if ("polygon" === o2.type) {
      const i5 = o2;
      i5.centroid && (o2 = i5.centroid);
    }
    if (t4) {
      return this.makeGraphic(o2, l3, e6?.attributes, null, t4);
    }
    return this.makeGraphic(o2, l3, e6?.attributes);
  }
  initializeSketch(o2, e6, t4) {
    const l3 = new V();
    return t4.forEach((o3) => l3.add(new p2({
      layer: o3,
      enabled: true
    }))), new pe({
      layer: e6,
      view: o2,
      snappingOptions: new c({
        enabled: true,
        featureEnabled: true,
        featureSources: l3
      })
    });
  }
  makeGraphic(i4, r3, a4, c2, p4) {
    let n7, h4 = i4;
    switch (i4.type) {
      case "multipoint":
        n7 = new y2({
          color: r3,
          size: s4,
          outline: {
            color: r3,
            width: 0
          }
        }), c2 && (h4 = i4);
        break;
      case "point":
        n7 = p4 || new y2({
          color: r3,
          size: s4,
          outline: {
            color: r3,
            width: 0
          }
        }), c2 && (h4 = i4);
        break;
      case "polyline":
        n7 = new d2({
          color: r3,
          width: s4
        }), c2 && (h4 = i4);
        break;
      case "polygon":
        n7 = new S({
          color: r3,
          outline: {
            color: r3,
            width: s4
          }
        }), c2 && (h4 = i4);
    }
    return new d3({
      geometry: h4,
      symbol: n7,
      attributes: a4 ?? null
    });
  }
};

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace/support/ResultAreaHandler.js
var n6 = `utility-network-trace-result-area-${Date.now()}`;
function l2(e6) {
  return "graphics" === e6.type;
}
var s5 = class {
  constructor() {
    this.traceInformation = {}, this._geometryHandler = new g();
  }
  addResultAreaToMap(e6, r3) {
    const t4 = this.createGraphicLayer(r3);
    t4 && l2(t4) && t4.add(e6);
  }
  changeResultAreaColor(e6, r3, t4) {
    const o2 = new S({
      color: r3.color,
      style: "solid",
      outline: {
        color: r3.color,
        width: 1
      }
    }), i4 = this._findGraphicsByTraceId(e6, t4);
    return i4 && i4.forEach((e7) => {
      e7.symbol = o2;
    }), o2;
  }
  createBuffer(e6, r3, t4, o2) {
    return this._geometryHandler.createBuffer(e6, r3, t4, o2);
  }
  createConvexHull(e6, r3, t4) {
    const o2 = this._geometryHandler.createConvexHull(e6);
    return r3 > 0 && o2 ? this.createBuffer(o2, [r3], t4, false) : o2;
  }
  createResultAreaGraphic(t4, i4, n7, l3, s6, c2) {
    const u3 = new S({
      color: c2.color,
      style: "solid",
      outline: {
        color: c2.color,
        width: 1
      }
    }), d4 = [];
    for (const e6 in i4) d4.push(new n3({
      fieldName: e6,
      label: "areaStatistic" === e6 ? l3.attributeStrings[e6] + " (" + s6.units[n7]?.abbr + ")" : l3.attributeStrings[e6]
    }));
    return new d3({
      geometry: t4,
      symbol: u3,
      attributes: i4,
      popupTemplate: new k2({
        title: i4.traceName,
        content: [{
          type: "fields",
          fieldInfos: d4
        }]
      })
    });
  }
  removeResultArea(e6, r3) {
    const t4 = r3.findLayerById(n6);
    if (t4 && l2(t4)) {
      const o2 = this._findGraphicsByTraceId(e6, r3);
      return o2 && t4.removeMany(o2), o2;
    }
    return null;
  }
  removeAllResultAreaGraphics(e6) {
    if (e6) {
      const r3 = e6.findLayerById(n6);
      r3 && l2(r3) && r3.removeAll();
    }
  }
  createGraphicLayer(e6, r3) {
    const o2 = e6.findLayerById(n6);
    if (o2 && l2(o2)) return o2;
    const a4 = new h2({
      title: r3 ?? n6,
      listMode: "hide",
      id: n6
    });
    return e6.add(a4), a4;
  }
  _findGraphicsByTraceId(e6, r3) {
    const t4 = r3.findLayerById(n6);
    if (t4 && l2(t4)) {
      const r4 = t4.graphics.filter((r5) => r5.attributes.traceId === e6);
      return r4.length > 0 ? r4.toArray() : null;
    }
    return null;
  }
};

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace/support/UtilityHelper.js
function e5(r3) {
  return "feature" === r3.type;
}
function t3(r3, e6) {
  return r3.url.includes(e6);
}
function a3(r3, e6) {
  return (r3.dataElement?.domainNetworks || []).some((r4) => r4.subnetworkLayerId === e6.layerId);
}
var i3 = class {
  getValidUtilityNetworkLayers(i4, l3) {
    const s6 = [];
    return i4?.allLayers.forEach((i5) => {
      "group" === i5.type ? s6.push(...i5.layers.filter(r2).filter((r3) => e5(r3) && l3.isUtilityLayer(r3) && !a3(l3, r3)).filter((r3) => t3(r3, l3.featureServiceUrl)).toArray()) : "subtype-group" === i5.type ? s6.push(...i5.sublayers.filter((r3) => t3(r3, l3.featureServiceUrl)).toArray()) : r2(i5) && e5(i5) && l3.isUtilityLayer(i5) && !a3(l3, i5) && t3(i5, l3.featureServiceUrl) && s6.push(i5);
    }), s6;
  }
};

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace/UtilityNetworkTraceViewModel.js
var H = () => h("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace");
var N = () => h("esri/core/t9n/Units");
var P = `utility-network-trace-flags-${Date.now()}`;
var U = `utility-network-trace-results-${Date.now()}`;
function C2(e6) {
  return e6 instanceof i;
}
function E2(e6) {
  return "feature" === e6.layer.type || "subtype-group" === e6.layer.type;
}
function B2(e6) {
  return "layer" in e6;
}
function V2(e6) {
  return void 0 !== e6.layerViews;
}
function j2(e6) {
  return "graphics" === e6.type;
}
function D(e6) {
  return __async(this, null, function* () {
    const t4 = new Ze({
      url: e6.networkSystemLayers.dirtyAreasLayerUrl
    });
    yield t4.load();
    const r3 = t4.version;
    if (Number(r3) <= 11.1) {
      const t5 = yield x(e6.layerUrl), r4 = new C({
        url: t5
      });
      yield r4.load();
      const s6 = r4?.user?.username;
      return !!s6 && t2(r4, s6, "utilityNetwork");
    }
    return true;
  });
}
var O = class extends o.EventedAccessor {
  constructor(e6) {
    super(e6), this._activeProgress = false, this._clickHandler = null, this._flags = [], this._flagId = 0, this._geometryHandler = null, this._highlightHandler = [], this._resultAreaHandler = null, this._utilityHelper = new i3(), this._watchHandler = null, this._validUNLayers = [], this._traceTimeout = 6e5, this._sketchViewModel = null, this.traces = [], this.graphicHandler = null, this.defaultGraphicColor = {
      color: [255, 255, 0, 0.6],
      haloOpacity: 0.9,
      fillOpacity: 0.2,
      hex: "#FFFF00"
    }, this.enableResultArea = false, this.flags = [], this.gdbVersion = "sde.DEFAULT", this.messages = null, this.messagesUnits = null, this.defaultResultAreaProperties = {
      type: "convexhull",
      distance: 10,
      unit: "meters",
      areaUnit: "square-meters",
      color: {
        color: [255, 165, 0, 0.5],
        haloOpacity: 0.9,
        fillOpacity: 0.2,
        hex: "#ffa500"
      },
      show: false
    }, this.selectedTraces = [], this.selectOnComplete = true, this.showGraphicsOnComplete = true, this.showSelectionAttributes = true, this.traceResults = [], this.utilityNetwork = null;
  }
  initialize() {
    this._geometryHandler = new g(), this.graphicHandler = new f3(), this._resultAreaHandler = new s5();
    (() => __async(this, null, function* () {
      const [e6, t4] = yield Promise.all([H(), N()]);
      this.set({
        messages: e6,
        messagesUnits: t4
      });
    }))();
  }
  destroy() {
    this.view = null;
  }
  get resultAreaProperties() {
    return this.defaultResultAreaProperties;
  }
  set resultAreaProperties(e6) {
    this._set("resultAreaProperties", __spreadValues(__spreadValues({}, this.defaultResultAreaProperties), e6)), this.graphicHandler.addCustomColor(this.resultAreaProperties.color), this.traceResults.forEach((t4) => {
      const r3 = t4.resultArea?.show;
      t4.resultArea = __spreadValues(__spreadValues({}, this.defaultResultAreaProperties), e6), this.removeResultAreaFromMap(t4), this.enableResultArea && this.createResultAreaGraphic(t4).then((s6) => {
        if (s6) {
          t4.resultAreaGraphic = s6;
          const i4 = e6?.show ?? r3;
          t4.resultArea && (t4.resultArea.show = i4), i4 && this.addResultAreaToMap(t4, s6);
        }
      });
    });
  }
  get state() {
    return this.view?.ready ? "ready" : "loading";
  }
  get view() {
    return this._get("view");
  }
  set view(e6) {
    e6 && "2d" !== e6.type && n.getLogger(this).error(new s("view:invalid-view", "SceneView is not supported", {
      view: e6
    })), this._set("view", e6), this.utilityNetwork && this.reset(), this.utilityNetwork = null, this.loadUtilityNetwork().then((e7) => {
      e7 && this.selectTracesOnLoad();
    });
  }
  addFlagByHit(e6, t4) {
    const r3 = (e7) => {
      this.view?.popup && (this.view.popupEnabled = e7);
    };
    return new Promise((s6, i4) => {
      r3(false), this._clickHandler?.remove(), this._clickHandler = this._sketchViewModel.on("create", (a4) => {
        if ("complete" === a4.state) {
          const l3 = this._getGraphicLayer(P);
          l3 && a4.graphic && l3.remove(a4.graphic), this.queryFlagByHitTest(a4, e6, t4).then((i5) => {
            r3(true), this._clickHandler?.remove(), this.emit("add-flag-complete", {
              type: e6,
              symbol: t4
            }), s6(i5);
          }).catch((s7) => {
            r3(true), this._clickHandler?.remove(), this.emit("add-flag-error", {
              type: e6,
              symbol: t4
            }), i4(s7);
          });
        }
      }), this._sketchViewModel.create("point"), this.emit("add-flag", {
        type: e6
      });
    });
  }
  addFlagsOnLoad() {
    return __async(this, null, function* () {
      if (this._flags.length > 0) return [];
      yield w(() => null != this.view && !this.view.updating);
      return (yield Promise.all(this.flags.map((e6) => __async(this, null, function* () {
        if (!e6.mapPoint) return null;
        const {
          type: t4
        } = e6, r3 = e6.mapPoint.clone(), s6 = "barrier" === t4 ? p3 : n5, i4 = {
          graphic: this.graphicHandler.makeGraphic(r3, s6),
          state: "complete",
          tool: "point",
          toolEventInfo: null,
          type: "create"
        };
        try {
          return yield this.queryFlagByHitTest(i4, e6.type, null), this.emit("add-flag-complete", {
            type: t4
          }), null;
        } catch (a4) {
          return this.emit("add-flag-error", {
            type: t4
          }), "barrier" === t4 ? "barrier" : "starting-point";
        }
      })))).filter((e6) => !e6);
    });
  }
  addResultAreaToMap(e6, t4) {
    return __async(this, null, function* () {
      if (this.view) {
        if (e6.resultArea.show = true, t4) this._resultAreaHandler?.addResultAreaToMap(t4, this.view.map), this.emit("add-result-area", {
          graphic: t4
        });
        else if (e6.results) {
          const t5 = yield this.createResultAreaGraphic(e6);
          t5 && (e6.resultAreaGraphic = t5, this._resultAreaHandler?.addResultAreaToMap(t5, this.view.map), this.emit("add-result-area", {
            graphic: t5
          }));
        }
      }
    });
  }
  addResultGraphicToView(e6, t4) {
    return __async(this, null, function* () {
      const {
        view: r3
      } = this, {
        results: s6
      } = e6;
      if (r3 && s6 && this.utilityNetwork) {
        for (const i4 in s6.aggregatedGeometry) if ("line,multipoint,polygon".includes(i4)) {
          const a4 = i4, l3 = s6.aggregatedGeometry[a4];
          if (null != l3) {
            l3.spatialReference = this.utilityNetwork.spatialReference, e6.graphicEnabled = true;
            const s7 = yield this._geometryHandler.projectGeometry(l3, r3.spatialReference), i5 = {
              globalid: e6.trace.globalId
            };
            if (null !== s7) {
              const e7 = this.graphicHandler.makeGraphic(s7, t4.color, i5, r3.spatialReference);
              this._getGraphicLayer(U)?.add(e7);
            }
          }
        }
      }
    });
  }
  addTerminal(e6, t4) {
    const r3 = [...this._flags];
    r3.forEach((r4) => {
      r4.globalId === t4.globalId && (t4.selectedTerminals?.includes(parseInt(e6, 10)) || r4.selectedTerminals?.push(parseInt(e6, 10)));
    }), this._flags = r3;
  }
  callTrace() {
    return __async(this, null, function* () {
      const e6 = this.traces.filter((e7) => e7.selected);
      return e6.length > 0 && (this.traceResults.length > 0 && this.traceResults.forEach((e7) => {
        this.removeResultGraphicFromView(e7);
      }), this.traceResults = [], this.removeSelection(), yield Promise.all(e6.map((e7, t4) => __async(this, null, function* () {
        const r3 = e7, s6 = new m2({
          gdbVersion: this.utilityNetwork ? this.utilityNetwork.gdbVersion : this.gdbVersion,
          moment: null,
          traceType: r3.traceType,
          traceLocations: this._flags,
          namedTraceConfigurationGlobalId: r3.globalId,
          traceConfiguration: null,
          outSpatialReference: null,
          resultTypes: null
        });
        yield this.executeTrace(r3, this.utilityNetwork?.networkServiceUrl, s6).then((e8) => {
          if (e8.hasOwnProperty("results")) {
            const r4 = __spreadValues({}, e8);
            if (null !== r4.results) {
              r4.resultArea = __spreadValues({}, this.resultAreaProperties);
              const e9 = [...r4.results.elements];
              r4.results.elements.length = 0;
              const s7 = /* @__PURE__ */ new Map();
              for (const t5 of e9) s7.has(t5.globalId) || (s7.set(t5.globalId, true), r4.results.elements.push(t5));
              const i4 = [...this.traceResults];
              i4.splice(t4, 0, r4), this.traceResults = i4, null !== r4.results && (this.selectOnComplete && this.mergeSelection(true, r4.trace), this.showGraphicsOnComplete && this.addResultGraphicToView(r4, r4.graphicColor), this.enableResultArea && this.createResultAreaGraphic(r4).then((e10) => {
                e10 && (r4.resultAreaGraphic = e10, r4.resultArea?.show && this.addResultAreaToMap(r4, r4.resultAreaGraphic));
              }));
            } else {
              const r5 = [...this.traceResults];
              r5.splice(t4, 0, e8), this.traceResults = r5;
            }
            this._activeProgress = false;
          } else {
            this._activeProgress = false;
            const r4 = [...this.traceResults];
            r4.splice(t4, 0, e8), this.traceResults = r4;
          }
        }).catch((e8) => {
          throw this._activeProgress = false, e8;
        });
      }))), true);
    });
  }
  changeResultAreaColor(e6, t4) {
    if (!e6.resultArea) return;
    e6.resultArea.color = t4;
    const r3 = this._resultAreaHandler?.changeResultAreaColor(e6.trace.globalId, t4, this.view.map);
    e6.resultAreaGraphic && (e6.resultAreaGraphic.symbol = r3);
  }
  changeResultGraphicColor(e6, t4) {
    const r3 = [...this.traceResults];
    r3.length > 0 && r3.forEach((r4) => {
      r4.trace.globalId === t4.trace.globalId && (r4.graphicColor = e6, r4.graphicEnabled = true);
    }), this.traceResults = r3, this.removeResultGraphicFromView(t4), this.addResultGraphicToView(t4, e6);
  }
  changeFlagSymbol(e6, t4) {
    this._flags.length > 0 && this._flags.forEach((r3) => {
      r3.type === e6 && t4 && r3.mapGraphic && (r3.mapGraphic.symbol = t4);
    });
  }
  checkCanTrace() {
    const e6 = {
      status: true,
      issues: []
    };
    let t4 = false;
    const r3 = this._flags.some((e7) => "starting-point" === e7.type), s6 = this._flags.filter((e7) => null !== e7.allTerminals);
    s6.length > 0 && (t4 = s6.some((e7) => e7.selectedTerminals.length <= 0));
    let i4 = [];
    return r3 ? (i4 = this.traces.filter((e7) => e7.selected), i4.length <= 0 ? (e6.status = false, e6.issues = ["noTrace"], t4 && (e6.status = false, e6.issues = ["noTrace", "noTerminalSelected"])) : t4 && (e6.status = false, e6.issues = ["noTerminalSelected"])) : (i4 = this.traces.filter((e7) => true === e7.selected), i4.length > 0 ? (e6.status = false, e6.issues = ["noStart"], t4 && (e6.status = false, e6.issues = ["noStart", "noTerminalSelected"])) : (e6.status = false, e6.issues = ["noStart", "noTrace"], t4 && (e6.status = false, e6.issues = ["noStart", "noTrace", "noTerminalSelected"]))), e6;
  }
  checkSelectionExist() {
    return this._highlightHandler.some((e6) => e6);
  }
  clearResult(e6) {
    if (!this.view) return;
    let t4 = this.traceResults;
    if (t4.length > 0) {
      const r3 = t4.filter((t5) => t5.trace.globalId === e6.globalId);
      r3.length > 0 && (this.removeResultGraphicFromView(r3[0]), this.removeResultAreaFromMap(r3[0])), t4 = t4.filter((t5) => t5.trace.globalId !== e6.globalId);
    }
    this.traceResults = t4, 0 === t4.length ? (this.removeAllResultAreaGraphics(), this.removeSelection(), this.emit("clear-selection", {
      resultSet: []
    })) : this.mergeSelection(false, e6);
  }
  createResultAreaGeometries(e6, t4, r3) {
    if (!this.view || !this.resultAreaProperties) return;
    let s6;
    if (s6 = "convexhull" === this.resultAreaProperties?.type ? 1 === t4.length && (u(t4[0]) || l(t4[0]) && 1 === t4[0].points.length) ? this._resultAreaHandler?.createBuffer(t4, r3, e6.resultArea?.unit, true) : this._resultAreaHandler?.createConvexHull(t4, e6.resultArea?.distance, e6.resultArea?.unit) : this._resultAreaHandler?.createBuffer(t4, r3, e6.resultArea?.unit, true), !s6) return;
    if (Array.isArray(s6)) {
      for (const t5 of s6) {
        const r4 = this.getResultAreaAttributes(e6, t5), s7 = this._resultAreaHandler?.createResultAreaGraphic(t5, r4, e6.resultArea?.areaUnit, this.messages, this.messagesUnits, e6.resultArea?.color);
        if (s7) return s7;
      }
      return;
    }
    const i4 = this.getResultAreaAttributes(e6, s6);
    return this._resultAreaHandler?.createResultAreaGraphic(s6, i4, e6.resultArea?.areaUnit, this.messages, this.messagesUnits, e6.resultArea?.color);
  }
  createResultAreaGraphic(e6) {
    return __async(this, null, function* () {
      if (e6.results) {
        const t4 = yield this._createResultAreaInputGeometry(e6.results);
        if (t4.length > 0) {
          const r3 = Array(t4.length).fill(e6.resultArea?.distance), s6 = this.createResultAreaGeometries(e6, t4, r3);
          return this.emit("create-result-area", {
            graphic: s6
          }), s6;
        }
      }
    });
  }
  executeTrace(e6, t4, r3) {
    const s6 = this._processFlags(r3.traceLocations);
    return r3.traceLocations = s6, s3(t4, r3, {
      timeout: this._traceTimeout
    }).then((t5) => ({
      trace: e6,
      results: t5,
      selectionEnabled: false,
      graphicEnabled: false,
      graphicColor: this.defaultGraphicColor,
      status: "success",
      date: /* @__PURE__ */ new Date()
    })).catch((t5) => ({
      trace: e6,
      results: null,
      selectionEnabled: false,
      graphicEnabled: false,
      graphicColor: this.defaultGraphicColor,
      status: t5.message,
      date: /* @__PURE__ */ new Date()
    }));
  }
  getResultAreaAttributes(e6, r3) {
    const {
      messages: s6
    } = this, i4 = [], a4 = [];
    this._flags.forEach((e7) => {
      const t4 = e7.displayValue?.field + ":" + e7.displayValue?.value + ";" + s6.attributeStrings.globalid + ":" + e7.globalId + ";" + s6.attributeStrings.terminalid + ":" + e7.terminalId + ";" + s6.attributeStrings.x + ":" + e7.mapPoint?.x + ";" + s6.attributeStrings.y + ":" + e7.mapPoint?.y;
      "starting-point" === e7.type ? i4.push(t4) : a4.push(t4);
    });
    const l3 = this.utilityNetwork ? this.utilityNetwork.gdbVersion : this.gdbVersion;
    return {
      traceId: e6.trace.globalId,
      traceName: e6.trace.title,
      traceDescription: e6.trace.description ?? "",
      startingPoints: i4.toString(),
      barriers: a4.toString(),
      version: l3 ?? void 0,
      username: t.credentials[0].userId,
      date: e6.date,
      elementCount: e6.results?.elements.length,
      functionResult: JSON.stringify(e6.results?.globalFunctionResults),
      areaStatistic: r3 ? this._geometryHandler.calculateArea(r3, e6.resultArea?.areaUnit) : 0
    };
  }
  getValidSources() {
    let e6 = [];
    const t4 = this.utilityNetwork?.dataElement?.domainNetworks ?? [];
    for (const r3 of t4) e6 = e6.concat(r3.junctionSources), e6 = e6.concat(r3.edgeSources);
    return e6;
  }
  groupResultsByNetworkSource(e6) {
    return 0 === e6.length ? [] : this._groupBy(e6, "networkSourceId");
  }
  loadUtilityNetwork() {
    return __async(this, null, function* () {
      const {
        view: e6
      } = this;
      if (!e6) return null;
      if (yield e6.when(), this.utilityNetwork) {
        if (this.utilityNetwork.loaded || (yield this.utilityNetwork.load()), this.utilityNetwork instanceof T) {
          try {
            const t5 = e6.map;
            yield t5.loadAll(), this._loadUNSupportItems();
          } catch (i4) {
            this._loadUNSupportItems();
          }
          return this.utilityNetwork;
        }
        return null;
      }
      const t4 = e6.map, r3 = t4.utilityNetworks?.at(0);
      if (r3) {
        if (yield r3.load(), this.utilityNetwork = r3, !(yield D(r3))) throw new s("utility-network:no-user-type-extension", "User type extension not found");
        try {
          yield t4.loadAll(), this._loadUNSupportItems();
        } catch (i4) {
        } finally {
          this._loadUNSupportItems();
        }
        return r3;
      }
      return null;
    });
  }
  manageFilterBarrier(e6, t4) {
    const r3 = [...this._flags];
    r3.forEach((r4) => {
      r4.globalId === t4.globalId && "barrier" === t4.type && r4.id === t4.id && (r4.isFilterBarrier = e6);
    }), this._flags = r3;
  }
  mergeSelection(e6, t4) {
    let r3 = [];
    const s6 = [...this.traceResults], i4 = t4.globalId;
    s6.forEach((t5) => {
      i4 === t5.trace.globalId && (t5.selectionEnabled = e6), t5.selectionEnabled && null !== t5.results?.elements && (r3 = [...r3, ...t5.results?.elements ?? []]);
    }), this.selectResults([...new Set(r3)]);
  }
  queryFeaturesById(e6) {
    return __async(this, null, function* () {
      const {
        view: t4
      } = this;
      if (!t4 || !this.utilityNetwork) return null;
      const s6 = n4(this.utilityNetwork, e6), i4 = {
        layerUrl: s6[0].layerUrl,
        objectIds: s6[0].objectIds,
        outFields: ["*"]
      }, a4 = t4.map?.allTables.toArray().filter((e7) => e7?.parsedUrl?.path === s6[0].layerUrl).filter(r2) ?? [];
      this._getUniqueMapLayerViews(t4).filter(({
        layer: e7
      }) => e7?.parsedUrl?.path === s6[0].layerUrl).forEach(({
        layer: e7
      }) => {
        "feature" !== e7.type && "subtype-group" !== e7.type || a4.push(e7);
      });
      const l3 = (yield Promise.all(a4.map((e7) => __async(this, null, function* () {
        const s7 = {
          layers: new V([e7]),
          layerInfos: [i4],
          returnGeometry: true,
          outSpatialReference: t4.spatialReference
        }, [a5] = yield s2(s7, false);
        return a5;
      })))).filter(({
        featureSet: e7
      }) => e7.features.length > 0);
      return l3.length > 0 ? l3 : null;
    });
  }
  queryFlagByHitTest(e6, t4, r3) {
    return this._lookupFlagByHit(e6).then((e7) => {
      const {
        view: s6
      } = this;
      if (!s6) return false;
      if (e7.length > 0) {
        const s7 = [...this._flags], i4 = r3;
        return e7.forEach((e8) => {
          const r4 = e8.graphic, a4 = r4.attributes.hasOwnProperty("GLOBALID") ? r4.attributes.GLOBALID : r4.attributes.globalid;
          if (s7.filter((e9) => e9.globalId === a4).length <= 0) {
            const e9 = this.graphicHandler.getFlagGraphic(r4.attributes.mapPoint, t4, r4, i4);
            this._getGraphicLayer(P)?.add(e9);
            const a5 = this._createFlagProperty(r4, t4, e9);
            s7.push(a5);
          } else if (null !== r4.attributes.percentAlong) {
            const e9 = this.graphicHandler.getFlagGraphic(r4.attributes.mapPoint, t4, r4, i4);
            this._getGraphicLayer(P)?.add(e9);
            const a5 = this._createFlagProperty(r4, t4, e9);
            s7.push(a5);
          }
        }), this._flags = s7, true;
      }
      return false;
    });
  }
  removeResultGraphicFromView(e6) {
    const {
      view: t4
    } = this;
    if (!t4) return;
    const r3 = this._getGraphicLayer(U)?.graphics;
    e6.graphicEnabled = false;
    const s6 = r3?.filter((t5) => t5.attributes[t5.attributes.hasOwnProperty("GLOBALID") ? "GLOBALID" : "globalid"] === e6.trace.globalId);
    s6?.forEach((e7) => {
      this._getGraphicLayer(U)?.remove(e7);
    });
  }
  removeFlag(e6) {
    const t4 = this._flags.filter((t5) => {
      if (t5.id !== e6.id) return t5;
    });
    this._removeGraphic(e6), this._flags = t4;
  }
  removeAllResultAreaGraphics() {
    this._resultAreaHandler?.removeAllResultAreaGraphics(this.view.map);
  }
  removeResultAreaFromMap(e6) {
    if (e6.resultArea) {
      e6.resultArea.show = false;
      const t4 = this._resultAreaHandler?.removeResultArea(e6.trace.globalId, this.view?.map);
      t4 && this.emit("remove-result-area", {
        graphic: t4
      });
    }
  }
  removeSelection() {
    this._highlightHandler.forEach((e6) => {
      e6 && e6.remove();
    }), this._highlightHandler = [];
  }
  removeTerminal(e6, t4) {
    const r3 = [...this._flags];
    r3.forEach((r4) => {
      if (r4.globalId === t4.globalId && t4.selectedTerminals?.includes(parseInt(e6, 10))) {
        const s6 = t4.selectedTerminals.indexOf(parseInt(e6, 10));
        r4.selectedTerminals?.splice(s6, 1);
      }
    }), this._flags = r3;
  }
  removeFlagsOnLoadWatcher() {
    this._watchHandler && null !== this._watchHandler && this._watchHandler.remove();
  }
  removeClickHandler() {
    this._clickHandler && (this._sketchViewModel.cancel(), this._clickHandler.remove());
  }
  reset() {
    this._flags = [], this.traceResults = [];
    const e6 = [...this.traces];
    e6.forEach((e7) => {
      e7.selected = false;
    }), this.traces = e6, this.view && (this._getGraphicLayer(U)?.removeAll(), this._getGraphicLayer(P)?.removeAll(), this.removeAllResultAreaGraphics(), this.removeSelection(), this.emit("clear-selection", {
      resultSet: []
    }));
  }
  selectFeaturesById(e6) {
    const {
      view: t4
    } = this;
    if (!t4 || !this.utilityNetwork) return;
    const r3 = n4(this.utilityNetwork, e6);
    this._getUniqueMapLayerViews(t4).forEach((e7) => {
      B2(e7) && e7.layer?.parsedUrl?.path === r3[0].layerUrl && E2(e7) && this._highlightHandler.push(e7.highlight(r3[0].objectIds));
    });
  }
  selectResults(e6) {
    if (e6.length > 0) {
      this.removeSelection();
      const t4 = this.groupResultsByNetworkSource(e6), r3 = [];
      for (const e7 in t4) this.selectFeaturesById(t4[e7]), r3.push(this.queryFeaturesById(t4[e7]));
      Promise.all(r3).then((e7) => {
        this.emit("select-features", {
          resultSet: e7
        });
      });
    } else this.removeSelection(), this.emit("clear-selection", {
      resultSet: []
    });
  }
  selectTraces(e6, t4) {
    const r3 = [...this.traces];
    r3.forEach((r4) => {
      t4 === r4.globalId && (r4.selected = e6);
    }), this.traces = r3;
  }
  selectTracesOnLoad() {
    this.utilityNetwork?.hasOwnProperty("sharedNamedTraceConfigurations") && (this.traces = [...this.utilityNetwork.sharedNamedTraceConfigurations], this.traces.forEach((e6) => {
      e6.selected = false, this.selectedTraces.includes(e6.globalId) && (e6.selected = true);
    }));
  }
  zoomToAsset(e6) {
    this.view?.goTo(e6).catch((e7) => console.error(e7));
  }
  _createResultAreaInputGeometry(e6) {
    return __async(this, null, function* () {
      if (null != e6.aggregatedGeometry) return this._geometryHandler.mergeAggregatedToGeometries(e6.aggregatedGeometry);
      const t4 = this.groupResultsByNetworkSource(e6.elements), r3 = [];
      for (const s6 in t4) r3.push(this.queryFeaturesById(t4[s6]));
      try {
        const e7 = yield Promise.all(r3), t5 = [];
        for (const r4 of e7) if (r4) for (const e8 of r4) for (const r5 of e8.featureSet.features) t5.push(r5.geometry);
        return t5;
      } catch {
        return [];
      }
    });
  }
  _loadUNSupportItems() {
    if (!this.utilityNetwork) return;
    const {
      map: e6
    } = this.view, {
      messages: t4
    } = this;
    this._populateOutfields(), this._createGraphicLayer(P), this._createGraphicLayer(U), this._resultAreaHandler?.createGraphicLayer(e6, t4?.alertsStrings.genericResultHeader), this._validUNLayers = this._utilityHelper.getValidUtilityNetworkLayers(e6, this.utilityNetwork), this._sketchViewModel = this.graphicHandler.initializeSketch(this.view, this._getGraphicLayer(P), this._validUNLayers);
  }
  _getUniqueMapLayerViews(e6) {
    const t4 = [];
    return e6.layerViews.filter(({
      layer: {
        type: e7
      }
    }) => "feature" === e7 || "group" === e7 || "subtype-group" === e7).toArray().forEach((e7) => {
      switch (e7.layer.type) {
        case "group":
          if (V2(e7)) for (const r3 of e7.layerViews) t4.push(r3);
          break;
        case "subtype-group":
          t4.push(e7);
          break;
        default:
          t4.some((t5) => t5.layer.id === e7.layer.id) || t4.push(e7);
      }
    }), t4;
  }
  _processFlags(e6) {
    const t4 = [];
    return e6.forEach((e7) => {
      if (null !== e7.selectedTerminals && e7.selectedTerminals.length > 0) e7.selectedTerminals.forEach((r3) => {
        const s6 = new a2({
          globalId: e7.globalId,
          percentAlong: e7.percentAlong,
          terminalId: r3,
          type: e7.type,
          isFilterBarrier: e7.isFilterBarrier
        });
        t4.push(s6);
      });
      else {
        const r3 = new a2({
          globalId: e7.globalId,
          percentAlong: e7.percentAlong,
          type: e7.type,
          isFilterBarrier: e7.isFilterBarrier
        });
        t4.push(r3);
      }
    }), t4;
  }
  _getDisplayField(e6) {
    return "subtype-sublayer" === e6?.layer?.type ? this._getDisplayFieldBySublayer(e6) : this._getDisplayFieldByFeatureLayer(e6);
  }
  _getDisplayFieldBySublayer(e6) {
    let t4 = "", r3 = "";
    const s6 = e6.layer;
    t4 = this._checkParentForData(s6, "displayField");
    for (const i4 in e6.attributes) {
      const a4 = i4.toLowerCase();
      a4 === t4?.toLowerCase() ? (r3 = e6.attributes[i4], "assetgroup" === a4 || "assettype" === a4 ? r3 = this._checkSubtype(s6, s6.subtypeCode) : (r3 = this._checkDomain(s6.fields, i4, r3), "string" == typeof r3 && (r3 = this._defaultDisplayField(r3, s6)))) : (r3 = this._checkDomain(s6.fields, i4, r3), "string" == typeof r3 && (r3 = this._defaultDisplayField(r3, s6)));
    }
    return {
      field: t4,
      value: r3.toString()
    };
  }
  _getDisplayFieldByFeatureLayer(e6) {
    const t4 = e6.layer;
    let r3 = t4.displayField, s6 = "";
    for (const i4 in e6.attributes) {
      const a4 = i4.toLowerCase();
      if (a4 === r3?.toLowerCase()) {
        if (s6 = e6.attributes[i4], "assetgroup" === a4 || "assettype" === a4) {
          let a5 = e6.attributes[t4.typeIdField.toUpperCase()];
          a5 || (a5 = e6.attributes[t4.typeIdField.toLowerCase()]), r3 = t4.typeIdField, s6 = this._checkSubtype(t4, a5), "" === r3 && (t4.templates && t4.templates.length > 0 ? (r3 = t4.templates[0]?.name, s6 = t4.templates[0]?.name) : (r3 = t4.displayField, s6 = e6.attributes[i4]));
        } else s6 = this._checkDomain(t4.fields, i4, s6), "string" == typeof s6 && (s6 = this._defaultDisplayField(s6, t4));
      } else s6 = this._checkDomain(t4.fields, i4, s6), "string" == typeof s6 && (s6 = this._defaultDisplayField(s6, t4));
    }
    return {
      field: r3,
      value: s6 ? s6.toString() : ""
    };
  }
  _checkSubtype(e6, t4) {
    let r3 = t4;
    if ("subtype-sublayer" === e6.type) {
      const s6 = this._checkParentForData(e6, "subtypes");
      s6?.length > 0 && s6.forEach((e7) => {
        e7.code === t4 && (r3 = e7.name);
      });
    } else if (null != e6.types && e6.types.length > 0) {
      const s6 = e6.types.filter((e7) => e7.id === t4);
      s6.length > 0 && (r3 = s6[0].name);
    }
    return r3;
  }
  _checkDomain(e6, t4, r3) {
    let s6 = r3;
    const i4 = e6.filter((e7) => e7.name.toLowerCase() === t4.toLowerCase());
    if (i4.length > 0 && C2(i4[0].domain) && i4[0].domain?.codedValues) {
      const e7 = i4[0].domain.codedValues.filter(({
        code: e8
      }) => e8 === r3);
      e7.length > 0 && (s6 = e7[0].name);
    }
    return s6;
  }
  _checkParentForData(e6, t4) {
    return e6.parent?.[t4] ?? null;
  }
  _defaultDisplayField(e6, t4) {
    return e6.trim() ? e6 : t4.templates && t4.templates?.length > 0 ? t4.templates[0].name : t4.title;
  }
  get _uniqueFlagId() {
    return this._flagId++;
  }
  _groupBy(e6, t4) {
    return e6.reduce((e7, r3) => ((e7[r3[t4]] = e7[r3[t4]] || []).push(r3), e7), {});
  }
  _lookupFlagByHit(e6) {
    return __async(this, null, function* () {
      const t4 = e6.graphic?.geometry, r3 = [];
      if (t4 && u(t4) && this.view) {
        const s6 = this.view.toScreen(t4);
        if (s6) {
          const t5 = yield this.view.hitTest(s6, {
            include: this._validUNLayers
          });
          if (t5 && t5.results.length > 0) {
            const s7 = t5.results.find((e7) => null !== e7.layer);
            if (null != s7.graphic?.geometry) {
              if ("polyline" === s7.graphic.geometry.type) {
                const t6 = {
                  terminalId: null,
                  isFilterBarrier: false,
                  allTerminals: null,
                  selectedTerminals: null,
                  percentAlong: this._geometryHandler.getPercentageAlong(s7.graphic.geometry, e6.graphic?.geometry, s7.graphic.geometry.spatialReference),
                  displayValue: this._getDisplayField(s7.graphic),
                  mapPoint: s7.mapPoint
                };
                s7.graphic.attributes = __spreadValues(__spreadValues({}, s7.graphic.attributes), t6), r3.push(s7);
              } else if (("point" === s7.graphic.geometry.type || "polygon" === s7.graphic.geometry.type) && null !== this.utilityNetwork) {
                const e7 = this.utilityNetwork?.getTerminalConfiguration(s7.graphic), t6 = this._getDisplayField(s7.graphic), i4 = {
                  terminalId: e7 ? e7.terminals[0].id || null : 1,
                  isFilterBarrier: false,
                  allTerminals: e7 ?? null,
                  selectedTerminals: [e7 ? e7.terminals[0].id || null : 1],
                  percentAlong: null,
                  displayValue: t6,
                  mapPoint: s7.mapPoint
                };
                s7.graphic.attributes = __spreadValues(__spreadValues({}, s7.graphic.attributes), i4), r3.push(s7);
              }
            }
          }
        }
      }
      return r3;
    });
  }
  _createFlagProperty(e6, t4, r3) {
    const s6 = new a2();
    s6.terminalId = e6.attributes.terminalId, s6.isFilterBarrier = e6.attributes.isFilterBarrier, s6.percentAlong = e6.attributes.percentAlong, s6.globalId = e6.attributes.globalid || e6.attributes.GLOBALID, s6.type = t4;
    const i4 = s6;
    return i4.details = e6, i4.mapGraphic = r3, i4.id = this._uniqueFlagId, i4.allTerminals = e6.attributes.allTerminals, i4.selectedTerminals = e6.attributes.selectedTerminals, i4.displayValue = e6.attributes.displayValue, i4.mapPoint = e6.attributes.mapPoint, i4;
  }
  _populateOutfields() {
    return __async(this, null, function* () {
      const e6 = this.view?.map, t4 = this.getValidSources();
      e6?.layers.forEach((e7) => {
        "group" === e7.type ? e7.layers.forEach((e8) => {
          t4.some((t5) => t5.layerId === e8.layerId) && e8.fields.some((e9) => "assetgroup" === e9.name.toLowerCase()) && (e8.outFields = ["assetgroup", "assettype", "globalid", "objectid"]);
        }) : t4.some((t5) => t5.layerId === e7.layerId) && e7.fields.some((e8) => "assetgroup" === e8.name.toLowerCase()) && (e7.outFields = ["assetgroup", "assettype", "globalid", "objectid"]);
      });
    });
  }
  _removeGraphic(e6) {
    this._getGraphicLayer(P)?.remove(e6.mapGraphic);
  }
  _createGraphicLayer(e6) {
    const {
      map: t4
    } = this.view;
    if (!t4.findLayerById(e6)) {
      const r3 = new h2({
        title: e6,
        listMode: "hide",
        id: e6
      });
      t4.add(r3);
    }
  }
  _getGraphicLayer(e6) {
    const {
      map: t4
    } = this.view;
    if (t4) {
      const r3 = t4.findLayerById(e6);
      if (r3 && j2(r3)) return r3;
    }
    return null;
  }
};
e([y()], O.prototype, "_activeProgress", void 0), e([y()], O.prototype, "_flags", void 0), e([y()], O.prototype, "traces", void 0), e([y()], O.prototype, "defaultGraphicColor", void 0), e([y()], O.prototype, "enableResultArea", void 0), e([y()], O.prototype, "flags", void 0), e([y()], O.prototype, "gdbVersion", void 0), e([y()], O.prototype, "messages", void 0), e([y()], O.prototype, "messagesUnits", void 0), e([y()], O.prototype, "resultAreaProperties", null), e([y()], O.prototype, "selectedTraces", void 0), e([y()], O.prototype, "selectOnComplete", void 0), e([y()], O.prototype, "showGraphicsOnComplete", void 0), e([y()], O.prototype, "showSelectionAttributes", void 0), e([y({
  readOnly: true
})], O.prototype, "state", null), e([y()], O.prototype, "traceResults", void 0), e([y()], O.prototype, "utilityNetwork", void 0), e([y({
  value: null
})], O.prototype, "view", null), O = e([a("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")], O);
var M = O;

// ../../../node_modules/@arcgis/core/widgets/UtilityNetworkTrace.js
var m3 = "esri-utility-trace-network";
var _ = {
  base: m3,
  loaderContainer: `${m3}__loader-container`,
  loader: `${m3}__loader`,
  fadeIn: `${m3}--fade-in`,
  addButtonContainer: `${m3}__add-button-container`,
  noticeContainer: `${m3}__notice-container`,
  listContainer: `${m3}__list-container`,
  resultsContainer: `${m3}__results-container`,
  flow: `${m3}__flow`,
  numberInput: `${m3}__number-input`,
  clearPrompt: `${m3}__reset-prompt`,
  promptDivider: `${m3}__divider`,
  paddingTop: `${m3}__padTop`
};
function w2(e6) {
  return {
    height: e6 + "px"
  };
}
function v(e6) {
  return {
    width: e6 + "px"
  };
}
function b3() {
  return {
    width: "75%"
  };
}
function y4() {
  return {
    textAlign: "center",
    padding: "1rem"
  };
}
function f4(e6) {
  return {
    width: "100%",
    height: window.getComputedStyle(e6).getPropertyValue("max-height")
  };
}
function T2() {
  return {
    height: "100%"
  };
}
function S2(e6) {
  return {
    display: "flex",
    flexDirection: e6
  };
}
function R2(e6) {
  return e6 instanceof i;
}
var C3 = {
  noExtension: -2147208474
};
var A = class extends B {
  constructor(e6, t4) {
    super(e6, t4), this._selectToolActive = false, this._activeTrace = null, this._activeSwatch = "", this._traceHeaderForFlow = "", this._assetGroupHeader = "", this._assetTypeHeader = "", this._traceResultsFunctions = [], this._traceResultsAssetGroup = [], this._traceResultsAssetType = [], this._traceResultsIndividual = [], this._showTraceResultFunctions = false, this._showTraceResultAssetGroup = false, this._showTraceResultAssetType = false, this._showIndividualRecords = false, this._activeTab = "input", this._flagViewType = "starting-point", this._alertRemoveModal = false, this._warningNoFlag = false, this._warningNoTraceSelected = false, this._warningNoStartAssetFound = false, this._warningNoBarrierAssetFound = false, this._warningNoTerminal = false, this._confirmReset = false, this._showResultOptions = false, this._resultObjectIdField = "objectid", this._resultDisplayField = "objectid", this._resultSortField = "objectid", this._resultSortOrder = "desc", this._swatchNode = null, this._individualResultNode = null, this._symbolStartFlag = null, this._symbolBarrier = null, this._watchHandler = null, this._loadUNError = true, this._errorMessage = "", this.disabled = true, this.inputSettings = [], this.messages = null, this.messagesCommon = null, this.messagesUnits = null, this.viewModel = new M(), this._afterComponentCreate = this._afterComponentCreate.bind(this);
  }
  initialize() {
    this._utilityNetworkTraceInitialized(), this.addHandles(d(() => this.viewModel?.resultAreaProperties, () => this.scheduleRender()));
  }
  get defaultGraphicColor() {
    return this.viewModel.defaultGraphicColor;
  }
  set defaultGraphicColor(e6) {
    this.viewModel.defaultGraphicColor = e6;
  }
  get flags() {
    return this.viewModel.flags;
  }
  set flags(e6) {
    this.viewModel.flags = e6;
  }
  get gdbVersion() {
    return this.viewModel.gdbVersion;
  }
  set gdbVersion(e6) {
    this.viewModel.gdbVersion = e6;
  }
  get icon() {
    return "utility-network-trace";
  }
  set icon(e6) {
    this._overrideIfSome("icon", e6);
  }
  get label() {
    return this.messages?.widgetLabel ?? "";
  }
  set label(e6) {
    this._overrideIfSome("label", e6);
  }
  get resultAreaProperties() {
    return this.viewModel.resultAreaProperties;
  }
  set resultAreaProperties(e6) {
    this.viewModel.resultAreaProperties = e6;
  }
  get selectedTraces() {
    return this.viewModel.selectedTraces;
  }
  set selectedTraces(e6) {
    this.viewModel.selectedTraces = e6;
  }
  get selectOnComplete() {
    return this.viewModel.selectOnComplete;
  }
  set selectOnComplete(e6) {
    this.viewModel.selectOnComplete = e6;
  }
  get showGraphicsOnComplete() {
    return this.viewModel.showGraphicsOnComplete;
  }
  set showGraphicsOnComplete(e6) {
    this.viewModel.showGraphicsOnComplete = e6;
  }
  get enableResultArea() {
    return this.viewModel.enableResultArea;
  }
  set enableResultArea(e6) {
    this.viewModel.enableResultArea = e6;
  }
  get showSelectionAttributes() {
    return this.viewModel.showSelectionAttributes;
  }
  set showSelectionAttributes(e6) {
    this.viewModel.showSelectionAttributes = e6;
  }
  get utilityNetwork() {
    return this.viewModel.utilityNetwork;
  }
  set utilityNetwork(e6) {
    this.viewModel.utilityNetwork = e6;
  }
  get view() {
    return this.viewModel.view;
  }
  set view(e6) {
    this.viewModel.view = e6;
  }
  checkCanTrace() {
    return __async(this, null, function* () {
      this._confirmReset = false;
      const e6 = this.viewModel.checkCanTrace();
      e6.status ? (this._warningNoFlag = false, this._warningNoTraceSelected = false, this._warningNoTraceSelected = false, this._warningNoTerminal = false, this._showTraceResultFunctions = false, this._showTraceResultAssetGroup = false, this._showTraceResultAssetType = false, this._showIndividualRecords = false, this.switchTab("result"), this.viewModel._activeProgress = true, this.viewModel.removeAllResultAreaGraphics(), yield this.viewModel.callTrace(), this.viewModel._activeProgress = false) : e6.issues.forEach((e7) => {
        switch (e7) {
          case "noStart":
            this._warningNoFlag = true;
            break;
          case "noTerminalSelected":
            this._warningNoTerminal = true;
            break;
          default:
            this._warningNoTraceSelected = true;
        }
      });
    });
  }
  confirmReset() {
    this._confirmReset = true;
  }
  render() {
    const {
      state: e6
    } = this.viewModel;
    this._mixCustomStrings(), this._overrideFlagSymbol();
    const t4 = "loading" === e6 ? this._renderWarningMessage("noTraceConfig", false) : this._renderUtilityNetworkTrace();
    return n2("div", {
      class: this.classes(_.base, e3.widget, e3.panel, {
        [e3.widgetDisabled]: this.disabled
      }),
      styles: T2()
    }, t4);
  }
  loadDependencies() {
    return r({
      action: () => import("./calcite-action-M3FHAAKV.js"),
      "action-group": () => import("./calcite-action-group-FVEIIC4M.js"),
      "action-pad": () => import("./calcite-action-pad-EKCH7PLW.js"),
      block: () => import("./calcite-block-PSHTVVZX.js"),
      "block-section": () => import("./calcite-block-section-J7UQUUBL.js"),
      button: () => import("./calcite-button-TT4KT5XH.js"),
      checkbox: () => import("./calcite-checkbox-ZPWECFBW.js"),
      "color-picker-swatch": () => import("./calcite-color-picker-swatch-OI72ELYJ.js"),
      combobox: () => import("./calcite-combobox-XTDI5CG6.js"),
      "combobox-item": () => import("./calcite-combobox-item-SJ5IB5U6.js"),
      flow: () => import("./calcite-flow-TTW7IFPM.js"),
      "flow-item": () => import("./calcite-flow-item-4IHVAYF2.js"),
      icon: () => import("./calcite-icon-FE3MORNT.js"),
      "input-number": () => import("./calcite-input-number-OFLJXQWU.js"),
      label: () => import("./calcite-label-NSQ5QQOX.js"),
      list: () => import("./calcite-list-QRFMTME5.js"),
      "list-item": () => import("./calcite-list-item-MF2DTJRA.js"),
      loader: () => import("./calcite-loader-UGV3HF5I.js"),
      notice: () => import("./calcite-notice-56I7IIQT.js"),
      option: () => import("./calcite-option-HXDEP2SV.js"),
      panel: () => import("./calcite-panel-JKWQ43M4.js"),
      popover: () => import("./calcite-popover-24Y2F2AH.js"),
      scrim: () => import("./calcite-scrim-3S5MPANK.js"),
      select: () => import("./calcite-select-VUQDZAVH.js"),
      tab: () => import("./calcite-tab-OPK2LXCV.js"),
      "tab-nav": () => import("./calcite-tab-nav-RTV2M5LC.js"),
      "tab-title": () => import("./calcite-tab-title-TV774K55.js"),
      tabs: () => import("./calcite-tabs-RTIW3OUZ.js"),
      tooltip: () => import("./calcite-tooltip-AYI56I5U.js")
    });
  }
  switchTab(e6) {
    this._activeTab = e6;
  }
  switchToFunctions(e6, t4) {
    this._traceResultsFunctions = e6, this._showTraceResultFunctions = t4;
  }
  switchToAssetGroup(e6, t4, s6) {
    this._traceHeaderForFlow = t4, this._traceResultsAssetGroup = e6, this._showTraceResultAssetGroup = s6;
  }
  switchToAssetType(e6, t4, s6) {
    this._assetGroupHeader = t4, this._traceResultsAssetType = e6, this._showTraceResultAssetType = s6;
  }
  switchToIndividualRecords(e6, t4, s6) {
    this._assetTypeHeader = t4, this._traceResultsIndividual = e6, this._showIndividualRecords = s6;
  }
  _renderUtilityNetworkTrace() {
    const {
      messages: e6,
      messagesCommon: t4
    } = this;
    let s6 = n2("calcite-tabs", {
      layout: "center",
      position: "top",
      styles: f4(this.container)
    }, n2("calcite-tab-nav", {
      slot: "title-group"
    }, n2("calcite-tab-title", {
      onclick: () => {
        this.switchTab("input");
      },
      selected: "input" === this._activeTab
    }, e6.inputsStrings.headerTabInputs), n2("calcite-tab-title", {
      onclick: () => {
        this.switchTab("result");
      },
      selected: "result" === this._activeTab
    }, e6.resultsStrings.headerTabResults)), n2("calcite-tab", {
      selected: "input" === this._activeTab
    }, this._renderInputPanel()), n2("calcite-tab", {
      selected: "result" === this._activeTab
    }, this.viewModel._activeProgress ? n2("calcite-loader", {
      label: e6.alertsStrings.traceExecuting,
      text: e6.alertsStrings.traceExecuting,
      type: "indeterminate"
    }) : this.viewModel.traceResults.length > 0 ? this._renderResultPanel() : this._renderWarningMessage("noTraceExecuted", false), this._confirmReset ? n2("calcite-scrim", {
      key: "prompt"
    }, n2("div", {
      class: _.clearPrompt
    }, n2("h3", {
      slot: "header"
    }, e6.resultsStrings.startOverButton), n2("div", {
      slot: "content"
    }, e6.resultsStrings.startOverValidation), n2("div", {
      class: _.promptDivider
    }), n2("div", {
      styles: S2("row")
    }, n2("calcite-button", {
      appearance: "outline",
      onclick: () => {
        this._confirmReset = false;
      },
      slot: "secondary",
      width: "full"
    }, t4.cancel), n2("calcite-button", {
      onclick: () => {
        this._confirmReset = false, this.viewModel.reset(), this.switchTab("input");
      },
      slot: "primary",
      width: "full"
    }, t4.form.ok)))) : null));
    return 0 === this.viewModel.traces.length && (s6 = n2("calcite-panel", null, this._renderWarningMessage("noTraceConfig", false))), this._loadUNError || (s6 = n2("calcite-panel", null, this._renderWarningMessage("loadUNError", false, this._errorMessage))), s6;
  }
  _renderInputPanel() {
    const {
      messages: e6
    } = this;
    return n2("calcite-flow", {
      class: _.flow
    }, n2("calcite-flow-item", null, this._warningNoFlag ? this._renderWarningMessage("flag", true) : null, this._warningNoTerminal ? this._renderWarningMessage("noTerminal", true) : null, this._warningNoTraceSelected ? this._renderWarningMessage("trace", true) : null, this._renderTraceSelectorContainer(), this._renderStartFlagsContainer(), this._renderBarriersFlagsContainer(), this._warningNoFlag && this._warningNoTraceSelected ? n2("div", {
      styles: w2(10)
    }) : null, n2("calcite-button", {
      kind: "brand",
      onclick: () => {
        this.checkCanTrace();
      },
      slot: "footer",
      width: "full"
    }, e6.tracingStrings.runTrace)), this._selectToolActive ? this._renderActiveTool() : null);
  }
  _renderResultPanel() {
    return n2("calcite-flow", {
      styles: T2()
    }, this._renderTraceResults(), this._showTraceResultFunctions ? this._renderTraceResultFunctions() : null, this._showTraceResultAssetGroup ? this._renderTraceResultByAssetGroup() : null, this._showTraceResultAssetType ? this._renderTraceResultByAssetType() : null, this._showIndividualRecords ? this._renderTraceResultIndividual() : null, this._showIndividualRecords ? this._renderTraceResultIndividualPopover() : null);
  }
  _renderStartFlagsContainer() {
    const {
      messages: e6
    } = this, t4 = [];
    let s6 = [];
    s6 = this.viewModel._flags.filter((e7) => "starting-point" === e7.type), s6.forEach((e7) => {
      e7.displayValue && t4.push(this._renderFlagRow(e7, "start"));
    });
    let i4 = null;
    return this._symbolStartFlag && (i4 = this._getSymbolIcon(this._symbolStartFlag)), n2("calcite-block", {
      collapsible: true,
      heading: e6.inputsStrings.headerStartingPoint + " (" + s6.length + ")",
      open: true,
      overlayPositioning: "fixed"
    }, n2("div", {
      slot: "icon"
    }, i4 || n2("calcite-icon", {
      icon: "pin",
      scale: "s"
    })), n2("div", null, e6.inputsStrings.startingPointHint), n2("div", {
      class: _.listContainer
    }, t4), this._warningNoStartAssetFound ? this._renderWarningMessage("noStartAsset", true) : null, n2("div", {
      class: _.addButtonContainer
    }, n2("calcite-button", {
      alignment: "center",
      appearance: "outline",
      href: "",
      iconStart: "plus",
      label: e6.inputsStrings.addPointOption,
      onclick: () => {
        this._changeCursor("crosshair"), this._flagViewType = "starting-point", this._selectToolActive = true, this._warningNoStartAssetFound = false, this.viewModel.addFlagByHit("starting-point", this._symbolStartFlag).then((e7) => {
          this._changeCursor("default"), e7 ? this._warningNoFlag = false : this._warningNoStartAssetFound = true, this._selectToolActive = false;
        });
      },
      round: true
    })));
  }
  _renderBarriersFlagsContainer() {
    const {
      messages: e6
    } = this, t4 = [];
    let s6 = [];
    s6 = this.viewModel._flags.filter((e7) => "barrier" === e7.type), s6.forEach((e7) => {
      e7.displayValue && t4.push(this._renderFlagRow(e7, "barrier"));
    });
    let i4 = null;
    return this._symbolBarrier && (i4 = this._getSymbolIcon(this._symbolBarrier)), n2("calcite-block", {
      collapsible: true,
      heading: e6.inputsStrings.headerBarrier + " (" + s6.length + ")",
      open: false,
      overlayPositioning: "fixed"
    }, n2("div", {
      slot: "icon"
    }, i4 || n2("calcite-icon", {
      icon: "x-circle-f",
      scale: "s"
    })), n2("div", null, e6.inputsStrings.barrierPointHint), n2("div", {
      class: _.listContainer
    }, t4), this._warningNoBarrierAssetFound ? this._renderWarningMessage("noBarrierAsset", true) : null, n2("div", {
      class: _.addButtonContainer
    }, n2("calcite-button", {
      alignment: "center",
      appearance: "outline",
      href: "",
      iconStart: "plus",
      kind: "brand",
      label: e6.inputsStrings.addPointOption,
      onclick: () => {
        this._changeCursor("crosshair"), this._flagViewType = "barrier", this._selectToolActive = true, this._warningNoBarrierAssetFound = false, this.viewModel.addFlagByHit("barrier", this._symbolBarrier).then((e7) => {
          this._changeCursor("default"), e7 || (this._warningNoBarrierAssetFound = true), this._selectToolActive = false;
        });
      },
      round: true
    })));
  }
  _renderFlagRow(e6, t4) {
    const {
      messages: s6,
      messagesCommon: i4
    } = this, r3 = [];
    let o2 = false;
    return null != e6.allTerminals && e6.allTerminals.terminals.length > 0 && (o2 = true, e6.allTerminals.terminals.forEach((t5) => {
      let s7 = false;
      e6?.selectedTerminals?.includes(t5.id) && (s7 = true), r3.push(n2("calcite-combobox-item", {
        key: t5.name,
        selected: s7,
        textLabel: t5.name,
        value: t5.id
      }));
    })), n2("calcite-block", {
      collapsible: null !== e6.allTerminals || "barrier" === e6.type,
      heading: e6.displayValue?.value ?? "",
      key: "pop" + e6.globalId + e6.type + e6.id + t4,
      overlayPositioning: "fixed"
    }, n2("calcite-action", {
      icon: "trash",
      label: i4.remove,
      onclick: () => {
        this.viewModel.removeFlag(e6);
      },
      scale: "s",
      slot: "header-menu-actions",
      text: i4.remove,
      textEnabled: true
    }), n2("calcite-action", {
      icon: "zoom-to-object",
      label: s6.globalStrings.zoomToFeature,
      onclick: () => {
        this.viewModel.zoomToAsset(e6.details.geometry);
      },
      scale: "s",
      slot: "header-menu-actions",
      text: s6.globalStrings.zoomToFeature,
      textEnabled: true
    }), "barrier" === e6.type ? n2("calcite-label", {
      layout: "inline",
      scale: "s"
    }, n2("calcite-checkbox", {
      checked: e6.isFilterBarrier,
      onclick: () => {
        this.viewModel.manageFilterBarrier(!e6.isFilterBarrier, e6);
      },
      scale: "s"
    }), s6.inputsStrings.barrierFilter) : null, o2 ? n2("calcite-combobox", {
      label: s6.globalStrings.selectTerminalPlaceholder,
      maxItems: 0,
      placeholder: s6.globalStrings.selectTerminalPlaceholder,
      scale: "s",
      selectionMode: "multiple",
      onCalciteComboboxChange: (t5) => {
        t5.target.selectedItems.length > 0 ? (e6.selectedTerminals = [], t5.target.selectedItems.forEach((t6) => {
          this.viewModel.addTerminal(t6.value, e6);
        })) : e6.selectedTerminals = [];
      },
      onCalciteComboboxChipClose: (t5) => {
        t5.preventDefault(), this.viewModel.removeTerminal(t5.target.value, e6);
      }
    }, r3) : null);
  }
  _renderActiveTool() {
    const {
      messages: e6
    } = this;
    let t4 = null;
    return "starting-point" === this._flagViewType ? this._symbolStartFlag && (t4 = this._getSymbolIcon(this._symbolStartFlag)) : this._symbolBarrier && (t4 = this._getSymbolIcon(this._symbolBarrier)), n2("calcite-flow-item", {
      heading: e6.inputsStrings.addPointOption,
      onCalciteFlowItemBack: () => {
        this.viewModel.removeClickHandler(), this.view?.popup && (this.view.popupEnabled = true), this._changeCursor("default"), this._selectToolActive = false;
      }
    }, n2("calcite-block", {
      collapsible: false,
      heading: "",
      open: true,
      overlayPositioning: "fixed"
    }, n2("div", {
      styles: y4()
    }, t4 || n2("calcite-icon", {
      icon: "starting-point" === this._flagViewType ? "pin-plus" : "x-circle-f"
    })), n2("div", {
      styles: y4()
    }, e6.inputsStrings.addPointHint)));
  }
  _renderTraceSelectorContainer() {
    const {
      messages: e6
    } = this, t4 = [];
    let s6 = e6.tracingStrings.traceOperation, i4 = 0;
    return this.viewModel.traces.length > 0 && this.viewModel.traces.forEach((e7) => {
      t4.push(n2("calcite-combobox-item", {
        key: e7.globalId,
        selected: e7.selected,
        textLabel: e7.title,
        value: e7.globalId,
        onCalciteComboboxItemChange: (e8) => {
          const t5 = e8.target;
          this.viewModel.selectTraces(t5.selected, t5.value), this.viewModel.traces.length > 0 && (this._warningNoTraceSelected = false);
        }
      })), e7.selected && i4++;
    }), s6 += ` (${i4})`, n2("calcite-block", {
      collapsible: true,
      heading: s6,
      open: true,
      overlayPositioning: "fixed"
    }, n2("calcite-icon", {
      icon: "utility-network-trace",
      scale: "s",
      slot: "icon"
    }), n2("calcite-combobox", {
      label: e6.inputsStrings.selectTraces,
      maxItems: 0,
      overlayPositioning: "fixed",
      placeholder: e6.inputsStrings.selectTraces,
      scale: "s",
      selectionMode: "multiple"
    }, t4));
  }
  _renderStartOverContainer() {
    const {
      messages: e6
    } = this;
    return n2("calcite-button", {
      kind: "brand",
      onclick: () => {
        this.confirmReset();
      },
      slot: "footer",
      width: "full"
    }, e6.resultsStrings.startOverButton);
  }
  _renderWarningMessage(e6, t4, s6) {
    const {
      messages: i4
    } = this;
    let r3 = i4.alertsStrings.NoRunAlertHeader, o2 = i4.alertsStrings.noResultsInfo;
    switch (e6) {
      case "flag":
        r3 = i4.alertsStrings.startingPointAlertHeader, o2 = i4.alertsStrings.startingPointAlert;
        break;
      case "noTerminal":
        r3 = i4.alertsStrings.noTerminalDefinedHeader, o2 = i4.alertsStrings.noTerminalDefined;
        break;
      case "trace":
        r3 = i4.alertsStrings.selectTraceAlertHeader, o2 = i4.alertsStrings.selectTraceAlert;
        break;
      case "noTraceExecuted":
        r3 = i4.alertsStrings.NoRunAlertHeader, o2 = i4.alertsStrings.noResultsInfo;
        break;
      case "noBarrierAsset":
      case "noStartAsset":
        r3 = i4.alertsStrings.noAssetsFoundHeader, o2 = i4.alertsStrings.noAssetFound;
        break;
      case "noTraceConfig":
        r3 = "", o2 = i4.alertsStrings.noTraceSupported;
        break;
      default:
        r3 = i4.alertsStrings.genericErrorHeader, o2 = s6 || "";
    }
    return n2("div", {
      class: _.noticeContainer,
      key: e6
    }, n2("calcite-notice", {
      closable: t4,
      icon: true,
      key: e6,
      kind: "danger",
      open: true,
      scale: "s",
      width: "auto",
      onCalciteNoticeClose: () => {
        switch (e6) {
          case "flag":
            this._warningNoFlag = false;
            break;
          case "noTerminal":
            this._warningNoTerminal = false;
            break;
          case "trace":
            this._warningNoTraceSelected = false;
            break;
          case "noStartAsset":
            this._warningNoStartAssetFound = false;
            break;
          case "noBarrierAsset":
            this._warningNoBarrierAssetFound = false;
        }
      }
    }, n2("div", {
      slot: "title"
    }, r3), n2("div", {
      slot: "message"
    }, o2)));
  }
  _renderRemoveTraceContainer(e6) {
    const {
      messages: t4
    } = this;
    return n2("calcite-action", {
      icon: "trash",
      label: t4.globalStrings.clearResults,
      onclick: () => {
        this._alertRemoveModal = true, this._activeTrace = e6.trace;
      },
      scale: "s",
      slot: "header-menu-actions",
      text: t4.globalStrings.clearResults,
      textEnabled: true
    });
  }
  _renderHighlightColorPicker(e6, t4, s6) {
    const {
      messages: i4
    } = this, {
      graphicHandler: r3
    } = this.viewModel, o2 = [], l3 = new RegExp(`^${e6.hex}$`, "i"), a4 = r3.highlightColor.length > h3.length ? 5 : 4;
    for (const n7 of r3.highlightColor) o2.push(n2("calcite-action", {
      active: l3.test(n7.hex),
      key: n7.hex,
      label: i4.resultsStrings.graphicColor,
      onclick: () => {
        "aggregate" === s6 ? this.viewModel.changeResultGraphicColor(n7, t4) : this.viewModel.changeResultAreaColor(t4, n7);
      },
      scale: "s",
      text: i4.resultsStrings.graphicColor
    }, n2("calcite-color-picker-swatch", {
      active: l3.test(n7.hex),
      color: n7.hex,
      scale: "s"
    })));
    return n2("calcite-action-pad", {
      expandDisabled: true,
      layout: "grid",
      position: "start"
    }, n2("calcite-action-group", {
      columns: a4,
      layout: "grid"
    }, o2));
  }
  _renderTraceResults() {
    const {
      messages: e6,
      messagesCommon: t4
    } = this, {
      selectFeatures: s6
    } = e6.resultsStrings, i4 = this.viewModel.traceResults, r3 = [];
    return i4.forEach((t5, i5) => {
      let o2 = [], l3 = [], a4 = false, n7 = false, c2 = false, d4 = "";
      null !== t5.results && t5.results.hasOwnProperty("elements") ? (null !== t5.results.aggregatedGeometry && (n7 = true), null !== t5.results.globalFunctionResults && t5.results.globalFunctionResults.length > 0 && (l3 = t5.results.globalFunctionResults, l3.length > 0 && (c2 = true)), t5.results.elements && t5.results.elements.length > 0 && (o2 = t5.results.elements, o2.length > 0 && (a4 = true)), (n7 || a4) && (d4 = this.messagesUnits.units[t5.resultArea?.unit]?.abbr), r3.push(n2("calcite-block", {
        collapsible: true,
        description: t5.trace.description ?? "",
        heading: t5.trace.title,
        key: `${t5.trace.title}${i5}`,
        open: true,
        overlayPositioning: "fixed"
      }, this._renderRemoveTraceContainer(t5), n2("calcite-list", null, c2 ? n2("calcite-list-item", {
        label: e6.resultsStrings.functionHeader + " (" + l3.length + ")",
        onCalciteListItemSelect: () => {
          this.switchToFunctions(l3, true);
        }
      }, n2("calcite-icon", {
        icon: "chevron-right",
        scale: "s",
        slot: "content-end"
      })) : null, a4 && this.viewModel.showSelectionAttributes ? n2("calcite-list-item", {
        key: this.id,
        label: e6.resultsStrings.viewFeatures + " (" + o2.length + ")",
        onCalciteListItemSelect: () => {
          this.switchToAssetGroup(this._groupResultsByAssetGroup(t5), t5.trace.title + " (" + o2.length + ")", true);
        }
      }, n2("calcite-icon", {
        icon: "chevron-right",
        scale: "s",
        slot: "content-end"
      })) : this.viewModel.showSelectionAttributes ? n2("calcite-label", {
        layout: "inline",
        scale: "s"
      }, e6.resultsStrings.noSelectionResults) : null), a4 ? n2("div", {
        class: _.paddingTop
      }, n2("calcite-label", {
        layout: "inline",
        onclick: (e7) => {
          e7.preventDefault(), e7.stopPropagation(), this.viewModel.mergeSelection(!t5.selectionEnabled, t5.trace);
        },
        scale: "s"
      }, n2("calcite-checkbox", {
        checked: t5.selectionEnabled,
        onclick: (e7) => {
          e7.preventDefault(), e7.stopPropagation(), this.viewModel.mergeSelection(!t5.selectionEnabled, t5.trace);
        }
      }), this.viewModel.showSelectionAttributes ? s6 : `${s6} (${o2.length})`)) : null, n7 ? n2("calcite-block-section", {
        key: `aggregate-${t5.trace.title}-${i5}`,
        open: t5.graphicEnabled,
        text: e6.resultsStrings.highlightTrace,
        toggleDisplay: "switch",
        onCalciteBlockSectionToggle: (e7) => {
          e7.target.open ? this.viewModel.changeResultGraphicColor(t5.graphicColor, t5) : this.viewModel.removeResultGraphicFromView(t5);
        }
      }, n2("calcite-list", {
        selectionMode: "none"
      }, n2("calcite-list-item", {
        label: e6.resultsStrings.graphicColor,
        onclick: (e7) => {
          const t6 = e7.target;
          this._swatchNode = t6, this._activeSwatch = "aggGeom_" + i5;
        }
      }, n2("calcite-color-picker-swatch", {
        color: t5.graphicColor.hex,
        scale: "s",
        slot: "actions-end"
      })))) : null, this.enableResultArea && (n7 || a4) ? n2("calcite-block-section", {
        key: `area-${t5.trace.title}-${i5}`,
        open: t5.resultArea?.show,
        text: e6.resultsStrings.resultAreaHeader,
        toggleDisplay: "switch",
        onCalciteBlockSectionToggle: (e7) => {
          e7.target.open ? t5.resultAreaGraphic ? this.viewModel.addResultAreaToMap(t5, t5.resultAreaGraphic) : this.viewModel.addResultAreaToMap(t5) : this.viewModel.removeResultAreaFromMap(t5);
        }
      }, n2("calcite-list", {
        selectionMode: "none"
      }, n2("calcite-list-item", {
        label: e6.resultsStrings.graphicColor,
        onclick: (e7) => {
          const t6 = e7.target;
          this._swatchNode = t6, this._activeSwatch = "resultArea_" + i5;
        }
      }, n2("calcite-color-picker-swatch", {
        color: t5.resultArea?.color.hex,
        scale: "s",
        slot: "actions-end"
      }))), n2("calcite-list", {
        selectionMode: "none"
      }, n2("calcite-list-item", {
        label: e6.resultsStrings.resultAreaBuffer
      }, n2("calcite-input-number", {
        afterCreate: this._afterComponentCreate,
        class: _.numberInput,
        max: 999999,
        maxLength: 999999,
        min: 0,
        scale: "s",
        slot: "actions-end",
        suffixText: d4,
        value: t5.resultArea?.distance.toString(),
        onCalciteInputNumberChange: (e7) => {
          if (!this.view?.popup) return;
          this.view.popup.visible && this.view.closePopup();
          const s7 = e7.target;
          t5.resultArea.distance >= 0 ? (t5.resultArea.distance = parseInt(s7.value, 10), this.viewModel.removeResultAreaFromMap(t5), this.viewModel.addResultAreaToMap(t5)) : (t5.resultArea.distance = 0, this.viewModel.removeResultAreaFromMap(t5), this.viewModel.addResultAreaToMap(t5));
        }
      })))) : null, n2("calcite-popover", {
        autoClose: true,
        closable: true,
        label: e6.resultsStrings.graphicColor,
        offsetDistance: 0,
        offsetSkidding: 0,
        open: this._activeSwatch === "aggGeom_" + i5 || this._activeSwatch === "resultArea_" + i5,
        placement: "auto-start",
        referenceElement: this._swatchNode,
        scale: "s",
        onCalcitePopoverClose: () => {
          this._swatchNode = null, this._activeSwatch = null;
        }
      }, this._renderHighlightColorPicker(this._activeSwatch === "resultArea_" + i5 ? t5.resultArea?.color : t5.graphicColor, t5, this._activeSwatch === "resultArea_" + i5 ? "resultArea" : "aggregate"))))) : r3.push(n2("calcite-block", {
        collapsible: false,
        heading: t5.trace.title,
        key: "error-" + i5,
        open: true,
        overlayPositioning: "fixed"
      }, this._renderRemoveTraceContainer(t5), this._renderWarningMessage("noController", false, t5.status)));
    }), n2("calcite-flow-item", {
      key: "traceResults",
      styles: T2()
    }, r3, this._renderStartOverContainer(), this._alertRemoveModal ? n2("calcite-scrim", {
      key: "prompt"
    }, n2("div", {
      class: _.clearPrompt
    }, n2("h3", {
      slot: "header"
    }, e6.globalStrings.clearResults), n2("div", {
      slot: "content"
    }, e6.alertsStrings.clearResultsAlert), n2("div", {
      class: _.promptDivider
    }), n2("div", {
      styles: S2("row")
    }, n2("calcite-button", {
      appearance: "outline",
      onclick: () => {
        this._alertRemoveModal = false;
      },
      slot: "secondary",
      width: "full"
    }, t4.cancel), n2("calcite-button", {
      onclick: () => {
        this._activeTrace && this.viewModel.clearResult(this._activeTrace), this._alertRemoveModal = false, 0 === this.viewModel.traceResults.length ? this.switchTab("input") : (this._activeTrace = this.viewModel.traceResults[0].trace, this._showTraceResultFunctions = false, this._showTraceResultAssetGroup = false, this._showTraceResultAssetType = false, this._showIndividualRecords = false);
      },
      slot: "primary",
      width: "full"
    }, t4.form.ok)))) : null);
  }
  _renderTraceResultFunctions() {
    const {
      messages: e6
    } = this, t4 = this._traceResultsFunctions, s6 = [];
    return t4.forEach((e7) => {
      s6.push(this._renderResultRowFunctions(e7));
    }), n2("calcite-flow-item", {
      heading: e6.resultsStrings.functionHeader,
      key: "functionResultMultiple",
      onCalciteFlowItemBack: () => {
        this.switchToFunctions([], false);
      }
    }, s6, this._renderStartOverContainer());
  }
  _renderTraceResultByAssetGroup() {
    const e6 = this._traceResultsAssetGroup, t4 = [];
    for (const s6 in e6) {
      const i4 = e6[s6];
      for (const e7 in i4) t4.push(this._renderResultRowAssetGroup(i4[e7]));
    }
    return n2("calcite-flow-item", {
      heading: this._traceHeaderForFlow,
      key: "assetGroupResultMultiple",
      onCalciteFlowItemBack: () => {
        this.switchToAssetGroup([], "", false);
      }
    }, n2("calcite-list", null, t4), this._renderStartOverContainer());
  }
  _renderTraceResultByAssetType() {
    const e6 = this._traceResultsAssetType, t4 = [];
    for (const s6 in e6) e6[s6].length > 0 && t4.push(this._renderResultRowAssetType(e6[s6]));
    return n2("calcite-flow-item", {
      heading: this._assetGroupHeader,
      key: "assetTypeResult",
      onCalciteFlowItemBack: () => {
        this.switchToAssetType([], "", false);
      }
    }, n2("calcite-list", {
      selectionMode: "none"
    }, t4), this._renderStartOverContainer());
  }
  _renderTraceResultIndividual() {
    const {
      messages: e6
    } = this, t4 = this._traceResultsIndividual;
    t4.sort(this._compare(this._resultSortField, this._resultSortOrder));
    const s6 = [];
    if (t4.length > 0) {
      (t4[0].details?.fields.some(({
        name: e7
      }) => e7.toLowerCase() === this._resultDisplayField.toLocaleLowerCase()) ?? false) || (this._resultDisplayField = this._resultObjectIdField, this._resultSortField = this._resultObjectIdField), t4.forEach((e7) => {
        e7?.details && s6.push(this._renderResultRowIndividual(e7));
      }), 0 === s6.length && s6.push(n2("calcite-list-item", {
        label: e6.resultsStrings.noFeaturesInMap
      }));
    }
    return n2("calcite-flow-item", {
      heading: this._assetTypeHeader,
      key: "individualResult",
      onCalciteFlowItemBack: () => {
        this._showResultOptions = false, this.switchToIndividualRecords([], "", false);
      }
    }, n2("calcite-action", {
      afterCreate: b,
      bind: this,
      "data-node-ref": "_individualResultNode",
      icon: "gear",
      id: "field_options" + this.id,
      label: e6.resultsStrings.displayAttribute,
      onclick: () => {
        this._showResultOptions = true;
      },
      slot: "header-actions-end",
      text: e6.resultsStrings.displayAttribute
    }), n2("calcite-list", {
      selectionMode: "none"
    }, s6), this._renderStartOverContainer());
  }
  _renderTraceResultIndividualPopover() {
    const {
      messages: e6
    } = this, t4 = this._traceResultsIndividual, s6 = [], i4 = [];
    return t4.length > 0 && (t4[0].details ? t4[0].details.fields.forEach(({
      name: e7,
      alias: t5
    }) => {
      s6.push(n2("calcite-option", {
        key: `display-${e7}`,
        label: t5 ?? e7,
        selected: e7 === this._resultDisplayField,
        value: e7
      })), i4.push(n2("calcite-option", {
        key: `sort-${e7}`,
        label: t5 ?? e7,
        selected: e7 === this._resultSortField,
        value: e7
      }));
    }) : (s6.push(n2("calcite-option", {
      key: `display-${this._resultDisplayField}`,
      label: this._resultDisplayField,
      value: this._resultDisplayField
    })), i4.push(n2("calcite-option", {
      key: `sort-${this._resultDisplayField}`,
      label: this._resultDisplayField,
      value: this._resultDisplayField
    })))), n2("calcite-popover", {
      autoClose: true,
      label: e6.resultsStrings.displayAttribute,
      offsetDistance: 0,
      offsetSkidding: 0,
      open: this._showResultOptions,
      overlayPositioning: "fixed",
      placement: "left-start",
      referenceElement: this._individualResultNode,
      styles: null !== this.domNode ? v(0.75 * this.domNode.clientWidth) : b3()
    }, n2("calcite-block", {
      heading: "",
      open: true,
      overlayPositioning: "fixed"
    }, n2("calcite-label", {
      scale: "s"
    }, e6.resultsStrings.displayAttribute, n2("calcite-select", {
      label: e6.resultsStrings.displayAttribute,
      scale: "s",
      onCalciteSelectChange: (e7) => {
        const t5 = e7.target;
        this._resultDisplayField = t5.selectedOption.value, this._showResultOptions = false;
      }
    }, s6)), n2("calcite-label", {
      scale: "s"
    }, e6.resultsStrings.sortBy, n2("calcite-select", {
      label: e6.resultsStrings.sortBy,
      scale: "s",
      onCalciteSelectChange: (e7) => {
        const s7 = e7.target;
        this._resultSortField = s7.selectedOption.value, t4.sort(this._compare(this._resultSortField, this._resultSortOrder)), this._traceResultsIndividual = t4, this._showResultOptions = false;
      }
    }, i4))));
  }
  _renderResultRowFunctions(e6) {
    return n2("calcite-block", {
      collapsible: false,
      heading: e6.networkAttributeName + " " + e6.functionType + " = " + e6.result,
      overlayPositioning: "fixed"
    });
  }
  _renderResultRowAssetGroup(e6) {
    const t4 = this._getAssetGroupName(e6[0]);
    return n2("calcite-list-item", {
      label: t4 + " (" + e6.length + ")",
      onCalciteListItemSelect: () => {
        this.switchToAssetType(this._groupResultsByAssetType(e6), t4 + " (" + e6.length + ")", true);
      }
    }, n2("calcite-icon", {
      icon: "chevron-right",
      scale: "s",
      slot: "content-end"
    }));
  }
  _renderResultRowAssetType(e6) {
    const t4 = this._getAssetTypeName(e6[0]);
    return n2("calcite-list-item", {
      label: t4 + " (" + e6.length + ")",
      onCalciteListItemSelect: () => {
        this.viewModel.queryFeaturesById(e6).then((s6) => {
          if (s6?.length) {
            this._resultObjectIdField = s6[0].layer.objectIdField, "objectid" === this._resultDisplayField && (this._resultDisplayField = s6[0].layer.objectIdField), "objectid" === this._resultSortField && (this._resultSortField = s6[0].layer.objectIdField);
            const i4 = this._appendAttributes(e6, s6, "objectId");
            this.switchToIndividualRecords(i4, t4 + " (" + e6.length + ")", true);
          } else this.switchToIndividualRecords(e6, t4 + " (" + e6.length + ")", true);
        });
      }
    }, n2("calcite-icon", {
      icon: "chevron-right",
      scale: "s",
      slot: "content-end"
    }));
  }
  _renderResultRowIndividual(e6) {
    const {
      messages: t4
    } = this, s6 = `display-${e6.objectId}-nso`, {
      nonSpatialObject: i4,
      zoomToFeature: r3
    } = t4.globalStrings;
    let o2 = "", l3 = null;
    if (l3 = e6?.details?.fields.find(({
      name: e7
    }) => e7 === this._resultDisplayField), "date" === l3?.type) {
      o2 = new Date(e6.details.attributes[this._resultDisplayField]).toDateString();
    } else if ("assetgroup" === this._resultDisplayField.toLowerCase()) o2 = this._getAssetGroupName(e6);
    else if ("assettype" === this._resultDisplayField.toLowerCase()) o2 = this._getAssetTypeName(e6);
    else if (l3?.domain && R2(l3.domain)) {
      const t5 = l3.domain.codedValues.find(({
        code: t6
      }) => t6 === e6.details.attributes[this._resultDisplayField]);
      o2 = t5?.name;
    } else o2 = e6.details?.attributes[this._resultDisplayField] ?? e6.objectId;
    return o2 && "" !== o2 && null !== o2 ? "string" == typeof o2 && (o2.trim() || (o2 = t4.resultsStrings.noValue)) : o2 = t4.resultsStrings.noValue, null !== e6?.details?.geometry ? n2("calcite-list-item", {
      label: o2,
      onCalciteListItemSelect: () => {
        this.viewModel.zoomToAsset(e6.details.geometry);
      }
    }, n2("calcite-icon", {
      icon: "zoom-to-object",
      scale: "s",
      slot: "content-end",
      textLabel: r3
    })) : n2("calcite-list-item", {
      label: o2
    }, n2("calcite-icon", {
      icon: "table",
      id: s6,
      scale: "s",
      slot: "content-end",
      textLabel: i4
    }), n2("calcite-tooltip", {
      label: i4,
      referenceElement: s6
    }, n2("span", null, i4)));
  }
  _afterComponentCreate(e6) {
    "value" in e6 && null != e6.value && "setNumberValue" in e6 && e6.setNumberValue({
      committing: false,
      value: e6.value,
      origin: "direct"
    });
  }
  _mixCustomStrings() {
    const {
      messages: e6
    } = this;
    this.inputSettings.length > 0 && this.inputSettings.forEach((t4) => {
      "starting-point" === t4.type && (e6.inputsStrings.headerStartingPoint = t4.label, e6.inputsStrings.startingPointHint = t4.description), "barrier" === t4.type && (e6.inputsStrings.headerBarrier = t4.label, e6.inputsStrings.barrierPointHint = t4.description);
    });
  }
  _overrideFlagSymbol() {
    this.inputSettings.length > 0 && this.inputSettings.forEach((e6) => {
      "starting-point" === e6.type ? this._symbolStartFlag = e6.symbol : this._symbolBarrier = e6.symbol, this.viewModel.changeFlagSymbol(e6.type, e6.symbol);
    });
  }
  _utilityNetworkTraceInitialized() {
    return this.viewModel.loadUtilityNetwork().then((e6) => {
      if (e6) return this.viewModel.selectTracesOnLoad(), this._registerWatchers(), this.viewModel.flags.length > 0 && this._processFlagOnLoad(), this.view?.when().then(() => {
        this._watchViewState();
      });
      this.disabled = false;
    }).catch((e6) => {
      const {
        messages: t4
      } = this;
      this._loadUNError = false, "utility-network:no-user-type-extension" === e6.name || e6.details.raw.extendedCode === C3.noExtension ? this._errorMessage = t4.alertsStrings.noUserExtension : this._errorMessage = e6.message, this.disabled = false;
    });
  }
  _processFlagOnLoad() {
    return this.view?.when().then(() => {
      this._watchHandler = p(() => !this.view?.updating, () => __async(this, null, function* () {
        this._warningNoFlag = false, this._warningNoBarrierAssetFound = false, this._warningNoStartAssetFound = false;
        const e6 = yield this.viewModel.addFlagsOnLoad();
        this.viewModel.removeFlagsOnLoadWatcher(), e6.includes("barrier") && (this._warningNoBarrierAssetFound = true), e6.includes("starting-point") && (this._warningNoStartAssetFound = true), this.disabled = false, null !== this._watchHandler && this._watchHandler.remove();
      }));
    });
  }
  _registerWatchers() {
    this.addHandles([d(() => this.selectedTraces, () => {
      this.viewModel.selectTracesOnLoad(), this.scheduleRender();
    }), d(() => this.defaultGraphicColor, () => {
      this.viewModel.traceResults.length > 0 && this.viewModel.traceResults.forEach((e6) => {
        this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor, e6);
      }), this.scheduleRender();
    })]);
  }
  _groupResultsByAssetGroup(e6) {
    const t4 = [], s6 = e6.results?.elements, i4 = this._groupBy(s6 ?? [], "networkSourceId");
    for (const r3 in i4) t4.push(this._groupBy(i4[r3], "assetGroupCode"));
    return t4;
  }
  _groupResultsByAssetType(e6) {
    return this._groupBy(e6, "assetTypeCode");
  }
  _appendAttributes(e6, t4, s6) {
    const i4 = [];
    return e6.forEach((e7) => {
      t4.forEach((t5) => {
        t5.featureSet.features.forEach((r3) => {
          e7[s6] === r3.attributes[this._resultObjectIdField] && (e7.details = r3, e7.details.fields = t5.featureSet.fields, i4.push(e7));
        });
      });
    }), i4;
  }
  _getAssetGroupName(e6) {
    let t4 = e6.assetGroupCode.toString();
    const s6 = e6.assetGroupCode, i4 = this.viewModel.getValidSources().find((t5) => t5.sourceId === e6.networkSourceId);
    if (i4) {
      const e7 = i4.assetGroups.find((e8) => e8.assetGroupCode === s6);
      e7 && (t4 = e7.assetGroupName);
    }
    return t4;
  }
  _getAssetTypeName(e6) {
    let t4 = e6.assetTypeCode.toString();
    const s6 = e6.assetGroupCode, i4 = this.viewModel.getValidSources().find((t5) => t5.sourceId === e6.networkSourceId);
    if (i4) {
      const r3 = i4.assetGroups.find((e7) => e7.assetGroupCode === s6);
      if (r3) {
        const s7 = r3.assetTypes.find((t5) => t5.assetTypeCode === e6.assetTypeCode);
        s7 && (t4 = s7.assetTypeName);
      }
    }
    return t4;
  }
  _compare(e6, t4) {
    return (s6, i4) => {
      let r3 = 0, o2 = s6.details?.attributes[e6] ?? s6.objectId, l3 = i4.details?.attributes[e6] ?? i4.objectId;
      return isNaN(o2) && (o2 = o2.toLowerCase()), isNaN(l3) && (l3 = l3.toLowerCase()), "desc" === t4 ? o2 > l3 ? r3 = 1 : o2 < l3 && (r3 = -1) : o2 < l3 ? r3 = 1 : o2 > l3 && (r3 = -1), r3;
    };
  }
  _groupBy(e6, t4) {
    return e6.reduce((e7, s6) => ((e7[s6[t4]] = e7[s6[t4]] || []).push(s6), e7), {});
  }
  _getSymbolIcon(e6) {
    return "picture-marker" === e6.type ? n2("img", {
      height: e6.height,
      src: e6.url ?? void 0,
      width: e6.width
    }) : null;
  }
  _watchViewState() {
    this._watchHandler = p(() => !this.view?.updating, () => {
      this.disabled = false, null !== this._watchHandler && this._watchHandler.remove();
    }, {
      initial: true
    });
  }
  _changeCursor(e6 = "default") {
    const t4 = this.view?.container?.style;
    t4 && (t4.cursor = e6);
  }
};
e([y()], A.prototype, "_selectToolActive", void 0), e([y()], A.prototype, "_activeTrace", void 0), e([y()], A.prototype, "_activeSwatch", void 0), e([y()], A.prototype, "_traceHeaderForFlow", void 0), e([y()], A.prototype, "_assetGroupHeader", void 0), e([y()], A.prototype, "_assetTypeHeader", void 0), e([y()], A.prototype, "_traceResultsFunctions", void 0), e([y()], A.prototype, "_traceResultsAssetGroup", void 0), e([y()], A.prototype, "_traceResultsAssetType", void 0), e([y()], A.prototype, "_traceResultsIndividual", void 0), e([y()], A.prototype, "_showTraceResultFunctions", void 0), e([y()], A.prototype, "_showTraceResultAssetGroup", void 0), e([y()], A.prototype, "_showTraceResultAssetType", void 0), e([y()], A.prototype, "_showIndividualRecords", void 0), e([y()], A.prototype, "_activeTab", void 0), e([y()], A.prototype, "_alertRemoveModal", void 0), e([y()], A.prototype, "_warningNoFlag", void 0), e([y()], A.prototype, "_warningNoTraceSelected", void 0), e([y()], A.prototype, "_confirmReset", void 0), e([y()], A.prototype, "_swatchNode", void 0), e([y()], A.prototype, "_errorMessage", void 0), e([y()], A.prototype, "defaultGraphicColor", null), e([y()], A.prototype, "disabled", void 0), e([y()], A.prototype, "flags", null), e([y()], A.prototype, "gdbVersion", null), e([y()], A.prototype, "icon", null), e([y()], A.prototype, "inputSettings", void 0), e([y()], A.prototype, "label", null), e([y(), e2("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")], A.prototype, "messages", void 0), e([y(), e2("esri/t9n/common")], A.prototype, "messagesCommon", void 0), e([y(), e2("esri/core/t9n/Units")], A.prototype, "messagesUnits", void 0), e([y()], A.prototype, "resultAreaProperties", null), e([y()], A.prototype, "selectedTraces", null), e([y()], A.prototype, "selectOnComplete", null), e([y()], A.prototype, "showGraphicsOnComplete", null), e([y()], A.prototype, "enableResultArea", null), e([y()], A.prototype, "showSelectionAttributes", null), e([y()], A.prototype, "utilityNetwork", null), e([y()], A.prototype, "view", null), e([e4(["add-flag", "add-flag-complete", "add-flag-error", "select-features", "clear-selection", "add-result-area", "remove-result-area", "create-result-area"]), y({
  type: M
})], A.prototype, "viewModel", void 0), A = e([a("esri.widgets.UtilityNetworkTrace")], A);
var F = A;
export {
  F as default
};
//# sourceMappingURL=UtilityNetworkTrace-BLLOHPZY.js.map
