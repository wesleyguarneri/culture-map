{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/webdoc/support/resourceUtils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport { allSettledErrors as t, throwIfAborted as r, eachAlways as o } from \"../../core/promiseUtils.js\";\nimport { generateUUID as s } from \"../../core/uuid.js\";\nimport { getSiblingOfSameTypeI as a, contentToBlob as c } from \"../../portal/support/resourceUtils.js\";\nasync function p(e, t, r) {\n  const o = await u(e, t, r);\n  await h(o, t, r);\n}\nasync function n(e, t, r, o, s) {\n  const a = await u(r, o, s);\n  await e.update({\n    data: t\n  }), await h(a, o, s);\n}\nasync function u(o, p, n) {\n  if (!p?.resources) return;\n  const u = p.portalItem === o.portalItem ? new Set(o.paths) : new Set();\n  o.paths.length = 0, o.portalItem = p.portalItem;\n  const h = new Set(p.resources.toKeep.map(e => e.resource.path)),\n    i = new Set(),\n    m = [];\n  h.forEach(e => {\n    u.delete(e), o.paths.push(e);\n  });\n  const f = [],\n    l = [],\n    w = [];\n  for (const e of p.resources.toUpdate) if (u.delete(e.resource.path), h.has(e.resource.path) || i.has(e.resource.path)) {\n    const {\n        resource: t,\n        content: r,\n        finish: p\n      } = e,\n      n = a(t, s());\n    o.paths.push(n.path), f.push({\n      resource: n,\n      content: await c(r),\n      compress: e.compress\n    }), p && w.push(() => p(n));\n  } else {\n    o.paths.push(e.resource.path), l.push({\n      resource: e.resource,\n      content: await c(e.content),\n      compress: e.compress\n    });\n    const t = e.finish;\n    t && w.push(() => t(e.resource)), i.add(e.resource.path);\n  }\n  for (const e of p.resources.toAdd) if (o.paths.push(e.resource.path), u.has(e.resource.path)) u.delete(e.resource.path);else {\n    f.push({\n      resource: e.resource,\n      content: await c(e.content),\n      compress: e.compress\n    });\n    const t = e.finish;\n    t && w.push(() => t(e.resource));\n  }\n  if (f.length || l.length) {\n    const {\n      addOrUpdateResources: e\n    } = await import(\"../../portal/support/resourceUtils.js\");\n    await e(p.portalItem, f, \"add\", n), await e(p.portalItem, l, \"update\", n);\n  }\n  if (w.forEach(e => e()), 0 === m.length) return u;\n  const d = await t(m);\n  if (r(n), d.length > 0) throw new e(\"save:resources\", \"Failed to save one or more resources\", {\n    errors: d\n  });\n  return u;\n}\nasync function h(e, t, r) {\n  if (!e || !t.portalItem) return;\n  const s = [];\n  for (const o of e) {\n    const e = t.portalItem.resourceFromPath(o);\n    s.push(e.portalItem.removeResource(e, r));\n  }\n  await o(s);\n}\nexport { p as saveResources, n as updateItemWithResources };"],
  "mappings": "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",
  "names": ["p", "n", "s", "u", "h", "m", "e"]
}
