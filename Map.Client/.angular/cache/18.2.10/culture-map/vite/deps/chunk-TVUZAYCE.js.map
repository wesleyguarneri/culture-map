{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/support/QueueProcessor.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport \"../../core/has.js\";\nimport { removeMaybe as e } from \"../../core/maybe.js\";\nimport { onAbort as s, onAbortOrThrow as t, createResolver as r, createAbortError as i, isPromiseLike as o } from \"../../core/promiseUtils.js\";\nimport h from \"../../core/Queue.js\";\nimport c from \"../../core/ReactiveMap.js\";\nimport { schedule as n } from \"../../core/scheduling.js\";\nimport { signal as u } from \"../../core/signal.js\";\nclass l {\n  constructor(e, s) {\n    this.item = e, this.controller = s, this.promise = null;\n  }\n}\nclass _ {\n  constructor(e) {\n    this._schedule = null, this._task = null, this._deferreds = new c(), this._controllers = new c(), this._processingItems = new c(), this._pausedSignal = u(!1), this.concurrency = 1, e.concurrency && (this.concurrency = e.concurrency), this._queue = new h(e.peeker), this.process = e.process;\n    const s = e.scheduler;\n    e.priority && s && (this._task = s.registerTask(e.priority, this));\n  }\n  destroy() {\n    this.clear(), this._schedule = e(this._schedule), this._task = e(this._task);\n  }\n  get updating() {\n    return !!this._task?.updating || this.running;\n  }\n  get length() {\n    return this._processingItems.size + this._queue.length;\n  }\n  abort(e) {\n    const s = this._controllers.get(e);\n    s && s.abort();\n  }\n  clear() {\n    this._queue.clear();\n    const e = [];\n    this._controllers.forEach(s => e.push(s)), this._controllers.clear(), e.forEach(e => e.abort()), this._processingItems.clear(), this._cancelNext();\n  }\n  forEach(e) {\n    this._deferreds.forEach((s, t) => e(t));\n  }\n  get(e) {\n    const s = this._deferreds.get(e);\n    return s ? s.promise : void 0;\n  }\n  isOngoing(e) {\n    return this._processingItems.has(e);\n  }\n  has(e) {\n    return this._deferreds.has(e);\n  }\n  pause() {\n    this._pausedSignal.value || (this._pausedSignal.value = !0, this._cancelNext());\n  }\n  push(e, o) {\n    const h = this.get(e);\n    if (h) return h;\n    const c = new AbortController();\n    let n = null;\n    o && (n = s(o, () => c.abort()));\n    const u = () => {\n        const s = this._processingItems.get(e);\n        s && s.controller.abort(), l(), a.reject(i());\n      },\n      l = () => {\n        _.remove(), null != n && n.remove(), this._removeItem(e), this._queue.remove(e), this._scheduleNext();\n      },\n      _ = t(c.signal, u),\n      a = r();\n    return this._deferreds.set(e, a), this._controllers.set(e, c), a.promise.then(l, l), this._queue.push(e), this._scheduleNext(), a.promise;\n  }\n  last() {\n    return this._queue.last();\n  }\n  lastPromise() {\n    const e = this.last();\n    return e ? this.get(e) : null;\n  }\n  peek() {\n    return this._queue.peek();\n  }\n  popLast() {\n    const e = this._queue.popLast();\n    return e && (this._deferreds.get(e)?.reject(i(\"Removed from queue\")), this._removeItem(e)), e;\n  }\n  reset() {\n    const e = [];\n    this._processingItems.forEach(s => e.push(s)), this._processingItems.clear();\n    for (const s of e) this._queue.push(s.item), s.controller.abort();\n    this._scheduleNext();\n  }\n  resume() {\n    this._pausedSignal.value && (this._pausedSignal.value = !1, this._scheduleNext());\n  }\n  takeAll() {\n    const e = [];\n    for (; this._queue.length;) e.push(this._queue.pop());\n    return this.clear(), e;\n  }\n  get running() {\n    return !this._pausedSignal.value && this._queue.length > 0 && this._processingItems.size < this.concurrency;\n  }\n  runTask(e) {\n    for (; !e.done && this._queue.length > 0 && this._processingItems.size < this.concurrency;) this._process(this._queue.pop()), e.madeProgress();\n  }\n  _removeItem(e) {\n    this._deferreds.delete(e), this._controllers.delete(e), this._processingItems.delete(e);\n  }\n  _scheduleNext() {\n    this._task || this._pausedSignal.value || this._schedule || (this._schedule = n(() => {\n      this._schedule = null, this._next();\n    }));\n  }\n  _next() {\n    for (; this._queue.length > 0 && this._processingItems.size < this.concurrency;) this._process(this._queue.pop());\n  }\n  _cancelNext() {\n    this._schedule && (this._schedule.remove(), this._schedule = null);\n  }\n  _processResult(e, s) {\n    this._canProcessFulfillment(e) && (this._scheduleNext(), this._deferreds.get(e.item).resolve(s));\n  }\n  _processError(e, s) {\n    this._canProcessFulfillment(e) && (this._scheduleNext(), this._deferreds.get(e.item).reject(s));\n  }\n  _canProcessFulfillment(e) {\n    return !!this._deferreds.get(e.item) && this._processingItems.get(e.item) === e;\n  }\n  _process(e) {\n    if (null == e) return;\n    let s;\n    const t = new AbortController(),\n      r = new l(e, t);\n    this._processingItems.set(e, r);\n    try {\n      s = this.process(e, t.signal);\n    } catch (i) {\n      this._processError(r, i);\n    }\n    o(s) ? (r.promise = s, s.then(e => this._processResult(r, e), e => this._processError(r, e))) : this._processResult(r, s);\n  }\n  get test() {}\n}\nexport { _ as QueueProcessor };"],
  "mappings": "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",
  "names": ["l", "s", "e", "u", "_", "r"]
}
