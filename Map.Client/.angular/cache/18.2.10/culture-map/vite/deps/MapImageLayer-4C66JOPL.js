import {
  y as y2
} from "./chunk-AYHKFOHI.js";
import "./chunk-5NCKEQLF.js";
import {
  i as i2
} from "./chunk-ATQ5GYTB.js";
import {
  f as f3,
  m,
  te
} from "./chunk-GV6RIISH.js";
import {
  e as e4
} from "./chunk-TF6BJDRY.js";
import "./chunk-UIPFLVUA.js";
import "./chunk-DBVSL4LU.js";
import "./chunk-TXBBE7ID.js";
import "./chunk-BB54E5CP.js";
import "./chunk-WBUJP5OW.js";
import "./chunk-ZQ57XGAE.js";
import "./chunk-UXW277HY.js";
import "./chunk-OR5F5ACQ.js";
import "./chunk-E2WAKNLZ.js";
import "./chunk-C7NRYPDG.js";
import "./chunk-Z3GMSC63.js";
import "./chunk-F35MWZH7.js";
import "./chunk-ED7UGR2X.js";
import "./chunk-YA5CTHMT.js";
import "./chunk-4QBFFLOC.js";
import "./chunk-O437BSYE.js";
import "./chunk-YZNT6QWD.js";
import "./chunk-2C54H6O6.js";
import "./chunk-UHMXQYZT.js";
import "./chunk-LZUPV7SL.js";
import "./chunk-2GRLWAHK.js";
import {
  t as t4
} from "./chunk-C3UDKWXD.js";
import {
  i
} from "./chunk-YTFX4PFO.js";
import {
  l as l2
} from "./chunk-DSMB46HB.js";
import "./chunk-BPMRTFHU.js";
import "./chunk-6LDLRQX4.js";
import {
  l as l3
} from "./chunk-Z4YAQ5JI.js";
import "./chunk-K2XCQKCC.js";
import "./chunk-AJS4B62I.js";
import "./chunk-S5EXT7FA.js";
import {
  e as e3
} from "./chunk-73Y7XDLH.js";
import "./chunk-YFOAET4H.js";
import "./chunk-5U4TBXYS.js";
import "./chunk-6WG22V46.js";
import "./chunk-OOGIXDXG.js";
import "./chunk-JFYQTYD3.js";
import "./chunk-KDJZAYOF.js";
import "./chunk-5453A3C5.js";
import "./chunk-HCFDI7IX.js";
import "./chunk-AQJS6F3O.js";
import "./chunk-WUB6LJVL.js";
import "./chunk-QXSES7JX.js";
import "./chunk-YPU2P4KO.js";
import "./chunk-UFVMJL32.js";
import "./chunk-2SMFPIRI.js";
import "./chunk-2GMKFOCL.js";
import "./chunk-ZR5BOILP.js";
import "./chunk-QCBC3RJX.js";
import "./chunk-63QCTVYB.js";
import "./chunk-U74WRHVJ.js";
import "./chunk-TCPN7AEH.js";
import "./chunk-W2IRSMFY.js";
import "./chunk-TRSGUVSM.js";
import "./chunk-U3MA63JX.js";
import "./chunk-WYKKCLBI.js";
import "./chunk-PFMGJTQM.js";
import "./chunk-Q7SRMLJZ.js";
import "./chunk-PQ4T66BG.js";
import "./chunk-SWPHGZYB.js";
import "./chunk-DWASPXVI.js";
import "./chunk-TNWXOQKO.js";
import "./chunk-MAO5BVLA.js";
import "./chunk-T2S5VXNP.js";
import "./chunk-4U5GUJRA.js";
import "./chunk-7KRERHHR.js";
import "./chunk-T4AP6CTC.js";
import "./chunk-HD65DNIO.js";
import "./chunk-4KWLMXIA.js";
import "./chunk-BIUXKPKA.js";
import "./chunk-N6TJI25E.js";
import "./chunk-634JLXD4.js";
import "./chunk-Y3EDGYWG.js";
import "./chunk-UF6JOUSJ.js";
import "./chunk-T5JGQSO3.js";
import "./chunk-CIW3KHOW.js";
import "./chunk-J55F4AC2.js";
import "./chunk-IQLBZKUD.js";
import "./chunk-7MZZCQ64.js";
import "./chunk-JOJZ6YC5.js";
import "./chunk-L4TOCXR5.js";
import "./chunk-IMVP5ADD.js";
import "./chunk-H7WPOTQH.js";
import "./chunk-L3T5PF4P.js";
import {
  j
} from "./chunk-SJX5DIA7.js";
import {
  t
} from "./chunk-SG5TCCCK.js";
import "./chunk-6A7CWJED.js";
import "./chunk-LFKEQKEA.js";
import "./chunk-DUTZNK67.js";
import "./chunk-IN6BQCWS.js";
import "./chunk-CRNUMTSV.js";
import "./chunk-JM7HAEY6.js";
import {
  t as t3
} from "./chunk-YI35FRTC.js";
import {
  f as f2
} from "./chunk-DOK4SACJ.js";
import {
  l
} from "./chunk-OUKUASAF.js";
import "./chunk-V5RMUGJJ.js";
import "./chunk-D2NB6D6N.js";
import {
  t as t2
} from "./chunk-UWJIHV6Q.js";
import {
  b as b2
} from "./chunk-ZUSCOMQM.js";
import {
  p
} from "./chunk-DSEUCBVP.js";
import "./chunk-UPDWQH75.js";
import {
  S
} from "./chunk-RXWBJSJ5.js";
import {
  f
} from "./chunk-M2NS3MSU.js";
import "./chunk-HMNBB7ED.js";
import "./chunk-3RRMLFFN.js";
import {
  c as c2
} from "./chunk-DR5TVNEL.js";
import "./chunk-HT2T6PUB.js";
import "./chunk-K64AAM77.js";
import "./chunk-6EUVKE22.js";
import "./chunk-A3NNJ7XA.js";
import "./chunk-OKJHJ3CY.js";
import "./chunk-XTVPEVHA.js";
import "./chunk-DTUSTSEJ.js";
import "./chunk-JCWFGRHQ.js";
import "./chunk-JILEJ6R2.js";
import "./chunk-GAW5JHG4.js";
import "./chunk-OEKKQXBD.js";
import "./chunk-S3IO7V4Q.js";
import "./chunk-DZALMCYL.js";
import "./chunk-K226GFDN.js";
import "./chunk-4ZZRP4MA.js";
import "./chunk-7ZJ6P7J7.js";
import "./chunk-FPFZQCEQ.js";
import "./chunk-YVULORT6.js";
import "./chunk-PB33BAI3.js";
import {
  c
} from "./chunk-CVB43GGP.js";
import "./chunk-EODIWR2E.js";
import "./chunk-LLDOZWVV.js";
import "./chunk-FYAEQPUY.js";
import "./chunk-7XMEZQ34.js";
import "./chunk-BDM2D6IC.js";
import "./chunk-U2ZVAEKG.js";
import "./chunk-EDSMXTFO.js";
import "./chunk-MNLT652N.js";
import "./chunk-OGZAGPIO.js";
import "./chunk-HJJIIYFF.js";
import "./chunk-7RMVJCDW.js";
import "./chunk-T6GCUITX.js";
import "./chunk-TUIGM7TV.js";
import "./chunk-IHVSZYZS.js";
import "./chunk-6CA6K3O7.js";
import {
  w
} from "./chunk-NYQ5CYNR.js";
import "./chunk-O7UDKFOW.js";
import "./chunk-TKPMIAIW.js";
import {
  o
} from "./chunk-NQOJNTB3.js";
import {
  r
} from "./chunk-MFOQYQFG.js";
import "./chunk-NKCPFCP3.js";
import "./chunk-3ZXOUEQG.js";
import "./chunk-AXVPJBVW.js";
import "./chunk-OXEPWRM7.js";
import "./chunk-POILQGXA.js";
import {
  d2 as d
} from "./chunk-JJS7PR2U.js";
import "./chunk-L5YS4GSA.js";
import "./chunk-PRREDSOB.js";
import "./chunk-V5C6HSAM.js";
import {
  U
} from "./chunk-SYATLP3H.js";
import "./chunk-V6AMQYXE.js";
import "./chunk-6WHTZNUH.js";
import "./chunk-EITGQLII.js";
import "./chunk-TIVJXVMN.js";
import "./chunk-XNUH25NY.js";
import "./chunk-WGAPNV7F.js";
import "./chunk-BXQGM56A.js";
import {
  e as e2
} from "./chunk-4Z5SGKRM.js";
import {
  e,
  n2 as n
} from "./chunk-ANKOCGE2.js";
import {
  y
} from "./chunk-7CJXZOFG.js";
import "./chunk-IRGZKO7V.js";
import "./chunk-5SELS7VU.js";
import {
  N,
  a3 as a2
} from "./chunk-DDYVXG4F.js";
import "./chunk-ANP42J2U.js";
import {
  a,
  b
} from "./chunk-HJY2YILU.js";
import "./chunk-7DA6A5LD.js";
import "./chunk-2MMLMOWS.js";
import "./chunk-4323ZVPF.js";
import {
  s2 as s
} from "./chunk-WYIDUUN2.js";
import "./chunk-DXLOWWK7.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-JWIQHGQB.js";

// ../../../node_modules/@arcgis/core/layers/MapImageLayer.js
var J = class extends l(l3(t2(m(f3(l2(b2(j(S(f2(i(e3(f)))))))))))) {
  constructor(...e5) {
    super(...e5), this._exportImageParameters = new y2({
      layer: this
    }), this.dateFieldsTimeZone = null, this.datesInUnknownTimezone = false, this.dpi = 96, this.gdbVersion = null, this.imageFormat = "png24", this.imageMaxHeight = 2048, this.imageMaxWidth = 2048, this.imageTransparency = true, this.isReference = null, this.labelsVisible = false, this.operationalLayerType = "ArcGISMapServiceLayer", this.preferredTimeZone = null, this.sourceJSON = null, this.sublayers = null, this.type = "map-image", this.url = null;
  }
  normalizeCtorArgs(e5, r2) {
    return "string" == typeof e5 ? __spreadValues({
      url: e5
    }, r2) : e5;
  }
  load(e5) {
    const r2 = null != e5 ? e5.signal : null;
    return this.addResolvingPromise(this.loadFromPortal({
      supportedTypes: ["Map Service"]
    }, e5).catch(a).then(() => this._fetchService(r2))), Promise.resolve(this);
  }
  destroy() {
    this._exportImageParameters.destroy();
  }
  readImageFormat(e5, r2) {
    const t5 = r2.supportedImageFormatTypes;
    return t5 && t5.includes("PNG32") ? "png32" : "png24";
  }
  writeSublayers(e5, r2, t5, s2) {
    if (!this.loaded || !e5) return;
    const i3 = e5.slice().reverse().flatten(({
      sublayers: e6
    }) => e6 && e6.toArray().reverse()).toArray();
    let o2 = false;
    const a3 = n(s2.origin);
    if (this.capabilities?.operations.supportsExportMap && this.capabilities?.exportMap?.supportsDynamicLayers) {
      if (a3 === e.PORTAL_ITEM) {
        const e6 = this.createSublayersForOrigin("service").sublayers;
        o2 = e4(i3, e6, e.SERVICE);
      } else if (a3 > e.PORTAL_ITEM) {
        const e6 = this.createSublayersForOrigin("portal-item");
        o2 = e4(i3, e6.sublayers, n(e6.origin));
      }
    }
    const p2 = [], n2 = __spreadValues({
      writeSublayerStructure: o2
    }, s2);
    let m2 = o2 || this.hasVisibleLayersForOrigin(a3);
    i3.forEach((e6) => {
      const r3 = e6.write({}, n2);
      p2.push(r3), m2 = m2 || "user" === e6.originOf("visible");
    });
    p2.some((e6) => Object.keys(e6).length > 1) && (r2.layers = p2), m2 && (r2.visibleLayers = i3.filter((e6) => e6.visible).map((e6) => e6.id));
  }
  createExportImageParameters(e5, r2, t5, s2) {
    const i3 = s2?.pixelRatio || 1;
    e5 && this.version >= 10 && (e5 = e5.clone().shiftCentralMeridian()), this._exportImageParameters.floors = s2?.floors ?? null, this._exportImageParameters.scale = i2({
      extent: e5,
      width: r2
    }) * i3;
    const o2 = this._exportImageParameters.toJSON(), a3 = !s2?.rotation || this.version < 10.3 ? {} : {
      rotation: -s2.rotation
    }, p2 = e5?.spatialReference, n2 = d(p2);
    o2.dpi *= i3;
    const m2 = {};
    if (s2?.timeExtent) {
      const {
        start: e6,
        end: r3
      } = s2.timeExtent.toJSON();
      m2.time = e6 && r3 && e6 === r3 ? "" + e6 : `${e6 ?? "null"},${r3 ?? "null"}`;
    } else this.timeInfo && !this.timeInfo.hasLiveData && (m2.time = "null,null");
    return __spreadValues(__spreadValues(__spreadValues({
      bbox: e5 && e5.xmin + "," + e5.ymin + "," + e5.xmax + "," + e5.ymax,
      bboxSR: n2,
      imageSR: n2,
      size: r2 + "," + t5
    }, o2), a3), m2);
  }
  fetchImage(e5, r2, t5, s2) {
    return __async(this, null, function* () {
      const {
        data: i3
      } = yield this._fetchImage("image", e5, r2, t5, s2);
      return i3;
    });
  }
  fetchImageBitmap(e5, r2, t5, s2) {
    return __async(this, null, function* () {
      const {
        data: i3,
        url: o2
      } = yield this._fetchImage("blob", e5, r2, t5, s2);
      return t3(i3, o2, s2?.signal);
    });
  }
  fetchRecomputedExtents() {
    return __async(this, arguments, function* (e5 = {}) {
      const s2 = __spreadProps(__spreadValues({}, e5), {
        query: __spreadProps(__spreadValues({
          returnUpdates: true,
          f: "json"
        }, this.customParameters), {
          token: this.apiKey
        })
      }), {
        data: i3
      } = yield U(this.url, s2), {
        extent: o2,
        fullExtent: a3,
        timeExtent: p2
      } = i3, n2 = o2 || a3;
      return {
        fullExtent: n2 && w.fromJSON(n2),
        timeExtent: p2 && c2.fromJSON({
          start: p2[0],
          end: p2[1]
        })
      };
    });
  }
  loadAll() {
    return t(this, (e5) => {
      e5(this.allSublayers), e5(this.subtables);
    });
  }
  serviceSupportsSpatialReference(e5) {
    return t4(this, e5);
  }
  _fetchImage(e5, t5, i3, o2, a3) {
    return __async(this, null, function* () {
      const n2 = {
        responseType: e5,
        signal: a3?.signal ?? null,
        query: __spreadProps(__spreadValues(__spreadValues(__spreadProps(__spreadValues(__spreadValues({}, this.parsedUrl.query), this.createExportImageParameters(t5, i3, o2, a3)), {
          f: "image"
        }), this.refreshParameters), this.customParameters), {
          token: this.apiKey
        })
      }, m2 = this.parsedUrl.path + "/export";
      if (null != n2.query?.dynamicLayers && !this.capabilities?.exportMap?.supportsDynamicLayers) throw new s("mapimagelayer:dynamiclayer-not-supported", `service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`, {
        query: n2.query
      });
      try {
        const {
          data: e6
        } = yield U(m2, n2);
        return {
          data: e6,
          url: m2
        };
      } catch (l4) {
        if (b(l4)) throw l4;
        throw new s("mapimagelayer:image-fetch-error", `Unable to load image: ${m2}`, {
          error: l4
        });
      }
    });
  }
  _fetchService(e5) {
    return __async(this, null, function* () {
      if (this.sourceJSON) return void this.read(this.sourceJSON, {
        origin: "service",
        url: this.parsedUrl
      });
      const {
        data: t5,
        ssl: s2
      } = yield U(this.parsedUrl.path, {
        query: __spreadProps(__spreadValues(__spreadValues({
          f: "json"
        }, this.parsedUrl.query), this.customParameters), {
          token: this.apiKey
        }),
        signal: e5
      });
      s2 && (this.url = this.url.replace(/^http:/i, "https:")), this.sourceJSON = t5, this.read(t5, {
        origin: "service",
        url: this.parsedUrl
      });
    });
  }
  hasVisibleLayersForOrigin(e5) {
    return !(null == e5 || !this.sublayersSourceJSON[e5]?.visibleLayers);
  }
};
e2([y(c("dateFieldsTimeReference"))], J.prototype, "dateFieldsTimeZone", void 0), e2([y({
  type: Boolean
})], J.prototype, "datesInUnknownTimezone", void 0), e2([y()], J.prototype, "dpi", void 0), e2([y()], J.prototype, "gdbVersion", void 0), e2([y()], J.prototype, "imageFormat", void 0), e2([o("imageFormat", ["supportedImageFormatTypes"])], J.prototype, "readImageFormat", null), e2([y({
  json: {
    origins: {
      service: {
        read: {
          source: "maxImageHeight"
        }
      }
    }
  }
})], J.prototype, "imageMaxHeight", void 0), e2([y({
  json: {
    origins: {
      service: {
        read: {
          source: "maxImageWidth"
        }
      }
    }
  }
})], J.prototype, "imageMaxWidth", void 0), e2([y()], J.prototype, "imageTransparency", void 0), e2([y({
  type: Boolean,
  json: {
    read: false,
    write: {
      enabled: true,
      overridePolicy: () => ({
        enabled: false
      })
    }
  }
})], J.prototype, "isReference", void 0), e2([y({
  json: {
    read: false,
    write: false
  }
})], J.prototype, "labelsVisible", void 0), e2([y({
  type: ["ArcGISMapServiceLayer"]
})], J.prototype, "operationalLayerType", void 0), e2([y({
  json: {
    read: false,
    write: false
  }
})], J.prototype, "popupEnabled", void 0), e2([y(c("preferredTimeReference"))], J.prototype, "preferredTimeZone", void 0), e2([y()], J.prototype, "sourceJSON", void 0), e2([y({
  json: {
    write: {
      ignoreOrigin: true
    }
  }
})], J.prototype, "sublayers", void 0), e2([r("sublayers", {
  layers: {
    type: [te]
  },
  visibleLayers: {
    type: [N]
  }
})], J.prototype, "writeSublayers", null), e2([y({
  type: ["show", "hide", "hide-children"]
})], J.prototype, "listMode", void 0), e2([y({
  json: {
    read: false
  },
  readOnly: true,
  value: "map-image"
})], J.prototype, "type", void 0), e2([y(p)], J.prototype, "url", void 0), J = e2([a2("esri.layers.MapImageLayer")], J);
var q = J;
export {
  q as default
};
//# sourceMappingURL=MapImageLayer-4C66JOPL.js.map
