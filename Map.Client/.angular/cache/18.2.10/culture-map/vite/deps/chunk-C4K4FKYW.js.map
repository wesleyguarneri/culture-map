{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport \"../../../../core/has.js\";\nimport e from \"../../../../renderers/PointCloudClassBreaksRenderer.js\";\nimport r from \"../../../../renderers/PointCloudStretchRenderer.js\";\nimport o from \"../../../../renderers/PointCloudUniqueValueRenderer.js\";\nimport { createGeometryIndexFromSchema as t, createTypedView as n, readBinaryAttribute as l } from \"./I3SBinaryReader.js\";\nimport { decodeXYZ as s } from \"./LEPCC.js\";\nfunction i(t, n, l, s) {\n  const {\n    rendererJSON: i,\n    isRGBRenderer: u\n  } = t;\n  let c = null,\n    a = null;\n  if (n && u) c = n;else if (n && \"pointCloudUniqueValueRenderer\" === i?.type) {\n    a = o.fromJSON(i);\n    const e = a.colorUniqueValueInfos;\n    c = new Uint8Array(3 * s);\n    const r = d(a.fieldTransformType);\n    for (let o = 0; o < s; o++) {\n      const t = (r ? r(n[o]) : n[o]) + \"\";\n      for (let r = 0; r < e.length; r++) if (e[r].values.includes(t)) {\n        c[3 * o] = e[r].color.r, c[3 * o + 1] = e[r].color.g, c[3 * o + 2] = e[r].color.b;\n        break;\n      }\n    }\n  } else if (n && \"pointCloudStretchRenderer\" === i?.type) {\n    a = r.fromJSON(i);\n    const e = a.stops;\n    c = new Uint8Array(3 * s);\n    const o = d(a.fieldTransformType);\n    for (let r = 0; r < s; r++) {\n      const t = o ? o(n[r]) : n[r],\n        l = e.length - 1;\n      if (t < e[0].value) c[3 * r] = e[0].color.r, c[3 * r + 1] = e[0].color.g, c[3 * r + 2] = e[0].color.b;else if (t >= e[l].value) c[3 * r] = e[l].color.r, c[3 * r + 1] = e[l].color.g, c[3 * r + 2] = e[l].color.b;else for (let o = 1; o < e.length; o++) if (t < e[o].value) {\n        const n = (t - e[o - 1].value) / (e[o].value - e[o - 1].value);\n        c[3 * r] = e[o].color.r * n + e[o - 1].color.r * (1 - n), c[3 * r + 1] = e[o].color.g * n + e[o - 1].color.g * (1 - n), c[3 * r + 2] = e[o].color.b * n + e[o - 1].color.b * (1 - n);\n        break;\n      }\n    }\n  } else if (n && \"pointCloudClassBreaksRenderer\" === i?.type) {\n    a = e.fromJSON(i);\n    const r = a.colorClassBreakInfos;\n    c = new Uint8Array(3 * s);\n    const o = d(a.fieldTransformType);\n    for (let e = 0; e < s; e++) {\n      const t = o ? o(n[e]) : n[e];\n      for (let o = 0; o < r.length; o++) if (t >= r[o].minValue && t <= r[o].maxValue) {\n        c[3 * e] = r[o].color.r, c[3 * e + 1] = r[o].color.g, c[3 * e + 2] = r[o].color.b;\n        break;\n      }\n    }\n  } else c = new Uint8Array(3 * s).fill(255);\n  if (l && a?.colorModulation) {\n    const e = a.colorModulation.minValue,\n      r = a.colorModulation.maxValue,\n      o = .3;\n    for (let t = 0; t < s; t++) {\n      const n = l[t],\n        s = n >= r ? 1 : n <= e ? o : o + (1 - o) * (n - e) / (r - e);\n      c[3 * t] = s * c[3 * t], c[3 * t + 1] = s * c[3 * t + 1], c[3 * t + 2] = s * c[3 * t + 2];\n    }\n  }\n  return c;\n}\nfunction u(e, r) {\n  if (null == e.encoding || \"\" === e.encoding) {\n    const o = t(r, e);\n    if (null == o.vertexAttributes.position) return;\n    const l = n(r, o.vertexAttributes.position),\n      s = o.header.fields,\n      i = [s.offsetX, s.offsetY, s.offsetZ],\n      u = [s.scaleX, s.scaleY, s.scaleZ],\n      c = l.length / 3,\n      a = new Float64Array(3 * c);\n    for (let e = 0; e < c; e++) a[3 * e] = l[3 * e] * u[0] + i[0], a[3 * e + 1] = l[3 * e + 1] * u[1] + i[1], a[3 * e + 2] = l[3 * e + 2] * u[2] + i[2];\n    return a;\n  }\n  if (\"lepcc-xyz\" === e.encoding) return s(r).result;\n}\nfunction c(e, r, o) {\n  return e?.attributeInfo.useElevation ? r ? a(r, o) : null : e?.attributeInfo.storageInfo ? l(e.attributeInfo.storageInfo, e.buffer, o) : null;\n}\nfunction a(e, r) {\n  const o = new Float64Array(r);\n  for (let t = 0; t < r; t++) o[t] = e[3 * t + 2];\n  return o;\n}\nfunction f(e, r, o, t, n) {\n  const l = e.length / 3;\n  let s = 0;\n  for (let i = 0; i < l; i++) {\n    let l = !0;\n    for (let e = 0; e < t.length && l; e++) {\n      const {\n          filterJSON: r\n        } = t[e],\n        o = n[e].values[i];\n      switch (r.type) {\n        case \"pointCloudValueFilter\":\n          {\n            const e = \"exclude\" === r.mode;\n            r.values.includes(o) === e && (l = !1);\n            break;\n          }\n        case \"pointCloudBitfieldFilter\":\n          {\n            const e = p(r.requiredSetBits),\n              t = p(r.requiredClearBits);\n            ((o & e) !== e || o & t) && (l = !1);\n            break;\n          }\n        case \"pointCloudReturnFilter\":\n          {\n            const e = 15 & o,\n              t = o >>> 4 & 15,\n              n = t > 1,\n              s = 1 === e,\n              i = e === t;\n            let u = !1;\n            for (const o of r.includedReturns) if (\"last\" === o && i || \"firstOfMany\" === o && s && n || \"lastOfMany\" === o && i && n || \"single\" === o && !n) {\n              u = !0;\n              break;\n            }\n            u || (l = !1);\n            break;\n          }\n      }\n    }\n    l && (o[s] = i, e[3 * s] = e[3 * i], e[3 * s + 1] = e[3 * i + 1], e[3 * s + 2] = e[3 * i + 2], r[3 * s] = r[3 * i], r[3 * s + 1] = r[3 * i + 1], r[3 * s + 2] = r[3 * i + 2], s++);\n  }\n  return s;\n}\nfunction d(e) {\n  switch (e) {\n    default:\n    case null:\n    case \"none\":\n      return e => e;\n    case \"low-four-bit\":\n      return e => 15 & e;\n    case \"high-four-bit\":\n      return e => (240 & e) >> 4;\n    case \"absolute-value\":\n      return e => Math.abs(e);\n    case \"modulo-ten\":\n      return e => e % 10;\n  }\n}\nfunction p(e) {\n  let r = 0;\n  for (const o of e || []) r |= 1 << o;\n  return r;\n}\nexport { a as elevationFromPositions, i as evaluateRenderer, f as filterInPlace, c as getAttributeValues, u as readGeometry };"],
  "mappings": "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",
  "names": ["l", "i", "u", "c", "a", "d", "t", "r", "o", "n", "s", "e"]
}
