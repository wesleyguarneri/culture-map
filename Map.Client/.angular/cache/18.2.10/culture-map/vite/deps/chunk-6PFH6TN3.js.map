{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/core/accessorSupport/decorators/persistable.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from \"../../Error.js\";\nimport { createMD5Hash as r } from \"../../MD5.js\";\nimport { isMultiOriginJSONMixin as e } from \"../../multiOriginJSONSupportUtils.js\";\nimport { isAbsolute as o, isBlobProtocol as s, join as n, blobUrlToBlob as i, getPathExtension as p } from \"../../urlUtils.js\";\nimport { generateUUID as c } from \"../../uuid.js\";\nimport { getPropertyMetadata as u } from \"../metadata.js\";\nimport { nameToId as a } from \"../PropertyOrigin.js\";\nimport { propertyJSONMeta as l } from \"./property.js\";\nimport { getResourceContentExtension as m } from \"../../../portal/support/resourceExtension.js\";\nimport { r as d, t as f, M as y, i as g, p as h, b as v } from \"../../../chunks/persistableUrlUtils.js\";\nfunction j(t) {\n  const r = t?.origins ?? [void 0];\n  return (e, o) => {\n    const s = U(t, e, o);\n    for (const t of r) {\n      const r = l(e, t, o);\n      for (const t in s) r[t] = s[t];\n    }\n  };\n}\nfunction U(t, r, e) {\n  if (\"resource\" === t?.type) return w(t, r, e);\n  switch (t?.type ?? \"other\") {\n    case \"other\":\n      return {\n        read: !0,\n        write: !0\n      };\n    case \"url\":\n      {\n        const {\n          read: t,\n          write: r\n        } = v;\n        return {\n          read: t,\n          write: r\n        };\n      }\n  }\n}\nfunction w(t, r, n) {\n  const i = u(r, n);\n  return {\n    type: String,\n    read: (t, r, e) => {\n      const o = d(t, r, e);\n      return i.type === String ? o : \"function\" == typeof i.type ? new i.type({\n        url: o\n      }) : void 0;\n    },\n    write: {\n      writer(r, p, c, u) {\n        if (!u?.resources) return \"string\" == typeof r ? void (p[c] = f(r, u)) : void (p[c] = r.write({}, u));\n        const l = x(r),\n          m = f(l, {\n            ...u,\n            verifyItemRelativeUrls: u?.verifyItemRelativeUrls ? {\n              writtenUrls: u.verifyItemRelativeUrls.writtenUrls,\n              rootPath: void 0\n            } : void 0\n          }, y.NO),\n          d = i.type !== String && (!e(this) || u?.origin && this.originIdOf(n) > a(u.origin)),\n          h = {\n            object: this,\n            propertyName: n,\n            value: r,\n            targetUrl: m,\n            dest: p,\n            targetPropertyName: c,\n            context: u,\n            params: t\n          };\n        u?.portalItem && m && !o(m) ? d && t?.contentAddressed ? I(h) : d ? N(h) : P(h) : u?.portalItem && (null == m || null != g(m) || s(m) || d) ? I(h) : p[c] = m;\n      }\n    }\n  };\n}\nfunction I(e) {\n  const {\n    targetUrl: o,\n    params: p,\n    value: u,\n    context: a,\n    dest: l,\n    targetPropertyName: d\n  } = e;\n  if (!a.portalItem) return;\n  const f = h(o),\n    y = S(u, o, a);\n  if (p?.contentAddressed && \"json\" !== y.type) return void a.messages?.push(new t(\"persistable:contentAddressingUnsupported\", `Property \"${d}\" is trying to serializing a resource with content of type ${y.type} with content addressing. Content addressing is only supported for json resources.`, {\n    content: y\n  }));\n  const g = p?.contentAddressed && \"json\" === y.type ? r(y.jsonString) : f?.filename ?? c(),\n    v = n(p?.prefix ?? f?.prefix, g),\n    j = `${v}.${m(y)}`;\n  if (p?.contentAddressed && a.resources && \"json\" === y.type) {\n    const t = a.resources.toKeep.find(({\n      resource: t\n    }) => t.path === j) ?? a.resources.toAdd.find(({\n      resource: t\n    }) => t.path === j);\n    if (t) return void (l[d] = t.resource.itemRelativeUrl);\n  }\n  const U = a.portalItem.resourceFromPath(j);\n  s(o) && a.resources && a.resources.pendingOperations.push(i(o).then(t => {\n    U.path = `${v}.${m({\n      type: \"blob\",\n      blob: t\n    })}`, l[d] = U.itemRelativeUrl;\n  }).catch(() => {}));\n  const w = p?.compress ?? !1;\n  a.resources && b({\n    ...e,\n    resource: U,\n    content: y,\n    compress: w,\n    updates: a.resources.toAdd\n  }), l[d] = U.itemRelativeUrl;\n}\nfunction N(t) {\n  const {\n    context: r,\n    targetUrl: e,\n    params: o,\n    value: s,\n    dest: n,\n    targetPropertyName: i\n  } = t;\n  if (!r.portalItem) return;\n  const c = r.portalItem.resourceFromPath(e),\n    u = S(s, e, r),\n    a = m(u),\n    l = p(c.path),\n    d = o?.compress ?? !1;\n  a === l ? (r.resources && b({\n    ...t,\n    resource: c,\n    content: u,\n    compress: d,\n    updates: r.resources.toUpdate\n  }), n[i] = e) : I(t);\n}\nfunction P({\n  context: t,\n  targetUrl: r,\n  dest: e,\n  targetPropertyName: o\n}) {\n  t.portalItem && t.resources && (t.resources.toKeep.push({\n    resource: t.portalItem.resourceFromPath(r),\n    compress: !1\n  }), e[o] = r);\n}\nfunction b({\n  object: t,\n  propertyName: r,\n  updates: e,\n  resource: o,\n  content: s,\n  compress: n\n}) {\n  const i = e => {\n    O(t, r, e);\n  };\n  e.push({\n    resource: o,\n    content: s,\n    compress: n,\n    finish: i\n  });\n}\nfunction S(t, r, e) {\n  return \"string\" == typeof t ? {\n    type: \"url\",\n    url: r\n  } : {\n    type: \"json\",\n    jsonString: JSON.stringify(t.toJSON(e))\n  };\n}\nfunction x(t) {\n  return null == t ? null : \"string\" == typeof t ? t : t.url;\n}\nfunction O(t, r, e) {\n  \"string\" == typeof t[r] ? t[r] = e.url : t[r].url = e.url;\n}\nexport { j as persistable };"],
  "mappings": "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",
  "names": ["o", "s", "U", "t", "r", "n", "i", "p", "x", "m", "d", "P", "f", "y", "g", "j", "w", "e"]
}
