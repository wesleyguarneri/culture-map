{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/arcade/functions/knowledgegraph.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"../../config.js\";\nimport \"../../geometry.js\";\nimport r from \"../ArcadePortal.js\";\nimport t from \"../Dictionary.js\";\nimport { ArcadeExecutionError as n, ExecutionErrorCodes as o } from \"../executionError.js\";\nimport { H as a, j as i, c as s, w as p, K as l, o as c, N as f, b as u, k as m, m as d, n as g, v as h, p as w, a5 as y } from \"../../chunks/languageUtils.js\";\nimport { getPortal as j } from \"../portalUtils.js\";\nimport S from \"../../geometry/Geometry.js\";\nimport { isLoaded as v, load as R, project as G } from \"../../geometry/projection.js\";\nimport { webMercatorToGeographic as k, geographicToWebMercator as x } from \"../../geometry/support/webMercatorUtils.js\";\nimport P from \"../../portal/Portal.js\";\nimport b from \"../../portal/PortalItem.js\";\nimport { project as I } from \"../../rest/geometryService/project.js\";\nimport W from \"../../rest/knowledgeGraph/Entity.js\";\nimport T from \"../../rest/knowledgeGraph/GraphQueryStreaming.js\";\nimport D from \"../../rest/knowledgeGraph/ObjectValue.js\";\nimport N from \"../../rest/knowledgeGraph/Path.js\";\nimport q from \"../../rest/knowledgeGraph/Relationship.js\";\nimport A from \"../../rest/support/ProjectParameters.js\";\nimport U from \"../../geometry/SpatialReference.js\";\nlet F = null;\nasync function J(r) {\n  const t = e.geometryServiceUrl ?? \"\";\n  if (!t) {\n    v() || (await R());\n    for (const e of r) e.container[e.indexer] = G(e.container[e.indexer], U.WGS84);\n    return;\n  }\n  const n = r.map(e => e.container[e.indexer]),\n    o = new A({\n      geometries: n,\n      outSpatialReference: U.WGS84\n    }),\n    a = await I(t, o);\n  for (let e = 0; e < a.length; e++) {\n    const t = r[e];\n    t.container[t.indexer] = a[e];\n  }\n}\nasync function M(e, r) {\n  const t = new b({\n    portal: e,\n    id: r\n  });\n  return await t.load(), null === F && (F = await import(\"../../rest/knowledgeGraphService.js\")), await F.fetchKnowledgeGraph(t.url);\n}\nfunction Q(e, r, t, n, o) {\n  if (null === e) return null;\n  if (s(e) || u(e)) return e;\n  if (m(e)) return e.toJSDate();\n  if (m(e)) return e.toJSDate();\n  if (d(e)) return e.toStorageFormat();\n  if (g(e)) return e.toStorageString();\n  if (h(e)) {\n    const a = {};\n    for (const i of e.keys()) a[i] = Q(e.field(i), r, t, n, o), a[i] instanceof S && o.push({\n      container: a,\n      indexer: i\n    });\n    return a;\n  }\n  if (c(e)) {\n    const a = e.map(e => Q(e, r, t, n, o));\n    for (let e = 0; e < a.length; e++) a[e] instanceof S && o.push({\n      container: a,\n      indexer: e\n    });\n    return a;\n  }\n  return w(e) ? e.spatialReference.isWGS84 ? e : e.spatialReference.isWebMercator && r ? k(e) : e : void 0;\n}\nfunction E(e, r) {\n  if (!e) return e;\n  if (e.spatialReference.isWGS84 && r.spatialReference.isWebMercator) return x(e);\n  if (e.spatialReference.equals(r.spatialReference)) return e;\n  throw new n(r, o.WrongSpatialReference, null);\n}\nfunction K(e, r) {\n  if (!e) return null;\n  const t = {};\n  for (const n in e) t[n] = V(e[n], r);\n  return t;\n}\nfunction V(e, r) {\n  return null === e ? null : c(e) ? e.map(e => V(e, r)) : e instanceof W ? {\n    graphTypeName: e.typeName,\n    id: e.id,\n    graphType: \"entity\",\n    properties: K(e.properties, r)\n  } : e instanceof D ? {\n    graphType: \"object\",\n    properties: K(e.properties, r)\n  } : e instanceof q ? {\n    graphTypeName: e.typeName,\n    id: e.id,\n    graphType: \"relationship\",\n    originId: e.originId ?? null,\n    destinationId: e.destinationId ?? null,\n    properties: K(e.properties, r)\n  } : e instanceof N ? {\n    graphType: \"path\",\n    path: e.path ? e.path.map(e => V(e, r)) : null\n  } : w(e) ? E(e, r) : s(e) || u(e) || y(e) ? e : null;\n}\nfunction C(e) {\n  \"async\" === e.mode && (e.functions.knowledgegraphbyportalitem = function (t, p) {\n    return e.standardFunctionAsync(t, p, (e, l, c) => {\n      if (a(c, 2, 2, t, p), null === c[0]) throw new n(t, o.PortalRequired, p);\n      if (c[0] instanceof r) {\n        const e = i(c[1]);\n        let r;\n        r = t.services?.portal ? t.services.portal : P.getDefault();\n        return M(j(c[0], r), e);\n      }\n      if (!1 === s(c[0])) throw new n(t, o.InvalidParameter, p);\n      const f = i(c[0]);\n      return M(t.services?.portal ?? P.getDefault(), f);\n    });\n  }, e.signatures.push({\n    name: \"knowledgegraphbyportalitem\",\n    min: 2,\n    max: 2\n  }), e.functions.querygraph = function (r, i) {\n    return e.standardFunctionAsync(r, i, async (e, u, m) => {\n      a(m, 2, 4, r, i);\n      const d = m[0];\n      if (!p(d)) throw new n(r, o.InvalidParameter, i);\n      const g = m[1];\n      if (!s(g)) throw new n(r, o.InvalidParameter, i);\n      null === F && (F = await import(\"../../rest/knowledgeGraphService.js\"));\n      let h = null;\n      const w = l(m[2], null);\n      if (!(w instanceof t || null === w)) throw new n(r, o.InvalidParameter, i);\n      if (w) {\n        let e = [];\n        h = Q(w, !0, !1, r, e), e = e.filter(e => !e.container[e.indexer].spatialReference.isWGS84), e.length > 0 && (await J(e));\n      }\n      const y = new T({\n        openCypherQuery: g,\n        bindParameters: h\n      });\n      (d?.serviceDefinition?.currentVersion ?? 11.3) > 11.2 && (y.outputSpatialReference = r.spatialReference);\n      const j = (await F.executeQueryStreaming(d, y)).resultRowsStream.getReader(),\n        S = [];\n      try {\n        for (;;) {\n          const {\n            done: e,\n            value: t\n          } = await j.read();\n          if (e) break;\n          if (c(t)) for (const n of t) S.push(V(n, r));else {\n            const e = [];\n            for (const n of t) e.push(V(t[n], r));\n            S.push(e);\n          }\n        }\n      } catch (v) {\n        throw v;\n      }\n      return t.convertJsonToArcade(S, f(r), !1, !0);\n    });\n  }, e.signatures.push({\n    name: \"querygraph\",\n    min: 2,\n    max: 4\n  }));\n}\nexport { C as registerFunctions };"],
  "mappings": "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",
  "names": ["r", "t", "K", "n", "p", "a", "e", "E", "C", "l", "c", "f", "m", "d", "s", "S"]
}
