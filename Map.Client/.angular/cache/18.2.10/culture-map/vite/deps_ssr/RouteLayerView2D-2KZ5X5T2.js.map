{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/2d/layers/RouteLayerView2D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport { isSome as e } from \"../../../core/arrayUtils.js\";\nimport r from \"../../../core/Collection.js\";\nimport i from \"../../../core/CollectionFlattener.js\";\nimport { makeHandle as s } from \"../../../core/handleUtils.js\";\nimport { initial as o, watch as a } from \"../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/Logger.js\";\nimport { subclass as n } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport p from \"../../../rest/support/DirectionLine.js\";\nimport l from \"../../../rest/support/DirectionPoint.js\";\nimport c from \"../../../rest/support/PointBarrier.js\";\nimport g from \"../../../rest/support/PolygonBarrier.js\";\nimport d from \"../../../rest/support/PolylineBarrier.js\";\nimport u from \"../../../rest/support/RouteInfo.js\";\nimport _ from \"../../../rest/support/Stop.js\";\nimport { getHighlightBits as m } from \"../engine/highlightReasons.js\";\nimport { LayerView2DMixin as f } from \"./LayerView2D.js\";\nimport w from \"./graphics/GraphicContainer.js\";\nimport y from \"./graphics/GraphicsView2D.js\";\nimport k from \"../../layers/LayerView.js\";\nconst j = [\"route-info\", \"direction-line\", \"direction-point\", \"polygon-barrier\", \"polyline-barrier\", \"point-barrier\", \"stop\"],\n  M = {\n    graphic: null,\n    property: null,\n    oldValue: null,\n    newValue: null\n  };\nfunction V(t) {\n  return t instanceof p || t instanceof l || t instanceof c || t instanceof g || t instanceof d || t instanceof u || t instanceof _;\n}\nfunction G(t) {\n  return r.isCollection(t) && t.length && V(t.at(0));\n}\nfunction I(t) {\n  return Array.isArray(t) && t.length > 0 && V(t[0]);\n}\nlet v = class extends f(k) {\n  constructor() {\n    super(...arguments), this._graphics = new r(), this._highlightIds = new Map(), this._networkFeatureMap = new Map(), this._networkGraphicMap = new Map();\n  }\n  get _routeItems() {\n    return new i({\n      getCollections: () => null == this.layer || this.destroyed ? [] : [null != this.layer.routeInfo ? new r([this.layer.routeInfo]) : null, this.layer.directionLines, this.layer.directionPoints, this.layer.polygonBarriers, this.layer.polylineBarriers, this.layer.pointBarriers, this.layer.stops]\n    });\n  }\n  initialize() {\n    this._updatingHandles.addOnCollectionChange(() => this._routeItems, t => this._routeItemsChanged(t), o);\n  }\n  destroy() {\n    this._networkFeatureMap.clear(), this._networkGraphicMap.clear(), this._graphics.removeAll(), this._get(\"_routeItems\")?.destroy();\n  }\n  attach() {\n    this._createGraphicsView();\n  }\n  detach() {\n    this._destroyGraphicsView();\n  }\n  async fetchPopupFeaturesAtLocation(t, e) {\n    return this._graphicsView.hitTest(t).filter(({\n      popupTemplate: t\n    }) => !!t);\n  }\n  highlight(t) {\n    let r;\n    r = V(t) ? [this._getNetworkFeatureUid(t)] : I(t) ? t.map(t => this._getNetworkFeatureUid(t)) : G(t) ? t.map(t => this._getNetworkFeatureUid(t)).toArray() : [t.uid];\n    const i = r.filter(e);\n    return i.length ? (this._addHighlight(i), s(() => this._removeHighlight(i))) : s();\n  }\n  async hitTest(t, r) {\n    if (this.suspended) return null;\n    const i = this._graphicsView.hitTest(t).filter(e).map(t => this._networkGraphicMap.get(t));\n    if (!i.length) return null;\n    const {\n      layer: s\n    } = this;\n    return i.reverse().map(e => ({\n      type: \"route\",\n      layer: s,\n      mapPoint: t,\n      networkFeature: e\n    }));\n  }\n  isUpdating() {\n    return this._graphicsView.updating;\n  }\n  moveEnd() {}\n  update(t) {\n    this._graphicsView.processUpdate(t);\n  }\n  viewChange() {\n    this._graphicsView.viewChange();\n  }\n  _addHighlight(t) {\n    for (const e of t) if (this._highlightIds.has(e)) {\n      const t = this._highlightIds.get(e);\n      this._highlightIds.set(e, t + 1);\n    } else this._highlightIds.set(e, 1);\n    this._updateHighlight();\n  }\n  _createGraphic(t) {\n    const e = t.toGraphic();\n    return e.layer = this.layer, e.sourceLayer = this.layer, e;\n  }\n  _createGraphicsView() {\n    const t = this.view,\n      e = () => this.requestUpdate(),\n      r = new w(t.featuresTilingScheme);\n    this._graphicsView = new y({\n      container: r,\n      graphics: this._graphics,\n      requestUpdateCallback: e,\n      view: t\n    }), this.container.addChild(r), this._updateHighlight();\n  }\n  _destroyGraphicsView() {\n    this.container.removeChild(this._graphicsView.container), this._graphicsView.destroy();\n  }\n  _getDrawOrder(t) {\n    const e = this._networkGraphicMap.get(t);\n    return j.indexOf(e.type);\n  }\n  _getNetworkFeatureUid(t) {\n    return this._networkFeatureMap.has(t) ? this._networkFeatureMap.get(t).uid : null;\n  }\n  _removeHighlight(t) {\n    for (const e of t) if (this._highlightIds.has(e)) {\n      const t = this._highlightIds.get(e) - 1;\n      0 === t ? this._highlightIds.delete(e) : this._highlightIds.set(e, t);\n    }\n    this._updateHighlight();\n  }\n  _routeItemsChanged(t) {\n    if (t.removed.length) {\n      this._graphics.removeMany(t.removed.map(t => {\n        const e = this._networkFeatureMap.get(t);\n        return this._networkFeatureMap.delete(t), this._networkGraphicMap.delete(e), e;\n      }));\n      for (const e of t.removed) this.removeHandles(e);\n    }\n    if (t.added.length) {\n      this._graphics.addMany(t.added.map(t => {\n        const e = this._createGraphic(t);\n        return null == e.symbol ? null : (this._networkFeatureMap.set(t, e), this._networkGraphicMap.set(e, t), e);\n      }).filter(e));\n      for (const e of t.added) this.addHandles([a(() => e.geometry, (t, r) => {\n        this._updateGraphic(e, \"geometry\", t, r);\n      }), a(() => e.symbol, (t, r) => {\n        this._updateGraphic(e, \"symbol\", t, r);\n      })], e);\n      this._graphics.sort((t, e) => this._getDrawOrder(t) - this._getDrawOrder(e));\n    }\n  }\n  _updateGraphic(t, e, r, i) {\n    if (!this._networkFeatureMap.has(t)) {\n      const e = this._createGraphic(t);\n      return this._networkFeatureMap.set(t, e), this._networkGraphicMap.set(e, t), void this._graphics.add(e);\n    }\n    const s = this._networkFeatureMap.get(t);\n    s[e] = r, M.graphic = s, M.property = e, M.oldValue = i, M.newValue = r, this._graphicsView.graphicUpdateHandler(M);\n  }\n  _updateHighlight() {\n    const t = Array.from(this._highlightIds.keys()),\n      e = m(\"highlight\");\n    this._graphicsView.setHighlight(t.map(t => ({\n      objectId: t,\n      highlightFlags: e\n    })));\n  }\n};\nt([h()], v.prototype, \"_graphics\", void 0), t([h()], v.prototype, \"_routeItems\", null), v = t([n(\"esri.views.2d.layers.RouteLayerView2D\")], v);\nconst F = v;\nexport { F as default };"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,IAAMA,KAAI,CAAC,cAAc,kBAAkB,mBAAmB,mBAAmB,oBAAoB,iBAAiB,MAAM;AAA5H,IACE,IAAI;AAAA,EACF,SAAS;AAAA,EACT,UAAU;AAAA,EACV,UAAU;AAAA,EACV,UAAU;AACZ;AACF,SAASC,GAAEC,IAAG;AACZ,SAAOA,cAAa,KAAKA,cAAaC,MAAKD,cAAa,KAAKA,cAAa,KAAKA,cAAa,KAAKA,cAAa,KAAKA,cAAa;AAClI;AACA,SAAS,EAAEA,IAAG;AACZ,SAAO,EAAE,aAAaA,EAAC,KAAKA,GAAE,UAAUD,GAAEC,GAAE,GAAG,CAAC,CAAC;AACnD;AACA,SAAS,EAAEA,IAAG;AACZ,SAAO,MAAM,QAAQA,EAAC,KAAKA,GAAE,SAAS,KAAKD,GAAEC,GAAE,CAAC,CAAC;AACnD;AACA,IAAI,IAAI,cAAc,EAAEC,EAAC,EAAE;AAAA,EACzB,cAAc;AACZ,UAAM,GAAG,SAAS,GAAG,KAAK,YAAY,IAAI,EAAE,GAAG,KAAK,gBAAgB,oBAAI,IAAI,GAAG,KAAK,qBAAqB,oBAAI,IAAI,GAAG,KAAK,qBAAqB,oBAAI,IAAI;AAAA,EACxJ;AAAA,EACA,IAAI,cAAc;AAChB,WAAO,IAAI,EAAE;AAAA,MACX,gBAAgB,MAAM,QAAQ,KAAK,SAAS,KAAK,YAAY,CAAC,IAAI,CAAC,QAAQ,KAAK,MAAM,YAAY,IAAI,EAAE,CAAC,KAAK,MAAM,SAAS,CAAC,IAAI,MAAM,KAAK,MAAM,gBAAgB,KAAK,MAAM,iBAAiB,KAAK,MAAM,iBAAiB,KAAK,MAAM,kBAAkB,KAAK,MAAM,eAAe,KAAK,MAAM,KAAK;AAAA,IACpS,CAAC;AAAA,EACH;AAAA,EACA,aAAa;AACX,SAAK,iBAAiB,sBAAsB,MAAM,KAAK,aAAa,CAAAD,OAAK,KAAK,mBAAmBA,EAAC,GAAG,CAAC;AAAA,EACxG;AAAA,EACA,UAAU;AACR,SAAK,mBAAmB,MAAM,GAAG,KAAK,mBAAmB,MAAM,GAAG,KAAK,UAAU,UAAU,GAAG,KAAK,KAAK,aAAa,GAAG,QAAQ;AAAA,EAClI;AAAA,EACA,SAAS;AACP,SAAK,oBAAoB;AAAA,EAC3B;AAAA,EACA,SAAS;AACP,SAAK,qBAAqB;AAAA,EAC5B;AAAA,EACM,6BAA6BA,IAAGE,IAAG;AAAA;AACvC,aAAO,KAAK,cAAc,QAAQF,EAAC,EAAE,OAAO,CAAC;AAAA,QAC3C,eAAeA;AAAA,MACjB,MAAM,CAAC,CAACA,EAAC;AAAA,IACX;AAAA;AAAA,EACA,UAAUA,IAAG;AACX,QAAI;AACJ,QAAID,GAAEC,EAAC,IAAI,CAAC,KAAK,sBAAsBA,EAAC,CAAC,IAAI,EAAEA,EAAC,IAAIA,GAAE,IAAI,CAAAA,OAAK,KAAK,sBAAsBA,EAAC,CAAC,IAAI,EAAEA,EAAC,IAAIA,GAAE,IAAI,CAAAA,OAAK,KAAK,sBAAsBA,EAAC,CAAC,EAAE,QAAQ,IAAI,CAACA,GAAE,GAAG;AACnK,UAAM,IAAI,EAAE,OAAO,CAAC;AACpB,WAAO,EAAE,UAAU,KAAK,cAAc,CAAC,GAAG,EAAE,MAAM,KAAK,iBAAiB,CAAC,CAAC,KAAK,EAAE;AAAA,EACnF;AAAA,EACM,QAAQA,IAAG,GAAG;AAAA;AAClB,UAAI,KAAK,UAAW,QAAO;AAC3B,YAAM,IAAI,KAAK,cAAc,QAAQA,EAAC,EAAE,OAAO,CAAC,EAAE,IAAI,CAAAA,OAAK,KAAK,mBAAmB,IAAIA,EAAC,CAAC;AACzF,UAAI,CAAC,EAAE,OAAQ,QAAO;AACtB,YAAM;AAAA,QACJ,OAAO;AAAA,MACT,IAAI;AACJ,aAAO,EAAE,QAAQ,EAAE,IAAI,CAAAE,QAAM;AAAA,QAC3B,MAAM;AAAA,QACN,OAAO;AAAA,QACP,UAAUF;AAAA,QACV,gBAAgBE;AAAA,MAClB,EAAE;AAAA,IACJ;AAAA;AAAA,EACA,aAAa;AACX,WAAO,KAAK,cAAc;AAAA,EAC5B;AAAA,EACA,UAAU;AAAA,EAAC;AAAA,EACX,OAAOF,IAAG;AACR,SAAK,cAAc,cAAcA,EAAC;AAAA,EACpC;AAAA,EACA,aAAa;AACX,SAAK,cAAc,WAAW;AAAA,EAChC;AAAA,EACA,cAAcA,IAAG;AACf,eAAWE,MAAKF,GAAG,KAAI,KAAK,cAAc,IAAIE,EAAC,GAAG;AAChD,YAAMF,KAAI,KAAK,cAAc,IAAIE,EAAC;AAClC,WAAK,cAAc,IAAIA,IAAGF,KAAI,CAAC;AAAA,IACjC,MAAO,MAAK,cAAc,IAAIE,IAAG,CAAC;AAClC,SAAK,iBAAiB;AAAA,EACxB;AAAA,EACA,eAAeF,IAAG;AAChB,UAAME,KAAIF,GAAE,UAAU;AACtB,WAAOE,GAAE,QAAQ,KAAK,OAAOA,GAAE,cAAc,KAAK,OAAOA;AAAA,EAC3D;AAAA,EACA,sBAAsB;AACpB,UAAMF,KAAI,KAAK,MACbE,KAAI,MAAM,KAAK,cAAc,GAC7B,IAAI,IAAIF,GAAEA,GAAE,oBAAoB;AAClC,SAAK,gBAAgB,IAAID,GAAE;AAAA,MACzB,WAAW;AAAA,MACX,UAAU,KAAK;AAAA,MACf,uBAAuBG;AAAA,MACvB,MAAMF;AAAA,IACR,CAAC,GAAG,KAAK,UAAU,SAAS,CAAC,GAAG,KAAK,iBAAiB;AAAA,EACxD;AAAA,EACA,uBAAuB;AACrB,SAAK,UAAU,YAAY,KAAK,cAAc,SAAS,GAAG,KAAK,cAAc,QAAQ;AAAA,EACvF;AAAA,EACA,cAAcA,IAAG;AACf,UAAME,KAAI,KAAK,mBAAmB,IAAIF,EAAC;AACvC,WAAOF,GAAE,QAAQI,GAAE,IAAI;AAAA,EACzB;AAAA,EACA,sBAAsBF,IAAG;AACvB,WAAO,KAAK,mBAAmB,IAAIA,EAAC,IAAI,KAAK,mBAAmB,IAAIA,EAAC,EAAE,MAAM;AAAA,EAC/E;AAAA,EACA,iBAAiBA,IAAG;AAClB,eAAWE,MAAKF,GAAG,KAAI,KAAK,cAAc,IAAIE,EAAC,GAAG;AAChD,YAAMF,KAAI,KAAK,cAAc,IAAIE,EAAC,IAAI;AACtC,YAAMF,KAAI,KAAK,cAAc,OAAOE,EAAC,IAAI,KAAK,cAAc,IAAIA,IAAGF,EAAC;AAAA,IACtE;AACA,SAAK,iBAAiB;AAAA,EACxB;AAAA,EACA,mBAAmBA,IAAG;AACpB,QAAIA,GAAE,QAAQ,QAAQ;AACpB,WAAK,UAAU,WAAWA,GAAE,QAAQ,IAAI,CAAAA,OAAK;AAC3C,cAAME,KAAI,KAAK,mBAAmB,IAAIF,EAAC;AACvC,eAAO,KAAK,mBAAmB,OAAOA,EAAC,GAAG,KAAK,mBAAmB,OAAOE,EAAC,GAAGA;AAAA,MAC/E,CAAC,CAAC;AACF,iBAAWA,MAAKF,GAAE,QAAS,MAAK,cAAcE,EAAC;AAAA,IACjD;AACA,QAAIF,GAAE,MAAM,QAAQ;AAClB,WAAK,UAAU,QAAQA,GAAE,MAAM,IAAI,CAAAA,OAAK;AACtC,cAAME,KAAI,KAAK,eAAeF,EAAC;AAC/B,eAAO,QAAQE,GAAE,SAAS,QAAQ,KAAK,mBAAmB,IAAIF,IAAGE,EAAC,GAAG,KAAK,mBAAmB,IAAIA,IAAGF,EAAC,GAAGE;AAAA,MAC1G,CAAC,EAAE,OAAO,CAAC,CAAC;AACZ,iBAAWA,MAAKF,GAAE,MAAO,MAAK,WAAW,CAAC,EAAE,MAAME,GAAE,UAAU,CAACF,IAAG,MAAM;AACtE,aAAK,eAAeE,IAAG,YAAYF,IAAG,CAAC;AAAA,MACzC,CAAC,GAAG,EAAE,MAAME,GAAE,QAAQ,CAACF,IAAG,MAAM;AAC9B,aAAK,eAAeE,IAAG,UAAUF,IAAG,CAAC;AAAA,MACvC,CAAC,CAAC,GAAGE,EAAC;AACN,WAAK,UAAU,KAAK,CAACF,IAAGE,OAAM,KAAK,cAAcF,EAAC,IAAI,KAAK,cAAcE,EAAC,CAAC;AAAA,IAC7E;AAAA,EACF;AAAA,EACA,eAAeF,IAAGE,IAAG,GAAG,GAAG;AACzB,QAAI,CAAC,KAAK,mBAAmB,IAAIF,EAAC,GAAG;AACnC,YAAME,KAAI,KAAK,eAAeF,EAAC;AAC/B,aAAO,KAAK,mBAAmB,IAAIA,IAAGE,EAAC,GAAG,KAAK,mBAAmB,IAAIA,IAAGF,EAAC,GAAG,KAAK,KAAK,UAAU,IAAIE,EAAC;AAAA,IACxG;AACA,UAAM,IAAI,KAAK,mBAAmB,IAAIF,EAAC;AACvC,MAAEE,EAAC,IAAI,GAAG,EAAE,UAAU,GAAG,EAAE,WAAWA,IAAG,EAAE,WAAW,GAAG,EAAE,WAAW,GAAG,KAAK,cAAc,qBAAqB,CAAC;AAAA,EACpH;AAAA,EACA,mBAAmB;AACjB,UAAMF,KAAI,MAAM,KAAK,KAAK,cAAc,KAAK,CAAC,GAC5CE,KAAI,EAAE,WAAW;AACnB,SAAK,cAAc,aAAaF,GAAE,IAAI,CAAAA,QAAM;AAAA,MAC1C,UAAUA;AAAA,MACV,gBAAgBE;AAAA,IAClB,EAAE,CAAC;AAAA,EACL;AACF;AACAA,GAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,aAAa,MAAM,GAAGA,GAAE,CAAC,EAAE,CAAC,GAAG,EAAE,WAAW,eAAe,IAAI,GAAG,IAAIA,GAAE,CAAC,EAAE,uCAAuC,CAAC,GAAG,CAAC;AAC7I,IAAM,IAAI;",
  "names": ["j", "V", "t", "y", "e"]
}
