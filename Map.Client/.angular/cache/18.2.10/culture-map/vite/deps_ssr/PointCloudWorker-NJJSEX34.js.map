{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../core/arrayUtils.js\";\nimport { isArrayBuffer as r } from \"../../../core/typedArrayUtil.js\";\nimport { conjugate as e } from \"../../../core/libs/gl-matrix-2/math/quat.js\";\nimport { create as o } from \"../../../core/libs/gl-matrix-2/factories/quatf64.js\";\nimport { u as a } from \"../../../chunks/vec32.js\";\nimport { clone as i, create as f } from \"../../../core/libs/gl-matrix-2/factories/vec3f32.js\";\nimport n from \"../../../geometry/SpatialReference.js\";\nimport { projectBuffer as s } from \"../../../geometry/projection/projectBuffer.js\";\nimport { readGeometry as u, getAttributeValues as l, evaluateRenderer as m, filterInPlace as b } from \"./i3s/PointCloudWorkerUtil.js\";\nimport { Obb as p } from \"../support/orientedBoundingBox.js\";\nclass c {\n  transform(t) {\n    const e = this._transform(t),\n      o = [e.points.buffer, e.rgb.buffer];\n    null != e.pointIdFilterMap && o.push(e.pointIdFilterMap.buffer);\n    for (const a of e.attributes) \"buffer\" in a.values && r(a.values.buffer) && a.values.buffer !== e.rgb.buffer && o.push(a.values.buffer);\n    return Promise.resolve({\n      result: e,\n      transferList: o\n    });\n  }\n  _transform(r) {\n    const e = u(r.schema, r.geometryBuffer);\n    let o = e.length / 3,\n      a = null;\n    const i = new Array(),\n      f = l(r.primaryAttributeData, e, o);\n    null != r.primaryAttributeData && f && i.push({\n      attributeInfo: r.primaryAttributeData.attributeInfo,\n      values: f\n    });\n    const s = l(r.modulationAttributeData, e, o);\n    null != r.modulationAttributeData && s && i.push({\n      attributeInfo: r.modulationAttributeData.attributeInfo,\n      values: s\n    });\n    let c = m(r.rendererInfo, f, s, o);\n    if (r.filterInfo && r.filterInfo.length > 0 && null != r.filterAttributesData) {\n      const f = r.filterAttributesData.filter(t).map(t => {\n        const r = l(t, e, o),\n          a = {\n            attributeInfo: t.attributeInfo,\n            values: r\n          };\n        return i.push(a), a;\n      });\n      a = new Uint32Array(o), o = b(e, c, a, r.filterInfo, f);\n    }\n    for (const t of r.userAttributesData) {\n      const r = l(t, e, o);\n      i.push({\n        attributeInfo: t.attributeInfo,\n        values: r\n      });\n    }\n    3 * o < c.length && (c = new Uint8Array(c.buffer.slice(0, 3 * o))), I(e, o, r.elevationOffset);\n    const A = h(e, o, p.fromData(r.obbData), n.fromJSON(r.inSR), n.fromJSON(r.outSR));\n    return {\n      obbData: r.obbData,\n      points: A,\n      rgb: c,\n      attributes: i,\n      pointIdFilterMap: a\n    };\n  }\n}\nfunction h(t, r, o, n, u) {\n  if (!s(t, n, 0, t, u, 0, r)) throw new Error(\"Can't reproject\");\n  const l = i(o.center),\n    m = f(),\n    b = f(),\n    p = i(o.halfSize);\n  e(A, o.quaternion);\n  const c = new Float32Array(3 * r);\n  for (let e = 0; e < r; e++) {\n    let r = 3 * e;\n    m[0] = t[r] - l[0], m[1] = t[r + 1] - l[1], m[2] = t[r + 2] - l[2], a(b, m, A), p[0] = Math.max(p[0], Math.abs(b[0])), p[1] = Math.max(p[1], Math.abs(b[1])), p[2] = Math.max(p[2], Math.abs(b[2])), c[r++] = m[0], c[r++] = m[1], c[r] = m[2];\n  }\n  return o.halfSize = p, c;\n}\nfunction I(t, r, e) {\n  if (0 !== e) for (let o = 0; o < r; o++) t[3 * o + 2] += e;\n}\nconst A = o();\nfunction g() {\n  return new c();\n}\nexport { g as default };"],
  "mappings": "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",
  "names": ["c", "t", "e", "i", "f", "r", "a", "I", "A", "n", "u", "O"]
}
