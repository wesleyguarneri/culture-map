{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/FeatureCollectionSnappingSource.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport { memoize as i } from \"../../../../core/memoize.js\";\nimport { throwIfAborted as n, whenOrAbort as o } from \"../../../../core/promiseUtils.js\";\nimport { watch as r, initial as a, on as s } from \"../../../../core/reactiveUtils.js\";\nimport { property as p } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/Logger.js\";\nimport \"../../../../core/RandomLCG.js\";\nimport { subclass as l } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { elevationContextAffectsAlignment as y } from \"../../../../support/elevationInfoUtils.js\";\nimport { makeFilter as c, makeSnappingQuery as g } from \"../snappingUtils.js\";\nimport { convertSnappingCandidate as u, makeGetGroundElevation as h } from \"./queryEngineUtils.js\";\nimport { getSnappingCandidateElevationAligner as m } from \"./snappingCandidateElevationAlignment.js\";\nimport { getSnappingCandidateElevationFilter as d } from \"./snappingCandidateElevationFilter.js\";\nimport { getSymbologySnappingCandidatesFetcher as v } from \"./symbologySnappingCandidates.js\";\nlet S = class extends t {\n  get availability() {\n    return 1;\n  }\n  get updating() {\n    return this.layerSource.updating;\n  }\n  get _snappingElevationAligner() {\n    const {\n        view: e\n      } = this,\n      {\n        layer: t\n      } = this.layerSource,\n      i = null != e && \"3d\" === e.type;\n    if (!i || \"subtype-group\" === t.type) return m();\n    const n = async (i, n) => (await o(e.whenLayerView(t), n)).elevationAlignPointsInFeatures(i, n);\n    return m(i, {\n      elevationInfo: t.elevationInfo,\n      alignPointsInFeatures: n\n    });\n  }\n  get _snappingElevationFilter() {\n    const {\n        view: e\n      } = this,\n      t = null != e && \"3d\" === e.type && \"subtype-group\" !== this.layerSource.layer.type;\n    return d(t);\n  }\n  get _symbologySnappingFetcher() {\n    const {\n        view: e\n      } = this,\n      {\n        layer: t\n      } = this.layerSource;\n    return null != e && \"3d\" === e.type && \"subtype-group\" !== t.type ? v(this._symbologySnappingSupported, async (i, o) => {\n      const r = await e.whenLayerView(t);\n      return n(o), r.queryForSymbologySnapping({\n        candidates: i,\n        spatialReference: e.spatialReference\n      }, o);\n    }) : v();\n  }\n  get _symbologySnappingSupported() {\n    return null != this._layerView3D && this._layerView3D.symbologySnappingSupported;\n  }\n  initialize() {\n    const {\n        view: e\n      } = this,\n      {\n        layer: t\n      } = this.layerSource;\n    null != e && \"3d\" === e.type && \"subtype-group\" !== t.type && (e.whenLayerView(t).then(e => this._layerView3D = e), this.addHandles([e.elevationProvider.on(\"elevation-change\", ({\n      context: e\n    }) => {\n      const {\n        elevationInfo: i\n      } = t;\n      y(e, i) && this._snappingElevationAligner.notifyElevationSourceChange();\n    }), r(() => t.elevationInfo, () => this._snappingElevationAligner.notifyElevationSourceChange(), a), r(() => null != this._layerView3D ? this._layerView3D.layer?.renderer : null, () => this._symbologySnappingFetcher.notifySymbologyChange(), a), s(() => this._layerView3D?.layer, [\"edits\", \"apply-edits\", \"graphic-update\"], () => this._symbologySnappingFetcher.notifySymbologyChange())]));\n  }\n  constructor(e) {\n    super(e), this.view = null, this._layerView3D = null, this._memoizedMakeGetGroundElevation = i(h);\n  }\n  refresh() {}\n  async fetchCandidates(e, t) {\n    const {\n        layer: i\n      } = this.layerSource,\n      o = i.source;\n    if (!o?.querySnapping) return [];\n    const r = c(i),\n      a = g(e, this.view?.type ?? \"2d\", r),\n      s = await o.querySnapping(a, {\n        signal: t\n      });\n    n(t);\n    const p = e.coordinateHelper.spatialReference,\n      l = await this._snappingElevationAligner.alignCandidates(s.candidates, p, t);\n    n(t);\n    const y = await this._symbologySnappingFetcher.fetch(l, t);\n    n(t);\n    const h = 0 === y.length ? l : [...l, ...y],\n      m = this._snappingElevationFilter.filter(a, h),\n      d = this._memoizedMakeGetGroundElevation(this.view, p);\n    return m.map(e => u(e, d));\n  }\n};\ne([p({\n  constructOnly: !0\n})], S.prototype, \"layerSource\", void 0), e([p({\n  constructOnly: !0\n})], S.prototype, \"view\", void 0), e([p()], S.prototype, \"_snappingElevationAligner\", null), e([p()], S.prototype, \"_snappingElevationFilter\", null), e([p()], S.prototype, \"_symbologySnappingFetcher\", null), e([p()], S.prototype, \"_layerView3D\", void 0), e([p()], S.prototype, \"_symbologySnappingSupported\", null), S = e([l(\"esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource\")], S);\nexport { S as FeatureCollectionSnappingSource };"],
  "mappings": "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",
  "names": ["S", "e", "t", "i", "n", "o", "r", "y", "a", "s", "h", "d"]
}
