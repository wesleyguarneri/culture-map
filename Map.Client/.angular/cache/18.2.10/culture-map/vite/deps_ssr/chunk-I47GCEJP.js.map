{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../../chunks/tslib.es6.js\";\nimport { normalFromMat4 as r } from \"../../../../../../core/libs/gl-matrix-2/math/mat3.js\";\nimport { create as o } from \"../../../../../../core/libs/gl-matrix-2/factories/mat3f64.js\";\nimport { IDENTITY as a } from \"../../../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";\nimport { s as n } from \"../../../../../../chunks/vec32.js\";\nimport { create as i } from \"../../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";\nimport { ShaderOutput as t } from \"../ShaderOutput.js\";\nimport { DoublePrecision as s } from \"../util/DoublePrecision.glsl.js\";\nimport { addViewNormal as l } from \"../util/View.glsl.js\";\nimport { Float3DrawUniform as m } from \"../../shaderModules/Float3DrawUniform.js\";\nimport { NoParameters as c, glsl as d } from \"../../shaderModules/interfaces.js\";\nimport { Matrix3PassUniform as u } from \"../../shaderModules/Matrix3PassUniform.js\";\nimport { Matrix4PassUniform as p } from \"../../shaderModules/Matrix4PassUniform.js\";\nimport { ShaderTechniqueConfiguration as v, parameter as f } from \"../../shaderTechnique/ShaderTechniqueConfiguration.js\";\nimport { VertexAttribute as g } from \"../../../lib/VertexAttribute.js\";\nimport { encodeDoubleHi as x, encodeDoubleLo as M } from \"../../../../../webgl/doublePrecisionUtils.js\";\nclass O extends v {\n  constructor() {\n    super(...arguments), this.instancedDoublePrecision = !1, this.hasModelTransformation = !1;\n  }\n}\ne([f()], O.prototype, \"instancedDoublePrecision\", void 0), e([f()], O.prototype, \"hasModelTransformation\", void 0);\nclass w extends c {\n  constructor() {\n    super(...arguments), this.modelTransformation = null;\n  }\n}\nconst h = o();\nfunction N(e, o) {\n  const i = o.hasModelTransformation,\n    c = o.instancedDoublePrecision;\n  i && (e.vertex.uniforms.add(new p(\"model\", e => e.modelTransformation ?? a)), e.vertex.uniforms.add(new u(\"normalLocalOriginFromModel\", e => (r(h, e.modelTransformation ?? a), h)))), o.instanced && c && (e.attributes.add(g.INSTANCEMODELORIGINHI, \"vec3\"), e.attributes.add(g.INSTANCEMODELORIGINLO, \"vec3\"), e.attributes.add(g.INSTANCEMODEL, \"mat3\"), e.attributes.add(g.INSTANCEMODELNORMAL, \"mat3\"));\n  const v = e.vertex;\n  c && (v.include(s, o), v.uniforms.add(new m(\"viewOriginHi\", (e, r) => x(n(T, r.camera.viewInverseTransposeMatrix[3], r.camera.viewInverseTransposeMatrix[7], r.camera.viewInverseTransposeMatrix[11]), T)), new m(\"viewOriginLo\", (e, r) => M(n(T, r.camera.viewInverseTransposeMatrix[3], r.camera.viewInverseTransposeMatrix[7], r.camera.viewInverseTransposeMatrix[11]), T)))), v.code.add(d`\n    vec3 getVertexInLocalOriginSpace() {\n      return ${i ? c ? \"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz\" : \"(model * localPosition()).xyz\" : c ? \"instanceModel * localPosition().xyz\" : \"localPosition().xyz\"};\n    }\n\n    vec3 subtractOrigin(vec3 _pos) {\n      ${c ? d`\n          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped\n          // working for macOS 14+ and iOS 17+.\n          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280\n          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);\n          return _pos - originDelta;` : \"return vpos;\"}\n    }\n    `), v.code.add(d`\n    vec3 dpNormal(vec4 _normal) {\n      return normalize(${i ? c ? \"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)\" : \"normalLocalOriginFromModel * _normal.xyz\" : c ? \"instanceModelNormal * _normal.xyz\" : \"_normal.xyz\"});\n    }\n    `), o.output === t.Normal && (l(v), v.code.add(d`\n    vec3 dpNormalView(vec4 _normal) {\n      return normalize((viewNormal * ${i ? c ? \"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)\" : \"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)\" : c ? \"vec4(instanceModelNormal * _normal.xyz, 1.0)\" : \"_normal\"}).xyz);\n    }\n    `)), o.hasVertexTangents && v.code.add(d`\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ${i ? c ? \"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);\" : \"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);\" : c ? \"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);\" : \"return _tangent;\"}\n    }`);\n}\nconst T = i();\nexport { O as InstancedDoubleConfiguration, w as InstancedDoublePassParameters, N as InstancedDoublePrecision };"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,IAAM,IAAN,cAAgB,EAAE;AAAA,EAChB,cAAc;AACZ,UAAM,GAAG,SAAS,GAAG,KAAK,2BAA2B,OAAI,KAAK,yBAAyB;AAAA,EACzF;AACF;AACA,EAAE,CAACA,GAAE,CAAC,GAAG,EAAE,WAAW,4BAA4B,MAAM,GAAG,EAAE,CAACA,GAAE,CAAC,GAAG,EAAE,WAAW,0BAA0B,MAAM;AAMjH,IAAM,IAAIC,GAAE;AACZ,SAAS,EAAEA,IAAGC,IAAG;AACf,QAAM,IAAIA,GAAE,wBACVC,KAAID,GAAE;AACR,QAAMD,GAAE,OAAO,SAAS,IAAI,IAAIA,GAAE,SAAS,CAAAA,OAAKA,GAAE,uBAAuBC,EAAC,CAAC,GAAGD,GAAE,OAAO,SAAS,IAAI,IAAIA,GAAE,8BAA8B,CAAAA,QAAM,EAAE,GAAGA,GAAE,uBAAuBC,EAAC,GAAG,EAAE,CAAC,IAAIA,GAAE,aAAaC,OAAMF,GAAE,WAAW,IAAIA,GAAE,uBAAuB,MAAM,GAAGA,GAAE,WAAW,IAAIA,GAAE,uBAAuB,MAAM,GAAGA,GAAE,WAAW,IAAIA,GAAE,eAAe,MAAM,GAAGA,GAAE,WAAW,IAAIA,GAAE,qBAAqB,MAAM;AAC3Y,QAAM,IAAIA,GAAE;AACZ,EAAAE,OAAM,EAAE,QAAQ,GAAGD,EAAC,GAAG,EAAE,SAAS,IAAI,IAAIA,GAAE,gBAAgB,CAACD,IAAGG,OAAMF,GAAE,EAAE,GAAGE,GAAE,OAAO,2BAA2B,CAAC,GAAGA,GAAE,OAAO,2BAA2B,CAAC,GAAGA,GAAE,OAAO,2BAA2B,EAAE,CAAC,GAAG,CAAC,CAAC,GAAG,IAAIF,GAAE,gBAAgB,CAACD,IAAGG,OAAM,EAAE,EAAE,GAAGA,GAAE,OAAO,2BAA2B,CAAC,GAAGA,GAAE,OAAO,2BAA2B,CAAC,GAAGA,GAAE,OAAO,2BAA2B,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,IAAIF;AAAA;AAAA,eAElX,IAAIC,KAAI,iEAAiE,kCAAkCA,KAAI,wCAAwC,qBAAqB;AAAA;AAAA;AAAA;AAAA,QAInLA,KAAID;AAAA;AAAA;AAAA;AAAA;AAAA,wCAK4B,cAAc;AAAA;AAAA,KAEjD,GAAG,EAAE,KAAK,IAAIA;AAAA;AAAA,yBAEM,IAAIC,KAAI,qEAAqE,6CAA6CA,KAAI,sCAAsC,aAAa;AAAA;AAAA,KAErM,GAAGD,GAAE,WAAWA,GAAE,WAAW,EAAE,CAAC,GAAG,EAAE,KAAK,IAAIA;AAAA;AAAA,uCAEZ,IAAIC,KAAI,gFAAgF,wDAAwDA,KAAI,iDAAiD,SAAS;AAAA;AAAA,KAEhP,IAAID,GAAE,qBAAqB,EAAE,KAAK,IAAIA;AAAA;AAAA,QAEnC,IAAIC,KAAI,gGAAgG,wEAAwEA,KAAI,iEAAiE,kBAAkB;AAAA,MACzQ;AACN;AACA,IAAM,IAAI,EAAE;",
  "names": ["r", "e", "o", "c", "r"]
}
