import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  a as a2
} from "./chunk-ARMSKPOE.js";
import "./chunk-IA5UKRA2.js";
import "./chunk-7HWP2QWI.js";
import "./chunk-DUZT23UA.js";
import "./chunk-CP2IGGT7.js";
import "./chunk-ZEZCWQFR.js";
import "./chunk-WXECQAUG.js";
import "./chunk-CATQ6UZ5.js";
import "./chunk-MIWJLMUG.js";
import "./chunk-MDOKECP3.js";
import "./chunk-IVVINOEJ.js";
import {
  d as d2,
  h as h3
} from "./chunk-DUSY4H5O.js";
import "./chunk-XUM2DDAI.js";
import {
  te
} from "./chunk-BV256A2V.js";
import "./chunk-KJGRJNY4.js";
import "./chunk-AJ474NL3.js";
import "./chunk-X3HF4XA3.js";
import "./chunk-2NPPOPEZ.js";
import "./chunk-JP4VYCP3.js";
import "./chunk-BKOZEXTL.js";
import "./chunk-NLRSH3TD.js";
import "./chunk-3Q4YEFJ3.js";
import "./chunk-K6JW77RY.js";
import "./chunk-377KSYNB.js";
import "./chunk-KRRPY5PU.js";
import "./chunk-YUYMEQ3T.js";
import "./chunk-ZTTGFJJT.js";
import "./chunk-TFCCIKDP.js";
import "./chunk-FT6GF7ST.js";
import {
  g
} from "./chunk-VFAQK3MV.js";
import "./chunk-IQWWKVQ4.js";
import {
  E,
  I as I2,
  m as m2
} from "./chunk-4B3LNBOC.js";
import {
  e as e7
} from "./chunk-KAKCJGSZ.js";
import "./chunk-FSYMZVRK.js";
import {
  C
} from "./chunk-T4DTOVU4.js";
import "./chunk-TDVWRWD6.js";
import "./chunk-GYNRSS5Q.js";
import "./chunk-TO2KOAJE.js";
import "./chunk-JZISCETB.js";
import "./chunk-DM6DHTKZ.js";
import "./chunk-OEBP4L4N.js";
import "./chunk-UT2ZOLZR.js";
import "./chunk-DTMLHZFB.js";
import {
  l as l2
} from "./chunk-ECUSUVZM.js";
import "./chunk-CQIKG7VH.js";
import "./chunk-JRL65HQ7.js";
import {
  y as y2
} from "./chunk-CXYUBZAK.js";
import {
  c as c2
} from "./chunk-LUORW76W.js";
import {
  _
} from "./chunk-62PN4TEW.js";
import "./chunk-OPXEKSUB.js";
import {
  e as e6
} from "./chunk-H5GZAILH.js";
import "./chunk-ZCCDVQ3H.js";
import "./chunk-T2SCEBLQ.js";
import {
  m
} from "./chunk-B5L6EMPL.js";
import {
  j
} from "./chunk-YYCVXVUF.js";
import "./chunk-FW7J76DZ.js";
import "./chunk-PZKTCBLJ.js";
import "./chunk-O7RCHW3H.js";
import "./chunk-N4FQBAT2.js";
import "./chunk-K7U66W6G.js";
import {
  I
} from "./chunk-WQMUOLHB.js";
import "./chunk-LVERV6OU.js";
import "./chunk-3FFTEL3W.js";
import "./chunk-4WON4QDF.js";
import "./chunk-45GTM6LF.js";
import "./chunk-XUZTWNKD.js";
import "./chunk-Q5PBA64J.js";
import "./chunk-TIAWSZQK.js";
import {
  N
} from "./chunk-KWHFMZEB.js";
import "./chunk-FBMJVQWQ.js";
import "./chunk-WUTM5T74.js";
import "./chunk-ONVI4SC3.js";
import "./chunk-2IRGMYX2.js";
import "./chunk-OU2TYICP.js";
import "./chunk-DZAXDRPA.js";
import "./chunk-AA5NMQ6N.js";
import "./chunk-Z4PRO5ND.js";
import "./chunk-MHGADXDL.js";
import "./chunk-VYJ7IUDT.js";
import "./chunk-2ZXVDYHF.js";
import "./chunk-22UDIQGJ.js";
import "./chunk-XFLPRRYT.js";
import "./chunk-Z5ZLX3BE.js";
import "./chunk-23Q4INNG.js";
import "./chunk-LZSSTWLW.js";
import "./chunk-ALQIX2AS.js";
import "./chunk-D3VQCVGJ.js";
import "./chunk-PFTDB6ZJ.js";
import "./chunk-FCVY35OB.js";
import "./chunk-TSTMST4X.js";
import "./chunk-I47GCEJP.js";
import "./chunk-LA4GCRJY.js";
import "./chunk-ZTMARHUQ.js";
import "./chunk-P5MJSFMN.js";
import "./chunk-HMPRRFR4.js";
import "./chunk-UE7ZYRIH.js";
import "./chunk-W24M6HII.js";
import "./chunk-FWGI52X4.js";
import "./chunk-E5RXQH35.js";
import "./chunk-62ZEBDPC.js";
import "./chunk-ZFMS3XGM.js";
import "./chunk-QWQJOAVR.js";
import "./chunk-YLQMUXQA.js";
import "./chunk-4U7LUZFD.js";
import "./chunk-T257OY4U.js";
import "./chunk-BMO2W6EC.js";
import "./chunk-QA265FYQ.js";
import "./chunk-HUOFTIIK.js";
import "./chunk-ZDFN6OZC.js";
import "./chunk-DUV7OLAZ.js";
import "./chunk-KSOKDIBG.js";
import "./chunk-3NWWTJOW.js";
import "./chunk-TRF6JO5N.js";
import "./chunk-ZHVMMFTW.js";
import "./chunk-HKAONIBH.js";
import "./chunk-2B3WLK32.js";
import "./chunk-EPIUUGS2.js";
import "./chunk-TMXHZTIG.js";
import "./chunk-FIQ7DCCC.js";
import "./chunk-SNHVHW2N.js";
import "./chunk-MDEPINSI.js";
import {
  M
} from "./chunk-U4NXHH3L.js";
import "./chunk-QATJRB5Q.js";
import "./chunk-7Z4UWMRU.js";
import "./chunk-WHVSAUHM.js";
import "./chunk-GHPF24X4.js";
import "./chunk-UC4DX4SE.js";
import "./chunk-44O4APOL.js";
import "./chunk-LCPLUSDH.js";
import "./chunk-KINQ7OJ3.js";
import {
  D
} from "./chunk-KYLW5XXS.js";
import "./chunk-DLWZ3HVT.js";
import {
  S as S3,
  o as o2
} from "./chunk-B76NC7GX.js";
import {
  h as h2
} from "./chunk-HFXXFWYN.js";
import "./chunk-EXKCGLRO.js";
import "./chunk-WRLGLGM6.js";
import "./chunk-47DYJR3W.js";
import "./chunk-QRWQ6QBB.js";
import "./chunk-F4FQ67JP.js";
import "./chunk-ZSJNH2BT.js";
import "./chunk-2W7YKBRA.js";
import "./chunk-VFYCIIDC.js";
import "./chunk-RIZOHDTP.js";
import "./chunk-ZFES27RA.js";
import "./chunk-XP2AJZUL.js";
import "./chunk-CZA7RDJP.js";
import "./chunk-NCMX3DAD.js";
import "./chunk-BCNABTAE.js";
import "./chunk-3PPEJ4QJ.js";
import "./chunk-ZEOLGKXL.js";
import "./chunk-HITI6WDM.js";
import "./chunk-IS4RJOPJ.js";
import "./chunk-XK3CKE5Q.js";
import "./chunk-AMH7CZMY.js";
import "./chunk-EAVSYZXD.js";
import "./chunk-7GHUVMBI.js";
import "./chunk-Q5JLNMWZ.js";
import "./chunk-AABDXAD3.js";
import "./chunk-LGS63R4F.js";
import "./chunk-L6FG3WIC.js";
import "./chunk-6ZLH7XBS.js";
import "./chunk-44ZUWZXU.js";
import "./chunk-NHYYZMJR.js";
import "./chunk-U4EMQMDC.js";
import "./chunk-AVCKPV77.js";
import {
  t
} from "./chunk-MNBTLVRM.js";
import "./chunk-GNCXYHNE.js";
import "./chunk-CSK4VZQ7.js";
import "./chunk-2TNGEJGS.js";
import "./chunk-OYGNGIHQ.js";
import "./chunk-GSG4T2KM.js";
import {
  e as e5
} from "./chunk-D7C26LZP.js";
import {
  n
} from "./chunk-BZHHBBFX.js";
import "./chunk-GK5M6FUR.js";
import "./chunk-MRP3FBLV.js";
import "./chunk-Y7SJWJAL.js";
import "./chunk-A2FDYA6M.js";
import "./chunk-YGAXDKHF.js";
import {
  e as e4
} from "./chunk-4TOSJLKR.js";
import "./chunk-ORYC4PVJ.js";
import "./chunk-DXIKKLD7.js";
import "./chunk-VQNXE43R.js";
import "./chunk-VZ37C3ID.js";
import "./chunk-FSG7HOZQ.js";
import "./chunk-Q5TIVVER.js";
import "./chunk-C7BQE556.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import "./chunk-KUBMHTYA.js";
import "./chunk-VSQZQLTQ.js";
import "./chunk-K43CZ3M5.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-S4XQLN73.js";
import "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-CXNERL22.js";
import "./chunk-7V4JSBFA.js";
import "./chunk-2EJFYNM7.js";
import "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-5X5U7R6O.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import {
  c
} from "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-2JI245BP.js";
import "./chunk-N34BRXVM.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import "./chunk-RNF7VOCU.js";
import "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import "./chunk-DCXDXGAR.js";
import "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import {
  h
} from "./chunk-2OZSYJDX.js";
import "./chunk-MZM4INJV.js";
import "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import {
  W2 as W
} from "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import "./chunk-JSKTDZU2.js";
import "./chunk-G73HQZEL.js";
import {
  A,
  P,
  d,
  v
} from "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e as e3
} from "./chunk-NUICEVIH.js";
import {
  S as S2
} from "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  a3 as a
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import {
  S,
  k
} from "./chunk-AIZ3T7E3.js";
import {
  e as e2,
  l,
  o
} from "./chunk-6UEMNP3E.js";
import {
  e,
  u
} from "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import {
  s2 as s
} from "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/views/3d/layers/support/MediaLayerInteraction.js
var j2 = Symbol();
var w = Symbol();
var E2 = 1;
var M2 = 10;
var O = class extends S2 {
  get updating() {
    return this._updatingHandles.updating;
  }
  get _preferredInteractionTool() {
    return this.options?.tool ?? "transform";
  }
  get _toolType() {
    switch (this._preferredInteractionTool) {
      case "transform":
        return "transform-3d";
      case "reshape":
        return "reshape-3d";
    }
  }
  get _validatedSelectedElement() {
    const e9 = this.selectedElement;
    if (!e9) return null;
    const {
      layer: {
        source: t2
      }
    } = this;
    return t2 ? "hasElement" in t2 ? t2.hasElement(e9) ? e9 : null : t2 === e9 ? e9 : null : null;
  }
  constructor(e9) {
    super(e9), this.enabled = false, this._updatingHandles = new h2(), this._isOpacityToggled = false, this._factor = E2, this._tool = null, this._object = null, this._createToolAbortController = null, this._onPointerMove = k((e10) => __async(this, null, function* () {
      const t2 = yield this._updatingHandles.addPromise(this._findElementAtScreenPoint(e10));
      this.destroyed || (this.removeHandles(w), t2 && t2 !== this.selectedElement && (this.view.cursor = "pointer", this.addHandles(e2(() => this.view.cursor = null), w)));
    })), this._tmpMat2 = e6(), this._tmpVec2 = n();
  }
  destroy() {
    this._createToolAbortController = e(this._createToolAbortController);
  }
  initialize() {
    this.addHandles([l(this._updatingHandles), this._updatingHandles.add(() => this.enabled, (e9) => this._enableDisable(e9), P), this._updatingHandles.add(() => this._preferredInteractionTool, (e9) => this._preferredInteractionToolChanged(e9))]);
  }
  _enableDisable(e9) {
    if (!e9) return void this.removeHandles(j2);
    this._dynamicImports();
    const {
      view: t2
    } = this, o3 = new h3();
    o3.add(d2.undo, () => {
      this._object?.operations?.undo(), this._object?.emit("modified-externally");
    }), o3.add(d2.redo, () => {
      this._object?.operations?.redo(), this._object?.emit("modified-externally");
    }), o3.addToggle(d2.preserveAspectRatio, (e10) => {
      "transform-3d" === this._tool?.type && (this._tool.preserveAspectRatio = "key-down" === e10.type);
    }), o3.addToggle(d2.rotateIncrements, (e10) => {
      "transform-3d" === this._tool?.type && (this._tool.snapRotation = "key-down" === e10.type);
    }), o3.add(d2.toggleOpacity, () => {
      const e10 = this._object?.element;
      e10 && (e10.opacity *= this._isOpacityToggled ? 2 : 0.5, this._isOpacityToggled = !this._isOpacityToggled);
    }), o3.add(d2.moveUp, () => this._move(0, this._factor)), o3.add(d2.moveDown, () => this._move(0, -this._factor)), o3.add(d2.moveRight, () => this._move(this._factor, 0)), o3.add(d2.moveLeft, () => this._move(-this._factor, 0)), o3.addToggle(d2.factorModifier, (e10) => this._factor = "key-down" === e10.type ? M2 : E2), this._isOpacityToggled = false, this.addHandles([o3.register(t2, _.TOOL), e2(() => {
      this._isOpacityToggled && this.selectedElement && (this.selectedElement.opacity *= 2, this._isOpacityToggled = false);
    }), t2.on("immediate-click", (e10) => this._onClick(e10), _.TOOL), t2.on("pointer-move", (e10) => this._onPointerMove(e10).catch(() => {
    }), _.TOOL), this._updatingHandles.add(() => this._validatedSelectedElement, (e10, t3) => {
      t3 && e10 !== t3 && this._isOpacityToggled && (t3.opacity *= 2, this._isOpacityToggled = false), this._selectedElementChanged(e10);
    }, P), e2(() => {
      t2.cursor = null, this._removeTool();
    })], j2);
  }
  _onClick(e9) {
    return __async(this, null, function* () {
      yield this._updatingHandles.addPromise(e9.async(() => __async(this, null, function* () {
        const t2 = yield this._findElementAtScreenPoint(e9);
        this.destroyed || (t2 && e9.stopPropagation(), this.selectedElement = t2, this.selectedElement && (this.view.cursor = null));
      })));
    });
  }
  _selectedElementChanged(e9) {
    return __async(this, null, function* () {
      e9?.georeference ? this._object?.element !== e9 && (yield this._updatingHandles.addPromise(this._recreateTool())) : this._removeTool();
    });
  }
  _recreateTool() {
    return __async(this, null, function* () {
      this._createToolAbortController = e(this._createToolAbortController), this._removeTool();
      const e9 = this._validatedSelectedElement;
      if (!e9) return;
      const t2 = new AbortController();
      this._createToolAbortController = t2;
      const {
        ManipulatedObject3DMediaElement: o3,
        ExtentTransformTool: s3,
        ReshapeTool3D: a3
      } = yield this._dynamicImports();
      if (t2.signal.aborted) return;
      const {
        view: l3,
        layer: d3,
        _toolType: c3
      } = this;
      switch (this._object = new o3({
        view: l3,
        layer: d3,
        element: e9,
        tool: this._preferredInteractionTool
      }), c3) {
        case "transform-3d":
          {
            this._tool = new s3({
              view: l3,
              object: this._object
            });
            const e10 = l3.inputManager;
            e10.isModifierKeyDown(d2.rotateIncrements.key) && (this._tool.snapRotation = true), e10.isModifierKeyDown(d2.preserveAspectRatio.key) && (this._tool.preserveAspectRatio = true);
          }
          break;
        case "reshape-3d": {
          const e10 = a2(l3);
          this.addHandles(e10, this._tool);
          const {
            snappingManager: t3
          } = e10;
          this._tool = new a3({
            view: l3,
            object: this._object,
            enableMidpoints: false,
            enableZShape: false,
            snappingManager: t3,
            enableMoveObject: false,
            autoHideManipulators: true,
            enableDeleteVertices: false
          });
        }
      }
      this.addHandles([e2(() => {
        this._object = u(this._object), this._tool && (l3.tools.remove(this._tool), this._tool = null);
      })], this._tool), l3.addAndActivateTool(this._tool);
    });
  }
  _preferredInteractionToolChanged(e9) {
    const {
      _tool: t2
    } = this;
    if (!t2) return;
    if (this._toolType !== t2.type) return void this._updatingHandles.addPromise(this._recreateTool());
    const {
      _object: o3
    } = this;
    o3 && (o3.tool = e9);
  }
  _dynamicImports() {
    return __async(this, null, function* () {
      const [{
        ManipulatedObject3DMediaElement: e9
      }, {
        ExtentTransformTool: t2,
        ReshapeTool3D: o3
      }] = yield Promise.all([import("./ManipulatedObject3DMediaElement-SOIRIRSC.js"), import("./editingTools-J3URP33C.js")]);
      return {
        ManipulatedObject3DMediaElement: e9,
        ExtentTransformTool: t2,
        ReshapeTool3D: o3
      };
    });
  }
  _findElementAtScreenPoint(e9) {
    return __async(this, null, function* () {
      const t2 = (yield this.view.hitTest(e9, {
        include: [this.layer]
      })).results[0];
      return "media" === t2?.type ? t2.element : null;
    });
  }
  _removeTool() {
    this._tool && this.removeHandles(this._tool);
  }
  _move(e9, t2) {
    const {
      view: o3,
      _object: i
    } = this, r = i?.operations;
    if (!r) return;
    const n2 = o3.overlayPixelSizeInMapUnits(o3.pointsOfInterest.focus.location) * W(o3.spatialReference) / W(r.data.spatialReference), {
      _tmpMat2: a3,
      _tmpVec2: l3
    } = this, c3 = M(a3, h(360 - this.view.camera.heading)), p = o2(l3, n2 * e9, n2 * t2);
    S3(p, p, c3), r.move(p[0], p[1], 0), i.emit("modified-externally");
  }
};
e3([y({
  constructOnly: true
})], O.prototype, "view", void 0), e3([y({
  constructOnly: true
})], O.prototype, "layer", void 0), e3([y()], O.prototype, "selectedElement", void 0), e3([y()], O.prototype, "enabled", void 0), e3([y()], O.prototype, "options", void 0), e3([y()], O.prototype, "updating", null), e3([y()], O.prototype, "_preferredInteractionTool", null), e3([y()], O.prototype, "_validatedSelectedElement", null), O = e3([a("esri.views.3d.layers.support.MediaLayerInteraction")], O);

// ../../../node_modules/@arcgis/core/views/3d/layers/support/MediaLayerInteractionOptions.js
var e8 = class extends S2 {
  constructor() {
    super(...arguments), this.tool = "transform";
  }
};
e3([y()], e8.prototype, "tool", void 0), e8 = e3([a("esri.views.3d.layers.support.MediaLayerInteractionOptions")], e8);

// ../../../node_modules/@arcgis/core/views/layers/MediaLayerView.js
var s2 = (s3) => {
  let i = class extends s3 {
    constructor(...e9) {
      super(...e9), this.layer = null, this.interactive = false, this.interactionOptions = new e8(), this.selectedElement = null;
    }
  };
  return e3([y()], i.prototype, "layer", void 0), e3([y()], i.prototype, "interactive", void 0), e3([y()], i.prototype, "interactionOptions", void 0), e3([y()], i.prototype, "selectedElement", void 0), i = e3([a("esri.views.layers.MediaLayerView")], i), i;
};

// ../../../node_modules/@arcgis/core/views/3d/layers/MediaLayerView3D.js
var I3 = class extends l2(s2(y2)) {
  get interactive() {
    return this._interaction.enabled;
  }
  set interactive(e9) {
    this._interaction && (this._interaction.enabled = e9);
  }
  get selectedElement() {
    return this._interaction.selectedElement;
  }
  set selectedElement(e9) {
    this._interaction && (this._interaction.selectedElement = e9);
  }
  get visibleAtCurrentScale() {
    return c2(this.layer.effectiveScaleRange, this.view.terrainScale);
  }
  constructor(e9) {
    super(e9), this.type = "media-3d", this.drapeSourceType = e7.RasterImage, this.updatePolicy = C.ASYNC, this._uidToElement = /* @__PURE__ */ new Map(), this._renderedElements = /* @__PURE__ */ new Map(), this._lastDrapingExtent = null, this._update = k((e10, t3, r2) => __async(this, null, function* () {
      const i = yield this._collectMediaElements(e10, t3, r2);
      this._synchronizeRenderElements(i);
    }), 0);
    const {
      view: t2,
      layer: r
    } = e9;
    this._interaction = new O({
      view: t2,
      layer: r
    }), this.addHandles(d(() => this.interactionOptions, (e10) => this._interaction.options = e10, A));
  }
  initialize() {
    const {
      view: e9,
      layer: t2
    } = this;
    this._renderer = e9.basemapTerrain.overlayManager.registerGeometryDrapeSource(this);
    const i = () => this._updateWithLastDrapingExtent();
    this.addHandles([e2(() => e9.basemapTerrain.overlayManager.unregisterDrapeSource(this)), v(() => t2.effectiveSource, "change", i), v(() => t2.effectiveSource, "refresh", i)]), this._updatingHandles.add(() => this.suspended, i);
  }
  setDrapingExtent(e9, t2) {
    this._lastDrapingExtent = {
      overlays: e9,
      spatialReference: t2
    }, this._updateWithLastDrapingExtent();
  }
  getHit(e9) {
    const t2 = this._uidToElement.get(e9);
    return t2 ? {
      type: "media",
      element: t2,
      layer: this.layer
    } : null;
  }
  isUpdating() {
    return super.isUpdating() || this._interaction.updating;
  }
  _updateWithLastDrapingExtent() {
    if (null == this._lastDrapingExtent || this.suspended) return void (this._renderer && this._synchronizeRenderElements(/* @__PURE__ */ new Set()));
    const {
      overlays: e9,
      spatialReference: t2
    } = this._lastDrapingExtent;
    this._updatingHandles.addPromise(this._update(e9, t2).catch(() => {
    }));
  }
  _collectMediaElements(e9, t2, r) {
    return __async(this, null, function* () {
      const i = this.layer.effectiveSource;
      return null == i ? /* @__PURE__ */ new Set() : new Set((yield Promise.all(e9.map((e10) => i.queryElements(c(e10.extent, t2), {
        signal: r
      })))).flat());
    });
  }
  _synchronizeRenderElements(e9) {
    this._synchronizeRenderElementsRemove(e9), this._synchronizeRenderElementsAdd(e9);
  }
  _synchronizeRenderElementsRemove(e9) {
    const t2 = [];
    this._renderedElements.forEach((r, i) => {
      e9.has(i) || (null != r.renderData && t2.push(r.renderData.renderGeometry), this._removeElement(i, r), this.emit("element-render-changed", {
        element: i
      }));
    });
  }
  _synchronizeRenderElementsAdd(e9) {
    for (const t2 of e9) this._renderedElements.has(t2) || this._createRenderElement(t2);
  }
  _removeElement(e9, {
    renderData: t2,
    handle: r
  }) {
    this._destroyRenderData(e9, t2), this._renderedElements.delete(e9), this._uidToElement.delete(e9.uid), r.remove();
  }
  _createRenderElement(e9) {
    return __async(this, null, function* () {
      const t2 = new m({
        spatialReference: this.view.spatialReference,
        element: e9
      }), r = {
        renderData: null,
        handle: o([this._updatingHandles.add(() => e9.opacity, (e10) => {
          null != r.renderData && r.renderData.material.setParameters({
            opacity: e10
          });
        }), this._updatingHandles.add(() => t2.coords, () => {
          null != r.renderData ? this._updateGeometry(t2, r, r.renderData) : this._initializeRenderData(t2, r);
        }), this._updatingHandles.add(() => e9.content, () => this._initializeRenderData(t2, r)), l(t2)])
      };
      this._renderedElements.set(e9, r), this._uidToElement.set(e9.uid, e9), this._updatingHandles.addPromise(e9.load().catch(() => {
      })), this._initializeRenderData(t2, r);
    });
  }
  _initializeRenderData(e9, t2) {
    const {
      coords: r,
      element: i
    } = e9, {
      contentWidth: n2,
      contentHeight: a3
    } = i;
    if (null == r || null == i.content) return void (t2.renderData = this._destroyRenderData(i, t2.renderData));
    if (null != t2.renderData) return;
    const s3 = this._createTexture(i.content), l3 = s3.load(this.view._stage.renderView.renderingContext);
    this.view._stage.add(s3), S(l3) && this._updatingHandles.addPromise(l3);
    const d3 = new g({
      initTextureTransparent: true,
      textureId: s3.id,
      opacity: i.opacity,
      transparent: true,
      perspectiveInterpolation: true
    }), m3 = this._getPositionAttributeArray(r), c3 = [0, 0, 1, 0, 1, 1, 0, 1], p = this._getPerspectiveDivideAttributeArray(m3, n2, a3), h4 = [0, 1, 2, 0, 2, 3], u2 = new I(d3, [[e5.POSITION, new t(m3, h4, 3, true)], [e5.UV0, new t(c3, h4, 2, true)], [e5.PERSPECTIVEDIVIDE, new t(p, h4, 1, true)]]), y3 = new m2(u2, {
      layerUid: this.layer.uid,
      graphicUid: i.uid
    });
    this._renderer.addGeometries([y3], E.ADD), t2.renderData = {
      renderGeometry: y3,
      texture: s3,
      material: d3
    }, this.emit("element-render-changed", {
      element: i
    });
  }
  _updateGeometry(e9, t2, r) {
    const {
      coords: i,
      element: n2
    } = e9;
    if (null == i || null == n2.content) return void (t2.renderData = this._destroyRenderData(n2, t2.renderData));
    const a3 = this._getPositionAttributeArray(i);
    r.renderGeometry.geometry.setAttributeData(e5.POSITION, a3);
    const s3 = this._getPerspectiveDivideAttributeArray(a3, n2.contentWidth, n2.contentHeight);
    r.renderGeometry.geometry.setAttributeData(e5.PERSPECTIVEDIVIDE, s3), r.renderGeometry.geometry.invalidateBoundingInfo(), this._renderer.modifyGeometries([r.renderGeometry], I2.GEOMETRY), this.emit("element-render-changed", {
      element: n2
    });
  }
  _getPositionAttributeArray(e9) {
    const [t2, r, i, n2] = e9.rings[0];
    return [t2[0], t2[1], te, n2[0], n2[1], te, i[0], i[1], te, r[0], r[1], te];
  }
  _getPerspectiveDivideAttributeArray(e9, t2, r) {
    j(H, [0, 0, t2, 0, t2, r, 0, r], [e9[0], e9[1], e9[3], e9[4], e9[6], e9[7], e9[9], e9[10]]);
    const i = H[6] / H[8] * t2, n2 = H[7] / H[8] * r;
    return [1, 1 + i, 1 + i + n2, 1 + n2];
  }
  _destroyRenderData(e9, t2) {
    if (null == t2) return null;
    const r = t2.texture;
    return r.unload(), this.view._stage.remove(r), this._renderer.removeGeometries([t2.renderGeometry], E.REMOVE), this.emit("element-render-changed", {
      element: e9
    }), null;
  }
  _createTexture(e9) {
    const r = e9 instanceof HTMLImageElement ? e9.naturalWidth : e9.width, i = e9 instanceof HTMLImageElement ? e9.naturalHeight : e9.height;
    if ("getFrame" in e9) throw new s("media-layer-view-3d", "animation is not supported");
    return new N(e9, {
      wrap: {
        s: D.CLAMP_TO_EDGE,
        t: D.CLAMP_TO_EDGE
      },
      preMultiplyAlpha: true,
      width: r,
      height: i,
      mipmap: true,
      updateCallback: () => this.view.basemapTerrain.overlayManager.setDrawTexturesDirty()
    });
  }
  get test() {
  }
};
e3([y({
  readOnly: true
})], I3.prototype, "type", void 0), e3([y()], I3.prototype, "layer", void 0), e3([y()], I3.prototype, "interactive", null), e3([y()], I3.prototype, "selectedElement", null), e3([y({
  readOnly: true
})], I3.prototype, "visibleAtCurrentScale", null), I3 = e3([a("esri.views.3d.layers.MediaLayerView3D")], I3);
var H = e4();
var L = I3;
export {
  L as default
};
//# sourceMappingURL=MediaLayerView3D-PAAUTJFD.js.map
