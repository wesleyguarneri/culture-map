{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/3d/support/hitTest.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport \"../../../geometry.js\";\nimport e from \"../../../Graphic.js\";\nimport { isIterable as n } from \"../../../core/iteratorUtils.js\";\nimport { createScreenPointArray as r, screenPointObjectToArray as i } from \"../../../core/screenUtils.js\";\nimport { create as t } from \"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";\nimport { projectVectorToVector as s } from \"../../../geometry/projection/projectVectorToVector.js\";\nimport { fallbackObjectIDAttribute as o } from \"../../../layers/LayerConstants.js\";\nimport { isIntegratedMeshLayer as l } from \"../../../layers/support/layerUtils.js\";\nimport { debugFlags as c } from \"./debugFlags.js\";\nimport { getElevationAtPoint as a } from \"./ElevationProvider.js\";\nimport { newIntersector as u } from \"../webgl-engine/lib/Intersector.js\";\nimport { StoreResults as d, IntersectorType as p } from \"../webgl-engine/lib/IntersectorInterfaces.js\";\nimport { isValidIntersectorResult as m } from \"../webgl-engine/lib/intersectorUtils.js\";\nimport { toOwner as f, toHit as g } from \"../webgl-engine/lib/intersectorUtilsConversions.js\";\nimport { terrainId as y } from \"../webgl-engine/lib/verticalOffsetUtils.js\";\nimport h from \"../../../geometry/SpatialReference.js\";\nimport E from \"../../../geometry/Point.js\";\nasync function U(e, n, i, t) {\n  const s = i ? R(e, i) : t,\n    o = r(n.x, n.y);\n  s.requiresGroundFeedback = !0, s.enableDraped = !0;\n  const a = u(e.state.viewingMode);\n  a.options.selectionMode = !0, a.options.store = d.ALL, e.sceneIntersectionHelper.intersectIntersectorScreen(o, a, s);\n  const p = b(e, a.results.all, s.graphics),\n    g = a.results.ground,\n    y = f(g, e),\n    h = null != y && \"type\" in y && l(y.type) ? y : null,\n    E = {\n      screenPoint: n,\n      results: p,\n      ground: {\n        mapPoint: j(e, g),\n        distance: m(g) ? g.distanceInRenderSpace : 0,\n        layer: h\n      }\n    };\n  return c.SCENEVIEW_HITTEST_RETURN_INTERSECTOR && (E.intersector = a), E;\n}\nfunction I(e, n, r, t) {\n  const s = r ? R(e, r) : t,\n    o = !(!s.graphics?.include && !s.graphics?.exclude),\n    l = !(!s.mediaElements?.include && !s.mediaElements?.exclude),\n    c = i(n);\n  s.enableDraped = s.include && !s.include.has(y) || s.exclude?.has(y);\n  const a = e.sceneIntersectionHelper,\n    p = u(e.state.viewingMode);\n  if (p.options.selectionMode = !0, p.options.store = o || l ? d.ALL : d.MIN, p.options.hud = !r?.excludeHud, a.intersectIntersectorScreen(c, p, s), o || l) {\n    for (const n of p.results.all) {\n      const r = g(n, e);\n      if (null == r) return j(e, n);\n      if (o && (\"graphic\" !== r.type || S(s.graphics, r.graphic))) return j(e, n);\n      if (l && (\"media\" !== r.type || x(s.mediaElements, r.element))) return j(e, n);\n    }\n    return null;\n  }\n  return j(e, p.results.min);\n}\nfunction b(e, n, r) {\n  const i = new Array();\n  let t = null;\n  for (let s = 0; s < n.length; s++) {\n    const o = n[s],\n      c = f(o, e);\n    if (null != c && (c === e.map.ground || \"type\" in c && l(c.type))) break;\n    const a = g(o, e);\n    if (null == a) continue;\n    if (\"graphic\" === a.type) {\n      if (null == t && s !== n.length - 1 && (t = new Set()), null != t) {\n        const e = w(a.graphic);\n        if (t.has(e)) continue;\n        t.add(e);\n      }\n      if (!S(r, a.graphic)) continue;\n    }\n    const u = j(e, o),\n      d = o.distanceInRenderSpace;\n    if (\"media\" === a.type) {\n      const e = a.element.toSource(u);\n      i.push({\n        ...a,\n        mapPoint: u,\n        distance: d,\n        sourcePoint: e\n      });\n    } else i.push({\n      ...a,\n      mapPoint: u,\n      distance: d\n    });\n  }\n  return i;\n}\nfunction j(e, n, r) {\n  return n.getIntersectionPoint(T) ? (r = L(e, T, r), n.intersector === p.TERRAIN && e.basemapTerrain && (r.z = a(e.basemapTerrain, r) ?? 0), r) : null;\n}\nfunction w(e) {\n  const n = e.sourceLayer,\n    r = e.layer,\n    i = n && \"objectIdField\" in n ? n : r && \"objectIdField\" in r ? r : n;\n  if (i) {\n    const n = i.objectIdField ?? o,\n      r = e.attributes?.[n];\n    if (r) return `o-${i.id}-${r}`;\n  }\n  return `u-${e.uid}`;\n}\nfunction S(e, n) {\n  return x(e, w(n));\n}\nfunction x(e, n) {\n  return null == e || (null == e.include || e.include.has(n)) && (null == e.exclude || !e.exclude.has(n));\n}\nfunction L(e, n, r) {\n  let i = e.spatialReference || h.WGS84;\n  return s(n, e.renderSpatialReference, T, i) ? n = T : (i = h.WGS84, s(n, e.renderSpatialReference, T, i) && (n = T)), r ? (r.x = n[0], r.y = n[1], r.z = n[2], r.spatialReference = i) : r = new E(n, i), r;\n}\nfunction R(e, n) {\n  const r = C(e, n.include, P.INCLUDE),\n    i = C(e, n.exclude, P.EXCLUDE);\n  return {\n    include: r.layerUids,\n    exclude: i.layerUids,\n    graphics: {\n      include: r.graphicUids,\n      exclude: i.graphicUids\n    },\n    mediaElements: {\n      include: r.mediaElements,\n      exclude: i.mediaElements\n    }\n  };\n}\nfunction C(r, i, t, s = {\n  layerUids: void 0,\n  graphicUids: void 0,\n  mediaElements: void 0\n}) {\n  if (!i) return s;\n  if (i instanceof e) D(s, w(i)), t === P.INCLUDE && (null != r.graphicsView && i.layer === r ? v(s, r.graphicsView.processor.layer.id) : i.layer && v(s, i.layer.uid));else if (\"layer\" in i && \"element\" in i) N(s, i.element), t === P.INCLUDE && v(s, i.layer.uid);else if (n(i)) for (const e of i) e === r.graphics && null != r.graphicsView ? v(s, r.graphicsView.processor.layer.id) : e === r.map.ground ? v(s, y) : C(r, e, t, s);else \"uid\" in i && v(s, i.uid);\n  return s;\n}\nfunction v(e, n) {\n  e.layerUids || (e.layerUids = new Set()), e.layerUids.add(n);\n}\nfunction D(e, n) {\n  e.graphicUids || (e.graphicUids = new Set()), e.graphicUids.add(n);\n}\nfunction N(e, n) {\n  e.mediaElements || (e.mediaElements = new Set()), e.mediaElements.add(n);\n}\nconst T = t();\nvar P;\n!function (e) {\n  e[e.INCLUDE = 0] = \"INCLUDE\", e[e.EXCLUDE = 1] = \"EXCLUDE\";\n}(P || (P = {}));\nexport { L as computeMapPointFromVec3d, R as externalToInternalIntersectOptions, w as getGraphicFilterUid, U as hitTest, j as intersectResultToMapPoint, I as toMap };"],
  "mappings": "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",
  "names": ["e", "n", "i", "t", "o", "a", "f", "h", "r", "w", "d", "T"]
}
