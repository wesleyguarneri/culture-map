{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js", "../../../../../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { r as s, p as r, g as o } from \"../../../../../chunks/vec32.js\";\nimport { c, g as n } from \"../../../../../chunks/sphere.js\";\nconst t = 1e3;\nfunction e(t, e, a) {\n  const p = c(),\n    m = n(p);\n  return s(m, m, t, .5), s(m, m, e, .5), p[3] = r(m, t), o(m, m, a), p;\n}\nexport { e as boundsFromEdge, t as maxCandidateCount };", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport { throwIfAborted as t } from \"../../../../../core/promiseUtils.js\";\nimport \"../../../../../core/Logger.js\";\nimport \"../../../../../core/has.js\";\nimport \"../../../../../core/RandomLCG.js\";\nimport \"../../../../../core/Error.js\";\nimport { subclass as o } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { g as s, p as n } from \"../../../../../chunks/vec32.js\";\nimport { create as i, clone as r } from \"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";\nimport { create as c, fromPoints as d, projectPoint as a } from \"../../../../../geometry/support/lineSegment.js\";\nimport { g as p, n as m } from \"../../../../../chunks/sphere.js\";\nimport u from \"../../../../3d/webgl-engine/lib/Octree.js\";\nimport { extractComponentsEdgeLocationsLayout as h } from \"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";\nimport { maxCandidateCount as g, boundsFromEdge as l } from \"./sceneLayerSnappingUtils.js\";\nlet f = class {\n  constructor() {\n    this._idToComponent = new Map(), this._components = new u(e => e.bounds), this._edges = new u(e => e.bounds), this._tmpLineSegment = c(), this._tmpP1 = i(), this._tmpP2 = i(), this._tmpP3 = i(), this.remoteClient = null;\n  }\n  async fetchCandidates(e, o) {\n    await Promise.resolve(), t(o), await this._ensureEdgeLocations(e, o);\n    const s = [];\n    return this._edges.forEachNeighbor(t => (this._addCandidates(e, t, s), s.length < g), e.bounds), {\n      result: {\n        candidates: s\n      }\n    };\n  }\n  async _ensureEdgeLocations(e, t) {\n    const o = [];\n    if (this._components.forEachNeighbor(e => {\n      if (null == e.info) {\n        const {\n          id: t,\n          uid: s\n        } = e;\n        o.push({\n          id: t,\n          uid: s\n        });\n      }\n      return !0;\n    }, e.bounds), !o.length) return;\n    const s = {\n        components: o\n      },\n      n = await this.remoteClient.invoke(\"fetchAllEdgeLocations\", s, t ?? {});\n    for (const i of n.components) this._setFetchEdgeLocations(i);\n  }\n  async add(e) {\n    const t = new j(e.id, e.bounds);\n    return this._idToComponent.set(t.id, t), this._components.add([t]), {\n      result: {}\n    };\n  }\n  async remove(e) {\n    const t = this._idToComponent.get(e.id);\n    if (t) {\n      const e = [];\n      this._edges.forEachNeighbor(o => (o.component === t && e.push(o), !0), t.bounds), this._edges.remove(e), this._components.remove([t]), this._idToComponent.delete(t.id);\n    }\n    return {\n      result: {}\n    };\n  }\n  _setFetchEdgeLocations(e) {\n    const t = this._idToComponent.get(e.id);\n    if (null == t || e.uid !== t.uid) return;\n    const o = h.createView(e.locations),\n      s = new Array(o.count),\n      n = i(),\n      r = i();\n    for (let i = 0; i < o.count; i++) {\n      o.position0.getVec(i, n), o.position1.getVec(i, r);\n      const c = l(n, r, e.origin),\n        d = new w(t, i, c);\n      s[i] = d;\n    }\n    this._edges.add(s);\n    const {\n      objectIds: c,\n      origin: d\n    } = e;\n    t.info = {\n      locations: o,\n      objectIds: c,\n      origin: d\n    };\n  }\n  _addCandidates(e, t, o) {\n    const {\n        info: n\n      } = t.component,\n      {\n        origin: i,\n        objectIds: r\n      } = n,\n      c = n.locations,\n      d = c.position0.getVec(t.index, this._tmpP1),\n      a = c.position1.getVec(t.index, this._tmpP2);\n    s(d, d, i), s(a, a, i);\n    const p = r[c.componentIndex.get(t.index)];\n    this._addEdgeCandidate(e, p, d, a, o), b(e, p, d, o), b(e, p, a, o);\n  }\n  _addEdgeCandidate(e, t, o, s, i) {\n    if (!e.returnEdge) return;\n    const c = p(e.bounds),\n      u = d(o, s, this._tmpLineSegment),\n      h = a(u, c, this._tmpP3);\n    m(e.bounds, h) && i.push({\n      type: \"edge\",\n      objectId: t,\n      target: r(h),\n      distance: n(c, h),\n      start: r(o),\n      end: r(s)\n    });\n  }\n};\nf = e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")], f);\nconst _ = f;\nfunction b(e, t, o, s) {\n  if (!e.returnVertex || !m(e.bounds, o)) return;\n  const i = p(e.bounds);\n  s.push({\n    type: \"vertex\",\n    objectId: t,\n    target: r(o),\n    distance: n(i, o)\n  });\n}\nclass j {\n  constructor(e, t) {\n    this.id = e, this.bounds = t, this.info = null, this.uid = ++j.uid;\n  }\n}\nj.uid = 0;\nclass w {\n  constructor(e, t, o) {\n    this.component = e, this.index = t, this.bounds = o;\n  }\n}\nexport { _ as default };"],
  "mappings": "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",
  "names": ["t", "e", "a", "m", "e", "s", "t", "n", "c", "d", "a", "u", "h", "_"]
}
