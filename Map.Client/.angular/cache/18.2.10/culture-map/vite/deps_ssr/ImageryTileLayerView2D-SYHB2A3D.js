import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  u as u3
} from "./chunk-4BTJRLWJ.js";
import {
  d as d2,
  d2 as d3,
  f as f2
} from "./chunk-JHR6D7GQ.js";
import {
  A,
  O as O2,
  T,
  _ as _2,
  c as c2,
  f as f3,
  g as g3,
  h as h5,
  l,
  m as m2,
  p
} from "./chunk-7SNJPIUA.js";
import "./chunk-UZL2AATT.js";
import "./chunk-LWIPFUZ3.js";
import "./chunk-JRL65HQ7.js";
import {
  i as i4
} from "./chunk-AEJ7YVFP.js";
import {
  a as a5,
  f
} from "./chunk-XK5LKXMQ.js";
import "./chunk-74SVQPE6.js";
import {
  y as y2
} from "./chunk-CXYUBZAK.js";
import "./chunk-LUORW76W.js";
import {
  mt
} from "./chunk-KZBRH42J.js";
import "./chunk-AENXIHUM.js";
import "./chunk-Z3B4X2BG.js";
import "./chunk-H5GZAILH.js";
import {
  i as i3
} from "./chunk-YQ4BFXXY.js";
import {
  h as h4
} from "./chunk-BUAHJQUY.js";
import "./chunk-MWR6F5NE.js";
import {
  t as t3
} from "./chunk-NLU6ZPOA.js";
import {
  r as r5
} from "./chunk-YQDGVKY6.js";
import "./chunk-PAFRRTJD.js";
import "./chunk-A47NS37R.js";
import {
  E as E2,
  r as r4
} from "./chunk-VOJZD4TW.js";
import "./chunk-6JRLR4LF.js";
import {
  s
} from "./chunk-OQI6JU2J.js";
import {
  e as e3
} from "./chunk-7PJ3GUSK.js";
import "./chunk-BNFI45VE.js";
import "./chunk-CSA6OEKA.js";
import "./chunk-ZCCDVQ3H.js";
import {
  t as t2
} from "./chunk-NZTRS5LW.js";
import "./chunk-FV32SB4U.js";
import {
  a as a4,
  g as g2,
  i as i2,
  u as u2
} from "./chunk-B2UUI3OT.js";
import {
  o as o2
} from "./chunk-DSARYBLQ.js";
import "./chunk-HKAONIBH.js";
import {
  D as D2,
  ae
} from "./chunk-PLQQNSQY.js";
import {
  S as S2,
  g
} from "./chunk-SU5BOQUT.js";
import "./chunk-7MWFHTLS.js";
import "./chunk-DDV74AXO.js";
import "./chunk-37RAJ54N.js";
import {
  m,
  r as r3
} from "./chunk-RVAIZQSS.js";
import {
  h as h3
} from "./chunk-I6EZE7ZH.js";
import "./chunk-VM4DYPO2.js";
import "./chunk-PXFPCKFW.js";
import "./chunk-RAYFUCRQ.js";
import "./chunk-ONQZSDXQ.js";
import {
  E
} from "./chunk-FWYSNIVU.js";
import "./chunk-MDEPINSI.js";
import "./chunk-SKOGSS6Z.js";
import "./chunk-WS7U2AGS.js";
import "./chunk-U4NXHH3L.js";
import "./chunk-J7FRIDYV.js";
import "./chunk-QWE4DSVN.js";
import {
  t
} from "./chunk-2LHHRVKS.js";
import {
  c,
  e2
} from "./chunk-QATJRB5Q.js";
import "./chunk-7Z4UWMRU.js";
import "./chunk-IQEF4U4C.js";
import {
  a as a3
} from "./chunk-NOBDTR4N.js";
import "./chunk-5RF6XDV4.js";
import "./chunk-Q47GASPN.js";
import "./chunk-YEB36ZCF.js";
import "./chunk-KINQ7OJ3.js";
import {
  D,
  L,
  O,
  P as P2,
  R,
  U
} from "./chunk-KYLW5XXS.js";
import "./chunk-B76NC7GX.js";
import {
  h as h2
} from "./chunk-HFXXFWYN.js";
import "./chunk-QRWQ6QBB.js";
import "./chunk-X5QZGB37.js";
import "./chunk-T5C2TZNO.js";
import "./chunk-AOGKNBDG.js";
import "./chunk-F4FQ67JP.js";
import "./chunk-FDI2X6GO.js";
import "./chunk-3XHDZQO5.js";
import "./chunk-2BLQXT54.js";
import "./chunk-JSWVKNBA.js";
import "./chunk-VENH3UKS.js";
import "./chunk-NHYYZMJR.js";
import {
  a as a2
} from "./chunk-BZHHBBFX.js";
import {
  M,
  b as b2,
  h,
  i,
  o,
  r as r2
} from "./chunk-A2FDYA6M.js";
import "./chunk-NVOJILW6.js";
import "./chunk-KYPTWEOO.js";
import "./chunk-WVFB3H4O.js";
import "./chunk-ZREJ3Y2F.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-BBUQOCRA.js";
import "./chunk-YBUJLIWZ.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import "./chunk-IUPJR3FF.js";
import "./chunk-TGZW6QWO.js";
import "./chunk-OYIDHTXG.js";
import "./chunk-KUBMHTYA.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-UAETKRWQ.js";
import "./chunk-NXXQ35YM.js";
import "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import {
  z
} from "./chunk-KAHESDP5.js";
import "./chunk-ONRZ4VTT.js";
import "./chunk-MVS2BECH.js";
import "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-XNLAOXPY.js";
import "./chunk-ZT7V2AVD.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-I2TVVMQ6.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-JKPUNUQA.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import {
  u
} from "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-THZPD5CT.js";
import "./chunk-OBCA6CWH.js";
import "./chunk-2JI245BP.js";
import "./chunk-N34BRXVM.js";
import "./chunk-7QV7DHWN.js";
import "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import {
  w
} from "./chunk-RNF7VOCU.js";
import {
  _
} from "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import "./chunk-DCXDXGAR.js";
import "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import "./chunk-2OZSYJDX.js";
import "./chunk-MZM4INJV.js";
import "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import "./chunk-G73HQZEL.js";
import {
  C,
  P,
  d
} from "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e
} from "./chunk-NUICEVIH.js";
import {
  S
} from "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  a3 as a
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import {
  b,
  k
} from "./chunk-AIZ3T7E3.js";
import "./chunk-6UEMNP3E.js";
import {
  r
} from "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import {
  n2 as n
} from "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/RasterBitmap.js
var p2 = {
  bandCount: 3,
  outMin: 0,
  outMax: 1,
  minCutOff: [0, 0, 0],
  maxCutOff: [255, 255, 255],
  factor: [1 / 255, 1 / 255, 1 / 255],
  useGamma: false,
  gamma: [1, 1, 1],
  gammaCorrection: [1, 1, 1],
  colormap: null,
  colormapOffset: null,
  stretchType: "none",
  type: "stretch"
};
var _3 = class extends s {
  constructor(e17 = null, t6 = null, s18 = null) {
    super(), this._textureInvalidated = true, this._colormapTextureInvalidated = true, this._rasterTexture = null, this._rasterTextureBandIds = null, this._transformGridTexture = null, this._colormapTexture = null, this._colormap = null, this._supportsBilinearTexture = true, this._processedTexture = null, this.functionTextures = [], this.projected = false, this.stencilRef = 0, this.coordScale = [1, 1], this._processed = false, this._symbolizerParameters = null, this.height = null, this.isRendereredSource = false, this.pixelRatio = 1, this.resolution = 0, this.rotation = 0, this._source = null, this.rawPixelData = null, this._suspended = false, this._bandIds = null, this._interpolation = null, this._transformGrid = null, this.width = null, this.x = 0, this.y = 0, this.source = e17, this.transformGrid = t6, this.interpolation = s18;
  }
  destroy() {
    this._disposeTextures();
  }
  get processedTexture() {
    return this._processedTexture;
  }
  set processedTexture(e17) {
    this._processedTexture !== e17 && (this._disposeTextures(true), this._processedTexture = e17);
  }
  get rasterTexture() {
    return this._rasterTexture;
  }
  set rasterTexture(e17) {
    this._rasterTexture !== e17 && (this._rasterTexture?.dispose(), this._rasterTexture = e17), null == e17 && (this.projected = false);
  }
  get processed() {
    return this._processed;
  }
  set processed(t6) {
    this._processed = t6, t6 || (r(this.processedTexture), this.invalidateTexture());
  }
  get symbolizerParameters() {
    return this._symbolizerParameters || p2;
  }
  set symbolizerParameters(e17) {
    this._symbolizerParameters !== e17 && (this._symbolizerParameters = e17, this._colormapTextureInvalidated = true, this.commonUniforms = null);
  }
  get source() {
    return this._source;
  }
  set source(e17) {
    this._source !== e17 && (this._source = e17, this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this.commonUniforms = null, this.projected = false, this.invalidateTexture());
  }
  get suspended() {
    return this._suspended;
  }
  set suspended(e17) {
    this._suspended && !e17 && this.stage && (this.ready(), this.requestRender()), this._suspended = e17;
  }
  get bandIds() {
    return this._bandIds;
  }
  set bandIds(e17) {
    this._bandIds = e17, this._isBandIdsChanged(e17) && (this.projected = false, this.invalidateTexture());
  }
  get interpolation() {
    return this._interpolation || "nearest";
  }
  set interpolation(e17) {
    this._interpolation = e17, this._rasterTexture && this._rasterTexture.setSamplingMode("bilinear" === this._getTextureSamplingMethod(e17 || "nearest") ? L.LINEAR : L.NEAREST);
  }
  get transformGrid() {
    return this._transformGrid;
  }
  set transformGrid(t6) {
    this._transformGrid !== t6 && (this._transformGrid = t6, this._transformGridTexture = r(this._transformGridTexture));
  }
  invalidateTexture() {
    this._textureInvalidated || (this._textureInvalidated = true, this.requestRender());
  }
  getRasterTextureSize(e17 = false) {
    const t6 = e17 || this.projected;
    return [t6 ? this.width : this.source?.width || this.width, t6 ? this.height : this.source?.height || this.height];
  }
  getRasterCellSize() {
    const e17 = this.rawPixelData?.srcPixelSize, {
      projected: t6,
      resolution: s18
    } = this;
    return e17 && !t6 ? [e17.x, e17.y] : [s18, s18];
  }
  _createTransforms() {
    return {
      displayViewScreenMat3: e3()
    };
  }
  setTransform(e17) {
    const a23 = o(this.transforms.displayViewScreenMat3), [h7, n22] = e17.toScreenNoRotation([0, 0], [this.x, this.y]), l3 = this.resolution / this.pixelRatio / e17.resolution, d4 = l3 * this.width, c5 = l3 * this.height, p3 = Math.PI * this.rotation / 180;
    M(a23, a23, t(h7, n22)), M(a23, a23, t(d4 / 2, c5 / 2)), h(a23, a23, -p3), M(a23, a23, t(-d4 / 2, -c5 / 2)), b2(a23, a23, t(d4, c5)), i(this.transforms.displayViewScreenMat3, e17.displayViewMat3, a23);
  }
  getTextures({
    forProcessing: e17 = false,
    useProcessedTexture: t6 = false
  } = {}) {
    const s18 = t6 ? this._processedTexture ?? this._rasterTexture : this._rasterTexture, r15 = [], i10 = [];
    return s18 ? (this._transformGridTexture && !this.projected && (i10.push(this._transformGridTexture), r15.push("u_transformGrid")), t6 ? (i10.push(s18), r15.push("u_image"), this._colormapTexture && (i10.push(this._colormapTexture), r15.push("u_colormap")), {
      names: r15,
      textures: i10
    }) : (i10.push(s18), r15.push("u_image"), this._colormapTexture && !e17 && (i10.push(this._colormapTexture), r15.push("u_colormap")), {
      names: r15,
      textures: i10
    })) : {
      names: r15,
      textures: i10
    };
  }
  onAttach() {
    this.invalidateTexture();
  }
  onDetach() {
    this.invalidateTexture();
  }
  updateTexture({
    context: e17
  }) {
    if (!this.stage) return void this._disposeTextures();
    const t6 = this._isValidSource(this.source);
    t6 && this._colormapTextureInvalidated && (this._colormapTextureInvalidated = false, this._updateColormapTexture(e17)), this._textureInvalidated && (this._textureInvalidated = false, this._createOrDestroyRasterTexture(e17), this._rasterTexture && (t6 ? this.transformGrid && !this._transformGridTexture && (this._transformGridTexture = c2(e17, this.transformGrid)) : this._rasterTexture.setData(null)), this.suspended || (this.ready(), this.requestRender()));
  }
  updateProcessedTexture() {
    const {
      functionTextures: e17
    } = this;
    0 !== e17.length && (this.processedTexture = e17.shift(), e17.forEach((e18) => e18?.dispose()), e17.length = 0);
  }
  _createOrDestroyRasterTexture(e17) {
    const t6 = this.source?.extractBands(this.bandIds);
    if (!this._isValidSource(t6)) return void (this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null));
    const s18 = !this._isBandIdsChanged(this.bandIds);
    if (this._rasterTexture) {
      if (s18) return;
      this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null;
    }
    this._supportsBilinearTexture = !!e17.capabilities.textureFloatLinear;
    const r15 = this._getTextureSamplingMethod(this.interpolation), i10 = this.isRendereredSource;
    this._rasterTexture = f3(e17, t6, r15, i10), this.projected = false, this._processed = false, this._rasterTextureBandIds = this.bandIds ? [...this.bandIds] : null;
  }
  _isBandIdsChanged(e17) {
    const t6 = this._rasterTextureBandIds;
    return !(null == t6 && null == e17 || t6 && e17 && t6.join("") === e17.join(""));
  }
  _isValidSource(e17) {
    return null != e17 && e17.pixels?.length > 0;
  }
  _getTextureSamplingMethod(e17) {
    const {
      type: t6
    } = this.symbolizerParameters, s18 = "lut" === t6 || "hillshade" === t6 || "stretch" === t6 && 1 === this.symbolizerParameters.bandCount;
    return !this._supportsBilinearTexture || s18 || "bilinear" !== e17 && "cubic" !== e17 ? "nearest" : "bilinear";
  }
  _updateColormapTexture(e17) {
    const t6 = this._colormap, s18 = this.symbolizerParameters.colormap;
    return s18 ? t6 ? s18.length !== t6.length || s18.some((e18, s19) => e18 !== t6[s19]) ? (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), this._colormapTexture = m2(e17, s18), void (this._colormap = s18)) : void 0 : (this._colormapTexture = m2(e17, s18), void (this._colormap = s18)) : (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), void (this._colormap = null));
  }
  _disposeTextures(e17 = false) {
    !this._transformGridTexture || e17 && !this.projected || (this._transformGridTexture.dispose(), this._transformGridTexture = null), !e17 && this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null, this._colormap = null, this._colormapTextureInvalidated = true), !e17 && this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this._processedTexture && (this._processedTexture.dispose(), this._processedTexture = null);
  }
};
function m3(e17) {
  return null != e17.source;
}

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/utils.js
function i5(i10) {
  const n22 = [];
  return i10 && (n22.push("applyProjection"), 1 === i10.spacing[0] && n22.push("lookupProjection")), n22;
}
function n2(i10, n22, e17) {
  const u5 = !e17.capabilities.textureFloatLinear, t6 = [];
  return "cubic" === i10 ? t6.push("bicubic") : "bilinear" === i10 && (n22 ? (t6.push("bilinear"), t6.push("nnedge")) : u5 && t6.push("bilinear")), t6;
}

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/lut.js
var s2 = {
  vsPath: "raster/common",
  fsPath: "raster/lut",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function a6(t6, e17, o11) {
  const a23 = o11 ? [] : i5(e17.transformGrid);
  return {
    defines: a23,
    program: t6.painter.materialManager.getProgram(s2, a23)
  };
}
function n3(r15, s18, a23, n22, m7 = false) {
  const {
    names: i10,
    textures: c5
  } = a23.getTextures({
    useProcessedTexture: m7
  });
  O2(r15.context, s18, i10, c5), h5(s18, n22, a23.commonUniforms), s18.setUniformMatrix3fv("u_dvsMat3", a23.transforms.displayViewScreenMat3);
  const {
    colormap: f4,
    colormapOffset: u5
  } = a23.symbolizerParameters, l3 = _2(f4, u5);
  h5(s18, n22, l3);
}
var m4 = {
  createProgram: a6,
  bindTextureAndUniforms: n3
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/shadedrelief.js
var n4 = {
  vsPath: "raster/common",
  fsPath: "raster/hillshade",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function i6(e17, o11, s18) {
  const {
    colormap: a23
  } = o11.symbolizerParameters, i10 = [...s18 ? [] : i5(o11.transformGrid), ...n2(o11.interpolation, true, e17.context)];
  null != a23 && i10.push("applyColormap");
  return {
    defines: i10,
    program: e17.painter.materialManager.getProgram(n4, i10)
  };
}
function m5(r15, t6, n22, i10, m7 = false) {
  const {
    names: c5,
    textures: l3
  } = n22.getTextures({
    useProcessedTexture: m7
  });
  O2(r15.context, t6, c5, l3), h5(t6, i10, n22.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n22.transforms.displayViewScreenMat3);
  const f4 = n22.symbolizerParameters, {
    colormap: p3,
    colormapOffset: u5
  } = f4;
  if (null != p3) {
    const r16 = _2(p3, u5);
    h5(t6, i10, r16);
  }
  const d4 = A(f4);
  h5(t6, i10, d4);
}
var c3 = {
  createProgram: i6,
  bindTextureAndUniforms: m5
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/stretch.js
var n5 = {
  vsPath: "raster/common",
  fsPath: "raster/stretch",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function i7(e17, o11, s18) {
  const {
    colormap: a23,
    bandCount: i10
  } = o11.symbolizerParameters, m7 = [...s18 ? [] : i5(o11.transformGrid), ...n2(o11.interpolation, 1 === i10, e17.context)];
  o11.isRendereredSource && !s18 ? m7.push("noop") : null != a23 && m7.push("applyColormap");
  return {
    defines: m7,
    program: e17.painter.materialManager.getProgram(n5, m7)
  };
}
function m6(r15, t6, n22, i10, m7 = false) {
  const {
    names: c5,
    textures: l3
  } = n22.getTextures({
    useProcessedTexture: m7
  });
  O2(r15.context, t6, c5, l3), h5(t6, i10, n22.commonUniforms), t6.setUniformMatrix3fv("u_dvsMat3", n22.transforms.displayViewScreenMat3);
  const p3 = n22.symbolizerParameters, {
    colormap: u5,
    colormapOffset: f4
  } = p3;
  if (null != u5) {
    const r16 = _2(u5, f4);
    h5(t6, i10, r16);
  }
  const d4 = p(p3);
  h5(t6, i10, d4);
}
var c4 = {
  createProgram: i7,
  bindTextureAndUniforms: m6
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/colorizer/rasterColorizer.js
var s3 = /* @__PURE__ */ new Map();
function o3(t6) {
  return s3.get(t6);
}
s3.set("lut", m4), s3.set("hillshade", c3), s3.set("stretch", c4);

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/utils.js
var t4 = [1, 1];
var n6 = [2, 0, 0, 0, 2, 0, -1, -1, 0];
function a7(t6, n22, a23) {
  const {
    context: r15,
    rasterFunction: s18,
    hasBranches: i10
  } = t6, {
    raster: o11
  } = s18.parameters, f4 = i10 ? o11?.id ?? -1 : 0, m7 = a23.functionTextures[f4] ?? a23.rasterTexture;
  O2(r15, n22, ["u_image"], [m7]);
}
function r6(t6, n22, r15) {
  const {
    rasters: s18
  } = t6.rasterFunction.parameters;
  if (!s18) return;
  if (s18.length < 2) return a7(t6, n22, r15);
  const i10 = s18.filter((e17) => "Constant" !== e17.name).map((e17) => null != e17.id && "Identity" !== e17.name ? r15.functionTextures[e17.id] : r15.rasterTexture);
  if (O2(t6.context, n22, ["u_image", "u_image1", "u_image2"].slice(0, i10.length), i10), i10.length !== s18.length) {
    if (2 === s18.length) {
      const e17 = s18.findIndex((e18) => "Constant" === e18.name), t7 = 0 === e17 ? [0, 1, 0, 1, 0, 0, 0, 0, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 0], {
        value: a23
      } = s18[e17].parameters;
      n22.setUniform1f("u_image1Const", a23), n22.setUniformMatrix3fv("u_imageSwap", t7);
    } else if (3 === s18.length) {
      const e17 = [];
      if (s18.forEach((t7, n23) => "Constant" === t7.name && e17.push(n23)), 1 === e17.length) {
        const {
          value: t7
        } = s18[e17[0]].parameters;
        n22.setUniform1f("u_image1Const", t7);
        const a23 = 0 === e17[0] ? [0, 1, 0, 0, 0, 1, 1, 0, 0] : 1 === e17[0] ? [1, 0, 0, 0, 0, 1, 0, 1, 0] : [1, 0, 0, 0, 1, 0, 0, 0, 1];
        n22.setUniformMatrix3fv("u_imageSwap", a23);
      } else if (2 === e17.length) {
        const {
          value: t7
        } = s18[e17[0]].parameters;
        n22.setUniform1f("u_image1Const", t7);
        const {
          value: a23
        } = s18[e17[1]].parameters;
        n22.setUniform1f("u_image2Const", a23);
        const r16 = s18.findIndex((e18) => "Constant" !== e18.name), i11 = 0 === r16 ? [1, 0, 0, 0, 1, 0, 0, 0, 1] : 1 === r16 ? [0, 1, 0, 1, 0, 0, 0, 0, 1] : [0, 0, 1, 1, 0, 0, 0, 1, 0];
        n22.setUniformMatrix3fv("u_imageSwap", i11);
      }
    }
  }
}
function s4(e17) {
  e17.setUniform2fv("u_coordScale", t4), e17.setUniformMatrix3fv("u_dvsMat3", n6);
}

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/aspectProcessor.js
var r7 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/aspect",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function a8(t6, e17) {
  return t6.painter.materialManager.getProgram(r7, []);
}
function s5(r15, a23, s18) {
  a7(r15, a23, s18), s4(a23);
  const n22 = s18.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n22);
  const o11 = s18.getRasterCellSize();
  a23.setUniform2fv("u_cellSize", o11);
}
var n7 = {
  createProgram: a8,
  bindTextureAndUniforms: s5
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/bandArithmeticProcessor.js
var a9 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/bandarithmetic",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e4(t6, r15) {
  const {
    painter: e17,
    rasterFunction: n22
  } = t6, {
    indexType: s18
  } = n22.parameters;
  return e17.materialManager.getProgram(a9, [s18]);
}
function n8(a23, e17, n22) {
  a7(a23, e17, n22), s4(e17);
  const {
    bandIndexMat3: s18
  } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s18);
}
var s6 = {
  createProgram: e4,
  bindTextureAndUniforms: n8
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/compositeBandProcessor.js
var n9 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/compositeband",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function a10(t6, r15) {
  const a23 = t6.rasterFunction.parameters.rasters.filter((t7) => "Constant" === t7.name), e17 = [];
  return a23.length && (e17.push("oneConstant"), 2 === a23.length && e17.push("twoConstant")), t6.painter.materialManager.getProgram(n9, e17);
}
function e5(n22, a23, e17) {
  r6(n22, a23, e17), s4(a23);
}
var s7 = {
  createProgram: a10,
  bindTextureAndUniforms: e5
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/computeChangeProcessor.js
var n10 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/computechange",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function r8(t6) {
  const {
    painter: e17,
    rasterFunction: r15
  } = t6, {
    method: a23,
    rasters: s18,
    isOutputRounded: o11
  } = r15.parameters, i10 = [a23.includes("-") ? a23.slice(0, a23.indexOf("-")) : a23];
  return s18.filter((t7) => "Constant" === t7.name).length && i10.push("oneConstant"), o11 && i10.push("roundOutput"), e17.materialManager.getProgram(n10, i10);
}
function a11(n22, r15, a23) {
  r6(n22, r15, a23), s4(r15);
  const {
    domainRange: s18
  } = n22.rasterFunction.parameters;
  r15.setUniform2fv("u_domainRange", s18);
}
var s8 = {
  createProgram: r8,
  bindTextureAndUniforms: a11
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/contrastProcessor.js
var s9 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/contrast",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e6(t6, r15) {
  return t6.painter.materialManager.getProgram(s9, []);
}
function a12(s18, e17, a23) {
  a7(s18, e17, a23), s4(e17);
  const {
    contrastOffset: n22,
    brightnessOffset: o11
  } = s18.rasterFunction.parameters;
  e17.setUniform1f("u_contrastOffset", n22), e17.setUniform1f("u_brightnessOffset", o11);
}
var n11 = {
  createProgram: e6,
  bindTextureAndUniforms: a12
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/convolutionProcessor.js
var t5 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/convolution",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function a13(e17, r15) {
  const {
    painter: a23,
    rasterFunction: n22
  } = e17, {
    kernelRows: o11,
    kernelCols: s18
  } = n22.parameters, i10 = [{
    name: "rows",
    value: o11
  }, {
    name: "cols",
    value: s18
  }];
  return a23.materialManager.getProgram(t5, i10);
}
function n12(t6, a23, n22) {
  a7(t6, a23, n22), s4(a23), a23.setUniform2fv("u_srcImageSize", [n22.width, n22.height]);
  const {
    kernel: o11,
    clampRange: s18
  } = t6.rasterFunction.parameters;
  a23.setUniform1fv("u_kernel", o11), a23.setUniform2fv("u_clampRange", s18);
}
var o4 = {
  createProgram: a13,
  bindTextureAndUniforms: n12
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/curvatureProcessor.js
var e7 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/curvature",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function a14(r15, t6) {
  const {
    painter: a23,
    rasterFunction: s18
  } = r15, {
    curvatureType: n22
  } = s18.parameters, o11 = [n22];
  return a23.materialManager.getProgram(e7, o11);
}
function s10(e17, a23, s18) {
  a7(e17, a23, s18), s4(a23);
  const n22 = s18.getRasterTextureSize();
  a23.setUniform2fv("u_srcImageSize", n22);
  const {
    zFactor: o11
  } = e17.rasterFunction.parameters, i10 = s18.getRasterCellSize();
  a23.setUniform1f("u_zlFactor", 200 * o11 / i10[0] / i10[1]);
}
var n13 = {
  createProgram: a14,
  bindTextureAndUniforms: s10
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/extractBandProcessor.js
var a15 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/extractband",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e8(t6, r15) {
  return t6.painter.materialManager.getProgram(a15, []);
}
function n14(a23, e17, n22) {
  a7(a23, e17, n22), s4(e17);
  const {
    bandIndexMat3: o11
  } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", o11);
}
var o5 = {
  createProgram: e8,
  bindTextureAndUniforms: n14
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/focalStatisticsProcessor.js
var e9 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/focalstatistics",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function r9(t6, a23) {
  const {
    painter: r15,
    rasterFunction: s18
  } = t6, {
    kernelRows: n22,
    kernelCols: o11,
    fillNoDataOnly: i10,
    statisticsType: c5
  } = s18.parameters, l3 = [{
    name: "rows",
    value: n22
  }, {
    name: "cols",
    value: o11
  }, c5];
  return i10 && l3.push("fill"), r15.materialManager.getProgram(e9, l3);
}
function s11(e17, r15, s18) {
  a7(e17, r15, s18), s4(r15), r15.setUniform2fv("u_srcImageSize", [s18.width, s18.height]);
  const {
    clampRange: n22
  } = e17.rasterFunction.parameters;
  r15.setUniform2fv("u_clampRange", n22);
}
var n15 = {
  createProgram: r9,
  bindTextureAndUniforms: s11
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/grayscaleProcessor.js
var a16 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/grayscale",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e10(t6, r15) {
  return t6.painter.materialManager.getProgram(a16, []);
}
function s12(a23, e17, s18) {
  a7(a23, e17, s18), s4(e17);
  const {
    weights: n22
  } = a23.rasterFunction.parameters;
  e17.setUniform3fv("u_weights", n22);
}
var n16 = {
  createProgram: e10,
  bindTextureAndUniforms: s12
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/localProcessor.js
var a17 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/local",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e11(t6) {
  const {
    painter: n22,
    rasterFunction: e17
  } = t6, {
    imageCount: r15,
    operationName: o11,
    rasters: s18,
    isOutputRounded: u5
  } = e17.parameters, i10 = [o11.toLowerCase()];
  2 === r15 && i10.push("twoImages");
  const m7 = s18.filter((t7) => "Constant" === t7.name);
  return m7.length && (i10.push("oneConstant"), 2 === m7.length && i10.push("twoConstant")), u5 && i10.push("roundOutput"), n22.materialManager.getProgram(a17, i10);
}
function r10(a23, e17, r15) {
  r6(a23, e17, r15), s4(e17);
  const {
    domainRange: o11
  } = a23.rasterFunction.parameters;
  e17.setUniform2fv("u_domainRange", o11);
}
var o6 = {
  createProgram: e11,
  bindTextureAndUniforms: r10
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/maskProcessor.js
var r11 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/mask",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function n17(t6, a23) {
  const {
    painter: n22,
    rasterFunction: e17
  } = t6, s18 = e17.parameters.bandCount > 1 ? ["multiBand"] : [];
  return n22.materialManager.getProgram(r11, s18);
}
function e12(r15, n22, e17) {
  a7(r15, n22, e17), s4(n22);
  const {
    includedRanges: s18,
    noDataValues: o11
  } = r15.rasterFunction.parameters;
  n22.setUniform1fv("u_includedRanges", s18), n22.setUniform1fv("u_noDataValues", o11);
}
var s13 = {
  createProgram: n17,
  bindTextureAndUniforms: e12
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/ndviProcessor.js
var a18 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/ndvi",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e13(t6, r15) {
  const {
    painter: e17,
    rasterFunction: n22
  } = t6, s18 = n22.parameters.scaled ? ["scaled"] : [];
  return e17.materialManager.getProgram(a18, s18);
}
function n18(a23, e17, n22) {
  a7(a23, e17, n22), s4(e17);
  const {
    bandIndexMat3: s18
  } = a23.rasterFunction.parameters;
  e17.setUniformMatrix3fv("u_bandIndexMat3", s18);
}
var s14 = {
  createProgram: e13,
  bindTextureAndUniforms: n18
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/remapProcessor.js
var r12 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/remap",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function e14(a23, t6) {
  return a23.painter.materialManager.getProgram(r12, []);
}
function n19(r15, e17, n22) {
  a7(r15, e17, n22), s4(e17);
  const {
    noDataRanges: s18,
    rangeMaps: o11,
    allowUnmatched: f4,
    clampRange: i10
  } = r15.rasterFunction.parameters;
  e17.setUniform1fv("u_noDataRanges", s18), e17.setUniform1fv("u_rangeMaps", o11), e17.setUniform1f("u_unmatchMask", f4 ? 1 : 0), e17.setUniform2fv("u_clampRange", i10);
}
var s15 = {
  createProgram: e14,
  bindTextureAndUniforms: n19
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/reprojectProcessor.js
var e15 = {
  vsPath: "raster/common",
  fsPath: "raster/reproject",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function i8(r15, t6) {
  const {
    painter: i10
  } = r15, o11 = [], {
    interpolation: s18,
    transformGrid: n22
  } = t6, a23 = r15.rasterFunction?.parameters;
  return "cubic" === s18 ? o11.push("bicubic") : "bilinear" === s18 && (o11.push("bilinear"), a23?.requireNNEdge && o11.push("nnedge")), n22 && (o11.push("applyProjection"), 1 === n22.spacing[0] && o11.push("lookupProjection")), i10.materialManager.getProgram(e15, o11);
}
function o7(e17, i10, o11) {
  const {
    names: s18,
    textures: n22
  } = o11.getTextures({
    forProcessing: true
  });
  O2(e17.context, i10, s18, n22), i10.setUniform1f("u_scale", 1), i10.setUniform2fv("u_offset", [0, 0]), i10.setUniform2fv("u_coordScale", [1, 1]), i10.setUniformMatrix3fv("u_dvsMat3", [2, 0, 0, 0, 2, 0, -1, -1, 0]), i10.setUniform1i("u_flipY", 0), i10.setUniform1f("u_opacity", 1);
  const {
    width: a23,
    height: f4,
    source: c5,
    transformGrid: m7
  } = o11;
  i10.setUniform2fv("u_srcImageSize", [c5.width, c5.height]), i10.setUniform2fv("u_targetImageSize", [a23, f4]), i10.setUniform2fv("u_transformSpacing", m7 ? m7.spacing : a2), i10.setUniform2fv("u_transformGridSize", m7 ? m7.size : a2);
}
var s16 = {
  createProgram: i8,
  bindTextureAndUniforms: o7
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/slopeProcessor.js
var r13 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/slope",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function s17(e17, t6) {
  const {
    painter: s18,
    rasterFunction: o11
  } = e17, {
    slopeType: a23
  } = o11.parameters, i10 = "percent-rise" === a23 ? ["percentRise"] : [];
  return s18.materialManager.getProgram(r13, i10);
}
function o8(r15, s18, o11) {
  a7(r15, s18, o11), s4(s18);
  const a23 = o11.getRasterTextureSize();
  s18.setUniform2fv("u_srcImageSize", a23);
  const i10 = o11.getRasterCellSize();
  s18.setUniform2fv("u_cellSize", i10);
  const {
    zFactor: n22,
    slopeType: c5,
    pixelSizePower: f4,
    pixelSizeFactor: p3
  } = r15.rasterFunction.parameters;
  s18.setUniform1f("u_zFactor", n22), s18.setUniform1f("u_pixelSizePower", "adjusted" === c5 ? f4 : 0), s18.setUniform1f("u_pixelSizeFactor", "adjusted" === c5 ? p3 : 0);
}
var a19 = {
  createProgram: s17,
  bindTextureAndUniforms: o8
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/stretchProcessor.js
var a20 = {
  vsPath: "raster/rfx/vs",
  fsPath: "raster/rfx/stretch",
  attributes: /* @__PURE__ */ new Map([["a_position", 0], ["a_texcoord", 1]])
};
function u4(t6, r15) {
  const {
    useGamma: u5,
    bandCount: e17,
    isOutputRounded: n22
  } = t6.rasterFunction.parameters, o11 = [];
  return u5 && o11.push("useGamma"), e17 > 1 && o11.push("multiBand"), n22 && o11.push("roundOutput"), t6.painter.materialManager.getProgram(a20, o11);
}
function e16(a23, u5, e17) {
  a7(a23, u5, e17), s4(u5);
  const {
    width: n22,
    height: o11
  } = e17, m7 = a23.rasterFunction.parameters;
  u5.setUniform2fv("u_srcImageSize", [n22, o11]), u5.setUniform1f("u_minOutput", m7.outMin), u5.setUniform1f("u_maxOutput", m7.outMax), u5.setUniform1fv("u_factor", m7.factor), u5.setUniform1fv("u_minCutOff", m7.minCutOff), u5.setUniform1fv("u_maxCutOff", m7.maxCutOff), u5.setUniform1fv("u_gamma", m7.gamma), u5.setUniform1fv("u_gammaCorrection", m7.gammaCorrection);
}
var n20 = {
  createProgram: u4,
  bindTextureAndUniforms: e16
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/processor/rasterProcessor.js
var v = /* @__PURE__ */ new Map();
function A2(r15, e17) {
  const o11 = new e2();
  return o11.width = r15, o11.height = e17, o11.internalFormat = P2.RGBA32F, o11.samplingMode = L.NEAREST, o11.dataType = U.FLOAT, o11.isImmutable = true, o11.wrapMode = D.CLAMP_TO_EDGE, o11;
}
function F(r15, e17, o11, t6) {
  const {
    context: s18,
    requestRender: c5,
    allowDelayedRender: n22
  } = r15, i10 = t6.createProgram(r15, o11);
  return n22 && null != c5 && !i10.compiled ? (c5(), null) : (s18.bindFramebuffer(e17), s18.setViewport(0, 0, e17.width, e17.height), s18.useProgram(i10), i10);
}
function y3(r15) {
  return v.get(r15.toLowerCase());
}
function R2(r15, e17, o11, t6) {
  const s18 = r15.rasterFunction.name.toLowerCase(), c5 = "reproject" === s18 ? s16 : y3(s18);
  if (null == c5) return;
  const n22 = F(r15, o11, t6, c5);
  if (!n22) return;
  c5.bindTextureAndUniforms(r15, n22, t6);
  const {
    interpolation: i10
  } = t6;
  "reproject" === s18 && (t6.interpolation = "nearest"), e17.draw();
  const [m7, a23] = t6.getRasterTextureSize("reproject" === s18), p3 = A2(m7, a23), u5 = new c(r15.context, p3);
  if (o11.copyToTexture(0, 0, m7, a23, 0, 0, u5), "reproject" === s18) t6.rasterTexture = u5, t6.projected = true, t6.interpolation = i10;
  else {
    const e18 = r15.hasBranches ? r15.rasterFunction.id : 0;
    t6.functionTextures[e18] = u5;
  }
}
v.set("arithmetic", o6), v.set("aspect", n7), v.set("bandarithmetic", s6), v.set("computechange", s8), v.set("compositeband", s7), v.set("convolution", o4), v.set("contrastbrightness", n11), v.set("curvature", n13), v.set("extractband", o5), v.set("statistics", n15), v.set("grayscale", n16), v.set("local", o6), v.set("mask", s13), v.set("ndvi", s14), v.set("remap", s15), v.set("slope", a19), v.set("stretch", n20);

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/BrushRasterBitmap.js
var h6 = class extends t3 {
  constructor() {
    super(...arguments), this.name = "raster", this._quad = null, this._rendererUniformInfos = /* @__PURE__ */ new Map(), this._fbo = null;
  }
  dispose() {
    r(this._quad), r(this._fbo);
  }
  prepareState(e17) {
    const {
      context: t6,
      renderPass: r15
    } = e17, s18 = "raster" === r15;
    t6.setBlendingEnabled(!s18), t6.setBlendFunctionSeparate(R.ONE, R.ONE_MINUS_SRC_ALPHA, R.ONE, R.ONE_MINUS_SRC_ALPHA), t6.setColorMask(true, true, true, true), t6.setStencilWriteMask(0), t6.setStencilTestEnabled(!s18);
  }
  draw(e17, r15) {
    if (!m3(r15) || r15.suspended) return;
    const {
      renderPass: s18
    } = e17;
    if ("raster-bitmap" !== s18) return "raster" === s18 ? this._process(e17, r15) : void this._drawBitmap(e17, r15, true);
    this._drawBitmap(e17, r15);
  }
  _process(t6, r15) {
    const {
      rasterFunction: i10
    } = t6, o11 = "Reproject" === i10.name;
    if (!(o11 ? !(r15.rasterTexture && r15.projected) : !r15.processed)) return;
    const {
      timeline: n22,
      context: a23
    } = t6;
    n22.begin(this.name);
    const d4 = a23.getBoundFramebufferObject(), c5 = a23.getViewport();
    o11 || (r15.processedTexture = r(r15.processedTexture)), a23.setStencilFunction(O.EQUAL, r15.stencilRef, 255), r15.updateTexture(t6), this._initQuad(a23);
    const [f4, u5] = r15.getRasterTextureSize(o11), {
      isStandardRasterTileSize: p3,
      fbo: h7
    } = this._getRasterFBO(a23, f4, u5);
    R2(t6, this._quad, h7, r15), p3 || h7.dispose(), a23.bindFramebuffer(d4), a23.setViewport(c5.x, c5.y, c5.width, c5.height), n22.end(this.name);
  }
  _drawBitmap(e17, t6, s18 = false) {
    const {
      timeline: i10,
      context: o11
    } = e17;
    if (i10.begin(this.name), o11.setStencilFunction(O.EQUAL, t6.stencilRef, 255), t6.updateTexture(e17), s18 && !t6.processedTexture) {
      if (t6.updateProcessedTexture(), !t6.processedTexture) return void i10.end(this.name);
      t6.processed = true;
    }
    this._initBitmapCommonUniforms(t6);
    const a23 = t6.symbolizerParameters.type, d4 = o3(a23), {
      requestRender: c5,
      allowDelayedRender: f4
    } = e17, {
      defines: u5,
      program: p3
    } = d4.createProgram(e17, t6, t6.projected && s18);
    if (f4 && null != c5 && !p3.compiled) return void c5();
    o11.useProgram(p3);
    const h7 = this._getUniformInfos(a23, o11, p3, u5);
    this._quad || (this._quad = new h4(o11, [0, 0, 1, 0, 0, 1, 1, 1])), d4.bindTextureAndUniforms(e17, p3, t6, h7, s18), this._quad.draw(), i10.end(this.name);
  }
  _initBitmapCommonUniforms(e17) {
    if (!e17.commonUniforms) {
      const t6 = g3(1, [0, 0]), {
        transformGrid: r15,
        width: s18,
        height: i10
      } = e17, o11 = l(r15, [s18, i10], [e17.source.width, e17.source.height], 1, false);
      e17.commonUniforms = __spreadProps(__spreadValues(__spreadValues({}, t6), o11), {
        u_coordScale: e17.coordScale
      });
    }
  }
  _getRasterFBO(e17, t6, r15) {
    const s18 = t6 === a3 && r15 === a3;
    return s18 ? (this._fbo || (this._fbo = this._createNewFBO(e17, t6, r15)), {
      isStandardRasterTileSize: s18,
      fbo: this._fbo
    }) : {
      isStandardRasterTileSize: s18,
      fbo: this._createNewFBO(e17, t6, r15)
    };
  }
  _createNewFBO(e17, t6, r15) {
    const s18 = A2(t6, r15);
    return new E(e17, s18);
  }
  _initQuad(e17) {
    this._quad || (this._quad = new h4(e17, [0, 0, 1, 0, 0, 1, 1, 1]));
  }
  _getUniformInfos(e17, t6, r15, s18) {
    const i10 = s18.length > 0 ? e17 + "-" + s18.join("-") : e17;
    if (this._rendererUniformInfos.has(i10)) return this._rendererUniformInfos.get(i10);
    const o11 = T(t6, r15);
    return this._rendererUniformInfos.set(i10, o11), o11;
  }
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/RasterTile.js
var i9 = class extends r5 {
  constructor(t6, e17, i10, a23, r15, l3, n22 = null) {
    super(t6, e17, i10, a23, r15, l3), this.bitmap = null, this.bitmap = new _3(n22, null, null), this.bitmap.coordScale = [r15, l3], this.bitmap.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.bitmap.destroy(), this.bitmap = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.bitmap.stencilRef = t6;
  }
  get stencilRef() {
    return this.bitmap.stencilRef;
  }
  setTransform(t6) {
    super.setTransform(t6), this.bitmap.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  _createTransforms() {
    return {
      displayViewScreenMat3: e3(),
      tileMat3: e3()
    };
  }
  onAttach() {
    this.bitmap.stage = this.stage;
  }
  onDetach() {
    this.bitmap.stage = null;
  }
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/RasterTileContainer.js
var o9 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false;
  }
  createTile(e17) {
    const s18 = this._getTileBounds(e17), [r15, i10] = this._tileInfoView.tileInfo.size, n22 = this._tileInfoView.getTileResolution(e17.level);
    return new i9(e17, n22, s18[0], s18[3], r15, i10);
  }
  prepareRenderPasses(e17) {
    const s18 = e17.registerRenderPass({
      name: "imagery (tile)",
      brushes: [h6],
      target: () => this.children.map((e18) => e18.bitmap),
      drawPhase: E2.MAP
    });
    return [...super.prepareRenderPasses(e17), s18];
  }
  doRender(e17) {
    if (!this.visible || e17.drawPhase !== E2.MAP) return;
    const {
      rasterFunctionChain: s18
    } = this;
    if (!s18) return e17.renderPass = "raster-bitmap", void super.doRender(e17);
    if (!s18.hasFocalFunction) {
      const [r15, t6] = this._tileInfoView.tileInfo.size;
      e17.renderPass = "raster", e17.rasterFunction = {
        name: "Reproject",
        parameters: {
          targetImageSize: [r15, t6],
          requireNNEdge: s18.isSourceSingleBand
        },
        pixelType: "f32",
        id: 0,
        isNoopProcess: false
      }, super.doRender(e17);
    }
    if (s18?.functions.length) {
      const {
        functions: r15,
        hasBranches: t6
      } = s18;
      for (let s19 = 0; s19 < r15.length; s19++) {
        const i10 = r15[s19];
        "Constant" !== i10.name && "Identity" !== i10.name && (e17.renderPass = "raster", e17.rasterFunction = i10, e17.hasBranches = t6, super.doRender(e17));
      }
    }
    e17.rasterFunction = null, e17.renderPass = "bitmap", super.doRender(e17);
  }
  _getTileBounds(r15) {
    const t6 = this._tileInfoView.getTileBounds(u(), r15);
    if (this.isCustomTilingScheme && r15.world) {
      const {
        tileInfo: e17
      } = this._tileInfoView, i10 = mt(e17.spatialReference);
      if (i10) {
        const s18 = e17.lodAt(r15.level);
        if (!s18) return t6;
        const {
          resolution: n22
        } = s18, o11 = i10 / n22 % e17.size[0], a23 = o11 ? (e17.size[0] - o11) * n22 : 0;
        t6[0] -= a23 * r15.world, t6[2] -= a23 * r15.world;
      }
    }
    return t6;
  }
};

// ../../../node_modules/@arcgis/core/views/2d/layers/imagery/BaseImageryTileSubView2D.js
var R3 = [0, 0];
var C2 = class extends S {
  constructor() {
    super(...arguments), this._updatingHandles = new h2(), this._emptyTilePixelBlock = null, this._tileStrategy = null, this._tileInfoView = null, this._fetchQueue = null, this._blockCacheRegistryUrl = null, this._blockCacheRegistryId = null, this._srcResolutions = [], this.previousLOD = null, this._needBlockCacheUpdate = false, this._globalSymbolizerParams = null, this._symbolizerParams = null, this._abortController = null, this._isCustomTilingScheme = false, this._maxIndexedColormapSize = 0, this._rasterFunctionState = "na", this._globalUpdateRequested = false, this.attached = false, this.timeExtent = null, this.redrawOrRefetch = k((..._0) => __async(this, [..._0], function* (e17 = {}) {
      const t6 = this._rasterFunctionState;
      if (e17.reprocess && (yield this._updatingHandles.addPromise(this.layer.updateRasterFunction()), this.updateRasterFunctionParameters()), !this.previousLOD || this.layerView.suspended) return;
      const i10 = this._rasterFunctionState, {
        type: s18
      } = this;
      return e17.refetch || "raster" !== s18 && !!e17.reprocess || "cpu" === i10 || "cpu" === t6 ? this._updatingHandles.addPromise(this.doRefresh()) : this._updatingHandles.addPromise(this._redrawImage(e17.signal));
    }));
  }
  destroy() {
    this._updatingHandles.destroy();
  }
  get useWebGLForProcessing() {
    return this._get("useWebGLForProcessing") ?? true;
  }
  set useWebGLForProcessing(e17) {
    this._set("useWebGLForProcessing", e17);
  }
  get useProgressiveUpdate() {
    return this._get("useProgressiveUpdate") ?? true;
  }
  set useProgressiveUpdate(e17) {
    if (this._tileStrategy && this.useProgressiveUpdate !== e17) {
      this._tileStrategy.destroy(), this.container.removeAllChildren();
      const t6 = this._getCacheSize(e17);
      this._tileStrategy = new r3({
        cachePolicy: "purge",
        acquireTile: (e18) => this.acquireTile(e18),
        releaseTile: (e18) => this.releaseTile(e18),
        cacheSize: t6,
        tileInfoView: this._tileInfoView
      }), this._set("useProgressiveUpdate", e17), this.layerView.requestUpdate();
    }
  }
  update(e17) {
    this._fetchQueue.pause(), this._fetchQueue.state = e17.state, this._tileStrategy.update(e17), this._fetchQueue.resume();
    const {
      extent: t6,
      resolution: i10,
      scale: s18
    } = e17.state, r15 = this._tileInfoView.getClosestInfoForScale(s18);
    if (this.layer.raster) {
      if (!this.useProgressiveUpdate || this._needBlockCacheUpdate) {
        const e18 = this._srcResolutions[r15.level], s19 = t6.toJSON ? t6 : w.fromJSON(t6);
        g2(this._blockCacheRegistryUrl, this._blockCacheRegistryId, s19, i10, e18, this.layer.raster.ioConfig.sampling);
      }
      this._needBlockCacheUpdate = false, this.previousLOD?.level !== r15.level && (this.previousLOD = r15, null == this._symbolizerParams || this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._tileStrategy.updateCacheSize(0));
    }
  }
  moveEnd() {
    !this.layerView.hasTilingEffects && this.useProgressiveUpdate || (this._abortController && this._abortController.abort(), this._abortController = new AbortController(), 0 === this._fetchQueue.length && this._redrawImage(this._abortController.signal).then(() => {
      this._globalUpdateRequested = false, this.layerView.requestUpdate();
    }));
    const e17 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy.updateCacheSize(e17), this.layerView.requestUpdate();
  }
  get updating() {
    return this._globalUpdateRequested || this._updatingHandles?.updating;
  }
  attach() {
    const e17 = t2();
    this._maxIndexedColormapSize = 4 * (e17.maxTextureSize || 4096), this._initializeTileInfo(), this._tileInfoView = new h3(this.layerView.tileInfo, this.layerView.fullExtent);
    const t6 = this._computeFetchConcurrency();
    this._fetchQueue = new m({
      tileInfoView: this._tileInfoView,
      concurrency: t6,
      process: (e18, t7) => this._fetchTile(e18, t7)
    });
    const i10 = this._getCacheSize(this.useProgressiveUpdate);
    this._tileStrategy = new r3({
      cachePolicy: "purge",
      acquireTile: (e18) => this.acquireTile(e18),
      releaseTile: (e18) => this.releaseTile(e18),
      cacheSize: i10,
      tileInfoView: this._tileInfoView
    }), this._updateBlockCacheRegistry();
  }
  detach() {
    this._tileStrategy.destroy(), this._fetchQueue.clear(), this.container.removeAllChildren(), this._fetchQueue = this._tileStrategy = this._tileInfoView = null, a4(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryUrl = this._blockCacheRegistryId = null;
  }
  acquireTile(e17) {
    const t6 = this.container.createTile(e17);
    return this._updatingHandles.addPromise(this._enqueueTileFetch(t6)), this.layerView.requestUpdate(), this._needBlockCacheUpdate = true, this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, t6;
  }
  releaseTile(e17) {
    this._fetchQueue.abort(e17.key.id), this.container.removeChild(e17), e17.once("detach", () => {
      e17.destroy(), this.layerView.requestUpdate();
    }), this.layerView.requestUpdate();
  }
  createEmptyTilePixelBlock(e17 = null) {
    const t6 = null == e17 || e17.join(",") === this._tileInfoView.tileInfo.size.join(",");
    if (t6 && null != this._emptyTilePixelBlock) return this._emptyTilePixelBlock;
    e17 = e17 || this._tileInfoView.tileInfo.size;
    const [i10, s18] = e17, r15 = new g({
      width: i10,
      height: s18,
      pixels: [new Uint8Array(i10 * s18)],
      mask: new Uint8Array(i10 * s18),
      pixelType: "u8"
    });
    return t6 && (this._emptyTilePixelBlock = r15), r15;
  }
  _getBandIds() {
    if (!("rasterFunctionChain" in this.container) || !this.container.rasterFunctionChain) return this.layer.bandIds;
    const {
      bandIds: e17,
      raster: t6
    } = this.layer, i10 = "rasterFunction" in t6 ? t6.rasterFunction.rawInputBandIds : null;
    return e17?.length && i10?.length && 1 !== t6.rasterInfo.bandCount ? e17.map((e18) => i10[Math.min(e18, i10.length - 1)]) : e17 || i10;
  }
  updateRasterFunctionParameters() {
  }
  _fetchTile(e17, t6) {
    const i10 = this._getFetchOptions(e17.level, t6.signal);
    return this.fetchTile(e17, i10);
  }
  _getFetchOptions(e17, t6) {
    const i10 = this.canUseWebGLForProcessing(), {
      layerView: s18
    } = this, {
      tileInfo: r15
    } = s18, a23 = !r15.isWrappable && null != D2(s18.view.spatialReference), o11 = i10 && this.layer.raster.hasUniqueSourceStorageInfo;
    return {
      allowPartialFill: true,
      datumTransformation: s18.datumTransformation,
      interpolation: i10 ? "nearest" : this.layer.interpolation,
      registryId: this._blockCacheRegistryId,
      requestRawData: o11,
      skipRasterFunction: "raster" === this.type && null != this.container.rasterFunctionChain,
      signal: t6,
      srcResolution: this._srcResolutions[e17],
      timeExtent: s18.timeExtent,
      tileInfo: r15,
      disableWrapAround: a23
    };
  }
  _getCacheSize(e17) {
    return e17 ? 40 : 0;
  }
  _initializeTileInfo() {
    const {
      layerView: e17
    } = this, t6 = e17.view.spatialReference;
    if (this._canUseLayerLODs()) {
      const {
        origin: i11,
        lods: s19
      } = this.layer.tileInfo, r16 = s19.map(({
        scale: e18
      }) => e18), a24 = z.create({
        spatialReference: t6,
        size: a3,
        scales: r16,
        origin: i11
      });
      return e17.set("tileInfo", a24), void (this._srcResolutions = s19.map(({
        resolution: e18
      }) => ({
        x: e18,
        y: e18
      })));
    }
    const {
      scales: i10,
      srcResolutions: s18,
      isCustomTilingScheme: r15
    } = ae(this.layer.serviceRasterInfo, t6, {
      tileSize: a3,
      alignGlobalDatasetWithAGOL: true,
      limitToSrcResolution: false
    }), a23 = z.create({
      spatialReference: t6,
      size: a3,
      scales: i10
    }), o11 = 0 === a23.origin.x, {
      xmin: l3,
      ymax: h7
    } = e17.fullExtent;
    (o11 || r15 && a23.origin.x > l3) && (a23.origin = new _({
      x: l3,
      y: h7,
      spatialReference: t6
    })), this._isCustomTilingScheme = r15, e17.set("tileInfo", a23), this._srcResolutions = s18 ?? [];
  }
  _canUseLayerLODs() {
    const {
      layer: e17,
      layerView: t6
    } = this;
    if ("Map" !== e17.raster.tileType) return false;
    const {
      lods: i10
    } = e17.tileInfo, s18 = t6.view.constraints?.effectiveLODs;
    return s18?.length === i10.length && s18.every(({
      scale: e18
    }, t7) => Math.abs(e18 - i10[t7].scale) < 1e-3);
  }
  _computeFetchConcurrency() {
    const {
      blockBoundary: e17
    } = this.layer.serviceRasterInfo.storageInfo, t6 = e17[e17.length - 1];
    return (t6.maxCol - t6.minCol + 1) * (t6.maxRow - t6.minRow + 1) > 64 ? 2 : 10;
  }
  _enqueueTileFetch(e17, t6) {
    return __async(this, null, function* () {
      if (!this._fetchQueue.has(e17.key.id)) {
        try {
          const t7 = yield this._fetchQueue.push(e17.key), a23 = this._getBandIds();
          let o11 = !this.useProgressiveUpdate || this.layerView.hasTilingEffects && !this._globalSymbolizerParams;
          if (this._globalUpdateRequested && !this.layerView.moving && 0 === this._fetchQueue.length) {
            o11 = false;
            try {
              yield this._redrawImage(this._abortController?.signal);
            } catch (s18) {
              b(s18) && n.getLogger(this).error(s18);
            }
            this._globalUpdateRequested = false;
          }
          !this.canUseWebGLForProcessing() && "rasterVF" !== this.type || this.layerView.hasTilingEffects || null != this._symbolizerParams || this._updateSymbolizerParams();
          const l3 = this._tileInfoView.getTileCoords(R3, e17.key), n22 = this._tileInfoView.getTileResolution(e17.key);
          yield this.updateTileSource(e17, {
            source: t7,
            symbolizerParams: this._symbolizerParams,
            globalSymbolizerParams: this._globalSymbolizerParams,
            suspended: o11,
            bandIds: a23,
            coords: l3,
            resolution: n22
          }), e17.once("attach", () => this.layerView.requestUpdate()), this.container.addChild(e17);
        } catch (s18) {
          b(s18) || n.getLogger(this).error(s18);
        }
        this.layerView.requestUpdate();
      }
    });
  }
  _redrawImage(e17) {
    return __async(this, null, function* () {
      if (0 === this.container.children.length) return;
      yield this.layer.updateRenderer(), this.layerView.hasTilingEffects ? yield this._updateGlobalSymbolizerParams(e17) : (this._updateSymbolizerParams(), this._globalSymbolizerParams = null);
      const t6 = this.container.children.map((e18) => __async(this, null, function* () {
        return this.updateTileSymbolizerParameters(e18, {
          local: this._symbolizerParams,
          global: this._globalSymbolizerParams
        });
      }));
      yield Promise.allSettled(t6), this.container.requestRender();
    });
  }
  _updateGlobalSymbolizerParams(e17) {
    return __async(this, null, function* () {
      const t6 = this._getFetchOptions(this.previousLOD.level, e17), i10 = yield this.layer.fetchPixels(this.layerView.view.extent, this.layerView.view.width, this.layerView.view.height, __spreadProps(__spreadValues({}, t6), {
        interpolation: "nearest",
        requestRawData: false,
        skipRasterFunction: false
      }));
      if (!i10?.pixelBlock) return;
      const {
        resolution: s18
      } = this.previousLOD, r15 = this._getBandIds(), a23 = this.layer.symbolizer.generateWebGLParameters({
        pixelBlock: i10.pixelBlock.extractBands(r15),
        isGCS: this.layerView.view.spatialReference.isGeographic,
        resolution: {
          x: s18,
          y: s18
        },
        bandIds: r15
      });
      !this.canUseWebGLForProcessing() && a23 && "stretch" === a23.type && this.layer.renderer && "raster-stretch" === this.layer.renderer.type && (a23.factor = a23.factor.map((e18) => 255 * e18), a23.outMin = Math.round(255 * a23.outMin), a23.outMax = Math.round(255 * a23.outMax)), this._globalSymbolizerParams = a23;
    });
  }
  _updateSymbolizerParams() {
    const {
      resolution: e17
    } = this.previousLOD, t6 = this._getBandIds();
    this._symbolizerParams = this.layer.symbolizer.generateWebGLParameters({
      pixelBlock: null,
      isGCS: this.layerView.view.spatialReference.isGeographic,
      resolution: {
        x: e17,
        y: e17
      },
      bandIds: t6
    });
  }
  _updateBlockCacheRegistry(e17 = false) {
    const {
      layer: t6,
      layerView: i10
    } = this, {
      raster: s18
    } = t6, {
      multidimensionalDefinition: r15
    } = t6.normalizeRasterFetchOptions({
      multidimensionalDefinition: t6.multidimensionalDefinition,
      timeExtent: i10.timeExtent
    }), a23 = s18.rasterInfo.multidimensionalInfo ? s18.getSliceIndex(r15) : null, o11 = i2(s18.rasterId, a23);
    if (o11 !== this._blockCacheRegistryUrl) {
      if (null != this._blockCacheRegistryUrl && a4(this._blockCacheRegistryUrl, this._blockCacheRegistryId), this._blockCacheRegistryId = u2(o11, s18.rasterInfo), e17) {
        const {
          view: e18
        } = i10, t7 = this._tileInfoView.getClosestInfoForScale(e18.scale), r16 = this._srcResolutions[t7.level];
        g2(o11, this._blockCacheRegistryId, e18.extent, e18.resolution, r16, s18.ioConfig.sampling);
      }
      this._blockCacheRegistryUrl = o11;
    }
  }
  doRefresh() {
    return __async(this, null, function* () {
      if (!this.attached || !this.previousLOD || this.layerView.suspended) return;
      yield this.layer.updateRenderer(), this.layerView.hasTilingEffects || this._updateSymbolizerParams(), this._updateBlockCacheRegistry(true), this._fetchQueue.reset();
      const e17 = [];
      this._globalUpdateRequested = this.layerView.hasTilingEffects || !this.useProgressiveUpdate, this._tileStrategy.refresh((t6) => e17.push(this._enqueueTileFetch(t6))), yield this._updatingHandles.addPromise(Promise.allSettled(e17));
    });
  }
};
e([y()], C2.prototype, "_globalUpdateRequested", void 0), e([y()], C2.prototype, "attached", void 0), e([y()], C2.prototype, "container", void 0), e([y()], C2.prototype, "layer", void 0), e([y()], C2.prototype, "layerView", void 0), e([y()], C2.prototype, "type", void 0), e([y()], C2.prototype, "useWebGLForProcessing", null), e([y()], C2.prototype, "useProgressiveUpdate", null), e([y()], C2.prototype, "timeExtent", void 0), e([y()], C2.prototype, "updating", null), C2 = e([a("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")], C2);

// ../../../node_modules/@arcgis/core/views/2d/layers/imagery/ImageryTileView2D.js
var a21 = class extends C2 {
  constructor() {
    super(...arguments), this.type = "raster";
  }
  attach() {
    super.attach(), this.container = new o9(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this.updateRasterFunctionParameters();
  }
  detach() {
    super.detach(), this.container.removeAllChildren(), this.container = null;
  }
  canUseWebGLForProcessing() {
    const {
      symbolizer: e17
    } = this.layer, t6 = e17.lookup?.colormapLut?.indexedColormap, r15 = t6 && t6.length > this._maxIndexedColormapSize;
    return this.useWebGLForProcessing && e17.canRenderInWebGL && !r15 && !("majority" === this.layer.interpolation && r4(this.layer));
  }
  fetchTile(e17, t6) {
    return this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
  }
  updateRasterFunctionParameters() {
    const {
      clips: e17,
      view: t6
    } = this.layerView;
    null != this._geometry && e17.remove(this._geometry);
    const {
      raster: r15,
      type: s18
    } = this.layer;
    if ("Function" === r15.datasetFormat) {
      const s19 = r15.getClippingGeometry(t6.spatialReference);
      if (s19) {
        const t7 = new a5({
          geometry: s19
        });
        e17.add(t7), this._geometry = t7;
      }
    }
    const {
      container: i10
    } = this;
    if ("Function" !== r15.datasetFormat || "wcs" === s18) return i10.rasterFunctionChain = null, i10.children.forEach((e18) => {
      const {
        bitmap: t7
      } = e18;
      t7 && (t7.suspended = true, t7.processed = false, t7.projected && (t7.invalidateTexture(), t7.rasterTexture = null));
    }), void (this._rasterFunctionState = "na");
    const o11 = this._rasterFunctionState, {
      rasterFunction: a23,
      primaryRasters: l3
    } = r15, c5 = a23.supportsGPU && (!l3 || l3.rasters.length <= 1), u5 = c5 ? a23.flatWebGLFunctionChain : null, {
      renderer: p3
    } = this.layer, d4 = !c5 || !u5?.functions.length || "raster-stretch" === p3?.type && p3.dynamicRangeAdjustment || !this.canUseWebGLForProcessing();
    i10.rasterFunctionChain = d4 ? null : u5;
    const h7 = null == a23 ? "na" : i10.rasterFunctionChain ? "gpu" : "cpu";
    i10.children.forEach((e18) => {
      const {
        bitmap: t7
      } = e18;
      t7 && (t7.suspended = o11 !== h7, t7.processed = false, t7.processedTexture = null);
    }), this._rasterFunctionState = h7;
  }
  updateTileSource(e17, t6) {
    return __async(this, null, function* () {
      const r15 = this._getBandIds(), s18 = this._getLayerInterpolation(), i10 = this.canUseWebGLForProcessing(), {
        source: o11,
        globalSymbolizerParams: n22,
        suspended: a23,
        coords: l3,
        resolution: c5
      } = t6, u5 = this.layerView.hasTilingEffects ? n22 : t6.symbolizerParams, {
        bitmap: p3
      } = e17;
      if ([p3.x, p3.y] = l3, p3.resolution = c5, null != o11?.pixelBlock) {
        const e18 = {
          extent: o11.extent,
          pixelBlock: o11.pixelBlock,
          srcPixelSize: o11.srcTilePixelSize
        };
        if (p3.rawPixelData = e18, i10) p3.source = o11.pixelBlock, p3.isRendereredSource = false;
        else {
          const t7 = yield this.layer.applyRenderer(e18, "stretch" === n22?.type ? n22 : void 0);
          p3.source = t7, p3.isRendereredSource = true;
        }
        p3.symbolizerParameters = i10 ? u5 : null, p3.transformGrid = i10 ? o11.transformGrid : null;
      } else {
        const e18 = this.createEmptyTilePixelBlock();
        p3.source = e18, p3.symbolizerParameters = i10 ? u5 : null, p3.transformGrid = null;
      }
      p3.bandIds = i10 ? r15 : null, p3.width = this._tileInfoView.tileInfo.size[0], p3.height = this._tileInfoView.tileInfo.size[1], p3.interpolation = s18, p3.suspended = a23, p3.invalidateTexture();
    });
  }
  updateTileSymbolizerParameters(e17, t6) {
    return __async(this, null, function* () {
      const {
        local: r15,
        global: s18
      } = t6, i10 = this._getBandIds(), o11 = this._getLayerInterpolation(), n22 = this.canUseWebGLForProcessing(), {
        bitmap: a23
      } = e17, {
        rawPixelData: l3
      } = a23;
      n22 || null == l3 ? (a23.isRendereredSource && null != l3 && (a23.source = l3.pixelBlock), a23.isRendereredSource = false) : (a23.source = yield this.layer.applyRenderer(l3, "stretch" === s18?.type ? s18 : void 0), a23.isRendereredSource = true), a23.symbolizerParameters = n22 ? this.layerView.hasTilingEffects ? s18 : r15 : null, a23.bandIds = n22 ? i10 : null, a23.interpolation = o11, a23.suspended = false;
    });
  }
  _getLayerInterpolation() {
    const {
      interpolation: e17,
      renderer: t6
    } = this.layer;
    if (!t6) return e17;
    const r15 = t6.type;
    return "raster-colormap" === r15 || "unique-value" === r15 || "class-breaks" === r15 ? "nearest" : "raster-stretch" === t6.type && null != t6.colorRamp ? "bilinear" === e17 || "cubic" === e17 ? "bilinear" : "nearest" : e17;
  }
};
e([y()], a21.prototype, "container", void 0), e([y()], a21.prototype, "layer", void 0), e([y()], a21.prototype, "type", void 0), a21 = e([a("esri.views.2d.layers.imagery.ImageryTileView2D")], a21);
var l2 = a21;

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTile.js
var r14 = class extends r5 {
  constructor(t6, e17, s18, a23, r15, l3, o11 = null) {
    super(t6, e17, s18, a23, r15, l3), this.tileData = new f2(o11), this.tileData.coordScale = [r15, l3], this.tileData.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.tileData.destroy(), this.tileData = null, this.stage = null;
  }
  set stencilRef(t6) {
    this.tileData.stencilRef = t6;
  }
  get stencilRef() {
    return this.tileData.stencilRef;
  }
  _createTransforms() {
    return {
      displayViewScreenMat3: e3(),
      tileMat3: e3()
    };
  }
  setTransform(s18) {
    super.setTransform(s18);
    const i10 = this.resolution / (s18.resolution * s18.pixelRatio), a23 = this.transforms.tileMat3, [r15, l3] = this.tileData.offset, o11 = [this.x + r15 * this.resolution, this.y - l3 * this.resolution], [n22, h7] = s18.toScreenNoRotation([0, 0], o11), {
      symbolTileSize: c5
    } = this.tileData.symbolizerParameters, f4 = Math.round((this.width - this.tileData.offset[0]) / c5) * c5, m7 = Math.round((this.height - this.tileData.offset[1]) / c5) * c5, D3 = f4 / this.rangeX * i10, d4 = m7 / this.rangeY * i10;
    r2(a23, D3, 0, 0, 0, d4, 0, n22, h7, 1), i(this.transforms.displayViewScreenMat3, s18.displayViewMat3, a23), this.tileData.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  onAttach() {
    this.tileData.stage = this.stage;
  }
  onDetach() {
    this.tileData.stage = null;
  }
};

// ../../../node_modules/@arcgis/core/views/2d/engine/imagery/RasterVFTileContainer.js
var o10 = class extends i3 {
  constructor() {
    super(...arguments), this.isCustomTilingScheme = false, this.symbolTypes = ["triangle"];
  }
  createTile(s18) {
    const t6 = this._tileInfoView.getTileBounds(u(), s18), [i10, o11] = this._tileInfoView.tileInfo.size, n22 = this._tileInfoView.getTileResolution(s18.level);
    return new r14(s18, n22, t6[0], t6[3], i10, o11);
  }
  prepareRenderPasses(e17) {
    const r15 = e17.registerRenderPass({
      name: "imagery (vf tile)",
      brushes: [d3],
      target: () => this.children.map((e18) => e18.tileData),
      drawPhase: E2.MAP
    });
    return [...super.prepareRenderPasses(e17), r15];
  }
  doRender(e17) {
    this.visible && e17.drawPhase === E2.MAP && this.symbolTypes.forEach((s18) => {
      e17.renderPass = s18, super.doRender(e17);
    });
  }
};

// ../../../node_modules/@arcgis/core/views/2d/layers/imagery/VectorFieldTileView2D.js
var a22 = class extends C2 {
  constructor() {
    super(...arguments), this._handle = null, this.type = "rasterVF";
  }
  canUseWebGLForProcessing() {
    return false;
  }
  fetchTile(e17, t6) {
    return __async(this, null, function* () {
      t6 = __spreadProps(__spreadValues({}, t6), {
        interpolation: "nearest",
        requestProjectedLocalDirections: true
      });
      const i10 = yield this.layer.fetchTile(e17.level, e17.row, e17.col, t6);
      return "vector-magdir" === this.layer.serviceRasterInfo?.dataType && i10?.pixelBlock && (i10.pixelBlock = yield this.layer.convertVectorFieldData(i10.pixelBlock, t6)), i10;
    });
  }
  updateTileSource(e17, t6) {
    const i10 = t6.symbolizerParams, {
      tileData: r15
    } = e17;
    r15.key = e17.key, r15.width = this._tileInfoView.tileInfo.size[0], r15.height = this._tileInfoView.tileInfo.size[1];
    const {
      symbolTileSize: o11
    } = i10, {
      source: s18
    } = t6;
    if (r15.offset = this._getTileSymbolOffset(r15.key, o11), null != s18?.pixelBlock) {
      const e18 = {
        extent: s18.extent,
        pixelBlock: s18.pixelBlock
      };
      r15.rawPixelData = e18, r15.symbolizerParameters = i10, r15.source = this._sampleVectorFieldData(s18.pixelBlock, i10, r15.offset);
    } else {
      const e18 = [Math.round((this._tileInfoView.tileInfo.size[0] - r15.offset[0]) / o11), Math.round((this._tileInfoView.tileInfo.size[1] - r15.offset[1]) / o11)], t7 = this.createEmptyTilePixelBlock(e18);
      r15.source = t7, r15.symbolizerParameters = i10;
    }
    return r15.invalidateVAO(), Promise.resolve();
  }
  updateTileSymbolizerParameters(e17, t6) {
    const i10 = t6.local, {
      symbolTileSize: r15
    } = i10, {
      tileData: o11
    } = e17;
    o11.offset = this._getTileSymbolOffset(o11.key, r15);
    const s18 = o11.symbolizerParameters.symbolTileSize;
    o11.symbolizerParameters = i10;
    const l3 = o11.rawPixelData?.pixelBlock;
    return null != l3 && s18 !== r15 && (o11.source = this._sampleVectorFieldData(l3, o11.symbolizerParameters, o11.offset)), Promise.resolve();
  }
  attach() {
    super.attach(), this.container = new o10(this._tileInfoView), this.container.isCustomTilingScheme = this._isCustomTilingScheme, this._updateSymbolType(this.layer.renderer), this._handle = d(() => this.layer.renderer, (e17) => this._updateSymbolType(e17));
  }
  detach() {
    super.detach(), this.container.removeAllChildren(), this._handle?.remove(), this._handle = null, this.container = null;
  }
  _getTileSymbolOffset(e17, t6) {
    const i10 = e17.col * this._tileInfoView.tileInfo.size[0] % t6, r15 = e17.row * this._tileInfoView.tileInfo.size[1] % t6;
    return [i10 > t6 / 2 ? t6 - i10 : -i10, r15 > t6 / 2 ? t6 - r15 : -r15];
  }
  _sampleVectorFieldData(e17, t6, i10) {
    const {
      symbolTileSize: r15
    } = t6;
    return S2(e17, "vector-uv", r15, i10);
  }
  _updateSymbolType(e17) {
    "vector-field" === e17.type && (this.container.symbolTypes = "wind-barb" === e17.style ? ["scalar", "triangle"] : "simple-scalar" === e17.style ? ["scalar"] : ["triangle"]);
  }
};
e([y()], a22.prototype, "container", void 0), e([y()], a22.prototype, "layer", void 0), e([y()], a22.prototype, "type", void 0), a22 = e([a("esri.views.2d.layers.imagery.VectorFieldTileView2D")], a22);
var n21 = a22;

// ../../../node_modules/@arcgis/core/views/2d/layers/ImageryTileLayerView2D.js
var b3 = class extends u3(i4(f(y2))) {
  constructor() {
    super(...arguments), this._useWebGLForProcessing = true, this._useProgressiveUpdate = true, this.subview = null;
  }
  get useWebGLForProcessing() {
    return this._useWebGLForProcessing;
  }
  set useWebGLForProcessing(e17) {
    this._useWebGLForProcessing = e17, this.subview && "useWebGLForProcessing" in this.subview && (this.subview.useWebGLForProcessing = e17);
  }
  get useProgressiveUpdate() {
    return this._useWebGLForProcessing;
  }
  set useProgressiveUpdate(e17) {
    this._useProgressiveUpdate = e17, this.subview && "useProgressiveUpdate" in this.subview && (this.subview.useProgressiveUpdate = e17);
  }
  get displayParameters() {
    const {
      layer: e17
    } = this, s18 = this._get("displayParameters");
    return e17.renderer ? {
      bandIds: e17.bandIds,
      renderer: e17.renderer,
      interpolation: e17.interpolation,
      multidimensionalDefinition: e17.multidimensionalDefinition,
      rasterFunction: "imagery-tile" === e17.type ? e17.rasterFunction : null
    } : s18;
  }
  update(e17) {
    this.subview?.update(e17), this.notifyChange("updating");
  }
  isUpdating() {
    return !this.subview || this.subview.updating;
  }
  attach() {
    this.layer.increaseRasterJobHandlerUsage(), this._updateSubview(), this.addAttachHandles([d(() => this.displayParameters, (e17, t6) => {
      const r15 = e17.interpolation !== t6?.interpolation && ("majority" === e17.interpolation || "majority" === t6?.interpolation) && r4(this.layer), o11 = e17.renderer !== t6?.renderer && this._getSubviewType(t6?.renderer) !== this._getSubviewType(e17.renderer);
      o11 && this._updateSubview();
      const a23 = e17.multidimensionalDefinition !== t6?.multidimensionalDefinition, n22 = e17.rasterFunction !== t6?.rasterFunction, u5 = n22 && !this._useWebGLForProcessing, h7 = a23 || r15 || o11 || u5;
      this.subview.redrawOrRefetch({
        refetch: h7,
        reprocess: n22
      }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating");
    }), d(() => this.layer.multidimensionalSubset ?? null, (e17, t6) => {
      const {
        multidimensionalDefinition: r15
      } = this.layer;
      null != r15 && o2(r15, e17) !== o2(r15, t6) && (this.subview.redrawOrRefetch({
        refetch: true
      }).catch((e18) => {
        b(e18) || n.getLogger(this).error(e18);
      }), this.notifyChange("updating"));
    }, C), d(() => this.timeExtent, () => {
      this.subview.timeExtent = this.timeExtent, this.subview.redrawOrRefetch({
        refetch: true
      }).catch((e17) => {
        b(e17) || n.getLogger(this).error(e17);
      });
    }, P)]);
  }
  detach() {
    this.layer.decreaseRasterJobHandlerUsage(), this._detachSubview(this.subview), this.subview?.destroy(), this.subview = null;
  }
  viewChange() {
    this.requestUpdate();
  }
  moveEnd() {
    this.subview.moveEnd();
  }
  doRefresh() {
    return this.subview ? this.subview.doRefresh() : Promise.resolve();
  }
  _updateSubview() {
    const {
      renderer: e17
    } = this.layer;
    if (!e17) return;
    const s18 = this._getSubviewType(e17);
    if (this.subview) {
      if (this.subview.type === s18) return void this._attachSubview(this.subview);
      this._detachSubview(this.subview), this.subview?.destroy(), this.subview = null;
    }
    const {
      layer: i10
    } = this;
    let t6;
    if (t6 = "rasterVF" === s18 ? new n21({
      layer: i10,
      layerView: this
    }) : "flow" === s18 ? new d2({
      layer: i10,
      layerView: this
    }) : new l2({
      layer: i10,
      layerView: this
    }), "useWebGLForProcessing" in t6 && (t6.useWebGLForProcessing = this._useWebGLForProcessing), "useProgressiveUpdate" in t6 && (t6.useProgressiveUpdate = this._useProgressiveUpdate), "previousLOD" in t6) {
      const {
        subview: e18
      } = this;
      t6.previousLOD = e18 && "previousLOD" in e18 ? e18.previousLOD : null;
    }
    this._attachSubview(t6), this.subview = t6, this.requestUpdate();
  }
  _attachSubview(e17) {
    e17 && !e17.attached && (e17.attach(), e17.attached = true, this.container.addChildAt(e17.container, 0));
  }
  _detachSubview(e17) {
    e17?.attached && (this.container.removeChild(e17.container), e17.detach(), e17.attached = false);
  }
  _getSubviewType(e17) {
    const s18 = e17?.type;
    return "vector-field" === s18 ? "rasterVF" : "flow" === s18 ? "flow" : "raster";
  }
};
e([y()], b3.prototype, "subview", void 0), e([y()], b3.prototype, "useWebGLForProcessing", null), e([y()], b3.prototype, "useProgressiveUpdate", null), e([y({
  readOnly: true
})], b3.prototype, "displayParameters", null), b3 = e([a("esri.views.2d.layers.ImageryTileLayerView2D")], b3);
var g4 = b3;
export {
  g4 as default
};
//# sourceMappingURL=ImageryTileLayerView2D-SYHB2A3D.js.map
