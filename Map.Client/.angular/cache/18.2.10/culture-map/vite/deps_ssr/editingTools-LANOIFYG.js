import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  m
} from "./chunk-4VYDNFW7.js";
import {
  f
} from "./chunk-3XDLGHCQ.js";
import {
  r as r3
} from "./chunk-LKON3V7U.js";
import {
  E as E4,
  F,
  F2 as F3,
  d as d5
} from "./chunk-JN3DA3L7.js";
import "./chunk-MAVN6DN4.js";
import "./chunk-6VEI6WC5.js";
import "./chunk-S5TDQEKK.js";
import "./chunk-7B3BAV5J.js";
import "./chunk-2RXZ22QZ.js";
import "./chunk-L2VTN5PI.js";
import "./chunk-R3ALLGC4.js";
import "./chunk-HIZXJ32N.js";
import {
  F2,
  h as h4
} from "./chunk-UWZXGGYT.js";
import {
  S as S3,
  s as s4
} from "./chunk-JGJES5EN.js";
import "./chunk-7J24PH7A.js";
import "./chunk-ZZE2XHDC.js";
import "./chunk-5E5FRWDI.js";
import "./chunk-DDGVA4UY.js";
import "./chunk-PVR7HFZS.js";
import "./chunk-PF7D56B5.js";
import "./chunk-VFDQ2IPM.js";
import "./chunk-DYMQWLSL.js";
import "./chunk-Q23C3NFQ.js";
import "./chunk-2I3RVFNX.js";
import "./chunk-MH54QISY.js";
import "./chunk-JEWURWPQ.js";
import "./chunk-7HWP2QWI.js";
import "./chunk-DUZT23UA.js";
import "./chunk-ZEZCWQFR.js";
import {
  E as E3,
  n as n4,
  p as p2,
  w
} from "./chunk-J5J3QXIV.js";
import {
  E,
  E2,
  e as e5,
  p
} from "./chunk-VC76DE2W.js";
import "./chunk-6NBMJUQX.js";
import "./chunk-RFURERTV.js";
import "./chunk-MIWJLMUG.js";
import "./chunk-MDOKECP3.js";
import "./chunk-IVVINOEJ.js";
import {
  d as d4,
  h as h3
} from "./chunk-DUSY4H5O.js";
import "./chunk-XUM2DDAI.js";
import "./chunk-IPGNBAEV.js";
import {
  W as W2,
  Z
} from "./chunk-377KSYNB.js";
import {
  n as n3
} from "./chunk-WQIJCG2D.js";
import "./chunk-WOWVQEU2.js";
import "./chunk-JRL65HQ7.js";
import "./chunk-AEX7USXS.js";
import "./chunk-BZGBXDFF.js";
import {
  t
} from "./chunk-62PN4TEW.js";
import "./chunk-OPXEKSUB.js";
import "./chunk-H5GZAILH.js";
import "./chunk-P6I54QB7.js";
import "./chunk-WYPPXVX7.js";
import "./chunk-T2SCEBLQ.js";
import {
  h as h2
} from "./chunk-XP4RC2MQ.js";
import "./chunk-MXW2KGHZ.js";
import "./chunk-O7RCHW3H.js";
import {
  I
} from "./chunk-62NDSO75.js";
import "./chunk-LVERV6OU.js";
import "./chunk-HKAONIBH.js";
import "./chunk-2H3S7IXI.js";
import "./chunk-2B3WLK32.js";
import "./chunk-SNHVHW2N.js";
import "./chunk-HVJMAP6C.js";
import "./chunk-U4NXHH3L.js";
import "./chunk-5RF6XDV4.js";
import "./chunk-Q47GASPN.js";
import "./chunk-B63XAMYJ.js";
import "./chunk-THUD7LGO.js";
import {
  e as e4,
  o,
  v
} from "./chunk-B76NC7GX.js";
import "./chunk-EFLOBCAZ.js";
import "./chunk-HFXXFWYN.js";
import "./chunk-EXKCGLRO.js";
import "./chunk-WRLGLGM6.js";
import "./chunk-47DYJR3W.js";
import "./chunk-QRWQ6QBB.js";
import "./chunk-ZSJNH2BT.js";
import "./chunk-ZFES27RA.js";
import "./chunk-XP2AJZUL.js";
import "./chunk-L6FG3WIC.js";
import "./chunk-6ZLH7XBS.js";
import "./chunk-44ZUWZXU.js";
import {
  G as G2
} from "./chunk-NAG6YX7T.js";
import "./chunk-EKHRAAS6.js";
import "./chunk-IEB4ZCRH.js";
import "./chunk-NHYYZMJR.js";
import {
  l
} from "./chunk-GNCXYHNE.js";
import "./chunk-CSK4VZQ7.js";
import "./chunk-2TNGEJGS.js";
import "./chunk-OYGNGIHQ.js";
import "./chunk-GSG4T2KM.js";
import {
  n as n2,
  s as s3
} from "./chunk-BZHHBBFX.js";
import "./chunk-GK5M6FUR.js";
import "./chunk-Y7SJWJAL.js";
import "./chunk-YGAXDKHF.js";
import "./chunk-4TOSJLKR.js";
import "./chunk-ORYC4PVJ.js";
import "./chunk-DXIKKLD7.js";
import "./chunk-VQNXE43R.js";
import "./chunk-VZ37C3ID.js";
import "./chunk-Q5TIVVER.js";
import "./chunk-X36BR2QB.js";
import "./chunk-RGG3YJQA.js";
import {
  d as d3
} from "./chunk-NVOJILW6.js";
import "./chunk-KYPTWEOO.js";
import "./chunk-WVFB3H4O.js";
import "./chunk-C7BQE556.js";
import {
  d as d2
} from "./chunk-ZREJ3Y2F.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-BBUQOCRA.js";
import "./chunk-YBUJLIWZ.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import {
  S as S2
} from "./chunk-IUPJR3FF.js";
import {
  y as y2
} from "./chunk-TGZW6QWO.js";
import "./chunk-OYIDHTXG.js";
import {
  u as u4
} from "./chunk-KUBMHTYA.js";
import "./chunk-VSQZQLTQ.js";
import "./chunk-K43CZ3M5.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-S4XQLN73.js";
import "./chunk-NXXQ35YM.js";
import {
  K,
  N as N2
} from "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-EO2EW5KR.js";
import "./chunk-JEFPXTYT.js";
import "./chunk-MVS2BECH.js";
import "./chunk-UZ7IOCF3.js";
import "./chunk-TPLUZX3A.js";
import "./chunk-BGLJ2FAH.js";
import "./chunk-2EJFYNM7.js";
import "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-5X5U7R6O.js";
import "./chunk-XNLAOXPY.js";
import "./chunk-ZT7V2AVD.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-I2TVVMQ6.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-JKPUNUQA.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import {
  j,
  u as u3
} from "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-HEG4CVDM.js";
import "./chunk-UVQYXHKM.js";
import "./chunk-M5N6UHWJ.js";
import "./chunk-EBCBYN6Y.js";
import "./chunk-ODFKYX74.js";
import "./chunk-EGBDRLCX.js";
import "./chunk-THZPD5CT.js";
import "./chunk-OBCA6CWH.js";
import "./chunk-2JI245BP.js";
import "./chunk-N34BRXVM.js";
import "./chunk-7QV7DHWN.js";
import "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import "./chunk-RNF7VOCU.js";
import {
  _
} from "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import "./chunk-DCXDXGAR.js";
import "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import {
  M,
  h
} from "./chunk-2OZSYJDX.js";
import {
  A,
  P as P2,
  e as e3,
  g,
  q,
  r as r2,
  s as s2,
  u as u2,
  z
} from "./chunk-MZM4INJV.js";
import {
  n
} from "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import {
  G,
  N,
  W2 as W,
  s2 as s
} from "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import "./chunk-JSKTDZU2.js";
import "./chunk-G73HQZEL.js";
import {
  P,
  d
} from "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e as e2
} from "./chunk-NUICEVIH.js";
import {
  S,
  r
} from "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  a3 as a
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import "./chunk-AIZ3T7E3.js";
import {
  e
} from "./chunk-6UEMNP3E.js";
import {
  u
} from "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import "./chunk-L4CMR4WM.js";
import "./chunk-7JIACICA.js";
import "./chunk-IE4UBD3F.js";
import "./chunk-IAO6HACY.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/draw/symbols.js
var t2 = new d2({
  data: {
    type: "CIMSymbolReference",
    symbol: {
      type: "CIMLineSymbol",
      symbolLayers: [{
        type: "CIMSolidStroke",
        effects: [{
          type: "CIMGeometricEffectDashes",
          dashTemplate: [3.75, 3.75],
          lineDashEnding: "HalfPattern",
          controlPointEnding: "NoConstraint"
        }],
        enable: true,
        capStyle: "Butt",
        joinStyle: "Round",
        miterLimit: 10,
        width: 1.6,
        color: [255, 255, 255, 255]
      }, {
        type: "CIMSolidStroke",
        enable: true,
        capStyle: "Butt",
        joinStyle: "Round",
        miterLimit: 10,
        width: 2,
        color: [0, 0, 0, 255]
      }]
    }
  }
});
var l2 = new y2({
  style: "circle",
  size: 6,
  color: [127, 127, 127, 1],
  outline: {
    color: [50, 50, 50],
    width: 1
  }
});
var i = new y2({
  style: "circle",
  size: 6,
  color: [255, 127, 0, 1],
  outline: {
    color: [50, 50, 50],
    width: 1
  }
});

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/draw/DrawGraphicTool2D.js
var E5 = class extends E4 {
  constructor(e6) {
    super(e6), this._visualElementGraphics = {
      regularVertices: null,
      activeVertex: null,
      activeEdge: null
    }, this.activeFillSymbol = null, this.type = "draw-2d", this._visualElementSymbols = {
      outline: e6.activeLineSymbol ?? t2,
      regularVertices: e6.regularVerticesSymbol ?? l2,
      activeVertex: e6.activeVertexSymbol ?? i,
      fill: e6.activeFillSymbol
    }, e6.activeVertexSymbol || this.addHandles(d(() => this.view?.effectiveTheme?.accentColor, (e7) => {
      if (!e7) return;
      const t4 = this._visualElementSymbols.activeVertex.clone().set({
        color: e7
      });
      this._visualElementGraphics.activeVertex?.set("symbol", t4), this._visualElementSymbols = __spreadProps(__spreadValues({}, this._visualElementSymbols), {
        activeVertex: t4
      });
    }, P));
  }
  normalizeCtorArgs(e6) {
    const t4 = __spreadValues({}, e6);
    return delete t4.activeFillSymbol, delete t4.activeVertexSymbol, delete t4.regularVerticesSymbol, delete t4.activeLineSymbol, t4;
  }
  initializeGraphic(e6) {
    return null != this._visualElementSymbols.fill && (e6.symbol = this._visualElementSymbols.fill), this.internalGraphicsLayer.graphics.sort(G3), e();
  }
  makeDrawOperation() {
    const {
      defaultZ: e6,
      hasZ: t4,
      view: i2
    } = this;
    return this._createOrUpdateGraphic(null), new F2({
      view: i2,
      manipulators: this.manipulators,
      geometryType: F(this.geometryType),
      drawingMode: this.mode,
      hasZ: t4,
      defaultZ: e6,
      snapToSceneEnabled: this.snapToScene,
      drawSurface: new h4(i2, t4, e6),
      hasM: false,
      snappingManager: this.snappingManager,
      snappingVisualizer: new f(this.internalGraphicsLayer),
      graphic: this.graphic,
      cursor: this.cursor,
      constraintsEnabled: true
    });
  }
  onActiveVertexChanged(e6) {
    if ("point" === this.geometryType) return e();
    const [s7, a2] = e6, l3 = new _({
      x: s7,
      y: a2,
      spatialReference: this.view.spatialReference
    });
    return null != this._visualElementGraphics.activeVertex ? (this._visualElementGraphics.activeVertex.geometry = l3, e()) : (this._visualElementGraphics.activeVertex = new d3({
      geometry: l3,
      symbol: this._visualElementSymbols.activeVertex,
      attributes: {
        displayOrder: 2
      }
    }), this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex), this.internalGraphicsLayer.graphics.sort(G3), e(() => {
      null != this._visualElementGraphics.activeVertex && (this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex), this._visualElementGraphics.activeVertex = u(this._visualElementGraphics.activeVertex));
    }));
  }
  onCursorEdgeChanged(e6) {
    return null != this._visualElementGraphics.activeEdge ? (this._visualElementGraphics.activeEdge.geometry = e6, e()) : (this._visualElementGraphics.activeEdge = new d3({
      geometry: e6,
      symbol: this._visualElementSymbols.outline,
      attributes: {
        displayOrder: 0
      }
    }), this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge), this.internalGraphicsLayer.graphics.sort(G3), e(() => {
      null != this._visualElementGraphics.activeEdge && (this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge), this._visualElementGraphics.activeEdge = u(this._visualElementGraphics.activeEdge));
    }));
  }
  onRegularVerticesChanged(e6) {
    const s7 = new u3({
      points: e6,
      spatialReference: this.view.spatialReference
    });
    return null != this._visualElementGraphics.regularVertices ? (this._visualElementGraphics.regularVertices.geometry = s7, e()) : (this._visualElementGraphics.regularVertices = new d3({
      geometry: s7,
      symbol: this._visualElementSymbols.regularVertices,
      attributes: {
        displayOrder: 1
      }
    }), this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices), this.internalGraphicsLayer.graphics.sort(G3), e(() => {
      null != this._visualElementGraphics.regularVertices && (this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices), this._visualElementGraphics.regularVertices = u(this._visualElementGraphics.regularVertices));
    }));
  }
};
function G3(e6, t4) {
  return (e6.attributes?.displayOrder ?? -1 / 0) - (t4.attributes?.displayOrder ?? -1 / 0);
}
e2([y()], E5.prototype, "activeFillSymbol", void 0), e2([y({
  readOnly: true
})], E5.prototype, "type", void 0), e2([y({
  constructOnly: true,
  nonNullable: true
})], E5.prototype, "view", void 0), E5 = e2([a("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")], E5);

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/manipulations/Manipulation.js
var r4 = class {
  get hovering() {
    return this.someManipulator((r6) => r6.hovering);
  }
  get grabbing() {
    return this.someManipulator((r6) => r6.grabbing);
  }
  get dragging() {
    return this.someManipulator((r6) => r6.dragging);
  }
  hasManipulator(r6) {
    return this.someManipulator((t4) => t4 === r6);
  }
  someManipulator(r6) {
    let t4 = false;
    return this.forEachManipulator((a2) => {
      !t4 && r6(a2) && (t4 = true);
    }), t4;
  }
};
var t3;
!function(r6) {
  r6[r6.TRANSLATE_XY = 0] = "TRANSLATE_XY", r6[r6.SCALE = 1] = "SCALE", r6[r6.ROTATE = 2] = "ROTATE";
}(t3 || (t3 = {}));

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/manipulations/DragManipulation.js
var s5 = class extends r4 {
  constructor(t4) {
    super(), this._view = t4.view, this._tool = t4.tool, this._graphic = t4.graphic, this._manipulator = this._createManipulator(), this.forEachManipulator((t5) => this._tool.manipulators.add(t5));
  }
  destroy() {
    this.forEachManipulator((t4) => {
      this._tool.manipulators.remove(t4), t4.destroy();
    }), this._tool = null, this._view = null, this._manipulator = null, this._graphic = null;
  }
  forEachManipulator(t4) {
    t4(this._manipulator, t3.TRANSLATE_XY);
  }
  createDragPipeline(t4, i2) {
    let o2 = null, s7 = null, l3 = 0, p3 = 0, c = 0;
    const {
      offsetX: m2,
      offsetY: h5,
      size: u6
    } = s4(this._graphic.symbol);
    return p2(this._manipulator, (r6, n7) => {
      n7.next((i3) => {
        if ("start" === i3.action) {
          const i4 = t4();
          o2 = i4.editGeometryOperations, s7 = i4.constraints;
        }
        return i3;
      }).next(E3(this._view)).next((t5) => {
        const {
          x: r7,
          y: a2,
          z: n8
        } = t5.mapEnd;
        if (s7 && (r7 + m2 < s7.xmin || a2 + h5 - u6 < s7.ymin || r7 + m2 > s7.xmax || a2 + h5 - u6 > s7.ymax)) return t5;
        ("start" === t5.action || 0 === l3 && 0 === p3 && 0 === c) && (l3 = t5.mapStart.x, p3 = t5.mapStart.y, c = t5.mapStart.z);
        const _2 = r7 - l3, f2 = a2 - p3, v3 = n8 - c;
        l3 = r7, p3 = a2, c = n8;
        const x = "start" === t5.action ? E.NEW_STEP : E.ACCUMULATE_STEPS, E7 = o2.move(_2, f2, v3, x);
        return i2(t5, E7), t5;
      });
    });
  }
  _createManipulator() {
    const t4 = this._view, i2 = this._graphic;
    return new S3({
      view: t4,
      graphic: i2,
      selectable: true,
      cursor: "move"
    });
  }
};

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/ControlPointsTransformTool.js
var P3 = {
  up: "ArrowUp",
  down: "ArrowDown",
  left: "ArrowLeft",
  right: "ArrowRight",
  toggleOpacity: "t",
  shift: "Shift",
  primaryKey: t
};
var v2 = 1;
var S4 = 10;
var k = new u4("#009AF2");
var b = class extends n4 {
  constructor(t4) {
    super(t4), this._isOpacityToggled = false, this._isModifierActive = false, this._factor = 1, this._initialControlPoints = null, this._graphicsLayer = new h2({
      internal: true,
      listMode: "hide",
      visible: false,
      effect: "drop-shadow(0px, 0px, 3px)"
    }), this._undoStack = [], this._redoStack = [], this._sharedUndoStack = [], this._sharedRedoStack = [], this._highlightHandle = null, this.activeHandle = 0;
  }
  initialize() {
    this._initialize();
  }
  destroy() {
    const {
      map: t4
    } = this.view;
    this._controlPointManipulations.forEach((t5) => t5.destroy()), this._controlPointEditGeometryOperations.forEach((t5) => t5.destroy()), t4.removeMany([this._graphicsLayer]), this._graphicsLayer.removeAll(), this._graphicsLayer = u(this._graphicsLayer), this._georeference = null, this._controlPointGraphics = null, this._controlPointManipulations = null, this._graphicsLayer = null, this._controlPointEditGeometryOperations = null, this._undoStack = null, this._redoStack = null, this._initialControlPoints = null, this._sharedUndoStack = null, this._sharedRedoStack = null;
  }
  get _hasValidSpatialReference() {
    return N(this.view.spatialReference);
  }
  onActivate() {
    this.visible = true;
  }
  onDeactivate() {
    this.visible = false;
  }
  onShow() {
    this._graphicsLayer.visible = true;
  }
  onHide() {
    this._graphicsLayer.visible = false;
  }
  canUndo() {
    const t4 = this._undoStack[this._undoStack.length - 1];
    return null != t4 && this._controlPointEditGeometryOperations[t4].canUndo;
  }
  canRedo() {
    const t4 = this._redoStack[this._redoStack.length - 1];
    return null != t4 && this._controlPointEditGeometryOperations[t4].canRedo;
  }
  undo() {
    if (this._undoStack.length > 0) {
      const t4 = this._undoStack.pop();
      this._controlPointEditGeometryOperations[t4].undo(), this.updateGraphics(), this._redoStack.push(t4);
    }
  }
  redo() {
    if (this._redoStack.length > 0) {
      const t4 = this._redoStack.pop();
      this._controlPointEditGeometryOperations[t4].redo(), this.updateGraphics(), this._undoStack.push(t4);
    }
  }
  refresh() {
    const {
      mediaElement: t4
    } = this;
    if (null == t4.georeference) return;
    const e6 = t4.georeference;
    "control-points" === e6.type && null != e6.coords && (this._georeference = e6, this._georeference.controlPoints.forEach(({
      mapPoint: t5
    }, e7) => {
      const i2 = this._controlPointEditGeometryOperations[e7], o2 = i2.data.components[0].vertices[0];
      i2.setVertexPosition(o2, i2.data.coordinateHelper.pointToVector(t5));
    }), this.updateGraphics());
  }
  reset() {
    this._georeference.controlPoints = this._initialControlPoints, this.refresh(), this._sharedUndoStack.length = 0, this._sharedRedoStack.length = 0;
  }
  updateGraphics() {
    const t4 = this._georeference, e6 = t4.controlPoints, i2 = e6[0].mapPoint.spatialReference, o2 = this._hasValidSpatialReference;
    this._georeference.controlPoints = this._controlPointEditGeometryOperations.map((r6, s7) => {
      const n7 = r6.data.geometry;
      return this._controlPointGraphics[s7].geometry = n7, {
        mapPoint: K(n7, i2),
        sourcePoint: o2 ? e6[s7].sourcePoint : t4.toSource(n7)
      };
    });
  }
  updateActiveHandle(t4) {
    if (this.activeHandle === t4) return;
    const e6 = this._controlPointGraphics[this.activeHandle].symbol.clone();
    I(e6, this.view.effectiveTheme.accentColor), this._controlPointGraphics[this.activeHandle].symbol = e6;
    const i2 = this._controlPointGraphics[t4].symbol.clone();
    I(i2, k), this._controlPointGraphics[t4].symbol = i2, this.activeHandle = t4, this.view.surface === document.activeElement && this.highlightActiveHandle();
  }
  highlightActiveHandle() {
    return __async(this, null, function* () {
      this.removeHighlightActiveHandle();
      const t4 = yield this.view.whenLayerView(this._graphicsLayer);
      this._highlightHandle = t4.highlight(this._controlPointGraphics[this.activeHandle]);
    });
  }
  removeHighlightActiveHandle() {
    this._highlightHandle && this._highlightHandle.remove();
  }
  setSharedUndoStack(t4) {
    this._sharedUndoStack = t4;
  }
  setSharedRedoStack(t4) {
    this._sharedRedoStack = t4;
  }
  _initialize() {
    return __async(this, null, function* () {
      const {
        view: t4,
        mediaElement: e6
      } = this;
      if (null == e6.georeference) return;
      const o2 = e6.georeference;
      "control-points" === o2.type && null != o2.coords && (this._georeference = o2, this._initialControlPoints = this._georeference.controlPoints, t4.map.addMany([this._graphicsLayer]), t4.focus(), this.visible = false, this.finishToolCreation(), yield this._loadProjectionEngine(), this._controlPointEditGeometryOperations = this._georeference.controlPoints.map(({
        mapPoint: e7
      }) => E2.fromGeometry(K(e7, t4.spatialReference), l.Local)), this._controlPointGraphics = this._controlPointEditGeometryOperations.map((t5, e7) => new d3({
        symbol: new d2({
          data: {
            type: "CIMSymbolReference",
            symbol: {
              type: "CIMPointSymbol",
              symbolLayers: [{
                type: "CIMVectorMarker",
                enable: true,
                colorLocked: true,
                anchorPoint: {
                  x: 0,
                  y: -15.75
                },
                anchorPointUnits: "Absolute",
                dominantSizeAxis3D: "Y",
                size: 9,
                billboardMode3D: "FaceNearPlane",
                frame: {
                  xmin: 0,
                  ymin: 0,
                  xmax: 84.3,
                  ymax: 84.3
                },
                markerGraphics: [{
                  type: "CIMMarkerGraphic",
                  geometry: {
                    rings: [[[83.2, 32.5], [84.3, 40.7], [83.8, 48.9], [81.7, 56.9], [78.1, 64.3], [73, 70.9], [66.9, 76.4], [59.7, 80.5], [51.9, 83.2], [43.7, 84.3], [35.4, 83.8], [27.4, 81.7], [20, 78], [13.4, 73], [7.9, 66.8], [3.8, 59.7], [1.1, 51.9], [0, 43.7], [0.5, 35.4], [2.6, 27.4], [6.3, 20], [11.3, 13.4], [17.5, 7.9], [24.7, 3.8], [32.5, 1.1], [39.8, 0.1], [47.1, 0.3], [54.3, 1.8], [61.1, 4.5], [67.4, 8.4], [72.9, 13.3], [77.4, 19.1], [80.9, 25.5], [83.2, 32.5]]]
                  },
                  symbol: {
                    type: "CIMPolygonSymbol",
                    symbolLayers: [{
                      type: "CIMSolidFill",
                      enable: true,
                      color: [255, 255, 255, 255]
                    }]
                  }
                }],
                scaleSymbolsProportionally: true,
                respectFrame: true,
                clippingPath: {
                  type: "CIMClippingPath",
                  clippingType: "Intersect",
                  path: {
                    rings: [[[0, 0], [84.3, 0], [84.3, 84.3], [0, 84.3], [0, 0]]]
                  }
                },
                rotation: 0
              }, {
                type: "CIMVectorMarker",
                enable: true,
                anchorPoint: {
                  x: 0,
                  y: -11.25
                },
                anchorPointUnits: "Absolute",
                dominantSizeAxis3D: "Y",
                size: 22.5,
                billboardMode3D: "FaceNearPlane",
                frame: {
                  xmin: 0,
                  ymin: 0,
                  xmax: 197.7,
                  ymax: 294.7
                },
                markerGraphics: [{
                  type: "CIMMarkerGraphic",
                  geometry: {
                    rings: [[[98.9, 0], [119.4, 23.2], [139.4, 49.3], [156.8, 75.2], [171.2, 100.8], [182.4, 125.3], [190.6, 148.8], [195.7, 171.4], [197.7, 192.9], [197.7, 195.8], [197.7, 200.3], [197.6, 202.5], [197.5, 204.8], [197.3, 207.1], [197, 209.4], [196.7, 211.7], [196.4, 214.1], [196, 216.4], [195.5, 218.7], [195, 221.1], [194.4, 223.4], [193.7, 225.8], [193, 228.1], [192.2, 230.5], [191.4, 232.8], [190.5, 235.1], [189.5, 237.5], [188.5, 239.7], [187.4, 242], [186.2, 244.3], [185, 246.5], [183.7, 248.7], [182.4, 250.9], [181, 253.1], [179.5, 255.2], [178, 257.3], [176.4, 259.4], [174.7, 261.4], [173.1, 263.3], [171.3, 265.3], [169.5, 267.2], [167.7, 269], [165.8, 270.8], [163.9, 272.5], [161.9, 274.2], [159.9, 275.8], [157.8, 277.4], [155.7, 278.9], [153.6, 280.4], [151.4, 281.7], [149.2, 283.1], [147, 284.4], [144.8, 285.6], [142.5, 286.7], [140.3, 287.8], [138, 288.8], [135.7, 289.8], [133.4, 290.7], [131, 291.5], [128.7, 292.3], [126.4, 293], [124, 293.6], [121.7, 294.2], [119.4, 294.7], [117, 295.2], [114.7, 295.6], [112.4, 296], [110.1, 296.3], [107.8, 296.5], [105.5, 296.7], [103.3, 296.8], [101.1, 296.9], [98.8, 296.9], [83.1, 295.7], [67.8, 292], [53.3, 285.9], [39.9, 277.5], [28.1, 267.2], [18, 255.1], [10, 241.5], [4.2, 226.9], [0.9, 211.5], [0, 195.8], [0.1, 192.9], [2.1, 171.4], [7.2, 148.8], [15.4, 125.3], [26.6, 100.8], [41, 75.2], [58.4, 49.3], [78.4, 23.2], [98.9, 0]]]
                  },
                  symbol: {
                    type: "CIMPolygonSymbol",
                    symbolLayers: [{
                      type: "CIMSolidFill",
                      enable: true,
                      color: e7 === this.activeHandle ? k.toArray() : this.view.effectiveTheme.accentColor.toArray()
                    }]
                  }
                }],
                scaleSymbolsProportionally: true,
                respectFrame: true,
                clippingPath: {
                  type: "CIMClippingPath",
                  clippingType: "Intersect",
                  path: {
                    rings: [[[0, 0], [197.7, 0], [197.7, 294.7], [0, 294.7], [0, 0]]]
                  }
                },
                rotation: 0
              }],
              haloSize: 1,
              scaleX: 1,
              angleAlignment: "Display",
              angle: 0
            }
          }
        }),
        geometry: t5.data.geometry
      })), this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]), this._controlPointManipulations = this._controlPointGraphics.map((e7) => new s5({
        tool: this,
        view: t4,
        graphic: e7
      })), this.addHandles([...this._controlPointManipulations.map((t5, e7) => t5.createDragPipeline(this._getInfo.bind(this, e7), (t6, i2) => {
        "start" === t6.action && (this._undoStack.push(e7), this._redoStack = [], this._sharedUndoStack.push({
          tool: this,
          operation: i2
        }), this._sharedRedoStack.length = 0), this.updateGraphics();
      })), d(() => this.view.scale, () => this.active ? this.updateGraphics() : null)]), this._controlPointManipulations.forEach((t5, e7) => {
        const i2 = (t6) => {
          this.addHandles([t6.events.on(["click", "grab-changed"], (t7) => this.updateActiveHandle(e7))]);
        };
        t5.forEachManipulator(i2);
      }), this.addHandles([t4.on("key-down", (i2) => {
        t4.activeTool === this && (i2.key !== P3.shift || i2.repeat || (this._isModifierActive = true, i2.stopPropagation()), i2.key !== P3.toggleOpacity || i2.repeat || (e6.opacity *= this._isOpacityToggled ? 2 : 0.5, this._isOpacityToggled = !this._isOpacityToggled, i2.stopPropagation()), i2.key !== P3.primaryKey || i2.repeat || (this._factor = S4, i2.stopPropagation()), this._isModifierActive && (i2.key === P3.up && (this._move(0, this._factor), i2.stopPropagation()), i2.key === P3.down && (this._move(0, -this._factor), i2.stopPropagation()), i2.key === P3.left && (this._move(-this._factor, 0), i2.stopPropagation()), i2.key === P3.right && (this._move(this._factor, 0), i2.stopPropagation())));
      }), t4.on("key-up", (e7) => {
        t4.activeTool === this && (e7.key === P3.shift && (this._isModifierActive = false, e7.stopPropagation()), e7.key === P3.primaryKey && (this._factor = v2, e7.stopPropagation()));
      })]));
    });
  }
  _loadProjectionEngine() {
    return __async(this, null, function* () {
      const t4 = this._georeference.controlPoints[0].mapPoint;
      return N2(t4.spatialReference, this.view.spatialReference);
    });
  }
  _getInfo(t4) {
    return {
      editGeometryOperations: this._controlPointEditGeometryOperations[t4],
      constraints: this._hasValidSpatialReference ? null : {
        xmin: 0,
        ymin: 0,
        xmax: this._georeference.width,
        ymax: this._georeference.height
      }
    };
  }
  _move(t4, e6) {
    const i2 = this._controlPointEditGeometryOperations[this.activeHandle].move(t4 * this.view.resolution, e6 * this.view.resolution, 0, E.NEW_STEP);
    this._sharedUndoStack.push({
      tool: this,
      operation: i2
    }), this._sharedRedoStack.length = 0, this.updateGraphics();
  }
};
e2([y()], b.prototype, "_hasValidSpatialReference", null), e2([y()], b.prototype, "activeHandle", void 0), e2([y({
  constructOnly: true,
  nonNullable: true
})], b.prototype, "mediaElement", void 0), e2([y({
  constructOnly: true
})], b.prototype, "view", void 0), b = e2([a("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")], b);

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/manipulations/utils.js
function n5(t4, e6) {
  "start" === t4.action ? e6.cursor = "grabbing" : e6.cursor = "grab";
}
var s6 = class {
  constructor() {
    this._lastDragEvent = null, this.next = new w(), this._enabled = false;
  }
  get enabled() {
    return this._enabled;
  }
  set enabled(t4) {
    if (this._enabled !== t4 && null != this._lastDragEvent) {
      const e6 = __spreadProps(__spreadValues({}, this._lastDragEvent), {
        action: "update"
      });
      t4 && this._adjustScaleFactors(e6), this.next.execute(e6);
    }
    this._enabled = t4;
  }
  createDragEventPipelineStep() {
    return this._lastDragEvent = null, (t4) => (this._lastDragEvent = "end" !== t4.action ? __spreadValues({}, t4) : null, this._enabled && this._adjustScaleFactors(t4), t4);
  }
  _adjustScaleFactors(t4) {
    const e6 = 0 !== t4.direction[0] && 0 !== t4.direction[1] ? Math.max(Math.abs(t4.factor1), Math.abs(t4.factor2)) : 0 === t4.direction[0] ? Math.abs(t4.factor2) : Math.abs(t4.factor1);
    t4.factor1 = t4.factor1 < 0 ? -e6 : e6, t4.factor2 = t4.factor2 < 0 ? -e6 : e6;
  }
};
var r5 = class {
  constructor() {
    this._lastDragEvent = null, this.next = new w(), this._enabled = false;
  }
  get enabled() {
    return this._enabled;
  }
  set enabled(t4) {
    if (this._enabled !== t4 && null != this._lastDragEvent) {
      const e6 = __spreadProps(__spreadValues({}, this._lastDragEvent), {
        action: "update"
      });
      t4 && this._adjustRotateAngle(e6), this.next.execute(e6);
    }
    this._enabled = t4;
  }
  createDragEventPipelineStep() {
    return this._lastDragEvent = null, (t4) => (this._lastDragEvent = "end" !== t4.action ? __spreadValues({}, t4) : null, this._enabled && this._adjustRotateAngle(t4), t4);
  }
  _adjustRotateAngle(a2) {
    const n7 = M(a2.rotateAngle);
    a2.rotateAngle = h(5 * Math.round(n7 / 5));
  }
};

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/manipulations/RotateManipulation.js
var u5 = class extends r4 {
  constructor(i2) {
    super(), this._handles = new r(), this._originCache = n(), this._view = i2.view, this._tool = i2.tool, this._graphic = i2.graphic, this._snapRotation = i2.snapRotation, this._manipulator = this._createManipulator(), this._handles.add([this._manipulator.events.on("grab-changed", (t4) => n5(t4, this._manipulator))]), this.forEachManipulator((t4) => this._tool.manipulators.add(t4));
  }
  destroy() {
    this._handles.destroy(), this.forEachManipulator((t4) => {
      this._tool.manipulators.remove(t4), t4.destroy();
    }), this._tool = null, this._view = null, this._manipulator = null, this._snapRotation = null, this._graphic = null, this._handles = null, this._originCache = null;
  }
  forEachManipulator(t4) {
    t4(this._manipulator, t3.ROTATE);
  }
  createDragPipeline(t4, r6) {
    let e6 = null, a2 = null;
    return p2(this._manipulator, (o2, s7) => {
      s7.next((i2) => {
        if ("start" === i2.action) {
          o2.cursor = "grabbing";
          const i3 = t4();
          e6 = i3.plane, a2 = i3.editGeometryOperations;
        }
        return i2;
      }).next(E3(this._view)).next((t5) => __spreadProps(__spreadValues({}, t5), {
        rotateAngle: m(t5.mapStart, t5.mapEnd, {
          x: e6.origin[0],
          y: e6.origin[1]
        }, true)
      })).next(this._snapRotation.createDragEventPipelineStep(), this._snapRotation.next).next((t5) => {
        const o3 = r2(this._originCache, e6.origin), n7 = "start" === t5.action ? E.NEW_STEP : E.ACCUMULATE_STEPS, s8 = a2.rotate(o3, t5.rotateAngle, n7, e5.REPLACE);
        return d5(s8, e6), r6(t5, s8), t5;
      }).next((t5) => ("end" === t5.action && (o2.cursor = "grab"), t5));
    });
  }
  _createManipulator() {
    const t4 = this._view, i2 = this._graphic;
    return new S3({
      view: t4,
      graphic: i2,
      selectable: true,
      cursor: "grab"
    });
  }
};

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/manipulations/ScaleManipulation.js
var E6 = 10;
var S5 = 1e-6;
var y3 = 0.3;
function j2(t4) {
  const i2 = s2(t4.basis1), e6 = s2(t4.basis2);
  return y3 * Math.min(i2, e6);
}
var w2 = class extends r4 {
  constructor(i2) {
    super(), this._handles = new r(), this._planeStart = W2(), this._displayPlaneStart = W2(), this._originCache = n(), this._axisCache = n2(), this._renderStartCache = n(), this._renderEndCache = n(), this._resizeOriginCache = n(), this._view = i2.view, this._tool = i2.tool, this._graphic = i2.graphic, this._direction = i2.direction, this._preserveAspectRatio = i2.preserveAspectRatio, this._manipulator = this._createManipulator(), this._handles.add([this._manipulator.events.on("grab-changed", (t4) => n5(t4, this._manipulator))]), this.forEachManipulator((t4) => this._tool.manipulators.add(t4));
  }
  destroy() {
    this._handles.destroy(), this.forEachManipulator((t4) => {
      this._tool.manipulators.remove(t4), t4.destroy();
    }), this._tool = null, this._view = null, this._graphic = null, this._manipulator = null, this._direction = null, this._handles = null, this._planeStart = null, this._displayPlaneStart = null, this._originCache = null, this._axisCache = null, this._renderStartCache = null, this._renderEndCache = null, this._resizeOriginCache = null, this._preserveAspectRatio = null;
  }
  forEachManipulator(t4) {
    t4(this._manipulator, t3.SCALE);
  }
  createDragPipeline(t4, r6) {
    let c = null, h5 = null, _2 = null, m2 = 0, d7 = null, g2 = null;
    const y4 = this._planeStart, w3 = this._displayPlaneStart, P4 = this._direction;
    return p2(this._manipulator, (f2, M2) => {
      M2.next((i2) => {
        if ("start" === i2.action) {
          f2.cursor = "grabbing";
          const i3 = t4();
          c = i3.plane, h5 = i3.displayPlane, _2 = i3.editGeometryOperations, m2 = E6 * this._view.resolution, Z(c, y4), Z(h5, w3);
          const e6 = s(_2.data.spatialReference);
          d7 = e6 ? e6.valid[1] - e6.valid[0] - 3 * E6 * this._view.resolution : null;
        }
        return i2;
      }).next(E3(this._view)).next((t5) => {
        const i2 = r2(this._renderStartCache, [t5.mapStart.x, t5.mapStart.y, 0]), e6 = r2(this._renderEndCache, [t5.mapEnd.x, t5.mapEnd.y, 0]), r7 = r2(this._resizeOriginCache, w3.origin);
        q(r7, r7, w3.basis1, -P4[0]), q(r7, r7, w3.basis2, -P4[1]), e3(e6, e6, r7), e3(i2, i2, r7);
        const c2 = 0 !== P4[0] && 0 !== P4[1], p3 = j2(w3), u6 = j2(h5) / p3, _3 = (t6, r8) => {
          if (0 === t6) return 1;
          let s7 = s2(r8), n7 = 0.5 * t6 * P2(r8, e6) / s7;
          const o2 = n7 < 0 ? -1 : 1;
          if (c2) {
            n7 += (s7 - 0.5 * t6 * P2(r8, i2) / s7) * o2 * u6;
          }
          const h6 = s7 < 1.5 * m2 ? 1 : S5;
          return s7 = Math.max(s7 - m2, S5), o2 > 0 && (n7 -= E6 * this._view.resolution), o2 * Math.max(o2 * (n7 / s7), h6);
        }, d8 = _3(P4[0], w3.basis1), f3 = _3(P4[1], w3.basis2);
        return __spreadProps(__spreadValues({}, t5), {
          direction: P4,
          factor1: d8,
          factor2: f3
        });
      }).next(this._preserveAspectRatio.createDragEventPipelineStep(), this._preserveAspectRatio.next).next((t5) => {
        const a2 = r2(this._originCache, y4.origin);
        q(a2, a2, y4.basis1, -P4[0]), q(a2, a2, y4.basis2, -P4[1]);
        const o2 = o(this._axisCache, y4.basis1[0], y4.basis1[1]);
        v(o2, o2);
        const l3 = _2.data.allVertices, h6 = "start" === t5.action ? E.NEW_STEP : E.ACCUMULATE_STEPS, u6 = _2.scaleVertices(l3, a2, o2, t5.factor1, t5.factor2, h6, e5.REPLACE);
        return d7 && d7 < _2.data.geometry.extent.width && g2 ? _2.updateVertices(l3, g2) : (Z(y4, c), d5(u6, c), g2 = u6.operation, r6(t5, u6)), t5;
      }).next((t5) => ("end" === t5.action && (f2.cursor = "grab"), t5));
    });
  }
  _createManipulator() {
    return new S3({
      view: this._view,
      graphic: this._graphic,
      selectable: true,
      cursor: "grab"
    });
  }
};

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/TransformTool.js
var K2 = 80;
var J = 10;
var Q = 30;
var X = [[1, 1], [1, -1], [-1, -1], [-1, 1], [1, 0], [0, -1], [-1, 0], [0, 1]];
var Y = 1;
var Z2 = 10;
var $ = class extends n4 {
  constructor(e6) {
    super(e6), this._initialControlPoints = null, this._initialGeometry = null, this._graphic = null, this._planeCache = W2(), this._displayPlaneCache = W2(), this._mainAxisCache = n2(), this._rotationHandleCache = n(), this._cornerA = n(), this._cornerB = n(), this._cornerC = n(), this._cornerD = n(), this._avgAB = n(), this._avgBC = n(), this._avgCD = n(), this._avgDA = n(), this._preserveAspectRatio = new s6(), this._snapRotation = new r5(), this._graphicsLayer = new h2({
      internal: true,
      listMode: "hide",
      visible: false
    }), this._sharedUndoStack = [], this._sharedRedoStack = [], this._isOpacityToggled = false, this._factor = Y, this.preserveAspectRatio = null, this.snapRotation = null;
  }
  initialize() {
    this._initialize();
  }
  destroy() {
    const {
      map: e6
    } = this.view;
    this._dragManipulation.destroy(), this._rotateManipulation.destroy(), this._scaleManipulations.forEach((e7) => e7.destroy()), this._editGeometryOperations.destroy(), e6.removeMany([this._graphicsLayer]), this._graphicsLayer.removeAll(), this._graphicsLayer = u(this._graphicsLayer), this._initialControlPoints = null, this._initialGeometry = null, this._graphic = null, this._preserveAspectRatio = null, this._snapRotation = null, this._planeCache = null, this._displayPlaneCache = null, this._rotationHandleCache = null, this._mainAxisCache = null, this._cornerA = null, this._cornerB = null, this._cornerC = null, this._cornerD = null, this._avgAB = null, this._avgBC = null, this._avgCD = null, this._avgDA = null, this._sharedUndoStack = null, this._sharedRedoStack = null;
  }
  get _plane() {
    const e6 = this._graphic.geometry;
    if (null == e6) return null;
    const t4 = this._editGeometryOperations.data, i2 = t4.components[0].edges[0], s7 = e4(this._mainAxisCache, i2.leftVertex.pos, i2.rightVertex.pos);
    v(s7, s7);
    let o2 = K2 * this.view.resolution;
    const a2 = this.view.spatialReference;
    return G(a2, e6.spatialReference) && (o2 *= W(a2) / W(e6.spatialReference)), F3(s7, t4, o2, this._planeCache);
  }
  get _displayPlane() {
    const e6 = this._plane;
    if (!e6) return null;
    const t4 = this._displayPlaneCache;
    Z(e6, t4);
    const i2 = J * this.view.resolution;
    return g(t4.basis1, t4.basis1, 1 + i2 / s2(t4.basis1)), g(t4.basis2, t4.basis2, 1 + i2 / s2(t4.basis2)), t4;
  }
  get _backgroundGraphicGeometry() {
    const e6 = this._displayPlane;
    if (!e6) return null;
    const t4 = this.view.spatialReference;
    return this._updateDisplayPlaneConrers(e6), new j({
      spatialReference: t4,
      rings: [[this._cornerA, this._cornerB, this._cornerC, this._cornerD, this._cornerA]]
    });
  }
  get _rotateGraphicGeometry() {
    const e6 = this._plane;
    if (!e6) return null;
    const t4 = this._rotationHandleCache;
    return z(t4, e6.basis1), g(t4, t4, Q * this.view.resolution), u2(t4, t4, e6.origin), u2(t4, t4, e6.basis1), new _({
      x: t4[0],
      y: t4[1],
      spatialReference: this.view.spatialReference
    });
  }
  get _scaleGraphicGeometries() {
    const e6 = this._displayPlane;
    if (!e6) return [];
    const t4 = this.view.spatialReference;
    this._updateDisplayPlaneConrers(e6);
    const {
      _cornerA: i2,
      _cornerB: s7,
      _cornerC: o2,
      _cornerD: r6
    } = this, a2 = A(this._avgAB, i2, s7, 0.5), n7 = A(this._avgBC, s7, o2, 0.5), c = A(this._avgCD, o2, r6, 0.5), h5 = A(this._avgDA, r6, i2, 0.5);
    return [new _({
      x: i2[0],
      y: i2[1],
      spatialReference: t4
    }), new _({
      x: s7[0],
      y: s7[1],
      spatialReference: t4
    }), new _({
      x: o2[0],
      y: o2[1],
      spatialReference: t4
    }), new _({
      x: r6[0],
      y: r6[1],
      spatialReference: t4
    }), new _({
      x: a2[0],
      y: a2[1],
      spatialReference: t4
    }), new _({
      x: n7[0],
      y: n7[1],
      spatialReference: t4
    }), new _({
      x: c[0],
      y: c[1],
      spatialReference: t4
    }), new _({
      x: h5[0],
      y: h5[1],
      spatialReference: t4
    })];
  }
  onActivate() {
    this.visible = true;
  }
  onDeactivate() {
    this.visible = false;
  }
  onShow() {
    this._graphicsLayer.visible = true;
  }
  onHide() {
    this._graphicsLayer.visible = false;
  }
  canUndo() {
    return this._editGeometryOperations.canUndo;
  }
  canRedo() {
    return this._editGeometryOperations.canRedo;
  }
  undo() {
    this._editGeometryOperations.undo(), this.updateGraphics();
  }
  redo() {
    this._editGeometryOperations.redo(), this.updateGraphics();
  }
  refresh() {
    const {
      view: e6,
      target: t4
    } = this, i2 = "georeference" in t4 ? t4.georeference.coords : t4.geometry, s7 = this._editGeometryOperations, o2 = s7.data.components[0].vertices, r6 = p.fromGeometry(K(i2, e6.spatialReference), l.Local).components[0].vertices;
    o2.forEach((e7, t5) => {
      s7.setVertexPosition(e7, r6[t5].pos);
    }), this.updateGraphics();
  }
  reset() {
    const {
      target: e6
    } = this;
    if ("georeference" in e6) {
      const t4 = e6.georeference;
      "control-points" === t4.type && (t4.controlPoints = this._initialControlPoints);
    } else e6.geometry = this._initialGeometry;
    this.refresh(), this._sharedUndoStack.length = 0, this._sharedRedoStack.length = 0;
  }
  updateGraphics() {
    const e6 = this._editGeometryOperations.data.geometry;
    if ("georeference" in this.target) {
      this.target.georeference.coords = e6;
    }
    this._graphic.geometry = e6, this._backgroundGraphic.geometry = this._backgroundGraphicGeometry, this._rotateGraphic.geometry = this._rotateGraphicGeometry, this._scaleGraphicGeometries.forEach((e7, t4) => {
      this._scaleGraphics[t4].geometry = e7;
    });
  }
  setSharedUndoStack(e6) {
    this._sharedUndoStack = e6;
  }
  setSharedRedoStack(e6) {
    this._sharedRedoStack = e6;
  }
  _initialize() {
    return __async(this, null, function* () {
      const {
        view: e6,
        target: s7
      } = this;
      if ("georeference" in s7) {
        const e7 = s7.georeference;
        this._graphic = new d3({
          geometry: e7.coords
        }), this._initialControlPoints = "control-points" === e7.type ? e7.controlPoints : null;
      } else this._graphic = s7, this._initialGeometry = s7.geometry;
      e6.map.addMany([this._graphicsLayer]), e6.focus(), this.visible = false, this.finishToolCreation(), yield this._loadProjectionEngine(), this._editGeometryOperations = E2.fromGeometry(K(this._graphic.geometry, e6.spatialReference), l.Local), this._backgroundGraphic = new d3({
        symbol: new S2({
          color: "transparent",
          outline: {
            type: "simple-line",
            color: e6.effectiveTheme.accentColor,
            width: 2
          }
        }),
        geometry: this._backgroundGraphicGeometry
      }), this._rotateGraphic = new d3({
        symbol: new y2({
          color: G2(e6.effectiveTheme.accentColor),
          outline: {
            type: "simple-line",
            color: e6.effectiveTheme.accentColor,
            width: 1
          }
        }),
        geometry: this._rotateGraphicGeometry
      }), this._scaleGraphics = this._scaleGraphicGeometries.map((s8) => new d3({
        symbol: new y2({
          size: 6,
          style: "square",
          color: G2(e6.effectiveTheme.accentColor),
          outline: {
            type: "simple-line",
            color: e6.effectiveTheme.accentColor,
            width: 1
          }
        }),
        geometry: s8
      })), this._graphicsLayer.graphics.addMany([this._backgroundGraphic, this._rotateGraphic, ...this._scaleGraphics]), this._dragManipulation = new s5({
        tool: this,
        view: e6,
        graphic: this._graphic
      }), this._rotateManipulation = new u5({
        tool: this,
        view: e6,
        graphic: this._rotateGraphic,
        snapRotation: this._snapRotation
      }), this._scaleManipulations = this._scaleGraphics.map((t4, i2) => new w2({
        tool: this,
        view: e6,
        graphic: t4,
        direction: X[i2],
        preserveAspectRatio: this._preserveAspectRatio
      })), this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this), this._updateGraphics.bind(this)), this._rotateManipulation.createDragPipeline(this._getInfo.bind(this), this._updateGraphics.bind(this)), ...this._scaleManipulations.map((e7) => e7.createDragPipeline(this._getInfo.bind(this), this._updateGraphics.bind(this))), d(() => this.view.scale, () => this.active ? this.updateGraphics() : null), e6.on("click", (t4) => __async(this, null, function* () {
        if (null != e6.activeTool && e6.activeTool !== this) return;
        const i2 = n3(t4), o2 = [];
        e6.map.allLayers.forEach((e7) => {
          "vector-tile" !== e7.type && "imagery" !== e7.type || o2.push(e7);
        });
        const r7 = yield this.view.hitTest(i2, {
          exclude: o2
        }), a3 = r7.results;
        if (0 === a3.length) e6.activeTool = null;
        else {
          const t5 = r3(r7.results), i3 = "georeference" in s7, o3 = a3.map((e7) => "media" === e7.type ? e7.element : null).filter(Boolean), n7 = new Set([...this._graphicsLayer.graphics, i3 ? null : s7].filter(Boolean));
          i3 && o3.includes(s7) || null != t5 && n7.has(t5.graphic) ? null == e6.activeTool && (e6.activeTool = this) : e6.activeTool = null;
        }
      }))]);
      const r6 = (e7) => {
        this.addHandles(e7.events.on("grab-changed", (e8) => {
          "georeference" in s7 && ("start" === e8.action ? s7.opacity *= 0.5 : "end" === e8.action && (s7.opacity *= 2));
        }));
      };
      this._dragManipulation.forEachManipulator(r6), this._rotateManipulation.forEachManipulator(r6), this._scaleManipulations.forEach((e7) => e7.forEachManipulator(r6));
      const a2 = new h3();
      a2.addToggle(d4.preserveAspectRatio, () => {
        null == this.preserveAspectRatio && (this._preserveAspectRatio.enabled = !this._preserveAspectRatio.enabled);
      }), a2.addToggle(d4.rotateIncrements, () => {
        null == this.snapRotation && (this._snapRotation.enabled = !this._snapRotation.enabled);
      }), a2.add(d4.toggleOpacity, () => {
        "georeference" in s7 && (s7.opacity *= this._isOpacityToggled ? 2 : 0.5, this._isOpacityToggled = !this._isOpacityToggled);
      }), a2.addToggle(d4.factorModifier, (e7) => this._factor = "key-down" === e7.type ? Z2 : Y), a2.add(d4.scaleUp, () => this._scale(this._factor)), a2.add(d4.scaleDown, () => this._scale(-this._factor)), a2.add(d4.moveUp, () => this._move(0, this._factor)), a2.add(d4.moveDown, () => this._move(0, -this._factor)), a2.add(d4.moveLeft, () => this._move(-this._factor, 0)), a2.add(d4.moveRight, () => this._move(this._factor, 0)), this.addHandles([e6.on("key-down", (t4) => {
        e6.activeTool === this && a2.dispatch(e6.inputManager, t4);
      }), e6.on("key-up", (t4) => {
        e6.activeTool === this && a2.dispatch(e6.inputManager, t4);
      })]);
    });
  }
  _loadProjectionEngine() {
    return __async(this, null, function* () {
      const e6 = this._graphic.geometry;
      return N2(e6.spatialReference, this.view.spatialReference);
    });
  }
  _updateDisplayPlaneConrers(e6) {
    const {
      basis1: t4,
      basis2: i2,
      origin: s7
    } = e6, o2 = this._cornerA;
    u2(o2, s7, t4), u2(o2, o2, i2);
    const r6 = this._cornerB;
    u2(r6, s7, t4), e3(r6, r6, i2);
    const a2 = this._cornerC;
    e3(a2, s7, t4), e3(a2, a2, i2);
    const n7 = this._cornerD;
    e3(n7, s7, t4), u2(n7, n7, i2);
  }
  _getInfo() {
    return {
      editGeometryOperations: this._editGeometryOperations,
      plane: this._plane,
      displayPlane: this._displayPlane
    };
  }
  _updateGraphics(e6, t4) {
    "start" === e6.action && (this._sharedUndoStack.push({
      tool: this,
      operation: t4
    }), this._sharedRedoStack.length = 0), this.updateGraphics();
  }
  _scale(e6) {
    const t4 = this._editGeometryOperations, i2 = t4.data.geometry.extent?.width, s7 = (i2 + e6 * this.view.resolution) / i2, o2 = t4.scale(this._plane.origin, s3, s7, s7, E.NEW_STEP, e5.REPLACE);
    this._sharedUndoStack.push({
      tool: this,
      operation: o2
    }), this._sharedRedoStack.length = 0, this.updateGraphics();
  }
  _move(e6, t4) {
    const i2 = this._editGeometryOperations.move(e6 * this.view.resolution, t4 * this.view.resolution, 0, E.NEW_STEP);
    this._sharedUndoStack.push({
      tool: this,
      operation: i2
    }), this._sharedRedoStack.length = 0, this.updateGraphics();
  }
};
e2([y()], $.prototype, "_plane", null), e2([y()], $.prototype, "_backgroundGraphicGeometry", null), e2([y()], $.prototype, "_rotateGraphicGeometry", null), e2([y()], $.prototype, "_scaleGraphicGeometries", null), e2([y()], $.prototype, "preserveAspectRatio", void 0), e2([y()], $.prototype, "snapRotation", void 0), e2([y({
  constructOnly: true,
  nonNullable: true
})], $.prototype, "target", void 0), e2([y({
  constructOnly: true
})], $.prototype, "view", void 0), $ = e2([a("esri.views.2d.interactive.editingTools.TransformTool")], $);

// ../../../node_modules/@arcgis/core/views/2d/interactive/editingTools/MediaTransformToolsWrapper.js
var n6 = {
  redo: "r",
  undo: "z"
};
var d6 = class extends S {
  constructor(o2) {
    super(o2), this._transformTool = null, this._controlPointsTransformTool = null, this._advancedModeTransformTool = null, this._activeTool = null, this._sharedUndoStack = [], this._sharedRedoStack = [], this._originalOpacity = null, this.activeHandle = 0;
  }
  initialize() {
    const {
      view: o2,
      mediaElement: t4,
      preserveAspectRatio: s7,
      snapRotation: i2,
      advancedMode: d7
    } = this;
    this._originalOpacity = t4.opacity, this._transformTool = new $({
      target: t4,
      view: o2,
      preserveAspectRatio: s7,
      snapRotation: i2
    }), this._controlPointsTransformTool = new b({
      mediaElement: t4,
      view: o2
    }), this._advancedModeTransformTool = new b({
      mediaElement: d7.mediaElement,
      view: d7.view
    }), this._transformTool.setSharedUndoStack(this._sharedUndoStack), this._transformTool.setSharedRedoStack(this._sharedRedoStack), this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack), this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack), this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack), this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);
    const l3 = t4.georeference, c = d7.mediaElement.georeference;
    d7.view.tools.addMany([this._advancedModeTransformTool]), "controlPoints" in c && "controlPoints" in l3 && this.addHandles([d7.view.on("key-down", (o3) => {
      o3.key === n6.undo && this.canUndo() && (this.undo(), o3.stopPropagation()), o3.key === n6.redo && this.canRedo() && (this.redo(), o3.stopPropagation());
    }), d7.view.on("focus", (o3) => __async(this, null, function* () {
      this._controlPointsTransformTool.removeHighlightActiveHandle(), this._advancedModeTransformTool.highlightActiveHandle();
    })), d(() => c.controlPoints, (o3) => {
      l3.controlPoints = o3.map(({
        sourcePoint: o4
      }, t5) => ({
        sourcePoint: o4,
        mapPoint: l3.controlPoints[t5].mapPoint
      })), this._activeTool?.refresh();
    }), d(() => this._controlPointsTransformTool.activeHandle, (o3) => {
      this._advancedModeTransformTool.updateActiveHandle(o3), this.activeHandle = o3;
    }), d(() => this._advancedModeTransformTool.activeHandle, (o3) => {
      this._controlPointsTransformTool.updateActiveHandle(o3), this.activeHandle = o3;
    })]), this.addHandles([o2.on("key-down", (o3) => {
      o3.key === n6.undo && this.canUndo() && (this.undo(), o3.stopPropagation()), o3.key === n6.redo && this.canRedo() && (this.redo(), o3.stopPropagation());
    }), o2.on("focus", (o3) => __async(this, null, function* () {
      this._advancedModeTransformTool.removeHighlightActiveHandle(), this._controlPointsTransformTool.highlightActiveHandle();
    }))]), o2.tools.addMany([this._transformTool, this._controlPointsTransformTool]), o2.activeTool = this._transformTool, this._activeTool = this._transformTool, o2.focus();
  }
  destroy() {
    this._transformTool?.destroy(), this._controlPointsTransformTool?.destroy(), this._transformTool = null, this._controlPointsTransformTool = null, this._advancedModeTransformTool = null, this._activeTool = null, this._sharedUndoStack = null, this._sharedRedoStack = null;
  }
  canUndo() {
    return this._sharedUndoStack.length > 0;
  }
  canRedo() {
    return this._sharedRedoStack.length > 0;
  }
  undo() {
    if (this._sharedUndoStack.length > 0) {
      const {
        tool: o2,
        operation: t4
      } = this._sharedUndoStack.pop();
      o2 !== this._activeTool && o2.refresh(), t4.undo(), o2.updateGraphics(), this._sharedRedoStack.push({
        tool: o2,
        operation: t4
      }), this._activeTool !== o2 && this._activeTool?.refresh();
    }
  }
  redo() {
    if (this._sharedRedoStack.length > 0) {
      const {
        tool: o2,
        operation: t4
      } = this._sharedRedoStack.pop();
      o2 !== this._activeTool && o2.refresh(), t4.apply(), o2.updateGraphics(), this._sharedUndoStack.push({
        tool: o2,
        operation: t4
      }), this._activeTool !== o2 && this._activeTool?.refresh();
    }
  }
  refresh() {
    this._activeTool.refresh();
  }
  reset() {
    this._activeTool.reset(), this._advancedModeTransformTool.reset();
  }
  enableAdvancedMode() {
    return __async(this, null, function* () {
      this.view.activeTool = this._controlPointsTransformTool, this._activeTool = this._controlPointsTransformTool, this._activeTool.refresh(), yield this.advancedMode.view.when(), this.advancedMode.view.activeTool = this._advancedModeTransformTool, this._originalOpacity = this._controlPointsTransformTool.mediaElement.opacity, this._controlPointsTransformTool.mediaElement.opacity = 0.25 * this._originalOpacity;
    });
  }
  disableAdvancedMode() {
    this.view.activeTool = this._transformTool, this._activeTool = this._transformTool, this._activeTool.refresh(), this.advancedMode.view.activeTool = null, this._controlPointsTransformTool.mediaElement.opacity = this._originalOpacity;
  }
};
e2([y()], d6.prototype, "activeHandle", void 0), e2([y({
  constructOnly: true
})], d6.prototype, "advancedMode", void 0), e2([y()], d6.prototype, "preserveAspectRatio", void 0), e2([y()], d6.prototype, "snapRotation", void 0), e2([y({
  constructOnly: true,
  nonNullable: true
})], d6.prototype, "mediaElement", void 0), e2([y({
  constructOnly: true
})], d6.prototype, "view", void 0), d6 = e2([a("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")], d6);
export {
  b as ControlPointsTransformTool,
  E5 as DrawGraphicTool2D,
  d6 as MediaTransformToolsWrapper,
  $ as TransformTool
};
//# sourceMappingURL=editingTools-LANOIFYG.js.map
