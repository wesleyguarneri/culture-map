{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/utils.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { makeHandle as t } from \"../../../../../core/handleUtils.js\";\nimport { Milliseconds as e } from \"../../../../../core/time.js\";\nimport { imageTypeToCanvas as r } from \"../../../../../geometry/support/meshUtils/exporters/gltf/imageutils.js\";\nimport { AnimatedSymbolRepeatType as i } from \"../../../../../symbols/cim/enums.js\";\nimport { getRandomValue as a } from \"../grouping.js\";\nfunction n(t) {\n  return e(t.frameDurations.reduce((t, e) => t + e, 0));\n}\nfunction o(t) {\n  const {\n      width: e,\n      height: r\n    } = t,\n    i = t.frameDurations.reverse(),\n    a = e => {\n      const r = t.frameDurations.length - 1 - e;\n      return t.getFrame(r);\n    };\n  return {\n    frameCount: t.frameCount,\n    duration: t.duration,\n    frameDurations: i,\n    getFrame: a,\n    width: e,\n    height: r\n  };\n}\nfunction s(t, r) {\n  const {\n      width: i,\n      height: a,\n      getFrame: n\n    } = t,\n    o = r / t.duration,\n    s = t.frameDurations.map(t => e(t * o));\n  return {\n    frameCount: t.frameCount,\n    duration: t.duration,\n    frameDurations: s,\n    getFrame: n,\n    width: i,\n    height: a\n  };\n}\nfunction m(t, r) {\n  const {\n      width: i,\n      height: a,\n      getFrame: n\n    } = t,\n    o = t.frameDurations.slice(),\n    s = o.shift();\n  return o.unshift(e(s + r)), {\n    frameCount: t.frameCount,\n    duration: t.duration + r,\n    frameDurations: o,\n    getFrame: n,\n    width: i,\n    height: a\n  };\n}\nfunction u(t, r) {\n  const {\n      width: i,\n      height: a,\n      getFrame: n\n    } = t,\n    o = t.frameDurations.slice(),\n    s = o.pop();\n  return o.push(e(s + r)), {\n    frameCount: t.frameCount,\n    duration: t.duration + r,\n    frameDurations: o,\n    getFrame: n,\n    width: i,\n    height: a\n  };\n}\nclass h {\n  constructor(t, e, r, i) {\n    this._animation = t, this._repeatType = r, this._onFrameData = i, this._direction = 1, this._currentFrame = 0, this.timeToFrame = this._animation.frameDurations[this._currentFrame];\n    let a = 0;\n    for (; e > a;) a += this.timeToFrame, this.nextFrame();\n    const n = this._animation.getFrame(this._currentFrame);\n    this._onFrameData(n);\n  }\n  nextFrame() {\n    if (this._currentFrame += this._direction, this._direction > 0) {\n      if (this._currentFrame === this._animation.frameDurations.length) switch (this._repeatType) {\n        case i.None:\n          this._currentFrame -= this._direction;\n          break;\n        case i.Loop:\n          this._currentFrame = 0;\n          break;\n        case i.Oscillate:\n          this._currentFrame -= this._direction, this._direction = -1;\n      }\n    } else if (-1 === this._currentFrame) switch (this._repeatType) {\n      case i.None:\n        this._currentFrame -= this._direction;\n        break;\n      case i.Loop:\n        this._currentFrame = this._animation.frameDurations.length - 1;\n        break;\n      case i.Oscillate:\n        this._currentFrame -= this._direction, this._direction = 1;\n    }\n    this.timeToFrame = this._animation.frameDurations[this._currentFrame];\n    const t = this._animation.getFrame(this._currentFrame);\n    this._onFrameData(t);\n  }\n}\nfunction c(t, r, c, f) {\n  let l,\n    {\n      repeatType: d\n    } = r;\n  if (null == d && (d = i.Loop), !0 === r.reverseAnimation && (t = o(t)), null != r.duration && (t = s(t, e(1e3 * r.duration))), null != r.repeatDelay) {\n    const a = 1e3 * r.repeatDelay;\n    d === i.Loop ? t = u(t, e(a)) : d === i.Oscillate && (t = m(u(t, e(a / 2)), e(a / 2)));\n  }\n  if (null != r.startTimeOffset) l = e(1e3 * r.startTimeOffset);else if (null != r.randomizeStartTime) {\n    const i = 82749913,\n      o = null != r.randomizeStartSeed ? r.randomizeStartSeed : i,\n      s = a(c, o);\n    l = e(s * n(t));\n  } else l = e(0);\n  return new h(t, l, d, f);\n}\nfunction f(e, r, i, a) {\n  const n = null == r.playAnimation || r.playAnimation,\n    o = c(e, r, i, a);\n  let s,\n    m = o.timeToFrame;\n  function u() {\n    s = n ? setTimeout(() => {\n      o.nextFrame(), m = o.timeToFrame, u();\n    }, m) : void 0;\n  }\n  return u(), t(() => n && clearTimeout(s));\n}\nlet l, d;\nfunction g() {\n  return l ??= document.createElement(\"canvas\"), d ??= l.getContext(\"2d\"), {\n    canvas: l,\n    ctx: d\n  };\n}\nfunction F(t, e, i) {\n  const {\n    canvas: a,\n    ctx: n\n  } = g();\n  a.width = e, a.height = i;\n  const o = [],\n    s = t.frameDurations.length;\n  for (let m = 0; m < s; m++) {\n    const a = t.getFrame(m);\n    n.clearRect(0, 0, e, i), a instanceof ImageData ? n.drawImage(r(a), 0, 0, e, i) : n.drawImage(a, 0, 0, e, i), o.push(n.getImageData(0, 0, e, i));\n  }\n  return {\n    width: e,\n    height: i,\n    frameDurations: t.frameDurations,\n    getFrame: t => o[t],\n    frameCount: t.frameCount,\n    duration: t.duration\n  };\n}\nexport { h as Player, s as adjustDuration, u as appendDelay, c as createPlayer, n as getDuration, f as play, m as prependDelay, F as resize, o as reverse };"],
  "mappings": "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",
  "names": ["n", "t", "e", "r", "o", "s", "m", "c", "f", "d", "u"]
}
