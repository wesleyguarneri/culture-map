import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  y as y2
} from "./chunk-F2EOMEXH.js";
import "./chunk-PZKTCBLJ.js";
import {
  f as f3,
  m,
  te
} from "./chunk-JZQVYISN.js";
import {
  e as e4
} from "./chunk-6Y3Z2LOO.js";
import {
  i as i2
} from "./chunk-HRIGBQ5I.js";
import "./chunk-WT2NMUXS.js";
import "./chunk-XDYMUXAT.js";
import "./chunk-FN552AT6.js";
import "./chunk-OEC3KBO5.js";
import "./chunk-YT63GLYW.js";
import "./chunk-BY3XBMAH.js";
import "./chunk-OO7WNZEW.js";
import "./chunk-LU7PU2CS.js";
import "./chunk-4O23HCRT.js";
import "./chunk-X5QZGB37.js";
import "./chunk-T5C2TZNO.js";
import "./chunk-AOGKNBDG.js";
import "./chunk-F4FQ67JP.js";
import "./chunk-FDI2X6GO.js";
import "./chunk-3XHDZQO5.js";
import "./chunk-2BLQXT54.js";
import "./chunk-JSWVKNBA.js";
import "./chunk-6NY22YWY.js";
import "./chunk-JBJJW35I.js";
import "./chunk-PXTZCDRW.js";
import "./chunk-GVEKX2VV.js";
import {
  t as t4
} from "./chunk-MM5HQGRH.js";
import {
  i
} from "./chunk-JA5GJ7PX.js";
import "./chunk-WQZJGTGX.js";
import "./chunk-VFQA3B5S.js";
import {
  l as l3
} from "./chunk-NOH3NLJ5.js";
import "./chunk-LX5BT6XP.js";
import "./chunk-PLGJMWC5.js";
import "./chunk-UGFQYEND.js";
import {
  e as e3
} from "./chunk-XC5RDNAY.js";
import "./chunk-KXVPQVTB.js";
import "./chunk-ARN5GJBK.js";
import "./chunk-MPLS4PY6.js";
import "./chunk-AGBPYPP3.js";
import "./chunk-VMZV7772.js";
import "./chunk-3FR2T2I2.js";
import "./chunk-LOZRWPGI.js";
import "./chunk-GZ64OOAB.js";
import "./chunk-WR2NVDOI.js";
import "./chunk-EPLJRYUV.js";
import "./chunk-VYRCS5VR.js";
import {
  l as l2
} from "./chunk-PQUZDC3L.js";
import "./chunk-UUQ5O7GK.js";
import "./chunk-6XY35LS7.js";
import "./chunk-JTDKNK44.js";
import "./chunk-RR7OQLEK.js";
import "./chunk-NAG6YX7T.js";
import "./chunk-WFNAKG2H.js";
import "./chunk-EKHRAAS6.js";
import "./chunk-IEB4ZCRH.js";
import "./chunk-WVSTX2NW.js";
import "./chunk-EXPZNTF3.js";
import "./chunk-ORYC4PVJ.js";
import "./chunk-DXIKKLD7.js";
import "./chunk-VQNXE43R.js";
import "./chunk-VZ37C3ID.js";
import "./chunk-5R3HARKC.js";
import "./chunk-BKSTWG4S.js";
import "./chunk-FSG7HOZQ.js";
import "./chunk-Q5TIVVER.js";
import "./chunk-ZPMUEGLK.js";
import "./chunk-GNFDYYU3.js";
import "./chunk-X36BR2QB.js";
import "./chunk-RGG3YJQA.js";
import "./chunk-GBJYL7OX.js";
import "./chunk-GHKVDSKU.js";
import "./chunk-NVOJILW6.js";
import "./chunk-KYPTWEOO.js";
import "./chunk-WVFB3H4O.js";
import "./chunk-C7BQE556.js";
import "./chunk-ZREJ3Y2F.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-BBUQOCRA.js";
import "./chunk-YBUJLIWZ.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import "./chunk-IUPJR3FF.js";
import "./chunk-TGZW6QWO.js";
import "./chunk-OYIDHTXG.js";
import "./chunk-KUBMHTYA.js";
import "./chunk-E5NWFBZG.js";
import "./chunk-FP37456K.js";
import "./chunk-VSQZQLTQ.js";
import "./chunk-K43CZ3M5.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-KLK34CGP.js";
import {
  j
} from "./chunk-BD24XM4D.js";
import {
  t
} from "./chunk-CSATD3VX.js";
import "./chunk-NXXQ35YM.js";
import "./chunk-3BXPVUY5.js";
import "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-CXNERL22.js";
import "./chunk-7V4JSBFA.js";
import {
  t as t3
} from "./chunk-ACSTKBET.js";
import {
  f as f2
} from "./chunk-REIMIECM.js";
import {
  l
} from "./chunk-EO2EW5KR.js";
import "./chunk-JEFPXTYT.js";
import "./chunk-MVS2BECH.js";
import {
  t as t2
} from "./chunk-UZ7IOCF3.js";
import {
  b as b2
} from "./chunk-OS542PQQ.js";
import {
  p
} from "./chunk-3B5GODXR.js";
import "./chunk-NKXXHQDD.js";
import {
  S
} from "./chunk-7TBQUMV3.js";
import {
  f
} from "./chunk-TPLUZX3A.js";
import "./chunk-BGLJ2FAH.js";
import "./chunk-2EJFYNM7.js";
import {
  c as c2
} from "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-5X5U7R6O.js";
import "./chunk-XNLAOXPY.js";
import "./chunk-ZT7V2AVD.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-I2TVVMQ6.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-JKPUNUQA.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-THZPD5CT.js";
import "./chunk-OBCA6CWH.js";
import {
  c
} from "./chunk-2JI245BP.js";
import "./chunk-ZEZ3LI2L.js";
import "./chunk-N34BRXVM.js";
import "./chunk-KETDH2J4.js";
import "./chunk-7QV7DHWN.js";
import "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import {
  w
} from "./chunk-RNF7VOCU.js";
import "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import {
  o
} from "./chunk-DCXDXGAR.js";
import {
  r
} from "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import "./chunk-2OZSYJDX.js";
import "./chunk-MZM4INJV.js";
import "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import {
  d2 as d
} from "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import {
  U
} from "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import "./chunk-G73HQZEL.js";
import "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e as e2
} from "./chunk-NUICEVIH.js";
import {
  e,
  n2 as n
} from "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  N,
  a3 as a2
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import {
  a,
  b
} from "./chunk-AIZ3T7E3.js";
import "./chunk-6UEMNP3E.js";
import "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import {
  s2 as s
} from "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/layers/MapImageLayer.js
var J = class extends l(l3(t2(m(f3(l2(b2(j(S(f2(i(e3(f)))))))))))) {
  constructor(...e5) {
    super(...e5), this._exportImageParameters = new y2({
      layer: this
    }), this.dateFieldsTimeZone = null, this.datesInUnknownTimezone = false, this.dpi = 96, this.gdbVersion = null, this.imageFormat = "png24", this.imageMaxHeight = 2048, this.imageMaxWidth = 2048, this.imageTransparency = true, this.isReference = null, this.labelsVisible = false, this.operationalLayerType = "ArcGISMapServiceLayer", this.preferredTimeZone = null, this.sourceJSON = null, this.sublayers = null, this.type = "map-image", this.url = null;
  }
  normalizeCtorArgs(e5, r2) {
    return "string" == typeof e5 ? __spreadValues({
      url: e5
    }, r2) : e5;
  }
  load(e5) {
    const r2 = null != e5 ? e5.signal : null;
    return this.addResolvingPromise(this.loadFromPortal({
      supportedTypes: ["Map Service"]
    }, e5).catch(a).then(() => this._fetchService(r2))), Promise.resolve(this);
  }
  destroy() {
    this._exportImageParameters.destroy();
  }
  readImageFormat(e5, r2) {
    const t5 = r2.supportedImageFormatTypes;
    return t5 && t5.includes("PNG32") ? "png32" : "png24";
  }
  writeSublayers(e5, r2, t5, s2) {
    if (!this.loaded || !e5) return;
    const i3 = e5.slice().reverse().flatten(({
      sublayers: e6
    }) => e6 && e6.toArray().reverse()).toArray();
    let o2 = false;
    const a3 = n(s2.origin);
    if (this.capabilities?.operations.supportsExportMap && this.capabilities?.exportMap?.supportsDynamicLayers) {
      if (a3 === e.PORTAL_ITEM) {
        const e6 = this.createSublayersForOrigin("service").sublayers;
        o2 = e4(i3, e6, e.SERVICE);
      } else if (a3 > e.PORTAL_ITEM) {
        const e6 = this.createSublayersForOrigin("portal-item");
        o2 = e4(i3, e6.sublayers, n(e6.origin));
      }
    }
    const p2 = [], n2 = __spreadValues({
      writeSublayerStructure: o2
    }, s2);
    let m2 = o2 || this.hasVisibleLayersForOrigin(a3);
    i3.forEach((e6) => {
      const r3 = e6.write({}, n2);
      p2.push(r3), m2 = m2 || "user" === e6.originOf("visible");
    });
    p2.some((e6) => Object.keys(e6).length > 1) && (r2.layers = p2), m2 && (r2.visibleLayers = i3.filter((e6) => e6.visible).map((e6) => e6.id));
  }
  createExportImageParameters(e5, r2, t5, s2) {
    const i3 = s2?.pixelRatio || 1;
    e5 && this.version >= 10 && (e5 = e5.clone().shiftCentralMeridian()), this._exportImageParameters.floors = s2?.floors ?? null, this._exportImageParameters.scale = i2({
      extent: e5,
      width: r2
    }) * i3;
    const o2 = this._exportImageParameters.toJSON(), a3 = !s2?.rotation || this.version < 10.3 ? {} : {
      rotation: -s2.rotation
    }, p2 = e5?.spatialReference, n2 = d(p2);
    o2.dpi *= i3;
    const m2 = {};
    if (s2?.timeExtent) {
      const {
        start: e6,
        end: r3
      } = s2.timeExtent.toJSON();
      m2.time = e6 && r3 && e6 === r3 ? "" + e6 : `${e6 ?? "null"},${r3 ?? "null"}`;
    } else this.timeInfo && !this.timeInfo.hasLiveData && (m2.time = "null,null");
    return __spreadValues(__spreadValues(__spreadValues({
      bbox: e5 && e5.xmin + "," + e5.ymin + "," + e5.xmax + "," + e5.ymax,
      bboxSR: n2,
      imageSR: n2,
      size: r2 + "," + t5
    }, o2), a3), m2);
  }
  fetchImage(e5, r2, t5, s2) {
    return __async(this, null, function* () {
      const {
        data: i3
      } = yield this._fetchImage("image", e5, r2, t5, s2);
      return i3;
    });
  }
  fetchImageBitmap(e5, r2, t5, s2) {
    return __async(this, null, function* () {
      const {
        data: i3,
        url: o2
      } = yield this._fetchImage("blob", e5, r2, t5, s2);
      return t3(i3, o2, s2?.signal);
    });
  }
  fetchRecomputedExtents() {
    return __async(this, arguments, function* (e5 = {}) {
      const s2 = __spreadProps(__spreadValues({}, e5), {
        query: __spreadProps(__spreadValues({
          returnUpdates: true,
          f: "json"
        }, this.customParameters), {
          token: this.apiKey
        })
      }), {
        data: i3
      } = yield U(this.url, s2), {
        extent: o2,
        fullExtent: a3,
        timeExtent: p2
      } = i3, n2 = o2 || a3;
      return {
        fullExtent: n2 && w.fromJSON(n2),
        timeExtent: p2 && c2.fromJSON({
          start: p2[0],
          end: p2[1]
        })
      };
    });
  }
  loadAll() {
    return t(this, (e5) => {
      e5(this.allSublayers), e5(this.subtables);
    });
  }
  serviceSupportsSpatialReference(e5) {
    return t4(this, e5);
  }
  _fetchImage(e5, t5, i3, o2, a3) {
    return __async(this, null, function* () {
      const n2 = {
        responseType: e5,
        signal: a3?.signal ?? null,
        query: __spreadProps(__spreadValues(__spreadValues(__spreadProps(__spreadValues(__spreadValues({}, this.parsedUrl.query), this.createExportImageParameters(t5, i3, o2, a3)), {
          f: "image"
        }), this.refreshParameters), this.customParameters), {
          token: this.apiKey
        })
      }, m2 = this.parsedUrl.path + "/export";
      if (null != n2.query?.dynamicLayers && !this.capabilities?.exportMap?.supportsDynamicLayers) throw new s("mapimagelayer:dynamiclayer-not-supported", `service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`, {
        query: n2.query
      });
      try {
        const {
          data: e6
        } = yield U(m2, n2);
        return {
          data: e6,
          url: m2
        };
      } catch (l4) {
        if (b(l4)) throw l4;
        throw new s("mapimagelayer:image-fetch-error", `Unable to load image: ${m2}`, {
          error: l4
        });
      }
    });
  }
  _fetchService(e5) {
    return __async(this, null, function* () {
      if (this.sourceJSON) return void this.read(this.sourceJSON, {
        origin: "service",
        url: this.parsedUrl
      });
      const {
        data: t5,
        ssl: s2
      } = yield U(this.parsedUrl.path, {
        query: __spreadProps(__spreadValues(__spreadValues({
          f: "json"
        }, this.parsedUrl.query), this.customParameters), {
          token: this.apiKey
        }),
        signal: e5
      });
      s2 && (this.url = this.url.replace(/^http:/i, "https:")), this.sourceJSON = t5, this.read(t5, {
        origin: "service",
        url: this.parsedUrl
      });
    });
  }
  hasVisibleLayersForOrigin(e5) {
    return !(null == e5 || !this.sublayersSourceJSON[e5]?.visibleLayers);
  }
};
e2([y(c("dateFieldsTimeReference"))], J.prototype, "dateFieldsTimeZone", void 0), e2([y({
  type: Boolean
})], J.prototype, "datesInUnknownTimezone", void 0), e2([y()], J.prototype, "dpi", void 0), e2([y()], J.prototype, "gdbVersion", void 0), e2([y()], J.prototype, "imageFormat", void 0), e2([o("imageFormat", ["supportedImageFormatTypes"])], J.prototype, "readImageFormat", null), e2([y({
  json: {
    origins: {
      service: {
        read: {
          source: "maxImageHeight"
        }
      }
    }
  }
})], J.prototype, "imageMaxHeight", void 0), e2([y({
  json: {
    origins: {
      service: {
        read: {
          source: "maxImageWidth"
        }
      }
    }
  }
})], J.prototype, "imageMaxWidth", void 0), e2([y()], J.prototype, "imageTransparency", void 0), e2([y({
  type: Boolean,
  json: {
    read: false,
    write: {
      enabled: true,
      overridePolicy: () => ({
        enabled: false
      })
    }
  }
})], J.prototype, "isReference", void 0), e2([y({
  json: {
    read: false,
    write: false
  }
})], J.prototype, "labelsVisible", void 0), e2([y({
  type: ["ArcGISMapServiceLayer"]
})], J.prototype, "operationalLayerType", void 0), e2([y({
  json: {
    read: false,
    write: false
  }
})], J.prototype, "popupEnabled", void 0), e2([y(c("preferredTimeReference"))], J.prototype, "preferredTimeZone", void 0), e2([y()], J.prototype, "sourceJSON", void 0), e2([y({
  json: {
    write: {
      ignoreOrigin: true
    }
  }
})], J.prototype, "sublayers", void 0), e2([r("sublayers", {
  layers: {
    type: [te]
  },
  visibleLayers: {
    type: [N]
  }
})], J.prototype, "writeSublayers", null), e2([y({
  type: ["show", "hide", "hide-children"]
})], J.prototype, "listMode", void 0), e2([y({
  json: {
    read: false
  },
  readOnly: true,
  value: "map-image"
})], J.prototype, "type", void 0), e2([y(p)], J.prototype, "url", void 0), J = e2([a2("esri.layers.MapImageLayer")], J);
var q = J;
export {
  q as default
};
//# sourceMappingURL=MapImageLayer-MEFIS76D.js.map
