import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  i as i6,
  i2 as i7,
  l as l3
} from "./chunk-AHJ63KFV.js";
import {
  n2 as n9
} from "./chunk-5WZBN555.js";
import {
  s as s3,
  u as u4
} from "./chunk-PE64OF24.js";
import {
  b as b5,
  i as i4,
  i2 as i5,
  p as p4
} from "./chunk-6TXK5CCD.js";
import {
  r as r5
} from "./chunk-PPFE3CUD.js";
import {
  n3 as n7,
  n4 as n8
} from "./chunk-ZTTGFJJT.js";
import {
  L
} from "./chunk-7HNGFXGM.js";
import {
  b as b4
} from "./chunk-ZGV7AVXO.js";
import "./chunk-H5Z6ZNKP.js";
import "./chunk-2L7HC722.js";
import {
  i as i3
} from "./chunk-CQIKG7VH.js";
import {
  m as m3
} from "./chunk-AENXIHUM.js";
import "./chunk-Z3B4X2BG.js";
import "./chunk-HKAONIBH.js";
import {
  I as I2
} from "./chunk-EXKCGLRO.js";
import "./chunk-WRLGLGM6.js";
import "./chunk-47DYJR3W.js";
import "./chunk-QRWQ6QBB.js";
import "./chunk-PLGJMWC5.js";
import {
  v as v2
} from "./chunk-VFYCIIDC.js";
import {
  r as r4
} from "./chunk-JTDKNK44.js";
import {
  l as l2
} from "./chunk-GNCXYHNE.js";
import "./chunk-Q5TIVVER.js";
import "./chunk-C7BQE556.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-KUBMHTYA.js";
import {
  b as b3,
  v as v3,
  w as w4
} from "./chunk-TVHVZK5G.js";
import {
  F
} from "./chunk-P2MUOE6G.js";
import "./chunk-6EIBUVMG.js";
import {
  n as n6,
  p as p3
} from "./chunk-FEZPDSKY.js";
import {
  i as i2
} from "./chunk-X4WQKYPS.js";
import {
  i
} from "./chunk-VDKX5QNO.js";
import "./chunk-JDVVCQU6.js";
import {
  o as o2
} from "./chunk-AKRJ5ORG.js";
import "./chunk-M6PHREXO.js";
import {
  e as e2
} from "./chunk-UAETKRWQ.js";
import "./chunk-KLK34CGP.js";
import {
  A
} from "./chunk-NBJSAHZT.js";
import "./chunk-YCXNHEGB.js";
import {
  t as t2
} from "./chunk-CSATD3VX.js";
import {
  n as n4,
  t
} from "./chunk-NXXQ35YM.js";
import {
  t as t3
} from "./chunk-XU6JZUMA.js";
import {
  f as f3,
  u as u3
} from "./chunk-3BXPVUY5.js";
import {
  J
} from "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-CXNERL22.js";
import "./chunk-7V4JSBFA.js";
import {
  S as S2,
  m as m2
} from "./chunk-7TBQUMV3.js";
import {
  f as f4
} from "./chunk-TPLUZX3A.js";
import {
  c
} from "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import {
  n as n5,
  r as r3
} from "./chunk-XNLAOXPY.js";
import "./chunk-ZT7V2AVD.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import {
  y as y2
} from "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-EGBDRLCX.js";
import "./chunk-OBCA6CWH.js";
import "./chunk-2JI245BP.js";
import "./chunk-N34BRXVM.js";
import "./chunk-557VKXWR.js";
import {
  S
} from "./chunk-KETDH2J4.js";
import {
  C
} from "./chunk-7QV7DHWN.js";
import {
  m
} from "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import {
  n as n2
} from "./chunk-2HDBQXAR.js";
import {
  w as w3
} from "./chunk-RNF7VOCU.js";
import "./chunk-TIRJMGGG.js";
import {
  f as f2
} from "./chunk-ZDRQSPB6.js";
import {
  o
} from "./chunk-DCXDXGAR.js";
import {
  r
} from "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import {
  s as s2
} from "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import {
  d as d2
} from "./chunk-2OZSYJDX.js";
import {
  p as p2
} from "./chunk-MZM4INJV.js";
import {
  n as n3
} from "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import {
  P2 as P
} from "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import {
  I,
  kt,
  r2
} from "./chunk-XLEC46FY.js";
import {
  d,
  f
} from "./chunk-4AZPIP7K.js";
import {
  p,
  v,
  w as w2
} from "./chunk-LZSLQ24Q.js";
import {
  V
} from "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import {
  _
} from "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e
} from "./chunk-NUICEVIH.js";
import "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  N,
  a3 as a2,
  b as b2
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import {
  b,
  k,
  u as u2,
  w
} from "./chunk-AIZ3T7E3.js";
import "./chunk-6UEMNP3E.js";
import {
  l,
  u
} from "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import {
  a,
  n2 as n,
  s2 as s
} from "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/support/webSceneUtils.js
var r6 = "webscene:failed-to-copy-embedded-resources";
var o3 = "webscene:schema-validation";
function n10() {
  return new s(r6, "Copying of embedded resources is currently not supported");
}
function s4(r7) {
  return new s(o3, "Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information", {
    errors: r7
  });
}

// ../../../node_modules/@arcgis/core/webscene/ApplicationProperties.js
var i8;
var p5 = i8 = class extends f {
  constructor(o4) {
    super(o4), this.viewing = null;
  }
  clone() {
    return new i8({
      viewing: this.viewing?.clone() ?? null
    });
  }
};
e([y({
  type: i7,
  json: {
    write: true
  }
})], p5.prototype, "viewing", void 0), p5 = i8 = e([a2("esri.webscene.ApplicationProperties")], p5);
var c2 = p5;

// ../../../node_modules/@arcgis/core/webscene/InitialViewProperties.js
var l4;
var c3 = l4 = class extends f {
  constructor(e5) {
    super(e5), this.environment = new b5(), this.spatialReference = null, this.viewpoint = null, this.timeExtent = null;
  }
  set viewingMode(e5) {
    this._set("viewingMode", e5);
  }
  clone() {
    return new l4({
      environment: this.environment.clone(),
      spatialReference: this.spatialReference?.clone() ?? null,
      viewingMode: this.viewingMode,
      viewpoint: this.viewpoint?.clone() ?? null,
      timeExtent: this.timeExtent?.clone() ?? null
    });
  }
};
e([y({
  type: b5,
  json: {
    write: {
      isRequired: true
    }
  }
})], c3.prototype, "environment", void 0), e([y({
  type: f2
})], c3.prototype, "spatialReference", void 0), e([y({
  type: ["local", "global"]
})], c3.prototype, "viewingMode", null), e([y({
  type: m3,
  json: {
    write: {
      isRequired: true
    }
  }
})], c3.prototype, "viewpoint", void 0), e([y(s3)], c3.prototype, "timeExtent", void 0), c3 = l4 = e([a2("esri.webscene.InitialViewProperties")], c3);
var m4 = c3;

// ../../../node_modules/@arcgis/core/webscene/support/Description.js
var e3;
var p6 = e3 = class extends f {
  constructor() {
    super(...arguments), this.text = "";
  }
  clone() {
    return new e3({
      text: this.text
    });
  }
};
e([y({
  type: String,
  json: {
    write: true
  }
})], p6.prototype, "text", void 0), p6 = e3 = e([a2("esri.webscene.support.Description")], p6);
var c4 = p6;

// ../../../node_modules/@arcgis/core/webscene/support/SlideEnvironment.js
var c5;
var h = c5 = class extends f {
  constructor() {
    super(...arguments), this.lighting = new p4(), this.weather = new n7();
  }
  clone() {
    return new c5({
      lighting: a(this.lighting),
      weather: a(this.weather)
    });
  }
};
e([y({
  types: i5,
  json: {
    write: true
  }
})], h.prototype, "lighting", void 0), e([y({
  types: n8,
  json: {
    write: true
  }
})], h.prototype, "weather", void 0), h = c5 = e([a2("esri.webscene.Environment")], h);

// ../../../node_modules/@arcgis/core/webscene/support/SlideGround.js
var i9;
var n11 = i9 = class extends f {
  constructor() {
    super(...arguments), this.opacity = null;
  }
  clone() {
    return new i9({
      opacity: this.opacity
    });
  }
  cloneAndApplyTo(r7) {
    return null == this.opacity || ((r7 = r7?.clone() ?? new b4()).opacity = this.opacity), r7;
  }
  static fromGround(r7) {
    return new i9({
      opacity: r7.opacity
    });
  }
};
e([y({
  type: Number,
  json: {
    type: N,
    read: {
      reader: r3,
      source: "transparency"
    },
    write: {
      writer: (r7, o4) => {
        o4.transparency = n5(r7);
      },
      target: "transparency"
    }
  }
})], n11.prototype, "opacity", void 0), n11 = i9 = e([a2("esri.webscene.support.SlideGround")], n11);
var u5 = n11;

// ../../../node_modules/@arcgis/core/webscene/support/SlideVisibleLayer.js
var i10;
var c6 = i10 = class extends f {
  constructor(r7) {
    super(r7), this.id = "", this.sublayerIds = null;
  }
  clone() {
    return new i10({
      id: this.id,
      sublayerIds: a(this.sublayerIds)
    });
  }
};
e([y({
  type: String,
  json: {
    write: true
  }
})], c6.prototype, "id", void 0), e([y({
  type: [N],
  json: {
    read: {
      source: "subLayerIds"
    },
    write: {
      target: "subLayerIds"
    }
  }
})], c6.prototype, "sublayerIds", void 0), c6 = i10 = e([a2("esri.webscene.support.SlideVisibleLayer")], c6);

// ../../../node_modules/@arcgis/core/webscene/support/Title.js
var s5;
var p7 = s5 = class extends f {
  constructor() {
    super(...arguments), this.text = "";
  }
  clone() {
    return new s5({
      text: this.text
    });
  }
};
e([y({
  type: String,
  json: {
    write: {
      isRequired: true
    }
  }
})], p7.prototype, "text", void 0), p7 = s5 = e([a2("esri.webscene.support.Title")], p7);
var c7 = p7;

// ../../../node_modules/@arcgis/core/webscene/Slide.js
var A2 = 0;
var P2 = V.ofType(c6);
var q = class extends f {
  constructor(e5) {
    super(e5), this.id = Date.now().toString(16) + "-slide-" + A2++, this.title = new c7(), this.description = new c4(), this.hidden = false, this.thumbnail = new u4(), this.viewpoint = null, this.basemap = null, this.ground = null, this.environment = new h(), this.timeExtent = null, this.visibleLayers = new P2();
  }
  destroy() {
    this.visibleLayers.removeAll(), this.basemap = null, this.thumbnail = u(this.thumbnail), this.description = null, this.title = null, this.thumbnail = null;
  }
  castTitle(e5) {
    return "string" == typeof e5 ? new c7({
      text: e5
    }) : b2(c7, e5);
  }
  castDescription(e5) {
    return "string" == typeof e5 ? new c4({
      text: e5
    }) : b2(c4, e5);
  }
  castThumbnail(e5) {
    return "string" == typeof e5 ? new u4({
      url: e5
    }) : b2(u4, e5);
  }
  castBasemap(e5) {
    return b3(e5);
  }
  set visibleLayers(e5) {
    this._set("visibleLayers", n4(e5, this._get("visibleLayers"), P2));
  }
  castVisibleLayers(e5) {
    return e5 && "function" == typeof e5.map ? e5.map((e6) => {
      if ("string" == typeof e6) return {
        id: e6
      };
      if (e6 instanceof f4) {
        const t4 = O(e6);
        return {
          id: e6.id,
          sublayerIds: t4
        };
      }
      return e6.id ? {
        id: e6.id,
        sublayerIds: "sublayerIds" in e6 ? e6.sublayerIds : void 0
      } : (n.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'), e6);
    }) : null;
  }
  clone() {
    return new (0, this.constructor)({
      id: this.id,
      title: this.title.clone(),
      thumbnail: this.thumbnail.clone(),
      description: this.description && this.description.clone() || null,
      viewpoint: this.viewpoint && this.viewpoint.clone() || null,
      basemap: this.basemap?.clone() || null,
      ground: this.ground?.clone() || null,
      visibleLayers: this.visibleLayers.clone(),
      environment: this.environment && this.environment.clone() || null,
      hidden: this.hidden,
      timeExtent: this.timeExtent?.clone() ?? null
    });
  }
  _updateVisibleLayersFrom(e5) {
    return __async(this, null, function* () {
      const t4 = [];
      yield Promise.allSettled(this._getLayers(e5.map).map((i12) => e5.whenLayerView(i12).then((e6) => {
        if (e6.visible) {
          const n14 = O(i12);
          t4.push(new c6({
            id: e6.layer.id,
            sublayerIds: n14
          }));
        }
      })).toArray()), this.visibleLayers.removeAll(), this.visibleLayers.addMany(t4);
    });
  }
  updateFrom(e5, t4) {
    const i12 = __spreadValues({
      format: "png",
      quality: 80,
      width: 120,
      height: 75,
      disableDecorations: true
    }, t4?.screenshot);
    return e5.when(() => (this.viewpoint = e5.viewpoint.clone(), this.environment.lighting = "virtual" === e5.environment.lighting.type ? i4.prototype.clone.apply(e5.environment.lighting) : p4.prototype.clone.apply(e5.environment.lighting), this.environment.weather = e5.environment.weather.clone(), this.basemap = e5.map.basemap && e5.map.basemap.clone() || null, this.ground = e5.map.ground ? u5.fromGround(e5.map.ground) : null, this.timeExtent = e5.timeExtent?.clone() ?? null, this._updateVisibleLayersFrom(e5))).then(() => e5.takeScreenshot(i12)).then((e6) => (this.thumbnail = new u4({
      url: e6.dataUrl
    }), this));
  }
  applyTo(e5, t4) {
    return __async(this, null, function* () {
      null != this._applyToController && this._applyToController.abort();
      let i12 = new AbortController();
      this._applyToController = i12;
      const r7 = w(t4, () => i12?.abort()), o4 = () => {
        this._applyToController === i12 && (this._applyToController = null), i12 = null, r7?.remove();
      };
      try {
        yield w2(() => e5.ready, i12.signal);
      } catch (d4) {
        throw o4(), d4;
      }
      if (i12.signal.aborted) throw o4(), u2();
      const s7 = e5.resourceController.scheduler.registerTask(I2.SLIDE);
      let a3 = false;
      const l5 = __spreadProps(__spreadValues({
        animate: true
      }, t4), {
        signal: this._applyToController.signal
      }), p9 = () => __async(this, null, function* () {
        yield Promise.all([s7.schedule(() => __async(this, null, function* () {
          return a3 = yield this._setViewpointOfInterest(e5, l5);
        })), s7.schedule(() => this._applyBasemap(e5, l5), l5.signal)]), yield this._loadLayersWithSublayerVisibility(e5), yield Promise.all([s7.schedule(() => this._applyLayerVisibility(e5), l5.signal), s7.schedule(() => this._applyGround(e5), l5.signal), s7.schedule(() => this._applyViewpoint(e5, l5), l5.signal), s7.schedule(() => e5.timeExtent = this.timeExtent?.clone() ?? null, l5.signal)]), yield s7.schedule(() => e5.environment.weather = this.environment.weather.clone());
      }), m6 = yield _(e5.addUpdatingPromise(p9()));
      if (a3 && (e5.contentCamera = null), s7.remove(), o4(), false === m6.ok) throw m6.error;
      return this;
    });
  }
  _applyBasemap(e5, t4) {
    return __async(this, null, function* () {
      if (this.basemap) {
        try {
          yield this.basemap.load(t4);
        } catch (i12) {
          if (b(i12)) throw i12;
        }
        e5.map.basemap = v3(this.basemap, e5.map.basemap);
      }
    });
  }
  _applyGround(e5) {
    this.ground && (e5.map.ground = this.ground.cloneAndApplyTo(e5.map.ground));
  }
  _getLayers(e5) {
    const t4 = new V();
    return this._collectLayers(e5, t4), this._collectLayers(e5.ground, t4), t4;
  }
  _collectLayers(e5, t4) {
    e5.layers.forEach((e6) => {
      e6.persistenceEnabled && (t4.add(e6), "layers" in e6 && this._collectLayers(e6, t4));
    });
  }
  _loadLayersWithSublayerVisibility(e5) {
    return __async(this, null, function* () {
      this.visibleLayers && (yield Promise.allSettled(this._getLayers(e5.map).items.map((e6) => {
        const t4 = this.visibleLayers.find((t5) => t5.id === e6.id)?.sublayerIds;
        return t4 ? e6.load() : null;
      })));
    });
  }
  _applyLayerVisibility(e5) {
    if (!this.visibleLayers) return;
    this._getLayers(e5.map).forEach((e6) => {
      const t4 = this.visibleLayers.find((t5) => t5.id === e6.id);
      e6.visible = null != t4;
      const i12 = t4?.sublayerIds, n14 = M(e6);
      i12 && n14 && n14.forEach((e7) => e7.visible = i12.includes(e7.id));
    });
  }
  _setViewpointOfInterest(e5, t4) {
    return __async(this, null, function* () {
      if (e5.state.fixedContentCamera || !this.viewpoint || t4?.ignoreViewpoint || !t4?.useDestinationCamera) return false;
      const {
        toCameraAsync: i12
      } = yield import("./viewpointUtils-3HCIVHRY.js"), n14 = yield i12(e5, this.viewpoint);
      return e5.contentCamera = n14, null != n14;
    });
  }
  _applyViewpoint(e5, t4) {
    return __async(this, null, function* () {
      if (this._applyCachedCameraTrackingEnabled(e5), this.viewpoint && !t4.ignoreViewpoint) {
        null != this.viewpoint.camera && (this.viewpoint.camera.fov = e5.camera.fov);
        const i12 = this.environment.lighting;
        if (t4.animate && "sun" === i12.type && i12.date) return this._animateToLighting(e5, t4);
        t4.animate && (e5.environment.applyLighting(i12.clone()), yield e5.goTo(this.viewpoint, t4)), e5.viewpoint = this.viewpoint;
      }
      e5.environment.applyLighting(this.environment.lighting.clone());
    });
  }
  _animateToLighting(e5, t4) {
    return __async(this, null, function* () {
      let i12 = null;
      "virtual" !== e5.environment.lighting.type && "virtual" !== this.environment.lighting.type && ("global" === e5.viewingMode && (i12 = this._animateLightingWithCamera(e5, e5.environment.lighting, this.environment.lighting)), e5.environment.cachedCameraTrackingEnabled = e5.environment.lighting.cameraTrackingEnabled, e5.environment.lighting.cameraTrackingEnabled = false), e5.environment.lighting.directShadowsEnabled = this.environment.lighting.directShadowsEnabled, "virtual" === this.environment.lighting.type || "virtual" === e5.environment.lighting.type ? (e5.environment.applyLighting(this.environment.lighting.clone()), "virtual" !== e5.environment.lighting.type && (e5.environment.cachedCameraTrackingEnabled = e5.environment.lighting.cameraTrackingEnabled, e5.environment.lighting.cameraTrackingEnabled = false)) : null != this.environment.lighting.displayUTCOffset && (e5.environment.lighting.displayUTCOffset = this.environment.lighting.displayUTCOffset);
      return e5.goTo(this.viewpoint, t4).then(() => {
        this._applyCachedCameraTrackingEnabled(e5), e5.environment.applyLighting(this.environment.lighting.clone());
      }).catch((t5) => {
        throw null == e5.animation && this._applyCachedCameraTrackingEnabled(e5), t5;
      }).finally(() => {
        l(i12);
      });
    });
  }
  _applyCachedCameraTrackingEnabled(e5) {
    null != e5.environment.cachedCameraTrackingEnabled && (e5.environment.lighting.cameraTrackingEnabled = e5.environment.cachedCameraTrackingEnabled, e5.environment.cachedCameraTrackingEnabled = null);
  }
  _getTime(e5) {
    return [e5.getTime(), 3600 * e5.getUTCHours() + 60 * e5.getUTCMinutes() + e5.getUTCSeconds()];
  }
  _setTime(e5, t4, i12) {
    return e5.setTime(t4), e5.setUTCHours(i12 / 3600), e5.setUTCMinutes(i12 % 3600 / 60), e5.setUTCSeconds(i12 % 3600 % 60), e5;
  }
  _animateLightingWithCamera(e5, t4, i12) {
    const n14 = new Date(t4.date.toString()), [r7, o4] = this._getTime(n14), [s7, a3] = this._getTime(i12.date), l5 = W(o4, a3), p9 = e5.renderCoordsHelper, m6 = n3();
    p9.toRenderCoords(e5.camera.position, m6);
    const c8 = n3(), h2 = n3();
    null != this.viewpoint.camera && p9.toRenderCoords(this.viewpoint.camera.position, c8);
    const d4 = /* @__PURE__ */ new Date();
    return p(() => e5.camera, (e6) => {
      p9.toRenderCoords(e6.position, h2);
      const i13 = p2(m6, h2), n15 = p2(c8, h2);
      let a4 = 0;
      i13 + n15 !== 0 && (a4 = i13 / (i13 + n15));
      const u7 = r7 + (s7 - r7) * a4, y3 = H(o4, l5 * a4);
      t4.date = this._setTime(d4, u7, y3);
    });
  }
  static createFrom(e5, t4) {
    return new this().updateFrom(e5, t4);
  }
};
e([y({
  type: String,
  json: {
    write: {
      isRequired: true
    }
  }
})], q.prototype, "id", void 0), e([y({
  type: c7,
  json: {
    default: () => new c7({
      text: ""
    }),
    write: {
      isRequired: true
    }
  }
})], q.prototype, "title", void 0), e([s2("title")], q.prototype, "castTitle", null), e([y({
  type: c4,
  json: {
    write: {
      overridePolicy: (e5) => ({
        enabled: !(!e5 || !e5.text)
      })
    }
  }
})], q.prototype, "description", void 0), e([s2("description")], q.prototype, "castDescription", null), e([y({
  type: Boolean,
  nonNullable: true,
  json: {
    write: true,
    default: false
  }
})], q.prototype, "hidden", void 0), e([y({
  type: u4,
  json: {
    default: () => new u4({
      url: ""
    }),
    write: {
      isRequired: true
    }
  }
})], q.prototype, "thumbnail", void 0), e([s2("thumbnail")], q.prototype, "castThumbnail", null), e([y({
  type: m3,
  nonNullable: true,
  json: {
    write: {
      isRequired: true
    }
  }
})], q.prototype, "viewpoint", void 0), e([y({
  type: F,
  json: {
    read: {
      source: "baseMap"
    },
    write: {
      target: "baseMap"
    }
  }
})], q.prototype, "basemap", void 0), e([s2("basemap")], q.prototype, "castBasemap", null), e([y({
  type: u5,
  json: {
    write: true
  }
})], q.prototype, "ground", void 0), e([y({
  type: P2,
  json: {
    write: {
      isRequired: true
    }
  }
})], q.prototype, "visibleLayers", null), e([s2("visibleLayers")], q.prototype, "castVisibleLayers", null), e([y({
  type: h,
  json: {
    write: true
  }
})], q.prototype, "environment", void 0), e([y(s3)], q.prototype, "timeExtent", void 0), q = e([a2("esri.webscene.Slide")], q);
var B = q;
function M(e5) {
  if ("building-scene" === e5.type || "map-image" === e5.type) return e5.allSublayers.toArray();
}
function O(e5) {
  const t4 = M(e5);
  if (t4) return t4.filter((e6) => e6.visible).map((e6) => e6.id);
}
var F2 = 86400;
var G = 43200;
function W(e5, t4) {
  let i12 = t4 - e5;
  return i12 > G && (i12 -= F2), i12 < -G && (i12 += F2), i12;
}
function H(e5, t4) {
  return d2(e5 + t4, F2);
}

// ../../../node_modules/@arcgis/core/webscene/Presentation.js
var n12 = V.ofType(B);
var m5 = class extends f {
  constructor(s7) {
    super(s7), this.slides = new n12();
  }
  destroy() {
    this.slides.forEach((s7) => s7.destroy()), this.slides.removeAll();
  }
  set slides(s7) {
    s7 && (s7 = s7.filter((s8) => !!s8.viewpoint)), this._set("slides", n4(s7, this._get("slides"), n12));
  }
  clone() {
    return new (0, this.constructor)({
      slides: this.slides.clone()
    });
  }
};
e([y({
  type: n12,
  nonNullable: true,
  json: {
    write: true
  }
}), s2(t)], m5.prototype, "slides", null), m5 = e([a2("esri.webscene.Presentation")], m5);
var d3 = m5;

// ../../../node_modules/@arcgis/core/webscene/TransportationNetwork.js
var s6;
var p8 = s6 = class extends f {
  constructor(t4) {
    super(t4);
  }
  clone() {
    return new s6({
      name: this.name,
      path: this.path,
      title: this.title
    });
  }
};
e([y({
  type: String,
  json: {
    write: true
  }
})], p8.prototype, "name", void 0), e([y({
  type: String,
  json: {
    write: true
  }
})], p8.prototype, "path", void 0), e([y({
  type: String,
  json: {
    write: true
  }
})], p8.prototype, "title", void 0), p8 = s6 = e([a2("esri.webscene.TransportationNetwork")], p8);
var i11 = p8;

// ../../../node_modules/@arcgis/core/webscene/Version.js
var e4 = class extends r4 {
  constructor(s7, e5) {
    super(s7, e5, "webscene");
  }
  get supportsGround() {
    return this.since(1, 8);
  }
  get supportsVisibleElevationLayersInSlides() {
    return this.lessThan(1, 8);
  }
};

// ../../../node_modules/@arcgis/core/webscene/support/schemaValidatorLoader.js
var n13 = null;
function u6() {
  return n13;
}

// ../../../node_modules/@arcgis/core/WebScene.js
var oe;
var se = new e4(1, 34);
var ae = () => {
  const e5 = 8, t4 = [], r7 = se.major;
  for (let i12 = e5; i12 <= se.minor; i12++) t4.push(`${r7}.${i12}`);
  return t4;
};
var ne = "Web Scene";
var le = class extends m.LoadableMixin(n2(S2(L))) {
  constructor(e5) {
    super(e5), this[oe] = true, this._layersIdGCTimeoutId = void 0, this._updateFromPromise = null, this.applicationProperties = null, this.clippingArea = null, this.clippingEnabled = false, this.floorInfo = null, this.heightModelInfo = void 0, this.sourceVersion = null, this.transportationNetworks = null, this.presentation = new d3(), this.initialViewProperties = new m4(), this.portalItem = null, this.resourceInfo = null, this.widgets = null, this._debouncedSaveOperations = k((e6, t4, r7) => __async(this, null, function* () {
      switch (e6) {
        case A.SAVE:
          return this._saveImpl(t4);
        case A.SAVE_AS:
          return this._saveAsImpl(r7, t4);
      }
    })), this._resourceReferences = {
      portalItem: null,
      paths: []
    }, this.authoringApp = null, this.authoringAppVersion = null, this._isAuthoringAppSetByUser = false, this._isAuthoringAppVersionSetByUser = false;
  }
  initialize() {
    if (this.when().catch((e5) => {
      n.getLogger(this).error("#load()", "Failed to load web scene", e5);
    }), this.resourceInfo) {
      let t4;
      try {
        t4 = this._validateJSON(this.resourceInfo);
      } catch (e5) {
        return void this.addResolvingPromise(Promise.reject(e5));
      }
      this.read(t4), this.addResolvingPromise(this._validateSpatialReference()), this.addResolvingPromise(this._validateHeightModelInfo());
    }
    this.addHandles(v(() => this.allLayers, "change", () => this._scheduleLayersIdGC()));
  }
  destroy() {
    this._unscheduleLayersIdGC(), this.presentation && this.presentation.destroy(), this.portalItem = u(this.portalItem);
  }
  writeClippingArea(e5, t4) {
    t4.clippingArea || (t4.clippingArea = {}), t4.clippingArea.geometry = e5.toJSON();
  }
  readClippingEnabled(e5, t4) {
    return !!t4.clippingArea && !!t4.clippingArea.clip;
  }
  writeClippingEnabled(e5, t4) {
    this.clippingArea && (t4.clippingArea || (t4.clippingArea = {}), t4.clippingArea.clip = e5);
  }
  writeLayers(e5, t4, r7, i12) {
    t4[r7] = this._layersToJSON(e5, "operational-layers", i12);
  }
  readSourceVersion(e5, t4) {
    const [r7, i12] = t4.version.split(".");
    return new e4(parseInt(r7, 10), parseInt(i12, 10));
  }
  writeSourceVersion(e5, t4, r7) {
    t4[r7] = `${se.major}.${se.minor}`;
  }
  writeTables(e5, t4, r7, i12) {
    const o4 = this._layersToJSON(e5, "tables", i12);
    o4.length && (t4[r7] = o4);
  }
  get thumbnailUrl() {
    return this.portalItem?.thumbnailUrl ?? null;
  }
  set thumbnailUrl(e5) {
    e5 ? this._override("thumbnailUrl", e5) : (this._clearOverride("thumbnailUrl"), this.clear("thumbnailUrl", "user"));
  }
  set authoringApp(e5) {
    this._isAuthoringAppSetByUser = true, this._set("authoringApp", e5);
  }
  writeAuthoringApp(e5, t4) {
    e5 && this._isAuthoringAppSetByUser ? t4.authoringApp = e5 : t4.authoringApp = "ArcGIS API for JavaScript";
  }
  set authoringAppVersion(e5) {
    this._isAuthoringAppVersionSetByUser = true, this._set("authoringAppVersion", e5);
  }
  writeAuthoringAppVersion(e5, r7) {
    e5 && this._isAuthoringAppVersionSetByUser ? r7.authoringAppVersion = e5 : r7.authoringAppVersion = r2;
  }
  writeGround(e5, t4, r7, i12) {
    t4[r7] = e5 ? e5.write({}, i12) : {
      transparency: 0,
      layers: []
    };
  }
  readInitialViewProperties(e5, t4) {
    const r7 = {};
    t4.initialState?.environment && (r7.environment = b5.fromJSON(t4.initialState.environment)), r7.spatialReference = t4.spatialReference ? f2.fromJSON(t4.spatialReference) : f2.WebMercator, r7.viewingMode = t4.viewingMode ?? "global", t4.initialState?.viewpoint && (r7.viewpoint = m3.fromJSON(t4.initialState.viewpoint));
    const s7 = t4.initialState?.timeExtent;
    return null != s7 && (r7.timeExtent = c.fromArray(s7)), new m4(r7);
  }
  get spatialReference() {
    return this.initialViewProperties?.spatialReference ?? f2.WebMercator;
  }
  get viewingMode() {
    return this.initialViewProperties?.viewingMode ?? "global";
  }
  load(e5) {
    const t4 = this.ground;
    return this.addResolvingPromise(this._loadFromSource().then(() => {
      t4 && t4 !== this.ground && t4.destroy();
    })), Promise.resolve(this);
  }
  loadAll() {
    return t2(this, (e5) => {
      const t4 = this.presentation && this.presentation.slides;
      e5(this.ground, this.basemap, this.layers, t4 && t4.map((e6) => e6.basemap), this.tables);
    });
  }
  read(e5, t4) {
    t4 = __spreadProps(__spreadValues({}, t4), {
      origin: "web-scene"
    });
    const r7 = this._isAuthoringAppVersionSetByUser, i12 = this._isAuthoringAppSetByUser;
    if (d(this, e5, (t5) => super.read(e5, t5), t4), i12 || (this._isAuthoringAppSetByUser = false), r7 || (this._isAuthoringAppVersionSetByUser = false), e5.baseMap && Array.isArray(e5.baseMap.elevationLayers) && this.sourceVersion?.supportsVisibleElevationLayersInSlides) {
      const t5 = e5.baseMap.elevationLayers.map((e6) => ({
        id: e6.id
      })), r8 = this.presentation.slides, i13 = (e6, t6) => e6.visibleLayers.some((e7) => e7.id === t6), o4 = t5.filter((e6) => !r8.some((t6) => i13(t6, e6.id)));
      r8.forEach((e6) => {
        e6.visibleLayers.addMany(o4);
      });
    }
  }
  _writeBasemapElevationLayers(e5) {
    const t4 = e5.ground?.layers;
    !e5.baseMap && t4?.length && (e5.baseMap = {
      title: "Basemap",
      baseMapLayers: []
    }), e5.baseMap && (e5.baseMap.elevationLayers = a(t4));
  }
  _layersToJSON(e5, t4, r7) {
    const i12 = __spreadProps(__spreadValues({}, r7), {
      layerContainerType: t4
    });
    return e5.map((e6) => this._verifyWritableLayer(e6, r7) ? e6.write({}, i12) : null).filter((e6) => !!e6).toArray();
  }
  _verifyWritableLayer(e5, t4) {
    return !!e5.persistenceEnabled && ("write" in e5 || (t4?.messages && t4.messages.push(new s("layer:unsupported", `Layers (${e5.title}, ${e5.id}) of type '${e5.declaredClass}' cannot be persisted in web scenes`, {
      layer: e5
    })), false));
  }
  write(e5, t4) {
    if ("loaded" !== this.loadStatus) {
      const e6 = new s("webscene:not-loaded", "Web scene must be loaded before it can be serialized");
      throw n.getLogger(this).error("#toJSON()", "Web scene must be loaded before it can be serialized", this.loadError || this.loadStatus), e6;
    }
    this._runLayersIdGC();
    const r7 = !t4?.messages;
    t4 = __spreadProps(__spreadValues({
      messages: []
    }, t4), {
      origin: "web-scene"
    });
    const i12 = super.write(e5, t4);
    if (r7) {
      const e6 = t4.messages?.filter((e7) => "web-document-write:property-required" === e7.name) ?? [];
      if (e6.length) {
        const t5 = new s("web-document:property-required", "One or more properties that are required in the webscene JSON are missing, see details for the specific errors", {
          errors: e6
        });
        throw n.getLogger(this).error("#toJSON()", "One or more properties that are required in the webscene JSON are missing", e6), t5;
      }
    }
    return this._writeBasemapElevationLayers(i12), i12;
  }
  save(e5) {
    return __async(this, null, function* () {
      return this._debouncedSaveOperations(A.SAVE, e5);
    });
  }
  _saveImpl(e5) {
    return __async(this, null, function* () {
      if (!this.portalItem) throw new s("webscene:portal-item-not-set", "Portal item to save to has not been set on the WebScene");
      if (i2(this.portalItem), this.portalItem?.type !== ne) throw new s("webscene:portal-item-wrong-type", `Portal item needs to have type "${ne}"`);
      const t4 = this._updateFromPromise;
      yield this._ensureLoadBeforeSave();
      const r7 = this._enableVerifyItemRelativeUrls(o2(this.portalItem, "web-scene", true)), i12 = this.write({}, r7);
      return yield Promise.all(r7.resources.pendingOperations), yield this._verifySave(i12, r7, e5), this._updateTypeKeywords(this.portalItem), yield n6(this.portalItem, i12, this._resourceReferences, r7), i(r7), t4 && (yield t4), yield this._saveThumbnail(), this.portalItem;
    });
  }
  saveAs(e5, t4) {
    return __async(this, null, function* () {
      return this._debouncedSaveOperations(A.SAVE_AS, t4, e5);
    });
  }
  _saveAsImpl(e5, t4) {
    return __async(this, null, function* () {
      let r7 = S.from(e5);
      if (!r7) throw new s("webscene:portal-item-required", "saveAs requires a portal item to save to");
      i2(r7), r7.id && (r7 = r7.clone(), r7.id = null);
      const i12 = r7.portal || C.getDefault();
      yield this._ensureLoadBeforeSave(), r7.type = ne, r7.portal = i12;
      const o4 = this._enableVerifyItemRelativeUrls(o2(r7, "web-scene", true)), s7 = this.write({}, o4);
      yield Promise.all(o4.resources.pendingOperations), yield this._verifySaveAs(s7, o4, t4);
      const n14 = this.thumbnailUrl, l5 = !this._isOverridden("thumbnailUrl");
      if (this._updateTypeKeywords(r7), yield i12.signIn(), !i12.user) throw new s("webscene:user-not-signed-in", "saveAs requires a user to be signed in to the portal");
      return yield i12.user.addItem({
        item: r7,
        folder: t4?.folder,
        data: s7
      }), yield p3(this._resourceReferences, o4), this.portalItem = r7, m2.prototype.read.call(this, {
        version: s7.version,
        authoringApp: s7.authoringApp,
        authoringAppVersion: s7.authoringAppVersion
      }, {
        name: "web-scene",
        ignoreDefaults: true,
        url: r7.itemUrl ? I(r7.itemUrl) : void 0
      }), i(o4), n14 && (this.thumbnailUrl = l5 ? kt(n14, "w", "8192") : n14), o4.portalItem = r7, yield this._saveThumbnail(), r7;
    });
  }
  _saveThumbnail() {
    return __async(this, null, function* () {
      this._isOverridden("thumbnailUrl") && (yield this.portalItem?.updateThumbnail({
        thumbnail: this.thumbnailUrl
      }), this._clearOverride("thumbnailUrl"), this.clear("thumbnailUrl", "user"));
    });
  }
  _verifySave(e5, t4, r7, i12 = false) {
    return __async(this, null, function* () {
      if (!P(this.spatialReference)) throw new s("webscene:unsupported-spatial-reference", "Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");
      const {
        ignoreUnsupported: o4,
        requiredPropertyChecksDisabled: s7,
        strictSchemaValidationEnabled: n14
      } = r7 || {};
      t3(t4, {
        errorName: "webscene:save"
      }, {
        ignoreUnsupported: o4,
        supplementalUnsupportedErrors: ["scenemodification:unsupported"],
        requiredPropertyChecksDisabled: s7
      });
      const l5 = u6();
      if (n14 && l5) {
        const t5 = (yield l5()).validate(e5);
        if (!t5.length) return;
        const r8 = `webscene did not validate:
${t5.join("\n")}`;
        n.getLogger(this).error(`${i12 ? "saveAs" : "save"}(): ${r8}`);
        const o5 = t5.map((e6) => new s("webscene:schema-validation", e6));
        throw s4(o5);
      }
    });
  }
  _verifySaveAs(e5, t4, r7) {
    return this.canNotSaveAs(t4) ? Promise.reject(n10()) : this._verifySave(e5, t4, r7, true);
  }
  verifySaveAs(e5) {
    const t4 = this._enableVerifyItemRelativeUrls({
      origin: "web-scene",
      messages: []
    }), r7 = this.write({}, t4);
    return this._verifySaveAs(r7, t4, e5);
  }
  canNotSaveAs(e5) {
    return e5 || (e5 = this._enableVerifyItemRelativeUrls({
      origin: "web-scene",
      messages: []
    }), this.write({}, e5)), (e5.verifyItemRelativeUrls?.writtenUrls?.length ?? 0) > 0;
  }
  updateFrom(_0) {
    return __async(this, arguments, function* (e5, t4 = {}) {
      const r7 = this._updateFrom(e5, t4);
      this._updateFromPromise = r7, yield r7;
      this._updateFromPromise === r7 && (this._updateFromPromise = null);
    });
  }
  _updateFrom(_0) {
    return __async(this, arguments, function* (e5, t4 = {}) {
      if (yield e5.whenReady(), !t4.environmentExcluded && e5.environment && (this.initialViewProperties.environment = b5.prototype.clone.apply(e5.environment)), !t4.viewpointExcluded && e5.viewpoint && (this.initialViewProperties.viewpoint = e5.viewpoint.clone()), this.initialViewProperties.spatialReference = e5.spatialReference.clone(), this.initialViewProperties.viewingMode = e5.viewingMode, this.initialViewProperties.timeExtent = e5.timeExtent?.clone() ?? null, null != e5.clippingArea ? e5.clippingArea !== this.clippingArea && (this.clippingArea = e5.clippingArea.clone(), this.clippingEnabled = true) : this.clippingEnabled = false, e5.heightModelInfo && (this.heightModelInfo = e5.heightModelInfo.clone()), e5.map === this) for (const r7 of e5.allLayerViews) {
        const e6 = "visible";
        e6 in r7 && e6 in r7.layer && r7._isOverridden(e6) && (r7.layer[e6] = r7[e6]);
      }
      if (!t4.widgetsExcluded) for (const r7 of e5.persistableViewModels) r7.updateWebDocument(this);
      (false === t4.thumbnailExcluded || null == t4.thumbnailExcluded && !t4.viewpointExcluded) && (yield this._updateFromThumbnail(e5, t4.thumbnailSize ?? void 0));
    });
  }
  _updateFromThumbnail(e5, t4) {
    return __async(this, null, function* () {
      const r7 = i6(e5, t4), i12 = yield e5.takeScreenshot({
        format: "jpg",
        width: r7.width,
        height: r7.height,
        disableDecorations: true
      });
      this.thumbnailUrl = i12.dataUrl;
    });
  }
  _loadFromSource() {
    return this.resourceInfo ? this._loadFromJSON(this.resourceInfo, {
      origin: "web-scene"
    }) : this.portalItem?.id ? this._loadFromItem(this.portalItem) : this._loadObjectsWithLayers();
  }
  _readAndLoadFromJSON(e5, t4) {
    const r7 = this._validateJSON(e5);
    return this.read(r7, t4), this._loadFromJSON(r7, t4);
  }
  _extractOperationalLayers(e5) {
    const t4 = [];
    if (!this.sourceVersion?.supportsGround && e5.baseMap && Array.isArray(e5.baseMap.elevationLayers)) for (const o4 of e5.baseMap.elevationLayers) t4.push(o4);
    const r7 = [], i12 = (e6) => (e6.layers && (e6.layers = e6.layers.filter(i12)), "ArcGISTiledElevationServiceLayer" !== e6.layerType || (this.sourceVersion?.supportsGround || r7.push(e6), false));
    return {
      operationalLayers: e5.operationalLayers ? e5.operationalLayers.filter(i12) : [],
      operationalElevationLayers: r7,
      basemapElevationLayers: t4
    };
  }
  _loadFromJSON(e5, t4) {
    return __async(this, null, function* () {
      const r7 = new V();
      yield this._validateSpatialReference(), yield this._validateHeightModelInfo();
      const {
        populateOperationalLayers: i12
      } = yield import("./layersCreator-OMBY2VPO.js"), {
        operationalLayers: o4,
        operationalElevationLayers: a3,
        basemapElevationLayers: n14
      } = this._extractOperationalLayers(e5), l5 = [], p9 = {
        context: __spreadProps(__spreadValues({}, t4), {
          layerContainerType: "operational-layers"
        })
      };
      if (this.portalItem && (p9.context.portal = this.portalItem.portal || C.getDefault()), n14.length > 0) {
        const e6 = __spreadProps(__spreadValues({}, p9), {
          context: __spreadProps(__spreadValues({}, p9.context), {
            layerContainerType: "ground"
          })
        });
        e6.defaultLayerType = "ArcGISTiledElevationServiceLayer", l5.push(i12(this.ground.layers, n14, e6));
      }
      if (a3.length > 0) {
        const e6 = __spreadProps(__spreadValues({}, p9), {
          context: __spreadProps(__spreadValues({}, p9.context), {
            layerContainerType: "ground"
          })
        });
        e6.defaultLayerType = "ArcGISTiledElevationServiceLayer", l5.push(i12(r7, a3, e6));
      }
      o4 && o4.length > 0 && l5.push(i12(this.layers, o4, p9)), e5.tables?.length && l5.push(i12(this.tables, e5.tables, __spreadProps(__spreadValues({}, p9), {
        context: __spreadProps(__spreadValues({}, p9.context), {
          layerContainerType: "tables"
        }),
        defaultLayerType: "ArcGISFeatureLayer"
      }))), yield Promise.allSettled(l5), yield this._loadObjectsWithLayers(), this.ground.layers.addMany(r7.filter((e6) => "base-elevation" === e6.type || "elevation" === e6.type));
    });
  }
  _ensureLoadBeforeSave() {
    return __async(this, null, function* () {
      yield this.load(), yield this._loadObjectsWithLayers();
      const e5 = [], t4 = [...this.allLayers.items];
      for (const {
        basemap: r7
      } of this.presentation.slides.items) r7 && (t4.push(...r7.baseLayers.items), t4.push(...r7.referenceLayers.items));
      for (const r7 of t4) if ("beforeSave" in r7 && "function" == typeof r7.beforeSave) {
        const t5 = r7.beforeSave();
        t5 && e5.push(t5);
      }
      yield Promise.allSettled(e5);
    });
  }
  _loadObjectsWithLayers() {
    return __async(this, null, function* () {
      const e5 = [];
      this.ground && e5.push(this.ground.load()), this.basemap && e5.push(this.basemap.load()), this.presentation.slides.forEach((t4) => {
        t4.basemap && e5.push(t4.basemap.load());
      }), yield Promise.allSettled(e5);
    });
  }
  _loadFromItem(e5) {
    return __async(this, null, function* () {
      if (yield e5.load().catch((e6) => {
        throw new s("webscene:load-portal-item", "Failed to load portal item", {
          error: e6
        });
      }), "Web Scene" !== e5.type) throw new s("webscene:invalid-portal-item", "Invalid portal item type '${type}', expected 'Web Scene'", {
        type: e5.type
      });
      const t4 = yield e5.fetchData();
      this.resourceInfo = t4;
      const r7 = {
        origin: "web-scene",
        url: I(e5.itemUrl),
        portal: e5.portal || C.getDefault(),
        portalItem: e5,
        readResourcePaths: []
      };
      yield this._readAndLoadFromJSON(t4, r7), this._resourceReferences = {
        portalItem: e5,
        paths: r7.readResourcePaths ?? []
      };
    });
  }
  _validateSpatialReference() {
    const e5 = this.initialViewProperties, t4 = this._sceneSpatialReference;
    let r7;
    if ("local" !== e5.viewingMode) {
      if (!r5(t4, l2.Global)) return Promise.reject(new s("webscene:unsupported-spatial-reference", "Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported", {
        spatialReference: t4,
        viewingMode: e5.viewingMode
      }));
      r7 = (e6) => !e6 || J(e6, t4);
    } else {
      if (!r5(t4, l2.Local)) return Promise.reject(new s("webscene:unsupported-spatial-reference", "Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported", {
        spatialReference: t4,
        viewingMode: e5.viewingMode
      }));
      r7 = (e6) => !e6 || e6.equals(t4);
    }
    const i12 = (e6) => e6?.camera?.position.spatialReference ?? e6?.targetGeometry?.spatialReference, o4 = e5.viewpoint, s7 = i12(o4);
    if (s7 && !r7(s7)) return Promise.reject(new s("webscene:incompatible-camera-spatial-reference", "Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})", {
      cameraSpatialReference: s7,
      sceneSpatialReference: t4,
      viewingMode: e5.viewingMode
    }));
    const n14 = this.presentation.slides.find((e6) => !r7(i12(e6.viewpoint)));
    if (n14) {
      const r8 = i12(n14.viewpoint);
      return Promise.reject(new s("webscene:incompatible-slide-spatial-reference", "Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})", {
        slideSpatialReference: r8,
        sceneSpatialReference: t4,
        viewingMode: e5.viewingMode
      }));
    }
    return Promise.resolve();
  }
  _validateHeightModelInfo() {
    const e5 = this._sceneSpatialReference, t4 = i3(this.heightModelInfo, e5);
    return t4 ? Promise.reject(t4) : Promise.resolve();
  }
  _validateJSON(e5) {
    const t4 = e4.parse(e5.version || "", "webscene");
    return se.validate(t4), e5.version = `${t4.major}.${t4.minor}`, 1 === t4.major && t4.minor <= 2 && (e5.spatialReference = f2.WebMercator.toJSON()), e5;
  }
  _updateTypeKeywords(e5) {
    u3(e5, f3.LOCAL_SCENE, "local" === this.initialViewProperties.viewingMode), u3(e5, f3.DEVELOPER_BASEMAP, w4(this.basemap) || this.presentation.slides.some(({
      basemap: e6
    }) => !!e6 && w4(e6))), e5.typeKeywords && (e5.typeKeywords = e5.typeKeywords.filter((e6, t4, r7) => r7.indexOf(e6) === t4));
  }
  get _sceneSpatialReference() {
    return this.initialViewProperties.spatialReference || f2.WebMercator;
  }
  get _verifyItemRelativeRootPath() {
    return this.portalItem?.itemUrl ? I(this.portalItem.itemUrl).path : null;
  }
  _enableVerifyItemRelativeUrls(e5) {
    const t4 = this._verifyItemRelativeRootPath;
    return t4 && (e5.verifyItemRelativeUrls = {
      rootPath: t4,
      writtenUrls: []
    }), e5;
  }
  _unscheduleLayersIdGC() {
    this._layersIdGCTimeoutId && (clearTimeout(this._layersIdGCTimeoutId), this._layersIdGCTimeoutId = 0);
  }
  _scheduleLayersIdGC() {
    this._unscheduleLayersIdGC(), this._layersIdGCTimeoutId = setTimeout(() => {
      this._layersIdGCTimeoutId = 0, this._runLayersIdGC();
    }, 3e3);
  }
  _runLayersIdGC() {
    this._unscheduleLayersIdGC();
    const e5 = this.applicationProperties?.viewing?.search, t4 = (e6) => this.allLayers.some((t5) => t5.id === e6 && t5.persistenceEnabled);
    e5?.layers && (e5.layers = e5.layers.filter((e6) => t4(e6.id)));
    const r7 = this.presentation && this.presentation.slides;
    r7 && r7.forEach((e6) => {
      e6.visibleLayers && (e6.visibleLayers = e6.visibleLayers.filter((e7) => t4(e7.id)));
    });
  }
  static fromJSON(e5) {
    if (!e5) throw new s("webscene:empty-resource", "Expected a JSON resource but got nothing");
    return new this({
      resourceInfo: e5
    });
  }
};
oe = e2, le.version = `${se.major}.${se.minor}`, e([y({
  type: c2,
  json: {
    write: true
  }
})], le.prototype, "applicationProperties", void 0), e([y({
  type: w3,
  json: {
    read: {
      source: "clippingArea.geometry",
      reader: y2
    },
    write: {
      target: "clippingArea.geometry"
    }
  }
})], le.prototype, "clippingArea", void 0), e([r("clippingArea")], le.prototype, "writeClippingArea", null), e([y({
  type: Boolean,
  json: {
    write: {
      target: "clippingArea.clip"
    }
  }
})], le.prototype, "clippingEnabled", void 0), e([o("clippingEnabled", ["clippingArea"])], le.prototype, "readClippingEnabled", null), e([r("clippingEnabled")], le.prototype, "writeClippingEnabled", null), e([y({
  type: l3,
  json: {
    read: {
      source: "mapFloorInfo"
    },
    write: {
      target: "mapFloorInfo"
    }
  }
})], le.prototype, "floorInfo", void 0), e([y({
  type: v2,
  json: {
    write: true
  }
})], le.prototype, "heightModelInfo", void 0), e([y({
  json: {
    write: {
      target: "operationalLayers",
      ignoreOrigin: true
    }
  }
})], le.prototype, "layers", void 0), e([r("layers")], le.prototype, "writeLayers", null), e([y({
  readOnly: true,
  type: e4,
  json: {
    type: ae(),
    write: {
      ignoreOrigin: true,
      target: "version",
      isRequired: true,
      overridePolicy: () => ({
        enabled: true,
        allowNull: true,
        ignoreOrigin: true
      })
    }
  }
})], le.prototype, "sourceVersion", void 0), e([o("sourceVersion", ["version"])], le.prototype, "readSourceVersion", null), e([r("sourceVersion")], le.prototype, "writeSourceVersion", null), e([y({
  json: {
    read: false,
    write: {
      enabled: true,
      ignoreOrigin: true
    }
  }
})], le.prototype, "tables", void 0), e([r("tables")], le.prototype, "writeTables", null), e([y()], le.prototype, "thumbnailUrl", null), e([y({
  type: String,
  json: {
    write: {
      writerEnsuresNonNull: true,
      ignoreOrigin: true
    }
  }
})], le.prototype, "authoringApp", null), e([r("authoringApp")], le.prototype, "writeAuthoringApp", null), e([y({
  type: String,
  json: {
    write: {
      writerEnsuresNonNull: true,
      ignoreOrigin: true
    }
  }
})], le.prototype, "authoringAppVersion", null), e([r("authoringAppVersion")], le.prototype, "writeAuthoringAppVersion", null), e([y({
  json: {
    write: {
      isRequired: true,
      allowNull: true,
      ignoreOrigin: true,
      enabled: true
    }
  }
})], le.prototype, "ground", void 0), e([r("ground")], le.prototype, "writeGround", null), e([y({
  type: V.ofType(i11),
  json: {
    write: true
  }
})], le.prototype, "transportationNetworks", void 0), e([y({
  type: d3,
  nonNullable: true,
  json: {
    write: {
      ignoreOrigin: true,
      writer: (e5, t4, r7, i12) => {
        if (e5.slides && e5.slides.length > 0) {
          const r8 = __spreadProps(__spreadValues({}, i12), {
            isPresentation: true
          });
          t4.presentation = e5.write({}, r8);
        }
      }
    }
  }
})], le.prototype, "presentation", void 0), e([y({
  type: m4,
  nonNullable: true,
  json: {
    write: {
      target: "initialState",
      isRequired: true,
      ignoreOrigin: true
    },
    default: () => new m4({
      viewingMode: "global",
      spatialReference: f2.WebMercator
    })
  }
})], le.prototype, "initialViewProperties", void 0), e([o("initialViewProperties", ["initialState.timeExtent", "initialState.environment", "initialState.viewpoint", "spatialReference", "viewingMode"])], le.prototype, "readInitialViewProperties", null), e([y({
  type: f2,
  json: {
    read: false,
    write: {
      isRequired: true,
      ignoreOrigin: true
    }
  }
})], le.prototype, "spatialReference", null), e([y({
  type: ["local", "global"],
  json: {
    read: false,
    write: {
      isRequired: true,
      ignoreOrigin: true
    }
  }
})], le.prototype, "viewingMode", null), e([y({
  type: S
})], le.prototype, "portalItem", void 0), e([y()], le.prototype, "resourceInfo", void 0), e([y({
  type: n9,
  json: {
    write: true
  }
})], le.prototype, "widgets", void 0), le = e([a2("esri.WebScene")], le);
var pe = le;
export {
  pe as default
};
//# sourceMappingURL=WebScene-KRX6D6QL.js.map
