{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/views/3d/interactive/editingTools/dragEventPipeline3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport \"../../../../geometry.js\";\nimport { screenPointObjectToArray as e, castScreenPointArray as n, createScreenPointArray as r } from \"../../../../core/screenUtils.js\";\nimport { l as t, c as o, b as l, f as s, m as c, j as a, g as i } from \"../../../../chunks/vec32.js\";\nimport { create as u } from \"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";\nimport { projectPoint as p } from \"../../../../geometry/projection.js\";\nimport { intersectRay as m, create as d, getNormal as f, fromPositionAndNormal as g } from \"../../../../geometry/support/plane.js\";\nimport { create as E, closestPoints as y } from \"../../../../geometry/support/ray.js\";\nimport { projectPoint as S } from \"../../../../geometry/support/vector.js\";\nimport { sv2d as j } from \"../../../../geometry/support/vectorStacks.js\";\nimport { getZForElevationMode as R } from \"../../../../support/elevationInfoUtils.js\";\nimport { fromScreen as v } from \"../../support/geometryUtils/ray.js\";\nimport { newIntersector as x } from \"../../webgl-engine/lib/Intersector.js\";\nimport { StoreResults as b, IntersectorType as w } from \"../../webgl-engine/lib/IntersectorInterfaces.js\";\nimport { terrainId as I } from \"../../webgl-engine/lib/verticalOffsetUtils.js\";\nimport { EventPipeline as H } from \"../../../interactive/dragEventPipeline.js\";\nimport U from \"../../../../geometry/Point.js\";\nfunction O(e, n) {\n  return P(e, () => n);\n}\nfunction C(e) {\n  return P(e, e => e.plane);\n}\nfunction P(r, t) {\n  const o = u(),\n    l = u();\n  let s = !1;\n  return c => {\n    const a = t(c);\n    if (\"start\" === c.action) {\n      const t = e(c.screenStart, n(j.get())),\n        l = v(r.state.camera, t, K);\n      null != l && (s = m(a, l, o));\n    }\n    if (!s) return null;\n    const i = e(c.screenEnd, n(j.get())),\n      u = v(r.state.camera, i, K);\n    return null == u ? null : m(a, u, l) ? {\n      ...c,\n      renderStart: o,\n      renderEnd: l,\n      plane: a,\n      ray: u\n    } : null;\n  };\n}\nfunction T(e, n, t = 0, o = null, l = null) {\n  let s = null;\n  return c => {\n    if (\"start\" === c.action && (s = e.sceneIntersectionHelper.intersectElevationFromScreen(r(c.screenStart.x, c.screenStart.y), n, t, l), null != s && null != o && !p(s, s, o))) return null;\n    if (null == s) return null;\n    const a = e.sceneIntersectionHelper.intersectElevationFromScreen(r(c.screenEnd.x, c.screenEnd.y), n, t, l);\n    return null != a && (null == o || p(a, a, o)) ? {\n      ...c,\n      mapStart: s,\n      mapEnd: a\n    } : null;\n  };\n}\nfunction D(e, n, r, t = null, o = null) {\n  return T(e, r, R(n, e, r), t, o);\n}\nfunction M(e, n, r, t) {\n  const o = r.toMap(e.screenStart);\n  return null != o ? D(n, o, r.elevationInfo, t) : null;\n}\nfunction N(e, n) {\n  const r = B,\n    t = J,\n    o = d();\n  e.renderCoordsHelper.worldUpAtPosition(n, r);\n  const c = l(f(o), r, s(t, n, e.state.camera.eye));\n  return l(c, c, r), g(n, c, o);\n}\nfunction G(e, n, r) {\n  let t = null;\n  const o = new H();\n  return o.next(O(e, N(e, n))).next(h(e, n)).next(A(e, r)).next(e => {\n    e.mapEnd.x = e.mapStart.x, e.mapEnd.y = e.mapStart.y, t = e;\n  }), e => (t = null, o.execute(e), t);\n}\nfunction h(e, n) {\n  const r = u(),\n    l = t(n);\n  e.renderCoordsHelper.worldUpAtPosition(n, r);\n  const p = u(),\n    m = u(),\n    d = o => {\n      if (s(o, o, n), S(r, o, o), \"global\" === e.viewingMode) {\n        t(o) * Math.sign(c(r, o)) < .001 - l && s(o, a(o, r, .001), n);\n      }\n      return i(o, o, n), o;\n    };\n  return e => (e.renderStart = d(o(p, e.renderStart)), e.renderEnd = d(o(m, e.renderEnd)), e);\n}\nfunction k(r, t) {\n  const o = o => {\n    const l = e(o, n(j.get())),\n      s = v(r.state.camera, l, K);\n    return null == s ? null : y(t, s, B, J)[1];\n  };\n  return e => {\n    const n = o(e.screenStart);\n    if (null == n) return null;\n    const r = o(e.screenEnd);\n    return null == r ? null : {\n      ...e,\n      renderStart: n,\n      renderEnd: r\n    };\n  };\n}\nfunction A(e, n) {\n  const r = e.renderCoordsHelper;\n  return e => {\n    const t = r.fromRenderCoords(e.renderStart, new U({\n        spatialReference: n\n      })),\n      o = r.fromRenderCoords(e.renderEnd, new U({\n        spatialReference: n\n      }));\n    return null != t && null != o ? {\n      ...e,\n      mapStart: t,\n      mapEnd: o\n    } : null;\n  };\n}\nvar F;\nfunction q(e) {\n  let n = null;\n  return r => {\n    switch (r.action) {\n      case \"start\":\n        n = e.disableDisplay();\n        break;\n      case \"end\":\n      case \"cancel\":\n        null != n && (n.remove(), n = null);\n    }\n    return r;\n  };\n}\nfunction z(n, t = null) {\n  const o = x(n.state.viewingMode);\n  o.options.selectionMode = !0, o.options.store = b.MIN, o.options.hud = !1;\n  const l = r(),\n    s = {\n      requiresGroundFeedback: !0,\n      enableDraped: !0,\n      exclude: new Set()\n    },\n    c = u(),\n    a = t ?? n.spatialReference,\n    i = r => {\n      n.map.ground && n.map.ground.opacity < 1 ? s.exclude.add(I) : s.exclude.delete(I), n.sceneIntersectionHelper.intersectIntersectorScreen(e(r, l), o, s);\n      const t = o.results.min;\n      let i;\n      if (t.getIntersectionPoint(c)) i = t.intersector === w.TERRAIN ? F.GROUND : F.OTHER;else {\n        if (!o.results.ground.getIntersectionPoint(c)) return null;\n        i = F.GROUND;\n      }\n      return {\n        location: n.renderCoordsHelper.fromRenderCoords(c, new U({\n          spatialReference: a\n        })),\n        surfaceType: i\n      };\n    };\n  let p;\n  return e => {\n    if (\"start\" === e.action) {\n      const n = i(e.screenStart);\n      p = null != n ? n.location : null;\n    }\n    if (null == p) return null;\n    const n = i(e.screenEnd);\n    return null != n?.location ? {\n      ...e,\n      mapStart: p,\n      mapEnd: n.location,\n      surfaceType: n.surfaceType\n    } : null;\n  };\n}\n!function (e) {\n  e[e.GROUND = 0] = \"GROUND\", e[e.OTHER = 1] = \"OTHER\";\n}(F || (F = {}));\nconst B = u(),\n  J = u(),\n  K = E();\nexport { F as SurfaceType, A as convertToMapCoordinates, q as hideManipulatorWhileDragging, h as projectToWorldUp, z as screenToMap3D, D as screenToMapXYAtLocation, M as screenToMapXYForManipulatedObject, O as screenToRenderPlane, C as screenToRenderPlaneFromEvent, k as screenToRenderRay, G as screenToZConstrained };"],
  "mappings": "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",
  "names": ["e", "n", "P", "r", "t", "l", "s", "g", "i", "u", "T", "_", "w", "h", "p", "m", "d", "o", "F"]
}
