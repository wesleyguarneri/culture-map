{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/layers/graphics/data/FeatureStore.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../core/arrayUtils.js\";\nimport t from \"../../../core/Error.js\";\nimport r from \"../../../core/Evented.js\";\nimport s from \"../../../core/Logger.js\";\nimport { create as o, fromRect as i } from \"../../../geometry/support/aaBoundingBox.js\";\nimport { create as n } from \"../../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsOptimizedGeometry as a } from \"../featureConversionUtils.js\";\nimport { BoundsStore as d } from \"./BoundsStore.js\";\nimport { cleanFromGeometryEngine as u } from \"./geometryUtils.js\";\nimport { optimizedFeatureQueryEngineAdapter as h } from \"./optimizedFeatureQueryEngineAdapter.js\";\nconst f = o();\nclass m {\n  constructor(e) {\n    this.geometryInfo = e, this._boundsStore = new d(), this._featuresById = new Map(), this._markedIds = new Set(), this.events = new r(), this.featureAdapter = h;\n  }\n  get geometryType() {\n    return this.geometryInfo.geometryType;\n  }\n  get hasM() {\n    return this.geometryInfo.hasM;\n  }\n  get hasZ() {\n    return this.geometryInfo.hasZ;\n  }\n  get numFeatures() {\n    return this._featuresById.size;\n  }\n  get fullBounds() {\n    return this._boundsStore.fullBounds;\n  }\n  get storeStatistics() {\n    let e = 0;\n    return this._featuresById.forEach(t => {\n      null != t.geometry && t.geometry.coords && (e += t.geometry.coords.length);\n    }), {\n      featureCount: this._featuresById.size,\n      vertexCount: e / (this.hasZ ? this.hasM ? 4 : 3 : this.hasM ? 3 : 2)\n    };\n  }\n  getFullExtent(e) {\n    if (null == this.fullBounds) return null;\n    const [t, r, s, o] = this.fullBounds;\n    return {\n      xmin: t,\n      ymin: r,\n      xmax: s,\n      ymax: o,\n      spatialReference: u(e)\n    };\n  }\n  add(e) {\n    this._add(e), this._emitChanged();\n  }\n  addMany(e) {\n    for (const t of e) this._add(t);\n    this._emitChanged();\n  }\n  upsertMany(t) {\n    const r = t.map(e => this._upsert(e));\n    return this._emitChanged(), r.filter(e);\n  }\n  clear() {\n    this._featuresById.clear(), this._boundsStore.clear(), this._emitChanged();\n  }\n  removeById(e) {\n    const t = this._featuresById.get(e);\n    return t ? (this._remove(t), this._emitChanged(), t) : null;\n  }\n  removeManyById(e) {\n    this._boundsStore.invalidateIndex();\n    for (const t of e) {\n      const e = this._featuresById.get(t);\n      e && this._remove(e);\n    }\n    this._emitChanged();\n  }\n  forEachBounds(e, t) {\n    for (const r of e) {\n      const e = this._boundsStore.get(r.objectId);\n      e && t(i(f, e));\n    }\n  }\n  getFeature(e) {\n    return this._featuresById.get(e);\n  }\n  has(e) {\n    return this._featuresById.has(e);\n  }\n  forEach(e) {\n    this._featuresById.forEach(t => e(t));\n  }\n  forEachInBounds(e, t) {\n    this._boundsStore.forEachInBounds(e, e => {\n      t(this._featuresById.get(e));\n    });\n  }\n  startMarkingUsedFeatures() {\n    this._boundsStore.invalidateIndex(), this._markedIds.clear();\n  }\n  sweep() {\n    let e = !1;\n    this._featuresById.forEach((t, r) => {\n      this._markedIds.has(r) || (e = !0, this._remove(t));\n    }), this._markedIds.clear(), e && this._emitChanged();\n  }\n  _emitChanged() {\n    this.events.emit(\"changed\", void 0);\n  }\n  _add(e) {\n    if (!e) return;\n    const r = e.objectId;\n    if (null == r) return void s.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new t(\"featurestore:invalid-feature\", \"feature id is missing\", {\n      feature: e\n    }));\n    const o = this._featuresById.get(r);\n    let i;\n    if (this._markedIds.add(r), o ? (e.displayId = o.displayId, i = this._boundsStore.get(r), this._boundsStore.delete(r)) : null != this.onFeatureAdd && this.onFeatureAdd(e), !e.geometry?.coords?.length) return this._boundsStore.set(r, null), void this._featuresById.set(r, e);\n    i = a(null != i ? i : n(), e.geometry, this.geometryInfo.hasZ, this.geometryInfo.hasM), null != i && this._boundsStore.set(r, i), this._featuresById.set(r, e);\n  }\n  _upsert(e) {\n    const r = e?.objectId;\n    if (null == r) return s.getLogger(\"esri.layers.graphics.data.FeatureStore\").error(new t(\"featurestore:invalid-feature\", \"feature id is missing\", {\n      feature: e\n    })), null;\n    const o = this._featuresById.get(r);\n    if (!o) return this._add(e), e;\n    this._markedIds.add(r);\n    const {\n      geometry: i,\n      attributes: d\n    } = e;\n    for (const t in d) o.attributes[t] = d[t];\n    return i && (o.geometry = i, this._boundsStore.set(r, a(n(), i, this.geometryInfo.hasZ, this.geometryInfo.hasM) ?? null)), o;\n  }\n  _remove(e) {\n    null != this.onFeatureRemove && this.onFeatureRemove(e);\n    const t = e.objectId;\n    return this._markedIds.delete(t), this._boundsStore.delete(t), this._featuresById.delete(t), e;\n  }\n}\nexport { m as default };"],
  "mappings": "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",
  "names": ["o", "s", "e", "i"]
}
