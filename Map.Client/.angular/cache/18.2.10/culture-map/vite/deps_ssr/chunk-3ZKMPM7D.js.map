{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from \"./CIMResourceManager.js\";\nimport { Transformation as t, CanvasDrawHelper as i } from \"./CIMSymbolDrawHelper.js\";\nimport { CIMSymbolHelper as r } from \"./CIMSymbolHelper.js\";\nimport { OverrideHelper as a } from \"./OverrideHelper.js\";\nimport { mapCIMSymbolToGeometryType as s } from \"./utils.js\";\nconst n = 96 / 72;\nclass o {\n  constructor(t) {\n    this._spatialReference = t, this._imageDataCanvas = null, this._cimResourceManager = new e();\n  }\n  get _canvas() {\n    return this._imageDataCanvas || (this._imageDataCanvas = document.createElement(\"canvas\")), this._imageDataCanvas;\n  }\n  get resourceManager() {\n    return this._cimResourceManager;\n  }\n  async rasterizeCIMSymbolAsync(e, t, i, n, o, l, c, m, g) {\n    if (!e) return null;\n    const {\n      data: y\n    } = e;\n    if (!y || \"CIMSymbolReference\" !== y.type || !y.symbol) return null;\n    const {\n      symbol: u\n    } = y;\n    l || (l = s(u));\n    const d = await a.resolveSymbolOverrides(y, t, this._spatialReference, o, l, c, m),\n      w = this._cimResourceManager,\n      p = [];\n    r.fetchResources(d, w, p), r.fetchFonts(d, w, p), p.length > 0 && (await Promise.all(p));\n    const {\n        width: b,\n        height: f\n      } = i,\n      M = h(l, b, f, n),\n      C = r.getEnvelope(d, M, w);\n    if (!C) return null;\n    let R = 1,\n      v = 0,\n      I = 0;\n    switch (u.type) {\n      case \"CIMPointSymbol\":\n      case \"CIMTextSymbol\":\n        {\n          let e = 1;\n          C.width > b && (e = b / C.width);\n          let t = 1;\n          C.height > f && (t = f / C.height), \"preview\" === n && (C.width < b && (e = b / C.width), C.height < f && (t = f / C.height)), R = Math.min(e, t), v = C.x + C.width / 2, I = C.y + C.height / 2;\n        }\n        break;\n      case \"CIMLineSymbol\":\n        {\n          (g || C.height > f) && (R = f / C.height), I = C.y + C.height / 2;\n          const e = C.x * R + b / 2,\n            t = (C.x + C.width) * R + b / 2,\n            {\n              paths: i\n            } = M;\n          i[0][0][0] -= e / R, i[0][2][0] -= (t - b) / R;\n        }\n        break;\n      case \"CIMPolygonSymbol\":\n        {\n          v = C.x + C.width / 2, I = C.y + C.height / 2;\n          const e = C.x * R + b / 2,\n            t = (C.x + C.width) * R + b / 2,\n            i = C.y * R + f / 2,\n            r = (C.y + C.height) * R + f / 2,\n            {\n              rings: a\n            } = M;\n          e < 0 && (a[0][0][0] -= e, a[0][3][0] -= e, a[0][4][0] -= e), i < 0 && (a[0][0][1] += i, a[0][1][1] += i, a[0][4][1] += i), t > b && (a[0][1][0] -= t - b, a[0][2][0] -= t - b), r > f && (a[0][2][1] += r - f, a[0][3][1] += r - f);\n        }\n    }\n    const S = {\n      type: \"cim\",\n      data: {\n        type: \"CIMSymbolReference\",\n        symbol: d\n      }\n    };\n    return this.rasterize(S, b, f, v, I, R, l, 1, M);\n  }\n  rasterize(e, r, a, o, l, c, m, g = 0, y = null) {\n    const {\n      data: u\n    } = e;\n    if (!u || \"CIMSymbolReference\" !== u.type || !u.symbol) return null;\n    const {\n        symbol: d\n      } = u,\n      w = this._canvas,\n      p = (window.devicePixelRatio || 1) * n;\n    w.width = r * p, w.height = a * p, m || (m = s(d)), y || (y = h(m, r, a, \"legend\")), w.width += 2 * g, w.height += 2 * g;\n    const b = w.getContext(\"2d\", {\n        willReadFrequently: !0\n      }),\n      f = t.createIdentity();\n    f.translate(-o, -l), f.scale(c * p, -c * p), f.translate(r * p / 2 + g, a * p / 2 + g), b.clearRect(0, 0, w.width, w.height);\n    return new i(b, this._cimResourceManager, f, !0).drawSymbol(d, y), b.getImageData(0, 0, w.width, w.height);\n  }\n}\nfunction h(e, t, i, r) {\n  const a = 1,\n    s = -t / 2 + a,\n    n = t / 2 - a,\n    o = i / 2 - a,\n    h = -i / 2 + a;\n  switch (e) {\n    case \"esriGeometryPoint\":\n      return {\n        x: 0,\n        y: 0\n      };\n    case \"esriGeometryPolyline\":\n      return {\n        paths: [[[s, 0], [0, 0], [n, 0]]]\n      };\n    default:\n      return \"legend\" === r ? {\n        rings: [[[s, o], [n, 0], [n, h], [s, h], [s, o]]]\n      } : {\n        rings: [[[s, o], [n, o], [n, h], [s, h], [s, o]]]\n      };\n  }\n}\nexport { o as CIMSymbolRasterizer };"],
  "mappings": "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",
  "names": ["i", "n", "o", "y", "e", "t", "h"]
}
