import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  v
} from "./chunk-QEXRGMZ2.js";
import "./chunk-WEGL23JE.js";
import "./chunk-2UXQPHEA.js";
import {
  p as p2
} from "./chunk-IOZX2TXW.js";
import "./chunk-QJ4KFDZU.js";
import "./chunk-C22SF7N4.js";
import "./chunk-J53R4G62.js";
import "./chunk-R7WTJU3N.js";
import {
  l as l2
} from "./chunk-ECUSUVZM.js";
import "./chunk-CQIKG7VH.js";
import {
  u
} from "./chunk-4BTJRLWJ.js";
import {
  A,
  _,
  c,
  f,
  l,
  m,
  p
} from "./chunk-7SNJPIUA.js";
import "./chunk-UZL2AATT.js";
import "./chunk-LWIPFUZ3.js";
import "./chunk-JRL65HQ7.js";
import {
  r as r2
} from "./chunk-BZGBXDFF.js";
import {
  i
} from "./chunk-AEJ7YVFP.js";
import {
  y as y2
} from "./chunk-CXYUBZAK.js";
import "./chunk-LUORW76W.js";
import {
  t
} from "./chunk-NZTRS5LW.js";
import "./chunk-FV32SB4U.js";
import "./chunk-PFTDB6ZJ.js";
import "./chunk-FCVY35OB.js";
import "./chunk-HMPRRFR4.js";
import "./chunk-QWQJOAVR.js";
import "./chunk-3NWWTJOW.js";
import "./chunk-TRF6JO5N.js";
import "./chunk-ZHVMMFTW.js";
import {
  se
} from "./chunk-PLQQNSQY.js";
import "./chunk-QATJRB5Q.js";
import "./chunk-7Z4UWMRU.js";
import "./chunk-LCPLUSDH.js";
import {
  L
} from "./chunk-KYLW5XXS.js";
import "./chunk-HFXXFWYN.js";
import "./chunk-VENH3UKS.js";
import "./chunk-VFYCIIDC.js";
import "./chunk-AMH7CZMY.js";
import "./chunk-Q5JLNMWZ.js";
import "./chunk-AABDXAD3.js";
import "./chunk-LGS63R4F.js";
import "./chunk-U4EMQMDC.js";
import "./chunk-GNCXYHNE.js";
import "./chunk-D7C26LZP.js";
import "./chunk-BZHHBBFX.js";
import "./chunk-NVOJILW6.js";
import "./chunk-KYPTWEOO.js";
import "./chunk-WVFB3H4O.js";
import "./chunk-ZREJ3Y2F.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-BBUQOCRA.js";
import "./chunk-YBUJLIWZ.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import "./chunk-IUPJR3FF.js";
import "./chunk-TGZW6QWO.js";
import "./chunk-OYIDHTXG.js";
import "./chunk-KUBMHTYA.js";
import "./chunk-VSQZQLTQ.js";
import "./chunk-K43CZ3M5.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-UAETKRWQ.js";
import "./chunk-NXXQ35YM.js";
import "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-CXNERL22.js";
import "./chunk-7V4JSBFA.js";
import "./chunk-KAHESDP5.js";
import "./chunk-ONRZ4VTT.js";
import "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-XNLAOXPY.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-I2TVVMQ6.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-JKPUNUQA.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-THZPD5CT.js";
import "./chunk-OBCA6CWH.js";
import "./chunk-2JI245BP.js";
import "./chunk-N34BRXVM.js";
import "./chunk-7QV7DHWN.js";
import "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import "./chunk-RNF7VOCU.js";
import "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import "./chunk-DCXDXGAR.js";
import "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import "./chunk-2OZSYJDX.js";
import "./chunk-MZM4INJV.js";
import "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import {
  w
} from "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import {
  e
} from "./chunk-NUICEVIH.js";
import "./chunk-NXK752PZ.js";
import {
  y
} from "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import {
  a3 as a
} from "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import "./chunk-AIZ3T7E3.js";
import "./chunk-6UEMNP3E.js";
import {
  r
} from "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import {
  s2 as s
} from "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async,
  __spreadProps,
  __spreadValues
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/views/3d/terrain/RasterTile.js
var u2 = {
  bandCount: 3,
  outMin: 0,
  outMax: 1,
  minCutOff: [0, 0, 0],
  maxCutOff: [255, 255, 255],
  factor: [1 / 255, 1 / 255, 1 / 255],
  useGamma: false,
  gamma: [1, 1, 1],
  gammaCorrection: [1, 1, 1],
  colormap: null,
  colormapOffset: null,
  stretchType: "none",
  type: "stretch"
};
var m2 = class {
  constructor(t2, e2, r3 = null, s2 = null) {
    this.lij = t2, this.type = "raster-tile", this._memoryUsed = null, this._source = null, this._symbolizerParameters = null, this._bandIds = null, this._interpolation = null, this._dirty = false, this._transformGrid = null, this.isRendereredSource = false, this.symbolizerRenderer = null, this.rawPixelData = null, this.opacity = 1, this.source = e2, this.width = r3 || e2.width, this.height = s2 || e2.height;
  }
  get source() {
    return this._source;
  }
  set source(e2) {
    this._source = e2, this._rasterTexture = r(this._rasterTexture), this._memoryUsed = null;
  }
  get symbolizerParameters() {
    return this.isRendereredSource ? __spreadProps(__spreadValues({}, u2), {
      maxCutOff: [1, 1, 1],
      factor: [1, 1, 1]
    }) : this._symbolizerParameters || u2;
  }
  set symbolizerParameters(t2) {
    this._symbolizerParameters = t2;
  }
  get bandIds() {
    return this._bandIds;
  }
  set bandIds(t2) {
    if (null != t2 && t2.length > 0) {
      this._bandIds && t2.every((t3, e2) => !!this._bandIds?.[e2] && t3 === this._bandIds[e2]) || (this._bandIds = t2, this._dirty = true);
    } else this._bandIds = null;
  }
  get interpolation() {
    return this._interpolation || "nearest";
  }
  set interpolation(t2) {
    if (this._interpolation = t2, null != this._rasterTexture) {
      const e2 = this._getRasterTextureInterpolation(t2);
      this._rasterTexture.setSamplingMode("bilinear" === e2 ? L.LINEAR : L.NEAREST);
    }
  }
  get transformGrid() {
    return this._transformGrid;
  }
  set transformGrid(e2) {
    this._transformGrid = e2, this._transformGridTexture = r(this._transformGridTexture), this._memoryUsed = null;
  }
  bind(t2) {
    return !!(this.source && this.source.pixels && this.source.pixels.length > 0) && ((null == this._rasterTexture || this._dirty) && this._updateRasterTexture(t2, this.bandIds), null != this._rasterTexture && (this._updateColormapTexture(t2), this.transformGrid && null == this._transformGridTexture && (this._transformGridTexture = c(t2, this.transformGrid))), true);
  }
  getUniforms() {
    const {
      symbolizerParameters: t2,
      transformGrid: r3,
      width: s2,
      height: h,
      opacity: n
    } = this, u4 = l(r3, [s2, h], [this.source.width, this.source.height], n), m3 = _(t2.colormap, t2.colormapOffset), d = "stretch" === this.symbolizerParameters.type ? p(this.symbolizerParameters) : null, _2 = "hillshade" === this.symbolizerParameters.type ? A(this.symbolizerParameters) : null;
    return new v(u4, m3, d || _2, this._rasterTexture, this._transformGridTexture, this._colormapTexture);
  }
  get isBilinearWithStretchColorRamp() {
    const {
      symbolizerParameters: t2
    } = this;
    return "bilinear" === this.interpolation && null != t2.colormap && "stretch" === t2.type;
  }
  get memoryUsage() {
    if (null == this._memoryUsed) {
      const t2 = [this._rasterTexture, this._transformGridTexture, this._colormapTexture];
      this._memoryUsed = t2.map((t3) => null != t3 ? t3.descriptor.width * t3.descriptor.height * 4 : 0).reduce((t3, e2) => t3 + e2, 0);
    }
    return this._memoryUsed;
  }
  release() {
    return this._rasterTexture = r(this._rasterTexture), this._transformGridTexture = r(this._transformGridTexture), this._colormapTexture = r(this._colormapTexture), this.source = null, this.transformGrid = null, this.rawPixelData = null, true;
  }
  _updateRasterTexture(e2, r3) {
    const s2 = this.source ? this.source.extractBands(r3) : null;
    if (!(s2?.pixels && s2.pixels.length > 0)) return void (this._rasterTexture = r(this._rasterTexture));
    const i2 = null == r3 && null == this.bandIds || null != r3 && null != this.bandIds && r3.join("") === this.bandIds.join("");
    if (null != this._rasterTexture && i2) return;
    this._rasterTexture = r(this._rasterTexture);
    const o = this._getRasterTextureInterpolation(this.interpolation);
    this._rasterTexture = f(e2, s2, o, this.isRendereredSource || this.hasStretchTypeNone());
  }
  hasStretchTypeNone() {
    return "stretchType" in this.symbolizerParameters && "none" === this.symbolizerParameters.stretchType && !this.symbolizerParameters.useGamma && "u8" === this.source.pixelType;
  }
  _getRasterTextureInterpolation(t2) {
    return "lut" === this.symbolizerParameters.type || "nearest" === t2 || "majority" === t2 || this.isBilinearWithStretchColorRamp ? "nearest" : "bilinear";
  }
  _updateColormapTexture(e2) {
    const r3 = this._colormap, s2 = this.symbolizerParameters.colormap;
    return s2 ? r3 ? s2.length !== r3.length || s2.some((t2, e3) => t2 !== r3[e3]) ? (this._colormapTexture = r(this._colormapTexture), this._colormapTexture = m(e2, s2), void (this._colormap = s2)) : void 0 : (this._colormapTexture = m(e2, s2), void (this._colormap = s2)) : (this._colormapTexture = r(this._colormapTexture), void (this._colormap = null));
  }
};

// ../../../node_modules/@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js
var y3 = class extends u(i(p2(l2(y2)))) {
  constructor() {
    super(...arguments), this.type = "imagery-tile-3d", this._isAlignedMapTile = true;
  }
  initialize() {
    this.layer.increaseRasterJobHandlerUsage(), null == this.fullExtent && this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible", "The layer extent cannot be projected to the view's spatial reference", {
      layer: this.layer
    })));
    const e2 = w(() => this.view?.basemapTerrain?.tilingSchemeLocked).then(() => {
      const e3 = this.view.basemapTerrain.tilingScheme, t2 = this.layer.tileInfo;
      this._isAlignedMapTile = ["png", "png24", "png32", "jpg", "mixed"].includes(t2.format) && e3.compatibleWith(t2), this.tileInfo = this._isAlignedMapTile ? t2 : e3.toTileInfo(), this._updatingHandles.add(() => [this.layer.renderer, this.layer.interpolation, this.layer.bandIds, this.layer.multidimensionalDefinition, this.layer.multidimensionalSubset, this.layer.rasterFunction, this.timeExtent], () => this.refresh());
    });
    this.addResolvingPromise(e2);
  }
  destroy() {
    this.layer.decreaseRasterJobHandlerUsage();
  }
  get _blankTile() {
    const e2 = document.createElement("canvas"), t2 = e2.getContext("2d"), [r3, i2] = this.tileInfo.size;
    return e2.width = r3, e2.height = i2, t2.clearRect(0, 0, r3, i2), t2.getImageData(0, 0, r3, i2);
  }
  get imageFormatIsOpaque() {
    return "jpg" === this.layer.tileInfo.format;
  }
  get hasMixedImageFormats() {
    return "mixed" === this.layer.tileInfo.format;
  }
  get dataLevelRange() {
    const e2 = this.layer.tileInfo, t2 = this.tileInfo.lodAt(0)?.scale, r3 = this.layer.tileInfo.lodAt(e2.lods.length - 1)?.scale;
    return this.levelRangeFromScaleRange(t2, r3);
  }
  _getfullExtent() {
    return se(this.layer.serviceRasterInfo, this.view.basemapTerrain?.spatialReference ?? this.view.spatialReference);
  }
  fetchTile(e2, t2) {
    return __async(this, null, function* () {
      const r3 = this.tileInfo, i2 = this._canSymbolizeInWebGL(), s2 = {
        tileInfo: r3,
        requestRawData: i2,
        signal: t2.signal,
        timeExtent: this.timeExtent,
        requestAsImageElement: this._isAlignedMapTile,
        noClip: false
      }, {
        layer: a2
      } = this, [l3, n, m3] = e2, p3 = yield a2.fetchTile(l3, n, m3, s2);
      if (p3 instanceof HTMLImageElement) return p3;
      let h = p3?.pixelBlock;
      if (null == h) return this._blankTile;
      if (!i2 && (h = yield a2.applyRenderer(p3), null == h)) return this._blankTile;
      const c2 = new m2([l3, n, m3], h, r3.size[0], r3.size[1]);
      return i2 ? (c2.symbolizerRenderer = a2.symbolizer.rendererJSON, c2.symbolizerParameters = a2.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(l3)), c2.transformGrid = p3.transformGrid, c2.bandIds = a2.bandIds) : (c2.isRendereredSource = true, c2.bandIds = null), c2.interpolation = a2.interpolation, c2;
    });
  }
  _getSymbolizerOptions(e2) {
    const t2 = this.tileInfo.lodAt(e2).resolution;
    return {
      pixelBlock: null,
      isGCS: null != this.view.basemapTerrain?.spatialReference ? this.view.basemapTerrain.spatialReference.isGeographic : this.view.spatialReference.isGeographic,
      resolution: {
        x: t2,
        y: t2
      },
      bandIds: this.layer.bandIds
    };
  }
  ensureSymbolizerParameters(e2) {
    this._canSymbolizeInWebGL() && JSON.stringify(e2.symbolizerRenderer) !== JSON.stringify(this.layer.symbolizer.rendererJSON) && (e2.symbolizerParameters = this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e2.lij[0])));
  }
  createFetchPopupFeaturesQueryGeometry(e2, t2) {
    return r2(e2, t2, this.view);
  }
  refresh() {
    this.emit("data-changed");
  }
  doRefresh() {
    return __async(this, null, function* () {
      this.suspended || this.emit("data-changed");
    });
  }
  _canSymbolizeInWebGL() {
    const e2 = t(), {
      symbolizer: t2
    } = this.layer, r3 = t2.lookup?.colormapLut?.indexedColormap, i2 = !!this.layer.rasterFunction?.hasClipFunction, s2 = r3 && r3.length > 4 * (e2.maxTextureSize || 4906);
    return t2.canRenderInWebGL && !s2 && !i2;
  }
};
e([y({
  readOnly: true
})], y3.prototype, "_blankTile", null), e([y({
  readOnly: true
})], y3.prototype, "imageFormatIsOpaque", null), e([y({
  readOnly: true
})], y3.prototype, "hasMixedImageFormats", null), e([y({
  readOnly: true
})], y3.prototype, "dataLevelRange", null), y3 = e([a("esri.views.3d.layers.ImageryTileLayerView3D")], y3);
var u3 = y3;
export {
  u3 as default
};
//# sourceMappingURL=ImageryTileLayerView3D-T7NUNIQX.js.map
