{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/rest/query/operations/query.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from \"../../../request.js\";\nimport { urlToObject as e, join as n } from \"../../../core/urlUtils.js\";\nimport { getJsonType as r } from \"../../../geometry/support/jsonUtils.js\";\nimport { normalizeCentralMeridian as i } from \"../../../geometry/support/normalizeUtils.js\";\nimport { srToRESTValue as a } from \"../../../geometry/support/spatialReferenceUtils.js\";\nimport { mapParameters as o } from \"../../operations/urlUtils.js\";\nimport { parsePBFFeatureQuery as u } from \"./pbfQueryUtils.js\";\nimport { applyFeatureSetZUnitScaling as l } from \"./queryZScale.js\";\nconst s = \"Layer does not support extent calculation.\";\nfunction m(t, e) {\n  if (e && \"extent\" === t.type) return `${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;\n  if (e && \"point\" === t.type) return `${t.x},${t.y}`;\n  const n = t.toJSON();\n  return delete n.spatialReference, JSON.stringify(n);\n}\nfunction y(t, e) {\n  const n = t.geometry,\n    i = t.toJSON();\n  delete i.compactGeometryEnabled, delete i.defaultSpatialReferenceEnabled;\n  const o = i;\n  let u, l, s;\n  if (null != n && (l = n.spatialReference, s = a(l), o.geometryType = r(n), o.geometry = m(n, t.compactGeometryEnabled), o.inSR = s), i.groupByFieldsForStatistics && (o.groupByFieldsForStatistics = i.groupByFieldsForStatistics.join(\",\")), i.objectIds && (o.objectIds = i.objectIds.join(\",\")), i.orderByFields && (o.orderByFields = i.orderByFields.join(\",\")), !i.outFields || !i.returnDistinctValues && (e?.returnCountOnly || e?.returnExtentOnly || e?.returnIdsOnly) ? delete o.outFields : i.outFields.includes(\"*\") ? o.outFields = \"*\" : o.outFields = i.outFields.join(\",\"), i.outSR ? (o.outSR = a(i.outSR), u = t.outSpatialReference) : n && (i.returnGeometry || i.returnCentroid) && (o.outSR = o.inSR, u = l), i.returnGeometry && delete i.returnGeometry, i.outStatistics && (o.outStatistics = JSON.stringify(i.outStatistics)), i.fullText && (o.fullText = JSON.stringify(i.fullText)), i.pixelSize && (o.pixelSize = JSON.stringify(i.pixelSize)), i.quantizationParameters && (t.defaultSpatialReferenceEnabled && null != l && null != t.quantizationParameters?.extent && l.equals(t.quantizationParameters.extent.spatialReference) && delete i.quantizationParameters.extent.spatialReference, o.quantizationParameters = JSON.stringify(i.quantizationParameters)), i.parameterValues && (o.parameterValues = JSON.stringify(i.parameterValues)), i.rangeValues && (o.rangeValues = JSON.stringify(i.rangeValues)), i.dynamicDataSource && (o.layer = JSON.stringify({\n    source: i.dynamicDataSource\n  }), delete i.dynamicDataSource), i.timeExtent) {\n    const t = i.timeExtent,\n      {\n        start: e,\n        end: n\n      } = t;\n    null == e && null == n || (o.time = e === n ? e : `${e ?? \"null\"},${n ?? \"null\"}`), delete i.timeExtent;\n  }\n  return t.defaultSpatialReferenceEnabled && null != l && null != u && l.equals(u) && (o.defaultSR = o.inSR, delete o.inSR, delete o.outSR), o;\n}\nasync function c(t, e, n, r) {\n  const i = null != e.timeExtent && e.timeExtent.isEmpty ? {\n    data: {\n      features: []\n    }\n  } : await E(t, e, \"json\", r);\n  return l(e, n, i.data), i;\n}\nasync function f(t, e, n, r) {\n  if (null != e.timeExtent && e.timeExtent.isEmpty) return {\n    data: n.createFeatureResult()\n  };\n  const i = await d(t, e, r),\n    a = i;\n  return a.data = u(i.data, n), a;\n}\nfunction d(t, e, n) {\n  return E(t, e, \"pbf\", n);\n}\nfunction p(t, e, n) {\n  return null != e.timeExtent && e.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      objectIds: []\n    }\n  }) : E(t, e, \"json\", n, {\n    returnIdsOnly: !0\n  });\n}\nfunction S(t, e, n) {\n  return null != e.timeExtent && e.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      count: 0\n    }\n  }) : E(t, e, \"json\", n, {\n    returnIdsOnly: !0,\n    returnCountOnly: !0\n  });\n}\nasync function x(t, e, n) {\n  if (null != e.timeExtent && e.timeExtent.isEmpty) return {\n    data: {\n      count: 0,\n      extent: null\n    }\n  };\n  const r = await E(t, e, \"json\", n, {\n      returnExtentOnly: !0,\n      returnCountOnly: !0\n    }),\n    i = r.data;\n  if (i.hasOwnProperty(\"extent\")) return r;\n  if (i.features) throw new Error(s);\n  if (i.hasOwnProperty(\"count\")) throw new Error(s);\n  return r;\n}\nasync function E(r, a, u, l = {}, s = {}) {\n  const m = \"string\" == typeof r ? e(r) : r,\n    c = a.geometry ? [a.geometry] : [],\n    f = await i(c, null, {\n      signal: l.signal\n    }),\n    d = f?.[0];\n  null != d && ((a = a.clone()).geometry = d);\n  const p = o({\n    ...m.query,\n    f: u,\n    ...s,\n    ...y(a, s)\n  });\n  return t(n(m.path, g(a, s) ? \"query3d\" : \"query\"), {\n    ...l,\n    responseType: \"pbf\" === u ? \"array-buffer\" : \"json\",\n    query: {\n      ...p,\n      ...l.query\n    }\n  });\n}\nfunction g(t, e) {\n  return null != t.formatOf3DObjects && !(e.returnCountOnly || e.returnExtentOnly || e.returnIdsOnly);\n}\nexport { m as encodeGeometry, c as executeQuery, S as executeQueryForCount, x as executeQueryForExtent, p as executeQueryForIds, f as executeQueryPBF, d as executeQueryPBFBuffer, y as queryToQueryStringParameters, E as runQuery };"],
  "mappings": "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",
  "names": ["t", "s", "e", "n", "d", "p", "m", "c", "f"]
}
