import { createRequire } from 'module';const require = createRequire(import.meta.url);
import {
  l
} from "./chunk-RCTGQZER.js";
import {
  l as l2
} from "./chunk-DMKOSZH7.js";
import {
  t as t2
} from "./chunk-A2K6JP2G.js";
import {
  B as B2,
  E,
  G as G2,
  I,
  L,
  N as N2,
  O as O2,
  T,
  a as a2,
  a2 as a3,
  b,
  c,
  d,
  e,
  k,
  q
} from "./chunk-QINTH2QT.js";
import {
  D as D2,
  u
} from "./chunk-BKDLCDYW.js";
import "./chunk-FSGJEX7B.js";
import {
  D
} from "./chunk-233INU7Q.js";
import {
  N
} from "./chunk-REOQMQ44.js";
import {
  B2 as B,
  G2 as G,
  H,
  He,
  Ne,
  P,
  Q,
  Re,
  U,
  V,
  W,
  X,
  _,
  a,
  ae,
  ee,
  ge,
  he,
  me,
  r,
  te,
  v2 as v,
  y as y2
} from "./chunk-M633ZBOT.js";
import {
  t
} from "./chunk-GBPPBJPA.js";
import "./chunk-IS3LAXOO.js";
import "./chunk-XDYMUXAT.js";
import "./chunk-FN552AT6.js";
import "./chunk-OEC3KBO5.js";
import "./chunk-H65MVS3B.js";
import "./chunk-YT63GLYW.js";
import "./chunk-PDBJ6G5O.js";
import "./chunk-BY3XBMAH.js";
import "./chunk-OO7WNZEW.js";
import "./chunk-LU7PU2CS.js";
import "./chunk-4O23HCRT.js";
import "./chunk-X5QZGB37.js";
import "./chunk-T5C2TZNO.js";
import "./chunk-AOGKNBDG.js";
import "./chunk-F4FQ67JP.js";
import "./chunk-FDI2X6GO.js";
import "./chunk-3XHDZQO5.js";
import "./chunk-2BLQXT54.js";
import "./chunk-JSWVKNBA.js";
import {
  Ze
} from "./chunk-FJ3AI2QH.js";
import "./chunk-XUSZNRTW.js";
import "./chunk-W26QF64E.js";
import "./chunk-D3XX7CQS.js";
import "./chunk-D5ZVYTUT.js";
import "./chunk-MY2HOJQI.js";
import "./chunk-CAYYEMNX.js";
import "./chunk-6NY22YWY.js";
import "./chunk-JBJJW35I.js";
import "./chunk-PXTZCDRW.js";
import "./chunk-GVEKX2VV.js";
import "./chunk-MM5HQGRH.js";
import "./chunk-JA5GJ7PX.js";
import "./chunk-Q6OCJ3NG.js";
import "./chunk-DD6UQHSS.js";
import "./chunk-FALQTRQL.js";
import "./chunk-GGTDLTZW.js";
import "./chunk-2W7YKBRA.js";
import "./chunk-GLFGRGCP.js";
import "./chunk-WQZJGTGX.js";
import "./chunk-VFQA3B5S.js";
import "./chunk-NOH3NLJ5.js";
import "./chunk-LX5BT6XP.js";
import "./chunk-PLGJMWC5.js";
import "./chunk-UGFQYEND.js";
import "./chunk-XC5RDNAY.js";
import "./chunk-KXVPQVTB.js";
import "./chunk-ARN5GJBK.js";
import "./chunk-MPLS4PY6.js";
import "./chunk-AGBPYPP3.js";
import "./chunk-IKBXTTSU.js";
import "./chunk-VMZV7772.js";
import "./chunk-3FR2T2I2.js";
import "./chunk-LOZRWPGI.js";
import "./chunk-GZ64OOAB.js";
import "./chunk-WR2NVDOI.js";
import "./chunk-EPLJRYUV.js";
import "./chunk-VYRCS5VR.js";
import "./chunk-OOK3QTWF.js";
import "./chunk-VFYCIIDC.js";
import "./chunk-PQUZDC3L.js";
import "./chunk-UUQ5O7GK.js";
import "./chunk-6XY35LS7.js";
import "./chunk-T42EJVJR.js";
import "./chunk-D3QK4EV3.js";
import "./chunk-JTDKNK44.js";
import "./chunk-RR7OQLEK.js";
import "./chunk-NAG6YX7T.js";
import "./chunk-WFNAKG2H.js";
import "./chunk-EKHRAAS6.js";
import "./chunk-IEB4ZCRH.js";
import "./chunk-7QOUHKW5.js";
import "./chunk-NHYYZMJR.js";
import "./chunk-WVSTX2NW.js";
import "./chunk-EXPZNTF3.js";
import "./chunk-ORYC4PVJ.js";
import "./chunk-DXIKKLD7.js";
import "./chunk-VQNXE43R.js";
import {
  y
} from "./chunk-VZ37C3ID.js";
import "./chunk-5R3HARKC.js";
import "./chunk-BKSTWG4S.js";
import "./chunk-FSG7HOZQ.js";
import "./chunk-Q5TIVVER.js";
import "./chunk-ZPMUEGLK.js";
import "./chunk-GNFDYYU3.js";
import "./chunk-X36BR2QB.js";
import "./chunk-RGG3YJQA.js";
import "./chunk-GBJYL7OX.js";
import "./chunk-GHKVDSKU.js";
import "./chunk-NVOJILW6.js";
import "./chunk-KYPTWEOO.js";
import "./chunk-WVFB3H4O.js";
import "./chunk-C7BQE556.js";
import "./chunk-ZREJ3Y2F.js";
import "./chunk-IR6CVPPC.js";
import "./chunk-BBUQOCRA.js";
import "./chunk-YBUJLIWZ.js";
import "./chunk-DL2B6IFJ.js";
import "./chunk-VOOO6FU5.js";
import "./chunk-IUPJR3FF.js";
import "./chunk-TGZW6QWO.js";
import "./chunk-OYIDHTXG.js";
import "./chunk-KUBMHTYA.js";
import "./chunk-E5NWFBZG.js";
import "./chunk-FP37456K.js";
import "./chunk-VSQZQLTQ.js";
import "./chunk-K43CZ3M5.js";
import "./chunk-6EIBUVMG.js";
import "./chunk-XCCMILGI.js";
import "./chunk-NBJSAHZT.js";
import "./chunk-BD24XM4D.js";
import "./chunk-NXXQ35YM.js";
import "./chunk-3BXPVUY5.js";
import "./chunk-LM3JDV4W.js";
import "./chunk-34V2CLL5.js";
import "./chunk-CXNERL22.js";
import "./chunk-7V4JSBFA.js";
import "./chunk-REIMIECM.js";
import "./chunk-EO2EW5KR.js";
import "./chunk-JEFPXTYT.js";
import "./chunk-MVS2BECH.js";
import "./chunk-UZ7IOCF3.js";
import "./chunk-OS542PQQ.js";
import "./chunk-3B5GODXR.js";
import "./chunk-NKXXHQDD.js";
import "./chunk-7TBQUMV3.js";
import "./chunk-TPLUZX3A.js";
import "./chunk-BGLJ2FAH.js";
import "./chunk-2EJFYNM7.js";
import "./chunk-DC5LRNPY.js";
import "./chunk-ASCK5HJ5.js";
import "./chunk-5X5U7R6O.js";
import "./chunk-XNLAOXPY.js";
import "./chunk-ZT7V2AVD.js";
import "./chunk-C2OXE4NQ.js";
import "./chunk-KOI252FF.js";
import "./chunk-I2TVVMQ6.js";
import "./chunk-5EGQYY2H.js";
import "./chunk-JKPUNUQA.js";
import "./chunk-SR7PRON4.js";
import "./chunk-HGHPYGKP.js";
import "./chunk-4DSGTDZJ.js";
import "./chunk-VYTPFEL2.js";
import "./chunk-RLGDH6IY.js";
import "./chunk-MRPCXIVS.js";
import "./chunk-YTKVV2Y3.js";
import "./chunk-GCVQXAS4.js";
import "./chunk-UFQD6AL4.js";
import "./chunk-EGBDRLCX.js";
import "./chunk-THZPD5CT.js";
import "./chunk-OBCA6CWH.js";
import "./chunk-2JI245BP.js";
import {
  O
} from "./chunk-CBOFHWPI.js";
import {
  m
} from "./chunk-ABIG6PT5.js";
import "./chunk-ZEZ3LI2L.js";
import "./chunk-N34BRXVM.js";
import "./chunk-KETDH2J4.js";
import {
  C
} from "./chunk-7QV7DHWN.js";
import "./chunk-4L4Y34YK.js";
import "./chunk-BXONKQKI.js";
import "./chunk-2HDBQXAR.js";
import "./chunk-RNF7VOCU.js";
import "./chunk-TIRJMGGG.js";
import "./chunk-ZDRQSPB6.js";
import "./chunk-DCXDXGAR.js";
import "./chunk-BCCDYCTQ.js";
import "./chunk-AYL3HQHD.js";
import "./chunk-66YQWHHE.js";
import "./chunk-QGBMZIP4.js";
import "./chunk-AOEBZVTA.js";
import "./chunk-2OZSYJDX.js";
import "./chunk-MZM4INJV.js";
import "./chunk-J4GMQHGL.js";
import "./chunk-MHPE4SZA.js";
import "./chunk-6SSA7P3A.js";
import "./chunk-FQBTLEUI.js";
import "./chunk-GS7Y3YOG.js";
import "./chunk-Y2HYKTTT.js";
import "./chunk-XLEC46FY.js";
import "./chunk-4AZPIP7K.js";
import "./chunk-G73HQZEL.js";
import "./chunk-LZSLQ24Q.js";
import "./chunk-U3RHUXYK.js";
import "./chunk-7DBI6LQG.js";
import "./chunk-AUUN7RFQ.js";
import "./chunk-JAMSDYD6.js";
import "./chunk-PH6NPTP7.js";
import "./chunk-NUICEVIH.js";
import "./chunk-NXK752PZ.js";
import "./chunk-UVNLCXWD.js";
import "./chunk-PNUA7JOS.js";
import "./chunk-OR2FKGUM.js";
import "./chunk-UDMPWVPF.js";
import "./chunk-XJNKCEWL.js";
import {
  S
} from "./chunk-AIZ3T7E3.js";
import "./chunk-6UEMNP3E.js";
import "./chunk-6WGE3IUL.js";
import "./chunk-MLYB2YW4.js";
import "./chunk-6JFGZTLU.js";
import "./chunk-2ZJE6ZFX.js";
import {
  __async
} from "./chunk-XBPEBUD5.js";

// ../../../node_modules/@arcgis/core/arcade/functions/featuresetbase.js
function X2(e2) {
  if (1 === e2.length) {
    if (U(e2[0])) return l("distinct", e2[0], -1);
    if (Q(e2[0])) return l("distinct", e2[0].toArray(), -1);
  }
  return l("distinct", e2, -1);
}
function ee2(e2, t3, n) {
  return __async(this, null, function* () {
    const a4 = e2.getVariables();
    if (a4.length > 0) {
      const i = [];
      for (let e3 = 0; e3 < a4.length; e3++) {
        const r3 = {
          name: a4[e3]
        };
        i.push(yield t3.evaluateIdentifier(n, r3));
      }
      const r2 = {};
      for (let e3 = 0; e3 < a4.length; e3++) r2[a4[e3]] = i[e3];
      return e2.parameters = r2, e2;
    }
    return e2;
  });
}
function te2(e2, t3, n = null) {
  for (const a4 in e2) if (a4.toLowerCase() === t3.toLowerCase()) return e2[a4];
  return n;
}
function ne(e2) {
  if (null === e2) return null;
  const t3 = {
    type: te2(e2, "type", ""),
    name: te2(e2, "name", "")
  };
  if ("range" === t3.type) t3.range = te2(e2, "range", []);
  else {
    t3.codedValues = [];
    for (const n of te2(e2, "codedValues", [])) t3.codedValues.push({
      name: te2(n, "name", ""),
      code: te2(n, "code", null)
    });
  }
  return t3;
}
function ae2(e2) {
  if (null === e2) return null;
  const t3 = {}, n = te2(e2, "wkt");
  null !== n && (t3.wkt = n);
  const a4 = te2(e2, "wkid");
  return null !== a4 && (t3.wkid = a4), t3;
}
function ie(e2) {
  if (null === e2) return null;
  const t3 = {
    hasZ: te2(e2, "hasz", false),
    hasM: te2(e2, "hasm", false)
  }, n = te2(e2, "spatialreference");
  null != n && (t3.spatialReference = ae2(n));
  const a4 = te2(e2, "x", null);
  if (null !== a4) return t3.x = a4, t3.y = te2(e2, "y", null), t3.hasZ && (t3.z = te2(e2, "z", null)), t3.hasM && (t3.m = te2(e2, "m", null)), t3;
  const i = te2(e2, "rings", null);
  if (null !== i) return t3.rings = i, t3;
  const r2 = te2(e2, "paths", null);
  if (null !== r2) return t3.paths = r2, t3;
  const s = te2(e2, "points", null);
  if (null !== s) return t3.points = s, t3;
  for (const o of ["xmin", "xmax", "ymin", "ymax", "zmin", "zmax", "mmin", "mmax"]) {
    const n2 = te2(e2, o, null);
    null !== n2 && (t3[o] = n2);
  }
  return t3;
}
function re(e2, t3) {
  for (const n of t3) if (n === e2) return true;
  return false;
}
function se(e2) {
  return !!e2.layerDefinition && !!e2.featureSet && false !== re(e2.layerDefinition.geometryType, ["", null, "esriGeometryNull", "esriGeometryPoint", "esriGeometryPolyline", "esriGeometryPolygon", "esriGeometryMultipoint", "esriGeometryEnvelope"]) && false !== U(e2.layerDefinition.fields) && false !== U(e2.featureSet.features);
}
function oe(e2) {
  return "utc" === e2?.toLowerCase() ? "UTC" : "unknown" === e2?.toLowerCase() ? "Unknown" : e2;
}
function le(q2) {
  "async" === q2.mode && (q2.functions.timezone = function(t3, r2) {
    return q2.standardFunctionAsync(t3, r2, (s, o, l3) => __async(this, null, function* () {
      if (ae(l3, 1, 2, t3, r2), te(l3[0])) return "Unknown";
      if (ee(l3[0])) return "Unknown";
      if (B(l3[0])) {
        if (yield l3[0].load(), 1 === l3.length || null === l3[1]) return l3[0].datesInUnknownTimezone ? oe("unknown") : oe(l3[0].dateFieldsTimeZone);
        if (!(l3[1] instanceof N) || false === l3[1].hasField("type")) throw new a(t3, r.InvalidParameter, r2);
        const e2 = l3[1].field("type");
        if (false === G(e2)) throw new a(t3, r.InvalidParameter, r2);
        switch (me(e2).toLowerCase()) {
          case "preferredtimezone":
            return oe(l3[0].preferredTimeZone);
          case "editfieldsinfo":
            return oe(l3[0].editFieldsInfo?.timeZone ?? null);
          case "timeinfo":
            return oe(l3[0].timeInfo?.timeZone ?? null);
          case "field":
            if (l3[1].hasField("fieldname") && G(l3[1].field("fieldname"))) return oe(l3[0].fieldTimeZone(me(l3[1].field("fieldname"))));
        }
        throw new a(t3, r.InvalidParameter, r2);
      }
      const f = he(l3[0], He(t3));
      if (null === f) return null;
      const u2 = f.timeZone;
      return "system" === u2 ? m.systemTimeZoneCanonicalName : "utc" === u2.toLowerCase() ? "UTC" : "unknown" === u2.toLowerCase() ? "Unknown" : u2;
    }));
  }, q2.functions.sqltimestamp = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 1, 3, e2, t3);
      const o = s[0];
      if (X(o)) {
        if (1 === s.length) return o.toSQLWithKeyword();
        if (2 === s.length) return o.changeTimeZone(me(s[1])).toSQLWithKeyword();
        throw new a(e2, r.InvalidParameter, t3);
      }
      if (ee(o)) return o.toSQLWithKeyword();
      if (B(o)) {
        if (3 !== s.length) throw new a(e2, r.InvalidParameter, t3);
        yield o.load();
        const n2 = me(s[1]);
        if (ee(s[2])) return s[2].toSQLWithKeyword();
        if (false === X(s[2])) throw new a(e2, r.InvalidParameter, t3);
        const r3 = o.fieldTimeZone(n2);
        return null === r3 ? s[2].toSQLWithKeyword() : s[2].changeTimeZone(r3).toSQLWithKeyword();
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "sqltimestamp",
    min: 2,
    max: 4
  }), q2.functions.featuresetbyid = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => {
      if (ae(s, 2, 4, e2, t3), W(s[0])) {
        const n2 = me(s[1]);
        let r3 = P(s[2], null);
        const o = Ne(P(s[3], true));
        if (null === r3 && (r3 = ["*"]), false === U(r3)) throw new a(e2, r.InvalidParameter, t3);
        return s[0].featureSetById(n2, o, r3);
      }
      throw new a(e2, r.InvalidParameter, t3);
    });
  }, q2.signatures.push({
    name: "featuresetbyid",
    min: 2,
    max: 4
  }), q2.functions.getfeatureset = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, o) => __async(this, null, function* () {
      if (ae(o, 1, 2, e2, t3), H(o[0])) {
        let t4 = P(o[1], "datasource");
        return null === t4 && (t4 = "datasource"), t4 = me(t4).toLowerCase(), q(o[0].fullSchema(), t4, e2.lrucache, e2.interceptor, e2.spatialReference ?? null);
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "getfeatureset",
    min: 1,
    max: 2
  }), q2.functions.featuresetbyportalitem = function(e2, n) {
    return q2.standardFunctionAsync(e2, n, (r2, s, l3) => {
      if (ae(l3, 2, 5, e2, n), null === l3[0]) throw new a(e2, r.PortalRequired, n);
      if (l3[0] instanceof t2) {
        const t3 = me(l3[1]), r3 = me(l3[2]);
        let s2 = P(l3[3], null);
        const f2 = Ne(P(l3[4], true));
        if (null === s2 && (s2 = ["*"]), false === U(s2)) throw new a(e2, r.InvalidParameter, n);
        let u3;
        return u3 = e2.services?.portal ? e2.services.portal : C.getDefault(), u3 = l2(l3[0], u3), G2(t3, r3, e2.spatialReference ?? null, s2, f2, u3, e2.lrucache, e2.interceptor);
      }
      if (false === G(l3[0])) throw new a(e2, r.PortalRequired, n);
      const f = me(l3[0]), u2 = me(l3[1]);
      let d2 = P(l3[2], null);
      const c2 = Ne(P(l3[3], true));
      if (null === d2 && (d2 = ["*"]), false === U(d2)) throw new a(e2, r.InvalidParameter, n);
      return G2(f, u2, e2.spatialReference ?? null, d2, c2, e2.services?.portal ?? C.getDefault(), e2.lrucache, e2.interceptor);
    });
  }, q2.signatures.push({
    name: "featuresetbyportalitem",
    min: 2,
    max: 5
  }), q2.functions.featuresetbyname = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => {
      if (ae(s, 2, 4, e2, t3), W(s[0])) {
        const n2 = me(s[1]);
        let r3 = P(s[2], null);
        const o = Ne(P(s[3], true));
        if (null === r3 && (r3 = ["*"]), false === U(r3)) throw new a(e2, r.InvalidParameter, t3);
        return s[0].featureSetByName(n2, o, r3);
      }
      throw new a(e2, r.InvalidParameter, t3);
    });
  }, q2.signatures.push({
    name: "featuresetbyname",
    min: 2,
    max: 4
  }), q2.functions.featureset = function(e2, t3) {
    return q2.standardFunction(e2, t3, (r2, s, o) => {
      ae(o, 1, 1, e2, t3);
      const l3 = {
        layerDefinition: {
          geometryType: "",
          objectIdField: "",
          globalIdField: "",
          typeIdField: "",
          hasM: false,
          hasZ: false,
          fields: []
        },
        featureSet: {
          geometryType: "",
          features: []
        }
      };
      if (G(o[0])) {
        const e3 = JSON.parse(o[0]);
        void 0 !== e3.layerDefinition ? (l3.layerDefinition = e3.layerDefinition, l3.featureSet = e3.featureSet, e3.layerDefinition.spatialReference && (l3.layerDefinition.spatialReference = e3.layerDefinition.spatialReference)) : (l3.featureSet.features = e3.features, l3.featureSet.geometryType = e3.geometryType, l3.layerDefinition.geometryType = l3.featureSet.geometryType, l3.layerDefinition.objectIdField = e3.objectIdFieldName ?? "", l3.layerDefinition.typeIdField = e3.typeIdFieldName, l3.layerDefinition.globalIdField = e3.globalIdFieldName, l3.layerDefinition.fields = e3.fields, e3.spatialReference && (l3.layerDefinition.spatialReference = e3.spatialReference));
      } else {
        if (!(o[0] instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = JSON.parse(o[0].castToText(true)), r3 = te2(n, "layerdefinition");
          if (null !== r3) {
            l3.layerDefinition.geometryType = te2(r3, "geometrytype", ""), l3.featureSet.geometryType = l3.layerDefinition.geometryType, l3.layerDefinition.globalIdField = te2(r3, "globalidfield", ""), l3.layerDefinition.objectIdField = te2(r3, "objectidfield", ""), l3.layerDefinition.typeIdField = te2(r3, "typeidfield", ""), l3.layerDefinition.hasZ = true === te2(r3, "hasz", false), l3.layerDefinition.hasM = true === te2(r3, "hasm", false);
            const e3 = te2(r3, "spatialreference");
            e3 && (l3.layerDefinition.spatialReference = ae2(e3));
            const t4 = [];
            for (const n2 of te2(r3, "fields", [])) {
              const e4 = {
                name: te2(n2, "name", ""),
                alias: te2(n2, "alias", ""),
                type: te2(n2, "type", ""),
                nullable: te2(n2, "nullable", true),
                editable: te2(n2, "editable", true),
                length: te2(n2, "length", null),
                domain: ne(te2(n2, "domain"))
              };
              t4.push(e4);
            }
            l3.layerDefinition.fields = t4;
            const a4 = te2(n, "featureset");
            if (a4) {
              const e4 = {};
              for (const n2 of t4) e4[n2.name.toLowerCase()] = n2.name;
              for (const t5 of te2(a4, "features", [])) {
                const n2 = {}, a5 = te2(t5, "attributes", {});
                for (const t6 in a5) n2[e4[t6.toLowerCase()]] = a5[t6];
                l3.featureSet.features.push({
                  attributes: n2,
                  geometry: ie(te2(t5, "geometry"))
                });
              }
            }
          } else {
            l3.layerDefinition.hasZ = true === te2(n, "hasz", false), l3.layerDefinition.hasM = true === te2(n, "hasm", false), l3.layerDefinition.geometryType = te2(n, "geometrytype", ""), l3.featureSet.geometryType = l3.layerDefinition.geometryType, l3.layerDefinition.objectIdField = te2(n, "objectidfieldname", ""), l3.layerDefinition.typeIdField = te2(n, "typeidfieldname", "");
            const r4 = te2(n, "spatialreference");
            r4 && (l3.layerDefinition.spatialReference = ae2(r4));
            const s2 = [], o2 = te2(n, "fields", null);
            if (!U(o2)) throw new a(e2, r.InvalidParameter, t3);
            for (const e3 of o2) {
              const t4 = {
                name: te2(e3, "name", ""),
                alias: te2(e3, "alias", ""),
                type: te2(e3, "type", ""),
                nullable: te2(e3, "nullable", true),
                editable: te2(e3, "editable", true),
                length: te2(e3, "length", null),
                domain: ne(te2(e3, "domain"))
              };
              s2.push(t4);
            }
            l3.layerDefinition.fields = s2;
            const f = {};
            for (const e3 of s2) f[e3.name.toLowerCase()] = e3.name;
            let u2 = te2(n, "features", null);
            if (U(u2)) for (const e3 of u2) {
              const t4 = {}, n2 = te2(e3, "attributes", {});
              for (const e4 in n2) t4[f[e4.toLowerCase()]] = n2[e4];
              l3.featureSet.features.push({
                attributes: t4,
                geometry: ie(te2(e3, "geometry", null))
              });
            }
            else u2 = null, l3.featureSet.features = u2;
          }
        }
      }
      if (false === se(l3)) throw new a(e2, r.InvalidParameter, t3);
      return l3.layerDefinition.geometryType || (l3.layerDefinition.geometryType = "esriGeometryNull"), d.create(l3, e2.spatialReference);
    });
  }, q2.signatures.push({
    name: "featureset",
    min: 1,
    max: 1
  }), q2.functions.filter = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), U(s[0]) || Q(s[0])) {
        const n2 = [];
        let r3, o = s[0];
        if (o instanceof t && (o = o.toArray()), !_(s[1])) throw new a(e2, r.InvalidParameter, t3);
        r3 = s[1].createFunction(e2);
        for (const e3 of o) {
          const t4 = r3(e3);
          S(t4) ? true === (yield t4) && n2.push(e3) : true === t4 && n2.push(e3);
        }
        return n2;
      }
      if (B(s[0])) {
        const t4 = yield s[0].load(), n2 = O.create(s[1], t4.getFieldsIndex(), t4.dateFieldsTimeZoneDefaultUTC), a4 = n2.getVariables();
        if (a4.length > 0) {
          const t5 = [];
          for (let n3 = 0; n3 < a4.length; n3++) {
            const i2 = {
              name: a4[n3]
            };
            t5.push(yield q2.evaluateIdentifier(e2, i2));
          }
          const i = {};
          for (let e3 = 0; e3 < a4.length; e3++) i[a4[e3]] = t5[e3];
          return n2.parameters = i, new c({
            parentfeatureset: s[0],
            whereclause: n2
          });
        }
        return new c({
          parentfeatureset: s[0],
          whereclause: n2
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "filter",
    min: 2,
    max: 2
  }), q2.functions.orderby = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) {
        const e3 = new e(s[1]);
        return new a2({
          parentfeatureset: s[0],
          orderbyclause: e3
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "orderby",
    min: 2,
    max: 2
  }), q2.functions.top = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) return new a3({
        parentfeatureset: s[0],
        topnum: s[1]
      });
      if (U(s[0])) return ge(s[1]) >= s[0].length ? s[0].slice(0) : s[0].slice(0, ge(s[1]));
      if (Q(s[0])) return ge(s[1]) >= s[0].length() ? s[0].slice(0) : s[0].slice(0, ge(s[1]));
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "top",
    min: 2,
    max: 2
  }), q2.functions.first = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, a4, i) => __async(this, null, function* () {
      if (ae(i, 1, 1, e2, t3), B(i[0])) {
        const t4 = yield i[0].first(n.abortSignal);
        if (null !== t4) {
          const n2 = D.createFromGraphicLikeObject(t4.geometry, t4.attributes, i[0], e2.timeZone);
          return n2._underlyingGraphic = t4, n2;
        }
        return t4;
      }
      return U(i[0]) ? 0 === i[0].length ? null : i[0][0] : Q(i[0]) ? 0 === i[0].length() ? null : i[0].get(0) : null;
    }));
  }, q2.signatures.push({
    name: "first",
    min: 1,
    max: 1
  }), q2.functions.attachments = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      ae(o, 1, 2, e2, t3);
      const f = {
        minsize: -1,
        maxsize: -1,
        types: null,
        returnMetadata: false
      };
      if (o.length > 1) {
        if (o[1] instanceof N) {
          if (o[1].hasField("minsize") && (f.minsize = ge(o[1].field("minsize"))), o[1].hasField("metadata") && (f.returnMetadata = Ne(o[1].field("metadata"))), o[1].hasField("maxsize") && (f.maxsize = ge(o[1].field("maxsize"))), o[1].hasField("types")) {
            const e3 = Re(o[1].field("types"), false);
            e3.length > 0 && (f.types = e3);
          }
        } else if (null !== o[1]) throw new a(e2, r.InvalidParameter, t3);
      }
      if (H(o[0])) {
        let t4 = o[0]._layer;
        return t4 instanceof Ze && (t4 = T(t4, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === t4 ? [] : false === B(t4) ? [] : (yield t4.load(), t4.queryAttachments(o[0].field(t4.objectIdField), f.minsize, f.maxsize, f.types, f.returnMetadata));
      }
      if (null === o[0]) return [];
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "attachments",
    min: 1,
    max: 2
  }), q2.functions.featuresetbyrelationshipname = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 2, 4, e2, t3);
      const o = s[0], d2 = me(s[1]);
      let c2 = P(s[2], null);
      const p = Ne(P(s[3], true));
      if (null === c2 && (c2 = ["*"]), false === U(c2)) throw new a(e2, r.InvalidParameter, t3);
      if (null === s[0]) return null;
      if (!H(s[0])) throw new a(e2, r.InvalidParameter, t3);
      let y3 = o._layer;
      if (y3 instanceof Ze && (y3 = T(y3, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === y3) return null;
      if (false === B(y3)) return null;
      y3 = yield y3.load();
      const h = y3.relationshipMetaData().filter((e3) => e3.name === d2);
      if (0 === h.length) return null;
      if (void 0 !== h[0].relationshipTableId && null !== h[0].relationshipTableId && h[0].relationshipTableId > -1) return E(y3, h[0], o.field(y3.objectIdField), y3.spatialReference, c2, p, e2.lrucache, e2.interceptor);
      let F = y3.serviceUrl();
      if (!F) return null;
      F = "/" === F.charAt(F.length - 1) ? F + h[0].relatedTableId.toString() : F + "/" + h[0].relatedTableId.toString();
      const I2 = yield N2(F, y3.spatialReference, c2, p, e2.lrucache, e2.interceptor);
      yield I2.load();
      let D3 = I2.relationshipMetaData();
      if (D3 = D3.filter((e3) => e3.id === h[0].id), false === o.hasField(h[0].keyField) || null === o.field(h[0].keyField)) {
        const e3 = yield y3.getFeatureByObjectId(o.field(y3.objectIdField), [h[0].keyField]);
        if (e3) {
          const t4 = O.create(D3[0].keyField + "= @id", I2.getFieldsIndex(), I2.dateFieldsTimeZoneDefaultUTC);
          return t4.parameters = {
            id: e3.attributes[h[0].keyField]
          }, I2.filter(t4);
        }
        return new u({
          parentfeatureset: I2
        });
      }
      const T2 = O.create(D3[0].keyField + "= @id", I2.getFieldsIndex(), I2.dateFieldsTimeZoneDefaultUTC);
      return T2.parameters = {
        id: o.field(h[0].keyField)
      }, I2.filter(T2);
    }));
  }, q2.signatures.push({
    name: "featuresetbyrelationshipname",
    min: 2,
    max: 4
  }), q2.functions.featuresetbyassociation = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      ae(s, 2, 3, e2, t3);
      const o = s[0], f = me(P(s[1], "")).toLowerCase(), u2 = G(s[2]) ? me(s[2]) : null;
      if (null === s[0]) return null;
      if (!H(s[0])) throw new a(e2, r.InvalidParameter, t3);
      let c2 = o._layer;
      if (c2 instanceof Ze && (c2 = T(c2, e2.spatialReference, ["*"], true, e2.lrucache, e2.interceptor)), null === c2) return null;
      if (false === B(c2)) return null;
      yield c2.load();
      const p = c2.serviceUrl(), y3 = yield O2(p, e2.spatialReference);
      let F = null, I2 = null, D3 = false;
      if (null !== u2 && "" !== u2 && void 0 !== u2) {
        for (const e3 of y3.terminals) e3.terminalName === u2 && (I2 = e3.terminalId);
        null === I2 && (D3 = true);
      }
      const T2 = y3.associations.getFieldsIndex(), E2 = T2.get("TOGLOBALID").name, A = T2.get("FROMGLOBALID").name, x = T2.get("TOTERMINALID").name, L2 = T2.get("FROMTERMINALID").name, S2 = T2.get("FROMNETWORKSOURCEID").name, C2 = T2.get("TONETWORKSOURCEID").name, v2 = T2.get("ASSOCIATIONTYPE").name, P2 = T2.get("ISCONTENTVISIBLE").name, k2 = T2.get("OBJECTID").name;
      for (const e3 of c2.fields) if ("global-id" === e3.type) {
        F = o.field(e3.name);
        break;
      }
      let O3 = null, z = new B2(new y({
        name: "percentalong",
        alias: "percentalong",
        type: "double"
      }), O.create("0", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), H2 = new B2(new y({
        name: "side",
        alias: "side",
        type: "string"
      }), O.create("''", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
      const W2 = "globalid", G3 = "globalId", K = {};
      for (const e3 in y3.lkp) K[e3] = y3.lkp[e3].sourceId;
      const q3 = new b(new y({
        name: "classname",
        alias: "classname",
        type: "string"
      }), null, K);
      let B3 = "";
      switch (f) {
        case "midspan": {
          B3 = `((${E2}='${F}') OR ( ${A}='${F}')) AND (${v2} IN (5))`, q3.codefield = O.create(`CASE WHEN (${E2}='${F}') THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const e3 = y2(L.findField(y3.associations.fields, A));
          e3.name = W2, e3.alias = W2, O3 = new B2(e3, O.create(`CASE WHEN (${A}='${F}') THEN ${E2} ELSE ${A} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), z = y3.unVersion >= 4 ? new I(L.findField(y3.associations.fields, T2.get("PERCENTALONG").name)) : new B2(new y({
            name: "percentalong",
            alias: "percentalong",
            type: "double"
          }), O.create("0", y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "junctionedge": {
          B3 = `((${E2}='${F}') OR ( ${A}='${F}')) AND (${v2} IN (4,6))`, q3.codefield = O.create(`CASE WHEN (${E2}='${F}') THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const e3 = y2(L.findField(y3.associations.fields, A));
          e3.name = W2, e3.alias = W2, O3 = new B2(e3, O.create(`CASE WHEN (${A}='${F}') THEN ${E2} ELSE ${A} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC)), H2 = new B2(new y({
            name: "side",
            alias: "side",
            type: "string"
          }), O.create(`CASE WHEN (${v2}=4) THEN 'from' ELSE 'to' END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "connected": {
          let e3 = `${E2}='@T'`, t4 = `${A}='@T'`;
          null !== I2 && (e3 += ` AND ${x}=@A`, t4 += ` AND ${L2}=@A`), B3 = "((" + e3 + ") OR (" + t4 + "))", B3 = v(B3, "@T", F ?? ""), e3 = v(e3, "@T", F ?? ""), null !== I2 && (e3 = v(e3, "@A", I2.toString()), B3 = v(B3, "@A", I2.toString())), q3.codefield = O.create("CASE WHEN " + e3 + ` THEN ${S2} ELSE ${C2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC);
          const n2 = y2(L.findField(y3.associations.fields, A));
          n2.name = W2, n2.alias = W2, O3 = new B2(n2, O.create("CASE WHEN " + e3 + ` THEN ${A} ELSE ${E2} END`, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC));
          break;
        }
        case "container":
          B3 = `${E2}='${F}' AND ${v2} = 2`, null !== I2 && (B3 += ` AND ${x} = ` + I2.toString()), q3.codefield = S2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, A), W2, W2);
          break;
        case "content":
          B3 = `(${A}='${F}' AND ${v2} = 2)`, null !== I2 && (B3 += ` AND ${L2} = ` + I2.toString()), q3.codefield = C2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, E2), W2, W2);
          break;
        case "structure":
          B3 = `(${E2}='${F}' AND ${v2} = 3)`, null !== I2 && (B3 += ` AND ${x} = ` + I2.toString()), q3.codefield = S2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, A), W2, G3);
          break;
        case "attached":
          B3 = `(${A}='${F}' AND ${v2} = 3)`, null !== I2 && (B3 += ` AND ${L2} = ` + I2.toString()), q3.codefield = C2, B3 = "( " + B3 + " )", O3 = new k(L.findField(y3.associations.fields, E2), W2, G3);
          break;
        default:
          throw new a(e2, r.InvalidParameter, t3);
      }
      D3 && (B3 = "1 <> 1");
      return new L({
        parentfeatureset: y3.associations,
        adaptedFields: [new I(L.findField(y3.associations.fields, k2)), new I(L.findField(y3.associations.fields, P2)), O3, H2, q3, z],
        extraFilter: B3 ? O.create(B3, y3.associations.getFieldsIndex(), y3.associations.dateFieldsTimeZoneDefaultUTC) : null
      });
    }));
  }, q2.signatures.push({
    name: "featuresetbyassociation",
    min: 2,
    max: 6
  }), q2.functions.groupby = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      if (ae(o, 3, 3, e2, t3), !B(o[0])) throw new a(e2, r.InvalidParameter, t3);
      const l3 = yield o[0].load(), f = [], u2 = [];
      let d2 = false, c2 = [];
      if (G(o[1])) c2.push(o[1]);
      else if (o[1] instanceof N) c2.push(o[1]);
      else if (U(o[1])) c2 = o[1];
      else {
        if (!Q(o[1])) throw new a(e2, r.InvalidParameter, t3);
        c2 = o[1].toArray();
      }
      for (const m2 of c2) if (G(m2)) {
        const e3 = O.create(me(m2), l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC), t4 = true === D2(e3) ? me(m2) : "%%%%FIELDNAME";
        f.push({
          name: t4,
          expression: e3
        }), "%%%%FIELDNAME" === t4 && (d2 = true);
      } else {
        if (!(m2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = m2.hasField("name") ? m2.field("name") : "%%%%FIELDNAME", r3 = m2.hasField("expression") ? m2.field("expression") : "";
          if ("%%%%FIELDNAME" === n && (d2 = true), !n) throw new a(e2, r.InvalidParameter, t3);
          f.push({
            name: n,
            expression: O.create(r3 || n, l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC)
          });
        }
      }
      if (c2 = [], G(o[2])) c2.push(o[2]);
      else if (U(o[2])) c2 = o[2];
      else if (Q(o[2])) c2 = o[2].toArray();
      else {
        if (!(o[2] instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        c2.push(o[2]);
      }
      for (const m2 of c2) {
        if (!(m2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
        {
          const n = m2.hasField("name") ? m2.field("name") : "", r3 = m2.hasField("statistic") ? m2.field("statistic") : "", s2 = m2.hasField("expression") ? m2.field("expression") : "";
          if (!n || !r3 || !s2) throw new a(e2, r.InvalidParameter, t3);
          u2.push({
            name: n,
            statistic: r3.toLowerCase(),
            expression: O.create(s2, l3.getFieldsIndex(), l3.dateFieldsTimeZoneDefaultUTC)
          });
        }
      }
      if (d2) {
        const e3 = {};
        for (const n of l3.fields) e3[n.name.toLowerCase()] = 1;
        for (const n of f) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
        for (const n of u2) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
        let t4 = 0;
        for (const n of f) if ("%%%%FIELDNAME" === n.name) {
          for (; 1 === e3["field_" + t4.toString()]; ) t4++;
          e3["field_" + t4.toString()] = 1, n.name = "FIELD_" + t4.toString();
        }
      }
      for (const t4 of f) yield ee2(t4.expression, q2, e2);
      for (const t4 of u2) yield ee2(t4.expression, q2, e2);
      return o[0].groupby(f, u2);
    }));
  }, q2.signatures.push({
    name: "groupby",
    min: 3,
    max: 3
  }), q2.functions.distinct = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (r2, s, o) => __async(this, null, function* () {
      if (B(o[0])) {
        ae(o, 2, 2, e2, t3);
        const r3 = yield o[0].load(), s2 = [];
        let l3 = [];
        if (G(o[1])) l3.push(o[1]);
        else if (o[1] instanceof N) l3.push(o[1]);
        else if (U(o[1])) l3 = o[1];
        else {
          if (!Q(o[1])) throw new a(e2, r.InvalidParameter, t3);
          l3 = o[1].toArray();
        }
        let f = false;
        for (const o2 of l3) if (G(o2)) {
          const e3 = O.create(me(o2), r3.getFieldsIndex(), r3.dateFieldsTimeZoneDefaultUTC), t4 = true === D2(e3) ? me(o2) : "%%%%FIELDNAME";
          s2.push({
            name: t4,
            expression: e3
          }), "%%%%FIELDNAME" === t4 && (f = true);
        } else {
          if (!(o2 instanceof N)) throw new a(e2, r.InvalidParameter, t3);
          {
            const n = o2.hasField("name") ? o2.field("name") : "%%%%FIELDNAME", l4 = o2.hasField("expression") ? o2.field("expression") : "";
            if ("%%%%FIELDNAME" === n && (f = true), !n) throw new a(e2, r.InvalidParameter, t3);
            s2.push({
              name: n,
              expression: O.create(l4 || n, r3.getFieldsIndex(), r3.dateFieldsTimeZoneDefaultUTC)
            });
          }
        }
        if (f) {
          const e3 = {};
          for (const n of r3.fields) e3[n.name.toLowerCase()] = 1;
          for (const n of s2) "%%%%FIELDNAME" !== n.name && (e3[n.name.toLowerCase()] = 1);
          let t4 = 0;
          for (const n of s2) if ("%%%%FIELDNAME" === n.name) {
            for (; 1 === e3["field_" + t4.toString()]; ) t4++;
            e3["field_" + t4.toString()] = 1, n.name = "FIELD_" + t4.toString();
          }
        }
        for (const t4 of s2) yield ee2(t4.expression, q2, e2);
        return o[0].groupby(s2, []);
      }
      return X2(o);
    }));
  }, q2.functions.getfeaturesetinfo = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (a4, i, r2) => __async(this, null, function* () {
      if (ae(r2, 1, 1, e2, t3), !B(r2[0])) return null;
      const s = yield r2[0].getFeatureSetInfo();
      return s ? N.convertObjectToArcadeDictionary({
        layerId: s.layerId,
        layerName: s.layerName,
        itemId: s.itemId,
        serviceLayerUrl: s.serviceLayerUrl,
        webMapLayerId: s.webMapLayerId ?? null,
        webMapLayerTitle: s.webMapLayerTitle ?? null,
        className: null,
        objectClassId: null
      }, He(e2), false, false) : null;
    }));
  }, q2.signatures.push({
    name: "getfeaturesetinfo",
    min: 1,
    max: 1
  }), q2.functions.filterbysubtypecode = function(e2, t3) {
    return q2.standardFunctionAsync(e2, t3, (n, r2, s) => __async(this, null, function* () {
      if (ae(s, 2, 2, e2, t3), B(s[0])) {
        const n2 = yield s[0].load(), r3 = s[1];
        if (!V(r3)) throw new a(e2, r.InvalidParameter, t3);
        if (n2.subtypeField) {
          const e3 = O.create(`${n2.subtypeField}= ${s[1]}`, n2.getFieldsIndex(), n2.dateFieldsTimeZoneDefaultUTC);
          return new c({
            parentfeatureset: s[0],
            whereclause: e3
          });
        }
        if (null === n2.typeIdField || "" === n2.typeIdField) throw new a(e2, r.FeatureSetDoesNotHaveSubtypes, t3);
        const o = O.create(`${n2.typeIdField}= ${s[1]}`, n2.getFieldsIndex(), n2.dateFieldsTimeZoneDefaultUTC);
        return new c({
          parentfeatureset: s[0],
          whereclause: o
        });
      }
      throw new a(e2, r.InvalidParameter, t3);
    }));
  }, q2.signatures.push({
    name: "filterbysubtypecode",
    min: 2,
    max: 2
  }));
}
export {
  le as registerFunctions
};
//# sourceMappingURL=featuresetbase-B3CZNJW4.js.map
