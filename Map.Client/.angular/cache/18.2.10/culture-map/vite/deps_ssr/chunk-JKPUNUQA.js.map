{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/support/arcadeOnDemand.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport \"../geometry.js\";\nimport e from \"../core/Error.js\";\nimport r from \"../core/Logger.js\";\nimport t from \"../geometry/SpatialReference.js\";\nconst a = () => r.getLogger(\"esri.support.arcadeOnDemand\");\nlet s;\nfunction i() {\n  return s || (s = (async () => {\n    const e = await import(\"./arcadeUtils.js\");\n    return {\n      arcade: e.arcade,\n      arcadeUtils: e,\n      Dictionary: e.Dictionary,\n      Feature: e.arcadeFeature\n    };\n  })()), s;\n}\nconst c = (e, r, t) => p.create(e, r, t, null, [\"$feature\", \"$view\"], []),\n  n = (e, r) => p.create(e, r.spatialReference, r.fields, null, [\"$feature\", \"$view\"], []),\n  o = (e, r, t) => p.create(e, r, t, null, [\"$feature\", \"$view\"], []),\n  l = o,\n  u = (e, r, t, a) => p.create(e, r, t, a, [\"$feature\", \"$view\"], []);\nclass p {\n  constructor(e, r, t, a, s, i, c) {\n    this.services = null, this.script = e, this.evaluate = a;\n    const n = Array.isArray(i) ? i : i?.fields;\n    this.fields = n ?? [], this._syntaxTree = t, this._arcade = r, this._arcadeFeature = s, this._spatialReference = c, this._referencesGeometry = r.scriptTouchesGeometry(this._syntaxTree), this._referencesScale = this._arcade.referencesMember(this._syntaxTree, \"scale\");\n  }\n  static async create(r, s, c, n, o, l) {\n    const {\n        arcade: u,\n        Feature: f,\n        Dictionary: m\n      } = await i(),\n      d = t.fromJSON(s);\n    let y;\n    try {\n      y = u.parseScript(r, l);\n    } catch (x) {\n      return a().error(new e(\"arcade-bad-expression\", \"Failed to parse arcade script\", {\n        script: r,\n        error: x\n      })), null;\n    }\n    const h = o.reduce((e, r) => ({\n      ...e,\n      [r]: null\n    }), {});\n    let w = null;\n    null != n && (w = new m(n), w.immutable = !0, h.$config = null);\n    const v = u.scriptUsesGeometryEngine(y),\n      $ = v && u.enableGeometrySupport(),\n      g = u.scriptUsesFeatureSet(y) && u.enableFeatureSetSupport(),\n      _ = u.scriptIsAsync(y),\n      F = _ && u.enableAsyncSupport(),\n      S = {\n        vars: h,\n        spatialReference: d,\n        useAsync: !!F\n      };\n    await Promise.all([$, g, F]);\n    const b = new Set();\n    await u.loadDependentModules(b, y, null, _, v);\n    const R = new m();\n    R.immutable = !1, R.setField(\"scale\", 0);\n    const j = u.compileScript(y, S),\n      G = (e, r) => {\n        const t = e.$view?.timeZone;\n        return \"$view\" in e && e.$view && (R.setField(\"scale\", \"object\" == typeof e.$view && \"scale\" in e.$view ? e.$view.scale : void 0), e.$view = R), w && (e.$config = w), j({\n          vars: e,\n          spatialReference: d,\n          services: r,\n          timeZone: t\n        });\n      };\n    return new p(r, u, y, G, new f(), c, d);\n  }\n  repurposeFeature(e) {\n    return e.geometry && !e.geometry.spatialReference && (e.geometry.spatialReference = this._spatialReference), this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry, e.attributes, {\n      fields: this.fields\n    }), this._arcadeFeature;\n  }\n  referencesGeometry() {\n    return this._referencesGeometry;\n  }\n  referencesScale() {\n    return this._referencesScale;\n  }\n}\nexport { p as ArcadeExpression, u as createDictionaryExpression, c as createLabelExpression, o as createRendererExpression, n as createRendererExpressionWithOptions, l as createVVExpression, i as loadArcade };"],
  "mappings": "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",
  "names": ["s", "a", "s", "i", "c", "n", "o", "u", "f", "r"]
}
