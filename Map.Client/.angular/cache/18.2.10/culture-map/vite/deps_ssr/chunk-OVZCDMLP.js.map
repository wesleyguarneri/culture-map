{
  "version": 3,
  "sources": ["../../../../../../node_modules/@arcgis/core/widgets/support/InteractiveAnalysisViewModel.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport { _ as s } from \"../../chunks/tslib.es6.js\";\nimport { createTask as t } from \"../../core/asyncUtils.js\";\nimport \"../../core/has.js\";\nimport i from \"../../core/Logger.js\";\nimport { abortMaybe as e } from \"../../core/maybe.js\";\nimport { throwIfAborted as n, isAbortError as a, isAborted as r } from \"../../core/promiseUtils.js\";\nimport { watch as o, sync as l, syncAndInitial as c, whenOnce as h } from \"../../core/reactiveUtils.js\";\nimport { property as y } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/RandomLCG.js\";\nimport { subclass as w } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { InteractiveToolViewModel as p } from \"./InteractiveToolViewModel.js\";\nvar _;\n!function (s) {\n  s[s.PENDING = 0] = \"PENDING\", s[s.WAIT_FOR_VIEW_READY = 1] = \"WAIT_FOR_VIEW_READY\", s[s.RUNNING = 2] = \"RUNNING\";\n}(_ || (_ = {}));\nlet u = class extends p {\n  constructor(s = {}) {\n    super(s), this.analysisView = null, this._reconnectViewTask = null, this._parentChangeFromReconnect = !1, this._startUserOperation = null;\n    const t = s?.analysis;\n    null != t ? this.analysis = t : (this._set(\"analysis\", this.constructAnalysis()), this._set(\"isAnalysisOwner\", !0));\n  }\n  normalizeCtorArgs(s) {\n    const {\n      analysis: t,\n      ...i\n    } = s;\n    return i;\n  }\n  initialize() {\n    this.addHandles([o(() => this.analysis?.parent, s => {\n      this._parentChangeFromReconnect || s === this.view || this._set(\"isAnalysisOwner\", !1);\n      const t = !this._parentChangeFromReconnect;\n      this._parentChangeFromReconnect = !1, t && this._scheduleViewReconnect();\n    }, l), o(() => ({\n      view: this.view,\n      ready: null != this.view && this.view.ready,\n      supported: this.supported\n    }), ({\n      view: s\n    }, t) => {\n      const i = t?.view;\n      s !== i && (this._startUserOperation = e(this._startUserOperation), this._disconnectFromView(i)), this._scheduleViewReconnect();\n    }, c), o(() => this.analysis.isEditable, (s, t) => {\n      null != this.analysisView && (s && !t && null == this.tool ? this.createTool() : s || !t || null == this.tool || this.tool.active || this.removeTool());\n    })]);\n  }\n  destroy() {\n    this._reconnectViewTask = e(this._reconnectViewTask), this._startUserOperation = e(this._startUserOperation), null != this.analysisView && (this.analysisView.visible = void 0), this._disconnectFromView(this.view), null != this.analysis && this.isAnalysisOwner && (this.analysis.destroy(), this._set(\"analysis\", null));\n  }\n  set analysis(s) {\n    s !== this._get(\"analysis\") && (this._startUserOperation = e(this._startUserOperation), this._disconnectFromView(this.view), this._setExternalAnalysis(s), this._scheduleViewReconnect());\n  }\n  get ready() {\n    return null != this.analysisView && !this.connectingToView;\n  }\n  get connectingToView() {\n    return null != this._reconnectViewTask;\n  }\n  get isAnalysisOwner() {\n    return this._get(\"isAnalysisOwner\");\n  }\n  set visible(s) {\n    this._set(\"visible\", s), null != this.analysisView && (this.analysisView.visible = s);\n  }\n  async start() {\n    if (!this.visible) return void i.getLogger(this).warn(\"Cannot start analysis when not visible\");\n    this.clear();\n    const s = {\n        task: null,\n        abort: null,\n        state: _.PENDING\n      },\n      e = t(async t => {\n        s.state = _.WAIT_FOR_VIEW_READY, await h(() => this.ready, t), s.state = _.RUNNING, this.createTool({\n          interactive: !0\n        });\n      });\n    return s.task = e, s.abort = () => e.abort(), this._startUserOperation = s, e.promise;\n  }\n  clear() {\n    this._startUserOperation = e(this._startUserOperation), this.removeTool(), this.analysis.clear();\n  }\n  onConnectToAnalysisView(s) {}\n  onDisconnectFromAnalysisView() {}\n  _scheduleViewReconnect() {\n    this._reconnectViewTask = e(this._reconnectViewTask);\n    const s = t(async t => {\n      try {\n        await this._reconnectView(t);\n      } catch (e) {\n        if (n(t), !a(e)) return void i.getLogger(this).warn(\"Failed to use analysis in view model\", e);\n        throw e;\n      } finally {\n        s === this._reconnectViewTask && (this._reconnectViewTask = null);\n      }\n    });\n    this._reconnectViewTask = s;\n  }\n  async _reconnectView(s) {\n    const {\n        view: t\n      } = this,\n      i = null != t && t.ready && this.supported,\n      e = this.analysis;\n    if (this._startUserOperation = V(this._startUserOperation), this._disconnectFromView(t), i && null != t && null != e) {\n      if (this.isAnalysisOwner) {\n        if (null != e.parent) return void this.logError(\"expected owned analysis to have null parent when connecting to view\");\n        this._parentChangeFromReconnect = !0, t.analyses.add(e);\n      }\n      this.analysisView = await t.whenAnalysisView(e), r(s) ? this._startUserOperation = V(this._startUserOperation) : (this.analysisView.visible = this.visible, this.onConnectToAnalysisView(this.analysisView), this.createTool());\n    }\n  }\n  _disconnectFromView(s) {\n    this.removeTool(), null != s && this.isAnalysisOwner && (this._parentChangeFromReconnect = !0, s.analyses.remove(this.analysis), this.analysis.clear()), this.analysisView = null, this.onDisconnectFromAnalysisView();\n  }\n  _setExternalAnalysis(s) {\n    null == this.analysisView || this.isAnalysisOwner || (this.analysisView.visible = !0), this.analysisView = null, this._set(\"isAnalysisOwner\", !1), this._set(\"analysis\", s), this._parentChangeFromReconnect = !1;\n  }\n  get testInfo() {}\n};\nfunction V(s) {\n  return null != s && s.state >= _.RUNNING ? (s.abort(), null) : s;\n}\ns([y({\n  nonNullable: !0\n})], u.prototype, \"analysis\", null), s([y()], u.prototype, \"analysisView\", void 0), s([y()], u.prototype, \"ready\", null), s([y()], u.prototype, \"connectingToView\", null), s([y({\n  readOnly: !0\n})], u.prototype, \"isAnalysisOwner\", null), s([y({\n  type: Boolean,\n  value: !0\n})], u.prototype, \"visible\", null), s([y()], u.prototype, \"_reconnectViewTask\", void 0), u = s([w(\"esri.widgets.support.InteractiveAnalysisViewModel\")], u);\nexport { u as InteractiveAnalysisViewModel };"],
  "mappings": "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",
  "names": ["s", "d", "e"]
}
